<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[è‰¾å…‹æ–¯ã®ç·¨ç¢¼è€…]]></title>
  <subtitle><![CDATA[ä¸€å€‹å½å®…çº§åˆ«çš„è’Ÿè’»ç¢¼ç•œã€‚]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://xcoder.in/"/>
  <updated>2016-02-24T07:24:13.000Z</updated>
  <id>http://xcoder.in/</id>
  
  <author>
    <name><![CDATA[å°é³¥éŠæ­»æœˆ]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[è®“æˆ‘å€‘ä¸€èµ·ä¾†èµ·èŠ±åå§]]></title>
    <link href="http://xcoder.in/2016/02/24/lets-hua/"/>
    <id>http://xcoder.in/2016/02/24/lets-hua/</id>
    <published>2016-02-24T05:40:36.000Z</published>
    <updated>2016-02-24T07:24:13.000Z</updated>
    <content type="html"><![CDATA[<h2 id="èµ·å› ">èµ·å› </h2><p>èµ·å› æ˜¯æˆ‘ä¸€å€‹å«ã€å°é¾ã€çš„å¥½åŸºå‹ç”±æ–¼æŸäº›åŸå› é›¢è·å»äº†ä¸€å®¶è·Ÿé˜¿é‡Œä¸€æ¨£æœ‰ç€ã€èŠ±åæ–‡åŒ–ã€çš„å…¬å¸ï¼Œæ–¼æ˜¯é–‹å§‹çˆ²èŠ±åçŠ¯æ„ã€‚</p>
<p>çµåˆä¹‹å‰å¦¹ç´™ã€å¼ç´“ã€åœ¨èµ·èŠ±åçš„æ™‚å€™ä¹Ÿé‡åˆ°äº†åŒæ¨£çš„å›°æ“¾ï¼Œæ–¼æ˜¯æ±ºå®šç”¨ Node.js å¯«å€‹ã€ä¸€æœ¬æ­£ç¶“äº‚èµ·èŠ±åã€çš„ç¨‹åºã€‚</p>
<h2 id="æº–å‚™">æº–å‚™</h2><h3 id="Chinese_Random_Name">Chinese Random Name</h3><p>é¦–å…ˆèµ·èŠ±åçš„åŸç†å°±æ˜¯èƒ¡äº‚éš¨æ©Ÿä¸€ä¸²å­—å‡ºä¾†èƒ¡äº‚æ‹¼ã€‚</p>
<p>æ–¼æ˜¯æº–å‚™æ‡‰è©²æœ‰ <a href="https://github.com/XadillaX/chinese-random-name" target="_blank" rel="external">chinese-random-name</a>ï¼Œä¸€å€‹éš¨æ©Ÿç”Ÿæˆä¸­æ–‡åçš„åŒ…ã€‚</p>
<p>ä½¿ç”¨å®ƒå¾ˆç°¡å–®ï¼Œå…ˆæŠŠå®ƒ <code>require</code> é€²ä¾†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> randomName = <span class="built_in">require</span>(<span class="string">"chinese-random-name"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h4><p>å¦‚æœä½ éœ€è¦éš¨æ©Ÿç”Ÿæˆä¸€å€‹åå­—åªéœ€è¦ <code>randomName.generate()</code> å°±å¯ä»¥äº†ï¼›å¦‚æœä½ è¦éš¨æ©Ÿä¸€å€‹å§“é‚£éº¼å°± <code>randomName.surnames.getOne()</code>ï¼›å¦‚æœä½ åªéœ€è¦ç²å¾—åå­—ï¼Œé€™è£é¢å°±æœ‰é»é–€é“äº†ã€‚</p>
<h4 id="é«˜ç´šç”¨æ³•">é«˜ç´šç”¨æ³•</h4><p>ä½ å¯ä»¥éš¨æ©Ÿç”Ÿæˆä¸€å€‹åï¼ˆä¸å¸¶å§“çš„ï¼‰ <code>randomName.names.get()</code>ï¼›ä½ ä¹Ÿå¯ä»¥æŒ‡å®šåå­—çš„å­—æ•¸ï¼Œä¸€äºŒä¸‰ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">randomName.names.get1();</span><br><span class="line">randomName.names.get2();</span><br><span class="line">randomName.names.get3();</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ï¼</p>
<p>åˆæˆ–è€…ï¼</p>
<p>ç„¶å¾Œæˆ–è€…ï¼</p>
<p>ä½ å¯ä»¥æŒ‡å®šæ¯å€‹å­—çš„äº”è¡Œå“¦ï¼</p>
<p>ä»€éº¼æ„æ€å‘¢ï¼Ÿæ¯”å¦‚ä½ æƒ³çµ¦å­©å­èµ·å€‹åï¼Œç„¶å¾Œå­©å­å‘½è£äº”è¡Œç¼ºé‡‘ï¼Œé‚£éº¼å°±å¯ä»¥ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">randomName.names.get2(<span class="string">"é‡‘é‡‘"</span>);</span><br></pre></td></tr></table></figure>
<p>ç„¶å¾Œä½ å°±å¯èƒ½å¾—åˆ°ä¸€å€‹ã€<strong>ç´«éŠ“</strong>ã€ï¼Œå…©å€‹å­—éƒ½æ˜¯å±¬é‡‘çš„ã€‚é‚£éº¼å¦‚æœä½ å­©å­å§“æï¼Œå°±å«æç´«éŠ“ï¼›å¦‚æœå­©å­å§“ç‹ï¼Œå°±å«ç‹ç´«éŠ“ï¼›å¦‚æœå§“æ„›æ–°è¦ºç¾…ï¼Œé‚£éº¼å°±å«æ„›æ–°è¦ºç¾…Â·ç´«éŠ“ã€‚</p>
<p>æœ‰æœ¨æœ‰æƒ³çµ¦æˆ‘è£å¾—é€™å€‹é€¼æ‰“å€‹ 82 åˆ†å‘¢ï¼Ÿå‰©ä¸‹çš„å°±äº¤çµ¦ 666 å§ã€‚(à¸‡ â€¢Ì€_â€¢Ì)à¸‡</p>
<h3 id="Nomnom">Nomnom</h3><p>é€™å€‹åŒ…æ˜¯ç”¨ä¾†è§£æå‘½ä»¤è¡Œåƒæ•¸çš„ã€‚é›–ç„¶å¸‚é¢ä¸Šæœ‰æŒºå¤šåˆ¥çš„çš„ï¼Œæ¯”å¦‚ <a href="https://www.npmjs.com/package/commander" target="_blank" rel="external">commander</a> ç­‰ï¼Œä¸éæˆ‘é‚„æ˜¯æœ€ç¿’æ…£ <a href="https://www.npmjs.com/package/nomnom" target="_blank" rel="external">nomnom</a>ï¼Œç”¨ç¨±æ‰‹äº†å°±ä¸æƒ³æ›äº†ã€‚</p>
<p>é›–ç„¶å®ƒçš„ GitHub Repo ä¸‹é¢æœ‰é€™éº¼ä¸€æ®µè©±ã€‚</p>
<blockquote>
<p>Nomnom is deprecated. Check out <a href="https://github.com/tj/commander.js" target="_blank" rel="external">https://github.com/tj/commander.js</a>, which should have most, if not all of the capability that nomnom had. Thank you!</p>
</blockquote>
<p>ä¸éå†æ€éº¼èªª nomnom ä¹Ÿæ˜¯ç•¶å¹´ <a href="https://github.com/substack/node-optimist" target="_blank" rel="external">substack</a> å¤§ç¥æ¨è–¦çš„å•Šã€‚(à²¡Ï‰à²¡)</p>
<h3 id="Colorful">Colorful</h3><p>é€™å€‹åŒ…æ˜¯ç”¨ä¾†ä¸Šè‰²çš„ã€‚</p>
<p>ç•¢ç«Ÿäº”è¡Œæ˜¯æœ‰é¡è‰²çš„å“‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> color = <span class="built_in">require</span>(<span class="string">"colorful"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(color.red(<span class="string">"ï¼ˆ*/âˆ‡ï¼¼*ï¼‰"</span>));</span><br></pre></td></tr></table></figure>
<p>é‚£éº¼åœ¨ä½ çš„çµ‚ç«¯å°±å¥½çœ‹åˆ°ä¸€å€‹ç´…è‰²çš„ <code>ï¼ˆ*/âˆ‡ï¼¼*ï¼‰</code>ã€‚</p>
<h3 id="Is_Chinese">Is Chinese</h3><p>ç”¨ä¾†åˆ¤æ–·æ˜¯ä¸æ˜¯ä¸­æ–‡çš„åŒ…ã€‚</p>
<p>ä½œçˆ²ä¸€å€‹èµ·åçš„å‘½ä»¤è¡Œç¨‹åºï¼Œä½ ç¸½å¾—å¥½å¥½å‚³åƒæ‰è¡Œå§ï¼Œç¸½ä¸èƒ½ä½ éš¨ä¾¿å‚³å€‹é¹¹é´¨è›‹ğŸ£æˆ‘ä¹Ÿå¥½å¥½è™•ç†å§ã€‚</p>
<p>æ–¼æ˜¯å°±ç”¨ <a href="https://www.npmjs.com/package/is-chinese" target="_blank" rel="external">is-chinese</a> ä¾†åˆ¤æ–·æŸå€‹å­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ç´”ä¸­æ–‡ã€‚</p>
<p>é€™å€‹åŒ…æ˜¯ç”±å‰é˜¿é‡Œå°å¤¥ä¼´ï¼ŒCNode ç«™é•·<a href="https://github.com/alsotang" target="_blank" rel="external">å”å°‘</a>å¯«çš„ã€‚</p>
<p>ç”¨èµ·ä¾†ä¹Ÿå¾ˆç°¡å–®ï¼Œåªè¦ <code>isChinese(&quot;ä»€éº¼ä½ è¦åˆ¤æ–·ä»€éº¼&quot;)</code> å°±å¯ä»¥äº†ã€‚</p>
<h3 id="é›†åˆ">é›†åˆ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save <span class="operator">-d</span> chinese-random-name</span><br><span class="line">$ npm install --save <span class="operator">-d</span> nomnom</span><br><span class="line">$ npm install --save <span class="operator">-d</span> colorful</span><br><span class="line">$ npm install --save <span class="operator">-d</span> is-chinese</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>chinese-random-name</strong>: <a href="https://github.com/XadillaX/chinese-random-name" target="_blank" rel="external">https://github.com/XadillaX/chinese-random-name</a></li>
<li><strong>nomnom</strong>: <a href="https://github.com/harthur/nomnom" target="_blank" rel="external">https://github.com/harthur/nomnom</a></li>
<li><strong>colorful</strong>: <a href="https://github.com/lepture/colorful" target="_blank" rel="external">https://github.com/lepture/colorful</a></li>
<li><strong>is-chinese</strong>: <a href="https://github.com/alsotang/is-chinese" target="_blank" rel="external">https://github.com/alsotang/is-chinese</a></li>
</ul>
<h2 id="é–‹å·¥">é–‹å·¥</h2><p>å…¶çµæœåœ¨<a href="https://github.com/BoogeeDoo/hua" target="_blank" rel="external">é€™è£</a>ã€‚</p>
<h3 id="è§£æå‘½ä»¤è¡Œåƒæ•¸">è§£æå‘½ä»¤è¡Œåƒæ•¸</h3><p>é¦–å…ˆæ•ˆæœæ˜¯é€™æ¨£çš„ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ hua --help</span><br><span class="line"></span><br><span class="line">Usage: hua [options]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">-p PREFIX, --prefix PREFIX          to specify a prefix.</span><br><span class="line"><span class="operator">-s</span> SUFFIX, --suffix SUFFIX          to specify a suffix.</span><br><span class="line">-<span class="number">5</span> WUXING, --five-elements WUXING   the file elements (Wuxing) of huaming.</span><br><span class="line">-c COUNT, --count COUNT             the count of huaming  [<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨è€…å¯ä»¥è‡ªå·±æƒ³ä¸€å€‹å‰ç¶´æˆ–è€…å¾Œç¶´ï¼Œç„¶å¾Œè‡ªå®šç¾©ï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼‰å…©å€‹å­—çš„äº”è¡Œï¼Œä»¥åŠæŒ‡å®šä¸€æ¬¡æ€§ç”Ÿæˆå¤šå°‘å€‹èŠ±åã€‚</p>
<p>æ¯”å¦‚æƒ³è¦ç”Ÿæˆä»¥ <code>é¾</code> å­—çˆ²å‰ç¶´çš„èŠ±åï¼Œå°±å¯ä»¥ <code>$ hua --prefix é¾</code>ï¼Œå¾—åˆ°çµæœå¯ä»¥æ˜¯é€™æ¨£çš„ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* é¾å¹¼</span><br><span class="line">* é¾å·¡</span><br><span class="line">* é¾èº¬</span><br><span class="line">* é¾ä»‡</span><br><span class="line">* é¾éŒ˜</span><br><span class="line">* é¾é°</span><br><span class="line">* é¾æ‹¾</span><br><span class="line">* é¾å¤®</span><br><span class="line">* é¾äº›</span><br><span class="line">* é¾æ‚ </span><br></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³å…©å€‹å­—åˆ†åˆ¥æ‰€å±¬é‡‘å’Œèª°ï¼Œå°±å¯ä»¥ <code>$ hua --five-elements é‡‘æ°´</code> ä¾†èµ·èŠ±åï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* å€©å¨¥</span><br><span class="line">* é›€æ•ˆ</span><br><span class="line">* é»æ£“</span><br><span class="line">* å¥¼æº¶</span><br><span class="line">* é¦¨æ²™</span><br><span class="line">* å®®é–’</span><br><span class="line">* è£•æ··</span><br><span class="line">* ä¿—å°</span><br><span class="line">* ç¶¢å¨¥</span><br><span class="line">* ç‘æ·¦</span><br></pre></td></tr></table></figure>
<p>æƒ³è¦å¾—åˆ°é€™æ¨£ä¸€å€‹å‘½ä»¤è¡Œåƒæ•¸ï¼Œæˆ‘å€‘å¯ä»¥ç”¨ <code>nomnom</code> ä¾†è§£æ±ºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> opts = <span class="built_in">require</span>(<span class="string">"nomnom"</span>)</span><br><span class="line">    .script(<span class="string">"hua"</span>)</span><br><span class="line">    .option(<span class="string">"prefix"</span>, &#123;</span><br><span class="line">        abbr: <span class="string">"p"</span>,</span><br><span class="line">        help: <span class="string">"to specify a prefix."</span>,</span><br><span class="line">        metavar: <span class="string">"PREFIX"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .option(<span class="string">"suffix"</span>, &#123;</span><br><span class="line">        abbr: <span class="string">"s"</span>,</span><br><span class="line">        help: <span class="string">"to specify a suffix."</span>,</span><br><span class="line">        metavar: <span class="string">"SUFFIX"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .option(<span class="string">"five-elements"</span>, &#123;</span><br><span class="line">        abbr: <span class="string">"5"</span>,</span><br><span class="line">        help: <span class="string">"the file elements (Wuxing) of huaming."</span>,</span><br><span class="line">        metavar: <span class="string">"WUXING"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .option(<span class="string">"count"</span>, &#123;</span><br><span class="line">        abbr: <span class="string">"c"</span>,</span><br><span class="line">        help: <span class="string">"the count of huaming"</span>,</span><br><span class="line">        metavar: <span class="string">"COUNT"</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="number">10</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .parse();</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„é€™æ®µä»£ç¢¼åˆ†åˆ¥æŒ‡å®šäº†è…³æœ¬åçˆ² <code>hua</code>ï¼Œç„¶å¾ŒæŒ‡å®šäº† <code>prefix</code> / <code>suffix</code> / <code>five-elements</code> å’Œ <code>count</code> å››å€‹åƒæ•¸ï¼Œä¸¦æŠŠè§£æå¥½çš„åƒæ•¸è³¦å€¼çµ¦ <code>opts</code> è®Šé‡ã€‚</p>
<blockquote>
<p>ç”±æ–¼æˆ‘å¸Œæœ›é€™å€‹åŒ…åœ¨é€šå¸¸çš„ Node.js ä¸‹éƒ½å¯ä»¥è·‘ï¼Œæ‰€ä»¥æ²’æœ‰ç”¨ <code>let</code> ä¹‹é¡çš„æ±è¥¿ã€‚</p>
</blockquote>
<h3 id="èŠ±åé¡">èŠ±åé¡</h3><p>æ¥ä¸‹å»è¦å¯«ä¸€å€‹èŠ±åé¡ï¼Œé€™å€‹é¡ä¸åªæ˜¯å¯ä»¥åœ¨ CLI ä¹‹ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è®“åˆ¥äººä½œçˆ²ä¸€å€‹åŒ…ä¾†å¼•å…¥ã€‚ç„¶å¾Œå¯¦éš›ä¸Šé€™å€‹é¡å°±æ˜¯è¦å° <code>chinese-random-name</code> é€²è¡Œä¸€å€‹å°è£ã€‚</p>
<h4 id="æ§‹é€ å‡½æ•¸">æ§‹é€ å‡½æ•¸</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Hua = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.options = options;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆé€™å€‹ <code>options</code> å°±æ˜¯ä¹‹å‰ç”± <code>nomnom</code> è§£æå‡ºä¾†çš„åƒæ•¸ï¼Œç•¶ç„¶æœ‰äº›åƒæ•¸æ˜¯å¯é¸çš„ã€‚</p>
<p>æ¥ä¸‹å»æˆ‘å€‘è¦åœ¨æ§‹é€ å‡½æ•¸ä¹Ÿå°±æ˜¯ <code>Hua</code> è£é¢æ ¼å¼åŒ–å‰ç¶´æˆ–è€…å¾Œç¶´ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰ï¼Œå°‡ä»–å€‘å¼„æˆåªæœ‰ä¸€å€‹æ¼¢å­—çš„æ ¼å¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(options.prefix) &#123;</span><br><span class="line">    options.prefix = options.prefix[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span>(!isChinese(options.prefix)) <span class="keyword">delete</span> options.prefix;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(options.suffix) &#123;</span><br><span class="line">    options.suffix = options.suffix[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span>(!isChinese(options.suffix)) <span class="keyword">delete</span> options.suffix;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‰å¾Œç¶´å¼„å¥½ä¹‹å¾Œè¦å°äº”è¡Œé€²è¡Œåˆ†æäº†ã€‚</p>
<p>å¦‚æœæœ‰å‰å¾Œç¶´é‚£éº¼å¿½ç•¥äº”è¡Œåƒæ•¸ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(options.prefix &amp;&amp; options.suffix) &#123;</span><br><span class="line">    <span class="keyword">delete</span> options[<span class="string">"file-elements"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å‰ç¶´ï¼Œé‚£éº¼å¿½ç•¥å‚³é€²ä¾†çš„äº”è¡Œçš„ç¬¬ä¸€å€‹äº”è¡Œï¼›å¦‚æœæœ‰å¾Œç¶´é‚£éº¼å¿½ç•¥ç¬¬äºŒå€‹å­—çš„äº”è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wuxing = <span class="string">"é‡‘æœ¨æ°´ç«åœŸ"</span>;</span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(options.prefix) &#123;</span><br><span class="line">    options[<span class="string">"five-elements"</span>] = options[<span class="string">"five-elements"</span>].substr(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> === wuxing.indexOf(options[<span class="string">"five-elements"</span>])) &#123;</span><br><span class="line">        <span class="keyword">delete</span> options[<span class="string">"five-elements"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(options.suffix) &#123;</span><br><span class="line">    options[<span class="string">"five-elements"</span>] = options[<span class="string">"five-elements"</span>].substr(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> === wuxing.indexOf(options[<span class="string">"five-elements"</span>])) &#123;</span><br><span class="line">        <span class="keyword">delete</span> options[<span class="string">"five-elements"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå‰å¾Œç¶´éƒ½æ²’æœ‰ï¼Œé‚£éº¼è¦æ ¼å¼åŒ–ä¸€ä¸‹è©²åƒæ•¸ï¼Œä½¿å…¶åƒ…å‰©å…©å€‹æœ‰æ•ˆçš„äº”è¡Œæ¼¢å­—ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    options[<span class="string">"five-elements"</span>] = options[<span class="string">"five-elements"</span>].substr(<span class="number">0</span>, <span class="number">2</span>).split(<span class="string">""</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; options[<span class="string">"five-elements"</span>].length; i++) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯ç„¡æ•ˆäº”è¡Œæˆ–è€…å†°æ²’æœ‰é€™å€‹å­—çš„è©±ï¼Œéš¨æ©Ÿä¸€å€‹äº”è¡Œå‡ºä¾†</span></span><br><span class="line">        <span class="keyword">if</span>(-<span class="number">1</span> === wuxing.indexOf(options[<span class="string">"five-elements"</span>][i])) &#123;</span><br><span class="line">            options[<span class="string">"five-elements"</span>][i] = wuxing[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">5</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—æ•¸ä¸å¤ ï¼Œéš¨æ©Ÿä¾†æ¹Š</span></span><br><span class="line">    <span class="keyword">while</span>(options[<span class="string">"five-elements"</span>].length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        options[<span class="string">"five-elements"</span>].push(wuxing[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">5</span>)]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    options[<span class="string">"five-elements"</span>] = options[<span class="string">"five-elements"</span>].join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šçš„é€™äº›é‚è¼¯éƒ½å¯«åœ¨æ§‹é€ å‡½æ•¸è£é¢ï¼Œå¦‚æœæƒ³è¦å®Œæ•´çš„æ§‹é€ å‡½æ•¸å¯ä»¥çœ‹ <code>hua</code> çš„ <a href="https://github.com/BoogeeDoo/hua/blob/09f1bc7eae14faaa9e881392d3811a6073d94b1c/lib/hua.js#L14-L55" target="_blank" rel="external">hua.js</a> æ–‡ä»¶ã€‚</p>
<h4 id="ç”Ÿæˆä¸€å€‹èŠ±å">ç”Ÿæˆä¸€å€‹èŠ±å</h4><p>ç”Ÿæˆä¸€å€‹èŠ±åå…¶å¯¦å°±æ˜¯èª¿ç”¨ <code>randomName.names.get</code> ç³»åˆ—å‡½æ•¸å€‘äº†ã€‚</p>
<ul>
<li><strong>æœ‰å‰å¾Œç¶´ï¼š</strong>ç›´æ¥è¿”å›å‰ç¶´åŠ å¾Œç¶´ã€‚</li>
<li><strong>æœ‰å‰ç¶´ï¼š</strong>è¿”å›å‰ç¶´åŠ  <code>get1</code>ã€‚</li>
<li><strong>æœ‰å¾Œç¶´ï¼š</strong>è¿”å› <code>get1</code> åŠ å¾Œç¶´ã€‚</li>
<li><strong>æ²’æœ‰å‰å¾Œç¶´ï¼š</strong>ç›´æ¥è¿”å› <code>get2</code>ã€‚</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>ä»¥ä¸Šæƒ…æ³éƒ½æœƒå‚³é€²ï¼ˆå“ªæ€•æ˜¯ <code>undefined</code>ï¼‰äº”è¡Œåƒæ•¸ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ <code>generateOne</code> å‡½æ•¸é•·<a href="https://github.com/BoogeeDoo/hua/blob/09f1bc7eae14faaa9e881392d3811a6073d94b1c/lib/hua.js#L67-L83" target="_blank" rel="external">é€™æ¨£</a>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Hua.prototype.generateOne = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.options.prefix &amp;&amp; <span class="keyword">this</span>.options.suffix) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.options.prefix + <span class="keyword">this</span>.options.suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.options.prefix) &#123;</span><br><span class="line">        debug(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.options.prefix + randomName.names.get1(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.options.suffix) &#123;</span><br><span class="line">        debug(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]);</span><br><span class="line">        <span class="keyword">return</span> randomName.names.get1(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]) + <span class="keyword">this</span>.options.suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> randomName.names.get2(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="ç”Ÿæˆ_Count_å€‹èŠ±å">ç”Ÿæˆ Count å€‹èŠ±å</h4><p>é‚„è¨˜å¾— CLI çš„ <code>count</code> åƒæ•¸éº¼ï¼Ÿå› çˆ²çˆ²äº†æ–¹ä¾¿ï¼Œæˆ‘å€‘å¯ä»¥æ‰¹é‡ç”ŸæˆèŠ±åï¼Œæ‰€ä»¥å°±éœ€è¦ç”Ÿæˆ Count å€‹èŠ±åçš„å‡½æ•¸äº†ã€‚</p>
<p>å¯¦éš›ä¸Šå°±æ˜¯ä¸€å€‹å¾ªç’°èª¿ç”¨ <code>generateOne</code> çš„å‡½æ•¸è€Œå·²ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Hua.prototype.generate = <span class="function"><span class="keyword">function</span>(<span class="params">count</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!count) count = <span class="keyword">this</span>.options.count || <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        result.push(<span class="keyword">this</span>.generateOne());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="CLI_æ–‡ä»¶">CLI æ–‡ä»¶</h3><p>å‰›å‰›é‚£å€‹ <code>nomnom</code> è§£æå°±åœ¨é€™å€‹æ–‡ä»¶è£é¢ï¼Œç„¶å¾Œæ¥ä¸‹å»å°±æ˜¯å¯¦ä¾‹åŒ–ä¸€å€‹ <code>Hua</code> å°è±¡ï¼Œç„¶å¾Œç”Ÿæˆ <code>count</code> å€‹èŠ±åã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hua = <span class="keyword">new</span> Hua(opts);</span><br><span class="line"><span class="keyword">var</span> result = hua.generate();</span><br></pre></td></tr></table></figure>
<p>æœ€å¾ŒæŠŠèŠ±åè¼¸å‡ºä¾†å°±å¥½äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">" * "</span> + result[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ©‹è±†éº»è¢‹ï¼">æ©‹è±†éº»è¢‹ï¼</h4><blockquote>
<p>èªªå¥½çš„äº”è¡Œé¡è‰²å‘¢ï¼Ÿï¼</p>
</blockquote>
<p>å¥½åƒæ˜¯çš„å“¦ï¼Œæˆ‘å€‘è¦åœ¨è¼¸å‡ºä¹‹å‰çµ¦ <code>result</code> ä¸Šå€‹è‰²å…’ã€‚</p>
<p>éæ­· <code>result</code> è£é¢çš„èŠ±åæ¯å€‹å­—ï¼Œç²å–å®ƒçš„äº”è¡Œå±¬æ€§ï¼Œç„¶å¾Œæ¶®ä¸Šè‰²å…’ã€‚</p>
<p><code>chinese-random-name</code> æš´éœ²äº†å­—å…¸ä¸­æ¯å€‹å­—çš„äº”è¡Œå±¬æ€§ï¼Œåªéœ€è¦è³¦å€¼ä¸€ä¸‹å°±å¥½äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dict = <span class="built_in">require</span>(<span class="string">"chinese-random-name"</span>).names.dict;</span><br></pre></td></tr></table></figure>
<p>ç„¶å¾Œé€ä¸€å°æ¯”ã€‚æœ€å¾Œå°æ‡‰é‡‘æœ¨æ°´ç«åœŸçš„é¡è‰²å€¼åˆ†åˆ¥çˆ²ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> definedColors = [</span><br><span class="line">    <span class="number">220</span>, <span class="number">83</span>, <span class="number">26</span>, <span class="number">197</span>, <span class="number">59</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>220 çˆ²é»ƒè‰²ï¼Œä»£è¡¨é‡‘ï¼›83 çˆ²ç¶ è‰²ï¼Œä»£è¡¨æœ¨ï¼›26 è—è‰²ä»£è¡¨æ°´ï¼›197 ç´…è‰²ä»£è¡¨ç«ï¼›59 ç°è‰²ä»£è¡¨åœŸã€‚</p>
<p>å¦‚æœé‚£å€‹å­—ç„¡æ³•æ‰¾åˆ°å±¬æ€§ï¼Œå‰‡ä¸ä¸Šè‰²ï¼Œä¿æŒé»˜èªã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">result = result.map(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> withColor = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; wuxing.length; j++) &#123;</span><br><span class="line">            <span class="keyword">var</span> wx = wuxing[j];</span><br><span class="line">            <span class="keyword">if</span>(wx === <span class="string">" "</span>) &#123;</span><br><span class="line">                withColor += name[i];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(dict[wx].indexOf(name[i]) !== -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> color = <span class="keyword">new</span> Color(name[i]);</span><br><span class="line">                color.fgcolor = definedColors[j];</span><br><span class="line">                withColor += color.toString();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> withColor;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤æˆ‘å€‘çš„ CLI å°±å¯«å¥½äº†ï¼Œæœ€å¾Œåˆ¥å¿˜äº†åœ¨ <a href="https://github.com/BoogeeDoo/hua/blob/09f1bc7eae14faaa9e881392d3811a6073d94b1c/bin/hua" target="_blank" rel="external">hua</a> é€™å€‹ CLI æ–‡ä»¶é ‚éƒ¨åŠ ä¸Šä¸€å¥è©±ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env node</span></span><br></pre></td></tr></table></figure>
<p>é€™ä»£è¡¨åˆ°æ™‚å€™å¦‚æœè¦ <code>./hua</code> çš„æ™‚å€™é€™å€‹è…³æœ¬æ˜¯ç”¨ Node.js ä¾†è·‘çš„ã€‚</p>
<h2 id="æ”¶æ‹¾">æ”¶æ‹¾</h2><p>æœ¬ä¾†æƒ³å¥½å¥½å¯«ç¯‡èµ·èŠ±åçš„ç‰¢é¨·ï¼Œçµæœä¸çŸ¥ä¸è¦ºå¯«æˆäº†çµ¦åˆå¿ƒè€…çœ‹çš„åˆç´šæ•™ç¨‹äº†ï¼Œæ·šç›® ( â€¢Ì¥Ì Ë â€¢Ì€à¥‚ )</p>
<p>ä¸å«Œæ£„çš„å°±é€™éº¼çœ‹çœ‹å§ã€‚</p>
<p>æœ€å¾Œé€™è£çµ¦å‡ºæˆ‘å¯«å¥½çš„é€™å€‹ <code>hua</code> ç¨‹åºã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ [sudo] npm install -g huaming</span><br></pre></td></tr></table></figure>
<p>ç„¶å¾Œå°±èƒ½åœ¨å‘½ä»¤è¡Œä¸‹é¢è·‘äº†ï¼Œè·‘æ³•ä¸Šé¢å¹¾ç« æœ‰ä»‹ç´¹éã€‚å®ƒçš„ Repo åœ¨<a href="https://github.com/BoogeeDoo/hua" target="_blank" rel="external">é€™è£</a>ã€‚</p>
<p>æœ€å¾Œå¸Œæœ›é€™å€‹åŒ…åœ¨ä½ å€‘èµ·èŠ±åçš„æ™‚å€™é‚„çœŸæœ‰é‚£éº¼ä¸€ä¸Ÿä¸Ÿçš„ç”¨è™•ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="èµ·å› ">èµ·å› </h2><p>èµ·å› æ˜¯æˆ‘ä¸€å€‹å«ã€å°é¾ã€çš„å¥½åŸºå‹ç”±æ–¼æŸäº›åŸå› é›¢è·å»äº†ä¸€å®¶è·Ÿé˜¿é‡Œä¸€æ¨£æœ‰ç€ã€èŠ±åæ–‡åŒ–ã€çš„å…¬å¸ï¼Œæ–¼æ˜¯é–‹å§‹çˆ²èŠ±åçŠ¯æ„ã€‚</p>
<p>çµåˆä¹‹å‰å¦¹ç´™ã€å¼ç´“ã€åœ¨èµ·èŠ±åçš„æ™‚å€™ä¹Ÿé‡åˆ°äº†åŒæ¨£çš„å›°æ“¾ï¼Œæ–¼æ˜¯æ±ºå®šç”¨ Node.js å¯«å€‹ã€ä¸€æœ¬æ­£ç¶“äº‚èµ·èŠ±åã€çš„ç¨‹åº]]>
    </summary>
    
      <category term="èŠ±å" scheme="http://xcoder.in/tags/%E8%8A%B1%E5%90%8D/"/>
    
      <category term="é˜¿é‡Œå·´å·´" scheme="http://xcoder.in/tags/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Node.js å•“å‹•æ–¹å¼ï¼šä¸€é“é—œæ–¼å…¨å±€è®Šé‡çš„é¡Œç›®å¼•ç™¼çš„æ€è€ƒÂ·çºŒ]]></title>
    <link href="http://xcoder.in/2015/11/27/a-js-problem-about-global-continued/"/>
    <id>http://xcoder.in/2015/11/27/a-js-problem-about-global-continued/</id>
    <published>2015-11-27T06:36:27.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯ä¸Šæ–‡ã€Š<a href="https://xcoder.in/2015/11/26/a-js-problem-about-global/">Node.js å•“å‹•æ–¹å¼ï¼šä¸€é“é—œæ–¼å…¨å±€è®Šé‡çš„é¡Œç›®å¼•ç™¼çš„æ€è€ƒ</a>ã€‹çš„çºŒç« ã€‚</p>
<h2 id="åŸé¡Œå›é¡§">åŸé¡Œå›é¡§</h2><p>æˆ‘å€‘é‚„æ˜¯å…ˆå›é¡§ä¸‹åŸé¡Œå§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸Šé¡Œç”±æˆ‘å€‘è¦ªæ„›çš„<a href="http://f2e.souche.com/blog/author/wang-xing-long/" target="_blank" rel="external">å°é¾</a>ç«¥é‹ç™¼ç¾ä¸¦åœ¨æˆ‘å€‘çš„ 901 ç¾£è£æå•çš„ã€‚</p>
</blockquote>
<p>ä¸éåœ¨ä¸Šé¢ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘è¬›çš„æ˜¯åœ¨ REPL å’Œ <code>vm</code> ä¸­æœ‰ä»€éº¼äº‹æƒ…ï¼Œä½†æ˜¯ä¸¦æ²’æœ‰è§£é‡‹çˆ²ä»€éº¼åœ¨æ–‡ä»¶æ¨¡å¡Šçš„è¼‰å…¥å½¢å¼ä¸‹ï¼Œ<code>var</code> ä¸¦ä¸æœƒæ›è¼‰åˆ°å…¨å±€è®Šé‡å»ã€‚</p>
<p>å…¶å¯¦åŸå› å¾ˆç°¡å–®ï¼Œå¤§å®¶æ‡‰è©²ä¹Ÿéƒ½æ˜ç™½ï¼Œåœ¨ Node.js ä¸­ï¼Œæ¯å€‹æ–‡ä»¶ç›¸ç•¶æ–¼æ˜¯ä¸€å€‹é–‰åŒ…ï¼Œåœ¨ <code>require</code> çš„æ™‚å€™è¢«ç·¨è­¯åŒ…äº†èµ·ä¾†ã€‚</p>
<p>ä½†æ˜¯å…·é«”æ˜¯æ€éº¼æ¨£çš„å‘¢ï¼Ÿé›–ç„¶ç¶²ä¸Šä¹Ÿæœ‰å¾ˆå¤šç­”æ¡ˆï¼Œæˆ‘é‚„æ˜¯æ±ºå®šåœ¨é€™è£æŒ‰ä¸Šä¸€ç¯‡æ–‡ç« çš„å°¿æ€§ç¨å¾®è§£é‡‹ä¸€ä¸‹ã€‚</p>
<h2 id="åˆ†æ">åˆ†æ</h2><p>é¦–å…ˆæˆ‘å€‘é‚„æ˜¯å›åˆ°ä¸Šä¸€ç¯‡æ–‡ç« çš„ã€ŠNode REPL å•“å‹•çš„æ²™ç®±ã€‹ä¸€ç¯€ï¼Œè£é¢èªªäº†ç•¶å•“å‹• Node.js çš„æ™‚å€™æ˜¯ä»¥ <a href="https://github.com/nodejs/node/blob/dfee4e3712ac4673b5fc472a8f77ac65bdc65f87/src/node.js" target="_blank" rel="external">src/node.js</a> çˆ²å…¥å£çš„ã€‚</p>
<p>å¦‚æœä»¥ REPL çˆ²é€”å¾‘å•“å‹•çš„è©±æ˜¯ç›´æ¥å•“å‹•ä¸€å€‹ <code>vm</code>ï¼Œè€Œæ­¤æ™‚çš„æ‰€æœ‰æ ¹ç´šè®Šé‡éƒ½åœ¨æœ€é ‚ç´šçš„ä½œç”¨åŸŸä¸‹ï¼Œæ‰€ä»¥ä¸€å€‹ <code>var</code> è‡ªç„¶æœƒç¶å®šåˆ° <code>global</code> ä¸‹é¢äº†ã€‚</p>
<p>è€Œå¦‚æœæ˜¯ä»¥æ–‡ä»¶ï¼Œå³ <code>$ node foo.js</code> å½¢å¼å•“å‹•çš„è©±ï¼Œå®ƒå°±æœƒåŸ·è¡Œ src/node.js è£é¢çš„å¦ä¸€å¨æ¢ä»¶åˆ†æ”¯äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.argv[<span class="number">1</span>]) &#123;</span><br><span class="line">  <span class="comment">// make process.argv[1] into a full path</span></span><br><span class="line">  <span class="keyword">var</span> path = NativeModule.require(<span class="string">'path'</span>);</span><br><span class="line">  process.argv[<span class="number">1</span>] = path.resolve(process.argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Module = NativeModule.require(<span class="string">'module'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  startup.preloadModules();</span><br><span class="line">  <span class="keyword">if</span> (global.v8debug &amp;&amp;</span><br><span class="line">      process.execArgv.some(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arg.match(<span class="regexp">/^--debug-brk(=[0-9]*)?$/</span>);</span><br><span class="line">      &#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> debugTimeout = +process.env.NODE_DEBUG_TIMEOUT || <span class="number">50</span>;</span><br><span class="line">    setTimeout(Module.runMain, debugTimeout);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Main entry point into most programs:</span></span><br><span class="line">    Module.runMain();</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>å¾ä¸Šé¢çš„ä»£ç¢¼çœ‹å‡ºï¼Œåªè¦æ˜¯ä»¥ <code>$ node foo.js</code> å½¢å¼å•“å‹•çš„ï¼Œéƒ½æœƒç¶“æ­· <code>startup.preloadModules()</code> å’Œ <code>Module.runMain()</code> å…©å€‹å‡½æ•¸ã€‚</p>
<h3 id="startup-preloadModules()">startup.preloadModules()</h3><p>æˆ‘å€‘ä¾†çœ‹çœ‹<a href="https://github.com/nodejs/node/blob/dfee4e3712ac4673b5fc472a8f77ac65bdc65f87/src/node.js#L870" target="_blank" rel="external">é€™å€‹å‡½æ•¸</a>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">startup.preloadModules = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (process._preload_modules) &#123;</span><br><span class="line">    NativeModule.require(<span class="string">'module'</span>)._preloadModules(process._preload_modules);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯¦éš›ä¸Šå°±æ˜¯åŸ·è¡Œçš„ lib/module.js è£é¢çš„ <code>_preloadModules</code> å‡½æ•¸ï¼Œä¸¦ä¸”æŠŠé€™å€‹ <code>process._preload_modules</code> çµ¦å‚³é€²å»ã€‚ç•¶ç„¶ï¼Œå‰ææ˜¯æœ‰é€™å€‹ <code>process._preload_modules</code>ã€‚</p>
<h4 id="process-_preload_modules">process._preload_modules</h4><p>é€™å€‹ <code>process._preload_modules</code> æŒ‡çš„å°±æ˜¯ç•¶ä½ åœ¨ä½¿ç”¨ Node.js çš„æ™‚å€™ï¼Œå‘½ä»¤è¡Œè£é¢çš„ <code>--require</code> åƒæ•¸ã€‚</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">r, --<span class="keyword">require</span>         <span class="class"><span class="keyword">module</span> <span class="title">to</span> <span class="title">preload</span> (<span class="title">option</span> <span class="title">can</span> <span class="title">be</span> <span class="title">repeated</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>ä»£ç¢¼åœ¨ <a href="https://github.com/nodejs/node/blob/master/src/node.cc#L3306" target="_blank" rel="external">src/node.cc</a> è£é¢å¯è€ƒã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arg, <span class="string">"--require"</span>) == <span class="number">0</span> ||</span><br><span class="line">           <span class="built_in">strcmp</span>(arg, <span class="string">"-r"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* module = argv[index + <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> (module == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%s: %s requires an argument\n"</span>, argv[<span class="number">0</span>], arg);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  args_consumed += <span class="number">1</span>;</span><br><span class="line">  local_preload_modules[preload_module_count++] = module;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœé‡åˆ°äº† <code>--require</code> é€™å€‹åƒæ•¸ï¼Œå‰‡å°éœæ…‹è®Šé‡ <code>local_preload_modules</code> å’Œ <code>preload_module_count</code> åšè™•ç†ï¼ŒæŠŠé€™å€‹é åŠ è¼‰æ¨¡å¡Šè·¯å¾‘åŠ é€²å»ã€‚</p>
<p>å¾…åˆ°<a href="https://github.com/nodejs/node/blob/master/src/node.cc#L2933" target="_blank" rel="external">è¦ç”Ÿæˆ <code>process</code> é€™å€‹è®Šé‡çš„æ™‚å€™</a>ï¼Œå†æŠŠé åŠ è¼‰æ¨¡å¡Šçš„ä¿¡æ¯æ”¾åˆ° <code>process._preload_modules</code> è£é¢å»ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetupProcessObject</span><span class="params">(Environment* env,</span><br><span class="line">                        <span class="keyword">int</span> argc,</span><br><span class="line">                        <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span>* argv,</span><br><span class="line">                        <span class="keyword">int</span> exec_argc,</span><br><span class="line">                        <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span>* exec_argv)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (preload_module_count) &#123;</span><br><span class="line">    CHECK(preload_modules);</span><br><span class="line">    Local&lt;Array&gt; <span class="built_in">array</span> = Array::New(env-&gt;isolate());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; preload_module_count; ++i) &#123;</span><br><span class="line">      Local&lt;String&gt; module = String::NewFromUtf8(env-&gt;isolate(),</span><br><span class="line">                                                 preload_modules[i]);</span><br><span class="line">      <span class="built_in">array</span>-&gt;Set(i, module);</span><br><span class="line">    &#125;</span><br><span class="line">    READONLY_PROPERTY(process,</span><br><span class="line">                      <span class="string">"_preload_modules"</span>,</span><br><span class="line">                      <span class="built_in">array</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span>[] preload_modules;</span><br><span class="line">    preload_modules = <span class="literal">nullptr</span>;</span><br><span class="line">    preload_module_count = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€é‡è¦çš„å°±æ˜¯é€™å¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">READONLY_PROPERTY(process,</span><br><span class="line">                  <span class="string">"_preload_modules"</span>,</span><br><span class="line">                  <span class="built_in">array</span>);</span><br></pre></td></tr></table></figure>
<h4 id="require(â€˜moduleâ€™)-_preloadModules">require(â€˜moduleâ€™)._preloadModules</h4><p>ä¸Šé¢æˆ‘å€‘è¬›äº†é€™å€‹ <code>process._preload_modules</code>ï¼Œç„¶å¾Œç¾åœ¨æˆ‘å€‘èªªèªªæ˜¯å¦‚ä½•æŠŠ <code>$ node --require bar.js foo.js</code> çµ¦é åŠ è¼‰é€²å»çš„ã€‚</p>
<p>æ¥ä¸‹å»æˆ‘å€‘å°±è¦ç§»æ­¥åˆ° lib/module.js æ–‡ä»¶è£é¢å»äº†ã€‚</p>
<p>åœ¨<a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L496" target="_blank" rel="external">ç¬¬ 496 è¡Œå·¦å³</a>çš„åœ°æ–¹æœ‰é€™å€‹å‡½æ•¸ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Module._preloadModules = <span class="function"><span class="keyword">function</span>(<span class="params">requests</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(requests))</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Preloaded modules have a dummy parent module which is deemed to exist</span></span><br><span class="line">  <span class="comment">// in the current working directory. This seeds the search path for</span></span><br><span class="line">  <span class="comment">// preloaded modules.</span></span><br><span class="line">  <span class="keyword">var</span> parent = <span class="keyword">new</span> Module(<span class="string">'internal/preload'</span>, <span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    parent.paths = Module._nodeModulePaths(process.cwd());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.code !== <span class="string">'ENOENT'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  requests.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">    parent.require(request);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¤§æ¦‚æˆ‘å€‘èƒ½çœ‹åˆ°ï¼Œå°±æ˜¯ä»¥ <code>internal/preload</code> çˆ² ID çš„ Module å°è±¡ä¾†è¼‰å…¥é€™äº›é åŠ è¼‰æ¨¡å¡Šã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> parent = <span class="keyword">new</span> Module(<span class="string">'internal/preload'</span>, <span class="literal">null</span>);</span><br><span class="line">requests.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">  parent.require(request);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ ¹æ“šé€™å€‹å‡½æ•¸çš„è¨»é‡‹èªªæ˜ï¼Œé€™å€‹ Module å°è±¡æ˜¯ä¸€å€‹è™›æ“¬çš„ Module å°è±¡ï¼Œä¸»è¦æ˜¯è·Ÿéé åŠ è¼‰çš„é‚£äº›æ¨¡å¡Šçµ¦éš”é›¢æˆ–è€…å€åˆ¥é–‹ä¾†ï¼Œä¸¦ä¸”æä¾›ä¸€å€‹æ¨¡å¡Šæœç´¢è·¯å¾‘ã€‚</p>
<h3 id="Module-runMain()">Module.runMain()</h3><p>çœ‹å®Œä¸Šé¢çš„èªªæ˜ï¼Œæˆ‘å€‘æ¥ä¸‹å»çœ‹çœ‹ <code>Module.runMain()</code> å‡½æ•¸ã€‚</p>
<p>é€™å€‹å‡½æ•¸é‚„æ˜¯ä½æ–¼ <a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L455" target="_blank" rel="external">lib/module.js</a>  æ–‡ä»¶è£é¢ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Module.runMain = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Load the main module--the command line argument.</span></span><br><span class="line">  Module._load(process.argv[<span class="number">1</span>], <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">  <span class="comment">// Handle any nextTicks added in the first tick of the program</span></span><br><span class="line">  process._tickCallback();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘å€‘çœ‹åˆ°äº†å°±æ˜¯åœ¨é€™å¥è©±ä¸­ï¼ŒModule è¼‰å…¥äº† <code>process.argv[1]</code> ä¹Ÿå°±æ˜¯æ–‡ä»¶åï¼Œè‡ªæ­¤ä¸€ç™¼ä¸å¯æ”¶æ‹¾ã€‚</p>
<h4 id="Module-_load">Module._load</h4><p>é€™å€‹å‡½æ•¸ç›¸ä¿¡å¾ˆå¤šäººéƒ½çŸ¥é“å®ƒçš„ç”¨è™•äº†ï¼Œç„¡éå°±æ˜¯è¼‰å…¥æ–‡ä»¶ï¼Œä¸¦åŠ è¼‰åˆ°ä¸€å€‹é–‰åŒ…è£é¢ã€‚</p>
<p>é€™æ¨£ä¸€ä¾†åœ¨æ–‡ä»¶è£é¢ <code>var</code> å‡ºä¾†çš„è®Šé‡å°±ä¸åœ¨æ ¹ä½œç”¨åŸŸä¸‹é¢äº†ï¼Œæ‰€ä»¥ä¸æœƒç²˜åˆ° <code>global</code> è£é¢å»ã€‚å®ƒçš„ <code>this</code> å°±æ˜¯åŒ…èµ·ä¾†çš„é€™å€‹é–‰åŒ…äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Module._load = <span class="function"><span class="keyword">function</span>(<span class="params">request, parent, isMain</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> filename = Module._resolveFilename(request, parent);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">var</span> cachedModule = Module._cache[filename];</span><br><span class="line">  <span class="keyword">if</span> (cachedModule) &#123;</span><br><span class="line">    <span class="keyword">return</span> cachedModule.exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (NativeModule.nonInternalExists(filename)) &#123;</span><br><span class="line">    debug(<span class="string">'load native module %s'</span>, request);</span><br><span class="line">    <span class="keyword">return</span> NativeModule.require(filename);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">module</span> = <span class="keyword">new</span> Module(filename, parent);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isMain) &#123;</span><br><span class="line">    process.mainModule = <span class="built_in">module</span>;</span><br><span class="line">    <span class="built_in">module</span>.id = <span class="string">'.'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Module._cache[filename] = <span class="built_in">module</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>.load(filename);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç¢¼é¦–å…ˆæ˜¯æ ¹æ“šå‚³å…¥çš„æ–‡ä»¶åæ‰¾åˆ°çœŸçš„æ–‡ä»¶åœ°å€ï¼Œå°±æ˜¯æ‰€è¬‚çš„æœç´¢è·¯å¾‘äº†ã€‚æ¯”å¦‚ <code>require(&quot;foo&quot;)</code> å°±æœƒåˆ†åˆ¥å¾ <code>node_modules</code> è·¯å¾‘ç­‰ä¾æ¬¡æŸ¥æ‰¾ä¸‹ä¾†ã€‚</p>
<p>æˆ‘ç¶“å¸¸ Hack é€™å€‹ <code>_resolveFilename</code> å‡½æ•¸ä¾†ç°¡åŒ– <code>require</code> å‡½æ•¸ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ›æˆ‘ç”¨ <code>require(&quot;controller/foo&quot;)</code> å°±èƒ½ç›´æ¥æ‹¿åˆ° ./src/controller/foo.js æ–‡ä»¶ã€‚æœ‰èˆˆè¶£è¨è«–ä¸€ä¸‹é€™å€‹ç”¨æ³•çš„ç«¥é‹å¯ä»¥è½‰åˆ°æˆ‘çš„ <a href="https://gist.github.com/XadillaX/bc0e7c92925de0647477" target="_blank" rel="external">Gist</a> ä¸ŠæŸ¥çœ‹ Hack çš„ä¸€å€‹ Demoã€‚</p>
<p>ç¬¬äºŒæ­¥å°±æ˜¯æˆ‘å€‘å¸¸èªªçš„ç·©å­˜äº†ã€‚å¦‚æœé€™å€‹æ¨¡å¡Šä¹‹å‰åŠ è¼‰éï¼Œé‚£éº¼åœ¨ <code>Module._cache</code> ä¸‹é¢æœƒæœ‰å€‹ç·©å­˜ï¼Œç›´æ¥å»å–å°±æ˜¯äº†ã€‚</p>
<p>ç¬¬ä¸‰æ­¥å°±æ˜¯çœ‹çœ‹æ˜¯ä¸æ˜¯ <code>NativeModule</code>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (NativeModule.nonInternalExists(filename)) &#123;</span><br><span class="line">  debug(<span class="string">'load native module %s'</span>, request);</span><br><span class="line">  <span class="keyword">return</span> NativeModule.require(filename);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="NativeModule">NativeModule</h5><p>ä¹‹å‰çš„ä»£ç¢¼è£é¢å…¶å¯¦ä¹Ÿæ²’å°‘å‡ºç¾é€™å€‹ <code>NativeModule</code>ã€‚é‚£é€™å€‹ <code>NativeModule</code> åˆ°åº•æ˜¯å€‹ shenmegui å‘¢ï¼Ÿ</p>
<p>å…¶å¯¦å®ƒé‚„æ˜¯åœ¨ Node.js çš„å…¥å£ <a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/src/node.js#L886" target="_blank" rel="external">src/node.js</a> è£é¢ã€‚</p>
<p>å®ƒä¸»è¦ç”¨ä¾†åŠ è¼‰ Node.js çš„ä¸€äº›åŸç”Ÿæ¨¡å¡Šï¼Œæ¯”å¦‚èªª <code>NativeModule.require(&quot;child_process&quot;)</code> ç­‰ï¼Œä¹Ÿç”¨æ–¼ä¸€äº› <code>internal</code> æ¨¡å¡Šçš„è¼‰å…¥ï¼Œæ¯”å¦‚ <code>NativeModule.require(&quot;internal/repl&quot;)</code>ã€‚</p>
<p>ä¹‹å‰ä»£ç¢¼çš„é€™å€‹åˆ¤æ–·å°±æ˜¯èªªå¦‚æœåˆ¤æ–·è¦è¼‰å…¥çš„æ–‡ä»¶æ˜¯ä¸€å€‹åŸç”Ÿæ¨¡å¡Šï¼Œé‚£éº¼å°±ä½¿ç”¨ <code>NativeModule.require</code> ä¾†è¼‰å…¥ã€‚</p>
<h6 id="NativeModule-require">NativeModule.require</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">NativeModule.require = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (id == <span class="string">'native_module'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> NativeModule;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cached = NativeModule.getCached(id);</span><br><span class="line">  <span class="keyword">if</span> (cached) &#123;</span><br><span class="line">    <span class="keyword">return</span> cached.exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!NativeModule.exists(id)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'No such native module '</span> + id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  process.moduleLoadList.push(<span class="string">'NativeModule '</span> + id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> nativeModule = <span class="keyword">new</span> NativeModule(id);</span><br><span class="line"></span><br><span class="line">  nativeModule.cache();</span><br><span class="line">  nativeModule.compile();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> nativeModule.exports;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å…ˆçœ‹çœ‹æ˜¯å¦æ˜¯æœ¬èº«ï¼Œå†çœ‹çœ‹æ˜¯å¦è¢«ç·©å­˜ï¼Œç„¶å¾Œçœ‹çœ‹æ˜¯å¦åˆæ³•ã€‚æ¥ä¸‹å»å°±æ˜¯å¡«å…… <code>process.moduleLoadList</code>ï¼Œæœ€å¾Œè¼‰å…¥é€™å€‹åŸç”Ÿæ¨¡å¡Šã€ç·©å­˜ã€ç·¨è­¯ä¸¦è¿”å›ã€‚</p>
<blockquote>
<p>æœ‰èˆˆè¶£çš„åŒå­¸å¯ä»¥åœ¨ Node.js ä¸­è¼¸å‡º <code>process.moduleLoadList</code> çœ‹çœ‹ã€‚</p>
</blockquote>
<p>é€™å€‹ <code>compile</code> å¾ˆé‡è¦ã€‚</p>
<h6 id="NativeModule-prototype-compile">NativeModule.prototype.compile</h6><p>åœ¨ <code>NativeModule</code> ç·¨è­¯çš„éç¨‹ä¸­ï¼Œå¤§æ¦‚çš„æ­¥é©Ÿæ˜¯ç²å–ä»£ç¢¼ã€åŒ…è£¹ï¼ˆWrapï¼‰ä»£ç¢¼ï¼ŒæŠŠåŒ…è£¹çš„ä»£ç¢¼ <code>runInContext</code> ä¸€éå¾—åˆ°åŒ…è£¹å¥½çš„å‡½æ•¸ï¼Œç„¶å¾ŒåŸ·è¡Œä¸€éå°±ç®—è¼‰å…¥å¥½äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NativeModule.prototype.compile = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> source = NativeModule.getSource(<span class="keyword">this</span>.id);</span><br><span class="line">  source = NativeModule.wrap(source);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fn = runInThisContext(source, &#123; filename: <span class="keyword">this</span>.filename &#125;);</span><br><span class="line">  fn(<span class="keyword">this</span>.exports, NativeModule.require, <span class="keyword">this</span>, <span class="keyword">this</span>.filename);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.loaded = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘å€‘å¾€é€™å€‹ src/node.js æ–‡ä»¶é€™å€‹å‡½æ•¸çš„ä¸Šé¢å¹¾è¡Œçœ‹ä¸€ä¸‹ï¼Œå°±çŸ¥é“åŒ…è£¹ä»£ç¢¼æ˜¯æ€éº¼å›äº‹äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NativeModule.wrap = <span class="function"><span class="keyword">function</span>(<span class="params">script</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> NativeModule.wrapper[<span class="number">0</span>] + script + NativeModule.wrapper[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">NativeModule.wrapper = [</span><br><span class="line">  <span class="string">'(function (exports, require, module, __filename, __dirname) &#123;\n'</span>,</span><br><span class="line">  <span class="string">'\n&#125;);'</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>æ ¹æ“šä¸Šé¢çš„ä»£ç¢¼ï¼Œæˆ‘å€‘èƒ½çŸ¥é“çš„å°±æ˜¯æ¯”å¦‚æˆ‘å€‘ä¸€å€‹å…§ç½®æ¨¡å¡Šçš„ä»£ç¢¼æ˜¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="built_in">require</span>(<span class="string">"foo"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>é‚£éº¼åŒ…è£¹å¥½çš„ä»£ç¢¼å°‡æœƒæ˜¯é€™æ¨£å­çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="built_in">require</span>(<span class="string">"foo"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>é€™æ¨£ä¸€çœ‹å°±æ˜ç™½äº†é€™äº› <code>require</code>ã€<code>module</code>ã€<code>exports</code>ã€<code>__filename</code> å’Œ <code>__dirname</code> æ˜¯æ€éº¼ä¾†äº†å§ã€‚</p>
<p>ç•¶æˆ‘å€‘é€šé <code>var fn = runInThisContext(source, { filename: this.filename });</code> å¾—åˆ°äº†é€™å€‹åŒ…è£¹å¥½çš„å‡½æ•¸ä¹‹å¾Œï¼Œæˆ‘å€‘å°±æŠŠç›¸æ‡‰çš„åƒæ•¸å‚³é€²é€™å€‹é–‰åŒ…å‡½æ•¸å»åŸ·è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fn(<span class="keyword">this</span>.exports, NativeModule.require, <span class="keyword">this</span>, <span class="keyword">this</span>.filename);</span><br></pre></td></tr></table></figure>
<p>é€™å€‹ <code>this</code> å°±æ˜¯å°æ‡‰çš„é€™å€‹ <code>module</code>ï¼Œè‡ªç„¶é€™å€‹ <code>module</code> è£é¢å°±æœ‰å®ƒçš„ <code>exports</code>ï¼›<code>require</code> å‡½æ•¸å°±æ˜¯ <code>NativeModule.require</code>ã€‚</p>
<p>æ‰€ä»¥æˆ‘å€‘çœ‹åˆ°çš„åœ¨ <code>lib/*.js</code> æ–‡ä»¶è£é¢çš„é‚£äº› <code>require</code> å‡½æ•¸ï¼Œå¯¦éš›ä¸Šå°±æ˜¯åŒ…è£¹å¥½ä¹‹å¾Œçš„ä»£ç¢¼çš„ <code>NativeModule.require</code> äº†ã€‚</p>
<p>æ‰€ä»¥èªªå¯¦éš›ä¸Šé€™äº›å…§ç½®æ¨¡å¡Šå…§éƒ¨çš„æ ¹ä½œç”¨åŸŸä¸‹çš„ <code>var</code> å†æ€éº¼æ¨£é«˜ç´šä¹Ÿéƒ½æ˜¯åœ¨åŒ…è£¹å¥½çš„é–‰åŒ…è£é¢ <code>var</code>ï¼Œæ€éº¼çš„ä¹Ÿè·Ÿ <code>global</code> æ­ä¸ç€é‚Šã€‚</p>
<h6 id="å…§éƒ¨åŸç”Ÿæ¨¡å¡Š">å…§éƒ¨åŸç”Ÿæ¨¡å¡Š</h6><p>é€šéä¸Šé¢çš„è¿½æº¯æˆ‘å€‘çŸ¥é“äº†ï¼Œå¦‚æœæˆ‘å€‘åœ¨ä»£ç¢¼è£é¢ä½¿ç”¨ <code>require</code> çš„è©±ï¼Œæœƒå…ˆçœ‹çœ‹é€™å€‹æ¨¡å¡Šæ˜¯ä¸æ˜¯åŸç”Ÿæ¨¡å¡Šã€‚</p>
<p>ä¸éå›éé ­çœ‹ä¸€ä¸‹å®ƒçš„é€™å€‹åˆ¤æ–·æ¢ä»¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (NativeModule.nonInternalExists(filename)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœæ˜¯åŸç”Ÿæ¨¡å¡Šä¸¦ä¸”ä¸æ˜¯åŸç”Ÿå…§éƒ¨æ¨¡å¡Šçš„è©±ã€‚</p>
</blockquote>
<p>é‚£æ˜¯æ€éº¼å€åˆ†åŸç”Ÿæ¨¡å¡Šå’Œå…§éƒ¨åŸç”Ÿæ¨¡å¡Šå‘¢ï¼Ÿ</p>
<p>æˆ‘å€‘å†ä¾†çœ‹çœ‹é€™å€‹ <code>NativeModule.nonInternalExists(filename)</code> å‡½æ•¸ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NativeModule.nonInternalExists = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> NativeModule.exists(id) &amp;&amp; !NativeModule.isInternal(id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">NativeModule.isInternal = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> id.startsWith(<span class="string">'internal/'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸Šé¢çš„ä»£ç¢¼æ˜¯å»é™¤å„ç¨®é›œä¸ƒé›œå…«çš„æ¢ä»¶ä¹‹å¾Œçš„ä¸€ç¨®æƒ…æ³ï¼Œåˆ¥çš„æƒ…æ³é‚„è«‹å„ä½ç«¥é‹è‡ªè¡Œçœ‹ Node.js æºç¢¼ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯èªªæˆ‘å€‘åœ¨æˆ‘å€‘è‡ªå·±çš„ä»£ç¢¼è£é¢æ˜¯è«‹æ±‚ä¸åˆ° Node.js æºç¢¼è£é¢ <code>lib/internal/*.js</code> é€™äº›æ–‡ä»¶çš„â€”â€”å› çˆ²å®ƒå€‘è¢«ä¸Šé¢çš„é€™å€‹æ¢ä»¶åˆ†æ”¯çµ¦éæ¿¾äº†ã€‚ï¼ˆæ¯”å¦‚ <code>require(&quot;internal/module&quot;)</code> åœ¨è‡ªå·±çš„ä»£ç¢¼è£é¢æ˜¯ç„¡æ³•é‹è¡Œçš„ï¼‰</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> ä¸éæœ‰ä¸€å€‹ä¾‹å¤–ï¼Œé‚£å°±æ˜¯ <code>require(&quot;internal/repl&quot;)</code>ã€‚è©³æƒ…å¯ä»¥åƒè€ƒé€™å€‹ <a href="https://github.com/nodejs/node/issues/3393" target="_blank" rel="external">Issue</a> å’Œ<a href="https://github.com/nodejs/node/blob/9148114c93861359a502801499d4c26d0b761174/lib/module.js#L276-L277" target="_blank" rel="external">é€™æ®µä»£ç¢¼</a>ã€‚</p>
</blockquote>
<h5 id="Module-prototype-load">Module.prototype.load</h5><p>è§£é‡‹å®Œäº†ä¸Šé¢çš„ <code>NativeModule</code> ä¹‹å¾Œï¼Œæˆ‘å€‘è¦å°±ä¸Šé¢ <code>Module._load</code> è£é¢çš„ä¸‹ä¸€æ­¥ <code>module.load</code> ä¹Ÿå°±æ˜¯ <code>Module.prototype.load</code> åšè§£æäº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Module.prototype.load = <span class="function"><span class="keyword">function</span>(<span class="params">filename</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> extension = path.extname(filename) || <span class="string">'.js'</span>;</span><br><span class="line">  <span class="keyword">if</span> (!Module._extensions[extension]) extension = <span class="string">'.js'</span>;</span><br><span class="line">  Module._extensions[extension](<span class="keyword">this</span>, filename);</span><br><span class="line">  <span class="keyword">this</span>.loaded = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åšäº†ä¸€ç³»åˆ—æ“ä½œä¹‹å¾Œå¾—åˆ°äº†çœŸÂ·æ–‡ä»¶åï¼Œç„¶å¾Œåˆ¤æ–·ä¸€ä¸‹å¾Œç¶´ã€‚å¦‚æœæ˜¯ <code>&quot;.js&quot;</code> çš„è©±åŸ·è¡Œ <code>Module._extensions[&quot;.js&quot;]</code> é€™å€‹å‡½æ•¸å»ç·¨è­¯ä»£ç¢¼ï¼Œå¦‚æœæ˜¯ <code>&quot;.json&quot;</code> å‰‡æ˜¯ <code>Module._extensions[&quot;.json&quot;]</code>ã€‚</p>
<p>é€™è£æˆ‘å€‘ç•¥é JSON å’Œ C++ Addonï¼Œç›´å¥” <code>Module._extensions[&quot;.js&quot;]</code>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Module._extensions[<span class="string">'.js'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params">module, filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> content = fs.readFileSync(filename, <span class="string">'utf8'</span>);</span><br><span class="line">  <span class="built_in">module</span>._compile(internalModule.stripBOM(content), filename);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å®ƒä¹Ÿå¾ˆç°¡å–®ï¼Œå°±æ˜¯å¥”ç€ <code>_compile</code> å»çš„ã€‚</p>
<h6 id="Module-prototype-_compile">Module.prototype._compile</h6><p>å…ˆä¸Š<a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L378-L426" target="_blank" rel="external">ä»£ç¢¼</a>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Module.prototype._compile = <span class="function"><span class="keyword">function</span>(<span class="params">content, filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// remove shebang</span></span><br><span class="line">  content = content.replace(shebangRe, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> self.require(path);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">require</span>.resolve = <span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Module._resolveFilename(request, self);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">require</span>.main = process.mainModule;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Enable support to add extra extension types</span></span><br><span class="line">  <span class="built_in">require</span>.extensions = Module._extensions;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">require</span>.cache = Module._cache;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> dirname = path.dirname(filename);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create wrapper function</span></span><br><span class="line">  <span class="keyword">var</span> wrapper = Module.wrap(content);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> compiledWrapper = runInThisContext(wrapper,</span><br><span class="line">                                      &#123; filename: filename, lineOffset: -<span class="number">1</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> args = [self.exports, <span class="built_in">require</span>, self, filename, dirname];</span><br><span class="line">  <span class="keyword">return</span> compiledWrapper.apply(self.exports, args);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ„Ÿè¦ºæµç¨‹ä¸Šè·Ÿ <code>NativeModule</code> çš„ç·¨è­¯ç›¸ä¼¼ï¼Œä¸éé€™è£æ˜¯äº‹å…ˆæº–å‚™å¥½è¦åœ¨è¼‰å…¥çš„æ–‡ä»¶è£é¢ç”¨çš„ <code>require</code> å‡½æ•¸ï¼Œä»¥åŠä¸€äº› <code>require</code> çš„å‘¨é‚Šã€‚</p>
<p>æ¥ä¸‹å»å°±æ˜¯ç”¨ <code>Module.wrap</code> ä¾†åŒ…è£¹ä»£ç¢¼äº†ï¼ŒåŒ…è£¹å®Œä¹‹å¾ŒæŠŠå¾—åˆ°çš„å‡½æ•¸ç”¨åƒæ•¸ <code>self.exports, require, self, filename, dirname</code> å»åŸ·è¡Œä¸€éï¼Œå°±ç®—æ˜¯æ–‡ä»¶è¼‰å…¥å®Œç•¢äº†ã€‚</p>
<p>æœ€å¾Œå›åˆ°ä¹‹å‰è¼‰å…¥ä»£ç¢¼çš„é‚£ä¸€åˆ»ï¼ŒæŠŠè¼‰å…¥å®Œç•¢å¾—åˆ°çš„ <code>module.exports</code> å† <code>return</code> å‡ºå»å°±å¥½äº†ã€‚</p>
<h6 id="Module-wrap">Module.wrap</h6><p>é€™å€‹å°±ä¸ç”¨èªªäº†ã€‚</p>
<p>åœ¨ lib/module.js çš„<a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L46-L48" target="_blank" rel="external">æœ€é ‚ç«¯é™„è¿‘</a>æœ‰é€™éº¼å¹¾è¡Œä»£ç¢¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Module.wrapper = NativeModule.wrapper;</span><br><span class="line">Module.wrap = NativeModule.wrap;</span><br><span class="line">Module._debug = util.debuglog(<span class="string">'module'</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸€åˆ‡è±ç„¶é–‹æœ—äº†å§ã€‚</p>
<p>é€£ <code>NativeModule</code> çš„ä»£ç¢¼éƒ½é€ƒä¸é–‹è¢«ä¹‹å‰èªªçš„é–‰åŒ…æ‰€åŒ…è£¹ï¼Œé‚£éº¼ä½ è‡ªå·±å¯«çš„ JS æ–‡ä»¶ç•¶ç„¶ä¹Ÿæœƒè¢« <code>NativeModule.wrap</code> æ‰€åŒ…è£¹ã€‚</p>
<p>é‚£éº¼ä½ åœ¨ä»£ç¢¼æ ¹ä½œç”¨åŸŸç”³æ˜çš„å‡½æ•¸å¯¦éš›ä¸Šåœ¨é‹è¡Œæ™‚è£é¢å·²ç¶“è¢«ä¸€å€‹é–‰åŒ…çµ¦åŒ…ä½äº†ã€‚</p>
<p>ä»¥å‰å¯èƒ½å¾ˆå¤šåŒå­¸åªçŸ¥é“æ˜¯è¢«é–‰åŒ…åŒ…ä½äº†ï¼Œä½†æ˜¯åŒ…çš„æ–¹æ³•ã€æµç¨‹ä»Šå¤©ç®—æ˜¯è§£æäº†ä¸€éäº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>é€™å€‹ <code>var a</code> æ€éº¼ä¹Ÿä¸å¯èƒ½ç¶åˆ° <code>global</code> å»å•Šã€‚</p>
<h6 id="Module-prototype-require">Module.prototype.require</h6><p>é›–ç„¶æˆ‘å€‘ä¸Šé¢è¬›å¾—å·®ä¸å¤šäº†ï¼Œå¯èƒ½å¾ˆå¤šç«¥é‹ä¹Ÿå­ç…©äº†ã€‚</p>
<p>ä¸éè©²è¬›å®Œçš„é‚„æ˜¯å¾—è¬›å®Œã€‚</p>
<p>æˆ‘å€‘åœ¨æˆ‘å€‘è‡ªå·±æ–‡ä»¶ä¸­ç”¨çš„ <code>require</code> åœ¨ä¸Šä¸€ç¯€è£é¢æœ‰æåˆ°éï¼Œå‚³åˆ°æˆ‘å€‘é–‰åŒ…è£é¢çš„ <code>require</code> å¯¦éš›ä¸Šæ˜¯é•·é€™æ¨£çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> self.require(path);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å¯¦éš›ä¸Šå°±æ˜¯å€‹ <code>Module.prototype.require</code>ã€‚</p>
<p>æˆ‘å€‘å†çœ‹çœ‹<a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L362-L366" target="_blank" rel="external">é€™å€‹å‡½æ•¸</a>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Module.prototype.require = <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  assert(path, <span class="string">'missing path'</span>);</span><br><span class="line">  assert(<span class="keyword">typeof</span> path === <span class="string">'string'</span>, <span class="string">'path must be a string'</span>);</span><br><span class="line">  <span class="keyword">return</span> Module._load(path, <span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸‹å­åˆç¹å›åˆ°äº†æˆ‘å€‘ä¸€é–‹å§‹çš„ <code>Module._load</code>ã€‚</p>
<p>æ‰€ä»¥åŸºæœ¬ä¸Šå°±å·®ä¸å¤šåˆ°é€™éäº†ã€‚</p>
<h2 id="REPL_vs_æ–‡ä»¶å•“å‹•">REPL vs æ–‡ä»¶å•“å‹•</h2><p>æœ€å¾Œæˆ‘å€‘å†é»ä¸€ä¸‹ï¼Œæˆ–è€…èªªå›é¡§ä¸€ä¸‹å§ã€‚</p>
<p>REPL å•“å‹•çš„æ™‚å€™ Node.js æ˜¯é–‹äº†å€‹ <code>vm</code> ç›´æ¥è®“ä½ è·‘ï¼Œä¸¦æ²’æœ‰æŠŠä»£ç¢¼åŒ…åœ¨ä¸€å€‹é–‰åŒ…è£é¢ï¼Œæ‰€ä»¥å†æ ¹ä½œç”¨åŸŸä¸‹çš„è®Šé‡æœƒ <code>Biu</code> ä¸€ä¸‹è²¼åˆ° <code>global</code> ä¸­å»ã€‚</p>
<p>è€Œæ–‡ä»¶å•“å‹•çš„æ™‚å€™ï¼Œæœƒåšæœ¬æ–‡ä¸­èªªçš„ä¸€ç³»åˆ—äº‹æƒ…ï¼Œç„¶å¾Œå°±æœƒæŠŠå„æ–‡ä»¶éƒ½åŒ…åˆ°ä¸€å€‹é–‰åŒ…å»ï¼Œæ‰€ä»¥è®Šé‡å°±ç„¡æ³•é€šéé€™ç¨®æ–¹å¼ä¾†è²¼åˆ° <code>global</code> å»äº†ã€‚</p>
<p>ä¸éé€™ç¨®äºŒç¾©æ€§æœƒåœ¨ <code>&quot;use strict&quot;;</code> ä¸­æˆ›ç„¶è€Œæ­¢ã€‚</p>
<p>çæ„›ç”Ÿå‘½ï¼Œ<code>use strict</code>ã€‚</p>
<h2 id="å°çµ">å°çµ</h2><p>æœ¬æ–‡å¯èƒ½å¾ˆå¤šç«¥é‹çœ‹å®Œå¾Œæ‚”è¦ºå¾—å¾ˆå‘â€”â€”JS çˆ²ä»€éº¼æœ‰é‚£éº¼å¤šäºŒç¾©æ€§é‚£éº¼å‘å‘¢ã€‚</p>
<p>å…¶å¯¦ä¸ç„¶ï¼Œä¸»è¦æ˜¯å¯èƒ½å¾ˆå¤šäººå° Node.js åŸ·è¡Œçš„æ©Ÿåˆ¶ä¸æ˜¯å¾ˆç­è§£ã€‚</p>
<p>æœ¬æ–‡å¾å°é¾æ‹‹å‡ºçš„ä¸€å€‹ç°¡å–®å•é¡Œé€²å…¥ï¼Œç„¶å¾Œæ·ºå…¥æ·ºå‡º Node.js çš„ä¸€äº›åŸ·è¡Œæ©Ÿåˆ¶ä»€éº¼çš„ï¼Œå¸Œæœ›å°å¤§å®¶é‚„æ˜¯æœ‰é»å¹«åŠ©ï¼Œæ›´ä½•æ³æˆ‘åœ¨æ„çš„ä¸æ˜¯å•é¡Œæœ¬èº«ï¼Œè€Œæ˜¯åˆ†æçš„é€™å€‹éç¨‹ã€‚</p>
<h2 id="ç•ªå¤–">ç•ªå¤–</h2><blockquote>
<p>ä»¥ä¸‹å‡çˆ²è‡†æƒ³ã€‚</p>
<p><strong>å°é¾ï¼š</strong> å–‚å–‚å–‚ï¼Œæˆ‘å°±å•ä¸€å€‹ç°¡å–®çš„å°ç ´é¡Œç›®ï¼Œä½ è‡³æ–¼å˜›ï¼</p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<p>æœ¬æ–‡æ˜¯ä¸Šæ–‡ã€Š<a href="https://xcoder.in/2015/11/26/a-js-problem-about-global/">Node.js å•“å‹•æ–¹å¼ï¼šä¸€é“é—œæ–¼å…¨å±€è®Šé‡çš„é¡Œç›®å¼•ç™¼çš„æ€è€ƒ</a>ã€‹çš„çºŒç« ã€‚</p>
<h2 id="åŸé¡Œå›é¡§">åŸé¡Œå›é¡§</h2]]>
    </summary>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="REPL" scheme="http://xcoder.in/tags/REPL/"/>
    
      <category term="vm" scheme="http://xcoder.in/tags/vm/"/>
    
      <category term="æºç¢¼åˆ†æ" scheme="http://xcoder.in/tags/%E6%BA%90%E7%A2%BC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Node.js å•“å‹•æ–¹å¼ï¼šä¸€é“é—œæ–¼å…¨å±€è®Šé‡çš„é¡Œç›®å¼•ç™¼çš„æ€è€ƒ]]></title>
    <link href="http://xcoder.in/2015/11/26/a-js-problem-about-global/"/>
    <id>http://xcoder.in/2015/11/26/a-js-problem-about-global/</id>
    <published>2015-11-26T13:51:37.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="åŸé¡Œ">åŸé¡Œ</h2><p>ã€€ã€€é¡Œç›®æ˜¯é€™æ¨£çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸Šé¡Œç”±æˆ‘å€‘è¦ªæ„›çš„<a href="http://f2e.souche.com/blog/author/wang-xing-long/" target="_blank" rel="external">å°é¾</a>ç«¥é‹ç™¼ç¾ä¸¦åœ¨æˆ‘å€‘çš„ 901 ç¾£è£æå•çš„ã€‚</p>
</blockquote>
<h2 id="ç¶“é">ç¶“é</h2><p>ã€€ã€€ç„¶å¾Œæœ‰ä¸‹é¢çš„å°å°è©±ã€‚</p>
<blockquote>
<p><strong>å°é¾ï¼š</strong>ä½ å€‘çŒœé€™å€‹è¼¸å‡ºä»€éº¼ï¼Ÿ</p>
<p><strong>å¼ç´“ï¼š</strong>2</p>
<p><strong>åŠ›å”ï¼š</strong>2 å•Š</p>
<p><strong>æ­»æœˆÂ·çµ²å¡è•¾ç‰¹ï¼š</strong>2</p>
<p><strong>åŠ›å”ï¼š</strong>æœ‰ä»€éº¼å•é¡Œéº¼ï¼Ÿ</p>
<p><strong>å°é¾ï¼š</strong>è¼¸å‡º undefindã€‚</p>
<p><strong>æ­»æœˆÂ·çµ²å¡è•¾ç‰¹ï¼š</strong>ä½ ç¢ºå®šï¼Ÿ</p>
<p><strong>å°é¾ï¼š</strong>æ˜¯ä¸æ˜¯æˆ‘é›»è…¦å£äº†</p>
<p><strong>åŠ›å”ï¼š</strong>ä½ ç¢ºå®šï¼Ÿ</p>
<p><strong>å¼ç´“ï¼š</strong>ä½ ç¢ºå®šï¼Ÿ</p>
<p><strong>å°é¾ï¼š</strong>çˆ²ä»€éº¼æˆ‘ node æ–‡ä»¶åè·‘å‡ºä¾†çš„æ˜¯ undefinedï¼Ÿ</p>
<p><strong>é„­æ˜±ï¼š</strong>-.- ä¸€æ¨£é˜¿ã€‚undefined</p>
</blockquote>
<p>ã€€ã€€ä»¥ä¸Šå°±æ˜¯å‰›è¦‹åˆ°é€™å€‹é¡Œç›®çš„æ™‚å€™ç¾£è£çš„ä¸€å€‹å°è¨è«–ã€‚</p>
<h2 id="åˆ†æ">åˆ†æ</h2><p>ã€€ã€€å¾Œä¾†æˆ‘å°±è¦ºå¾—å¥‡æ€ªï¼Œæ—¢ç„¶å°é¾é©—è­‰éäº†ï¼Œèªªæ˜ä»–ä¹Ÿä¸æ˜¯éš¨åœ°å¤§å°ä¾¿ï¼Œç„¡çš„æ”¾çŸ¢ä»€éº¼çš„ã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯æˆ‘ä¹Ÿé©—è­‰äº†ä¸€ä¸‹ï¼Œä¸éç”±æ–¼å·æ‡¶ï¼Œæ²’æœ‰è·Ÿä»–å€‘ä¸€æ¨£å¯«åœ¨æ–‡ä»¶è£é¢ï¼Œè€Œæ˜¯ç›´æ¥ node é–‹äº†å€‹ REPL ä¾†è¼¸å…¥ä¸Šè¿°ä»£ç¢¼ã€‚</p>
<blockquote>
<p><strong>çµæœæ˜¯ 2ï¼</strong></p>
<p><strong>çµæœæ˜¯ 2ï¼</strong></p>
<p><strong>çµæœæ˜¯ 2ï¼</strong></p>
</blockquote>
<p>ã€€ã€€æ–¼æ˜¯é€™å°±å‡ºç¾äº†ä¸€å€‹å¾ˆå¥‡æ€ªçš„å•é¡Œã€‚</p>
<p>ã€€ã€€å°¼ç‘ªçˆ²æ¯›æˆ‘æ˜¯ <code>2</code> ä»–å€‘å€†æ˜¯ <code>undefined</code> å•Šï¼</p>
<p>ã€€ã€€ä¸éé¦¬ä¸Šæˆ‘å°±åæ‡‰éä¾†äº†â€”â€”æˆ‘å€‘å¹¾å€‹çš„ç’°å¢ƒä¸åŒï¼Œä»–å€‘æ˜¯ <code>$ node foo.js</code> è€Œæˆ‘æ˜¯ç›´æ¥ node é–‹äº†å€‹ REPLï¼Œæ‰€ä»¥æœ‰ä¸€å®šçš„å€åˆ¥ã€‚</p>
<p>ã€€ã€€è€ŒåŠ›å”æœ¬èº«å°±æ˜¯å‰ç«¯å¤§ç¥ï¼Œæˆ‘ä¼°è¨ˆæ˜¯ä»¥ Chrome çš„èª¿è©¦å·¥å…·ä¸‹çˆ²åŸºç¤å‡ºçš„ç­”æ¡ˆã€‚</p>
<h2 id="REPL_vs_æ–‡ä»¶åŸ·è¡Œ">REPL vs æ–‡ä»¶åŸ·è¡Œ</h2><p>ã€€ã€€å…¶å¯¦ä¸Šè¿°çš„å•é¡Œï¼Œéœ€è¦è§£é‡‹çš„å•é¡Œå¤§æ¦‚å°±æ˜¯ <code>a</code> åˆ°åº•æ›åœ¨å“ªäº†ã€‚</p>
<p>ã€€ã€€å› çˆ²ç´°ç´°ä¸€æƒ³ï¼Œåœ¨ <code>function</code> ç•¶ä¸­ï¼Œ<code>this</code> æŒ‡å‘çš„ç›®æ¨™æ˜¯ <code>global</code> æˆ–è€… <code>window</code>ã€‚</p>
<blockquote>
<p>é‚„ç„¡æ³•ç†è§£ä¸Šé¢é€™å¥è©±çš„ç«¥é‹éœ€è¦å…ˆè£œä¸€ä¸‹åŸºç¤ã€‚</p>
</blockquote>
<p>ã€€ã€€é‚£éº¼æœ€çµ‚éœ€è¦è§£é‡‹çš„å°±æ˜¯ <code>a</code> åˆ°åº•æœ‰æ²’æœ‰æ›åœ¨å…¨å±€è®Šé‡ä¸Šé¢ã€‚</p>
<p>ã€€ã€€é€™éº¼ä¸€æƒ³å°±æœ‰é»ç´°æ€ææ¥µçš„å‘³é“äº†â€”â€”å¦‚æœåœ¨ node ç·šä¸Šé‹è¡Œç’°å¢ƒè£é¢çš„æºä»£ç¢¼æ–‡ä»¶è£é¢éš¨ä¾¿ <code>var</code> ä¸€å€‹è®Šé‡å°±æ›åˆ°äº†å…¨å±€è®Šé‡è£é¢é‚£æ˜¯æœ‰å¤šææ€–ï¼</p>
<p>ã€€ã€€æ–¼æ˜¯å°±æœ‰äº›é‡‹ç„¶äº†ã€‚</p>
<p>ã€€ã€€ä½†ç©¶ç«Ÿæ˜¯ä»€éº¼åŸå› å°è‡´ REPL å’Œæ–‡ä»¶åŸ·è¡Œæ–¹å¼ä¸ä¸€æ¨£çš„å‘¢ï¼Ÿ</p>
<h3 id="å…¨å±€å°è±¡çš„å±¬æ€§">å…¨å±€å°è±¡çš„å±¬æ€§</h3><p>ã€€ã€€é¦–å…ˆæ˜¯å¼ç´“æ‰¾å‡ºäº†é˜®è€å¸« ES6 ç³»åˆ—æ–‡ç« ä¸­çš„<a href="http://es6.ruanyifeng.com/#docs/let" target="_blank" rel="external">å…¨å±€å°è±¡å±¬æ€§</a>ä¸€ç¯€ã€‚</p>
<blockquote>
<p>å…¨å±€å°è±¡æ˜¯æœ€é ‚å±¤çš„å°è±¡ï¼Œåœ¨ç€è¦½å™¨ç’°å¢ƒæŒ‡çš„æ˜¯ window è±¡ï¼Œåœ¨ Node.js æŒ‡çš„æ˜¯ global å°è±¡ã€‚ES5 ä¹‹ä¸­ï¼Œå…¨å±€å°è±¡çš„å±¬æ€§èˆ‡å…¨å±€è®Šé‡æ˜¯ç­‰åƒ¹çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.a = <span class="number">1</span>;</span><br><span class="line">a <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">window</span>.a <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç¢¼ä¸­ï¼Œå…¨å±€å°è±¡çš„å±¬æ€§è³¦å€¼èˆ‡å…¨å±€è®Šé‡çš„è³¦å€¼ï¼Œæ˜¯åŒä¸€ä»¶äº‹ã€‚ï¼ˆå°æ–¼Nodeä¾†èªªï¼Œé€™ä¸€æ¢åªå°REPLç’°å¢ƒé©ç”¨ï¼Œæ¨¡å¡Šç’°å¢ƒä¹‹ä¸­ï¼Œå…¨å±€è®Šé‡å¿…é ˆé¡¯å¼è²æ˜æˆglobalå°è±¡çš„å±¬æ€§ã€‚ï¼‰</p>
</blockquote>
<p>æœ‰äº†é˜®è€å¸«çš„æ–‡ç« é©—è­‰äº†é€™å€‹çŒœæƒ³ï¼Œæˆ‘å¯ä»¥æ”¾å¿ƒå¤§è†½ç¹¼çºŒçœ‹ä¸‹å»äº†ã€‚</p>
<h3 id="repl-js">repl.js</h3><p>ã€€ã€€çŸ¥é“äº†ä¸Šæ–‡çš„å…§å®¹ä¹‹å¾Œï¼Œæ„Ÿè¦ºé¦–è¦æŸ¥çœ‹çš„å°±æ˜¯ Node.js æºç¢¼ä¸­çš„ <a href="https://github.com/nodejs/node/blob/master/lib/repl.js#L513" target="_blank" rel="external">repl.js</a> äº†ã€‚</p>
<p>ã€€ã€€å…ˆæ˜¯çµåˆäº†ä¸€ä¸‹è‡ªå·±ä»¥å‰ç”¨è‡ªå®šç¾© REPL çš„æƒ…æ³ï¼Œä¸€èˆ¬çš„æ­¥é©Ÿå…ˆæ˜¯ç²å– REPL çš„ä¸Šä¸‹æ–‡ï¼Œç„¶å¾Œåœ¨ä¸Šä¸‹æ–‡è£é¢è²¼ä¸Šå„ç¨®è‡ªå·±éœ€è¦çš„æ±è¥¿ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> r = relp.start(<span class="string">" âœ "</span>);</span><br><span class="line"><span class="keyword">var</span> c = r.context;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ c è£é¢è²¼ä¸Šå„ç¨®ä¸Šä¸‹æ–‡</span></span><br><span class="line">c.foo = bar;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>é—œæ–¼è‡ªå®šç¾© REPL çš„ä¸€äº›ä½¿ç”¨æ–¹å¼å¯ä»¥åƒè€ƒä¸‹è€é›·å¯«çš„ã€Š<a href="https://cnodejs.org/topic/563735ed677332084c319d95" target="_blank" rel="external">Node.js å®šè£½ REPL çš„å¦™ç”¨</a>ã€‹ã€‚</p>
</blockquote>
<p>ã€€ã€€æœ‰äº†ä¹‹å‰å¯« REPL çš„ç¶“é©—ï¼Œå¤§è‡´æ˜ç™½äº† REPL è£é¢æœ‰å€‹ä¸Šä¸‹æ–‡çš„æ±è¥¿ï¼Œé‚£éº¼åœ¨ repl.js è£é¢æˆ‘å€‘ä¹Ÿæ‰¾åˆ°äº†é¡ä¼¼çš„ä»£ç¢¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">REPLServer.prototype.createContext = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> context;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.useGlobal) &#123;</span><br><span class="line">    context = global;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    context = vm.createContext();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> global) context[i] = global[i];</span><br><span class="line">    context.console = <span class="keyword">new</span> Console(<span class="keyword">this</span>.outputStream);</span><br><span class="line">    context.global = context;</span><br><span class="line">    context.global.global = context;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  context.module = <span class="built_in">module</span>;</span><br><span class="line">  context.require = <span class="built_in">require</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.lines = [];</span><br><span class="line">  <span class="keyword">this</span>.lines.level = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// make built-in modules available directly</span></span><br><span class="line">  <span class="comment">// (loaded lazily)</span></span><br><span class="line">  exports._builtinLibs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(context, name, &#123;</span><br><span class="line">      get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> lib = <span class="built_in">require</span>(name);</span><br><span class="line">        context._ = context[name] = lib;</span><br><span class="line">        <span class="keyword">return</span> lib;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// allow the creation of other globals with this name</span></span><br><span class="line">      set: <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> context[name];</span><br><span class="line">        context[name] = val;</span><br><span class="line">      &#125;,</span><br><span class="line">      configurable: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€çœ‹åˆ°äº†é—œéµå­— <code>vm</code>ã€‚æˆ‘å€‘æš«æ™‚å…ˆä¸ç®¡ <code>vm</code>ï¼Œå…‰å¾ä¸Šé¢çš„ä»£ç¢¼å¯ä»¥çœ‹å‡ºï¼Œ<code>context</code> è¦éº¼ç­‰æ–¼ <code>global</code>ï¼Œè¦éº¼å°±æ˜¯æŠŠ <code>global</code> ä¸Šé¢çš„æ‰€æœ‰æ±è¥¿éƒ½ç²˜éä¾†ã€‚</p>
<p>ã€€ã€€ç„¶å¾Œé †å¸¶ç€æŠŠå¿…é ˆçš„å…©å€‹ä¸åœ¨ <code>global</code> è£çš„å…©å€‹æ±è¥¿ <code>require</code> å’Œ <code>module</code> çµ¦å¼„éä¾†ã€‚</p>
<p>ã€€ã€€ä¸‹é¢çš„æ±è¥¿å°±ä¸éœ€è¦é‚£éº¼é—œå¿ƒäº†ã€‚</p>
<h3 id="VM">VM</h3><p>ã€€ã€€æ¥ä¸‹å»æˆ‘å€‘ä¾†è¬›è¬› <code>vm</code>ã€‚</p>
<p>ã€€ã€€VM æ˜¯ node ä¸­çš„ä¸€å€‹å…§ç½®æ¨¡å¡Šï¼Œå¯ä»¥åœ¨<a href="https://nodejs.org/dist/v4.2.2/docs/api/vm.html" target="_blank" rel="external">æ–‡æª”</a>ä¸­çœ‹åˆ°èªªæ˜å’Œä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>ã€€ã€€å¤§è‡´å°±æ˜¯å°‡ä»£ç¢¼é‹è¡Œåœ¨ä¸€å€‹æ²™ç®±ä¹‹å…§ï¼Œä¸¦ä¸”äº‹å…ˆè³¦äºˆå…¶ä¸€äº› <code>global</code> è®Šé‡ã€‚</p>
<p>ã€€ã€€è€ŒçœŸæ­£èµ·åˆ°ä¸Šè¿° <code>var</code> å’Œ <code>global</code> å€åˆ¥çš„å°±æ˜¯é€™å€‹ <code>vm</code> äº†ã€‚</p>
<p>ã€€ã€€<code>vm</code> ä¹‹ä¸­åœ¨æ ¹ä½œç”¨åŸŸï¼ˆä¹Ÿå°±æ˜¯æœ€å¤–å±¤ä½œç”¨åŸŸï¼‰ä¸­ä½¿ç”¨ <code>var</code> æ‡‰è©²æ˜¯è·Ÿåœ¨ç€è¦½å™¨ä¸­ä¸€æ¨£ï¼ŒæœƒæŠŠè®Šé‡ç²˜åˆ° <code>global</code>ï¼ˆç€è¦½å™¨ä¸­æ˜¯ <code>window</code>ï¼‰ä¸­å»ã€‚</p>
<p>ã€€ã€€æˆ‘å€‘å¯ä»¥è©¦è©¦é€™æ¨£çš„ä»£ç¢¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="built_in">require</span>(<span class="string">'vm'</span>);</span><br><span class="line"><span class="keyword">var</span> localVar = <span class="string">'initial value'</span>;</span><br><span class="line"></span><br><span class="line">vm.runInThisContext(<span class="string">'var localVar = "vm";'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'localVar: '</span>, localVar);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'global.localVar: '</span>, global.localVar);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å…¶è¼¸å‡ºçµæœæ˜¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localVar: initial value</span><br><span class="line">global.localVar: vm</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¦‚æ–‡æª”ä¸­æ‰€èªªï¼Œ<code>vm</code> çš„ä¸€ç³»åˆ—å‡½æ•¸ä¸­è·‘è…³æœ¬éƒ½ç„¡æ³•å°ç•¶å‰çš„å±€éƒ¨è®Šé‡é€²è¡Œè¨ªå•ã€‚å„å‡½æ•¸èƒ½è¨ªå•è‡ªå·±çš„ <code>global</code>ï¼Œè€Œ <code>runInThisContext</code> çš„ <code>global</code> èˆ‡ç•¶å‰ä¸Šä¸‹æ–‡çš„ <code>global</code> æ˜¯ä¸€æ¨£çš„ï¼Œæ‰€ä»¥èƒ½è¨ªå•ç•¶å‰çš„å…¨å±€è®Šé‡ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥å‡ºç¾ä¸Šè¿°çµæœä¹Ÿæ˜¯ç†æ‰€ç•¶ç„¶çš„äº†ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥åœ¨ <code>vm</code> ä¸­è·‘æˆ‘å€‘ä¸€é–‹å§‹æ‹‹å‡ºçš„å•é¡Œï¼Œç­”æ¡ˆè‡ªç„¶å°±æ˜¯ <code>2</code> äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="built_in">require</span>(<span class="string">"vm"</span>);</span><br><span class="line"><span class="keyword">var</span> sandbox = &#123;</span><br><span class="line">    <span class="built_in">console</span>: <span class="built_in">console</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vm.createContext(sandbox);</span><br><span class="line">vm.runInContext(<span class="string">"var a = 2;function foo()&#123;console.log(this.a);&#125;foo();"</span>, sandbox);</span><br></pre></td></tr></table></figure>
<h3 id="Node_REPL_å•“å‹•çš„æ²™ç®±">Node REPL å•“å‹•çš„æ²™ç®±</h3><p>ã€€ã€€æœ€å¾Œæˆ‘å€‘å†åªéœ€è¦é©—è­‰ä¸€ä»¶äº‹å°±èƒ½çœŸç›¸å¤§ç™½äº†ã€‚</p>
<p>ã€€ã€€å¹³æ™‚æˆ‘å€‘è‡ªå®šç¾©ä¸€å€‹ <code>repl.js</code> ç„¶å¾ŒåŸ·è¡Œ <code>$ node repl.js</code> çš„è©±æ˜¯æœƒå•“å‹•ä¸€å€‹ REPLï¼Œè€Œé€™å€‹ REPL æœƒå»èª¿ <code>vm</code>ï¼Œæ‰€ä»¥æœƒå‡ºç¾ <code>2</code> çš„ç­”æ¡ˆï¼›æˆ–è€…æˆ‘å€‘è‡ªå·±åœ¨ä»£ç¢¼è£é¢å¯«ä¸€å€‹ <code>vm</code> ç„¶å¾Œè·‘ä¹‹å‰çš„ä»£ç¢¼ï¼Œä¹Ÿæ˜¯ç†æ‰€ç•¶ç„¶å‡ºç¾ <code>2</code>ã€‚</p>
<p>ã€€ã€€é‚£éº¼æˆ‘å€‘å°±è¼¸å…¥ <code>$ node</code> ä¾†é€²å…¥çš„ REPL è·Ÿæˆ‘å€‘ä¹‹å‰è¬›çš„ REPL æ˜¯ä¸æ˜¯åŒä¸€å€‹æ±è¥¿å‘¢ï¼Ÿ</p>
<p>ã€€ã€€å¦‚æœæ˜¯çš„è©±ï¼Œä¸€åˆ‡å°±é‡‹ç„¶äº†ã€‚</p>
<p>ã€€ã€€é¦–å…ˆæˆ‘å€‘é€²å…¥åˆ° Node çš„å…¥å£æ–‡ä»¶â€”â€”C++ çš„ <code>int main()</code>ã€‚</p>
<p>ã€€ã€€å®ƒåœ¨ Node.js æºç¢¼ <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/src/node_main.cc#L45" target="_blank" rel="external">src/node_main.cc</a> ä¹‹ä¸­ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IOLBF, <span class="number">1024</span>);</span><br><span class="line">  <span class="keyword">return</span> node::Start(argc, argv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å°±åœ¨ä¸»å‡½æ•¸ä¸­åŸ·è¡Œäº† <code>node::Start</code>ã€‚è€Œé€™å€‹ <code>node::Start</code> åˆå­˜åœ¨ <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/src/node.cc#L4109" target="_blank" rel="external">src/node.cc</a> è£é¢ã€‚</p>
<p>ã€€ã€€ç„¶å¾Œåœ¨ <code>node::Start</code> è£é¢åˆèª¿ç”¨ <code>StartNodeInstance</code>ï¼Œåœ¨é€™è£é¢æ˜¯ <code>LoadEnvironment</code> å‡½æ•¸ã€‚</p>
<p>ã€€ã€€æœ€å¾Œåœ¨ <code>LoadEnvironment</code> ä¸­çœ‹åˆ°äº†å¹¾å¥é—œéµçš„èªå¥ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Local&lt;String&gt; script_name = FIXED_ONE_BYTE_STRING(env-&gt;isolate(), <span class="string">"node.js"</span>);</span><br><span class="line">Local&lt;Value&gt; f_value = ExecuteString(env, MainSource(env), script_name);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">Local&lt;Function&gt; f = Local&lt;Function&gt;::Cast(f_value);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">Local&lt;Object&gt; global = env-&gt;context()-&gt;Global();</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">Local&lt;Value&gt; arg = env-&gt;process_object();</span><br><span class="line">f-&gt;Call(global, <span class="number">1</span>, &amp;arg);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é‚„æœ‰é€™éº¼ä¸€æ®µé—œéµçš„è¨»é‡‹ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Now we call 'f' with the 'process' variable that we've built up with</span></span><br><span class="line"><span class="comment">// all our bindings. Inside node.js we'll take care of assigning things to</span></span><br><span class="line"><span class="comment">// their places.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// We start the process this way in order to be more modular. Developers</span></span><br><span class="line"><span class="comment">// who do not like how 'src/node.js' setups the module system but do like</span></span><br><span class="line"><span class="comment">// Node's I/O bindings may want to replace 'f' with their own function.</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä¹Ÿå°±æ˜¯èªªï¼Œå•“å‹• <code>node</code> çš„æ™‚å€™ï¼Œåœ¨åšäº†ä¸€äº›æº–å‚™ä¹‹å¾Œæ˜¯é–‹å§‹è¼‰å…¥åŸ·è¡Œ src æ–‡ä»¶å¤¾ä¸‹é¢çš„ <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/src/node.js" target="_blank" rel="external">node.js</a> æ–‡ä»¶ã€‚</p>
<p>ã€€ã€€åœ¨ <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/src/node.js#L92" target="_blank" rel="external">92 è¡Œ</a>é™„è¿‘æœ‰é‡å° <code>$ node foo.js</code> å’Œ <code>$ node</code> çš„åˆ¤æ–·å•“å‹•ä¸åŒçš„é‚è¼¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.argv[<span class="number">1</span>]) &#123;</span><br><span class="line">  <span class="comment">// make process.argv[1] into a full path</span></span><br><span class="line">  <span class="keyword">var</span> path = NativeModule.require(<span class="string">'path'</span>);</span><br><span class="line">  process.argv[<span class="number">1</span>] = path.resolve(process.argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Module = NativeModule.require(<span class="string">'module'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  startup.preloadModules();</span><br><span class="line">  <span class="keyword">if</span> (global.v8debug &amp;&amp;</span><br><span class="line">      process.execArgv.some(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arg.match(<span class="regexp">/^--debug-brk(=[0-9]*)?$/</span>);</span><br><span class="line">      &#125;)) &#123;</span><br><span class="line">    <span class="keyword">var</span> debugTimeout = +process.env.NODE_DEBUG_TIMEOUT || <span class="number">50</span>;</span><br><span class="line">    setTimeout(Module.runMain, debugTimeout);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Main entry point into most programs:</span></span><br><span class="line">    Module.runMain();</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> Module = NativeModule.require(<span class="string">'module'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process._forceRepl || NativeModule.require(<span class="string">'tty'</span>).isatty(<span class="number">0</span>)) &#123;</span><br><span class="line">    <span class="comment">// REPL</span></span><br><span class="line">    <span class="keyword">var</span> cliRepl = Module.requireRepl();</span><br><span class="line">    cliRepl.createInternalRepl(process.env, <span class="function"><span class="keyword">function</span>(<span class="params">err, repl</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€åœ¨ä¸Šè¿°ç¯€é¸ä»£ç¢¼çš„ç¬¬ä¸€å€‹ <code>else if</code> ä¸­ï¼Œå°±æ˜¯å° <code>$ node foo.js</code> é€™ç¨®æƒ…æ³é€²è¡Œè™•ç†äº†ï¼Œå†åšå®Œå„ç¨®åˆå§‹åŒ–ä¹‹å¾Œï¼Œä½¿ç”¨ <code>Module.runMain();</code> ä¾†é‹è¡Œå…¥å£ä»£ç¢¼ã€‚</p>
<p>ã€€ã€€ç¬¬äºŒå€‹ <code>else if</code> è£é¢å°±æ˜¯ <code>$ node</code> é€™ç¨®æƒ…æ³äº†ã€‚</p>
<p>ã€€ã€€æˆ‘å€‘åœ¨çµ‚ç«¯ä¸­æ‰“é–‹ <code>$ node</code> çš„æ™‚å€™ï¼ŒTTY é€šå¸¸æ˜¯é—œé€£ç€çš„ï¼Œæ‰€ä»¥ <code>require(&#39;tty&#39;).isatty(0)</code> çˆ² <code>true</code>ï¼Œä¹Ÿå°±æ˜¯èªªæœƒé€²åˆ°æ¢ä»¶åˆ†æ”¯ä¸¦ä¸”åŸ·è¡Œè£é¢çš„ <code>cliRepl</code> ç›¸é—œä»£ç¢¼ã€‚</p>
<p>ã€€ã€€æˆ‘å€‘é€²å…¥åˆ° <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/lib/module.js#L490" target="_blank" rel="external">lib/module.js</a> çœ‹çœ‹é€™å€‹ <code>Module.requireRepl</code> æ˜¯ä»€éº¼æ±è¥¿ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Module.requireRepl = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Module._load(<span class="string">'internal/repl'</span>, <span class="string">'.'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ‰€ä»¥æˆ‘å€‘é‚„æ˜¯å¾—è½‰å…¥ <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/lib/internal/repl.js#L23" target="_blank" rel="external">lib/internal/repl.js</a> ä¾†ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<p>ã€€ã€€ä¸Šé¢åœ¨ <code>node.js</code> è£é¢æˆ‘å€‘çœ‹åˆ°å®ƒåŸ·è¡Œäº†é€™å€‹ <code>cliRepl</code> çš„ <code>createInternalRepl</code> å‡½æ•¸ï¼Œå®ƒçš„å¯¦ç¾å¤§æ¦‚æ˜¯é€™æ¨£çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createRepl</span>(<span class="params">env, opts, cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  opts = opts || &#123;</span><br><span class="line">    ignoreUndefined: <span class="literal">false</span>,</span><br><span class="line">    terminal: process.stdout.isTTY,</span><br><span class="line">    useGlobal: <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  opts.replMode = &#123;</span><br><span class="line">    <span class="string">'strict'</span>: REPL.REPL_MODE_STRICT,</span><br><span class="line">    <span class="string">'sloppy'</span>: REPL.REPL_MODE_SLOPPY,</span><br><span class="line">    <span class="string">'magic'</span>: REPL.REPL_MODE_MAGIC</span><br><span class="line">  &#125;[<span class="built_in">String</span>(env.NODE_REPL_MODE).toLowerCase().trim()];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> repl = REPL.start(opts);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è½‰é ­ä¸€çœ‹é€™å€‹ lib/internal/repl.js é ‚ç«¯çš„æ¨¡å¡Šå¼•å…¥ï¼Œèµ«ç„¶çœ‹åˆ°ä¸€å¥è©±ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> REPL = <span class="built_in">require</span>(<span class="string">'repl'</span>);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€çœŸç›¸å¤§ç™½ã€‚</p>
<h2 id="å°çµ">å°çµ</h2><p>ã€€ã€€æœ€å¾Œå†æ¢³ç†ä¸€éã€‚</p>
<p>ã€€ã€€åœ¨æ–¼ Node.js çš„ <code>vm</code> è£é¢ï¼Œé ‚ç´šä½œç”¨åŸŸä¸‹çš„ <code>var</code> æœƒæŠŠè®Šé‡è²¼åˆ° <code>global</code> ä¸‹é¢ã€‚è€Œ REPL ä½¿ç”¨äº† <code>vm</code>ã€‚ç„¶å¾Œ <code>$ node</code> é€²å…¥çš„ä¸€å€‹æ¨¡å¼å°±æ˜¯ä¸€å€‹ç‰¹å®šåƒæ•¸ä¸‹é¢å•“å‹•çš„ä¸€å€‹ <code>REPL</code>ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥æˆ‘å€‘ä¸€é–‹å§‹æå‡ºçš„å•é¡Œè£é¢åœ¨ <code>$ node foo.js</code> æ¨¡å¼ä¸‹åŸ·è¡Œæ˜¯ <code>undefined</code>ï¼Œå› çˆ²ä¸åœ¨å…¨å±€è®Šé‡ä¸Šï¼Œä½†æ˜¯å•“ç”¨ <code>$ node</code> é€™ç¨® REPL æ¨¡å¼çš„æ™‚å€™å¾—åˆ°çš„çµæœæ˜¯ <code>2</code>ã€‚</p>
<h2 id="ç•ªå¤–">ç•ªå¤–</h2><blockquote>
<p><strong>å°é¾ï¼š</strong>æˆ‘ç”¨ node test.js è·‘å‡ºä¾†æ˜¯ <code>a: undefined</code>ï¼›é‚£æˆ‘æ‡‰è©²æ€éº¼ä¿®æ”¹â€œç’°å¢ƒâ€ï¼Œä¾†è®“ä»–è·‘å‡ºï¼š<code>a: 2</code> å‘¢ï¼Ÿ</p>
</blockquote>
<p>ã€€ã€€æ–¼æ˜¯æœ‰äº†ä¸Šé¢å¯«çš„é‚£æ®µä»£ç¢¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="built_in">require</span>(<span class="string">"vm"</span>);</span><br><span class="line"><span class="keyword">var</span> sandbox = &#123;</span><br><span class="line">    <span class="built_in">console</span>: <span class="built_in">console</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vm.createContext(sandbox);</span><br><span class="line">vm.runInContext(<span class="string">"var a = 2;function foo()&#123;console.log(this.a);&#125;foo();"</span>, sandbox);</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="åŸé¡Œ">åŸé¡Œ</h2><p>ã€€ã€€é¡Œç›®æ˜¯é€™æ¨£çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><]]>
    </summary>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="REPL" scheme="http://xcoder.in/tags/REPL/"/>
    
      <category term="vm" scheme="http://xcoder.in/tags/vm/"/>
    
      <category term="æºç¢¼åˆ†æ" scheme="http://xcoder.in/tags/%E6%BA%90%E7%A2%BC%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æˆ‘çˆ²ä»€éº¼è¦ä½¿ç”¨å“ˆå¸Œ]]></title>
    <link href="http://xcoder.in/2015/10/16/why-i-use-hash/"/>
    <id>http://xcoder.in/2015/10/16/why-i-use-hash/</id>
    <published>2015-10-16T06:52:06.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="ä»€éº¼æ˜¯å“ˆå¸Œï¼ˆHashï¼‰">ä»€éº¼æ˜¯å“ˆå¸Œï¼ˆHashï¼‰</h2><p>æœ¬ä¾†é€™è£ä¸æ‡‰è©²å‡ºç¾é€™ä¸€ç¯€çš„ï¼Œå› çˆ²å¯¦éš›ä¸Šå¤§å®¶æ‡‰è©²éƒ½çŸ¥é“ä»€éº¼æ˜¯å“ˆå¸Œã€‚ä¸éæœ‰æ™‚å€™çˆ²äº†æ–‡ç« çš„å®Œæ•´æ€§ï¼Œæˆ‘é€™è£å°±ç¨å¾®æ•™æ¢æ€§åœ°èªªæ˜ä¸€ä¸‹å§ã€‚ãƒ½(Ìâ—•â—à±ªâ—Ÿâ—•â€µ)ï¾‰</p>
<blockquote>
<p>æ•£åˆ—ï¼ˆè‹±èªï¼šHashingï¼‰ï¼Œé€šå¸¸éŸ³è­¯ä½œå“ˆå¸Œï¼Œæ˜¯é›»è…¦ç§‘å­¸ä¸­ä¸€ç¨®å°è³‡æ–™çš„è™•ç†æ–¹æ³•ï¼Œé€šéæŸç¨®ç‰¹å®šçš„å‡½æ•¸ã€ç®—æ³•å°‡è¦æª¢ç´¢çš„é …èˆ‡ç”¨ä¾†æª¢ç´¢çš„ç´¢å¼•é—œè¯èµ·ä¾†ï¼Œç”Ÿæˆä¸€ç¨®ä¾¿æ–¼æœç´¢çš„æ•¸æ“šçµæ§‹ã€‚ä¹Ÿè­¯çˆ²æ•£åˆ—ã€‚</p>
<p style="text-align: right;">â€“ From <a href="https://zh.wikipedia.org/wiki/%E6%95%A3%E5%88%97" target="_blank">æ•£åˆ—</a>, Wikipedia</p>

</blockquote>
<p>å¯¦éš›ä¸Šé€šä¿—çš„èªªæ³•å°±æ˜¯æŠŠæŸç¨®ç‹€æ…‹æˆ–è€…è³‡æ–™çµ¦æ˜ å°„åˆ°æŸå€‹å€¼ä¸Šçš„æ“ä½œã€‚</p>
<p>æœ¬é†¬å¤§æ¦‚å°±è§£é‡‹åˆ°é€™è£äº†ï¼Œè‡³æ–¼å“ˆå¸Œçš„é€²ä¸€æ­¥èªçŸ¥åŒ…æ‹¬è¡çªçš„ç”¢ç”Ÿå’Œè§£æ±ºç­‰ï¼Œå¦‚æœç±³å¨œæ¡‘ä¸ç­è§£çš„è©±é‚„è«‹è‡ªè¡Œå­¸ç¿’å’•ã€‚à°¥à±ªà°¥</p>
<h2 id="å¼•å­â€”â€”å­æ¨¹å•é¡Œ">å¼•å­â€”â€”å­æ¨¹å•é¡Œ</h2><p>é€™å€‹ä¸æ˜¯æˆ‘åœ¨å¯¦è¸ä¸­é‡åˆ°çš„å•é¡Œï¼Œè€Œæ˜¯ç•¶å¹´å»æŸä¸ä½œæƒ¡çš„å¤§å» é¢è©¦æ™‚å€™é‡åˆ°çš„å•é¡Œï¼Œè¦ºå¾—æ¯”è¼ƒç¶“å…¸ï¼Œæ‰€ä»¥å°±æ‹¿å‡ºä¾†äº†ã€‚á•™à¼¼àºˆÙ„Íœàºˆà¼½á•—</p>
<h3 id="å•é¡Œæè¿°">å•é¡Œæè¿°</h3><p>çµ¦å®šä¸€æ£µäºŒå‰æ¨¹ï¼Œå‡è¨­æ¯å€‹ç¯€é»çš„æ•¸æ“šåªæœ‰å·¦å³å­ç¯€é»ï¼Œè‡ªèº«ä¸¦ä¸å­˜å„²æ•¸æ“šã€‚è«‹æ‰¾å‡ºå…©å…©å®Œå…¨ç›¸ç­‰çš„å­æ¨¹å€‘ã€‚</p>
<blockquote>
<p>æœ‰èˆˆè¶£çš„ç«¥é‹å¯ä»¥è‡ªå·±å…ˆæ€è€ƒä¸€ä¸‹ã€‚â‚â‚â—(ï½¥â€™Ï‰â€™ï½¥)â—Ÿâ¾â¾ </p>
</blockquote>
<h3 id="æˆ‘çš„åšæ³•">æˆ‘çš„åšæ³•</h3><p>å¯¦éš›ä¸Šæˆ‘ä¹Ÿä¸çŸ¥é“è‡ªå·±çš„åšæ³•æ˜¯ä¸æ˜¯æ­£ç¢ºåšæ³•ï¼Œä¸éæ—¢ç„¶é€šéäº†é‚£ä¸€è¼ªé¢è©¦ï¼Œæƒ³ä¾†ä¹Ÿä¸æœƒåå·®åˆ°å“ªå»å–µã€‚áƒšï¼ˆâ•¹Îµâ•¹áƒšï¼‰</p>
<p>åšæ³•å¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<ol>
<li><a href="https://zh.wikipedia.org/wiki/%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86#.E5.90.8E.E5.BA.8F.E9.81.8D.E5.8E.86" target="_blank" rel="external">å¾Œåºéæ­·</a>ä¸€éæ•´æ£µæ¨¹ã€‚</li>
<li>å°æ–¼éæ­·åˆ°æ¯ä¸€å€‹ç¯€é»ï¼Œéƒ½ç²å–åˆ°å·¦å³å­ç¯€é»çš„å“ˆå¸Œå€¼ï¼Œç„¶å¾Œå°‡å…¶æ‹¼æ¥é‡æ–°è¨ˆç®—å‡ºè‡ªèº«çš„å“ˆå¸Œå€¼ï¼Œä¸¦è¿”å›çµ¦çˆ¶è¦ªç¯€é»ã€‚</li>
</ol>
<p>è‡³æ–¼å“ˆå¸Œå€¼æ€éº¼ç®—ï¼Œæ–¹æ³•æœ‰å¾ˆå¤šã€‚æœ€ç°¡å–®çš„å°±æ˜¯è¨­è‘‰å­ç¯€é»ä¸€å€‹å“ˆå¸Œå€¼ï¼Œæ¯”å¦‚æ˜¯ <code>md5(&quot;&quot;)</code>ï¼Œç„¶å¾Œæ¯æ¬¡éè‘‰å­ç¯€é»çš„å“ˆå¸Œå€¼å°±ç”¨ <code>md5(LEFT_HASH + RIGHT_HASH)</code> ä¾†è¨ˆç®—ã€‚å¤§å®¶ä¹Ÿå¯ä»¥è‡ªå·±éš¨ä¾¿æƒ³ä¸€ç¨®æ–¹æ³•ä¾†åšå°±å¥½äº†ã€‚</p>
<p>å¾ˆå¤šäººå¯èƒ½ä¸è§£äº†ï¼Œæ˜æ˜æ˜¯ç”¨ <code>md5</code>ï¼Œé€™ç¯‡æ–‡ç« æ˜¯è¬›å“ˆå¸Œï¼Œæœ‰æ¯›ç·šé—œä¿‚ã€‚(â•¯Â°OÂ°)â•¯â”»â”â”»</p>
<p>å¯¦éš›ä¸Š <code>md5</code> å°±æ˜¯ä¸€ç¨®å“ˆå¸Œç®—æ³•ï¼Œè€Œä¸”æ˜¯éå¸¸ç¶“å…¸çš„å“ˆå¸Œç®—æ³•ã€‚</p>
<blockquote>
<p>å…¸å‹çš„å“ˆå¸Œç®—æ³•åŒ…æ‹¬ MD2ã€MD4ã€MD5 å’Œ SHA-1 ç­‰ã€‚ç•¶ç„¶ä¸ä¾·é™æ–¼é€™äº›ï¼Œå°æ–¼æ•¸å­—ä¾†èªªï¼Œå–æ¨¡ä¹Ÿç®—æ˜¯å“ˆå¸Œç®—æ³•ï¼Œå°æ–¼å­—ç¬¦ä¸²ç‹€æ…‹è½‰æ•´æ•¸ç‹€æ…‹å“ˆå¸Œä¾†èªªé‚„æœ‰è«¸å¦‚ <a href="http://www.partow.net/programming/hashfunctions/#BKDRHashFunction" target="_blank" rel="external">BKDR</a>ã€<a href="http://www.partow.net/programming/hashfunctions/#ELFHashFunction" target="_blank" rel="external">ELF</a> ç­‰ç­‰ã€‚</p>
</blockquote>
<p>å¦‚æœå¤§å®¶æƒ³å¤šç­è§£ä¸€äº›å­—ç¬¦ä¸²è½‰æ•¸å­—å“ˆå¸Œçš„ç®—æ³•ï¼Œå¯ä»¥åƒè€ƒä¸€ä¸‹ BYVoid çš„é€™ç¯‡ã€Š<a href="https://www.byvoid.com/blog/string-hash-compare/" target="_blank" rel="external">å„ç¨®å­—ç¬¦ä¸²Hashå‡½æ•¸æ¯”è¼ƒ</a>ã€‹ï¼Œæˆ–è€…æƒ³ç›´æ¥åœ¨ Node.js è£é¢ä½¿ç”¨çš„å°å¤¥ä¼´å€‘å¯ä»¥å…‰é¡§ä¸‹é€™å€‹åŒ…â€”â€”<a href="https://github.com/XadillaX/bling_hashes" target="_blank" rel="external">bling-hashes</a>ã€‚</p>
<p>åˆæ­¥çš„è¼ªå»“å·²ç¶“æ˜æ™°äº†ï¼Œèªªç™½äº†å°±æ˜¯å°‡æ¯å€‹ç¯€é»çš„å“ˆå¸Œå…¨ç®—å‡ºä¾†ï¼Œå¦‚æœæ˜¯çˆ¶è¦ªç¯€é»å°±ç”¨å­ç¯€é»çš„å“ˆå¸Œæ‹¼æ¥èµ·ä¾†å†å“ˆå¸Œä¸€éã€‚Ïƒ`âˆ€Â´)Ïƒ</p>
<p>æŠŠé€™äº›å“ˆå¸Œç®—å‡ºä¾†ä¹‹å¾Œæ”¾åœ¨ä¸€å€‹æ•£åˆ—è¡¨è£é¢å¾…æŸ¥ã€‚å¦‚æœä¸€å€‹ç®—å‡ºä¾†çš„å“ˆå¸Œè·Ÿä¹‹å‰å·²æœ‰çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œé‚£éº¼å°±æ˜¯èªªé€™å€‹ç¯€é»è·Ÿé‚£å€‹ç¯€é»çˆ²æ ¹ç¯€é»çš„å­æ¨¹æœ‰å¯èƒ½å®Œå…¨ç›¸ç­‰ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š<strong>æœ‰å¯èƒ½</strong>å®Œå…¨ç›¸ç­‰ã€‚</p>
<p>æ³¨æ„ï¼šåªæ˜¯<strong>æœ‰å¯èƒ½</strong>å®Œå…¨ç›¸ç­‰ã€‚</p>
<p>æ³¨æ„ï¼šé‡è¦çš„äº‹æƒ…èªªä¸‰éï¼Œåªæ˜¯<strong>æœ‰å¯èƒ½</strong>å®Œå…¨ç›¸ç­‰ã€‚</p>
</blockquote>
<p>å“ˆå¸Œæ˜¯å­˜åœ¨ç€ä¸€å®šçš„è¡çªæ¦‚ç‡çš„ï¼Œæ‰€ä»¥èªªå…©å€‹ç›¸ç­‰çš„å“ˆå¸Œæ‰€æª¢ç´¢åˆ°çš„æºä¸ä¸€å®šä¸€æ¨£ï¼Œæ‰€ä»¥æˆ‘å€‘æ ¹æ“šé€™äº›è¨ˆç®—åˆ°çš„å“ˆå¸Œå»ºç«‹å“ˆå¸Œè¡¨ï¼Œç„¶å¾ŒæŠŠè¡¨ä¸­åŒå“ˆå¸Œå€¼çš„å­æ¨¹å†å…©å…©åŒæ™‚éæ­·ä¸€éä»¥æª¢é©—æ˜¯å¦ç›¸ç­‰ã€‚</p>
<ol>
<li>åŒæ™‚éæ­¸ï¼Œå–å…©å€‹å­æ¨¹çš„æ ¹ç¯€é»ã€‚</li>
<li>å¾Œåºéæ­·ï¼Œçœ‹çœ‹æ¯å€‹ç¯€é»æ˜¯ä¸æ˜¯éƒ½ä¸€æ¨£å­˜åœ¨ï¼ˆæˆ–è€…ä¸å­˜åœ¨ï¼‰å·¦å­ç¯€é»ä»¥åŠå­˜åœ¨ï¼ˆæˆ–è€…ä¸å­˜åœ¨ï¼‰å³å­ç¯€é»ã€‚</li>
<li>å¾ªç’°å¾€å¾©ä¸€ç›´åˆ°å…©å…©éæ­·å®Œæ•´æ£µæ¨¹å¾—åˆ°é©—è­‰çµæœã€‚å¦‚æœåŠè·¯æœ‰ä¸€å€‹ç¯€é»çš„å·¦å³å­ç¯€é»ç‹€æ…‹ä¸ä¸€æ¨£å°±å¯ä»¥ç›´æ¥è·³å‡ºéæ­¸è¿”å› <code>false</code>ã€‚</li>
</ol>
<p>è‡³æ­¤çˆ²æ­¢ï¼Œæˆ‘å€‘å¯ä»¥çœ‹å‡ºå¤§æ¦‚æ˜¯å…©å¤§æ­¥â€”â€”<strong>è¨ˆç®—å„å­æ¨¹çš„å“ˆå¸Œå€¼</strong>å’Œ<strong>é©—è­‰å„åŒå“ˆå¸Œå­æ¨¹çš„ç›¸ç­‰æ€§</strong>ã€‚ä¸éç¨å¾®è®Šé€šä¸€ä¸‹ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨è¨ˆç®—å‡ºå“ˆå¸Œå€¼çš„æ™‚å€™å°±å»è·Ÿä»¥å‰çš„å°æ¯”äº†ã€‚</p>
<h4 id="å‰ªæ">å‰ªæ</h4><p>å¯¦éš›ä¸Šä¸Šé¢çš„åšæ³•é‚„æœ‰ä¸€å€‹å„ªåŒ–çš„æ–¹æ¡ˆï¼Œä¸éè·Ÿå“ˆå¸Œç›¸é—œæ€§å·²ç¶“åŸºæœ¬ä¸Šå¾ˆå°äº†ã€‚ä¸éé‚„æ˜¯è·Ÿ<strong>è§£æ±ºè¡çª</strong>æœ‰ä¸€ä¸Ÿä¸Ÿçš„é—œä¿‚çš„ï¼Œæ²’èˆˆè¶£çš„ç«¥é‹ä¹Ÿå¯ä»¥ç›´æ¥è·³éäº†ã€‚(à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘)</p>
<p>ç”±æ–¼å­æ¨¹å“ˆå¸Œå€¼æ˜¯å­˜åœ¨ä¸€å®šçš„è¡çªæ¦‚ç‡çš„ï¼Œæ‰€ä»¥å…©å€‹åŒå“ˆå¸Œçš„å­æ¨¹ä¸ä¸€å®šç›¸åŒã€‚é‚£éº¼æˆ‘å€‘å¦‚æœèƒ½ä¸€çœ¼çœ‹å‡ºé€™æ¨£çš„å…©æ£µå­æ¨¹æ˜¯ä¸ç›¸ç­‰çš„ï¼Œå°±å¯ä»¥çœç•¥é©—è­‰é€™ä¸€å€‹éæ­¸çš„æ­¥é©Ÿäº†ã€‚</p>
<p>é€™è£æœ‰ä¸€ç¨®æœ€é¡¯è€Œæ˜“è¦‹çš„æƒ…æ³æˆ‘å€‘æ˜¯å¯ä»¥å¿½ç•¥çœç•¥æ­¥é©Ÿçš„ï¼Œé‚£å°±æ˜¯æ·±åº¦ã€‚</p>
<p>å¦‚æœå…©æ£µå­æ¨¹å…©å…©å®Œå…¨ç›¸ç­‰ï¼Œé‚£éº¼èªªæ˜é€™å€†åŸºä½¬çš„æ·±åº¦ï¼ˆæˆ–è€…èªªé«˜åº¦ï¼‰æ˜¯ä¸€æ¨£çš„ï¼Œå¦‚æœé€£æ·±åº¦éƒ½ä¸ä¸€æ¨£äº†é‚„å¦‚ä½•æ„‰å¿«æåŸºâ€”â€”æ‰€ä»¥èªªå¦‚æœæœ‰å…©å€‹ç›¸ç­‰å“ˆå¸Œå€¼çš„å­æ¨¹çš„æ·±åº¦ä¸ä¸€æ¨£çš„è©±å¯ä»¥ç›´æ¥ç•¥éé©—è­‰æ­¥é©Ÿäº†ã€‚</p>
<p>é‚£éº¼å°±å¯ä»¥é€™éº¼åšï¼š</p>
<ol>
<li>è¨­æ‰€æœ‰è‘‰å­ç¯€é»çš„æ·±åº¦çˆ² <code>0</code>ï¼Œç„¶å¾Œæ¯å¾€ä¸Šä¸€å±¤åŠ ä¸€ã€‚</li>
<li>é‡åˆ°å·¦å³å­ç¯€é»æ·±åº¦ä¸ä¸€æ¨£çš„çˆ¶ç¯€é»æ™‚ï¼Œå–æ·±åº¦å¤§çš„é‚£å€‹å­ç¯€é»æ·±åº¦å»åŠ ä¸€ã€‚</li>
</ol>
<p>ä»¥ä¸Šæ­¥é©Ÿåœ¨éæ­·è¨ˆç®—å“ˆå¸Œçš„æ™‚å€™é †ä¾¿ä¹Ÿåšäº†ï¼Œé€™æ¨£å°±å¤šäº†ä¸€å€‹é©—è­‰æ¨™è¨˜äº†ã€‚</p>
<p>æ‰€ä»¥å·®ä¸å¤šå°±é€™æ¨£äº†ï¼Œæ·ºå˜—è¼’æ­¢ã€‚( Ë˜ï½¥Ğ·ï½¥)</p>
<h3 id="å¼•å­çš„å°çµ">å¼•å­çš„å°çµ</h3><p>å°±ä¸Šè¿°çš„å ´æ™¯ä¾†èªªï¼Œå“ˆå¸Œéå¸¸å¥½åœ°å°‡ä¸€å€‹éå¸¸è¤‡é›œçš„ç‹€æ…‹è½‰åŒ–æˆä¸€å€‹å¯ä»¥æª¢ç´¢çš„ç‹€æ…‹ã€‚æœ¬ä¾†æ¯«ç„¡é ­ç·’çš„ä¸€å€‹å•é¡Œä½¿ç”¨äº†å“ˆå¸Œä¹‹å¾Œå°±å®Œå…¨è®Šæˆäº†ä¸€å€‹æª¢ç´¢åŠ é©—è­‰çš„éç¨‹äº†ã€‚</p>
<h2 id="å ±å‘Šåœ–å•é¡Œ">å ±å‘Šåœ–å•é¡Œ</h2><p>é€™å€‹å•é¡Œå°±æ˜¯æˆ‘åœ¨å¤§æœè»Šä¸­ç¢ºå¯¦é‡åˆ°çš„å ´æ™¯äº†ã€‚å¤§å®¶ä¹Ÿä¸éœ€è¦çŸ¥é“ä»€éº¼æ˜¯å ±å‘Šåœ–ï¼Œå°±ç•¶å®ƒæ˜¯ä¸€å€‹ä»£è™Ÿäº†ã€‚</p>
<h3 id="å•é¡Œæè¿°-1">å•é¡Œæè¿°</h3><blockquote>
<p>è¦åšçš„äº‹æƒ…å¤§æ¦‚å°±æ˜¯èªªçµ¦å®šä¸€å€‹å ±å‘Šï¼Œæˆ‘å€‘æ ¹æ“šå ±å‘Šçš„å„å€‹ç´°ç¯€é¸å®šå„ç¨®åœ–å±¤ç„¶å¾Œæ‰æˆä¸€åœ˜ç–ŠåŠ åœ¨ä¸€èµ·å½¢æˆæœ€å¾Œä¸€å€‹çµæœåœ–ã€‚</p>
</blockquote>
<p>å…¶å¯¦æœ¬ä¾†å°±æœ‰å€‹ç³»çµ±åœ¨åšé€™ä»¶äº‹æƒ…çš„â€”â€”æ¯ä¾†ä¸€å€‹å ±å‘Šå°±ç”Ÿæˆä¸€å¼µåœ–ï¼Œç„¶å¾Œå­˜å„²å¥½ä¹‹å¾Œçµ¦å‰ç«¯ä½¿ç”¨ã€‚</p>
<p>æˆ‘åšçš„äº‹æƒ…æ˜¯å°‡é‚è¼¯é·ç§»åˆ°å¦ä¸€å¥—è¨ˆç®—å¯†é›†å‹ä»»å‹™é›†ä¸­è™•ç†ç³»çµ±ä¸­å»ã€‚(<em>Â´è‰¸`</em>)</p>
<p>å…¶å¯¦ç”Ÿæˆé€™æ¨£ä¸€å¼µåœ–ç‰‡çš„é‚è¼¯æ˜¯ CPU è¨ˆç®—å¯†é›†å‹çš„é‚è¼¯ï¼Œæ‰€ä»¥æ¯”è¼ƒè€—è²»è³‡æºå’Œæ™‚é–“çš„ï¼Œé‚£éº¼æˆ‘å€‘å°±èƒ½åœ¨é€™ä¸Šé¢åšé»æ‰‹è…³å„ªåŒ–ä¸€ä¸‹ã€‚</p>
<h3 id="å„ªåŒ–æ–¹æ³•">å„ªåŒ–æ–¹æ³•</h3><p>é¦–å…ˆæˆ‘å€‘è¦çŸ¥é“çš„æ˜¯ï¼Œæœ‰å“ªäº›åœ–å±¤æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å…¶å¯¦é€™ç®—åŠå€‹æ’åˆ—çµ„åˆçš„å•é¡Œäº†ã€‚</p>
<p>ä¸éæˆ‘å€‘ä¹ŸçŸ¥é“æ’åˆ—çµ„åˆçš„å¢é•·æ€§éå¸¸å¿«ï¼Œæ›´ä½•æ³æˆ‘é€™è£æœ‰ç´„ 100 å€‹åœ–å±¤é¸æ“‡ï¼Œæ‰€ä»¥å¯èƒ½æ€§éå¸¸å¤šï¼Œä¸€ä¸‹å­å…¨ç”Ÿæˆå¥½ä¸å¯èƒ½ã€‚</p>
<p>é‚£éº¼å°±å¯ä»¥ç”¨å“ˆå¸Œå’Œæ‡¶æƒ°çš„æ€æƒ³ä¾†å¯¦ç¾äº†ã€‚(<em>Ë‡Ï‰Ë‡</em>äºº)</p>
<p>é›–ç„¶å ±å‘Šæ˜¯æœ‰ç„¡é™ç¨®å¯èƒ½çš„ï¼Œä½†æ˜¯æŠŠå ±å‘Šè½‰æˆåœ–å±¤æ•¸æ“šä¹‹å¾Œï¼Œæ“æœ‰å®Œå…¨ä¸€æ¨£çš„åœ–å±¤æ•¸æ“šçš„å ±å‘Šå°±å¯ä»¥ç”¨åŒä¸€å¼µåœ–ç‰‡äº†ï¼Œé€™æ¨£å°±å¯ä»¥å¤§å¤§ç¯€çœç©ºé–“å’Œæ™‚é–“äº†ã€‚</p>
<p>å…¶å¯¦å¤§æ¦‚çš„æ­¥é©Ÿéå¸¸ç°¡å–®ï¼š</p>
<ol>
<li>æŠŠåœ–å±¤æ•¸æ“šè¨ˆç®—æˆå“ˆå¸Œã€‚ï¼ˆæ¯”å¦‚æŠŠæ‰€æœ‰åœ–å±¤æ–‡ä»¶è·¯å¾‘ç”¨æŸç¨®ç¬¦è™Ÿæ‹¼æ¥ï¼Œå†ç”¨ <code>md5</code> è¨ˆç®—ä¸€ä¸‹ï¼‰</li>
<li>å»æ•¸æ“šåº«æŸ¥æ‰¾é€™å€‹å“ˆå¸Œä¸»éµå­˜ä¸å­˜åœ¨ã€‚<ul>
<li>å¦‚æœå­˜åœ¨å‰‡é©—è­‰æºåœ–å±¤æ•¸æ“šåŸŸç•¶å‰åœ–å±¤æ•¸æ“šæ˜¯å¦å»åˆã€‚<ul>
<li>å¦‚æœä¸å»åˆå‰‡æŒ‰æŸç¨®ç®—æ³•é‡æ–°è¨ˆç®—å“ˆå¸Œï¼Œç¹¼çºŒæ­¥é©Ÿ 2ã€‚</li>
<li><strong>å¦‚æœå»åˆå‰‡å¯ä»¥ç›´æ¥æ‹¿ç€é€™å€‹æ•¸æ“šè¿”å›äº†ï¼Œè·³å‡ºè¨ˆç®—ã€‚</strong></li>
</ul>
</li>
<li>å¦‚æœä¸å­˜åœ¨å°±èªªæ˜ç•¶å‰æ•¸æ“šåº«é‚„æ²’æœ‰é€™å€‹åœ–å±¤æƒ…æ³çš„å ±å‘Šåœ–ç”Ÿæˆï¼Œé‚£éº¼å°±åŸ·è¡Œç”Ÿæˆå ±å‘Šåœ–é‚è¼¯ã€‚</li>
</ul>
</li>
<li>å ±å‘Šåœ–ç”Ÿæˆä¹‹å¾Œï¼Œå°‡å…¶å­˜å…¥æ•¸æ“šåº«ä¸­ã€‚<ul>
<li>è¨ˆç®—å‡ºé€™å€‹å ±å‘Šåœ–åœ–å±¤æ•¸æ“šçš„å“ˆå¸Œï¼Œå»æ•¸æ“šåº«æŸ¥å­˜ä¸å­˜åœ¨ã€‚<ul>
<li>å¦‚æœä¸å­˜åœ¨å‰‡èªªæ˜å“ˆå¸Œä¸è¡çªï¼Œèƒ½ç”¨ï¼Œç›´æ¥ç”¨é€™å€‹å“ˆå¸Œå­˜é€²å»ã€‚</li>
<li>å¦‚æœå­˜åœ¨å‰‡èªªæ˜å“ˆå¸Œè¡çªï¼Œé‚£éº¼æŒ‰æŸç¨®ç®—æ³•é‡æ–°è¨ˆç®—å“ˆå¸Œï¼Œç¹¼çºŒä¸Šé¢çš„æ­¥é©Ÿç›´åˆ°ä¸è¡çªçˆ²æ­¢ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>å¦‚æœå¤§å®¶æƒ³çŸ¥é“â€œæŒ‰æŸç¨®ç®—æ³•é‡æ–°ç”Ÿæˆå“ˆå¸Œâ€è£é¢â€œæŸç¨®ç®—æ³•â€çš„è©±å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„çç‹—çœ¼çš„èªªæ˜ç­ã€‚(ï¾‰â—•ãƒ®â—•)ï¾‰*:ï½¥ï¾Ÿâœ§</p>
<blockquote>
<p>å…¶å¯¦å¾ˆç°¡å–®ï¼ŒæŠŠåœ–å±¤æ•¸æ“šçš„é€™å€‹å­—ç¬¦ä¸²åŠ æŸå€‹å›ºå®šå­—ç¬¦ç•¶å°å°¾å·´ï¼Œå¦‚æœå“ˆå¸Œé‚„æ˜¯è¡çªå‰‡ç¹¼çºŒåŠ é€™å€‹å°å°¾å·´ï¼Œç›´åˆ°è¨ˆç®—å‡ºä¾†çš„å“ˆå¸Œä¸è¡çªçˆ²æ­¢ã€‚</p>
<p>æ¯”å¦‚æˆ‘å°±ç”¨äº†é€™å­—ç¬¦ç•¶å°å°¾å·´â€”â€”<strong>ğŸ€£</strong>ï¼ˆéº»å°‡ç‰Œä¸­çš„è˜­ï¼‰ã€‚(â™›â€¿â™›)</p>
</blockquote>
<h3 id="å ±å‘Šåœ–çš„å°çµ">å ±å‘Šåœ–çš„å°çµ</h3><p>åœ¨é€™ç¨®å ´æ™¯ä¸­ï¼Œæˆ‘æŠŠå“ˆå¸Œæ‹¿ä¾†ä½œæª¢ç´¢æŸç¨®å ±å‘Šåœ–æ˜¯å¦å·²ç¶“ç”Ÿæˆçš„ç”¨é€”ã€‚å¦‚æœæ²’æœ‰ç”Ÿæˆå‰‡ç”Ÿæˆä¸€å¼µï¼Œå¦‚æœå·²ç¶“ç”Ÿæˆå‰‡ç›´æ¥æ‹¿å·²æœ‰çš„å ±å‘Šåœ–å»ç”¨ã€‚</p>
<p>è‡³å°‘æ¯”åŸä¾†çš„ä¾†ä¸€å¼µå ±å‘Šå°±ç”Ÿæˆä¸€å¼µåœ–ç‰‡ä¾†å¾—å¿«ï¼Œä¸¦ä¸”çœç©ºé–“â€”â€”ç›¸ç•¶æ–¼ä½œå†—é¤˜è™•ç†äº†ã€‚</p>
<p>äº‹å¯¦ä¸Šåœ¨å¾ˆå¤šçš„ç¶²ç›¤ç³»çµ±ä¸­ä¹Ÿæœ‰ä½œå†—é¤˜è™•ç†çš„ã€‚ä½ ä»¥çˆ²ä½ æœ‰å¤šå°‘å¤šå°‘ T çš„ç©ºé–“ï¼Œå¯¦éš›ä¸Šç›¸åŒçš„æ–‡ä»¶æœ€çµ‚åœ¨ç¶²ç›¤ç³»çµ±è£é¢åªå­˜ä¸€ä»½ï¼ˆä¸éæ’é™¤å‚™ä»½çš„é‚£äº›ï¼‰ï¼Œè€Œæˆ‘ç›¸ä¿¡åšé€™äº›å†—é¤˜åˆ¤æ–·çš„åŸç†å°±æ˜¯å“ˆå¸Œäº†ï¼ŒSHA-1 ä¹Ÿå¥½ MD5 ä¹Ÿå¥½ï¼Œåæ­£å°±æ˜¯é€™æ¨£ã€‚</p>
<blockquote>
<p>ä¸Šé¢ç¶²ç›¤çš„å†—é¤˜è™•ç†åŸç†ä¹Ÿåªæ˜¯æˆ‘çš„çŒœæ¸¬ï¼Œæˆ‘æ²’åœ¨é‚£äº›å» å­è£é¢å·¥ä½œéæ‰€ä»¥ä¸èƒ½èªªå°±æ˜¯å°±æ˜¯é€™æ¨£å­çš„ã€‚æ­¡è¿æŒ‡æ­£ã€‚ï½¡ï¾Ÿãƒ½(ï¾ŸÂ´Ğ”`)ï¾‰ï¾Ÿï½¡</p>
</blockquote>
<h2 id="å”¯ä¸€ä¸»éµå•é¡Œ">å”¯ä¸€ä¸»éµå•é¡Œ</h2><p>é€™æ˜¯æˆ‘ä¾†é€™é‚Šå·¥ä½œå¾Œçš„å¦ä¸€å€‹å°æ’æ›²äº†ï¼Œé‡åˆ°ä¸€å€‹ä¸»éµç”Ÿæˆçš„å°éœ€æ±‚ã€‚</p>
<h3 id="å•é¡Œæè¿°-2">å•é¡Œæè¿°</h3><p>æœ‰ä¸€å€‹æ•¸æ“šè¦æ’å…¥åˆ°æ•¸æ“šåº«ï¼Œæ‰€ä»¥è¦çµ¦å®ƒç”Ÿæˆä¸€å€‹ä¸»éµï¼Œä½†æ˜¯éœ€æ±‚æ¯”è¼ƒå¥‡è‘©ï¼Œå¯èƒ½æ˜¯æ­·å²éºç•™å•é¡Œå§ã€‚(ëˆˆâ€¸ëˆˆ)</p>
<ul>
<li>éè‡ªå¢ã€‚</li>
<li>æ˜¯ä¸€å€‹å…¨æ˜¯æ•¸å­—çš„å­—ç¬¦ä¸²ã€‚</li>
<li>ä¸åŒé¡å‹çš„é€™å€‹è¡¨çš„æ•¸æ“šç”¨ä¸åŒçš„å‰ç¶´ï¼Œæ¯”å¦‚ <code>10</code>ã€<code>11</code>ã€<code>12</code> ç­‰ã€‚</li>
<li>ä½æ•¸åœ¨åå¹¾ä½å·¦å³ï¼ˆä¸éåœ¨æˆ‘é€™è£å°±å›ºå®šäº†ï¼‰ã€‚</li>
</ul>
<h3 id="è§£æ±ºæ–¹æ¡ˆ">è§£æ±ºæ–¹æ¡ˆ</h3><p>å¦‚æœæ˜¯ <code>å‰ç¶´ + éš¨æ©Ÿæ•¸</code> çš„è¡çªæ¦‚ç‡æœƒæ¯”è¼ƒå¤§çš„ï¼Œæ‰€ä»¥é‚„æ˜¯ç”¨å“ˆå¸Œä¾†æã€‚</p>
<p>éå¸¸ç°¡å–®ã€‚é¦–å…ˆå‰ç¶´æ˜¯å›ºå®šçš„ï¼Œæˆ‘å€‘å°±ä¸ç®¡äº†ï¼Œç„¶å¾Œæˆ‘æ ¹æ“šé€™æ¬¡é€²ä¾†çš„æ•¸æ“šæ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼ˆæ•¸æ“šä¸æœƒå®Œå…¨ä¸€æ¨£çš„ï¼‰ï¼ŒåŠ ä¸Šä¸€é»éš¨æ©Ÿé¹½ï¼Œç„¶å¾Œç”¨å­—ç¬¦ä¸²å“ˆå¸Œè¨ˆç®—ä¸€éï¼ŒåŠ ä¸Šå‰å°é›¶ï¼ŒåŠ ä¸Šç•¶å‰æ™‚é–“æˆ³çš„å¾Œå¹¾ä½æ‹¼æ¥èµ·ä¾†ï¼Œæœ€å¾Œæ¥ä¸Šå‰ç¶´å°±å¥½äº†ã€‚</p>
<p>é€™å€‹ <code>generate</code> å‡½æ•¸çœ‹èµ·ä¾†å°±åƒé€™æ¨£å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bling = <span class="built_in">require</span>(<span class="string">"bling-hashes"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate</span>(<span class="params">type, bodyParamStr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> basePrefix;</span><br><span class="line">    <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'foo'</span>: basePrefix = <span class="string">'10'</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'bar'</span>: basePrefix = <span class="string">'11'</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: base_prefix = <span class="string">'00'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> date = moment();</span><br><span class="line">    <span class="keyword">var</span> hash = bling.bkdr(bodyParamStr + date.valueOf()).pad(<span class="number">10</span>);</span><br><span class="line">    hash = date.millisecond().pad(<span class="number">3</span>) + hash;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> basePrefix + hash;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>é€™è£çš„ <code>bling</code> å°±æ˜¯ä¸Šé¢æåˆ°éçš„é‚£å€‹ <a href="https://github.com/XadillaX/bling_hashes" target="_blank" rel="external">bling-hashes</a>ï¼Œæ¡ç”¨äº† <code>BKDR</code> ç®—æ³•ä¾†è¨ˆç®—å“ˆå¸Œã€‚ä»¥åŠ <code>Number.prototype.pad</code> å‡½æ•¸æ˜¯æˆ‘é‚ªæƒ¡å¾—ä½¿ç”¨äº† <a href="http://sugarjs.com/api/Number/pad" target="_blank" rel="external">SugarJs</a> è£é¢çš„å‡½æ•¸ï¼Œå°±æ˜¯åŠ ä¸Šå‰å°é›¶çš„æ„æ€ã€‚å¦‚æœå—â€œåƒè¬ä¸è¦ä¿®æ”¹åŸå‹éˆâ€å½±éŸ¿è¼ƒæ·±åœ°ç«¥é‹åˆ¥å­¸æˆ‘å“¦ã€‚<code>bodyParamStr</code> æ˜¯å‰ç«¯å‚³éä¾†çš„ <strong>Raw Form Data</strong>ï¼Œå®ƒçœ‹èµ·ä¾†åƒ <code>&quot;data1=1&amp;data2=2&amp;...&quot;</code>ã€‚</p>
</blockquote>
<p>æœ€å¾Œå¾—åˆ°çš„é€™å€‹å­—ç¬¦ä¸²æ˜¯æˆ‘å€‘æ‰€è¦çš„ä¸»éµäº†ã€‚ï½¡:.ï¾Ÿãƒ½(*Â´âˆ€`)ï¾‰ï¾Ÿ.:ï½¡</p>
<p>ä¸éè¦æ³¨æ„çš„æ˜¯ï¼Œé€™å€‹ä¸»éµä»ç„¶åˆè¡çªçš„å¯èƒ½æ€§ï¼Œæ‰€ä»¥ä¸€æ—¦è¡çªäº†ï¼ˆç„¡è«–æ˜¯è‡ªå·±æª¢æ¸¬åˆ°çš„é‚„æ˜¯æ’å…¥æ•¸æ“šåº«çš„æ™‚å€™ç–¼äº†ï¼‰å°±éœ€è¦å†ç”Ÿç”¢ä¸€éã€‚å°±ç›®å‰ä¾†èªªå†ç”Ÿæˆçš„æ™‚å€™æ¯«ç§’æ™‚é–“æˆ³å¾Œä¸‰ä½æœƒä¸ä¸€æ¨£ï¼Œæ‰€ä»¥å•é¡Œä¸å¤§ï¼Œå…è¨±å­˜åœ¨çš„èª¤å·®â€”â€”ç•¢ç«Ÿä¸æ˜¯é‚£ç¨®åˆ†åˆ†é˜é›†åƒè¬æ¢çš„æ•¸æ“šï¼Œè‚¯å®šåœ¨ <code>int</code> ç¯„åœå…§ã€‚å¦‚æœåˆ°æ™‚å€™çœŸå‡ºå•é¡Œäº†å†æ”¹é€²ã€‚</p>
<h3 id="ä¸»éµçš„å°çµ">ä¸»éµçš„å°çµ</h3><p>é€™è£çš„å“ˆå¸Œæ˜¯ç”¨åœ¨ç”ŸæˆåŸºæœ¬ä¸Šæ²’æœ‰ç¢°æ’çš„ä¸»éµèº«ä¸Šï¼Œæ„Ÿè¦ºæ•ˆæœä¹Ÿæ˜¯éå¸¸ä¸éŒ¯çš„â€”â€”å‰ææ˜¯ä½ ä¹Ÿæœ‰é€™ç¨®å¥‡è‘©éœ€æ±‚ã€‚</p>
<h2 id="çœŸÂ·å°çµ">çœŸÂ·å°çµ</h2><p>æœ¬æ–‡å¤§è‡´ä»‹ç´¹äº†å“ˆå¸Œçš„å¹¾ç¨®ç”¨é€”ï¼Œæœ‰å¯èƒ½æ˜¯å¤§å®¶ç†ŸçŸ¥çš„ç”¨é€”ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å·§ç”¨ï¼Œç¸½ä¹‹å°±æ˜¯èªªäº†çˆ²ä»€éº¼æˆ‘è¦ç”¨å“ˆå¸Œã€‚</p>
<p>åœ¨ç·¨ç¨‹ä¸­ï¼Œç„¡è«–æ˜¯å¯¦éš›ç”¨é€”é‚„æ˜¯è‡ªå·±ç©ç©çš„é¡Œç›®ï¼Œå¤šå‹•å‹•è…¦å­å°±æœƒå‡ºä¾†ä¸€äº›â€œå¥‡æŠ€æ·«å·§â€ã€‚å“ˆå¸Œä¹Ÿå¥½ï¼Œåˆ¥çš„æ±è¥¿ä¹Ÿç½·ï¼Œåæ­£éƒ½æ˜¯çˆ²äº†è§£æ±ºå•é¡Œçš„â€”â€”åƒè¬åˆ¥å› çˆ²å¯¦éš›é–‹ç™¼ä¸­é€šå¸¸æ€§çš„â€œä¸¦æ²’æœ‰ä»€éº¼åµç”¨â€è€Œå»å¿½è¦–å®ƒå€‘ï¼Œé›–ç„¶å“ˆå¸Œå·²ç¶“æ˜¯å¤ å¸¸ç”¨çš„äº†ã€‚(à¹‘â€¢à«…Ï‰â€¢Â´à¹‘)</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="ä»€éº¼æ˜¯å“ˆå¸Œï¼ˆHashï¼‰">ä»€éº¼æ˜¯å“ˆå¸Œï¼ˆHashï¼‰</h2><p>æœ¬ä¾†é€™è£ä¸æ‡‰è©²å‡ºç¾é€™ä¸€ç¯€çš„ï¼Œå› çˆ²å¯¦éš›ä¸Šå¤§å®¶æ‡‰è©²éƒ½çŸ¥é“ä»€éº¼æ˜¯å“ˆå¸Œã€‚ä¸éæœ‰æ™‚å€™çˆ²äº†æ–‡ç« çš„å®Œæ•´æ€§ï¼Œæˆ‘é€™è£å°±ç¨å¾®æ•™æ¢æ€§åœ°èªªæ˜ä¸€ä¸‹å§ã€‚ãƒ½(Ìâ—•â—à±ªâ—Ÿâ—•â€µ)ï¾‰</p>
<blockquote>
<p>æ•£åˆ—ï¼ˆè‹±èªï¼š]]>
    </summary>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="å“ˆå¸Œ" scheme="http://xcoder.in/tags/%E5%93%88%E5%B8%8C/"/>
    
      <category term="æ•¸æ“šçµæ§‹" scheme="http://xcoder.in/tags/%E6%95%B8%E6%93%9A%E7%B5%90%E6%A7%8B/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[åˆæ¢ MySQL çš„ Binlog]]></title>
    <link href="http://xcoder.in/2015/08/10/mysql-binlog-try/"/>
    <id>http://xcoder.in/2015/08/10/mysql-binlog-try/</id>
    <published>2015-08-10T03:39:53.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€èŠ±ç“£ç¶²çš„æœç´¢æ¶æ§‹éœ€è¦é‡æ§‹ï¼Œå°¤å…¶æ˜¯åœ¨ç´¢å¼•å»ºç«‹æˆ–è€…æ›´æ–°å±¤é¢ã€‚</p>
<p>ã€€ã€€ç›®å‰çš„ä¸€å€‹æ¶æ§‹å°è‡´çš„çµæœå°±æ˜¯æ™‚é–“è¶Šä¹…ï¼Œæ•¸æ“šæœ¬é«”èˆ‡æœç´¢å¼•æ“ç´¢å¼•ä¸­çš„æ•¸æ“šè¶Šä¸åŒæ­¥ï¼Œç›¸å·®ç”šå¤§ã€‚</p>
<p>ã€€ã€€æ–°çš„ä¸€å€‹æ¶æ§‹æ‰“ç®—å¾ MySQL çš„ Binlog ä¸­è®€å–æ•¸æ“šæ›´æ–°ã€åˆªé™¤ã€æ–°å¢ç­‰æ­·å²è¨˜éŒ„ï¼Œä¸¦æŠŠç›¸æ‡‰ä¿¡æ¯æå–å‡ºä¾†ä¸Ÿåˆ°éšŠåˆ—ä¸­æ…¢æ…¢å»åŒæ­¥ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥æˆ‘å°±åœ¨é€™è£å°å°å»äº†è§£ä¸€ä¸‹ Binlogã€‚</p>
<h2 id="æº–å‚™å·¥ä½œ">æº–å‚™å·¥ä½œ</h2><h3 id="ä»€éº¼æ˜¯_Binlog">ä»€éº¼æ˜¯ Binlog</h3><p>ã€€ã€€MySQL Server æœ‰å››ç¨®é¡å‹çš„æ—¥èªŒâ€”â€”Error Logã€General Query Logã€Binary Log å’Œ Slow Query Logã€‚</p>
<p>ã€€ã€€ç¬¬ä¸€å€‹æ˜¯éŒ¯èª¤æ—¥èªŒï¼Œè¨˜éŒ„ mysqld çš„ä¸€äº›éŒ¯èª¤ã€‚ç¬¬äºŒå€‹æ˜¯ä¸€èˆ¬æŸ¥è©¢æ—¥èªŒï¼Œè¨˜éŒ„ mysqld æ­£åœ¨åšçš„äº‹æƒ…ï¼Œæ¯”å¦‚å®¢æˆ¶ç«¯çš„é€£æ¥å’Œæ–·é–‹ã€ä¾†è‡ªå®¢æˆ¶ç«¯æ¯æ¢ Sql Statement è¨˜éŒ„ä¿¡æ¯ï¼›å¦‚æœä½ æƒ³æº–ç¢ºçŸ¥é“å®¢æˆ¶ç«¯åˆ°åº•å‚³äº†ä»€éº¼ç [å—¶å—¶] ç©æ„å…’çµ¦æœå‹™ç«¯ï¼Œé€™å€‹æ—¥èªŒå°±éå¸¸ç®¡ç”¨äº†ï¼Œä¸éå®ƒéå¸¸å½±éŸ¿æ€§èƒ½ã€‚ç¬¬å››å€‹æ˜¯æ…¢æŸ¥è©¢æ—¥èªŒï¼Œè¨˜éŒ„ä¸€äº›æŸ¥è©¢æ¯”è¼ƒæ…¢çš„ SQL èªå¥â€”â€”é€™ç¨®æ—¥èªŒéå¸¸å¸¸ç”¨ï¼Œä¸»è¦æ˜¯çµ¦é–‹ç™¼è€…èª¿å„ªç”¨çš„ã€‚</p>
<p>ã€€ã€€å‰©ä¸‹çš„ç¬¬ä¸‰ç¨®å°±æ˜¯ Binlog äº†ï¼ŒåŒ…å«äº†ä¸€äº›äº‹ä»¶ï¼Œé€™äº›äº‹ä»¶æè¿°äº†æ•¸æ“šåº«çš„æ”¹å‹•ï¼Œå¦‚å»ºè¡¨ã€æ•¸æ“šæ”¹å‹•ç­‰ï¼Œä¹ŸåŒ…æ‹¬ä¸€äº›æ½›åœ¨æ”¹å‹•ï¼Œæ¯”å¦‚ <code>DELETE FROM ran WHERE bing = luan</code>ï¼Œç„¶è€Œä¸€æ¢æ•¸æ“šéƒ½æ²’è¢«åˆªæ‰çš„é€™ç¨®æƒ…æ³ã€‚é™¤éä½¿ç”¨ Row-based loggingï¼Œå¦å‰‡æœƒåŒ…å«æ‰€æœ‰æ”¹å‹•æ•¸æ“šçš„ SQL Statementã€‚</p>
<p>ã€€ã€€é‚£éº¼ Binlog å°±æœ‰äº†å…©å€‹é‡è¦çš„ç”¨é€”â€”â€”è¤‡è£½å’Œæ¢å¾©ã€‚æ¯”å¦‚ä¸»å¾è¡¨çš„è¤‡è£½ï¼Œå’Œå‚™ä»½æ¢å¾©ä»€éº¼çš„ã€‚</p>
<h3 id="å•“ç”¨_Binlog">å•“ç”¨ Binlog</h3><p>ã€€ã€€é€šå¸¸æƒ…æ³ MySQL æ˜¯é»˜èªé—œé–‰ Binlog çš„ï¼Œæ‰€ä»¥ä½ å¾—é…ç½®ä¸€ä¸‹ä»¥å•“ç”¨å®ƒã€‚</p>
<p>ã€€ã€€å•“ç”¨çš„éç¨‹å°±æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>my.cnf</code> äº†ã€‚</p>
<p>ã€€ã€€è‡³æ–¼ <code>my.cnf</code> ä½ç½®è«‹è‡ªè¡Œå°‹æ‰¾ã€‚ä¾‹å¦‚é€šé OSX çš„ <code>brew</code> å®‰è£çš„ <code>mysql</code> é»˜èªé…ç½®ç›®éŒ„é€šå¸¸åœ¨</p>
<blockquote>
<p>/usr/local/Cellar/mysql/$VERSION/support-files/my-default.cnf</p>
</blockquote>
<p>ã€€ã€€é€™å€‹æ™‚å€™éœ€è¦å°‡å®ƒæ‹·è²åˆ° <code>/etc/my.cnf</code> ä¸‹é¢ã€‚</p>
<blockquote>
<p>è©³è¦‹ &lt;<a href="http://stackoverflow.com/questions/10757169/mysql-my-cnf-location" target="_blank" rel="external">StackOverflow - MySQL â€˜my.cnfâ€™ location?</a>&gt;ã€‚</p>
</blockquote>
<p>ã€€ã€€ç·Šæ¥ç€é…ç½® <code>log-bin</code> å’Œ <code>log-bin-index</code> çš„å€¼ï¼Œå¦‚æœæ²’æœ‰å‰‡è‡ªè¡ŒåŠ ä¸Šå»ã€‚</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="setting">log-bin=<span class="value">master-bin</span></span></span><br><span class="line"><span class="setting">log-bin-index=<span class="value">master-bin.index</span></span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™è£çš„ <code>log-bin</code> æ˜¯æŒ‡ä»¥å¾Œç”Ÿæˆå„ Binlog æ–‡ä»¶çš„å‰ç¶´ï¼Œæ¯”å¦‚ä¸Šè¿°ä½¿ç”¨ <code>master-bin</code>ï¼Œé‚£éº¼æ–‡ä»¶å°±å°‡æœƒæ˜¯ <code>master-bin.000001</code>ã€<code>master-bin.000002</code> ç­‰ã€‚è€Œé€™è£çš„ <code>log-bin-index</code> å‰‡æŒ‡ binlog index æ–‡ä»¶çš„åç¨±ï¼Œé€™è£æˆ‘å€‘è¨­ç½®çˆ² <code>master-bin.index</code>ã€‚</p>
<p>ã€€ã€€å¦‚æœä¸Šè¿°å·¥ä½œåšå®Œä¹‹å¾Œé‡å•“ MySQL æœå‹™ï¼Œä½ å¯ä»¥é€²å…¥ä½ çš„ MySQL CLI é©—è­‰ä¸€ä¸‹æ˜¯å¦çœŸçš„å•“ç”¨äº†ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u <span class="variable">$USERNAME</span> ...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œåœ¨çµ‚ç«¯è£é¢è¼¸å…¥ä¸‹é¢ä¸€å¥ SQL èªå¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%log_bin%'</span>;</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¦‚æœçµæœè£é¢å‡ºä¾†é€™æ¨£é¡ä¼¼çš„è©±å°±è¡¨ç¤ºæˆåŠŸäº†ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------------------------+---------------------------------------+</span><br><span class="line">| Variable_name                   | Value                                 |</span><br><span class="line">+---------------------------------+---------------------------------------+</span><br><span class="line">| <span class="built_in">log</span>_bin                         | ON                                    |</span><br><span class="line">| <span class="built_in">log</span>_bin_basename                | /usr/<span class="built_in">local</span>/var/mysql/master-bin       |</span><br><span class="line">| <span class="built_in">log</span>_bin_index                   | /usr/<span class="built_in">local</span>/var/mysql/master-bin.index |</span><br><span class="line">| <span class="built_in">log</span>_bin_trust_<span class="keyword">function</span>_creators | OFF                                   |</span><br><span class="line">| <span class="built_in">log</span>_bin_use_v1_row_events       | OFF                                   |</span><br><span class="line">| sql_<span class="built_in">log</span>_bin                     | ON                                    |</span><br><span class="line">+---------------------------------+---------------------------------------+</span><br><span class="line"><span class="number">6</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ›´å¤šçš„ä¸€äº›ç›¸é—œé…ç½®å¯ä»¥åƒè€ƒé€™ç¯‡ã€Š<a href="http://blog.csdn.net/jolly10/article/details/13998761" target="_blank" rel="external">MySQL çš„ binary log åˆæ¢</a>ã€‹ã€‚</p>
<h3 id="éš¨ä¾¿ç©ç©">éš¨ä¾¿ç©ç©</h3><p>ã€€ã€€ç„¶å¾Œä½ å°±å¯ä»¥éš¨ä¾¿å»åŸ·è¡Œä¸€äº›æ•¸æ“šè®Šå‹•çš„ SQL èªå¥äº†ã€‚ç•¶ä½ åŸ·è¡Œäº†ä¸€å †èªå¥ä¹‹å¾Œå°±å¯ä»¥çœ‹åˆ°ä½ çš„ Binlog è£é¢æœ‰å…§å®¹äº†ã€‚</p>
<p>ã€€ã€€å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œ<code>log_bin_basename</code> çš„å€¼æ˜¯ <code>/usr/local/var/mysql/master-bin</code> å°±æ˜¯ Binlog çš„åŸºç¤æ–‡ä»¶åäº†ã€‚</p>
<p>ã€€ã€€é‚£æˆ‘å€‘é€²å»çœ‹ï¼Œæ¯”å¦‚æˆ‘çš„é€™é‚Šå°±æœ‰é€™éº¼å¹¾å€‹æ–‡ä»¶ï¼š</p>
<p><img src="binlog-files.jpg" alt="Binlog æ–‡ä»¶"></p>
<p>ã€€ã€€å¾ˆå®¹æ˜“ç™¼ç¾ï¼Œè£é¢æœ‰ <code>master-bin.index</code> å’Œ <code>master-bin.000001</code> å…©å€‹æ–‡ä»¶ï¼Œé€™å…©å€‹æ–‡ä»¶åœ¨ä¸Šæ–‡ä¸­æœ‰æåˆ°éäº†ã€‚</p>
<p>ã€€ã€€æˆ‘å€‘æ‰“é–‹é‚£å€‹ <code>master-bin.index</code> æ–‡ä»¶ï¼Œæœƒç™¼ç¾é€™å€‹ç´¢å¼•æ–‡ä»¶å°±æ˜¯ä¸€å€‹æ™®é€šçš„æ–‡æœ¬æ–‡ä»¶ï¼Œç„¶å¾Œåˆ—èˆ‰äº†å„ binlog çš„æ–‡ä»¶åã€‚è€Œ <code>master-bin.000001</code> æ–‡ä»¶å°±æ˜¯ä¸€å †äº‚ç¢¼äº†â€”â€”ç•¢ç«Ÿäººå®¶æ˜¯äºŒé€²åˆ¶æ–‡ä»¶ã€‚</p>
<h2 id="çµæ§‹è§£æ">çµæ§‹è§£æ</h2><h3 id="ç´¢å¼•æ–‡ä»¶">ç´¢å¼•æ–‡ä»¶</h3><p>ã€€ã€€ç´¢å¼•æ–‡ä»¶å°±æ˜¯ä¸Šæ–‡ä¸­çš„ <code>master-bin.index</code> æ–‡ä»¶ï¼Œæ˜¯ä¸€å€‹æ™®é€šçš„æ–‡æœ¬æ–‡ä»¶ï¼Œä»¥æ›è¡Œçˆ²é–“éš”ï¼Œä¸€è¡Œä¸€å€‹æ–‡ä»¶åã€‚æ¯”å¦‚å®ƒå¯èƒ½æ˜¯ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master-bin<span class="number">.000001</span></span><br><span class="line">master-bin<span class="number">.000002</span></span><br><span class="line">master-bin<span class="number">.000003</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œå°æ‡‰çš„æ¯è¡Œæ–‡ä»¶å°±æ˜¯ä¸€å€‹ Binlog å¯¦é«”æ–‡ä»¶äº†ã€‚</p>
<h3 id="Binlog_æ–‡ä»¶">Binlog æ–‡ä»¶</h3><p>ã€€ã€€Binlog çš„æ–‡ä»¶çµæ§‹å¤§è‡´ç”±å¦‚ä¸‹å¹¾å€‹æ–¹é¢çµ„æˆã€‚</p>
<h4 id="æ–‡ä»¶é ­">æ–‡ä»¶é ­</h4><p>ã€€ã€€æ–‡ä»¶é ­ç”±ä¸€å€‹å››å­—ç¯€ Magic Numberï¼Œå…¶å€¼çˆ² <code>1852400382</code>ï¼Œåœ¨å…§å­˜ä¸­å°±æ˜¯ <code>&quot;\xfe\x62\x69\x6e&quot;</code>ï¼Œåƒè€ƒ MySQL æºç¢¼çš„ <a href="://github.com/mysql/mysql-server/blob/a2757a60a7527407d08115e44e889a25f22c96c6/sql/log_event.h#L187">log_event.h</a>ï¼Œä¹Ÿå°±æ˜¯ <code>&#39;\0xfe&#39; &#39;b&#39; &#39;i&#39; &#39;n&#39;</code>ã€‚</p>
<p>ã€€ã€€èˆ‡å¹³å¸¸äºŒé€²åˆ¶ä¸€æ¨£ï¼Œé€šå¸¸éƒ½æœ‰ä¸€å€‹ Magic Number é€²è¡Œæ–‡ä»¶è­˜åˆ¥ï¼Œå¦‚æœ Magic Number ä¸å»åˆä¸Šè¿°çš„å€¼é‚£éº¼é€™å€‹æ–‡ä»¶å°±ä¸æ˜¯ä¸€å€‹æ­£å¸¸çš„ Binlogã€‚</p>
<h4 id="äº‹ä»¶">äº‹ä»¶</h4><p>ã€€ã€€åœ¨æ–‡ä»¶é ­ä¹‹å¾Œï¼Œè·Ÿéš¨çš„æ˜¯ä¸€å€‹ä¸€å€‹äº‹ä»¶ä¾æ¬¡æ’åˆ—ã€‚æ¯å€‹äº‹ä»¶éƒ½ç”±ä¸€å€‹äº‹ä»¶é ­å’Œäº‹ä»¶é«”çµ„æˆã€‚</p>
<p>ã€€ã€€äº‹ä»¶é ­è£é¢çš„å…§å®¹åŒ…å«äº†é€™å€‹äº‹ä»¶çš„é¡å‹ï¼ˆå¦‚æ–°å¢ã€åˆªé™¤ç­‰ï¼‰ã€äº‹ä»¶åŸ·è¡Œæ™‚é–“ä»¥åŠæ˜¯å“ªå€‹æœå‹™å™¨åŸ·è¡Œçš„äº‹ä»¶ç­‰ä¿¡æ¯ã€‚</p>
<p>ã€€ã€€ç¬¬ä¸€å€‹äº‹ä»¶æ˜¯ä¸€å€‹äº‹ä»¶æè¿°ç¬¦ï¼Œæè¿°äº†é€™å€‹ Binlog æ–‡ä»¶æ ¼å¼çš„ç‰ˆæœ¬ã€‚æ¥ä¸‹å»çš„ä¸€å †äº‹ä»¶å°‡æœƒæŒ‰ç…§ç¬¬ä¸€å€‹äº‹ä»¶æè¿°ç¬¦æ‰€æè¿°çš„çµæ§‹ç‰ˆæœ¬é€²è¡Œè§£è®€ã€‚æœ€å¾Œä¸€å€‹äº‹ä»¶æ˜¯ä¸€å€‹éŠœæ¥äº‹ä»¶ï¼ŒæŒ‡å®šäº†ä¸‹ä¸€å€‹ Binlog æ–‡ä»¶åâ€”â€”æœ‰é»é¡ä¼¼æ–¼éˆè¡¨è£é¢çš„ <code>next</code> æŒ‡é‡ã€‚</p>
<p>ã€€ã€€æ ¹æ“šã€Š<a href="High-Level Binary Log Structure and Contents">High-Level Binary Log Structure and Contents</a>ã€‹æ‰€è¿°ï¼Œä¸åŒç‰ˆæœ¬çš„ Binlog æ ¼å¼ä¸ä¸€å®šä¸€æ¨£ï¼Œæ‰€ä»¥ä¹Ÿæ²’æœ‰ä¸€å€‹å®šæ€§ã€‚åœ¨æˆ‘å¯«é€™ç¯‡æ–‡ç« çš„æ™‚å€™ï¼Œç›®å‰æœ‰ä¸‰ç¨®ç‰ˆæœ¬çš„æ ¼å¼ã€‚</p>
<ul>
<li>v1ï¼Œç”¨æ–¼ MySQL 3.2.3</li>
<li>v3ï¼Œç”¨æ–¼ MySQL 4.0.2 ä»¥åŠ 4.1.0</li>
<li>v4ï¼Œç”¨æ–¼ MySQL 5.0 ä»¥åŠæ›´é«˜ç‰ˆæœ¬</li>
</ul>
<p>ã€€ã€€å¯¦éš›ä¸Šé‚„æœ‰ä¸€å€‹ v2 ç‰ˆæœ¬ï¼Œä¸éåªåœ¨æ—©æœŸ 4.0.x çš„ MySQL ç‰ˆæœ¬ä¸­ä½¿ç”¨éï¼Œä½†æ˜¯ v2 å·²ç¶“éæ–¼é™³èˆŠä¸¦ä¸”ä¸å†è¢« MySQL å®˜æ–¹æ”¯æŒäº†ã€‚</p>
<blockquote>
<p><strong>é€šå¸¸æˆ‘å€‘ç¾åœ¨ç”¨çš„ MySQL éƒ½æ˜¯åœ¨ 5.0 ä»¥ä¸Šçš„äº†ï¼Œæ‰€ä»¥å°±ç•¥é v1 ~ v3 ç‰ˆæœ¬çš„ Binlogï¼Œå¦‚æœéœ€è¦äº†è§£ v1 ~ v3 ç‰ˆæœ¬çš„ Binlog å¯ä»¥è‡ªè¡Œå‰å¾€ä¸Šè¿°çš„ã€ŠHigh-levelâ€¦ã€‹æ–‡ç« æŸ¥çœ‹ã€‚</strong></p>
</blockquote>
<h5 id="äº‹ä»¶é ­">äº‹ä»¶é ­</h5><p>ã€€ã€€ä¸€å€‹äº‹ä»¶é ­æœ‰ 19 å­—ç¯€ï¼Œä¾æ¬¡æ’åˆ—çˆ²å››å­—ç¯€çš„æ™‚é–“æˆ³ã€ä¸€å­—ç¯€çš„ç•¶å‰äº‹ä»¶é¡å‹ã€å››å­—ç¯€çš„æœå‹™ç«¯ IDã€å››å­—ç¯€çš„ç•¶å‰äº‹ä»¶é•·åº¦æè¿°ã€å››å­—ç¯€çš„ä¸‹å€‹äº‹ä»¶ä½ç½®ï¼ˆæ–¹ä¾¿è·³è½‰ï¼‰ä»¥åŠå…©å­—ç¯€çš„æ¨™è­˜ã€‚</p>
<p>ã€€ã€€ç”¨ ASCII Diagram è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+---------+---------+---------+------------+-------------+-------+</span><br><span class="line">|<span class="string">timestamp</span>|<span class="string">type code</span>|<span class="string">server_id</span>|<span class="string">event_length</span>|<span class="string">next_position</span>|<span class="string">flags  </span>|</span><br><span class="line">|<span class="string">4 bytes  </span>|<span class="string">1 byte   </span>|<span class="string">4 bytes  </span>|<span class="string">4 bytes     </span>|<span class="string">4 bytes      </span>|<span class="string">2 bytes</span>|</span><br><span class="line">+---------+---------+---------+------------+-------------+-------+</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä¹Ÿå¯ä»¥å­—ç¯€ç·¨é€ ä¸€å€‹çµæ§‹é«”ä¾†è§£è®€é€™å€‹é ­ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> BinlogEventHeader</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span>   timestamp;</span><br><span class="line">    <span class="keyword">char</span>  type_code;</span><br><span class="line">    <span class="keyword">int</span>   server_id;</span><br><span class="line">    <span class="keyword">int</span>   event_length;</span><br><span class="line">    <span class="keyword">int</span>   next_position;</span><br><span class="line">    <span class="keyword">char</span>  flags[<span class="number">2</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœä½ è¦ç›´æ¥ç”¨é€™å€‹çµæ§‹é«”ä¾†è®€å–æ•¸æ“šçš„è©±ï¼Œéœ€è¦åŠ é»æ‰‹è…³ã€‚</p>
<p>å› çˆ²é»˜èªæƒ…æ³ä¸‹ GCC æˆ–è€… G++ ç·¨è­¯å™¨æœƒå°çµæ§‹é«”é€²è¡Œå­—ç¯€å°é½Šï¼Œé€™æ¨£è®€é€²ä¾†çš„æ•¸æ“šå°±ä¸å°äº†ï¼Œå› çˆ² Binlog ä¸¦ä¸æ˜¯å°é½Šçš„ã€‚çˆ²äº†çµ±ä¸€æˆ‘å€‘éœ€è¦å–æ¶ˆé€™å€‹çµæ§‹é«”çš„å­—ç¯€å°é½Šï¼Œä¸€å€‹æ–¹æ³•æ˜¯ä½¿ç”¨ <code>#pragma pack(n)</code>ï¼Œä¸€å€‹æ–¹æ³•æ˜¯ä½¿ç”¨ <code>__attribute__((__packed__))</code>ï¼Œé‚„æœ‰ä¸€ç¨®æƒ…æ³æ˜¯åœ¨ç·¨è­¯å™¨ç·¨è­¯çš„æ™‚å€™å¼·åˆ¶æŠŠæ‰€æœ‰çš„çµæ§‹é«”å°å…¶å–æ¶ˆï¼Œå³åœ¨ç·¨è­¯çš„æ™‚å€™ä½¿ç”¨ <code>fpack-struct</code> åƒæ•¸ï¼Œå¦‚ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ temp.cpp -o a -fpack-struct=<span class="number">1</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>ã€€ã€€æ ¹æ“šä¸Šè¿°çš„çµæ§‹æˆ‘å€‘å¯ä»¥æ˜ç¢ºå¾—åˆ°å„è®Šé‡åœ¨çµæ§‹é«”è£é¢çš„åç§»é‡ï¼Œæ‰€ä»¥åœ¨ MySQL æºç¢¼è£é¢ï¼ˆ<a href="https://github.com/mysql/mysql-server/blob/5.7/libbinlogevents/include/binlog_event.h#L353" target="_blank" rel="external">libbinlogevents/include/binlog_event.h</a>ï¼‰æœ‰ä¸‹é¢å¹¾å€‹å¸¸é‡ä»¥å¿«é€Ÿæ¨™è¨˜åç§»ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> EVENT_TYPE_OFFSET    <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> SERVER_ID_OFFSET     <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> EVENT_LEN_OFFSET     <span class="number">9</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> LOG_POS_OFFSET       <span class="number">13</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> FLAGS_OFFSET         <span class="number">17</span></span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è€Œå…·é«”æœ‰å“ªäº›äº‹ä»¶å‰‡åœ¨ <a href="https://github.com/mysql/mysql-server/blob/5.7/libbinlogevents/include/binlog_event.h#L245" target="_blank" rel="external">libbinlogevents/include/binlog_event.h#L245</a> è£é¢è¢«å®šç¾©ã€‚å¦‚æœ‰å€‹ <code>FORMAT_DESCRIPTION_EVENT</code> äº‹ä»¶çš„ <code>type_code</code> æ˜¯ 15ã€<code>UPDATE_ROWS_EVENT</code> çš„ <code>type_code</code> æ˜¯ 31ã€‚</p>
<p>ã€€ã€€é‚„æœ‰é‚£å€‹ <code>next_position</code>ï¼Œåœ¨ v4 ç‰ˆæœ¬ä¸­ä»£è¡¨å¾ Binlog ä¸€é–‹å§‹åˆ°ä¸‹ä¸€å€‹äº‹ä»¶é–‹å§‹çš„åç§»é‡ï¼Œæ¯”å¦‚åˆ°ç¬¬ä¸€å€‹äº‹ä»¶çš„ <code>next_position</code> å°±æ˜¯ 4ï¼Œå› çˆ²æ–‡ä»¶é ­æœ‰ä¸€å€‹å­—ç¯€çš„é•·åº¦ã€‚ç„¶å¾Œæ¥ä¸‹å»å°æ–¼äº‹ä»¶ n å’Œäº‹ä»¶ n + 1 ä¾†èªªï¼Œä»–å€‘æœ‰é€™æ¨£çš„é—œä¿‚ï¼š</p>
<blockquote>
<p>next_position(n + 1) = next_position(n) + event_length(n)</p>
</blockquote>
<p>ã€€ã€€é—œæ–¼ flags æš«æ™‚ä¸éœ€è¦äº†è§£å¤ªå¤šï¼Œå¦‚æœçœŸçš„æƒ³äº†è§£çš„è©±å¯ä»¥çœ‹çœ‹ MySQL çš„<a href="http://dev.mysql.com/doc/internals/en/event-flags.html" target="_blank" rel="external">ç›¸é—œå®˜æ–¹æ–‡æª”</a>ã€‚</p>
<h5 id="äº‹ä»¶é«”">äº‹ä»¶é«”</h5><p>ã€€ã€€äº‹å¯¦ä¸Šåœ¨ Binlog äº‹ä»¶ä¸­æ‡‰è©²æ˜¯æœ‰ä¸‰å€‹éƒ¨åˆ†çµ„æˆï¼Œ<code>header</code>ã€<code>post-header</code> å’Œ <code>payload</code>ï¼Œä¸éé€šå¸¸æƒ…æ³ä¸‹æˆ‘å€‘æŠŠ <code>post-header</code> å’Œ <code>payload</code> éƒ½æ­¸çµçˆ²äº‹ä»¶é«”ï¼Œå¯¦éš›ä¸Šé€™å€‹ <code>post-header</code> è£é¢æ”¾çš„æ˜¯ä¸€äº›å®šé•·çš„æ•¸æ“šï¼Œåªä¸éæœ‰æ™‚å€™æˆ‘å€‘ä¸éœ€è¦ç‰¹åˆ¥åœ°é—œå¿ƒã€‚æƒ³è¦æ·±å…¥ç­è§£å¯ä»¥å»æŸ¥çœ‹ MySQL çš„å®˜æ–¹æ–‡æª”ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥å¯¦éš›ä¸Šä¸€å€‹çœŸæ­£çš„äº‹ä»¶é«”ç”±å…©éƒ¨åˆ†çµ„æˆï¼Œç”¨ ASCII Diagram è¡¨ç¤ºå°±åƒé€™æ¨£ï¼š</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+=====================================+</span></span><br><span class="line">| event  | fixed part (post-header)   |</span><br><span class="line">| data   <span class="code">+----------------------------+</span></span><br><span class="line"><span class="header">|        | variable part (payload)    |</span><br><span class="line">+=====================================+</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è€Œé€™å€‹ <code>post-header</code> å°æ–¼ä¸åŒé¡å‹çš„äº‹ä»¶ä¾†èªªé•·åº¦æ˜¯ä¸ä¸€æ¨£çš„ï¼ŒåŒç¨®é¡å‹ä¾†èªªæ˜¯ä¸€æ¨£çš„ï¼Œè€Œé€™å€‹é•·åº¦çš„é å…ˆè¦å®šå°‡æœƒåœ¨ä¸€å€‹â€œæ ¼å¼æè¿°äº‹ä»¶â€ä¸­å®šå¥½ã€‚</p>
<h5 id="æ ¼å¼æè¿°äº‹ä»¶">æ ¼å¼æè¿°äº‹ä»¶</h5><p>ã€€ã€€åœ¨ä¸Šæ–‡æˆ‘å€‘æœ‰æåˆ°éï¼Œåœ¨ Magic Number ä¹‹å¾Œè·Ÿç€çš„æ˜¯ä¸€å€‹æ ¼å¼æè¿°äº‹ä»¶ï¼ˆFormat Description Eventï¼‰ï¼Œå…¶å¯¦é€™åªæ˜¯åœ¨ v4 ç‰ˆæœ¬ä¸­çš„ç¨±å‘¼ï¼Œåœ¨ä»¥å‰çš„ç‰ˆæœ¬é‡Œé¢å«èµ·å§‹äº‹ä»¶ï¼ˆStart Eventï¼‰ã€‚</p>
<p>ã€€ã€€åœ¨ v4 ç‰ˆæœ¬ä¸­é€™å€‹äº‹ä»¶çš„çµæ§‹å¦‚ä¸‹é¢çš„ ASCII Diagram æ‰€ç¤ºã€‚</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">+=====================================+</span><br><span class="line">|<span class="string"> event  </span>|<span class="string"> timestamp         0 : 4    </span>|</span><br><span class="line">|<span class="string"> header +----------------------------+</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> type_code         4 : 1    </span>|<span class="string"> = FORMAT_DESCRIPTION_EVENT = 15</span><br><span class="line"></span>|<span class="string">        +----------------------------+</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> server_id         5 : 4    </span>|</span><br><span class="line">|<span class="string">        +----------------------------+</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> event_length      9 : 4    </span>|<span class="string"> &gt;= 91</span><br><span class="line"></span>|<span class="string">        +----------------------------+</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> next_position    13 : 4    </span>|</span><br><span class="line">|<span class="string">        +----------------------------+</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> flags            17 : 2    </span>|</span><br><span class="line">+=====================================+</span><br><span class="line">|<span class="string"> event  </span>|<span class="string"> binlog_version   19 : 2    </span>|<span class="string"> = 4</span><br><span class="line"></span>|<span class="string"> data   +----------------------------+</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> server_version   21 : 50   </span>|</span><br><span class="line">|<span class="string">        +----------------------------+</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> create_timestamp 71 : 4    </span>|</span><br><span class="line">|<span class="string">        +----------------------------+</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> header_length    75 : 1    </span>|</span><br><span class="line">|<span class="string">        +----------------------------+</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> post-header      76 : n    </span>|<span class="string"> = array of n bytes, one byte per event</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> lengths for all            </span>|<span class="string">   type that the server knows about</span><br><span class="line"></span>|<span class="string">        </span>|<span class="string"> event types                </span>|</span><br><span class="line">+=====================================+</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™å€‹äº‹ä»¶çš„ <code>type_code</code> æ˜¯ 15ï¼Œç„¶å¾Œ <code>event_length</code> æ˜¯å¤§æ–¼ç­‰æ–¼ 91 çš„å€¼çš„ï¼Œé€™å€‹ä¸»è¦å–æ±ºæ–¼æ‰€æœ‰äº‹ä»¶é¡å‹æ•¸ã€‚</p>
<p>ã€€ã€€å› çˆ²å¾ç¬¬ 76 å­—ç¯€é–‹å§‹å¾Œé¢çš„äºŒé€²åˆ¶å°±ä»£è¡¨ä¸€å€‹å­—ç¯€é¡å‹çš„æ•¸çµ„äº†ï¼Œä¸€å€‹å­—ç¯€ä»£è¡¨ä¸€å€‹äº‹ä»¶é¡å‹çš„ <code>post-header</code> é•·åº¦ï¼Œå³æ¯å€‹äº‹ä»¶é¡å‹å›ºå®šæ•¸æ“šçš„é•·åº¦ã€‚</p>
<p>ã€€ã€€é‚£éº¼æŒ‰ç…§ä¸Šè¿°çš„ä¸€äº›ç·šç´¢ä¾†çœ‹ï¼Œæˆ‘å€‘èƒ½éå¸¸å¿«åœ°å¯«å‡ºä¸€å€‹ç°¡å–®çš„è§£è®€ Binlog æ ¼å¼æè¿°äº‹ä»¶çš„ä»£ç¢¼ã€‚</p>
<blockquote>
<p>å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œå¦‚æœéœ€è¦æ­£å¸¸è§£è®€ Binlog æ–‡ä»¶çš„è©±ï¼Œä¸‹é¢çš„ä»£ç¢¼ç·¨è­¯æ™‚å€™éœ€è¦åŠ ä¸Š <code>-fpack-struct=1</code> é€™å€‹åƒæ•¸ã€‚</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> BinlogEventHeader</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span>  timestamp;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> type_code;</span><br><span class="line">    <span class="keyword">int</span>  server_id;</span><br><span class="line">    <span class="keyword">int</span>  event_length;</span><br><span class="line">    <span class="keyword">int</span>  next_position;</span><br><span class="line">    <span class="keyword">short</span> flags;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    FILE* fp = fopen(<span class="string">"/usr/local/var/mysql/master-bin.000001"</span>, <span class="string">"rb"</span>);</span><br><span class="line">    <span class="keyword">int</span> magic_number;</span><br><span class="line">    fread(&amp;magic_number, <span class="number">4</span>, <span class="number">1</span>, fp);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d - %s\n"</span>, magic_number, (<span class="keyword">char</span>*)(&amp;magic_number));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> BinlogEventHeader format_description_event_header;</span><br><span class="line">    fread(&amp;format_description_event_header, <span class="number">19</span>, <span class="number">1</span>, fp);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"BinlogEventHeader\n&#123;\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    timestamp: %d\n"</span>, format_description_event_header.timestamp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    type_code: %d\n"</span>, format_description_event_header.type_code);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    server_id: %d\n"</span>, format_description_event_header.server_id);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    event_length: %d\n"</span>, format_description_event_header.event_length);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    next_position: %d\n"</span>, format_description_event_header.next_position);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    flags[]: %d\n&#125;\n"</span>, format_description_event_header.flags);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">short</span> binlog_version;</span><br><span class="line">    fread(&amp;binlog_version, <span class="number">2</span>, <span class="number">1</span>, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"binlog_version: %d\n"</span>, binlog_version);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> server_version[<span class="number">51</span>];</span><br><span class="line">    fread(server_version, <span class="number">50</span>, <span class="number">1</span>, fp);</span><br><span class="line">    server_version[<span class="number">50</span>] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"server_version: %s\n"</span>, server_version);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> create_timestamp;</span><br><span class="line">    fread(&amp;create_timestamp, <span class="number">4</span>, <span class="number">1</span>, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create_timestamp: %d\n"</span>, create_timestamp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> header_length;</span><br><span class="line">    fread(&amp;header_length, <span class="number">1</span>, <span class="number">1</span>, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"header_length: %d\n"</span>, header_length);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> type_count = format_description_event_header.event_length - <span class="number">76</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> post_header_length[type_count];</span><br><span class="line">    fread(post_header_length, <span class="number">1</span>, type_count, fp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; type_count; i++) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"  - type %d: %d\n"</span>, i + <span class="number">1</span>, post_header_length[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™å€‹æ™‚å€™ä½ å¾—åˆ°çš„çµæœæœ‰å¯èƒ½å°±æ˜¯é€™æ¨£çš„äº†ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1852400382</span> - ï¿½binpzï¿½</span><br><span class="line">BinlogEventHeader</span><br><span class="line">&#123;</span><br><span class="line">    timestamp: <span class="number">1439186734</span></span><br><span class="line">    type_code: <span class="number">15</span></span><br><span class="line">    server_id: <span class="number">1</span></span><br><span class="line">    event_length: <span class="number">116</span></span><br><span class="line">    next_position: <span class="number">120</span></span><br><span class="line">    flags[]: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">binlog_version: <span class="number">4</span></span><br><span class="line">server_version: <span class="number">5.6</span><span class="number">.24</span>-<span class="built_in">log</span></span><br><span class="line">create_timestamp: <span class="number">1439186734</span></span><br><span class="line">header_length: <span class="number">19</span></span><br><span class="line">  - type <span class="number">1</span>: <span class="number">56</span></span><br><span class="line">  - type <span class="number">2</span>: <span class="number">13</span></span><br><span class="line">  - type <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">  - type <span class="number">4</span>: <span class="number">8</span></span><br><span class="line">  - type <span class="number">5</span>: <span class="number">0</span></span><br><span class="line">  - type <span class="number">6</span>: <span class="number">18</span></span><br><span class="line">  - ...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä¸€å…±æœƒè¼¸å‡º 40 ç¨®é¡å‹ï¼ˆå¾ 1 åˆ° 40ï¼‰ï¼Œå¦‚å®˜æ–¹æ–‡æª”æ‰€èªªï¼Œé€™å€‹æ•¸çµ„å¾ <code>START_EVENT_V3</code> äº‹ä»¶é–‹å§‹ï¼ˆ<code>type_code</code> æ˜¯ 1ï¼‰ã€‚</p>
<h5 id="è·³è½‰äº‹ä»¶">è·³è½‰äº‹ä»¶</h5><p>ã€€ã€€è·³è½‰äº‹ä»¶å³ <code>ROTATE_EVENT</code>ï¼Œå…¶ <code>type_code</code> æ˜¯ 4ï¼Œå…¶ <code>post-header</code> é•·åº¦çˆ² 8ã€‚</p>
<p>ã€€ã€€ç•¶ä¸€å€‹ Binlog æ–‡ä»¶å¤§å°å·²ç¶“å·®ä¸å¤šè¦åˆ†å‰²äº†ï¼Œå®ƒå°±æœƒåœ¨æœ«å°¾è¢«å¯«å…¥ä¸€å€‹ <code>ROTATE_EVENT</code>â€”â€”ç”¨æ–¼æŒ‡å‡ºé€™å€‹ Binlog çš„ä¸‹ä¸€å€‹æ–‡ä»¶ã€‚</p>
<p>ã€€ã€€å®ƒçš„ <code>post-header</code> æ˜¯ 8 å­—ç¯€çš„ä¸€å€‹æ±è¥¿ï¼Œå…§å®¹é€šå¸¸å°±æ˜¯ä¸€å€‹æ•´æ•¸ <code>4</code>ï¼Œç”¨æ–¼è¡¨ç¤ºä¸‹ä¸€å€‹ Binlog æ–‡ä»¶ä¸­çš„ç¬¬ä¸€å€‹äº‹ä»¶èµ·å§‹åç§»é‡ã€‚æˆ‘å€‘å¾ä¸Šæ–‡å°±èƒ½å¾—å‡ºåœ¨ä¸€èˆ¬æƒ…æ³ä¸‹é€™å€‹æ•¸å­—åªå¯èƒ½æ˜¯å››ï¼Œå°±åç§»äº†ä¸€å€‹é­”æ³•æ•¸å­—ã€‚ç•¶ç„¶æˆ‘å€‘è¬›çš„æ˜¯åœ¨ v4 é€™å€‹ Binlog ç‰ˆæœ¬ä¸‹çš„æƒ…æ³ã€‚</p>
<p>ã€€ã€€ç„¶å¾Œåœ¨ <code>payload</code> ä½ç½®æ˜¯ä¸€å€‹å­—ç¬¦ä¸²ï¼Œå³ä¸‹ä¸€å€‹ Binlog æ–‡ä»¶çš„æ–‡ä»¶åã€‚</p>
<h5 id="å„ç¨®ä¸åŒçš„äº‹ä»¶é«”">å„ç¨®ä¸åŒçš„äº‹ä»¶é«”</h5><p>ã€€ã€€ç”±æ–¼ç¯‡å¹…åŸå› é€™è£å°±ä¸è©³ç´°èˆ‰ä¾‹å…¶å®ƒæ™®é€šçš„ä¸åŒäº‹ä»¶é«”äº†ï¼Œå…·é«”çš„è©³è§£åœ¨ <a href="http://dev.mysql.com/doc/internals/en/event-data-for-specific-event-types.html" target="_blank" rel="external">MySQL æ–‡æª”</a>ä¸­ä¸€æ¨£æœ‰ä»‹ç´¹ï¼Œç”¨åˆ°ä»€éº¼é¡å‹çš„äº‹ä»¶é«”å°±å¯ä»¥è‡ªå·±å»æŸ¥è©¢ã€‚</p>
<h2 id="å°çµ">å°çµ</h2><p>ã€€ã€€æœ¬æ–‡å¤§æ¦‚ä»‹ç´¹äº† Binlog çš„ä¸€äº›æƒ…æ³ï¼Œä»¥åŠ Binlog çš„å…§éƒ¨äºŒé€²åˆ¶è§£æçµæ§‹ã€‚æ–¹ä¾¿å¤§å®¶é€ è¼ªå­ç”¨â€”â€”ä¸ç„¶è€ç”¨åˆ¥äººçš„è¼ªå­ï¼ŒåªçŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶å¤šæ²’å‹ã€‚</p>
<p>ã€€ã€€å¥½äº†è¦ä¸‹ç­äº†ï¼Œå°±å¯«åˆ°é€™è£éå§ã€‚</p>
<h2 id="åƒè€ƒ">åƒè€ƒ</h2><ol>
<li><a href="http://my.oschina.net/leejun2005/blog/75273" target="_blank" rel="external">MySQLâ€™s binary log çµæ§‹ç°¡ä»‹</a>ï¼Œç›®æ¸¬åŸæ–‡åœ¨ <a href="http://www.taobaodba.com/html/474_mysqls-binary-log_details.html" target="_blank" rel="external">TaobaoDBA</a>ï¼ˆå·²ç„¡æ³•è¨ªå•ï¼‰</li>
<li><a href="http://www.linuxidc.com/Linux/2014-09/107095.htm" target="_blank" rel="external">MySQL Binlog çš„ä»‹ç´¹</a></li>
<li><a href="http://blog.csdn.net/jolly10/article/details/13998761" target="_blank" rel="external">MySQL çš„ binary log åˆæ¢</a></li>
<li><a href="http://dev.mysql.com/doc/internals/en/binary-log-structure-and-contents.html" target="_blank" rel="external">High-Level Binary Log Structure and Contents</a> and related official documents</li>
<li><a href="http://stackoverflow.com/questions/21912098/pragma-pack-vs-fpack-struct-for-intel-c" target="_blank" rel="external">#pragma pack vs -fpack-struct for Intel C</a></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€èŠ±ç“£ç¶²çš„æœç´¢æ¶æ§‹éœ€è¦é‡æ§‹ï¼Œå°¤å…¶æ˜¯åœ¨ç´¢å¼•å»ºç«‹æˆ–è€…æ›´æ–°å±¤é¢ã€‚</p>
<p>ã€€ã€€ç›®å‰çš„ä¸€å€‹æ¶æ§‹å°è‡´çš„çµæœå°±æ˜¯æ™‚é–“è¶Šä¹…ï¼Œæ•¸æ“šæœ¬é«”èˆ‡æœç´¢å¼•æ“ç´¢å¼•ä¸­çš„æ•¸æ“šè¶Šä¸åŒæ­¥ï¼Œç›¸å·®ç”šå¤§ã€‚</p>
<p>ã€€ã€€æ–°çš„ä¸€å€‹æ¶æ§‹æ‰“ç®—å¾ MySQL çš„ Binlog ä¸­è®€å–æ•¸æ“šæ›´æ–°ã€åˆªé™¤ã€æ–°å¢ç­‰æ­·å²è¨˜éŒ„]]>
    </summary>
    
      <category term="Binary Log" scheme="http://xcoder.in/tags/Binary-Log/"/>
    
      <category term="Binlog" scheme="http://xcoder.in/tags/Binlog/"/>
    
      <category term="MySQL" scheme="http://xcoder.in/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Node.js ä¸­ä½¿ç”¨ Redis ä¾†å¯¦ç¾å®šæ™‚ä»»å‹™]]></title>
    <link href="http://xcoder.in/2015/06/05/scheduled-task-using-redis/"/>
    <id>http://xcoder.in/2015/06/05/scheduled-task-using-redis/</id>
    <published>2015-06-05T07:23:51.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€å¥½ä¹…æ²’å¯«åšæ–‡äº†ï¼Œæœ€è¿‘åœ¨è·Ÿéš¨ç€å…¬å¸å¤§ç‰›å€‘çš„è…³æ­¥ç¥•å¯†ç ”ç™¼æ–°ç”¢å“ä¸­ã€‚</p>
<p>ã€€ã€€ä¸éå‰å¹¾å¤©æœ‰ä¸€å€‹å°éœ€æ±‚çš„æ±è¥¿å¯ä»¥æå‡ºä¾†å¯«ä¸€é»é»å°ä¹¾è²¨å…’è·Ÿå¤§å®¶åˆ†äº«åˆ†äº«ã€‚ç±³å¨œæ¡‘æœƒçš„å°±å¯ä»¥å¿½ç•¥äº†ï¼Œåæ­£æˆ‘ä¹Ÿæ˜¯éš¨ä¾¿å¯«çš„ï¼›å¦‚æœè¦ºå¾—æœ¬æ–‡å°ä½ æœ‰ç”¨çš„è©±é‚„è«‹å¤šå¤šæ”¯æŒå–µã€‚(â—Â´Ï‰ï½€â—)ã‚</p>
<h2 id="åº">åº</h2><p>ã€€ã€€æœ¬æ–‡æ‰€èªªçš„å®šæ™‚ä»»å‹™æˆ–è€…èªªè¨ˆåŠƒä»»å‹™ä¸¦ä¸æ˜¯å¾ˆå¤šäººæƒ³è±¡ä¸­çš„é‚£æ¨£ï¼Œæ¯”å¦‚èªªæ¯å¤©å‡Œæ™¨ä¸‰é»è‡ªå‹•é‹è¡Œèµ·ä¾†è·‘ä¸€å€‹è…³æœ¬ã€‚é€™ç¨®éƒ½å·²ç¶“çˆ›å¤§è¡—äº†ï¼Œéš¨ä¾¿ä¸€å€‹ <strong><a href="https://wiki.archlinux.org/index.php/Cron" target="_blank" rel="external">Crontab</a></strong> å°±èƒ½æå®šäº†ã€‚</p>
<p>ã€€ã€€é€™è£æ‰€èªªçš„å®šæ™‚ä»»å‹™å¯ä»¥èªªæ˜¯è¨ˆæ™‚å™¨ä»»å‹™ï¼Œæ¯”å¦‚èªªç”¨æˆ¶è§¸ç™¼äº†æŸå€‹å‹•ä½œï¼Œé‚£éº¼å¾é€™å€‹é»é–‹å§‹éäºŒåå››å°æ™‚æˆ‘å€‘è¦å°é€™å€‹å‹•ä½œåšé»ä»€éº¼ã€‚é‚£éº¼å¦‚æœæœ‰ 1000 å€‹ç”¨æˆ¶è§¸ç™¼äº†é€™å€‹å‹•ä½œï¼Œå°±æœƒæœ‰ 1000 å€‹å®šæ™‚ä»»å‹™ã€‚æ–¼æ˜¯é€™å°±ä¸æ˜¯ <strong>Cron</strong> ç¯„ç–‡è£é¢çš„å…§å®¹äº†ã€‚</p>
<p>ã€€ã€€èˆ‰å€‹æœ€ç°¡å–®çš„ä¾‹å­ï¼Œä¸€å€‹ç”¨æˆ¶æ¨è–¦äº†å¦ä¸€å€‹ç”¨æˆ¶ï¼Œæˆ‘å€‘å®šä¸€å€‹äºŒåå››å°æ™‚ä¹‹å¾Œçš„ä»»å‹™ï¼Œçœ‹çœ‹è¢«æ¨è–¦çš„ç”¨æˆ¶æœ‰æ²’æœ‰ä¾†è¨»å†Šï¼Œå¦‚æœæ²’è¨»å†Šå°±çµ¦ä»–æä¸€æ¢çŸ­ä¿¡éå»ã€‚Î£&gt;â€•(ã€ƒÂ°Ï‰Â°ã€ƒ)â™¡â†’</p>
<h2 id="æœ€åˆçš„è¨­æƒ³">æœ€åˆçš„è¨­æƒ³</h2><p>ã€€ã€€ä¸€é–‹å§‹æˆ‘æ˜¯æƒ³æŠŠé€™å€‹è¨ˆæ™‚å™¨åšåœ¨å…§å­˜è£é¢ç›´æ¥èª¿ç”¨çš„ã€‚</p>
<p>ã€€ã€€è€ƒæ…®åˆ° Node.js çš„å®šæ™‚ä¸¦ä¸æ˜¯é‚£éº¼æº–ç¢ºï¼ˆç„¡è«–æ˜¯ <code>setTimeout</code> é‚„æ˜¯ <code>setInterval</code>ï¼‰ï¼Œæ‰€ä»¥æœ¬ä¾†æ‰“ç®—è‡ªå·±ç¶­è­·é€™å€‹å®šæ™‚å™¨éšŠåˆ—ã€‚</p>
<p>ã€€ã€€åˆè€ƒæ…®åˆ° Node.js åŸç”Ÿå°è±¡æ¯”è¼ƒè€—å…§å­˜ã€‚ä¹‹å‰æˆ‘ç”¨ <code>JSON</code> å°è±¡å­˜äº†ä¸€æœ¬å­—å…¸ï¼Œç´„åäºŒè¬å¤šçš„è©æ¢ï¼ŒåŸæ–‡ä»¶å¤§æ¦‚ä¹Ÿå°±äº”å…­å…†ï¼Œç”¨ Node.js çš„åŸç”Ÿå°è±¡ä¸€å­˜å±…ç„¶æœ‰äº”å…­ç™¾å…†çš„å…§å­˜ä½”ç”¨â€”â€”æ‰€ä»¥æ‰“ç®—é€™å€‹å®šæ™‚å™¨éšŠåˆ—ç”¨ C++ ä¾†å¯« addonã€‚</p>
<p>ã€€ã€€è€ƒæ…®åˆ°ä»»ä½•æ™‚å€™æ’å…¥çš„ä»»å‹™éƒ½æœ‰å¯èƒ½åœ¨å·²æœ‰çš„ä»»å‹™ä¹‹å‰æˆ–è€…ä¹‹å¾Œï¼Œæ‰€ä»¥æœ¬ä¾†æƒ³ç”¨ C++ ä¾†å¯«ä¸€å€‹<a href="http://zh.wikipedia.org/wiki/%E6%9C%80%E5%A4%A7%E2%80%94%E6%9C%80%E5%B0%8F%E5%A0%86" target="_blank" rel="external">å°æ ¹å †</a>ã€‚æ¯æ¬¡ç”¨æˆ¶ä¾†ä¸€å€‹ä»»å‹™çš„æ™‚å€™å°±å°‡é€™å€‹ä»»å‹™æ’å…¥åˆ°å †ä¸­ã€‚</p>
<p>ã€€ã€€å¦‚æœæŒ‰ç…§ä¸Šè¿°æ–¹æ³•çš„è©±ï¼Œå†åŠ ä¸Šå°æ™‚é–“è¦æ±‚æå¾—ä¹Ÿä¸æ˜¯é‚£éº¼ç·Šï¼Œæ–¼æ˜¯å°±æ˜¯ä¸€å€‹ä¸æ–·çš„ <code>process.nextTick()</code> çš„éç¨‹ã€‚</p>
<p>ã€€ã€€åœ¨ <code>process.nextTick()</code> ç•¶ä¸­åŸ·è¡Œé€™éº¼ä¸€å€‹å‡½æ•¸ï¼š</p>
<ol>
<li>å¾å°æ ¹å †ä¸­ä¸æ–·ç²å–å †é ‚çš„ä»»å‹™ä¸¦è™•ç†ï¼Œä¸€ç›´è™•ç†åˆ°å †é ‚ä»»å‹™çš„åŸ·è¡Œæ™‚é–“å¤§æ–¼ç•¶å‰æ™‚é–“çˆ²æ­¢ã€‚</li>
<li>ç¹¼çºŒ <code>process.nextTick()</code> ä¾†è®“ä¸‹ä¸€å€‹ tick åŸ·è¡Œæ­¥é©Ÿ 1 ä¸­çš„æµç¨‹ã€‚</li>
</ol>
<p>ã€€ã€€æ‰€ä»¥æœ€å¾Œå°±æ˜¯ä¸€é‚Šå¾€å°æ ¹å †æ’å…¥ä»»å‹™ï¼Œå¦ä¸€é‚Šé€šéä¸æ–· <code>process.nextTick()</code> æ¶ˆè²»ä»»å‹™çš„é€™éº¼ä¸€å€‹éç¨‹ã€‚</p>
<p>ã€€ã€€æœ€å¾Œï¼Œçˆ²äº†è€ƒæ…®åˆ°ç¨‹åºé‡å•“çš„æ™‚å€™å…§å­˜æ•¸æ“šæœƒä¸Ÿå¤±ï¼Œé‚„æ‡‰è©²åšä¸€å€‹æŒä¹…åŒ–çš„äº‹æƒ…â€”â€”åœ¨æ¯æ¬¡æ’å…¥ä»»å‹™çš„æ™‚å€™é †ä¾¿å¾€æŒä¹…åŒ–ä¸­é–“ä»¶ä¸­æ’ä¸€æ¢å‰¯æœ¬ï¼Œæ¯”å¦‚ MySQLã€MongoDBã€Redisã€Riak ç­‰ç­‰ä»»ä½•ä¸‰æ–¹ä¾è³´ã€‚æ¶ˆè²»ä»»å‹™çš„æ™‚å€™é †ä¾¿æŠŠä¸­é–“ä»¶ä¸­çš„é€™æ¢ä»»å‹™æ•¸æ“šçµ¦åˆªé™¤ã€‚</p>
<p>ã€€ã€€ä¹Ÿå°±æ˜¯èªªä¸­é–“ä»¶ä¸­æ°¸é å­˜çš„å°±æ˜¯ç•¶å‰å°šæœªå®Œæˆçš„ä»»å‹™ã€‚æ¯ç•¶ç¨‹åºé‡å•“çš„æ™‚å€™éƒ½å…ˆå¾ä¸­é–“ä»¶ä¸­æŠŠæ‰€æœ‰ä»»å‹™è®€å–é€²ä¾†é‡å»ºä¸€ä¸‹å †ï¼Œç„¶å¾Œå°±èƒ½ç¹¼çºŒå·¥ä½œäº†ã€‚</p>
<blockquote>
<p>å¦‚æœç•¶æ™‚æˆ‘æ²’æœ‰ç™¼ç¾ Redis çš„é€™å€‹å¦™ç”¨çš„è©±ï¼Œä¸Šè¿°çš„æµç¨‹å°‡æœƒæ˜¯æˆ‘å¯¦ç¾æˆ‘å€‘å®šæ™‚ä»»å‹™çš„æµç¨‹äº†ã€‚</p>
</blockquote>
<h2 id="Redis_å¦™ç”¨">Redis å¦™ç”¨</h2><p>ã€€ã€€åœ¨ Redis çš„ 2.8.0 ç‰ˆæœ¬ä¹‹å¾Œï¼Œå…¶æ¨å‡ºäº†ä¸€å€‹æ–°çš„ç‰¹æ€§â€”â€”éµç©ºé–“æ¶ˆæ¯ï¼ˆ<a href="http://redis.io/topics/notifications" target="_blank" rel="external">Redis Keyspace Notifications</a>ï¼‰ï¼Œå®ƒé…åˆ 2.0.0 ç‰ˆæœ¬ä¹‹å¾Œçš„ <code>SUBSCRIBE</code> å°±èƒ½å®Œæˆé€™å€‹å®šæ™‚ä»»å‹™çš„æ“ä½œäº†ï¼Œ<strong>ä¸éå®šæ™‚çš„å–®ä½æ˜¯ç§’</strong>ã€‚</p>
<h3 id="Publish_/_Subscribe">Publish / Subscribe</h3><p>ã€€ã€€Redis åœ¨ 2.0.0 ä¹‹å¾Œæ¨å‡ºäº† <a href="http://redis.io/topics/pubsub" target="_blank" rel="external">Pub / Sub</a> çš„æŒ‡ä»¤ï¼Œå¤§è‡´å°±æ˜¯èªªä¸€é‚Šçµ¦ Redis çš„ç‰¹å®šé »é“ç™¼é€æ¶ˆæ¯ï¼Œå¦ä¸€é‚Šå¾ Redis çš„ç‰¹å®šé »é“å–å€¼â€”â€”å½¢æˆäº†ä¸€å€‹ç°¡æ˜“çš„æ¶ˆæ¯éšŠåˆ—</p>
<p>ã€€ã€€æ¯”å¦‚æˆ‘å€‘å¯ä»¥å¾€ <code>foo</code> é »é“æ¨ä¸€å€‹æ¶ˆæ¯ <code>bar</code>ï¼Œé‚£éº¼å°±å¯ä»¥ç›´æ¥ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">PUBLISH</span> foo bar</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¦ä¸€é‚Šæˆ‘å€‘åœ¨å®¢æˆ¶ç«¯è¨‚é–± <code>foo</code> é »é“å°±èƒ½æ¥å—åˆ°é€™å€‹æ¶ˆæ¯äº†ã€‚</p>
<p>ã€€ã€€èˆ‰å€‹ä¾‹å­ï¼Œå¦‚æœåœ¨ Node.js è£é¢ä½¿ç”¨ <a href="https://github.com/luin/ioredis" target="_blank" rel="external">ioredis</a> é€™å€‹åŒ…é‚£éº¼çœ‹èµ·ä¾†å°±æœƒåƒé€™æ¨£ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Redis = <span class="built_in">require</span>(<span class="string">"ioredis"</span>);</span><br><span class="line"><span class="keyword">var</span> sub = <span class="keyword">new</span> Redis(<span class="comment">/** é€£æ¥ä¿¡æ¯ */</span>);</span><br><span class="line">sub.once(<span class="string">"connect"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å‡è¨­æˆ‘å€‘éœ€è¦é¸æ“‡ redis çš„ dbï¼Œå› çˆ²å¯¦éš›ä¸Šæˆ‘å€‘ä¸æœƒå»æ±¡æŸ“é»˜èªçš„ db 0</span></span><br><span class="line">    sub.select(DB_NUMBER, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) process.exit(<span class="number">4</span>);</span><br><span class="line">        sub.subscribe(<span class="string">"foo"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//... è¨‚é–±é »é“æˆåŠŸ</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›£è½å¾ `foo` ä¾†çš„æ¶ˆæ¯</span></span><br><span class="line">sub.on(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">channel, msg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(channel, msg);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Redis_Keyspace_Notifications">Redis Keyspace Notifications</h3><p>ã€€ã€€åœ¨ Redis è£é¢æœ‰ä¸€äº›äº‹ä»¶ï¼Œæ¯”å¦‚éµåˆ°æœŸã€éµè¢«åˆªé™¤ç­‰ã€‚ç„¶å¾Œæˆ‘å€‘å¯ä»¥é€šéé…ç½®ä¸€äº›æ±è¥¿ä¾†è®“ Redis ä¸€æ—¦è§¸ç™¼é€™äº›äº‹ä»¶çš„æ™‚å€™å°±å¾€ç‰¹å®šçš„ Channel æ¨ä¸€æ¢æ¶ˆæ¯ã€‚</p>
<p>ã€€ã€€æœ¬æ–‡æ‰€æ¶‰åŠåˆ°çš„éœ€æ±‚çš„è©±æˆ‘å€‘æ‰€éœ€è¦é—œå¿ƒçš„äº‹ä»¶æ˜¯ <code>EXPIRE</code> å³éæœŸäº‹ä»¶ã€‚</p>
<p>ã€€ã€€å¤§è‡´çš„æµç¨‹å°±æ˜¯æˆ‘å€‘çµ¦ Redis çš„æŸä¸€å€‹ db è¨­ç½®éæœŸäº‹ä»¶ï¼Œä½¿å…¶éµä¸€æ—¦éæœŸå°±æœƒå¾€ç‰¹å®šé »é“æ¨æ¶ˆæ¯ï¼Œæˆ‘åœ¨è‡ªå·±çš„å®¢æˆ¶ç«¯é€™é‚Šå°±ä¸€ç›´æ¶ˆè²»é€™å€‹é »é“å°±å¥½äº†ã€‚</p>
<p>ã€€ã€€ä»¥å¾Œä¸€ä¾†ä¸€æ¢å®šæ™‚ä»»å‹™ï¼Œæˆ‘å€‘å°±æŠŠé€™å€‹ä»»å‹™ç‹€æ…‹å£“ç¸®æˆä¸€å€‹éµï¼Œä¸¦ä¸”éæœŸæ™‚é–“çˆ²è·é€™å€‹ä»»å‹™åŸ·è¡Œçš„æ™‚é–“å·®ã€‚é‚£éº¼ç•¶éµä¸€æ—¦åˆ°æœŸï¼Œå°±åˆ°äº†ä»»å‹™è©²åŸ·è¡Œçš„æ™‚é–“ï¼ŒRedis è‡ªç„¶æœƒæŠŠéæœŸæ¶ˆæ¯æ¨å»ï¼Œæˆ‘å€‘çš„å®¢æˆ¶ç«¯å°±èƒ½æ¥æ”¶åˆ°äº†ã€‚é€™æ¨£ä¸€ä¾†å°±èµ·åˆ°äº†å®šæ™‚ä»»å‹™çš„ä½œç”¨ã€‚</p>
<h4 id="æ¶ˆæ¯é¡å‹">æ¶ˆæ¯é¡å‹</h4><p>ã€€ã€€ç•¶é”åˆ°ä¸€å®šæ¢ä»¶å¾Œï¼Œæœ‰å…©ç¨®é¡å‹çš„é€™ç¨®æ¶ˆæ¯æœƒè¢«è§¸ç™¼ï¼Œç”¨å“ªå€‹éœ€è¦è‡ªå·±é¸äº†ã€‚èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘åˆªé™¤äº†åœ¨ db 0 ä¸­ä¸€å€‹å« <code>foo</code> çš„éµï¼Œé‚£éº¼ç³»çµ±æœƒå¾€å…©å€‹é »é“æ¨æ¶ˆæ¯ï¼Œä¸€å€‹æ˜¯ <code>del</code> äº‹ä»¶é »é“æ¨ <code>foo</code> æ¶ˆæ¯ï¼Œå¦ä¸€å€‹æ˜¯ <code>foo</code> é »é“æ¨ <code>del</code> æ¶ˆæ¯ï¼Œå®ƒå€‘å°å€†å£è¢«ç³»çµ±æ¨é€çš„æŒ‡ä»¤åˆ†åˆ¥ç­‰åƒ¹æ–¼ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">PUBLISH</span> __keyspace<span class="variable">@0__</span><span class="symbol">:foo</span> del</span><br><span class="line"><span class="constant">PUBLISH</span> __keyevent<span class="variable">@0__</span><span class="symbol">:del</span> foo</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å…¶ä¸­å¾€ <code>foo</code> æ¨é€ <code>del</code> çš„é »é“åçˆ² <code>__keyspace@0__:foo</code>ï¼Œå³æ˜¯ <code>&quot;__keyspace@&quot; + DB_NUMBER + &quot;__:&quot; + KEY_NAME</code>ï¼›è€Œ <code>del</code> çš„é »é“åçˆ² <code>&quot;__keyevent@&quot; + DB_NUMBER + &quot;__:&quot; + EVENT_NAME</code>ã€‚</p>
<h4 id="é…ç½®">é…ç½®</h4><p>ã€€ã€€å³ä½¿ä½ çš„ Redis ç‰ˆæœ¬é”æ¨™äº†ï¼Œä½†æ˜¯ Redis é»˜èªæ˜¯é—œé–‰é€™å€‹åŠŸèƒ½çš„ï¼Œä½ éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ä¾†æ‰“é–‹å®ƒï¼Œæˆ–è€…ç›´æ¥åœ¨ CLI è£é¢é€šéæŒ‡ä»¤ä¿®æ”¹ã€‚é€™è£å°±èªªèªªé…ç½®æ–‡ä»¶çš„ä¿®æ”¹å§ã€‚</p>
<p>ã€€ã€€å¦‚æœä¸æƒ³çœ‹æˆ‘åœ¨é€™è£ç¾…è£å§å—¦çš„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å»çœ‹ Redis çš„<a href="http://redis.io/topics/notifications#configuration" target="_blank" rel="external">ç›¸é—œæ–‡æª”</a>ã€‚</p>
<p>ã€€ã€€é¦–å…ˆæ‰“é–‹ Redis çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸åŒçš„ç³»çµ±å’Œå®‰è£æ–¹å¼ä¸‹æ–‡ä»¶ä½ç½®å¯èƒ½ä¸åŒï¼Œæ¯”å¦‚é€šé <code>brew</code> å®‰è£çš„ MacOS ä¸‹å¯èƒ½æ˜¯åœ¨ <code>/usr/local/etc/redis.conf</code> ä¸‹é¢ï¼Œé€šé <code>apt-get</code> å®‰è£çš„ Ubuntu ä¸‹å¯èƒ½æ˜¯åœ¨ <code>/etc/redis/redis.conf</code> ä¸‹ï¼Œç¸½ä¹‹æ‰¾åˆ°é…ç½®æ–‡ä»¶ã€‚<strong>æˆ–è€…è‡ªå·±å¯«ä¸€å€‹é…ç½®æ–‡ä»¶ï¼Œå•“å‹•çš„æ™‚å€™æŒ‡å®šé…ç½®æ–‡ä»¶åœ°å€å°±å¥½ã€‚</strong></p>
<p>ã€€ã€€ç„¶å¾Œæ‰¾åˆ°ä¸€é …å« <code>notify-keyspace-events</code> çš„åœ°æ–¹ï¼Œå¦‚æœæ‰¾ä¸åˆ°å‰‡è‡ªè¡Œæ·»åŠ ï¼Œå…¶å€¼å¯ä»¥æ˜¯ <code>Ex</code>ã€<code>Klg</code> ç­‰ç­‰ã€‚é€™äº›å­—æ¯çš„å…·é«”å«ç¾©å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li><strong>K</strong>ï¼Œè¡¨ç¤º <code>keyspace</code> äº‹ä»¶ï¼Œæœ‰é€™å€‹å­—æ¯è¡¨ç¤ºæœƒå¾€ <code>__keyspace@&lt;db&gt;__</code> é »é“æ¨æ¶ˆæ¯ã€‚</li>
<li><strong>E</strong>ï¼Œè¡¨ç¤º <code>keyevent</code> äº‹ä»¶ï¼Œæœ‰é€™å€‹å­—æ¯è¡¨ç¤ºæœƒå¾€ <code>__keyevent@&lt;db&gt;__</code> é »é“æ¨æ¶ˆæ¯ã€‚</li>
<li><strong>g</strong>ï¼Œè¡¨ç¤ºä¸€äº›é€šç”¨æŒ‡ä»¤äº‹ä»¶æ”¯æŒï¼Œå¦‚ <code>DEL</code>ã€<code>EXPIRE</code>ã€<code>RENAME</code> ç­‰ç­‰ã€‚</li>
<li><strong>$</strong>ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ï¼ˆStringï¼‰ç›¸é—œæŒ‡ä»¤çš„äº‹ä»¶æ”¯æŒã€‚</li>
<li><strong>l</strong>ï¼Œè¡¨ç¤ºåˆ—è¡¨ï¼ˆListï¼‰ç›¸é—œæŒ‡ä»¤äº‹ä»¶æ”¯æŒã€‚</li>
<li><strong>s</strong>ï¼Œè¡¨ç¤ºé›†åˆï¼ˆSetï¼‰ç›¸é—œæŒ‡ä»¤äº‹ä»¶æ”¯æŒã€‚</li>
<li><strong>h</strong>ï¼Œå“ˆå¸Œï¼ˆHashï¼‰ç›¸é—œæŒ‡ä»¤äº‹ä»¶æ”¯æŒã€‚</li>
<li><strong>z</strong>ï¼Œæœ‰åºé›†ï¼ˆSorted Setï¼‰ç›¸é—œæŒ‡ä»¤äº‹ä»¶æ”¯æŒã€‚</li>
<li><strong>x</strong>ï¼ŒéæœŸäº‹ä»¶ï¼Œèˆ‡ <strong>g</strong> ä¸­çš„ <code>EXPIRE</code> ä¸åŒçš„æ˜¯ï¼Œ<strong>g</strong> çš„ <code>EXPIRE</code> æ˜¯æŒ‡åŸ·è¡Œ <code>EXPIRE key ttl</code> é€™æ¢æŒ‡ä»¤çš„æ™‚å€™é †ä¾¿è§¸ç™¼çš„äº‹ä»¶ï¼Œè€Œé€™è£æ˜¯æŒ‡é‚£å€‹ <code>key</code> å‰›å¥½éæœŸçš„é€™å€‹æ™‚é–“é»è§¸ç™¼çš„äº‹ä»¶ã€‚</li>
<li><strong>e</strong>ï¼Œé©…é€äº‹ä»¶ï¼Œä¸€å€‹ <code>key</code> ç”±æ–¼å…§å­˜ä¸Šé™è€Œè¢«é©…é€çš„æ™‚å€™æœƒè§¸ç™¼çš„äº‹ä»¶ã€‚</li>
<li><strong>A</strong>ï¼Œ<code>g$lshzxe</code> çš„åˆ¥åã€‚ä¹Ÿå°±æ˜¯èªª <code>AKE</code> çš„æ„æ€å°±ä»£è¡¨äº†æ‰€æœ‰çš„äº‹ä»¶ã€‚</li>
</ul>
<p>ã€€ã€€çµåˆä¸Šè¿°åˆ—è¡¨æˆ‘å€‘å°±èƒ½æ‹¼æ¹Šå‡ºè‡ªå·±æ‰€éœ€è¦çš„äº‹ä»¶æ”¯æŒå­—ç¬¦ä¸²äº†ï¼Œåœ¨æˆ‘çš„éœ€æ±‚ä¸­æˆ‘åªéœ€è¦ <code>Ex</code> å°±å¯ä»¥æ»¿è¶³äº†ï¼Œæ‰€ä»¥é…ç½®é …å°±æ˜¯é€™æ¨£çš„ï¼š</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notify-keyspace-<span class="keyword">events</span> Ex</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œä¿å­˜é…ç½®æ–‡ä»¶ï¼Œå•“å‹• Redis å°±å•“ç”¨äº†éæœŸäº‹ä»¶çš„æ”¯æŒäº†ã€‚</p>
<h4 id="å¯¦è¸">å¯¦è¸</h4><p>ã€€ã€€æˆ‘å€‘å…ˆèªªä»»å‹™çš„å‰µé€ è€…å§ã€‚ç”±æ–¼é€™è£ <strong>Redis</strong> çš„äº‹ä»¶åªæœƒå‚³éµåï¼Œä¸¦ä¸æœƒå‚³éµå€¼ï¼Œè€ŒéæœŸäº‹ä»¶è§¸ç™¼çš„æ™‚å€™é‚£å€‹éµå·²ç¶“æ²’äº†ï¼Œä½ ä¹Ÿç„¡æ³•ç²å–éµå€¼ï¼ŒåŠ ä¸Šæˆ‘çš„ä¸»ç³»çµ±å’Œä»»å‹™ç³»çµ±æ˜¯åˆ†ä½ˆå¼çš„ï¼Œæ‰€ä»¥å°±æŠŠæ‰€æœ‰éœ€è¦çš„ä¿¡æ¯å¾€éµåå¡ã€‚</p>
<p>ã€€ã€€ä¸€å€‹æœ€ç°¡å–®çš„éµåè¨­è¨ˆå°±æ˜¯ <code>ä»»å‹™é¡å‹ + &quot;:&quot; + JSON.stringify åŒ–å¾Œçš„åƒæ•¸æ•¸çµ„</code>ï¼›æ›´æœ‰ç”šè€…å¯ä»¥ç›´æ¥æŠŠä»»å‹™é¡å‹æ›¿æ›æˆæ‰€éœ€çš„å‡½æ•¸è·¯å¾‘ï¼Œæ¯”å¦‚éœ€è¦åŸ·è¡Œé€™å€‹ä»»å‹™çš„å‡½æ•¸åœ¨ <code>task/foo/bar</code> æ–‡ä»¶ä¸‹é¢çš„ <code>baz</code> å‡½æ•¸ï¼Œåƒæ•¸ <code>arguments</code> æ•¸çµ„çˆ² <code>[ 1, 2 ]</code>ï¼Œé‚£éº¼éµåçš„è¨­è¨ˆå¯ä»¥æ˜¯ <code>task/foo/bar.baz:[1,2]</code>ï¼Œåæ­£æˆ‘å€‘åªéœ€è¦è§¸ç™¼é€™å€‹éµï¼Œç”¨ä¸ç€å»æŸ¥è©¢é€™å€‹éµã€‚ç­‰åˆ°çœŸæ­£éæœŸäº†ä»»å‹™ç³»çµ±æ¥æ”¶åˆ°é€™å€‹éµåçš„æ™‚å€™å†ä¸€ä¸€è§£æï¼Œå¾—åˆ°éœ€è¦åŸ·è¡Œ <code>task/foo/bar.baz</code> é€™å€‹æ¶ˆæ¯ï¼Œä¸¦ä¸”ç¶²å‡½æ•¸è£é¢å‚³å…¥ <code>[1,2]</code> é€™å€‹ <code>arguments</code>ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥ç•¶æ¥æ”¶åˆ°ä¸€å€‹å®šæ™‚ä»»å‹™çš„æ™‚å€™ï¼Œæˆ‘å€‘å¾—åˆ°æ¶ˆæ¯ã€å‡½æ•¸åã€éæœŸæ™‚é–“åƒæ•¸ï¼Œé€™å€‹å‡½æ•¸å¯ä»¥å¦‚ä¸‹è¨­è¨ˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æˆ‘å€‘å‡è¨­ redis æ˜¯ä¸€å€‹ ioredis çš„å°è±¡ */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sampleTaskMaker = <span class="function"><span class="keyword">function</span>(<span class="params">message, func, timeout</span>) </span>&#123;</span><br><span class="line">    message = <span class="built_in">JSON</span>.stringify(message);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Received a new task:"</span>, func, message, <span class="string">"after "</span> + timeout + <span class="string">"."</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€™è£çš„ uuid æ˜¯ npm ä¸€å€‹åŒ…</span></span><br><span class="line">    <span class="comment">// ç”Ÿæˆä¸€å€‹å”¯ä¸€ uuid çš„ç›®çš„æ˜¯çˆ²äº†é˜²æ­¢å…©å€‹ä»»å‹™ç”¨äº†ç›¸åŒçš„å‡½æ•¸å’Œåƒæ•¸ï¼Œé‚£éº¼</span></span><br><span class="line">    <span class="comment">// éµåå¯èƒ½æœƒé‡è¤‡ä¸¦è¦†è“‹çš„æƒ…æ³</span></span><br><span class="line">    <span class="comment">// uuid çš„æ–‡æª”çˆ² https://www.npmjs.com/package/node-uuid</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// é€™è£çš„ â¤ï¸ æ˜¯ä¸€å€‹åˆ†éš”ç¬¦ï¼Œå†’è™Ÿæ˜¯åˆ†å‰² uuid å’Œå¾Œé¢å…§å®¹çš„ï¼Œè€Œ â¤ï¸ æ˜¯åˆ†å‰²å‡½æ•¸å</span></span><br><span class="line">    <span class="comment">// å’Œæ¶ˆæ¯çš„</span></span><br><span class="line">    <span class="keyword">var</span> key = uuid.v1().replace(<span class="regexp">/-/g</span>, <span class="string">""</span>) +</span><br><span class="line">        <span class="string">":â¤ï¸"</span> + func + <span class="string">"â¤ï¸"</span> + message;</span><br><span class="line">    <span class="keyword">var</span> content = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    redis.multi()</span><br><span class="line">        .set(key, content)</span><br><span class="line">        .expire(key, timeout)</span><br><span class="line">        .exec(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">"Failed to publish EXPIRE EVENT for "</span> + content);</span><br><span class="line">                <span class="built_in">console</span>.error(err);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Ioredis çš„ç©©å®šå¯ä»¥<a href="https://github.com/luin/ioredis" target="_blank" rel="external">é»æ­¤</a>æŸ¥çœ‹ã€‚</p>
</blockquote>
<p>ã€€ã€€ç„¶å¾Œåœ¨ä»»å‹™ç³»çµ±è£é¢çš„ä¸€é–‹å§‹ç›£è½é€™å€‹éæœŸé »é“ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assign æ˜¯ sugarjs è£é¢çš„å‡½æ•¸</span></span><br><span class="line"><span class="comment">// æŠŠ db å¡åˆ°å­—ç¬¦ä¸²è£é¢çš„ &#123;db&#125; è£å»</span></span><br><span class="line"><span class="keyword">var</span> subscribeKey = <span class="string">"__keyevent@&#123;db&#125;__:expired"</span>.assign(&#123; db: <span class="number">1</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡è¨­ sub æ˜¯ ioredis çš„å°è±¡</span></span><br><span class="line">sub.once(<span class="string">"connect"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å‡è¨­æˆ‘å€‘éœ€è¦é¸æ“‡ redis çš„ dbï¼Œå› çˆ²å¯¦éš›ä¸Šæˆ‘å€‘ä¸æœƒå»æ±¡æŸ“é»˜èªçš„ db 0</span></span><br><span class="line">    sub.select(<span class="number">1</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) process.exit(<span class="number">4</span>);</span><br><span class="line">        sub.subscribe(<span class="string">"foo"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//... è¨‚é–±é »é“æˆåŠŸ</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›£è½å¾ `foo` ä¾†çš„æ¶ˆæ¯</span></span><br><span class="line">sub.on(<span class="string">"message"</span>, sampleOnExpired);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> æˆ‘å€‘é€™è£é¸æ“‡ db 1 æ˜¯å› çˆ²ä¸€æ—¦é–‹å•“éæœŸäº‹ä»¶ç›£è½ï¼Œé‚£éº¼é€™å€‹ db çš„æ‰€æœ‰éæœŸäº‹ä»¶éƒ½æœƒè¢«é«®é€ã€‚çˆ²äº†ä¸è·Ÿæ­£å¸¸ä½¿ç”¨çš„ redis éæœŸéµæ··æ·†ï¼Œæˆ‘å€‘çˆ²é€™å€‹äº‹æƒ…å°ˆé–€ç”¨ä¸€å€‹æ–°çš„ dbã€‚æ¯”å¦‚æˆ‘å€‘åœ¨è‡ªå·±æ­£å¸¸ä½¿ç”¨çš„ db 0 è£é¢ç›£è½äº†ï¼Œé‚£éº¼ä¸æ˜¯æˆ‘å€‘ä»»å‹™è§¸ç™¼çš„éæœŸäº‹ä»¶ä¹Ÿæœƒå‚³éä¾†ï¼Œé€™å€‹æ™‚å€™æˆ‘å€‘è§£æçš„éµåå°±ä¸å°äº†ã€‚</p>
</blockquote>
<p>ã€€ã€€æœ€å¾Œå°±æ˜¯æˆ‘å€‘çš„ <code>sampleOnExpired</code> å‡½æ•¸äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sampleOnExpired = <span class="function"><span class="keyword">function</span>(<span class="params">channel, key</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// UUID:â¤ï¸funcâ¤ï¸params</span></span><br><span class="line">    <span class="keyword">var</span> body = key.split(<span class="string">"â¤ï¸"</span>);</span><br><span class="line">    <span class="keyword">if</span>(body.length &lt; <span class="number">3</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–å‡º body ç¬¬ä¸€ä½çˆ² func</span></span><br><span class="line">    <span class="keyword">var</span> func = body[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨å‡ºå‰å…©ä½ï¼Œå¾Œé¢å‰©ä¸‹çš„æœ‰å¯èƒ½æ˜¯åƒæ•¸è£é¢è‡ªå¸¶ â¤ï¸ è€Œè¢«åˆ†å‰²ï¼Œæ‰€ä»¥è¦æ‹¼å›å»</span></span><br><span class="line">    body.shift(); body.shift();</span><br><span class="line">    <span class="keyword">var</span> params = body.join(<span class="string">"â¤ï¸"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç„¶å¾ŒæŠŠ params å‚³å…¥ func å»åŸ·è¡Œ</span></span><br><span class="line">    <span class="comment">// func:</span></span><br><span class="line">    <span class="comment">//   path1/path2.func</span></span><br><span class="line">    func = func.split(<span class="string">"."</span>);</span><br><span class="line">    <span class="keyword">if</span>(func.length !== <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"Bad params for task:"</span>, func.join(<span class="string">"."</span>), <span class="string">"-"</span>, params);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> path = func[<span class="number">0</span>];</span><br><span class="line">    func = func[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mod;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        mod = <span class="built_in">require</span>(<span class="string">"./tasks/"</span> + path);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"Failed to load module"</span>, path);</span><br><span class="line">        <span class="built_in">console</span>.error(e.stack);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mod[func].apply(<span class="literal">null</span>, <span class="built_in">JSON</span>.parse(params));</span><br><span class="line">        &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"Failed to call function"</span>, path, <span class="string">"-"</span>, func, <span class="string">"-"</span>, params);</span><br><span class="line">            <span class="built_in">console</span>.error(e.stack);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™å€‹ç°¡æ˜“çš„æ¶å­æ­å¥½å¾Œï¼Œä½ åªéœ€è¦å»å¯«ä¸€å †ä»»å‹™åŸ·è¡Œå‡½æ•¸ï¼Œç„¶å¾Œåœ¨ç”Ÿæˆä»»å‹™çš„æ™‚å€™æŠŠç›¸æ‡‰åƒæ•¸å‚³çµ¦ <code>sampleTaskMaker</code> å°±å¥½äº†ã€‚Redis æœƒè‡ªå‹•éæœŸä¸¦ä¸”è§¸ç™¼äº‹ä»¶çµ¦ä½ çš„ <code>sampleOnExpired</code> å‡½æ•¸ï¼Œç„¶å¾Œå°±æœƒå»åŸ·è¡Œç›¸æ‡‰çš„ä»»å‹™è™•ç†å‡½æ•¸äº†ã€‚</p>
<h2 id="å°çµ">å°çµ</h2><p>ã€€ã€€å…¶å¯¦é€™å€‹éœ€æ±‚åœ¨æˆ‘å€‘é …ç›®ç›®å‰å°±æ˜¯çµ¦ç”¨æˆ¶å®šæ™‚ç™¼æé†’çŸ­ä¿¡ç”¨çš„ã€‚å¦‚æœæ²’æœ‰ç™¼ç¾ Redis çš„é€™å€‹å¦™ç”¨ï¼Œæˆ‘é‚„æ˜¯æœƒå»ç”¨<a href="#æœ€åˆçš„è¨­æƒ³">ç¬¬äºŒç¯€</a>è£é¢çš„æ–¹æ³•ä¾†å¯«çš„ã€‚å…¶å¯¦é€™æœŸé–“ä¹Ÿæœ‰è€ƒæ…®éç”¨ RabbitMQï¼Œä¸éè²Œä¼¼å®ƒçš„å®šæ™‚æ¶ˆæ¯éœ€è¦åšä¸€äº› Hackï¼Œæ¯”è¼ƒéº»ç…©ï¼Œæœ€å¾Œå°±æ”¾æ£„äº†ã€‚</p>
<p>ã€€ã€€Redis çš„é€™å€‹æ–¹æ³•å…¶å¯¦æ˜¯æˆ‘åœ¨è°·æ­Œæœå‡ºä¾†çš„ï¼Œåˆ¥äººåœ¨ StackOverflow å›ç­”çš„ç­”æ¡ˆã€‚æˆ‘åƒè€ƒäº†ä¹‹å¾Œç”¨æˆ‘è‡ªå·±çš„æ–¹æ³•å¯¦ç¾äº†å‡ºä¾†ï¼Œä¸¦ä¸”æŠŠä»£ç¢¼çš„é—œéµéƒ¨åˆ†æå–å‡ºä¾†æ•´ç†æˆé€™ç¯‡å°æ–‡ï¼Œé‚„å¸Œæœ›èƒ½çµ¦å„ä½çœ‹å®˜ä¸€äº›ç”¨å§ï¼Œæœ›æ‰“è³ã€‚</p>
<p>ã€€ã€€å¦‚æœæ²’æœ‰ä»€éº¼ç”¨ä¹Ÿæ†‹å™´æˆ‘ï¼Œç•¢ç«Ÿæˆ‘æ˜¯å€‹è’Ÿè’»ã€‚æœ‰æ›´å¥½çš„æ–¹æ³•å¸Œæœ›ç•™å€‹è¨€ï¼Œæœ›å‘ŠçŸ¥ã€‚è¬è¬ã€‚(Â´,,â€¢Ï‰â€¢,,)â™¡</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€å¥½ä¹…æ²’å¯«åšæ–‡äº†ï¼Œæœ€è¿‘åœ¨è·Ÿéš¨ç€å…¬å¸å¤§ç‰›å€‘çš„è…³æ­¥ç¥•å¯†ç ”ç™¼æ–°ç”¢å“ä¸­ã€‚</p>
<p>ã€€ã€€ä¸éå‰å¹¾å¤©æœ‰ä¸€å€‹å°éœ€æ±‚çš„æ±è¥¿å¯ä»¥æå‡ºä¾†å¯«ä¸€é»é»å°ä¹¾è²¨å…’è·Ÿå¤§å®¶åˆ†äº«åˆ†äº«ã€‚ç±³å¨œæ¡‘æœƒçš„å°±å¯ä»¥å¿½ç•¥äº†ï¼Œåæ­£æˆ‘ä¹Ÿæ˜¯éš¨ä¾¿å¯«çš„ï¼›å¦‚æœè¦ºå¾—æœ¬æ–‡å°ä½ æœ‰ç”¨çš„è©±é‚„è«‹å¤šå¤šæ”¯æŒå–µã€‚(â—Â´Ï‰ï½€â—)ã‚</p>
<h2 ]]>
    </summary>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="Redis" scheme="http://xcoder.in/tags/Redis/"/>
    
      <category term="å®šæ™‚ä»»å‹™" scheme="http://xcoder.in/tags/%E5%AE%9A%E6%99%82%E4%BB%BB%E5%8B%99/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Remilia çµæ§‹åœ–]]></title>
    <link href="http://xcoder.in/2015/01/08/remilia-structure/"/>
    <id>http://xcoder.in/2015/01/08/remilia-structure/</id>
    <published>2015-01-08T08:47:17.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="è•¾ç±³è‰äºï¼Ÿ">è•¾ç±³è‰äºï¼Ÿ</h2><p>å…¶å¯¦é€™æ˜¯èŠ±ç“£çš„ä¸€å€‹å…¥åº«ç³»çµ±çµæ§‹åœ–ï¼Œè•¾ç±³è‰äºæ˜¯é€™å€‹é …ç›®çš„åå­—ã€‚</p>
<h2 id="çµæ§‹åœ–">çµæ§‹åœ–</h2><p><img src="pic.jpg" alt="Remilia"></p>
<p>è¨­è¨ˆå¾—ä¸å¥½ï¼Œç´”å±¬åšæ­¸æª”ã€‚</p>
<p>å…¶ä¸­ SanaeHDCS æ˜¯å¦ä¸€å¥—ç³»çµ±ï¼Œçµ¦ RemiliaHDPS æä¾›æ•¸æ“šçš„ã€‚</p>
<h3 id="Data_Layer">Data Layer</h3><p>ä¸»è¦åˆ†çˆ² Bathtubï¼ŒDryerï¼ŒVampire ä¸‰å€‹éƒ¨åˆ†ã€‚</p>
<h4 id="Bathtub_æµ´ç¼¸">Bathtub æµ´ç¼¸</h4><p>ç”± SanaeHDCS æä¾›çš„æ•¸æ“šï¼Œå­˜å„²åœ¨ MongoDB ç•¶ä¸­ã€‚</p>
<h4 id="Dryer_å¹è½Ÿé›">Dryer å¹è½Ÿé›</h4><p>å°‡ Bathtub å‡ºä¾†çš„æº¼æ•¸æ“šè®Šæˆä¹¾è²¨çš„è§£æå™¨ï¼Œæ ¹æ“šä¸åŒçš„æ•¸æ“šç”¨ä¸åŒçš„è¦å‰‡é€²è¡Œè§£æã€‚</p>
<h4 id="Vampire_è¡€æ—">Vampire è¡€æ—</h4><p>å…¨åå…¶å¯¦æ˜¯ Vampire Coffinï¼Œåªä¸éæŠŠé€™å€‹å¯«åˆ°é …ç›®è£é¢çœ‹ç€è²Œä¼¼ä¸æ˜¯å¾ˆå‰åˆ©ï¼Œæ–¼æ˜¯å–äº†å‰åŠéƒ¨åˆ†ã€‚å¹è½Ÿæ©Ÿè™•ç†å¥½çš„å¹¹æ´»æœƒå­˜å„²åœ¨é€™é‚Šï¼Œå¯¦éš›ä¸Šä¹Ÿæ˜¯<br>MongoDB è£é¢ã€‚ç„¶å¾Œ Vampire æä¾›çµ¦å¤–éƒ¨æ¥å£ï¼Œè®“å…¶èƒ½å¤ ç”¨æ­£ç¢ºçš„å§¿å‹¢ç²å–æ­£ç¢ºçš„ä¹¾è²¨æ•¸æ“šã€‚</p>
<h3 id="Fake_Internet">Fake Internet</h3><p>ä¸€å€‹è¦–çª—ã€‚</p>
<h3 id="Fake_Koumakan">Fake Koumakan</h3><p>å‡çš„ç´…é­”é¤¨ï¼Œè£é¢ä¸€å † Puppetã€‚</p>
<blockquote>
<p>æ¯å€‹ Puppet éƒ½æœ‰è‡ªå·±çš„å±¬æ€§ã€äººæ ¼ã€ä½œæ¯æ™‚é–“å’Œç”Ÿæ´»ã€‚</p>
</blockquote>
<h2 id="01_/_12_/_2015">01 / 12 / 2015</h2><p>é‡æ–°è¨­è¨ˆäº† Remilia çµæ§‹åœ–ã€‚</p>
<p><img src="new.jpg" alt="Remilia"></p>
<h2 id="æœ€å¾Œ">æœ€å¾Œ</h2><p>å¥½å§é‚„æ˜¯æˆ‘çš„è…¦æ´å¤ªå¤§äº†ã€‚æˆ‘çŸ¥é“ä½ å€‘çœ‹ç€é€™è²¨ä¸çŸ¥æ‰€äº‘ã€‚</p>
<p>å¥½å§å¿˜äº†é€™å€‹æ±è¥¿å§ï¼Œæˆ‘åªæ˜¯ç„¡èŠç™¼ä¸€ç¯‡è€Œå·²ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="è•¾ç±³è‰äºï¼Ÿ">è•¾ç±³è‰äºï¼Ÿ</h2><p>å…¶å¯¦é€™æ˜¯èŠ±ç“£çš„ä¸€å€‹å…¥åº«ç³»çµ±çµæ§‹åœ–ï¼Œè•¾ç±³è‰äºæ˜¯é€™å€‹é …ç›®çš„åå­—ã€‚</p>
<h2 id="çµæ§‹åœ–">çµæ§‹åœ–</h2><p><img src="pic.jpg" alt="Remilia"></p>
<p>è¨­è¨ˆå¾—ä¸å¥½ï¼Œç´”å±¬åšæ­¸æª”ã€‚]]>
    </summary>
    
      <category term="Remilia" scheme="http://xcoder.in/tags/Remilia/"/>
    
      <category term="è•¾ç±³è‰äº" scheme="http://xcoder.in/tags/%E8%95%BE%E7%B1%B3%E8%8E%89%E4%BA%9E/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[åœ¨ C++ ä¸­éˆæ¥ C çš„ æ–‡ä»¶]]></title>
    <link href="http://xcoder.in/2014/12/10/link-c-on-gpp/"/>
    <id>http://xcoder.in/2014/12/10/link-c-on-gpp/</id>
    <published>2014-12-10T07:30:32.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="åŸå› ">åŸå› </h2><p>ç”±æ–¼æŸäº›åŸå› ï¼Œæˆ‘å¯«äº†å€‹å¾ˆæ“çš„<a href="https://github.com/XadillaX/xmempool" target="_blank" rel="external">å…§å­˜æ± </a>ï¼ˆC ç‰ˆæœ¬çš„ï¼‰ã€‚</p>
<p>ç„¶å¾Œæˆ‘æƒ³åˆ°äº†æŠŠä¹‹å‰å¯«çš„ä¸€å€‹ Node.js åŒ… <a href="https://github.com/XadillaX/thmclrx" target="_blank" rel="external">thmclrx</a> çš„æ›´æŒ«çš„â€œåƒÂ·å…§å­˜æ± â€ç”¨æ–°å¯«çš„å…§å­˜æ± å»æ›¿æ›æ‰ã€‚(â›â—¡â›âœ¿)</p>
<p>ç„¶å¾Œå•é¡Œå°±ä¾†äº†ï¼Œæˆ‘è²Œä¼¼ä¸èƒ½æ§åˆ¶ node-gyp å»ç”¨ G++ ç·¨è­¯ <code>*.c</code> æ–‡ä»¶ï¼Œé€™æ¨£çš„è©±æ‰€æœ‰æ–‡ä»¶ç·¨è­¯å¥½ä¹‹å¾Œéˆæ¥ <code>*.o</code> æ–‡ä»¶æœƒå‡ºå•é¡Œã€‚é›–ç„¶éˆæ¥çš„æ™‚å€™æ²’å ±éŒ¯ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ™‚å€™å°±æœƒå ±é€™éº¼å€‹éŒ¯ (;Â´à¼àº¶Ğ”à¼àº¶`)ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">âœ thmclrx git:(master) âœ— node <span class="built_in">test</span>/test.js</span><br><span class="line">dyld: lazy symbol binding failed: Symbol not found: __Z16xmem_create_poolj</span><br><span class="line">  Referenced from: /Users/.../code/huaban/thmclrx/build/Release/thmclrx.node</span><br><span class="line">  Expected <span class="keyword">in</span>: dynamic lookup</span><br><span class="line"></span><br><span class="line">dyld: Symbol not found: __Z16xmem_create_poolj</span><br><span class="line">  Referenced from: /Users/.../code/huaban/thmclrx/build/Release/thmclrx.node</span><br><span class="line">  Expected <span class="keyword">in</span>: dynamic lookup</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>]    <span class="number">52501</span> trace <span class="built_in">trap</span>  node <span class="built_in">test</span>/test.js</span><br></pre></td></tr></table></figure>
<p>å¤§è‡´æ„æ€å°±æ˜¯èªªåœ¨æˆ‘ç·¨è­¯å¥½éˆæ¥å¥½çš„ <code>thmclrx.node</code> ä¸­æ‰¾ä¸åˆ° <code>__Z16xmem_create_poolj</code> é€™å€‹ç¬¦è™Ÿï¼Œä¹Ÿå°±æ˜¯èªª <code>xmempool.o</code> é€™å€‹ç”¨ C ç·¨è­¯å‡ºä¾†çš„æ–‡ä»¶ä¸¦æ²’æœ‰æ­£ç¢ºè¢«éˆæ¥ã€‚</p>
<h2 id="å‡æƒ³æ–¹æ¡ˆ">å‡æƒ³æ–¹æ¡ˆ</h2><h3 id="å‡æƒ³ä¸€">å‡æƒ³ä¸€</h3><p>ä¸€é–‹å§‹æˆ‘æƒ³æ‰¾çš„æ˜¯â€œå¦‚ä½•åœ¨ node-gyp ä¸­æ‰‹å‹•é¸æ“‡ç·¨è­¯å™¨â€ï¼Œå³ä¸è®“æ©Ÿå™¨è‡ªå‹•é¸æ“‡ GCC å»ç·¨è­¯ <code>*.c</code> æ–‡ä»¶ã€‚å¾Œä¾†ç„¡æœã€‚ãƒ«||â˜›_â˜š|ãƒª</p>
<h3 id="å‡æƒ³äºŒ">å‡æƒ³äºŒ</h3><p>å†å¾Œä¾†æˆ‘æƒ³é–‹äº†ï¼Œæ–¼æ˜¯æ±ºå®šè®“ç·¨è­¯çš„æ™‚å€™å»è­˜åˆ¥æˆ‘åœ¨è·Ÿ C èªªè©±é‚„æ˜¯è·Ÿ C++ èªªè©±ã€‚(ï¾‰â—•ãƒ®â—•)ï¾‰*:ï½¥ï¾Ÿâœ§</p>
<h2 id="è§£æ±ºæ–¹æ¡ˆ">è§£æ±ºæ–¹æ¡ˆ</h2><p>æ–¼æ˜¯æˆ‘æ‰¾åˆ°äº†é€™éº¼å€‹å¸–å­ï¼š<a href="http://grokbase.com/t/gg/nodejs/14amregx72/linking-c-sources-files-in-cc-files" target="_blank" rel="external">http://grokbase.com/t/gg/nodejs/14amregx72/linking-c-sources-files-in-cc-files</a></p>
<p>ä»–è²Œä¼¼ä¹Ÿé‡åˆ°äº†è·Ÿæˆ‘ç›¸ä¼¼çš„å•é¡Œã€‚ä¸‹é¢é€™å€‹æå•è€…è‡ªå·±æå‡ºäº†é€™æ¨£çš„å›ç­”ï¼š</p>
<blockquote>
<p>Nevermind, found my own answer after finally hitting the right google search terms.</p>
<p>Added</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//... source code here...</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>So that the CPP compiler would know I was talking C and not CPP :)</p>
</blockquote>
<p>ç­”æ¡ˆçš„å¤§æ„å°±æ˜¯åœ¨ä½ çš„ C é ­æ–‡ä»¶ä¸­æ·»åŠ ä¸Šé¢ blahblah ä¸€å¤§æ®µå®ï¼Œå¥½è®“ C++ çš„ç·¨è­¯å™¨çŸ¥é“å®ƒæ˜¯åœ¨è·Ÿ C çš„ä¸­é–“æ–‡ä»¶äº¤æµè€Œä¸æ˜¯ C++ï¼Œé€™æ¨£çš„è©±éˆæ¥çš„æ™‚å€™å°±èƒ½æ­£å¸¸æ¥è»Œäº†ã€‚æ–¼æ˜¯æˆ‘åœ¨æˆ‘çš„æ–°ç‰ˆ <a href="https://github.com/XadillaX/xmempool/commit/b06351836c9b51952a3d98c438df6626dda8738c" target="_blank" rel="external">xmempool</a> çš„é ­æ–‡ä»¶è£é¢å°±å·²ç¶“æ·»åŠ ä¸Šäº†é€™å…©æ®µè©±äº†ã€‚</p>
<h2 id="äº‹å¾Œç…™">äº‹å¾Œç…™</h2><p>å…¶å¯¦ä»¥å‰æˆ‘ä¹Ÿè€åœ¨åˆ¥çš„é …ç›®è£é¢çœ‹åˆ°é€™å€‹ <code>#ifdef __cplusplus</code> çš„å®å®šç¾©ï¼Œåªä¸éä»¥å‰ä¸çŸ¥é“ä»€éº¼æ„æ€ã€‚</p>
<p>ä»Šå¤©é€šéé€™éº¼ä¸€ä»¶äº‹æƒ…çµ‚æ–¼çŸ¥é“äº†å®ƒçš„ç”¨é€”äº†ï¼Œæ–°æŠ€èƒ½ get âˆšã€‚</p>
<p>Îµ(*Â´ï½¥âˆ€ï½¥ï½€)Ğ·ï¾</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="åŸå› ">åŸå› </h2><p>ç”±æ–¼æŸäº›åŸå› ï¼Œæˆ‘å¯«äº†å€‹å¾ˆæ“çš„<a href="https://github.com/XadillaX/xmempool" target="_blank" rel="external">å…§å­˜æ± </a>ï¼ˆC ç‰ˆæœ¬çš„ï¼‰ã€‚</p>
<p>ç„¶å¾Œæˆ‘]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[å¦‚ä½•ç”Ÿæˆä¸€å€‹è¦†è“‹å»£çš„è‰²æ¿]]></title>
    <link href="http://xcoder.in/2014/10/16/generate-color-space/"/>
    <id>http://xcoder.in/2014/10/16/generate-color-space/</id>
    <published>2014-10-16T03:00:54.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="ç”¨é€”">ç”¨é€”</h2><p>ã€€ã€€åœ¨ä¸»é¡Œè‰²æå–çš„éç¨‹ä¸­ï¼Œè¦æŠŠé¡è‰²åŠ å…¥æœç´¢å¼•æ“ã€‚ä½†æ˜¯å¦‚æœæ˜¯çœŸå½©è‰²ä»»æ„å€¼åŠ é€²å»çš„è©±ï¼Œå°æ–¼æœç´¢çš„æ™‚å€™ä¾†èªªç„¡ç–‘æ˜¯ä¸€å€‹è¤‡é›œçš„æ“ä½œã€‚æœç´¢æ¢ä»¶è¦å„ç¨®è¨ˆç®—è·é›¢ä»€éº¼çš„ã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯ä¸€å€‹å¦¥å”çš„åšæ³•å°±æ˜¯æä¾›ä¸€å¥—èª¿è‰²æ¿ï¼Œä¿è­‰æ‰€æœ‰é¡è‰²éƒ½è¢«å¸ç´åˆ°èª¿è‰²æ¿ä¸­çš„æŸä¸€è‰²å€¼ç•¶ä¸­ã€‚</p>
<p>ã€€ã€€é‚£éº¼é€™å€‹æ™‚å€™èª¿è‰²æ¿çš„è¦†è“‹ç‡ä»¥åŠè·é›¢ä»€éº¼çš„å°±æ¯”è¼ƒé‡è¦äº†ã€‚æœ¬æ–‡å°±è¬›å¦‚ä½•ç”Ÿæˆä¸€å¥—çœ‹èµ·ä¾†é‚„ä¸éŒ¯çš„è‡ªç”¨â€œæ¨™æº–è‰²æ¿â€ã€‚</p>
<h2 id="Windows_è‰²æ¿">Windows è‰²æ¿</h2><p>ã€€ã€€ä¸€é–‹å§‹æˆ‘ç”¨äº†ä¸€å¥— 256 è‰²çš„è‰²æ¿ï¼Œä¸çŸ¥é“å“ªè£æä¾†çš„ Windows è‰²æ¿ã€‚</p>
<p>ã€€ã€€ç”±æ–¼é¡è‰²å¤ªå¤šï¼Œä¸å¥½è²¼ä»£ç¢¼ï¼Œæˆ‘å°±ç›´æ¥æŠŠéˆæ¥è²¼éä¾†äº†ï¼š</p>
<blockquote>
<p><a href="https://github.com/XadillaX/thmclrx/blob/4a5bff429f25294af7111de800063ffd90cce1d8/src/common.cpp#L29" target="_blank" rel="external">é»æˆ‘èŒèŒå™  à¸…(à¹‘<em>Ğ´</em>à¹‘)à¸…!!</a></p>
</blockquote>
<p>ã€€ã€€é€™ä¸€å¥—è‰²æ¿å¤§è‡´çš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<style>
#standard-256 {
    line-height: 10px;
    padding: 0;
    margin: 0;
}
#standard-256 span {
    width: 40px;
    height: 20px;
    display: inline-block;
}
</style>

<div class="well"><div id="standard-256"></div></div>

<script src="http://blog.xcoder.in/theme-color-slide/palette.js"></script>
<script>
$(function()
{
    for (var i = 0; i < palette.length; i++)
    {
        var block = "<span style=\"background: rgba(" +
            palette[i][0] + ", " + palette[i][1] + ", " +
            palette[i][2] + ", 1);\"></span>";
        $("#standard-256").append(block);
    }
});
</script>

<h2 id="ç”Ÿæˆæ›´å¥½çš„è‰²æ¿">ç”Ÿæˆæ›´å¥½çš„è‰²æ¿</h2><p>ã€€ã€€æˆ‘æŒ‡çš„æ›´å¥½ä¸¦ä¸ä¸€å®šçœŸçš„æ¯”ä¹‹å‰æ‰¾åˆ°çš„ 256 è‰²è¦å¥½ï¼Œç•¢ç«Ÿä¸Šé¢é‚£å€‹æ˜¯äººå®¶æ™ºæ…§å’Œå‹å‹•çš„çµæ™¶ã€‚æˆ‘æŒ‡çš„æ›´å¥½æ˜¯é¡è‰²æ›´å¤šï¼Œä½†æ˜¯åå·®åˆä¸æœƒå¤ªå¤§ã€‚</p>
<p>ã€€ã€€ç†è«–ä¸Šæˆ‘å€‘èƒ½æŒ‰ç…§é‚£ç¨®è¦å‰‡ç”Ÿæˆæ¯”çœŸå½©è‰²å°‘çš„ä»»æ„ç¨®æ•¸çš„è‰²æ¿ã€‚</p>
<h3 id="ç›¸é—œçš„è‰²å½©æ¨¡å¼">ç›¸é—œçš„è‰²å½©æ¨¡å¼</h3><p>ã€€ã€€é€™è£æœ‰å¿…è¦é‡æ–°æ™®åŠä¸‹ N å¤šç¨®è‰²å½©æ¨¡å¼ä¸­çš„å…¶ä¸­å…©ç¨®ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘ä»Šå¤©ç”Ÿæˆä¸€å€‹è‰²æ¿æ‰€ç”¨åˆ°çš„å…©ç¨®æ¨¡å¼ã€‚</p>
<h4 id="RGB_è‰²å½©æ¨¡å¼">RGB è‰²å½©æ¨¡å¼</h4><p>ã€€ã€€é€™å€‹å¤§å®¶éƒ½å·²ç¶“è€³ç†Ÿèƒ½è©³äº†ï¼Œç„¡éæ˜¯ RGB é€šé“ä¸­çš„åˆ†é‡çµåˆèµ·ä¾†ç”Ÿæˆçš„ä¸€ç¨®é¡è‰²ã€‚</p>
<blockquote>
<p>RGB è‰²å½©æ¨¡å¼æ˜¯å·¥æ¥­ç•Œçš„ä¸€ç¨®é¡è‰²æ¨™æº–ï¼Œæ˜¯é€šéå°ç´… (R)ã€ç¶  (G)ã€è— (B)ä¸‰å€‹é¡è‰²é€šé“çš„è®ŠåŒ–ä»¥åŠå®ƒå€‘ç›¸äº’ä¹‹é–“çš„ç–ŠåŠ ä¾†å¾—åˆ°å„å¼å„æ¨£çš„é¡è‰²çš„ï¼ŒRGB å³æ˜¯ä»£è¡¨ç´…ã€ç¶ ã€è—ä¸‰å€‹é€šé“çš„é¡è‰²ï¼Œé€™å€‹æ¨™æº–å¹¾ä¹åŒ…æ‹¬äº†äººé¡è¦–åŠ›æ‰€èƒ½æ„ŸçŸ¥çš„æ‰€æœ‰é¡è‰²ï¼Œæ˜¯ç›®å‰é‹ç”¨æœ€å»£çš„é¡è‰²ç³»çµ±ä¹‹ä¸€ã€‚</p>
<p>ä½¿ç”¨ RGB æ¨¡å‹çˆ²åœ–åƒä¸­æ¯ä¸€å€‹åƒç´ çš„ RGB åˆ†é‡åˆ†é…ä¸€å€‹ 0 ~ 255 ç¯„åœå…§çš„å¼·åº¦å€¼ã€‚RGB åœ–åƒåªä½¿ç”¨ä¸‰ç¨®é¡è‰²ï¼Œå°±å¯ä»¥ä½¿å®ƒå€‘æŒ‰ç…§ä¸åŒçš„æ¯”ä¾‹æ··åˆï¼Œåœ¨å±å¹•ä¸Šå‘ˆç¾ 16777216 (<code>256 * 256 * 256</code>) ç¨®é¡è‰²ã€‚</p>
</blockquote>
<h4 id="HSL_è‰²å½©æ¨¡å¼">HSL è‰²å½©æ¨¡å¼</h4><blockquote>
<p>HSL è‰²å½©æ¨¡å¼æ˜¯å·¥æ¥­ç•Œçš„ä¸€ç¨®é¡è‰²æ¨™æº–ï¼Œæ˜¯é€šéå°è‰²ç›¸ (H)ã€é£½å’Œåº¦ (S)ã€æ˜åº¦ (L) ä¸‰å€‹é¡è‰²é€šé“çš„è®ŠåŒ–ä»¥åŠå®ƒå€‘ç›¸äº’ä¹‹é–“çš„ç–ŠåŠ ä¾†å¾—åˆ°å„å¼å„æ¨£çš„é¡è‰²çš„ï¼ŒHSL å³æ˜¯ä»£è¡¨è‰²ç›¸ï¼Œé£½å’Œåº¦ï¼Œæ˜åº¦ä¸‰å€‹é€šé“çš„é¡è‰²ï¼Œé€™å€‹æ¨™æº–å¹¾ä¹åŒ…æ‹¬äº†äººé¡è¦–åŠ›æ‰€èƒ½æ„ŸçŸ¥çš„æ‰€æœ‰é¡è‰²ï¼Œæ˜¯ç›®å‰é‹ç”¨æœ€å»£çš„é¡è‰²ç³»çµ±ä¹‹ä¸€ã€‚</p>
</blockquote>
<p>ã€€ã€€HSL è‰²å½©æ¨¡å¼å°±æ˜¯ä»Šå¤©çš„ä¸»è§’äº†ã€‚æˆ‘å€‘å°‡æœƒç”¨ HSL ç”Ÿæˆä¸€å¼µé¡ä¼¼ä¸‹åœ–çš„è‰²æ¿ï¼Œè€Œè‰²æ¿çš„ç²’åº¦å°‡æœƒèˆ‡ä½ æ±ºå®šè‰²æ¿çš„é¡è‰²æ•¸é‡ç›¸é—œï¼š</p>
<p><img src="SqfinPalette-RealColorWheel-RGB-14inwide72dpi-1024x437.png" alt="HSL Color Space"></p>
<h3 id="ä»£ç¢¼å¯¦ç¾">ä»£ç¢¼å¯¦ç¾</h3><p>ã€€ã€€çˆ²äº†ç°¡åŒ–ä»£ç¢¼ï¼Œæˆ‘å€‘æš«æ™‚ä¸è€ƒæ…®é£½å’Œåº¦ï¼Œä¹Ÿå°±æ˜¯èªªæ‰€æœ‰é¡è‰²è®“å®ƒé£½å’Œåº¦éƒ½çˆ² <strong>100%</strong>ã€‚</p>
<p>ã€€ã€€è€Œä¸”å¯¦éš›ä¸Šè‰²ç›¸æ˜¯åœ¨ä¸€å€‹åœ“è£é¢çš„ 0Â° ~ 360Â°ï¼Œé‚£éº¼ä¹Ÿå°±æ˜¯èªªæˆ‘å€‘åªéœ€è¦åšå…©æ­¥å°±æ˜¯äº†ï¼š</p>
<ol>
<li>è‰²ç›¸ 0Â° ~ 360Â° å¾ªç’°ï¼›</li>
<li>ä»¥åŠæ˜åº¦ 0% ~ 100% å¾ªç’°ã€‚</li>
</ol>
<p>ã€€ã€€åœ¨é€™è£æˆ‘å®šäº†ä¸€å€‹æ­¥é•·ï¼šè‰²ç›¸ä»¥ 10Â° çˆ²ä¸€å€‹æ­¥é•·ï¼Œæ˜åº¦ä»¥ 5% çˆ²ä¸€å€‹æ­¥é•·ã€‚ä¸¦ä¸”å‰”é™¤ RGB ç›¸ç­‰çš„é»‘ç™½ç°è‰²ã€‚</p>
<blockquote>
<p>ç•¶ç„¶é€™è£æ­¥é•·å®Œå…¨å¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œå¥½ä¾†ã€‚</p>
</blockquote>
<p>ã€€ã€€æˆ‘å€‘ä»¥å‰ç«¯çš„ Javascript çˆ²ä¾‹ï¼Œèƒ½æƒ³åˆ°ä¸‹é¢çš„ä¸€æ®µä»£ç¢¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">19</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">36</span>; j++) &#123;</span><br><span class="line">            $(<span class="string">"#palette"</span>).append(<span class="string">"&lt;div class='color'&gt;&lt;/div&gt;"</span>);</span><br><span class="line">            $(<span class="string">".color"</span>).eq(count++).css(<span class="string">"background-color"</span>, <span class="string">"hsl("</span> + (j * <span class="number">10</span>) + <span class="string">", "</span> + <span class="string">"100%, "</span> + <span class="built_in">parseInt</span>(((i + <span class="number">1</span>) / <span class="number">21</span>) * <span class="number">100</span>) + <span class="string">"%)"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $(<span class="string">"#palette"</span>).append(<span class="string">"&lt;div style='clear: both;'&gt;&lt;/div&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™è£éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¦éš›ä¸Šæˆ‘æ˜åº¦çš„æ­¥é•·æ˜¯ <code>(100 / 22)</code>ã€‚ç„¶å¾Œ <code>0</code> å’Œ <code>100</code> é€™å…©å€‹æ˜åº¦æˆ‘å€‘å¦å¤–æ‹å‡ºä¾†ï¼Œæ‰€ä»¥åªå–äº† 1 ~ 21 çš„æ˜åº¦ã€‚</p>
<p>ã€€ã€€å‰©ä¸‹çš„å°±æ˜¯è·Ÿå‰›çº”èªªçš„ä¸€æ¨£ï¼Œå„è‰²ç›¸çš„å„æ˜åº¦ç”Ÿæˆä¸€å€‹ HSL é¡è‰²è³¦å€¼çµ¦ <code>background-color</code>ã€‚</p>
<p>ã€€ã€€æ¥ä¸‹å»æˆ‘å€‘ç”Ÿæˆä¸€å€‹ç°è‰²æ¢çš„è‰²æ¿ï¼Œå°ˆæ²»ç°é»‘ç™½ã€‚é€™å€‹æ™‚å€™å¯¦éš›ä¸Šæˆ‘å€‘å¯ä»¥ç›´æ¥ç”¨ RGB æå®šï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"#palette"</span>).append(<span class="string">"&lt;br /&gt;"</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">36</span>; i++) &#123;</span><br><span class="line">    $(<span class="string">"#palette"</span>).append(<span class="string">"&lt;div class='color'&gt;&lt;/div&gt;"</span>);</span><br><span class="line">    <span class="keyword">var</span> val = <span class="built_in">parseInt</span>(((<span class="number">19</span> - i) / <span class="number">19</span>) * <span class="number">255</span>);</span><br><span class="line">    $(<span class="string">".color"</span>).eq(count++).css(<span class="string">"background-color"</span>, <span class="string">"rgb("</span> + val + <span class="string">", "</span> + val + <span class="string">", "</span> + val + <span class="string">")"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æœ€å¾ŒæŠŠé¡è‰²è¼¸å‡ºåˆ°ä¸€å€‹æ•¸çµ„å°±å¥½äº†ã€‚</p>
<blockquote>
<p>é€™è£æœ‰ä¸€é» happy çš„æ˜¯ï¼Œå°±ç®—ä½ æ˜¯ç”¨ HSL ä¾†æçš„èƒŒæ™¯è‰²ï¼Œç”¨ <strong><em>jQuery</em></strong> çš„ <code>$(foo).css(&quot;background-color&quot;)</code> ç²å–åˆ°çš„ä»ç„¶æ˜¯ RGB å€¼ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> colors = [];</span><br><span class="line">$(<span class="string">".color"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="regexp">/rgb\((\d+), (\d+), (\d+)\)/</span>.exec($(<span class="keyword">this</span>).css(<span class="string">"background-color"</span>));</span><br><span class="line">    colors.push(&#123; r: <span class="built_in">parseInt</span>(result[<span class="number">1</span>]), g: <span class="built_in">parseInt</span>(result[<span class="number">2</span>]), b: <span class="built_in">parseInt</span>(result[<span class="number">3</span>]) &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">"textarea"</span>).val(<span class="built_in">JSON</span>.stringify(colors));</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ‰€ä»¥æœ€å¾Œæˆ‘å€‘é‚„éœ€è¦åˆå§‹çš„ HTML äº†ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">textarea</span>&gt;</span><span class="tag">&lt;/<span class="title">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"palette"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"clear: both;"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ•ˆæœçš„è©±é€™è£èƒ½çœ‹åˆ°ï¼š</p>
<ul>
<li><a href="http://blog.xcoder.in/hsl-color-space/" target="_blank" rel="external">http://blog.xcoder.in/hsl-color-space/</a></li>
<li><a href="http://runjs.cn/code/spahru8w" target="_blank" rel="external">http://runjs.cn/code/spahru8w</a></li>
</ul>
<h2 id="å°çµ">å°çµ</h2><p>ã€€ã€€ç”¨ HSL ç”Ÿæˆçš„è‰²å½©ç©ºé–“ï¼ˆè‰²æ¿ï¼‰ä¸€å€‹æ˜¯è¡¨ç¾åŠ›å¥½ï¼Œç›¸å°æ–¼ RGB ä¾†èªªï¼Œå¥½åƒæ›´å¥½çŸ¥é“å¦‚ä½•å»ç”Ÿæˆåˆ†éƒ¨æ¯”è¼ƒ OK çš„ä¸€å€‹è‰²å½©ç©ºé–“ã€‚</p>
<p>ã€€ã€€ä½†æ˜¯ä¹Ÿæœ‰ä¸€å€‹ç¼ºé»ï¼Œç•¶æˆ‘å€‘ä¸å»ç®¡é£½å’Œåº¦çš„æ™‚å€™ï¼Œå¯¦éš›ä¸Šæˆ‘å€‘é‚„æ˜¯ä¸Ÿå¤±äº†ä¸€éƒ¨åˆ†çš„é¡è‰²ã€‚å¥½åœ¨æœ¬èº«æˆ‘å€‘ç”Ÿæˆè‰²æ¿ä¹Ÿåªæ˜¯çˆ²äº†åˆä½µé¡è‰²ï¼Œå¯ä»¥é€šé k-D æ¨¹ä¾†å¿«é€Ÿå°‹æ‰¾æŸå€‹é¡è‰²åœ¨è‰²æ¿ä¸­æ˜¯å±¬æ–¼å“ªç¨®è‰²å¡Šçš„ã€‚ç•¶ç„¶ï¼Œç›®å‰æˆ‘å€‘å°±æ˜¯é€™éº¼åšçš„ã€‚</p>
<h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2><ul>
<li><a href="http://websafecolorcodes.com/colors-palette/color-wheel-palette/" target="_blank" rel="external">Color Wheel Palette</a></li>
<li><a href="http://www.waldronconstructionllc.com/wp-content/uploads/2012/03/SqfinPalette-RealColorWheel-RGB-14inwide72dpi-1024x437.png" target="_blank" rel="external">Refer Image</a></li>
<li><a href="http://codeforartists.com/samples/cfa-color-palette-hsl.php" target="_blank" rel="external">Algorithm</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="ç”¨é€”">ç”¨é€”</h2><p>ã€€ã€€åœ¨ä¸»é¡Œè‰²æå–çš„éç¨‹ä¸­ï¼Œè¦æŠŠé¡è‰²åŠ å…¥æœç´¢å¼•æ“ã€‚ä½†æ˜¯å¦‚æœæ˜¯çœŸå½©è‰²ä»»æ„å€¼åŠ é€²å»çš„è©±ï¼Œå°æ–¼æœç´¢çš„æ™‚å€™ä¾†èªªç„¡ç–‘æ˜¯ä¸€å€‹è¤‡é›œçš„æ“ä½œã€‚æœç´¢æ¢ä»¶è¦å„ç¨®è¨ˆç®—è·é›¢ä»€éº¼çš„ã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯ä¸€å€‹å¦¥å”çš„åšæ³•å°±æ˜¯æä¾›ä¸€å¥—èª¿è‰²æ¿ï¼Œä¿è­‰æ‰€æœ‰é¡è‰²éƒ½è¢«å¸ç´åˆ°èª¿è‰²]]>
    </summary>
    
      <category term="Color Space" scheme="http://xcoder.in/tags/Color-Space/"/>
    
      <category term="HSL" scheme="http://xcoder.in/tags/HSL/"/>
    
      <category term="Palette" scheme="http://xcoder.in/tags/Palette/"/>
    
      <category term="RGB" scheme="http://xcoder.in/tags/RGB/"/>
    
      <category term="è‰²å½©ç©ºé–“" scheme="http://xcoder.in/tags/%E8%89%B2%E5%BD%A9%E7%A9%BA%E9%96%93/"/>
    
      <category term="è‰²æ¿" scheme="http://xcoder.in/tags/%E8%89%B2%E6%9D%BF/"/>
    
      <category term="Programming" scheme="http://xcoder.in/categories/Programming/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ç”¨ Javascript å¯¦ç¾ä¸€å€‹ç°¡æ˜“ BrainF**k è§£é‡‹å™¨]]></title>
    <link href="http://xcoder.in/2014/10/08/brainf**k/"/>
    <id>http://xcoder.in/2014/10/08/brainf**k/</id>
    <published>2014-10-08T03:42:32.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€é¦–å…ˆç¥è³€è‡ªå·±åœ¨ <a href="http://www.codewars.com/users/XadillaX" target="_blank" rel="external">CodeWars</a> å‡ç´šåˆ° 3 Kyuï¼Œä»¥åŠæ„Ÿè¬ @<a href="http://www.html-js.com/card/473" target="_blank" rel="external">Bolt_ç™½è¡£è’¼ç‹—</a> ç«¥é‹è®“æˆ‘çŸ¥é“æœ‰ CodeWars é€™éº¼å€‹å¥½ç©çš„æ±è¥¿ã€‚</p>
<p>ã€€ã€€é›–ç„¶è£é¢æ°´é¡Œå±…å¤šï¼Œä¸éåœ¨ä¸Šç­æ¯”è¼ƒç©ºé–’çš„æª”å£ #<strong>å¸¶è–ªåˆ·é¡Œ</strong># çš„æ„Ÿè¦ºé‚„æ˜¯è »ä¸éŒ¯çš„ã€‚</p>
<h2 id="è©±å˜®ä¸€ä¸‹">è©±å˜®ä¸€ä¸‹</h2><p>ã€€ã€€é«˜ä¸­çš„æ™‚å€™å°±è·Ÿ @<a href="http://www.lvchaoshuai.com/" target="_blank" rel="external">MatRush</a> ç™¼ç¾äº†ä¸€å€‹åå­—è¶…ç´šå¥½ç©çš„ç·¨ç¨‹èªè¨€å« <a href="http://en.wikipedia.org/wiki/Brainfuck" target="_blank" rel="external">BrainF**k</a>ï¼Œå®ƒæ¯”è¼ƒæè…¦ç­‹ï¼Œå› çˆ²æ‰€æœ‰çš„ç·¨ç¨‹æ“ä½œéƒ½æ˜¯é›†åˆåœ¨æ“ä½œç¬¦è£é¢ï¼Œç„¶å¾Œæ§åˆ¶æŒ‡é‡åç§»å’Œå…§å­˜å€¼çš„ä¿®æ”¹ä¾†é€²è¡Œä¸€ç³»åˆ—æ“ä½œã€‚</p>
<p>ã€€ã€€é€™èˆ‡å¾Œé¢ç™¼ç¾çš„ <a href="http://www.hacker.org/hvm/" target="_blank" rel="external">HVM</a>ï¼ˆHack Virtual Machineï¼‰æœ‰ç•°æ›²åŒå·¥ä¹‹å¦™ã€‚å…¶å¯¦ä¹‹å‰ä¹Ÿå‡ºéä¸€å€‹â€œ<a href="http://acm.nbut.edu.cn/Problem/view.xhtml?id=1062" target="_blank" rel="external">å¯¦ç¾ä¸€å€‹ç°¡æ˜“ HVM è§£é‡‹å™¨</a>â€çš„é¡Œç›®ï¼Œæ‰€ä»¥åœ¨ CodeWars çœ‹åˆ°é€™å€‹é¡Œç›®çš„æ™‚å€™é‚„æ„Ÿè¦ºè »è¦ªåˆ‡çš„ã€‚</p>
<h2 id="å•é¡Œæè¿°">å•é¡Œæè¿°</h2><p>ã€€ã€€å•é¡Œå¾ˆç°¡å–®ï¼Œå°±æ˜¯è®“ä½ å¯¦ç¾ä¸€å€‹å‡½æ•¸ä¾†è§£é‡‹ä¸€å¥ BrainF**k çš„èªå¥ï¼Œä¸¦ä¸”æ ¹æ“šè¼¸å…¥æ•¸æ“šä¾†è¼¸å‡ºç›¸æ‡‰çš„å…§å®¹ã€‚</p>
<p>ã€€ã€€è‡³æ–¼é€™é¡Œæ‰€éœ€çš„ BrainF**k çš„èªæ³•ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>&gt;</code>: æŒ‡é‡å³ç§»ä¸€ä½ã€‚</li>
<li><code>&lt;</code>: æŒ‡é‡å·¦ç§»ä¸€ä½ã€‚</li>
<li><code>+</code>: ç•¶å‰æŒ‡é‡æ‰€æŒ‡çš„å…§å­˜å€¼åŠ ä¸€ï¼Œä»¥ 255 çˆ²ç•Œï¼Œæº¢å‡ºçˆ² 0ï¼Œå³ <code>255 + 1 = 0</code>ã€‚</li>
<li><code>-</code>: ç•¶å‰æŒ‡é‡æ‰€æŒ‡çš„å…§å­˜å€¼æ¸›ä¸€ï¼Œä»¥ 0 çˆ²ç•Œï¼Œæº¢å‡ºçˆ² 255ï¼Œå³ <code>0 - 1 = 255</code>ã€‚</li>
<li><code>.</code>: è¼¸å‡ºç•¶å‰æŒ‡é‡æ‰€æŒ‡çš„å€¼ï¼Œå³è¼¸å‡ºè©²å€¼ ASCII ç¢¼æ‰€å°æ‡‰çš„å­—ç¬¦ã€‚</li>
<li><code>,</code>: å¾è¼¸å…¥å–ä¸€å€‹å­—ç¬¦è½‰çˆ² ASCII ç¢¼å­˜å…¥ç•¶å‰æŒ‡é‡æ‰€æŒ‡çš„å…§å­˜ã€‚</li>
<li><code>[</code>: è‹¥ç•¶å‰æŒ‡é‡æ‰€æŒ‡çš„å€¼çˆ² 0ï¼Œå‰‡å‘½ä»¤è·³åˆ°è©² <code>[</code> åŒ¹é…çš„çµæŸ <code>]</code> ç¬¦è™Ÿä½ç½®çš„ä¸‹ä¸€ä½ç½®çš„æŒ‡ä»¤ã€‚</li>
<li><code>]</code>: è‹¥ç•¶å‰æŒ‡é‡æ‰€æŒ‡çš„å€¼ä¸çˆ² 0ï¼Œå‰‡æŒ‡ä»¤å‘å‰è·³åˆ°è©² <code>]</code> åŒ¹é…åˆ°çš„ <code>[</code> ç¬¦è™Ÿä½ç½®çš„ä¸‹ä¸€ä½ç½®çš„æŒ‡ä»¤ã€‚</li>
</ul>
<p>ã€€ã€€èˆ‰å€‹ä¾‹å­ï¼š</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">,</span><span class="literal">+</span><span class="title">[</span><span class="literal">-</span><span class="string">.</span><span class="string">,</span><span class="literal">+</span><span class="title">]</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä¸Šé¢çš„å¥å­å¤§è‡´å°±æ˜¯èªªï¼š</p>
<ol>
<li>ç²å–è¼¸å…¥åˆ°ç•¶å‰æŒ‡é‡ã€‚</li>
<li>ç•¶å‰æŒ‡é‡å€¼åŠ ä¸€ã€‚</li>
<li>å¦‚æœç•¶å‰æŒ‡é‡çš„å€¼çˆ² 0ï¼Œé‚£éº¼è·³åˆ°çµæŸä½ç½®ï¼›å¦å‰‡ä¸‹ä¸€æ­¥ã€‚</li>
<li>ç•¶å‰æŒ‡é‡å€¼æ¸›ä¸€ã€‚</li>
<li>è¼¸å‡ºç•¶å‰æŒ‡é‡çš„å€¼ï¼ˆç¶œä¸Šæ‰€è¿°ï¼Œå°±æ˜¯è¼¸å‡ºè¼¸å…¥çš„å€¼ï¼‰ã€‚</li>
<li>ç²å–è¼¸å…¥åˆ°ç•¶å‰æŒ‡é‡ã€‚</li>
<li>ç•¶å‰æŒ‡é‡å€¼åŠ ä¸€ã€‚</li>
<li>è‹¥ç•¶å‰æŒ‡é‡å€¼ä¸çˆ² 0ï¼Œé‚£éº¼è·³åˆ° <code>[</code> å¾Œé¢çš„ä½ç½®â€”â€”å³ç¬¬å››æ­¥ã€‚</li>
</ol>
<p>ã€€ã€€èªªç™½äº†ï¼Œå°±æ˜¯ä¸æ–·ç²å–è¼¸å…¥çš„å€¼ï¼Œå¦‚æœè¼¸å…¥çš„å€¼æ˜¯ 255ï¼Œé‚£éº¼å°±è·³å‡ºå¾ªç’°ï¼Œå¦å‰‡åŸæ¨£è¼¸å‡ºã€‚</p>
<h2 id="é–‹å§‹å¯¦ç¾">é–‹å§‹å¯¦ç¾</h2><p>ã€€ã€€æ˜ç™½äº†ä¸Šé¢çš„é¡Œæ„ä¹‹å¾Œå°±å¯ä»¥é–‹å§‹å¯¦ç¾äº†ï¼Œæ­¥é©Ÿå¤§è‡´ä¸Šå°±æ˜¯é€ä½éæ­·æŒ‡ä»¤ï¼Œç„¶å¾Œä¸€å€‹ <code>switch</code> ä¾†è™•ç†å„ç¨®æŒ‡ä»¤å³å¯ã€‚</p>
<p>ã€€ã€€<strong>CodeWars</strong> çµ¦äº†ä½ ä¸€å€‹å‡½æ•¸åŸå‹ï¼Œä½ åœ¨è£é¢å¯¦ç¾ä»£ç¢¼å°±å¥½äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">brainLuck</span>(<span class="params">code, input</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‰è¶¨å·¥ä½œ">å‰è¶¨å·¥ä½œ</h3><p>ã€€ã€€åœ¨é–‹å§‹ä¹‹å‰ï¼Œæˆ‘å€‘åšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚ç”³æ˜å¹¾å€‹è®Šé‡ä»€éº¼çš„ï¼š</p>
<ul>
<li>è¼¸å…¥æ•¸æ“šç•¶å‰çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯èªªè®€å–å¹¾å€‹ä¹‹å¾Œï¼Œé€™å€‹ä½ç½®è¦åç§»å¹¾ä½ã€‚</li>
<li>ç•¶å‰æŒ‡ä»¤çš„ä½ç½®ã€‚</li>
<li>ç•¶å‰æŒ‡é‡çš„ä½ç½®ã€‚</li>
<li>â€œåƒå…§å­˜å¡Šâ€çš„å€¼ï¼Œç”¨ä¸€å€‹æ•¸çµ„è¡¨ç¤ºï¼Œé»˜èªä¸€å€‹ <code>[ 0 ]</code>ã€‚</li>
<li>éœ€è¦ <code>return</code> çš„å­—ç¬¦ä¸²ï¼Œå³è¼¸å‡ºçš„å€¼ã€‚</li>
<li>æŸå€‹æ‹¬è™ŸåŒ¹é…çš„æ‹¬è™Ÿçš„æŒ‡ä»¤ä¸‹æ¨™çš„é€™éº¼ä¸€å€‹æ˜ å°„æ•¸çµ„ã€‚</li>
</ul>
<p>ã€€ã€€æ‰€ä»¥æ¥ä¸‹å»æˆ‘å€‘è¦æŠŠæ¶å­å¡«æˆé€™æ¨£ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">brainLuck</span>(<span class="params">code, input</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> commandPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> pointerPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> bytes = [ <span class="number">0</span> ];</span><br><span class="line">    <span class="keyword">var</span> output = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">var</span> matching = getMatchingBra(code);    <span class="comment">///&lt; äººå®¶çº”ä¸æ˜¯ç½©ç½©å‘¢ï¼Œæˆ‘æ˜¯ Brackets çš„ç¸®å¯«</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ‹¬è™ŸåŒ¹é…å‡½æ•¸">æ‹¬è™ŸåŒ¹é…å‡½æ•¸</h4><p>ã€€ã€€ä¸Šé¢çš„ <code>getMatchingBra</code> å°±æ˜¯æˆ‘å€‘è¦å¯¦ç¾çš„ä¸€å€‹æ‹¬è™ŸåŒ¹é…å‡½æ•¸äº†ï¼Œæ€æƒ³å°±æ˜¯ç”¨æ£§ã€‚</p>
<p>ã€€ã€€ç¢°åˆ°å‰æ‹¬è™Ÿå°±æŠŠé€™å€‹å‰æ‹¬è™Ÿçš„ä¸‹æ¨™å…¥æ£§ï¼›ç¢°åˆ°å¾Œæ‹¬è™Ÿï¼Œå°±æŠŠæ£§é ‚å…ƒç´ å³å‰æ‹¬è™Ÿçš„ä¸‹æ¨™æ¨å‡ºï¼Œé€™å€‹æ™‚å€™æ‹¬è™ŸåŒ¹é…æ•¸çµ„çš„é€™å€‹å‰æ‹¬è™Ÿä¸‹æ¨™çš„å€¼å°±æ˜¯ç•¶å‰å¾Œæ‹¬è™Ÿçš„ä¸‹æ¨™ï¼Œè€Œå¾Œæ‹¬è™Ÿä¸‹æ¨™çš„å€¼å°±æ˜¯å‰æ‹¬è™Ÿçš„ä¸‹æ¨™äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * ä½ çº”æ˜¯ Bra ï¼/( â—•â€¿â€¿â—• )ï¼¼</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMatchingBra</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> stack = [];</span><br><span class="line">    <span class="keyword">var</span> bra = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; code.length; i++) bra.push(-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; code.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(code[i] === <span class="string">'['</span>) &#123;</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(code[i] === <span class="string">']'</span>) &#123;</span><br><span class="line">            bra[i] = stack.pop();</span><br><span class="line">            bra[bra[i]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bra;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æœ‰äº†é€™å€‹æ•¸çµ„å°±å¯ä»¥éš¨ä¾¿è·³äº†ï¼Œå¦‚æœæŒ‡ä»¤ç¬¬ <code>i</code> ä½æ˜¯ä¸€å€‹æ‹¬è™Ÿï¼ˆä¸ç®¡å‰æ‹¬è™Ÿé‚„æ˜¯å¾Œæ‹¬è™Ÿï¼‰ï¼Œé‚£éº¼å®ƒçš„åŒ¹é…æ‹¬è™Ÿä¸‹æ¨™å°±æ˜¯ <code>matching[i]</code> äº†ã€‚</p>
<h3 id="å„ç¨®æŒ‡ä»¤çš„è™•ç†">å„ç¨®æŒ‡ä»¤çš„è™•ç†</h3><p>ã€€ã€€è¦è™•ç†æŒ‡ä»¤çš„è©±å¯¦éš›ä¸Šå°±æ˜¯ä¸€å€‹ <code>while</code> èªå¥ä¸æ–·å¾ªç’°æŒ‡ä»¤ï¼Œç„¶å¾Œåˆ¤æ–·ç•¶å‰æŒ‡ä»¤æ˜¯ä»€éº¼ç„¶å¾Œåšç›¸æ‡‰çš„äº‹ï¼Œæœ€å¾ŒæŒ‡ä»¤ä½ç½®åŠ ä¸€å°±å¥½äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(commandPos &lt; code.length) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(code[commandPos]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'&gt;'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'&lt;'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'+'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'-'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'.'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">','</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'['</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">']'</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    commandPos++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="&gt;">&gt;</h4><p>ã€€ã€€æŒ‡é‡å³ç§»çš„è©±å°±æŠŠæŒ‡é‡ä½ç½®åŠ ä¸€ï¼Œå¦‚æœå…§å­˜æ•¸çµ„é‚„æ²’ç•¶å‰æŒ‡é‡ä½ç½®çš„å€¼çš„è©± <code>push</code> ä¸€å€‹ <code>0</code> å°±å¥½äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'&gt;'</span>: &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">undefined</span> === bytes[++pointerPos]) bytes.push(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="&lt;">&lt;</h4><p>ã€€ã€€å·¦ç§»å°±æ˜¯æ¸›ä¸€ï¼Œå¦‚æœä½ç½®å°æ–¼ 0ï¼Œé‚£éº¼å…§å­˜æ•¸çµ„å¾å‰æ¨å…¥ä¸€å€‹å€¼ï¼Œä¸¦è®“æŒ‡é‡ç­‰æ–¼ 0ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'&lt;'</span>: &#123;</span><br><span class="line">    <span class="keyword">if</span>(--pointerPos &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        bytes.unshift(<span class="number">0</span>);</span><br><span class="line">        pointerPos = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="+">+</h4><p>ã€€ã€€æ²’ä»€éº¼å¥½èªªçš„ï¼Œå…§å­˜åŠ ä¸€å°±å¥½äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'+'</span>: &#123;</span><br><span class="line">    bytes[pointerPos] = (bytes[pointerPos] + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="-">-</h4><p>ã€€ã€€æ¸›ä¸€ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'-'</span>: &#123;</span><br><span class="line">    bytes[pointerPos]--;</span><br><span class="line">    <span class="keyword">if</span>(bytes[pointerPos] &lt; <span class="number">0</span>) bytes[pointerPos] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="--1">.</h4><p>ã€€ã€€è¼¸å‡ºçš„è©±ç›´æ¥å¾€ <code>output</code> å­—ç¬¦ä¸²è£é¢åŠ ä¸Šç•¶å‰æŒ‡é‡çš„å€¼å°±å¥½äº†ï¼Œæ³¨æ„è¦ ASCII è½‰è®Šä¹‹å¾Œçš„å­—ç¬¦ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'.'</span>: &#123;</span><br><span class="line">    output += <span class="built_in">String</span>.fromCharCode(bytes[pointerPos]);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id=",">,</h4><p>ã€€ã€€è¼¸å…¥çš„è©±å°±è®“ <code>input</code> ç•¶å‰ä½ç½®çš„å€¼è®Šæˆ ASCII å­˜é€²ç•¶å‰æŒ‡é‡ï¼Œç„¶å¾Œè¼¸å…¥ä½ç½®åŠ ä¸€å°±å¥½äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">','</span>: &#123;</span><br><span class="line">    bytes[pointerPos] = input.charCodeAt(inputPos++);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="[">[</h4><p>ã€€ã€€ç”±æ–¼ä¹‹å‰å·²ç¶“åšå¥½äº†åŒ¹é…æ•¸çµ„ï¼Œæ‰€ä»¥æˆ‘å€‘åªéœ€è¦åˆ¤æ–·ç•¶å‰æŒ‡é‡æ˜¯ä¸æ˜¯ 0ï¼Œç„¶å¾Œå¦‚æœæ˜¯å°±è·³åˆ°åŒ¹é…æ‹¬è™Ÿè™•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'['</span>: &#123;</span><br><span class="line">    commandPos = !bytes[pointerPos] ? matching[commandPos] : commandPos;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="]">]</h4><p>ã€€ã€€åŒä¸Šï¼Œåªä¸éæ¢ä»¶æ”¹ä¸€ä¸‹è€Œå·²ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">']'</span>: &#123;</span><br><span class="line">    commandPos = bytes[pointerPos] ? matching[commandPos] : commandPos;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å–„å¾Œå·¥ä½œ">å–„å¾Œå·¥ä½œ</h3><p>ã€€ã€€ä¸Šé¢çš„å‡½æ•¸é«”å®Œæˆä¹‹å¾Œï¼Œæˆ‘å€‘åªéœ€è¦åœ¨æœ€å¾ŒæŠŠ <code>output</code> çµ¦è¿”å›å°±å¥½äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> output;</span><br></pre></td></tr></table></figure>
<h2 id="è‚¢é«”çµ„è£">è‚¢é«”çµ„è£</h2><p>ã€€ã€€å®Œæˆäº†ä¸Šé¢ä¸ƒé›¶å…«è½çš„è‚¢é«”ä¹‹å¾Œï¼Œæˆ‘å€‘è¦æŠŠäº”é¦¬åˆ†å±çš„ä»£ç¢¼çµ¦æ¹Šå›å»ï¼Œæ‰€ä»¥æœ€å¾Œå°±é•·é€™å€‹æ¨£å­äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMatchingBra</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> stack = [];</span><br><span class="line">    <span class="keyword">var</span> bra = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; code.length; i++) bra.push(-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; code.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(code[i] === <span class="string">'['</span>) &#123;</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(code[i] === <span class="string">']'</span>) &#123;</span><br><span class="line">            bra[i] = stack.pop();</span><br><span class="line">            bra[bra[i]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bra;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">brainLuck</span>(<span class="params">code, input</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> commandPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> pointerPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> bytes = [ <span class="number">0</span> ];</span><br><span class="line">    <span class="keyword">var</span> output = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">var</span> matching = getMatchingBra(code);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(commandPos &lt; code.length) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(code[commandPos]) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'&gt;'</span>: &#123;</span><br><span class="line">                pointerPos++;</span><br><span class="line">                <span class="keyword">if</span>(<span class="literal">undefined</span> === bytes[pointerPos]) &#123;</span><br><span class="line">                    bytes.push(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'&lt;'</span>: &#123;</span><br><span class="line">                pointerPos--;</span><br><span class="line">                <span class="keyword">if</span>(<span class="number">0</span> &gt; pointerPos) &#123;</span><br><span class="line">                    bytes.unshift(<span class="number">0</span>);</span><br><span class="line">                    pointerPos = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'+'</span>: &#123;</span><br><span class="line">                bytes[pointerPos] = (bytes[pointerPos] + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'-'</span>: &#123;</span><br><span class="line">                bytes[pointerPos]--;</span><br><span class="line">                <span class="keyword">if</span>(bytes[pointerPos] &lt; <span class="number">0</span>) bytes[pointerPos] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'.'</span>: &#123;</span><br><span class="line">                output += <span class="built_in">String</span>.fromCharCode(bytes[pointerPos]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">','</span>: &#123;</span><br><span class="line">                <span class="keyword">var</span> temp = input.charCodeAt(inputPos++);</span><br><span class="line">                bytes[pointerPos] = temp;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'['</span>: &#123;</span><br><span class="line">                <span class="keyword">if</span>(!bytes[pointerPos]) &#123;</span><br><span class="line">                    commandPos = matching[commandPos];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">']'</span>: &#123;</span><br><span class="line">                <span class="keyword">if</span>(bytes[pointerPos]) &#123;</span><br><span class="line">                    commandPos = matching[commandPos];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        commandPos++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é¡Œå¾Œèª">é¡Œå¾Œèª</h2><p>ã€€ã€€è‰¾ç‘ªï¼Œå¿˜äº†æ”¾é¡Œç›®éˆæ¥äº†ï¼š<a href="http://www.codewars.com/kata/526156943dfe7ce06200063e" target="_blank" rel="external">http://www.codewars.com/kata/526156943dfe7ce06200063e</a>ã€‚ä»¥åŠå¤§å®¶å¦‚æœæœ‰èˆˆè¶£çš„è©±ä¹Ÿå¯ä»¥å»è©¦è©¦çœ‹å¯«å€‹ <a href="http://acm.nbut.edu.cn/Problem/view.xhtml?id=1062" target="_blank" rel="external">HVM</a> çœ‹çœ‹ã€‚</p>
<p>ã€€ã€€å¯¦éš›ä¸Šæœ¬æ–‡å¯¦ç¾çš„æ±è¥¿å¯¦ç”¨æ€§å¹¾ä¹æ²’æœ‰ï¼Œåªä¸éæ˜¯æ‹‹ç£šå¼•ç‰ï¼Œè®“å¤§å®¶åœ¨åšä¸€äº›æ¨¡æ“¬é¡Œé‚è¼¯ï¼ˆæˆ–è€…èªªæ˜¯ç°¡å–®æ¨¡æ“¬é‚è¼¯ï¼‰çš„æ™‚å€™ç†æ¸…æ€è·¯ã€æŒ‰éƒ¨å°±ç­ï¼Œåˆ‡å¿Œè‡ªå·±äº‚äº†æ€è·¯å’Œé‚è¼¯ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€é¦–å…ˆç¥è³€è‡ªå·±åœ¨ <a href="http://www.codewars.com/users/XadillaX" target="_blank" rel="external">CodeWars</a> å‡ç´šåˆ° 3 Kyuï¼Œä»¥åŠæ„Ÿè¬ @<a href="http://ww]]>
    </summary>
    
      <category term="BrainFuck" scheme="http://xcoder.in/tags/BrainFuck/"/>
    
      <category term="Javascript" scheme="http://xcoder.in/tags/Javascript/"/>
    
      <category term="è§£é‡‹å™¨" scheme="http://xcoder.in/tags/%E8%A7%A3%E9%87%8B%E5%99%A8/"/>
    
      <category term="Programming" scheme="http://xcoder.in/categories/Programming/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ç”¨ Node.js å¯¦ç¾ä¸€å€‹ Singleton]]></title>
    <link href="http://xcoder.in/2014/09/30/javascript-singleton/"/>
    <id>http://xcoder.in/2014/09/30/javascript-singleton/</id>
    <published>2014-09-30T07:21:13.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€ä»Šå¤©éš¨ä¾¿ç©äº†ä¸€é“ <a href="http://www.codewars.com/kata/singleton-pattern/javascript" target="_blank" rel="external">CodeWar çš„é¡Œ</a>ã€‚</p>
<p>ã€€ã€€é¡Œæ„å¤§è‡´å°±æ˜¯ä½ éœ€è¦å¯¦ç¾ä¸€å€‹ <code>Singleton</code> ä¹Ÿå°±æ˜¯å–®ä»¶æ¨¡å¼çš„é¡ï¼Œè®“å…¶ä¸‹é¢ä»£ç¢¼åŸ·è¡ŒæˆåŠŸï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = <span class="keyword">new</span> Singleton();</span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="keyword">new</span> Singleton();</span><br><span class="line">obj1 === obj2; <span class="comment">// =&gt; true</span></span><br><span class="line">obj1.test = <span class="number">1</span>;</span><br><span class="line">obj2.test; <span class="comment">// =&gt; 1</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä¸¦ä¸”é‚„æœ‰å¾ˆé‡è¦çš„ä¸€é»å°±æ˜¯ <code>Singleton</code> çš„å°è±¡çš„ <code>instanceof</code> ä¹Ÿå¾—çš„ç¢ºæ˜¯ <code>Singleton</code> æ‰è¡Œã€‚</p>
<h2 id="é–‹å§‹è©¦é©—">é–‹å§‹è©¦é©—</h2><p>ã€€ã€€æˆ‘å€‘çŒœæƒ³ <code>new Singleton()</code> çš„çµæœï¼Œå¦‚æœ <code>Singleton</code> å‡½æ•¸ä¹Ÿå°±æ˜¯é€™å€‹é¡çš„æ§‹é€ å‡½æ•¸æ²’è¿”å›å€¼çš„è©±ï¼Œç›´æ¥æœƒè¿”å› <code>this</code>ï¼Œæœ‰è¿”å›å€¼çš„è©±ï¼Œé‚£éº¼å°±æ˜¯ç­‰æ–¼å…¶è¿”å›å€¼äº†ã€‚</p>
<p>ã€€ã€€æˆ‘å€‘ç¢¼ä¸‹é¢çš„ä»£ç¢¼çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; foo: <span class="string">"bar"</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Singleton());</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è·‘ä¸€éä¹‹å¾Œæˆ‘å€‘çš„ç¢ºç™¼ç¾äº†è¼¸å‡ºçš„å€¼å°±æ˜¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; foo: <span class="string">"bar"</span> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="å°ä½œå¼Šå¤±æ•—">å°ä½œå¼Šå¤±æ•—</h2><p>ã€€ã€€æ–¼æ˜¯æˆ‘é€™éº¼åšï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> foo;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€çµæœä¸Šé¢çš„å¹¾å€‹æ¢ä»¶éƒ½ç¬¦åˆäº†ï¼Œä¸ä¿¡å¤§å®¶å¯ä»¥è‡ªå·±è¼¸å‡ºä¸€éçœ‹çœ‹ã€‚</p>
<p>ã€€ã€€ä½†æ˜¯â€”â€”</p>
<p>ã€€ã€€é€™æ±è¥¿ä¸æ˜¯ä¸€å€‹ <code>Singleton</code> çš„å¯¦ä¾‹ï¼Œå®ƒåªæ˜¯ä¸€å€‹ç°¡å–®çš„ <code>JSON</code> å°è±¡ï¼Œæ‰€ä»¥é‚„æ˜¯ç„¡æ³•é€šéã€‚</p>
<h2 id="æ­»æœˆã®æ­£è§£">æ­»æœˆã®æ­£è§£</h2><p>ã€€ã€€ç­”æ¡ˆæœ‰å¾ˆå¤šï¼ŒCodeWar ä¸Šé¢æ¯å€‹äººçš„è§£æ³•éƒ½ä¸ä¸€æ¨£ï¼Œä½†æ˜¯æ­¸æ ¹çµåº•æœ¬è³ªé‚„æ˜¯å¤§åŒå°ç•°çš„ã€‚</p>
<p>ã€€ã€€å°±æ˜¯ç¬¬ä¸€æ¬¡çš„æ™‚å€™å…ˆç›´æ¥è¿”å› <code>this</code>ï¼Œä¸¦ä¸”æŠŠ <code>this</code> æ”¾åœ¨æŸå€‹åœ°æ–¹ã€‚ä»¥å¾Œæ¯æ¬¡ä¾†é€™è£å‰µå»ºçš„æ™‚å€™è¿”å›ä¹‹å‰å­˜å¥½çš„ <code>this</code> å³å¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Singleton.prototype.instance) <span class="keyword">return</span> Singleton.prototype.instance = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do some initialize things</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    Singleton.prototype.instance = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="åˆ¥çš„å¯«æ³•">åˆ¥çš„å¯«æ³•</h2><p>ã€€ã€€å¯«æ³•å¾ˆå¤šï¼Œæˆ‘é€™è£éš¨æ„æŒ‘å¹¾å€‹åˆ¥äººçš„ç­”æ¡ˆå§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * By tjwudi</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Singleton.ins = Singleton.ins ? Singleton.ins : <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * By nonowarn</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">var</span> Singleton = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> instance = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance || (instance = <span class="keyword">this</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€ä»Šå¤©éš¨ä¾¿ç©äº†ä¸€é“ <a href="http://www.codewars.com/kata/singleton-pattern/javascript" target="_blank" rel="external">CodeWar çš„é¡Œ</a>ã€‚</p>
<p>ã€€ã€€é¡Œæ„]]>
    </summary>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="è¨­è¨ˆæ¨¡å¼" scheme="http://xcoder.in/tags/%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="Node.js" scheme="http://xcoder.in/categories/Node-js/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[è®“æˆ‘å€‘ç”¨ Node.js å¯«è‡ªå·±çš„ DDNS å‹•æ…‹åŸŸåç¨‹åº]]></title>
    <link href="http://xcoder.in/2014/09/20/lets-build-ourselves-ddns/"/>
    <id>http://xcoder.in/2014/09/20/lets-build-ourselves-ddns/</id>
    <published>2014-09-20T07:51:40.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="èµ·å› ">èµ·å› </h2><p>ã€€ã€€ä¸€é–‹å§‹æˆ‘åœ¨ç§»å‹•çš„å¯¬å¸¶ä¸­ã€‚é‚£å€‹æ™‚å€™é›–ç„¶é‚„ä¸æ˜¯å®Œå…¨çš„å±€åŸŸç¶²ï¼Œä½†æ˜¯é›»ä¿¡ç¶²çµ¡è¨ªå•ä¸äº†æˆ‘çš„å¤–ç¶² IPã€‚åˆå› çˆ²æˆ‘éœ€è¦ä¸€å€‹ DDNS æœå‹™ä¾†ç¶­æŒæˆ‘çš„ <a href="http://kacaka.ca/" target="_blank" rel="external">kacaka.ca</a>ï¼ˆç›®å‰æš«å¤±æ•ˆï¼‰ã€‚</p>
<p>ã€€ã€€çˆ²äº†è§£æ±ºè®“é›»ä¿¡ç¶²çµ¡ä¹Ÿèƒ½è¨ªå•æˆ‘çš„ Webï¼Œæ–¼æ˜¯æˆ‘æƒ³åˆ°äº†å…è²» CDN ç•¶ä¸­æ¯”è¼ƒæœ‰åçš„ <a href="http://cloudflare.com/" target="_blank" rel="external">CloudFlare</a>ã€‚è€Œä¸”å®ƒä¹Ÿæœ‰æä¾› API è®“é–‹ç™¼è€…è‡ªå·±é–‹ç™¼é€šéä»–çš„æœå‹™è§£æåŸŸåçš„æœå‹™ã€‚</p>
<p>ã€€ã€€å†ç„¶å¾Œï¼Œå»å¹´çš„ä¹æœˆä»½ï¼Œæˆ‘çš„æ—©æœŸ Node.js ä½œå“ <strong><a href="https://github.com/XadillaX/dloucflare/tree/0.0.2" target="_blank" rel="external">dloucflare</a></strong> ç™¼ä½ˆäº†ã€‚æ‰€ä»¥å°±æœ‰äº†<a href="http://cnodejs.org/topic/522b64c3101e574521332451" target="_blank" rel="external">é€™å€‹å¸–å­</a>ã€‚</p>
<p>ã€€ã€€ç¾åœ¨ï¼Œæˆ‘å·²ç¶“æ¬åˆ°é›»ä¿¡äº†ï¼Œç„¶å¾ŒèˆŠç‰ˆçš„è²Œä¼¼ä¸èƒ½ç”¨äº†ï¼Œå› çˆ² <strong>CloudFlare</strong> è²Œä¼¼ API éƒ½é·ç§»åˆ°äº† <code>https</code> ä¸Šé¢ã€‚ç„¶å¾Œæˆ‘çˆ²äº†æˆ‘çš„å°å¤¥ä¼´å€‘èƒ½è¨ªå•æˆ‘å‡ºç§Ÿå±‹è£çš„èˆŠé›»è…¦ï¼Œåˆé‡æ§‹äº†ä¸€é<a href="https://github.com/XadillaX/dloucflare" target="_blank" rel="external">é€™å€‹é …ç›®</a>ã€‚</p>
<h2 id="ä½¿ç”¨_dlouc-flare_æ§‹å»º">ä½¿ç”¨ dlouc-flare æ§‹å»º</h2><p>ã€€ã€€é¦–å…ˆå®‰è£æœ€æ–°çš„ <code>dlouc-flare</code> åŒ…ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install dlouc-flare</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œå»å‰µå»ºä¸€å€‹ <strong>DF</strong> å°è±¡ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> DloucFlare = <span class="built_in">require</span>(<span class="string">"dlouc-flare"</span>);</span><br><span class="line"><span class="keyword">var</span> df = DloucFlare.create(<span class="string">"ä½ çš„éƒµç®±"</span>, <span class="string">"API KEY"</span>, <span class="string">"åŸŸåï¼ˆä¸éœ€è¦ wwwï¼‰"</span>);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€<strong>CloudFlare</strong> å¦‚ä½•ä½¿ç”¨çš„è©±é€™è£å°±ä¸å¤šåšè§£é‡‹äº†ï¼Œè‡³æ–¼ <strong>API KEY</strong> çš„è©±ï¼Œå¯ä»¥åœ¨<a href="https://www.cloudflare.com/my-account" target="_blank" rel="external">é€™è£</a>ç²å–åˆ°ã€‚</p>
<p>ã€€ã€€ç„¶å¾Œèª¿ç”¨ <code>df.dynamicDomains</code> å‡½æ•¸å»æŠŠä½ é€™å€‹åŸŸåä¸‹é¢çš„ä¸€äº›å­åŸŸååŠ å…¥ä½ é€™å€‹è…³æœ¬çš„å‹•æ…‹åŸŸåç¯„ç–‡ç•¶ä¸­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.dynamicDomains([ <span class="string">"@"</span>, <span class="string">"www"</span>, <span class="string">"å­åŸŸå3"</span>, <span class="string">"å­åŸŸå4"</span>, ... ], æª¢æ¸¬æ™‚é–“é–“éš”);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…¶ä¸­ <code>&quot;@&quot;</code> ä»£è¡¨çš„æ˜¯åŸŸåæ²’æœ‰ <code>www</code> å‰ç¶´çš„æœ¬èº«ã€‚æª¢æ¸¬æ™‚é–“é–“éš”ä»¥æ¯«ç§’çˆ²å–®ä½ã€‚</p>
</blockquote>
<p>ã€€ã€€äº‹å¯¦ä¸Šï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šç¾©ä¸€å€‹æª¢æ¸¬ä½ ç•¶å‰ä¸»æ©Ÿçš„ IP åœ°å€çš„å‡½æ•¸ï¼ˆå¦‚æœä½ ä¸å–œæ­¡ç”¨åŒ…å…§çš„é»˜èªæª¢æ¸¬ IP å‡½æ•¸ï¼‰ã€‚</p>
<p>ã€€ã€€åªè¦ä½ å¯«ä¸€å€‹å‡½æ•¸ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkIp</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// blahblah...</span></span><br><span class="line">    callback(<span class="literal">undefined</span>, IPåœ°å€);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œè¦†è“‹æ‰é»˜èªçš„ IP æª¢æ¸¬å‡½æ•¸å³å¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.getIpFunction = checkIp;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æœ€å¾Œä¿å­˜é€€å‡ºä¸¦ç”¨ <code>node</code> åŸ·è¡Œä½ çš„ç¨‹åºå°±å¥½äº†ï¼Œç¨‹åºå°±æœƒé–‹å§‹æ­¡å¿«åœ°è·‘äº†ã€‚</p>
<p><img src="preview.png" alt="Preview"></p>
<h2 id="å¦‚ä½•è‡ªå·±å¯«ï¼Ÿ">å¦‚ä½•è‡ªå·±å¯«ï¼Ÿ</h2><p>ã€€ã€€å…¶å¯¦è¦å®Œå…¨è‡ªå·±å¯«ä¹Ÿæ˜¯å¾ˆç°¡å–®çš„â€”â€”ç„¡éå°±æ˜¯èª¿ç”¨ä¸€ä¸‹ <strong>CloudFlare</strong> çš„ API è€Œå·²ã€‚</p>
<p>ã€€ã€€æˆ‘å€‘å®šä½æ˜ç¢ºå°±æ˜¯è¦åš DDNSï¼Œæ‰€ä»¥æ²’å¿…è¦é—œä¿‚å…¶å®ƒå¾ˆå¤šä¸ç›¸é—œçš„ APIï¼Œåªéœ€è¦æœ€åŸºç¤çš„å¹¾å€‹å°±å¤ äº†ã€‚</p>
<h3 id="API_è§£æ">API è§£æ</h3><p>ã€€ã€€æ‰€æœ‰ API çš„åŸºç¤ URI éƒ½çˆ²ï¼š<a href="https://www.cloudflare.com/api_json.html" target="_blank" rel="external">https://www.cloudflare.com/api_json.html</a>ã€‚</p>
<h4 id="é©—è­‰ä¿¡æ¯">é©—è­‰ä¿¡æ¯</h4><p>ã€€ã€€æ ¹æ“š <strong>CloudFlare</strong> æ–‡æª”æ‰€èªªï¼Œæ‰€æœ‰çš„æäº¤éƒ½è¦é»ä¸Š<a href="https://www.cloudflare.com/docs/client-api.html#s2.1" target="_blank" rel="external">é©—è­‰ä¿¡æ¯</a>çµ¦ POST éå»ã€‚è€Œé©—è­‰çš„å­—æ®µå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>tkn:</strong> å¾ä½ çš„å€‹äººé é¢ç•¶ä¸­è¤‡è£½å‡ºä¾†çš„ API KEYã€‚</li>
<li><strong>email:</strong> ä½ çš„ç™»éŒ„éƒµç®±ã€‚</li>
<li><strong>a:</strong> æ“ä½œåï¼Œæ¯ç¨®æ“ä½œéƒ½æœ‰å…¶ç‰¹æœ‰çš„æ“ä½œåã€‚</li>
</ul>
<h4 id="ç²å–åŸŸåä¸‹çš„å­åŸŸåè¨˜éŒ„">ç²å–åŸŸåä¸‹çš„å­åŸŸåè¨˜éŒ„</h4><p>ã€€ã€€å…¶æ“ä½œåçˆ² <code>rec_load_all</code>ï¼Œæˆ‘å€‘ä¸é—œå¿ƒå…¶å®ƒä¸é‡è¦çš„åƒæ•¸ï¼Œåªéœ€è¦å†å‚³ä¸€å€‹ <code>z</code> å­—æ®µä»£è¡¨å…¶åŸŸåå°±å¥½äº†ï¼Œèˆ‰å€‹ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"><span class="keyword">var</span> param = &#123;</span><br><span class="line">    a       : <span class="string">"rec_load_all"</span>,</span><br><span class="line">    tkn     : <span class="keyword">this</span>.apiKey,</span><br><span class="line">    email   : <span class="keyword">this</span>.email,</span><br><span class="line">    z       : <span class="keyword">this</span>.domain</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">"https://www.cloudflare.com/api_json.html"</span>;</span><br><span class="line">spidex.post(url, <span class="function"><span class="keyword">function</span>(<span class="params">html, status</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Error status while fetching DNS records."</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> json;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        json = <span class="built_in">JSON</span>.parse(html);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Error while parsing DNS records: "</span> + e.message));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(json.result === <span class="string">"error"</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> msg = json.msg;</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">undefined</span> === msg) msg = <span class="string">"Unknown error."</span>;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(msg));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(json.result === <span class="string">"success"</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> count = json.response.recs.count;</span><br><span class="line">        <span class="keyword">var</span> objects = json.response.recs.objs;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            self.records.push(<span class="keyword">new</span> DNSRecordObject(self, objects[i]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        callback(<span class="literal">undefined</span>, self.records);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Unknown error."</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, param, <span class="string">"utf8"</span>).on(<span class="string">"error"</span>, callback);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä¸Šè¿°ä»£ç¢¼å°±æ˜¯æŠŠ <code>param</code> æ•¸æ“šçµ¦ POST åˆ° API çš„ RESTful è£é¢å»ã€‚ç„¶å¾Œæ ¹æ“šè¿”å›å€¼é€²è¡Œè§£æã€‚</p>
<blockquote>
<p>é—œæ–¼ <code>DNSRecordObject</code> çš„ä»£ç¢¼å¯ä»¥è‡ªè¡Œç¿»é–±<a href="https://github.com/XadillaX/dloucflare/blob/master/lib/dnsrecordobject.js" target="_blank" rel="external">é€™è£</a>ã€‚</p>
<p>ä»¥åŠ <strong>spidex</strong> çš„æ–‡æª”åœ¨<a href="https://www.npmjs.org/package/spidex#readme" target="_blank" rel="external">é€™è£</a>ã€‚</p>
</blockquote>
<h4 id="ä¿®æ”¹æŸè¨˜éŒ„">ä¿®æ”¹æŸè¨˜éŒ„</h4><p>ã€€ã€€å…¶æ“ä½œåçˆ² <code>rec_edit</code>ï¼Œå¦‚<a href="https://www.cloudflare.com/docs/client-api.html#s5.2" target="_blank" rel="external">æ–‡æª”</a>æ‰€èªªï¼Œé™¤äº†å›ºæœ‰çš„å¹¾å€‹åƒæ•¸ä¹‹å¤–ï¼Œæˆ‘å€‘é‚„éœ€è¦æœ‰å¦‚ä¸‹åƒæ•¸ï¼š</p>
<ul>
<li><code>z:</code> åŸŸåã€‚</li>
<li><code>id:</code> åŸŸåè¨˜éŒ„ç·¨è™Ÿï¼Œå¾ <code>rec_load_all</code> ä¸­ç²å–ã€‚</li>
<li><code>type:</code> è¨˜éŒ„é¡å‹ã€‚å¦‚ <code>A</code> / <code>CNAME</code> ç­‰ç­‰ã€‚</li>
<li><code>name:</code> å­åŸŸååï¼Œå¦‚æœç„¡å‰ç¶´å­åŸŸåå‰‡èˆ‡åŸŸåç›¸åŒã€‚</li>
<li><code>content:</code> å€¼ã€‚å¦‚æœæˆ‘å€‘åªæ˜¯åšå‹•æ…‹åŸŸåçš„è©±ï¼Œé€™è£çš„å€¼å°±æ˜¯ IPã€‚</li>
<li><code>service_mode:</code> æœå‹™é¡å‹ï¼Œå¡«åŸå€¼å³å¯ã€‚</li>
<li><code>ttl</code>: TTLï¼Œå¡«åŸå€¼å³å¯ã€‚</li>
</ul>
<blockquote>
<p>ä¸Šé¢åƒæ•¸çš„è§£èªªåªæ˜¯å°æ–¼æˆ‘å€‘è¦åš DDNS è…³æœ¬è€Œè¨€çš„è§£é‡‹ã€‚</p>
</blockquote>
<p>ã€€ã€€æ‰€ä»¥èªªåœ¨ <strong><a href="https://github.com/XadillaX/dloucflare/blob/master/lib/dnsrecordobject.js" target="_blank" rel="external">dnsrecordobject.js</a></strong> ä¸­æˆ‘æ˜¯é€™éº¼åšçš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> param = &#123;</span><br><span class="line">    a       : <span class="string">"rec_edit"</span>,</span><br><span class="line">    tkn     : <span class="keyword">this</span>.dloucflare.apiKey,</span><br><span class="line">    email   : <span class="keyword">this</span>.dloucflare.email,</span><br><span class="line">    id      : <span class="keyword">this</span>.recordId(),</span><br><span class="line"></span><br><span class="line">    z       : <span class="keyword">this</span>.domain,</span><br><span class="line">    type    : <span class="keyword">this</span>.recordType(),</span><br><span class="line">    name    : <span class="keyword">this</span>.name,</span><br><span class="line">    content : ip,</span><br><span class="line"></span><br><span class="line">    service_mode    : <span class="keyword">this</span>.object.service_mode,</span><br><span class="line">    ttl     : <span class="keyword">this</span>.object.ttl</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">spidex.post(config.baseUrl, <span class="function"><span class="keyword">function</span>(<span class="params">html, status, respHeader</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Error status while editing "</span> + self.name + <span class="string">"."</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> json;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        json = <span class="built_in">JSON</span>.parse(html);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Error while parsing editing result: "</span> + e.message));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(json.result === <span class="string">"success"</span>) &#123;</span><br><span class="line">        self.object.content = ip;</span><br><span class="line">        <span class="keyword">return</span> callback();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> msg = json.msg || <span class="string">"Unknown error."</span>;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(msg));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, param, <span class="string">"utf8"</span>).on(<span class="string">"error"</span>, callback);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸Šé¢çš„ä»£ç¢¼å°±èƒ½å°‡ä½ æŸå€‹åŸŸåï¼ˆ<code>this.domain</code>ï¼‰ä¸‹çš„å­åŸŸå <code>this.name</code> çš„ IP çµ¦ä¿®æ”¹æˆ <code>ip</code> äº†ã€‚</p>
</blockquote>
<h4 id="æ¢æ¸¬_IP">æ¢æ¸¬ IP</h4><p>ã€€ã€€é€™ç¨® API ç¶²ä¸Šå°±å¤šäº†å»äº†ã€‚</p>
<p>ã€€ã€€èˆ‰å€‹ç°¡å–®çš„ä¾‹å­ï¼Œæˆ‘çš„ <code>dlouc-flare</code> çš„ç²å– IP çš„ API å°±æ˜¯å¾</p>
<blockquote>
<p><a href="http://www.telize.com/ip" target="_blank" rel="external">http://www.telize.com/ip</a></p>
</blockquote>
<p>ã€€ã€€ä¾†çš„ã€‚</p>
<p>ã€€ã€€è«‹æ±‚ä¸Šé¢çš„åœ°å€ä¹‹å¾Œï¼Œè¼¸å‡ºçš„å…§å®¹ï¼ˆæ³¨æ„æœ‰æ›è¡Œç¬¦ï¼‰å°±æ˜¯ä½ ç•¶å‰æ©Ÿå­æ‰€åœ¨çš„ç¶²çµ¡çš„å…¬ç¶² IP äº†ã€‚</p>
<p>ã€€ã€€é¡ä¼¼çš„ API é‚„æœ‰å¾ˆå¤šï¼š</p>
<ul>
<li><strong><a href="http://ip-api.com/json" target="_blank" rel="external">http://ip-api.com/json</a></strong>: é€™å€‹ API å°±æœƒè¼¸å‡ºä¸€å †çš„ JSONï¼Œéœ€è¦è‡ªè¡Œè§£æã€‚</li>
<li><strong><a href="http://ip.taobao.com/service/getIpInfo2.php?ip=myip" target="_blank" rel="external">http://ip.taobao.com/service/getIpInfo2.php?ip=myip</a></strong>: é€™å€‹æ˜¯æ·˜å¯¶æä¾›çš„ RESTful ç²å– IP çš„ APIã€‚</li>
<li>â€¦ï¼ˆå…¶å®ƒçš„å¯ä»¥è‡ªå·±å»ç™¼ç¾ï¼‰</li>
</ul>
<h3 id="æµç¨‹">æµç¨‹</h3><p>ã€€ã€€æœ‰äº†ä¸Šé¢çš„ä»¨ APIï¼Œä¸€åˆ‡éƒ½å¥½èªªäº†ï¼Œæµç¨‹å¾ˆç°¡å–®ï¼š</p>
<ul>
<li>ç²å–è‡ªå·±æŸå€‹ä½¿ç”¨ <code>CloudFlare</code> è§£æçš„åŸŸåä¸‹çš„<a href="#ç²å–åŸŸåä¸‹çš„å­åŸŸåè¨˜éŒ„">å­åŸŸå</a>ã€‚</li>
<li>è‡ªå·±è¨­ç½®å¹¾å€‹å­åŸŸååæ‹¿ä¾†åš DDNSã€‚</li>
<li>è¨­ç½®ä¸€å€‹å®šæ™‚å™¨ï¼Œæ¯æ¬¡å®šæ™‚å™¨åˆ°æ™‚çš„æ™‚å€™éƒ½é€²è¡Œå¦‚ä¸‹æ“ä½œï¼š<ol>
<li>é€šé <a href="#æ¢æ¸¬_IP">IP çš„ API</a> ç²å–ç•¶å‰ IPã€‚</li>
<li>å¾ªç’°éæ­·æ¯å€‹è‡ªå·±è¨­ç½®çš„å­åŸŸååã€‚</li>
<li>å°æ–¼æ¯å€‹å­åŸŸåï¼Œéƒ½åˆ¤æ–·å…¶ç•¶å‰è¨˜éŒ„ IP æ˜¯å¦ç­‰æ–¼ç•¶å‰å‰›æ¢æ¸¬çš„ IPã€‚<ul>
<li><strong>æ˜¯</strong>ï¼š<a href="#ä¿®æ”¹æŸè¨˜éŒ„">ä¿®æ”¹è©²å­åŸŸåçš„è¨˜éŒ„å€¼</a>çˆ²å‰›æ¢æ¸¬çš„ IPã€‚</li>
<li><strong>å¦</strong>ï¼šä¸ä½œä»»ä½•æ“ä½œã€‚</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>ã€€ã€€æœ‰äº†ä¸Šé¢çš„å¹¾å€‹æ­¥é©Ÿï¼ŒåŠ ä¸Šä¹‹å‰æˆ‘å€‘è¬›çš„å¹¾å€‹ APIï¼Œå¤§å®¶å°±èƒ½è¼•é¬†åŠ æ„‰å¿«åœ°å®Œæˆè‡ªå·±çš„ DDNS è…³æœ¬äº†ã€‚</p>
<p>ã€€ã€€ç•¶ç„¶ï¼Œå¦‚æœè‡ªå·±æ‡¶çš„è©±ä¹Ÿå¯ä»¥ç”¨æœ¬æ–‡ä¸€é–‹å§‹çš„æ–¹æ³•ï¼Œä½¿ç”¨ <code>dlouc-flare</code> é€™å€‹åŒ…ï¼Œé€šéç°¡å–®çš„ç·¨ç¢¼å°±èƒ½å¯¦ç¾è‡ªå·±çš„ DDNS å‹•æ…‹åŸŸåè…³æœ¬äº†ã€‚</p>
<blockquote>
<p>é€™è£çš„å®šæ™‚å™¨æ™‚é–“è‡ªå·±æŒ‰éœ€è€Œå®šï¼Œå°±æˆ‘è‡ªå·±è€Œè¨€ï¼Œæˆ‘æ˜¯çµ¦è¨­ç½®äº† <code>1000 * 60</code> æ¯«ç§’çš„é–“éš”ã€‚</p>
</blockquote>
<h2 id="å°çµ">å°çµ</h2><p>ã€€ã€€æœ€æ—©èˆ‡å‹•æ…‹åŸŸåçµç·£çš„æ™‚å€™æ˜¯åˆä¸­çš„æ™‚å€™ï¼Œå¤§æ¦‚ä¸ƒå…«å¹´å‰äº†å§ï¼Œé‚£å€‹æ™‚å€™èŠ±ç”Ÿæ®¼ä»€éº¼çš„ï¼Œä½†æ˜¯æœ€çµ‚ç”¨çš„æ˜¯ <code>3322.org</code>ã€‚</p>
<p>ã€€ã€€å…¶å¯¦åŸºæœ¬çš„å‹•æ…‹åŸŸåçš„åŸç†å¾ˆç°¡å–®ï¼Œç„¡éå°±æ˜¯æœ¬åœ°é–‹ä¸€å€‹è…³æœ¬ï¼Œä¸åœå»æ¢æ¸¬æœ¬æ©Ÿ IPï¼Œä¸€æ—¦æœ‰è®ŠåŒ–å°±å»è§£ææœå‹™å™¨ä¿®æ”¹ã€‚</p>
<p>ã€€ã€€æœ¬äººåœ¨é€™è£æ‹‹ç£šå¼•ç‰ã€‚å¦‚æœå“ªè£æœ‰åˆ¥çš„è§£æå•†çš„ APIï¼Œå¤§å®¶è‡ªå·±ä¹Ÿå¯ä»¥èˆ‰ä¸€åä¸‰ï¼Œå¯«ä»€éº¼ DNSPod çš„å‹•æ…‹åŸŸåï¼Œå¯«ä»€éº¼ jiasule çš„å‹•æ…‹åŸŸåç­‰ç­‰ç­‰ç­‰ã€‚</p>
<p>ã€€ã€€å–µ~<em>à¬˜(à©­</em>ËŠáµ•Ë‹)à©­* à©ˆâœ©â€§â‚ŠËš</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="èµ·å› ">èµ·å› </h2><p>ã€€ã€€ä¸€é–‹å§‹æˆ‘åœ¨ç§»å‹•çš„å¯¬å¸¶ä¸­ã€‚é‚£å€‹æ™‚å€™é›–ç„¶é‚„ä¸æ˜¯å®Œå…¨çš„å±€åŸŸç¶²ï¼Œä½†æ˜¯é›»ä¿¡ç¶²çµ¡è¨ªå•ä¸äº†æˆ‘çš„å¤–ç¶² IPã€‚åˆå› çˆ²æˆ‘éœ€è¦ä¸€å€‹ DDNS æœå‹™ä¾†ç¶­æŒæˆ‘çš„ <a href="http://kacaka.ca/" target="_blank" rel=]]>
    </summary>
    
      <category term="DDNS" scheme="http://xcoder.in/tags/DDNS/"/>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="å‹•æ…‹åŸŸå" scheme="http://xcoder.in/tags/%E5%8B%95%E6%85%8B%E5%9F%9F%E5%90%8D/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[åœ–ç‰‡ä¸»é¡Œè‰²æå–ç®—æ³•å°çµ]]></title>
    <link href="http://xcoder.in/2014/09/17/theme-color-extract/"/>
    <id>http://xcoder.in/2014/09/17/theme-color-extract/</id>
    <published>2014-09-17T03:34:54.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>æ‰€è¬‚ä¸»é¡Œè‰²æå–ï¼Œå°±æ˜¯å°æ–¼ä¸€å¼µåœ–ç‰‡ï¼Œè¿‘ä¼¼åœ°æå–å‡ºä¸€å€‹èª¿è‰²æ¿ï¼Œä½¿å¾—èª¿è‰²æ¿è£é¢çš„é¡è‰²èƒ½çµ„æˆé€™å¼µåœ–ç‰‡çš„ä¸»è‰²èª¿ã€‚</p>
</blockquote>
<p>ã€€ã€€ä»¥ä¸Šå®šç¾©çˆ²æˆ‘å€‹äººèƒ¡è¬…çš„ã€‚</p>
<p>ã€€ã€€å¤§å®¶ä¸è¦å¤ªæŠŠæˆ‘çš„æ±è¥¿ç•¶æˆåš´è¬¹çš„æ–‡ç« ä¾†çœ‹ï¼Œå¾ˆå¤šæ±è¥¿ä»€éº¼çš„éƒ½æ˜¯æˆ‘ç”¨æˆ‘è‡ªå·±çš„ç†è§£å»åšï¼Œä¸¦æ²’æœ‰åšå¤šå°‘è€ƒè­‰ã€‚</p>
<p>ã€€ã€€è§£æä¸­éƒ½æœƒä»¥ Node.js ä¾†å¯«ä¸€äº›å° Demoã€‚</p>
<h2 id="å¼•å­">å¼•å­</h2><p>ã€€ã€€å¯«è©²æ–‡ç« ä¸»è¦æ˜¯çˆ²äº†å°æˆ‘é€™å¹¾å¤©å°æ–¼ã€ä¸»é¡Œè‰²æå–ã€ç®—æ³•ç ”ç©¶é€²è¡Œä¸€å€‹å°çµã€‚</p>
<p>ã€€ã€€èŠ±ç“£ç¶²éœ€è¦åšä¸€ä»¶äº‹ï¼Œå°±æ˜¯æŠŠåœ–ç‰‡çš„ä¸»é¡Œè‰²æå–å‡ºä¾†åŠ å…¥åˆ°èŠ±ç“£ç¶²æœç´¢å¼•æ“çš„ç´¢å¼•ç•¶ä¸­ï¼Œä»¥ä¾›ç”¨æˆ¶æœç´¢ã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯æœ‰äº†ä¸€å€‹éœ€æ±‚ï¼šæå–å‡ºåœ–ç‰‡ä¸­åœ¨æŸå€‹è¦å®šèª¿è‰²æ¿ä¸­çš„é¡è‰²ï¼ŒåŠ å…¥åˆ°æœç´¢å¼•æ“ã€‚</p>
<p>ã€€ã€€æ¥ä¸‹å»å°±é–‹å§‹è§£æå…©ç¨®ä¸åŒçš„ç®—æ³•ä»¥åŠåœ¨é€™ç¨®æ¥­å‹™å ´æ™¯ç•¶ä¸­çš„æ‡‰ç”¨ã€‚</p>
<h2 id="ç®—æ³•è§£æ">ç®—æ³•è§£æ</h2><h3 id="é­”æ³•æ•¸å­—æ³•"><del>é­”æ³•æ•¸å­—æ³•</del></h3><p>ã€€ã€€é€™å€‹ç®—æ³•å¤§å®¶å¯ä»¥å¿½ç•¥ï¼Œå¯èƒ½æ˜¯æˆ‘ä½¿ç”¨çš„å§¿å‹¢ä¸å°ï¼Œç¸½ä¹‹æå–å‡ºä¾†ï¼ˆä¹Ÿè¨±å®ƒæ ¹æœ¬å°±ä¸æ˜¯é€™éº¼ç”¨çš„ï¼‰çš„æ±è¥¿éŒ¯èª¤å¾ˆå¤§ã€‚</p>
<p>ã€€ã€€ä¸éçœ‹ä¸€ä¸‹ä¹Ÿå¥½é–‹é—Šä¸‹çœ¼ç•Œï¼Œå°¤å…¶æ˜¯æˆ‘é€™ç¨®æƒ³åšéŠæˆ²åˆä¸å°å¿ƒæ‰é€²äº’è¯ç¶²çš„å‘è£çš„è’Ÿè’»ä¾†èªªã€‚</p>
<p>ã€€ã€€é¦–å…ˆè©²ç®—æ³•æˆ‘æ˜¯å¾<a href="http://dev.gameres.com/Program/Visual/Other/256color.htm" target="_blank" rel="external">é€™è£</a>æ‰¾åˆ°çš„ã€‚æƒ³ç•¶å¹´æˆ‘é‚„æ˜¯ç¶“å¸¸é€› <a href="http://www.gameres.com/" target="_blank" rel="external">GameRes</a> çš„ã€‚ãƒ¾(;ï¾Ÿ;Ğ”;ï¾Ÿ;)ï¾‰ï¾</p>
<p>ã€€ã€€ç„¶å¾Œè¼¾è½‰åå´æœ€çµ‚ç™¼ç¾é€™æ®µä»£ç¢¼æ˜¯æå–è‡ª <a href="https://github.com/liballeg/allegro5/blob/4.3/src/color.c#L268-L328" target="_blank" rel="external">Allegro</a> éŠæˆ²å¼•æ“ã€‚</p>
<p>ã€€ã€€å…·é«”æˆ‘ä¹Ÿå°±ä¸è¬›äº†ï¼Œç•¢ç«Ÿæ‰¾ä¸åˆ°è³‡æ–™ï¼Œåªæ˜¯ç²—ç²—ç„äº†çœ¼ä»£ç¢¼è£é¢æœ‰å¹¾å€‹é­”æ³•æ•¸å­—ï¼ˆåœ¨éŠæˆ²å’Œç®—æ³•é ˜åŸŸé­”æ³•æ•¸å­—å€’æ˜¯éå¸¸å¸¸è¦‹çš„ï¼‰ï¼Œä¹Ÿæ²’æ™‚é–“æ·±å…¥è§£è®€é€™æ®µä»£ç¢¼ã€‚</p>
<p>ã€€ã€€æˆ‘æŠŠå®ƒç¿»è­¯æˆäº† Node.jsï¼Œç„¶å¾Œæ”¾åœ¨äº† <a href="https://github.com/XadillaX/theme-color-test/blob/master/version1/magicnumber.js" target="_blank" rel="external">Demo</a> ç•¶ä¸­ã€‚å¤§å®¶æœ‰èˆˆè¶£å¯ä»¥è‡ªå·±å»çœ‹çœ‹ã€‚</p>
<h3 id="å…«å‰æ¨¹æå–æ³•">å…«å‰æ¨¹æå–æ³•</h3><p>ã€€ã€€é€™å€‹ç®—æ³•åœ¨é¡è‰²é‡åŒ–ä¸­æ¯”è¼ƒå¸¸è¦‹çš„ã€‚</p>
<blockquote>
<p>è©²ç®—æ³•æœ€æ—©è¦‹æ–¼ 1988 å¹´ï¼Œ<strong><em>M. Gervautz</em></strong> å’Œ <strong><em>W. Purgathofer</em></strong> ç™¼è¡¨çš„è«–æ–‡<strong><em>ã€ŠA Simple Method for Color Quantization: Octree Quantizationã€‹</em></strong>ç•¶ä¸­ã€‚å…¶æ™‚é–“è¤‡é›œåº¦å’Œç©ºé–“è¤‡é›œåº¦éƒ½æœ‰å¾ˆå¤§çš„å„ªå‹¢ï¼Œä¸¦ä¸”ä¿çœŸåº¦ä¹Ÿæ˜¯éå¸¸çš„é«˜ã€‚</p>
</blockquote>
<p>ã€€ã€€å¤§è‡´çš„æ€è·¯å°±æ˜¯å°æ–¼æŸä¸€å€‹åƒç´ é»çš„é¡è‰² <strong>R / G / B</strong> åˆ†é–‹ä¾†ä¹‹å¾Œï¼Œç”¨äºŒé€²åˆ¶é€è¡Œå¯«ä¸‹ã€‚</p>
<p>ã€€ã€€å¦‚ <code>#FF7800</code>ï¼Œå…¶ä¸­ <strong>R</strong> é€šé“çˆ² <code>0xFF</code>ï¼Œä¹Ÿå°±æ˜¯ <code>255</code>ï¼Œ<strong>G</strong> çˆ² <code>0x78</code> ä¹Ÿå°±æ˜¯ <code>120</code>ï¼Œ<strong>B</strong> çˆ² <code>0x00</code> ä¹Ÿå°±æ˜¯ <code>0</code>ã€‚</p>
<p>ã€€ã€€æ¥ä¸‹å»æˆ‘å€‘æŠŠå®ƒå€‘å¯«æˆäºŒé€²åˆ¶é€è¡Œæ”¾ä¸‹ï¼Œé‚£éº¼å°±æ˜¯ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">R: <span class="number">1111</span> <span class="number">1111</span></span><br><span class="line">G: <span class="number">0111</span> <span class="number">1000</span></span><br><span class="line">B: <span class="number">0000</span> <span class="number">0000</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€<strong>RGB</strong> é€šé“é€åˆ—é»åˆä¹‹å¾Œçš„å€¼å°±æ˜¯å…¶åœ¨æŸä¸€å±¤ç¯€é»çš„å­ç¯€é»ç·¨è™Ÿäº†ã€‚æ¯ä¸€åˆ—ä¸€å…±æ˜¯ä¸‰ä½ï¼Œé‚£éº¼å–å€¼ç¯„åœå°±æ˜¯ <code>0 ~ 7</code> ä¹Ÿå°±æ˜¯ä¸€å…±æœ‰å…«ç¨®æƒ…æ³ã€‚é€™å°±æ˜¯çˆ²ä»€éº¼é€™ç¨®ç®—æ³•è¦é–‹å…«å‰æ¨¹ä¾†è¨ˆç®—çš„åŸå› äº†ã€‚</p>
<p>ã€€ã€€èˆ‰å€‹ä¾‹å­ï¼Œä¸Šè¿°é¡è‰²çš„ç¬¬ä¸€ä½é»åˆèµ·ä¾†æ˜¯ <code>100(2)</code>ï¼Œè½‰åŒ–çˆ²åé€²åˆ¶å°±æ˜¯ 4ï¼Œæ‰€ä»¥é€™å€‹é¡è‰²åœ¨ç¬¬ä¸€å±¤æ˜¯æ”¾åœ¨æ ¹ç¯€é»çš„ç¬¬äº”å€‹å­ç¯€é»ç•¶ä¸­ï¼›ç¬¬äºŒä½æ˜¯ <code>110(2)</code> ä¹Ÿå°±æ˜¯ 6ï¼Œé‚£éº¼å®ƒå°±æ˜¯æ ¹ç¯€é»çš„ç¬¬äº”å€‹å…’å­çš„ç¬¬ä¸ƒå€‹å…’å­ã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯æˆ‘å€‘æœ‰äº†é€™æ¨£çš„ä¸€å€‹ç¯€é»çµæ§‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> OctreeNode = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.isLeaf = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.pixelCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.red = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.green = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.blue = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.children = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.children.length; i++) <span class="keyword">this</span>.children[i] = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€™è£çš„ next ä¸æ˜¯æŒ‡å…„å¼Ÿéˆä¸­çš„ next æŒ‡é‡</span></span><br><span class="line">    <span class="comment">// è€Œæ˜¯åœ¨ reducible éˆè¡¨ä¸­çš„ä¸‹ä¸€å€‹ç¯€é»</span></span><br><span class="line">    <span class="keyword">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>isLeaf</code>: è¡¨æ˜è©²ç¯€é»æ˜¯å¦çˆ²è‘‰å­ç¯€é»ã€‚</li>
<li><code>pixelCount</code>: åœ¨è©²ç¯€é»çš„é¡è‰²ä¸€å…±æ’å…¥äº†å¹¾æ¬¡ã€‚</li>
<li><code>red</code>: è©²ç¯€é» <strong>R</strong> é€šé“ç´¯åŠ å€¼ã€‚</li>
<li><code>green</code>: <strong>G</strong> ç´¯åŠ å€¼ã€‚</li>
<li><code>blue</code>: <strong>B</strong> ç´¯åŠ å€¼ã€‚</li>
<li><code>children</code>: å…«å€‹å­ç¯€é»æŒ‡é‡ã€‚</li>
<li><code>next</code>: <strong><em>reducible</em></strong> éˆè¡¨çš„ä¸‹ä¸€å€‹ç¯€é»æŒ‡é‡ï¼Œå¾Œé¢æœƒä½œè©³ç´°è§£é‡‹ï¼Œç›®å‰å¯ä»¥å…ˆå¿½ç•¥ã€‚</li>
</ul>
<h4 id="æ’å…¥é¡è‰²">æ’å…¥é¡è‰²</h4><p>ã€€ã€€æ ¹æ“šä¸Šé¢çš„ç†è«–ï¼Œæˆ‘å€‘å¤§è‡´å°±çŸ¥é“äº†å¾€å…«å‰æ¨¹æ’å…¥ä¸€å€‹åƒç´ é»é¡è‰²çš„æ­¥é©Ÿäº†ã€‚</p>
<p>ã€€ã€€å°±æ˜¯æ¯ä¸€ä½ <strong>RGB</strong> é€šé“é»åˆçš„å€¼å°±æ˜¯å®ƒåœ¨æ¨¹çš„é‚£ä¸€å±¤çš„å­ç¯€é»çš„ç·¨è™Ÿã€‚</p>
<p>ã€€ã€€å¤§è‡´å¯ä»¥çœ‹ä¸‹åœ–ï¼š</p>
<p><img src="http://www.microsoft.com/msj/archive/wicked1.gif" alt="å…«å‰æ¨¹æ’å…¥"><br><small>åœ–ç‰‡ä¾†æºï¼š<a href="http://www.microsoft.com/msj/archive/S3F1.aspx" target="_blank" rel="external">http://www.microsoft.com/msj/archive/S3F1.aspx</a></small></p>
<p>ã€€ã€€ç”±æ­¤å¯ä»¥æ¨æ–·ï¼Œåœ¨æ²’æœ‰ä»»ä½•é¡è‰²åˆä½µçš„æƒ…æ³ä¸‹ï¼Œæ’å…¥ä¸€ç¨®é¡è‰²æœ€å£çš„æƒ…æ³ä¸‹æ˜¯é€²è¡Œ 64 æ¬¡æª¢ç´¢ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>æˆ‘å€‘å°‡æœƒæŠŠè©²é¡è‰²çš„ RGB åˆ†é‡åˆ†åˆ¥ç´¯åŠ åˆ°è©²ç¯€é»çš„å„åˆ†é‡å€¼ä¸­ï¼Œä»¥ä¾¿æœ€çµ‚æ±‚å¹³å‡æ•¸ã€‚</p>
</blockquote>
<p>ã€€ã€€å¤§è‡´çš„æµç¨‹å°±æ˜¯å¾æ ¹ç¯€é»é–‹å§‹ DFSï¼Œå¦‚æœåˆ°é”çš„ç¯€é»æ˜¯è‘‰å­ç¯€é»ï¼Œé‚£éº¼åˆ†é‡ã€é¡è‰²ç¸½æ•¸ç´¯åŠ ï¼›å¦å‰‡å°±æ ¹æ“šå±¤æ•¸å’Œè©²é¡è‰²çš„ç¬¬å±¤æ•¸ä½é¡è‰²é»åˆå€¼å¾—åˆ°å…¶å­ç¯€é»åºè™Ÿã€‚è‹¥è©²å­ç¯€é»ä¸å­˜åœ¨å°±å‰µå»ºä¸€å€‹å­ç¯€é»ä¸¦èˆ‡è©²çˆ¶ç¯€é»é—œè¯ï¼Œå¦å‰‡å°±ç›´æ¥æœä¸‹ä¸€å±¤å»ã€‚</p>
<p>ã€€ã€€å‰µå»ºçš„æ™‚å€™æ ¹æ“šå±¤æ•¸ä¾†ç¢ºå®šå®ƒæ˜¯ä¸æ˜¯è‘‰å­ç¯€é»ï¼Œå¦‚æœæ˜¯çš„è©±éœ€è¦æ¨™è¨˜ä¸€ä¸‹ï¼Œä¸¦ä¸”å…¨å±€çš„è‘‰å­ç¯€é»æ•¸è¦åŠ ä¸€ã€‚</p>
<p>ã€€ã€€é‚„æœ‰ä¸€é»éœ€è¦æ³¨æ„çš„å°±æ˜¯å¦‚æœé€™å€‹ç¯€é»ä¸æ˜¯è‘‰å­ç¯€é»ï¼Œå°±å°‡å…¶ä¸Ÿåˆ° <strong><em>reducible</em></strong> ç›¸æ‡‰å±¤æ•¸çš„éˆè¡¨ç•¶ä¸­å»ï¼Œä»¥ä¾›ä¹‹å¾Œé¡è‰²åˆä½µçš„æ™‚å€™ç”¨ã€‚é—œæ–¼é¡è‰²åˆä½µçš„å…§å®¹å¾Œé¢æœƒé€²è¡Œè§£é‡‹ã€‚</p>
<p>ã€€ã€€ä¸‹é¢æ˜¯å‰µå»ºç¯€é»çš„ä»£ç¢¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createNode</span>(<span class="params">idx, level</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> node = <span class="keyword">new</span> OctreeNode();</span><br><span class="line">    <span class="keyword">if</span>(level === <span class="number">7</span>) &#123;</span><br><span class="line">        node.isLeaf = <span class="literal">true</span>;</span><br><span class="line">        leafNum++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å°‡å…¶ä¸Ÿåˆ°ç¬¬ level å±¤çš„ reducible éˆè¡¨ä¸­</span></span><br><span class="line">        node.next = reducible[level];</span><br><span class="line">        reducible[level] = node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä»¥åŠä¸‹é¢æ˜¯æ’å…¥æŸç¨®é¡è‰²çš„ä»£ç¢¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addColor</span>(<span class="params">node, color, level</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node.isLeaf) &#123;</span><br><span class="line">        node.pixelCount++;</span><br><span class="line">        node.red += color.r;</span><br><span class="line">        node.green += color.g;</span><br><span class="line">        node.blue += color.b;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ç”±æ–¼ js å…§éƒ¨éƒ½æ˜¯ä»¥æµ®é»å‹å­˜å„²æ•¸å€¼ï¼Œæ‰€ä»¥ä½é‹ç®—ä¸¦æ²’æœ‰é‚£éº¼é«˜æ•ˆ</span></span><br><span class="line">        <span class="comment">// åœ¨æ­¤ä½¿ç”¨ç›´æ¥è½‰æ›å­—ç¬¦ä¸²çš„æ–¹å¼æå–æŸä¸€ä½çš„å€¼</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// å¯¦éš›ä¸Šå¦‚æœç”¨ä½é‹ç®—ä¾†åšçš„è©±å°±æ˜¯é€™æ¨£å­çš„ï¼š</span></span><br><span class="line">        <span class="comment">//   https://github.com/XadillaX/thmclrx/blob/7ab4de9fce583e88da6a41b0e256e91c45a10f67/src/octree.cpp#L91-L103</span></span><br><span class="line">        <span class="keyword">var</span> str = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">var</span> r = color.r.toString(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">var</span> g = color.g.toString(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">var</span> b = color.b.toString(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">while</span>(r.length &lt; <span class="number">8</span>) r = <span class="string">'0'</span> + r;</span><br><span class="line">        <span class="keyword">while</span>(g.length &lt; <span class="number">8</span>) g = <span class="string">'0'</span> + g;</span><br><span class="line">        <span class="keyword">while</span>(b.length &lt; <span class="number">8</span>) b = <span class="string">'0'</span> + b;</span><br><span class="line"></span><br><span class="line">        str += r[level];</span><br><span class="line">        str += g[level];</span><br><span class="line">        str += b[level];</span><br><span class="line">        <span class="keyword">var</span> idx = <span class="built_in">parseInt</span>(str, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> === node.children[idx]) &#123;</span><br><span class="line">            node.children[idx] = createNode(node, idx, level + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">undefined</span> === node.children[idx]) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(color.r.toString(<span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        addColor(node.children[idx], color, level + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="åˆä½µé¡è‰²">åˆä½µé¡è‰²</h4><p>ã€€ã€€é€™ä¸€æ­¥å°±æ˜¯å…«å‰æ¨¹çš„ç©ºé–“è¤‡é›œåº¦ä½å’Œä¿çœŸåº¦é«˜çš„å¦ä¸€å€‹åŸå› äº†ã€‚</p>
<blockquote>
<p>å‹¿å¿˜åˆå¿ƒã€‚</p>
</blockquote>
<p>ã€€ã€€æˆ‘å€‘ç”¨é€™å€‹ç®—æ³•åšçš„æ˜¯é¡è‰²é‡åŒ–ï¼Œæˆ–è€…èªªæˆ‘è¦æ‹¿å®ƒæå–ä¸»é¡Œè‰²ã€èª¿è‰²æ¿ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯æå–å¹¾å€‹æœ‰ä»£è¡¨æ€§çš„é¡è‰²å°±å¤ äº†ï¼Œå¦å‰‡èŒ«èŒ«ä¸–ç•Œä¸­ <strong>RRGGBB</strong> ä¸€å…±æœ‰ 419430400 ç¨®é¡è‰²ï¼Œæ€éº¼æ­¸ç´ï¼Ÿ</p>
<p>ã€€ã€€æˆ‘å€‘å¯ä»¥è®“æŒ‡å®šä¸€æ£µå…«å‰æ¨¹ä¸è¶…éå¤šå°‘å¤šå°‘è‘‰å­ç¯€é»ï¼ˆä¹Ÿå°±æ˜¯æœ€å¾Œèƒ½æ­¸ç´å‡ºä¾†çš„ä¸»é¡Œè‰²æ•¸ï¼‰ï¼Œæ¯”å¦‚ 8ï¼Œæ¯”å¦‚ 16ã€64 æˆ–è€… 256 ç­‰ç­‰ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥ç•¶è‘‰å­ç¯€é»æ•¸è¶…éæˆ‘å€‘è¦å®šçš„è‘‰å­ç¯€é»æ•¸çš„æ™‚å€™ï¼Œæˆ‘å€‘å°±è¦åˆä½µå…¶ä¸­ä¸€å€‹ç¯€é»ï¼Œå°‡å…¶æ‰€æœ‰å­ç¯€é»çš„æ•¸æ“šéƒ½åˆä½µåˆ°å®ƒèº«ä¸Šå»ã€‚</p>
<p>ã€€ã€€èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘æœ‰ä¸€å€‹ç¯€é»æœ‰å…«å€‹å­ç¯€é»ï¼Œä¸¦ä¸”éƒ½æ˜¯è‘‰å­ç¯€é»ï¼Œé‚£éº¼æˆ‘å€‘æŠŠå…«å€‹è‘‰å­ç¯€é»çš„é€šé“åˆ†é‡å…¨ç´¯åŠ åˆ°è©²ç¯€é»ä¸­ï¼Œé¡è‰²ç¸½æ•¸ä¹Ÿç´¯åŠ åˆ°è©²ç¯€é»ä¸­ï¼Œç„¶å¾Œåˆªé™¤å…«å€‹è‘‰å­ç¯€é»ä¸¦æŠŠè©²ç¯€é»è¨­ç½®çˆ²è‘‰å­ç¯€é»ã€‚é‚£éº¼ä¸€ä¸‹å­æˆ‘å€‘å°±åˆä½µäº†å…«å€‹ç¯€é»æœ‰æœ¨æœ‰ï¼</p>
<p>ã€€ã€€çˆ²ä»€éº¼é€™äº›ç¯€é»å¯ä»¥è¢«åˆä½µå‘¢ï¼Ÿ</p>
<p>ã€€ã€€æˆ‘å€‘ä¾†çœ‹çœ‹æŸå€‹ç¯€é»ä¸‹çš„å­ç¯€é»é¡è‰²éƒ½æœ‰ç¥é¦¬ç›¸ä¼¼é»å§â€”â€”å®ƒå€‘çš„ä¸‰å€‹åˆ†é‡å‰ä¸ƒä½ï¼ˆæˆ–è€…èªªå¦‚æœå·²ç¶“ä¸æ˜¯æœ€åº•å±¤çš„ç¯€é»çš„è©±é‚£å°±æ˜¯å‰å¹¾ä½ï¼‰æ˜¯ç›¸åŒçš„ï¼Œé‚£éº¼æ¯”å¦‚èªªå‰›çº”çš„ <code>FF7800</code>ï¼Œè·Ÿå®ƒåŒç´šä¸¦ä¸”æ“æœ‰ç›¸åŒçˆ¶ç¯€é»ï¼ˆä¹Ÿå°±æ˜¯å®ƒçš„å…„å¼Ÿç¯€é»ï¼‰çš„é¡è‰²éƒ½æ˜¯ä»€éº¼å‘¢ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">R: <span class="number">1111</span> <span class="number">111</span>(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">G: <span class="number">0111</span> <span class="number">100</span>(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">B: <span class="number">0000</span> <span class="number">000</span>(<span class="number">0</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ•´åˆå‡ºä¾†ä¸€çœ‹ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">FE7800</span></span><br><span class="line">FE7801</span><br><span class="line">FE7900</span><br><span class="line">FE7901</span><br><span class="line">FF7800</span><br><span class="line">FF7801</span><br><span class="line">FF7900</span><br><span class="line">FF7901</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ€éº¼æ¨£ï¼Ÿæ˜¯ä¸æ˜¯ç¢ºå¯¦å¾ˆç›¸è¿‘ï¼Ÿé€™å°±æ˜¯å…«å‰æ¨¹çš„ç²¾é«“äº†ï¼Œæ‰€æœ‰çš„å…„å¼Ÿç¯€é»è‚¯å®šæ˜¯åœ¨ä¸€å€‹ç›¸è¿‘çš„é¡è‰²ç¯„åœå…§ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥èªªæˆ‘å€‘è¦åˆä½µå°±å…ˆå»æœ€åº•å±¤çš„ <strong><em>reducible</em></strong> éˆè¡¨ä¸­å°‹æ‰¾ä¸€å€‹å¯ä»¥åˆä½µçš„ç¯€é»ï¼ŒæŠŠå®ƒå¾éˆè¡¨ä¸­åˆªé™¤ä¹‹å¾Œåˆä½µè‘‰å­ç¯€é»ä¸¦ä¸”åˆªé™¤å…¶è‘‰å­ç¯€é»å°±å¥½äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reduceTree</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°æœ€æ·±å±¤æ¬¡çš„ä¸¦ä¸”æœ‰å¯åˆä½µç¯€é»çš„éˆè¡¨</span></span><br><span class="line">    <span class="keyword">var</span> lv = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">null</span> === reducible[lv]) lv--;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–å‡ºéˆè¡¨é ­ä¸¦å°‡å…¶å¾éˆè¡¨ä¸­ç§»é™¤</span></span><br><span class="line">    <span class="keyword">var</span> node = reducible[lv];</span><br><span class="line">    reducible[lv] = node.next;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆä½µå­ç¯€é»</span></span><br><span class="line">    <span class="keyword">var</span> r = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> g = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> === node.children[i]) <span class="keyword">continue</span>;</span><br><span class="line">        r += node.children[i].red;</span><br><span class="line">        g += node.children[i].green;</span><br><span class="line">        b += node.children[i].blue;</span><br><span class="line">        count += node.children[i].pixelCount;</span><br><span class="line">        leafNum--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è³¦å€¼</span></span><br><span class="line">    node.isLeaf = <span class="literal">true</span>;</span><br><span class="line">    node.red = r;</span><br><span class="line">    node.green = g;</span><br><span class="line">    node.blue = b;</span><br><span class="line">    node.pixelCount = count;</span><br><span class="line">    leafNum++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™æ¨£ä¸€ä¾†ï¼Œå°±åˆä½µäº†ä¸€å€‹æœ€æ·±å±¤æ¬¡çš„ç¯€é»äº†ï¼Œå¦‚æœæ»¿æ‰“æ»¿ç®—çš„è©±ï¼Œä¸€æ¬¡åˆä½µæœ€å¤šæœƒç‡’æ‰ 7 å€‹ç¯€é»ï¼ˆæˆ‘å¤§ FFF åœ˜å£¯å“‰ï¼‰ã€‚</p>
<h4 id="å»ºæ¨¹">å»ºæ¨¹</h4><p>ã€€ã€€ä¸Šé¢çš„å‡½æ•¸éƒ½æœ‰äº†ï¼Œæˆ‘å€‘å¯ä»¥é–‹å§‹å»ºæ¨¹äº†ã€‚</p>
<p>ã€€ã€€å¯¦éš›ä¸Šå»ºæ¨¹çš„éç¨‹å°±æ˜¯éæ­·ä¸€éå‚³å…¥çš„åƒç´ é¡è‰²ä¿¡æ¯ï¼Œå°æ–¼æ¯å€‹é¡è‰²éƒ½æ’å…¥åˆ°å…«å‰æ¨¹ç•¶ä¸­ï¼›ä¸¦ä¸”æ¯ä¸€æ¬¡æ’å…¥ä¹‹å¾Œéƒ½åˆ¤æ–·ä¸‹è‘‰å­ç¯€é»æ•¸æœ‰æ²’æœ‰æº¢å‡ºï¼Œå¦‚æœæ»¿å‡ºä¾†çš„è©±éœ€è¦åŠæ™‚åˆä½µã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildOctree</span>(<span class="params">pixels, maxColors</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pixels.length; i++) &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ é¡è‰²</span></span><br><span class="line">        addColor(root, pixels[i], <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆä½µè‘‰å­ç¯€é»</span></span><br><span class="line">        <span class="keyword">while</span>(leafNum &gt; maxColors) reduceTree();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ•´æ£µæ¨¹å»ºå¥½ä¹‹å¾Œï¼Œæˆ‘å€‘æ‡‰è©²å¾—åˆ°äº†æœ€å¤šæœ‰ <code>maxColors</code> å€‹è‘‰å­ç¯€é»çš„é«˜ä¿çœŸå…«å‰æ¨¹ã€‚å…¶æ ¹ç¯€é»çˆ² <code>root</code>ã€‚</p>
<h4 id="ä¸»é¡Œè‰²æå–">ä¸»é¡Œè‰²æå–</h4><p>ã€€ã€€æœ‰äº†é€™éº¼ä¸€æ£µå…«å‰æ¨¹ä¹‹å¾Œæˆ‘å€‘å°±å¯ä»¥å¾è£é¢æå–æˆ‘å€‘æƒ³è¦çš„æ±è¥¿äº†ã€‚</p>
<p>ã€€ã€€ä¸»é¡Œè‰²æå–å¯¦éš›ä¸Šå°±æ˜¯æŠŠå…«å‰æ¨¹ç•¶ä¸­å‰©ä¸‹çš„è‘‰å­ç¯€é» <strong><em>RGB</em></strong> é€šé“åˆ†é‡æ±‚å¹³å‡ï¼Œæ±‚å‡ºä¾†çš„å°±æ˜¯è¿‘ä¼¼çš„ä¸»é¡Œè‰²äº†ã€‚ï¼ˆä¹Ÿè¨±æœ‰æ›´å¥½çš„ï¼Œä¸æ˜¯æ±‚å¹³å‡çš„æ–¹æ³•èƒ½ç²å¾—æ›´å¥½çš„ä¸»é¡Œè‰²çµæœï¼Œä½†æ˜¯æˆ‘æ²’æœ‰æ·±å…¥å»ç ”ç©¶ï¼Œæ­¡è¿å¤§å®¶ä¸€èµ·ä¾†æŒ‡æ­£ (â€â•¹â—¡â•¹)ï¼‰</p>
<p>ã€€ã€€æ–¼æ˜¯æˆ‘å€‘æ·±åº¦éæ­·é€™æ£µæ¨¹ï¼Œæ¯é‡åˆ°è‘‰å­ç¯€é»ï¼Œå°±æ±‚å‡ºé¡è‰²åŠ å…¥åˆ°æˆ‘å€‘æ‰€å­˜çµæœçš„æ•¸çµ„æˆ–è€…ä»»æ„æ•¸æ“šçµæ§‹ç•¶ä¸­äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">colorsStats</span>(<span class="params">node, object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node.isLeaf) &#123;</span><br><span class="line">        <span class="keyword">var</span> r = <span class="built_in">parseInt</span>(node.red / node.pixelCount).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">var</span> g = <span class="built_in">parseInt</span>(node.green / node.pixelCount).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">var</span> b = <span class="built_in">parseInt</span>(node.blue / node.pixelCount).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">if</span>(r.length === <span class="number">1</span>) r = <span class="string">'0'</span> + r;</span><br><span class="line">        <span class="keyword">if</span>(g.length === <span class="number">1</span>) g = <span class="string">'0'</span> + g;</span><br><span class="line">        <span class="keyword">if</span>(b.length === <span class="number">1</span>) b = <span class="string">'0'</span> + b;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> color = r + g + b;</span><br><span class="line">        <span class="keyword">if</span>(object[color]) object[color] += node.pixelCount;</span><br><span class="line">        <span class="keyword">else</span> object[color] = node.pixelCount;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> !== node.children[i]) &#123;</span><br><span class="line">            colorsStats(node.children[i], object);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç®—æ³•å°çµ">ç®—æ³•å°çµ</h4><p>ã€€ã€€å…«å‰æ¨¹ä¸»é¡Œè‰²æå–ç®—æ³•æå–å‡ºä¾†çš„ä¸»é¡Œè‰²æ˜¯ä¸€å€‹ç„¡å›ºå®šèª¿è‰²æ¿ï¼ˆNon-paletteï¼‰çš„é¡è‰²ç¾£ï¼Œå®ƒæœ‰ç€å°åŸåœ–çš„å„˜é‡ä¿çœŸæ€§ï¼Œä½†æ˜¯ç”±æ–¼æ²’æœ‰å›ºå®šçš„èª¿è‰²æ¿ï¼Œæœ‰æ™‚å€™å°æ–¼æœç´¢æˆ–è€…æŸç¨®éœ€è¦å›ºå®šå€¼ä¾†è§£é‡‹çš„å ´æ™¯ä¸­é‚„æ˜¯æ¬ äº†é»ç«å€™ã€‚ä½†æ˜¯æ´»éˆæ´»ç¾éå®ƒè«å±¬äº†ã€‚æ¯”å¦‚æŸç¨®åœ–ç‰‡æ ¼å¼è£é¢é å…ˆå­˜èª¿è‰²æ¿ç„¶å¾Œå­˜å„åƒç´ çš„æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘å°±å¯ä»¥ç”¨å…«å‰æ¨¹æå–å‡ºä¾†çš„é¡è‰²ä½œçˆ²è©²åœ–ç‰‡èª¿è‰²æ¿ï¼Œèƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå°é€™å¼µåœ–ç‰‡é€²è¡Œä¿çœŸï¼Œä¸¦ä¸”åœ–ç‰‡é¡è‰²ä¹Ÿæ¸›åˆ°ä¸€å®šçš„é‡ã€‚</p>
<p>ã€€ã€€è©²ç®—æ³•çš„å®Œæ•´ Demo å¤§å®¶å¯ä»¥åœ¨æˆ‘çš„ <a href="https://github.com/XadillaX/theme-color-test/blob/master/version3/octree.js" target="_blank" rel="external">Github</a> ç•¶ä¸­æ‰¾åˆ°ã€‚</p>
<h3 id="æœ€å°å·®å€¼æ³•">æœ€å°å·®å€¼æ³•</h3><p>ã€€ã€€é€™æ˜¯ä¸€å€‹éå¸¸ç°¡å–®åˆå¯¦ç”¨çš„ç®—æ³•ã€‚</p>
<p>ã€€ã€€å¤§è‡´çš„æ€æƒ³å°±æ˜¯çµ¦å®šä¸€å€‹èª¿è‰²æ¿ï¼Œéä¾†ä¸€å€‹é¡è‰²å°±è·Ÿèª¿è‰²æ¿ä¸­çš„é¡è‰²ä¸€ä¸€å°æ¯”ï¼Œå–æœ€å°å·®å€¼çš„é‚£å€‹èª¿è‰²æ¿è£çš„é¡è‰²ä½œçˆ²é€™å€‹é¡è‰²çš„ä»£è¡¨ã€‚</p>
<p>ã€€ã€€å°æ¯”çš„éç¨‹å°±æ˜¯åˆ†åˆ¥å°‡ <strong>R / G / B</strong> é€šé“çš„å€¼å…©å…©ç›¸æ¸›å–çµ•å°å€¼ï¼Œå°‡ä¸‰å€‹å·®ç›¸åŠ ï¼Œå¾—åˆ°çš„é€™å€‹å€¼å°±æ˜¯é¡è‰²å·®å€¼äº†ã€‚</p>
<p>ã€€ã€€åæ­£æœ€å¾Œå°±æ˜¯èª¿è‰²æ¿ä¸­å“ªå€‹é¡è‰²è·Ÿå°æ¯”çš„é¡è‰²å·®å€¼æœ€å°ï¼Œå°±æ‹¿éä¾†å°±æ˜¯äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> best = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> bestv = pal[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">var</span> bestr = <span class="built_in">Math</span>.abs(r - bestv.r) + <span class="built_in">Math</span>.abs(g - bestv.g) + <span class="built_in">Math</span>.abs(b - bestv.b);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">1</span>; j &lt; pal.length; j++) &#123;</span><br><span class="line">    <span class="keyword">var</span> p = pal[j];</span><br><span class="line">    <span class="keyword">var</span> res = <span class="built_in">Math</span>.abs(r - p.r) + <span class="built_in">Math</span>.abs(g - p.g) + <span class="built_in">Math</span>.abs(b - p.b);</span><br><span class="line">    <span class="keyword">if</span>(res &lt; bestr) &#123;</span><br><span class="line">        best = j;</span><br><span class="line">        bestv = pal[j];</span><br><span class="line">        bestr = res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = pal[best].r.toString(<span class="number">16</span>);</span><br><span class="line">g = pal[best].g.toString(<span class="number">16</span>);</span><br><span class="line">b = pal[best].b.toString(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(r.length === <span class="number">1</span>) r = <span class="string">"0"</span> + r;</span><br><span class="line"><span class="keyword">if</span>(g.length === <span class="number">1</span>) g = <span class="string">"0"</span> + g;</span><br><span class="line"><span class="keyword">if</span>(b.length === <span class="number">1</span>) b = <span class="string">"0"</span> + b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(colors[r + g + b] === <span class="literal">undefined</span>) colors[r + g + b] = -<span class="number">1</span>;</span><br><span class="line">colors[r + g + b]++;</span><br></pre></td></tr></table></figure>
<h2 id="æˆ‘æ˜¯æ€éº¼åšçš„">æˆ‘æ˜¯æ€éº¼åšçš„</h2><p>ã€€ã€€å…«å‰æ¨¹çš„ç¼ºé»æˆ‘åœ¨ä¹‹å‰çš„å…«å‰æ¨¹å°çµä¸­æåˆ°éäº†ï¼Œå°±æ˜¯é¡è‰²ä¸å›ºå®šã€‚å°æ–¼éœ€è¦æœ‰ä¸€å®šå›ºå®šå€¼ç¯„åœçš„ä¸»é¡Œè‰²æå–éœ€æ±‚ä¾†èªªä¸æ˜¯é‚£éº¼åˆäººæ„ã€‚</p>
<p>ã€€ã€€è€Œæœ€å°å·®å€¼æ³•çš„è©±åˆå¤ªå¤æ¿äº†ã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯æˆ‘çš„åšæ³•æ˜¯å°‡é€™å…©ç¨®ç®—æ³•éƒ½éä¸€éã€‚</p>
<p>ã€€ã€€æ¯”å¦‚æˆ‘è¦å°‡ä¸€å¼µåœ–ç‰‡æå–å‡ºå°‘æ–¼ 256 ç¨®é¡è‰²ï¼Œæˆ‘æœƒç”¨å…«å‰æ¨¹éæ¿¾ä¸€éå¾—å‡ºä¿è­‰çš„å…©ç™¾å¤šç¨®é¡è‰²ï¼Œç„¶å¾Œæ‹¿ç€é€™æ‰¹é¡è‰²å’Œå…¶æ•¸é‡å†æ‰”åˆ°æœ€å°æ’å€¼æ³•è£é¢å°‡é¡è‰²è¦ç¯„åŒ–ä¸€éï¼Œå¾—å‡ºçš„æœ€çµ‚çµæœå¯èƒ½å°±æ˜¯æˆ‘æƒ³è¦çš„çµæœäº†ã€‚</p>
<p>ã€€ã€€é€™æœŸé–“ç¬¬äºŒæ­¥çš„æ•ˆç‡å¯ä»¥å¿½ç•¥ä¸è¨ˆï¼Œç•¢ç«Ÿå¦‚æœæ˜¯ä¸Šé¢çš„éœ€æ±‚çš„è©±ç¬¬ä¸€æ­¥çš„çµæœä¹Ÿå°±é‚£éº¼å…©ç™¾å¤šç¨®é¡è‰²ã€‚</p>
<p>ã€€ã€€é€™å€‹æ–¹æ³•æˆ‘å·²ç¶“å¯¦ç¾ä¸¦ä¸”ç”¨åœ¨æˆ‘è‡ªå·±çš„é¡è‰²æå–åŒ… <strong><em><a href="https://github.com/XadillaX/thmclrx" target="_blank" rel="external">thmclrx</a></em></strong> è£äº†ã€‚å¤§è‡´çš„ä»£ç¢¼å¯ä»¥çœ‹<a href="https://github.com/XadillaX/thmclrx/blob/7ab4de9fce583e88da6a41b0e256e91c45a10f67/lib/x.js#L95-L145" target="_blank" rel="external">é€™è£</a>ã€‚</p>
<h2 id="ä¸»é¡Œè‰²æå–_Node-js_åŒ…â€”â€”thmclrx">ä¸»é¡Œè‰²æå– Node.js åŒ…â€”â€”thmclrx</h2><p>ã€€ã€€åœ¨é€™å¹¾å¤©çš„è¾›å‹¤å‹ä½œä¸‹ï¼Œç¸½ç®—å®Œæˆäº†æŸç¨®æ„ç¾©ä¸Šæˆ‘çš„ç¬¬ä¸€å€‹ Node.js C++ Addonã€‚</p>
<p>ã€€ã€€è·Ÿç®—æ³•ç›¸é—œï¼ˆå…«å‰æ¨¹ã€æœ€å°å·®å€¼ï¼‰çš„è¨ˆç®—å…¨æ”¾åœ¨äº† <a href="https://github.com/XadillaX/thmclrx/tree/master/src" target="_blank" rel="external">C++ å±¤</a>é€²è¡Œè¨ˆç®—ã€‚å¤§å®¶æœ‰èˆˆè¶£çš„å¯ä»¥å»è®€ä¸€ä¸‹ä¸¦ä¸”å¹«å¿™æŒ‡å‡ºå„ç¨®å„æ¨£çš„ç¼ºé»ï¼Œç®—æ˜¯æ‹‹ç£šå¼•ç‰äº†ã€‚</p>
<p>ã€€ã€€é€™å€‹åŒ…çš„ Repo åœ¨ Github ä¸Šé¢ï¼š</p>
<blockquote>
<p><a href="https://github.com/XadillaX/thmclrx" target="_blank" rel="external">https://github.com/XadillaX/thmclrx</a></p>
</blockquote>
<p>ã€€ã€€æ–‡æª”è‡ªèªçˆ²é‚„ç®—å®Œæ•´å§ã€‚ä¸¦ä¸”ä¹Ÿå¯ä»¥é€šé</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install thmclrx</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€²è¡Œå®‰è£ã€‚</p>
<h2 id="æœ¬æ–‡å°çµ">æœ¬æ–‡å°çµ</h2><p>ã€€ã€€é€²èŠ±ç“£å…©å€‹æœˆäº†ï¼Œé€™ä¸€æ¬¡çµ‚æ–¼å¦‚é¡˜ä»¥å„Ÿåœ°ç¢°è§¸åˆ°äº†ä¸€é»é»çš„ã€ç®—æ³•ç›¸é—œã€çš„æ´»ã€‚ï¼ˆæˆ‘ä¸æœƒå‘Šè¨´ä½ é€™ä¸æ˜¯æˆ‘çš„ä»»å‹™ï¼Œæ˜¯æˆ‘å¾åˆ¥äººæ‰‹ä¸­æ¶ä¾†çš„ 2333333 <em>à¬˜(à©­</em>ËŠáµ•Ë‹)à©­* à©ˆâœ©â€§â‚ŠËš</p>
<p>ã€€ã€€ç¸½ä¹‹å¹¾ç¨®ç®—æ³•å’Œå¯¦ç¾åœ¨ä¸Šæ–¹ä»‹ç´¹äº†ï¼Œå…·é«”éœ€è¦æ€éº¼ç”¨é‚„æ˜¯è¦çœ‹å¤§å®¶è‡ªå·±äº†ã€‚æˆ‘åæ­£å¤§è‡´æ‰¾åˆ°äº†æˆ‘ä½¿ç”¨çš„é€”å¾‘ï¼Œé‚£ä½ å€‘å‘¢ã€‚( Â´ï½¥ï½¥)ï¾‰(._.`)</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>æ‰€è¬‚ä¸»é¡Œè‰²æå–ï¼Œå°±æ˜¯å°æ–¼ä¸€å¼µåœ–ç‰‡ï¼Œè¿‘ä¼¼åœ°æå–å‡ºä¸€å€‹èª¿è‰²æ¿ï¼Œä½¿å¾—èª¿è‰²æ¿è£é¢çš„é¡è‰²èƒ½çµ„æˆé€™å¼µåœ–ç‰‡çš„ä¸»è‰²èª¿ã€‚</p>
</blockquote>
<p>ã€€ã€€ä»¥ä¸Šå®šç¾©çˆ²æˆ‘å€‹äººèƒ¡è¬…çš„ã€‚</p>
<p>ã€€ã€€å¤§å®¶ä¸è¦å¤ªæŠŠæˆ‘çš„æ±è¥¿ç•¶æˆåš´è¬¹çš„æ–‡ç« ä¾†çœ‹ï¼Œå¾ˆå¤šæ±è¥¿ä»€éº¼çš„]]>
    </summary>
    
      <category term="Algorithm" scheme="http://xcoder.in/tags/Algorithm/"/>
    
      <category term="Theme Color" scheme="http://xcoder.in/tags/Theme-Color/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æˆ‘æ˜¯å¦‚ä½•å¯¦ç¾ç°¡å–®çš„éš¨æ©Ÿä¸­æ–‡åç”Ÿæˆå™¨çš„ï¼ˆNode ç‰ˆï¼‰]]></title>
    <link href="http://xcoder.in/2014/09/01/how-i-made-chinese-random-x/"/>
    <id>http://xcoder.in/2014/09/01/how-i-made-chinese-random-x/</id>
    <published>2014-09-01T12:36:33.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="åº">åº</h2><p>æœ€è¿‘é–’ç€è›‹ç–¼å¯¦ç¾äº†å…©å€‹åº«ã€‚</p>
<ul>
<li>éš¨æ©Ÿç”Ÿæˆä¸­æ–‡åå­—</li>
<li>éš¨æ©Ÿç”Ÿæˆä¸­æ–‡æŠ€èƒ½å</li>
</ul>
<p>æˆ‘ç•¶ç„¶ä¸æœƒèªªå»ç”¨å„ç¨®äººå·¥æ™ºèƒ½å»å¯¦ç¾ä¸€å€‹å¼·å¤§çš„çš„è§£æå™¨ç„¶å¾Œç”Ÿæˆï¼Œä¹Ÿä¸æœƒèªªç”¨ä¸€å€‹éå¸¸é¾å¤§å¦‚æœç‹—æ‹¼éŸ³çš„å§“ååº«ä¾†éš¨æ©Ÿç²å–â€”â€”æˆ‘åªæ˜¯å¶ç„¶é–“çŸ¥é“è˜‘è‡è¡—å°ä¿ ç¯€ä¸€å€‹æ··æˆ° PK çš„ Demo ç·¨å¯«æ¯”è³½ï¼Œé–’ä¾†ç„¡èŠéš¨ä¾¿å¯«å¯«ï¼Œç„¶è€Œé€™å…¶ä¸­æˆ‘éœ€è¦éš¨æ©Ÿçµ¦ Bot èµ·åä»¥åŠæŠ€èƒ½èµ·åè€Œç”¨åˆ°çš„åº«ã€‚</p>
<p>ä¸éœ€è¦æœ‰å¤šå°‘æ­£ç¢ºæ€§â€”â€”é€™å…©å€‹åº«çš„çµæœç¶“å¸¸å‡ºç¾éå¸¸å¥‡è‘©çš„åå­—ï¼Œè®“äººå“­ç¬‘ä¸å¾—ï¼Œä½†æ˜¯æˆ‘è¦çš„å°±æ˜¯é€™ç¨®æ•ˆæœã€‚</p>
<h2 id="çµæœç¤ºç¯„">çµæœç¤ºç¯„</h2><p>å°±å…©å€‹åº«ï¼Œæˆ‘å„ç”Ÿæˆä¸€æ‰¹åå­—ä»¥ç¤ºæ•ˆæœã€‚</p>
<h3 id="Chinese_Random_Name">Chinese Random Name</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">é—•é€ </span><br><span class="line">å»£éŒ«ä¸€</span><br><span class="line">å¸­å¯º</span><br><span class="line">æ‰¶é§•</span><br><span class="line">é„­è±é»ƒ</span><br><span class="line">æ—æ¨Šç‰½</span><br><span class="line">å­Ÿç™»å…ƒ</span><br><span class="line">é­šå½°</span><br><span class="line">çš®æ†‚æš‘</span><br><span class="line">å·¦ç¨—</span><br><span class="line">å®¦é†‡</span><br><span class="line">ç³œå¼‹æ‹›</span><br><span class="line">å¸­æº–</span><br><span class="line">æ–¹æŠ‘</span><br><span class="line">çƒæ³”</span><br><span class="line">è‹—é­¯</span><br><span class="line">å­Ÿå€™ä¾</span><br><span class="line">é¾ç é¤</span><br><span class="line">æ´ªæ‰“é·¹</span><br><span class="line">ç¹†è² é¸</span><br></pre></td></tr></table></figure>
<h3 id="Chinese_Random_SKill">Chinese Random SKill</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">åœ°æ°¸å¿ƒæ³•</span><br><span class="line">çº“æ§è¨£</span><br><span class="line">å†‰è…¿</span><br><span class="line">å°¼é‚å¿ƒæ³•</span><br><span class="line">å¥ æ‹³è­œ</span><br><span class="line">æ›²æŒæ³•</span><br><span class="line">å§‹åˆº</span><br><span class="line">å¨˜æ¡¶æ“·åˆ€</span><br><span class="line">ç’‹ç‘¾å–®é¤Šåˆ€</span><br><span class="line">éŠåˆ€</span><br><span class="line">å‹µå„‰é©›åª›å¿ƒè¨£</span><br><span class="line">ç»é¦³åˆ€è¨£</span><br><span class="line">æ™å”é©Šè…¿</span><br><span class="line">ç¤ºå«©å¸³ç¾½åˆ€è¨£</span><br><span class="line">è³½å‹˜ç¥é«”åˆ€è¨£</span><br><span class="line">é‘„æ„›æŒ‡</span><br><span class="line">æ–½æ·¨ç®èæ£</span><br><span class="line">æ³Šè‡¨æƒ‡æ§è¨£</span><br><span class="line">æˆ‘é“å…­åˆ†æ§</span><br><span class="line">æ®˜äº­æ±‚æ‹³è­œ</span><br></pre></td></tr></table></figure>
<h2 id="è§£æ">è§£æ</h2><p>å¯¦éš›ä¸Šç„¡è«–æ˜¯èµ·åé‚„æ˜¯æŠ€èƒ½åï¼Œéƒ½ç”¨äº†ä¸€å€‹ç›¸åŒçš„èµ·åå­—åº«å’Œä¸€æ®µå·®ä¸å¤šçš„è¤‡ç”¨ä»£ç¢¼ï¼ˆé›–ç„¶æ²’æœ‰çœŸæ­£æ„ç¾©ä¸Šçš„è¤‡ç”¨ï¼Œåªæ˜¯è¤‡è£½ç²˜è²¼è€Œå·²ï¼Œèª°è®“ä»–å€‘æ˜¯å…©å€‹åº«å‘¢ï¼Œå·²ç¶“å¾ˆç°¡å–®äº†ï¼Œæˆ‘ç¸½ä¸èƒ½å†çµ¦ä»–å€‘æä¸€å€‹ä¾è³´å‡ºä¾†å§ï¼Ÿï¼‰</p>
<h3 id="èµ·å§“">èµ·å§“</h3><p>é—œæ–¼ <code>chinese-random-name</code> ä¸­çš„å§“æ°ï¼Œæˆ‘æ‰¾äº†ä¸€ç®‡ä¸­åœ‹ç™¾å®¶å§“ï¼ˆåŒ…æ‹¬è¤‡å§“ï¼‰æ¯”è¼ƒå…¨çš„è©åº«ã€‚</p>
<blockquote>
<p><a href="https://github.com/XadillaX/chinese-random-name/blob/master/dict/f.dict" target="_blank" rel="external">è©åº«éˆæ¥</a></p>
</blockquote>
<p>æ¯”è¼ƒå¹¸é‹ï¼Œæˆ‘æ‰¾åˆ°çš„æ™‚å€™å·²ç¶“æ˜¯é€™éº¼åˆ†æ®µåˆ†å¥½äº†ã€‚æˆ‘ä¹Ÿæ²’æœ‰è©³ç´°åšç ”ç©¶ï¼Œéš¨ä¾¿çµ¦äº†ä¸åŒçš„æ®µä¸åŒçš„æ¬Šå€¼ï¼Œç•¶ç„¶è¶Šå‰é¢çš„æ®µæ¬Šå€¼è¶Šé«˜ï¼Œè¢«éš¨æ©Ÿåˆ°çš„å¯èƒ½æ€§è¶Šå¤§ã€‚</p>
<p>é¦–å…ˆç”¨ <code>split</code> ä¾†åˆ†å‰²ä¸åŒæ®µï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict = dict.split(<span class="string">"\n\n"</span>);</span><br></pre></td></tr></table></figure>
<p>å°æ–¼æ¯ä¸€æ®µä¾†èªªé€šé <code>Array.reduce</code> (è©³è¦‹ <a href="https://github.com/andrewplummer/Sugar/blob/master/lib/es5.js#L287" target="_blank" rel="external">SugarJs</a>) ä¾†åˆ†å‰²æˆè¡Œå†æˆå­—ã€‚</p>
<p>çœ‹å­—å…¸ä¸€å…±æœ‰ 6 å¤§æ®µï¼Œæ¯æ®µçš„æ¬Šå€¼åˆ†åˆ¥çˆ²ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> weights = [ <span class="number">100</span>, <span class="number">70</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span> ];</span><br></pre></td></tr></table></figure>
<p>ç„¶å¾Œæ¯å€‹å­—éƒ½æœ‰ä¸€å€‹å…¶æ¬Šå€¼å€é–“ï¼Œæ˜¯ç´¯åŠ ä¸Šå»çš„ã€‚</p>
<p>æœ€å¾Œç²å–å§“çš„æ™‚å€™éš¨æ©Ÿç”Ÿæˆä¸€å€‹åœ¨ç¸½å€é–“å…§çš„æ•¸å­—ï¼Œç„¶å¾Œçœ‹çœ‹æ•¸å­—åœ¨å“ªå€‹å§“çš„å€é–“å…§ï¼Œå°±è¿”å›é€™å€‹å§“ã€‚</p>
<h3 id="æŠ€èƒ½å¾Œç¶´">æŠ€èƒ½å¾Œç¶´</h3><p>é—œæ–¼ <code>chinese-random-skill</code> ä¸­çš„æŠ€èƒ½å¾Œç¶´ï¼Œæˆ‘å·æ‡¶äº†ã€‚å› çˆ²é‚£å€‹æ™‚å€™ Demo å°±å¿« Deadline äº†ï¼Œæ‰€ä»¥éš¨ä¾¿ç³Šå¼„äº†ä¸€ä¸‹â€”â€”ç›´æ¥æŠŠå°è±¡è£é¢æ¯”è¼ƒç†Ÿçš„å¾Œç¶´å¯«ä¸Šå»äº†äº‹ï¼Œä¹Ÿä¸çµ¦æ¬Šå€¼äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> suffix = [</span><br><span class="line">    <span class="string">"åŠ"</span>, <span class="string">"åŠæ³•"</span>, <span class="string">"åŠè­œ"</span>, <span class="string">"åŠè¨£"</span>,</span><br><span class="line">    <span class="string">"æ§"</span>, <span class="string">"æ§æ³•"</span>, <span class="string">"æ§è¨£"</span>,</span><br><span class="line">    <span class="string">"æ‹³"</span>, <span class="string">"æ‹³æ³•"</span>, <span class="string">"æ‹³è­œ"</span>,</span><br><span class="line">    <span class="string">"åˆ€"</span>, <span class="string">"åˆ€æ³•"</span>, <span class="string">"åˆ€è­œ"</span>, <span class="string">"åˆ€è¨£"</span>,</span><br><span class="line">    <span class="string">"æ–¬"</span>, <span class="string">"åˆº"</span>, <span class="string">"å¤§æ³•"</span>, <span class="string">"å¿ƒè¨£"</span>, <span class="string">"å¿ƒæ³•"</span>, <span class="string">"è¨£"</span>, <span class="string">"å¯¶å…¸"</span>,</span><br><span class="line">    <span class="string">"æ£"</span>, <span class="string">"æ£æ³•"</span>, <span class="string">"æ£è­œ"</span>, <span class="string">"æ£è¨£"</span>,</span><br><span class="line">    <span class="string">"æŒ‡"</span>, <span class="string">"æŒ"</span>, <span class="string">"æŒæ³•"</span>, <span class="string">"è…¿"</span>, <span class="string">"æ”»"</span>, <span class="string">"é‰¤"</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h3 id="å…±ç”¨éƒ¨åˆ†">å…±ç”¨éƒ¨åˆ†</h3><p>åå­—ä¸»é«”çˆ²å…©å€‹åŒ…çš„å…±ç”¨éƒ¨åˆ†ã€‚</p>
<p>å¯¦éš›ä¸Šä»–å€‘ä¾è³´æ–¼ä¸€å€‹ç‰¹å®šæ¬¾å¼çš„å­—åº«â€”â€”æˆ‘ä¹Ÿå°±ç¶²ä¸Šéš¨ä¾¿é‚£éº¼ä¸€æœã€‚</p>
<blockquote>
<p><a href="https://github.com/XadillaX/chinese-random-name/blob/master/dict/n.dict" target="_blank" rel="external">å­—åº«éˆæ¥</a></p>
</blockquote>
<p>å®ƒæ¯ä¸€è¡Œçš„çµæ§‹ä¸€æ¨£ï¼š</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span> UniChar UniCharï¼š<span class="built_in">String</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ç¬¬ä¸€å€‹æ•¸å­—æˆ‘ç›®æ¸¬æ˜¯ç¹é«”çš„ç­†ç•«æ•¸ï¼Œæ¯”å¦‚ 899 è¡Œçš„ <code>æ›¸</code> ç¹é«”å°±æ˜¯ <code>æ›¸</code>ï¼Œæ•¸ä¸€ä¸‹çš„ç¢ºæ˜¯ 10 åŠƒã€‚</p>
<p>ç¬¬äºŒå€‹å°±æ˜¯å­—æœ¬é«”ï¼Œç¬¬ä¸‰å€‹æ˜¯è©²å­—çš„äº”è¡Œå±¬æ€§ï¼Œæœ€å¾Œæ˜¯é€™å€‹å­—åœ¨ä»€éº¼ä»€éº¼å‘½æ•¸ï¼ˆè«‹ä¸è¦è¿·ä¿¡ï¼‰æè¿°ã€‚</p>
<p>çˆ²äº†è®“åå­—çœ‹èµ·ä¾†ç¨å¾®æ­£å¸¸é»ï¼ˆåªæ˜¯ç¨å¾®è€Œå·²ï¼‰ï¼Œæˆ‘å„˜å¯èƒ½è®“åŒå±¬æ€§çš„å­—åœ¨ä¸€å¡Šå…’ï¼Œæ–¼æ˜¯æœ‰äº†ä»¥ä¸‹çµ„åˆï¼š</p>
<ul>
<li>é‡‘é‡‘</li>
<li>æœ¨æœ¨</li>
<li>æ°´æ°´</li>
<li>ç«ç«</li>
<li>åœŸåœŸ</li>
</ul>
<p><a href="https://github.com/XadillaX/chinese-random-name/blob/master/lib/name.js#L41" target="_blank" rel="external">é€™äº›å­—</a>æ¹Šåœ¨ä¸€èµ·çš„æ¬Šå€¼çˆ² 100ã€‚</p>
<p>ç„¶å¾Œéš”ä¸€å€‹å±¬æ€§çš„è©±æ˜¯ç›¸å‰‹çš„ï¼Œæˆ‘ä¸æ‡‚ä»€éº¼èµ·åå¤§æ³•ä»€éº¼çš„ï¼Œåªæ˜¯ç”¨è†è“‹æƒ³äº†ä¸‹ç›¸å‰‹çš„å±¬æ€§ä¸å¥½èµ·åå§ï¼ˆçŒœéŒ¯äº†ä¸è¦æ€¨æˆ‘ï¼‰ï¼Œæ–¼æ˜¯çµ¦äº† 20 çš„æ¬Šå€¼ã€‚</p>
<p>è‡³æ–¼éš”å£å±¬æ€§ï¼Œæ˜¯ç›¸ç”Ÿå§ï¼Ÿæ–¼æ˜¯çµ¦äº† 50 æ¬Šå€¼ã€‚</p>
<p>å°æ–¼ä¸‰å€‹å­—çš„èµ·åä¾†èªªï¼Œä¹Ÿæ˜¯ç”¨äº†é¡ä¼¼çš„æ–¹æ³•çµ¦æ¬Šå€¼ï¼Œå…·é«”å¯ä»¥åƒè€ƒä»£ç¢¼ã€‚</p>
<p>ç¸½ä¹‹å°±æ˜¯æ ¹æ“šå…¶å…©å…©ä¹‹é–“çš„äº”è¡Œé—œä¿‚ä¾†èµ·åçš„ï¼Œè½èµ·ä¾†é‚„æ˜¯æœ‰é‚£éº¼é»é“ç†çš„ã€‚</p>
<p>å“ˆå“ˆï¼Œæ¬Šç•¶ç©çš„ï¼ŒèªçœŸä½ å°±è¼¸äº†ã€‚</p>
<h3 id="ç¶œåˆèªªæ˜">ç¶œåˆèªªæ˜</h3><p>ä¸Šé¢çš„åˆ†æ­¥åšå®Œäº†ï¼Œç„¶å¾ŒçœŸÂ·ç”Ÿæˆåå­—çš„æ­¥é©Ÿæ˜¯ï¼š</p>
<p>éš¨æ©Ÿç”Ÿæˆä¸€å€‹å§“ï¼ˆæˆ–è€…æŠ€èƒ½å¾Œç¶´ï¼‰ï¼Œç„¶å¾ŒæŒ‰ç…§æŸå€‹æ¬Šå€¼éš¨æ©Ÿç”Ÿæˆä¸€å€‹æ•¸å­—ä»£è¡¨å‰©ä¸‹çš„åå­—çš„é•·åº¦ï¼Œç„¶å¾Œéš¨æ©Ÿç”Ÿæˆä¸€ä¸²è©²é•·åº¦çš„åå­—å³å¯ã€‚</p>
<p>æœ€å¾Œæ‹¼æ¥ä¸Šå»å°± OK äº†ã€‚</p>
<h2 id="ç„¡ç¯€æ“å°å»£å‘Š">ç„¡ç¯€æ“å°å»£å‘Š</h2><p>æœ€å¾Œé‚„æ˜¯è²¼ä¸€ä¸‹å…©å€‹åŒ…çš„ repo åœ°å€å§ï¼š</p>
<blockquote>
<ul>
<li><a href="https://github.com/XadillaX/chinese-random-name" target="_blank" rel="external">Chinese Random Name</a></li>
<li><a href="https://github.com/XadillaX/chinese-random-skill" target="_blank" rel="external">Chinese Random Skill</a></li>
</ul>
</blockquote>
<p>ä»¥åŠå®‰è£çš„è©±ç…§ä¸‹å»å¼„å°±å¥½äº†</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install chinese-random-name</span><br><span class="line">$ npm install chinese-random-skill</span><br></pre></td></tr></table></figure>
<p><code>README</code> æ–‡ä»¶å…©å€‹åŒ…éƒ½æœ‰ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="åº">åº</h2><p>æœ€è¿‘é–’ç€è›‹ç–¼å¯¦ç¾äº†å…©å€‹åº«ã€‚</p>
<ul>
<li>éš¨æ©Ÿç”Ÿæˆä¸­æ–‡åå­—</li>
<li>éš¨æ©Ÿç”Ÿæˆä¸­æ–‡æŠ€èƒ½å</li>
</ul>
<p>æˆ‘ç•¶ç„¶ä¸æœƒèªªå»ç”¨å„ç¨®äººå·¥æ™ºèƒ½å»å¯¦ç¾ä¸€å€‹å¼·å¤§çš„çš„è§£æå™¨ç„¶å¾Œç”Ÿæˆï¼Œä¹Ÿä¸æœƒèªªç”¨ä¸€å€‹éå¸¸é¾å¤§å¦‚æœç‹—æ‹¼éŸ³çš„å§“ååº«]]>
    </summary>
    
      <category term="NodeJS" scheme="http://xcoder.in/tags/NodeJS/"/>
    
      <category term="ä¸­æ–‡å" scheme="http://xcoder.in/tags/%E4%B8%AD%E6%96%87%E5%90%8D/"/>
    
      <category term="ä¸­æ–‡æŠ€èƒ½" scheme="http://xcoder.in/tags/%E4%B8%AD%E6%96%87%E6%8A%80%E8%83%BD/"/>
    
      <category term="NodeJS" scheme="http://xcoder.in/categories/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Storm ä¸­ Clojure çš„ Prepare Bolt å¯¦ç¾]]></title>
    <link href="http://xcoder.in/2014/08/04/storm-clojure-prepare-bolt/"/>
    <id>http://xcoder.in/2014/08/04/storm-clojure-prepare-bolt/</id>
    <published>2014-08-04T03:50:21.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="èµ·å› ">èµ·å› </h2><p>ã€€ã€€Storm ä¸­çš„ Bolt éƒ½æ˜¯é€šé Nimbus é€™å€‹æœå‹™å°‡åºåˆ—åŒ–å¥½çš„ Bolt æ–·ç« å–ç¾©åœ°ç™¼åˆ°å„å€‹ worker ä¸­ã€‚æ‰€ä»¥ï¼Œä»»ä½•åœ¨ bolt ä¹‹å¤–ä½ è‡ªèªçˆ²åŠ è¼‰æœŸé–“åˆå§‹åŒ–è¨ˆç®—å¥½çš„ä¸Šä¸‹æ–‡ç’°å¢ƒä¸¦ä¸æœƒè¢«æ‰“åŒ…ä¸Šå»ï¼ŒJava æˆ‘ä¸æ‡‚ä¹Ÿä¸çŸ¥é“ï¼Œä½†æ˜¯è‡³å°‘åœ¨ Clojure é€™å€‹é¡çš„æ¦‚å¿µè¢«æ·¡åŒ–çš„ LIST æ–¹è¨€ä¸­ï¼Œä½ è¦åšçš„å°±æ˜¯æŠŠæ‰€æœ‰è·Ÿ bolt åˆå§‹åŒ–è¨ˆç®—ç›¸é—œçš„ä»£ç¢¼æ”¾åˆ°å…¶ <code>prepare</code> çš„ä»£ç¢¼ç•¶ä¸­å»ã€‚</p>
<p>ã€€ã€€ä½ æƒ³ä¸€ä¸‹ï¼Œç•¶ä½ åœ¨æ–‡ä»¶åŠ è¼‰çš„æ™‚å€™åˆå§‹åŒ–äº†ä¸€å€‹ MongoDB éˆæ¥ï¼Œé€™å€‹éˆæ¥ç¸½ä¸èƒ½è¢«åºåˆ—åŒ–åˆ°é ç¨‹å»å§ï¼Ÿæ‰€ä»¥èªªè¾¦æ³•å°±æ˜¯æŠŠ bolt æä¸Šå»ä¹‹å¾Œï¼Œbolt è‡ªå‹•å»åˆå§‹åŒ–ä¸€å€‹éˆæ¥â€”â€”é€™å°±æ˜¯ <code>prepare</code> çš„ä½œç”¨äº†ã€‚</p>
<p>ã€€ã€€èªªç™½äº†ï¼Œé€™å€‹é‚„æ˜¯æˆ‘å€‘åœ¨ <strong><em>Suwako</em></strong> ç•¶ä¸­è¸©åˆ°çš„å‘ã€‚</p>
<h2 id="åšæ³•">åšæ³•</h2><p>ã€€ã€€å¤§è‡´çš„éª¨æ¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">defbolt</span> bolt <span class="collection">[...]</span> <span class="collection">&#123;<span class="attribute">:prepare</span> <span class="literal">true</span>&#125;</span></span><br><span class="line"> <span class="collection">[...]</span></span><br><span class="line"> <span class="list">(<span class="keyword"><span class="built_in">let</span></span> <span class="collection">[...]</span></span><br><span class="line">  <span class="list">(<span class="keyword">bolt</span></span><br><span class="line">   <span class="list">(<span class="keyword">prepare</span> <span class="collection">[...]</span></span><br><span class="line">    <span class="list">(<span class="keyword">...</span>)</span>)</span></span><br><span class="line">   <span class="list">(<span class="keyword">execute</span> <span class="collection">[tuple]</span></span><br><span class="line">    <span class="list">(<span class="keyword">...</span>)</span>)</span>)</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é¦–å…ˆå°±æ˜¯ <code>{:prepare true}</code> ä»£è¡¨äº†å®ƒæ˜¯ä¸€å€‹éœ€è¦åˆå§‹åŒ–çš„ Boltã€‚</p>
<p>ã€€ã€€ç„¶å¾Œåœ¨ <code>(bolt)</code> çš„ä½œç”¨åŸŸä¹‹å…§æœ‰å…©å€‹ formâ€”â€”<code>prepare</code> å’Œ <code>execute</code>ã€‚</p>
<p>ã€€ã€€å…¶ä¸­ <code>prepare</code> å°±æ˜¯ä½ è¦åˆå§‹åŒ–çš„èªå¥äº†ã€‚èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘è®“é€™è£é¢åˆå§‹åŒ–ä¸€å€‹ <a href="http://clojuremongodb.info/" target="_blank" rel="external">Monger</a>ï¼Œæ–¼æ˜¯æˆ‘å€‘è¦åœ¨ <code>let</code> è£é¢å®šç¾©ä¸€å€‹ç”¨æ–¼éˆæ¥çš„ <code>atom {}</code>ã€‚</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">defbolt</span> bolt <span class="collection">[<span class="string">"..."</span>]</span> <span class="collection">&#123;<span class="attribute">:prepare</span> <span class="literal">true</span>&#125;</span></span><br><span class="line"> <span class="collection">[conf context collector]</span></span><br><span class="line"> <span class="list">(<span class="keyword"><span class="built_in">let</span></span> <span class="collection">[conn <span class="list">(<span class="keyword"><span class="built_in">atom</span></span> <span class="collection">&#123;&#125;</span>)</span></span><br><span class="line">       db <span class="list">(<span class="keyword"><span class="built_in">atom</span></span> <span class="collection">&#123;&#125;</span>)</span>]</span></span><br><span class="line">   <span class="list">(<span class="keyword">bolt</span></span><br><span class="line">    <span class="list">(<span class="keyword">prepare</span> <span class="collection">[conf context collector]</span></span><br><span class="line">     <span class="list">(<span class="keyword"><span class="built_in">reset!</span></span> conn <span class="list">(<span class="keyword">mg/connect</span> ...)</span>)</span></span><br><span class="line">     <span class="list">(<span class="keyword"><span class="built_in">reset!</span></span> db <span class="list">(<span class="keyword">mg/get-db</span> @conn ...)</span>)</span>)</span></span><br><span class="line">    <span class="list">(<span class="keyword">execute</span> <span class="collection">[tuple]</span></span><br><span class="line">     <span class="list">(<span class="keyword">...</span>)</span>)</span>)</span>)</span>)</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™æ¨£ä¸€ä¾†ï¼Œç•¶ Bolt è¢« Nimbus æ‰“åŒ…å‚³åˆ°å„å€‹ worker ä¹‹å¾Œï¼ŒBolt åŸ·è¡Œèµ·ä¾†çš„æ™‚å€™æœƒè‡ªå‹•åŸ·è¡Œ <code>prepare</code> ç•¶ä¸­çš„ä»£ç¢¼ï¼Œå³åˆå§‹åŒ– MongoDB çš„éˆæ¥ï¼Œä¸¦ä¸”å°‡å…¶è³¦å€¼çµ¦ <code>conn</code> å’Œ <code>db</code> å…©å€‹ atomã€‚</p>
<p>ã€€ã€€é‚£éº¼ï¼Œæˆ‘å€‘å°±èƒ½åœ¨æœ¬é«” <code>execute</code> ç•¶ä¸­ä½¿ç”¨ <code>@conn</code> å’Œ <code>@db</code> ä¾†ä½¿å–š MongoDB äº†ã€‚</p>
<h2 id="æ€è€ƒ">æ€è€ƒ</h2><p>ã€€ã€€å¯èƒ½å¾ˆå¤šäººä¸è§£ï¼Œä¸æ˜¯èªªå„˜é‡ä¿æŒ LISP èªç³»ç•¶ä¸­å€¼çš„ä¸è®Šæ€§çš„éº¼ï¼Ÿ</p>
<p>ã€€ã€€å…¶å¯¦ä¸è®Šæ€§åªæ˜¯çˆ²äº†æé«˜ç¨‹åºåœ¨é‹è¡Œæ™‚çš„æ•ˆç‡â€”â€”è€Œäº‹å¯¦ä¸Šæ˜¯ï¼Œä¸Šé¢é‚£æ®µä»£ç¢¼ä¸¦æ²’æœ‰åœ¨é‹è¡Œæ™‚å»åšè®Šé‡ã€‚</p>
<p>ã€€ã€€é›–ç„¶èªªé€™éº¼èªªæœ‰é»ç‰½å¼·ï¼Œä½†æ˜¯çš„ç¢ºå°±æ˜¯é€™å€‹æ„æ€â€”â€”å› çˆ²æˆ‘å€‘æ˜¯åœ¨ç¨‹åºåŸ·è¡ŒçœŸæ­£æœ‰ç”¨çš„å¥½é‚è¼¯çš„æ™‚å€™æ²’æœ‰å»æ”¹è®Šä¸€äº›å€¼ï¼Œç›¸ååªæ˜¯åœ¨ Bolt å•“å‹•çš„æ™‚å€™åšä¸€äº›è®Šé‡çš„æ“ä½œã€‚</p>
<p>ã€€ã€€æ›å¥è©±èªªï¼Œé›–ç„¶åš´è¬¹çš„è¬›é‚£å€‹æ™‚å€™æ˜¯ç®—é‹è¡Œæ™‚ï¼Œä½†æ˜¯åœ¨é‹è¡Œæ™‚è£é¢æˆ‘å€‘å»å¯ä»¥æŠŠå®ƒæ­¸é¡çˆ²é è™•ç†â€”â€”é€™ä¸€é¡æ±è¥¿åæ­£ç¨‹åºé‚„æ²’çœŸæ­£é–‹å§‹è·‘æœ‰ç”¨çš„æ±è¥¿ï¼Œæ•ˆç‡æ…¢ä¸€é»ç„¡æ‰€è¬‚ï¼Œè€Œä¸”å°±åˆå§‹åŒ–é€™éº¼å±å¤§é»äº‹å…’èƒ½æœ‰å¤šå°‘å½±éŸ¿ï¼Ÿ</p>
<p>ã€€ã€€æ•ˆç‡å’Œæ•ˆæœä¹‹é–“æ¬Šè¡¡ä¸Šé¢çš„é‚„æ˜¯è¦ä»è€…è¦‹ä»æ™ºè€…è¦‹æ™ºäº†ã€‚</p>
<h2 id="å°çµ">å°çµ</h2><p>ã€€ã€€æœ¬ä»¥çˆ² <code>Suwako</code> çµ‚æ–¼å¯ä»¥æš«æ™‚å‘Šä¸€æ®µè½äº†ï¼Œç·Šè¦é—œé ­å±…ç„¶é‚„æ˜¯é˜»å¡äº†ã€‚</p>
<p>ã€€ã€€èªªå¤šéƒ½æ˜¯æ·šï¼Œä¸èªªäº†ï¼Œæ‰¾ Bug å»äº†ã€‚</p>
<p><img src="suwako.jpg" alt="æ³„çŸ¢è«è¨ªå­"></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="èµ·å› ">èµ·å› </h2><p>ã€€ã€€Storm ä¸­çš„ Bolt éƒ½æ˜¯é€šé Nimbus é€™å€‹æœå‹™å°‡åºåˆ—åŒ–å¥½çš„ Bolt æ–·ç« å–ç¾©åœ°ç™¼åˆ°å„å€‹ worker ä¸­ã€‚æ‰€ä»¥ï¼Œä»»ä½•åœ¨ bolt ä¹‹å¤–ä½ è‡ªèªçˆ²åŠ è¼‰æœŸé–“åˆå§‹åŒ–è¨ˆç®—å¥½çš„ä¸Šä¸‹æ–‡ç’°å¢ƒä¸¦ä¸æœƒè¢«æ‰“åŒ…ä¸Šå»ï¼ŒJava æˆ‘ä¸æ‡‚ä¹Ÿä¸çŸ¥é“]]>
    </summary>
    
      <category term="Clojure" scheme="http://xcoder.in/tags/Clojure/"/>
    
      <category term="Huaban" scheme="http://xcoder.in/tags/Huaban/"/>
    
      <category term="Storm" scheme="http://xcoder.in/tags/Storm/"/>
    
      <category term="Programming" scheme="http://xcoder.in/categories/Programming/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[é–‹ç™¼æ¸¬è©¦æ™‚çµ¦ Kafka ç™¼æ¶ˆæ¯çš„ UI ç™¼é€å™¨â€”â€”Mikasa]]></title>
    <link href="http://xcoder.in/2014/07/30/kafka-ui-sender-mikasa/"/>
    <id>http://xcoder.in/2014/07/30/kafka-ui-sender-mikasa/</id>
    <published>2014-07-30T02:14:29.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="èµ·_(ç¬ÂºÏ‰Âºç¬)">èµ· (ç¬ÂºÏ‰Âºç¬)</h2><p>ã€€ã€€èªªä¾†è©±é•·ï¼Œè‡ªå¾å…¥äº†èŠ±ç“£ï¼Œæ•´å€‹äººå°±æ‰é€²é€£ç’°å‘äº†ã€‚</p>
<p>ã€€ã€€å¾Œç«¯å…ƒæ•¸æ“šæ¡é›†æ˜¯ç”¨ Storm ä¾†èµ°æ‹“æ’²æµç¨‹çš„ï¼Œåˆå› çˆ² @<a href="http://weibo.com/zolazhou" target="_blank" rel="external">Zola</a> ä¸æ˜¯å¾ˆå–œæ­¡ Javaï¼Œæ‰€ä»¥é€€è€Œæ±‚å…¶æ¬¡é¸æ“‡äº† Clojureï¼Œæ‰€ä»¥æ­£åœ¨è‹¦é€¼åœ°å­¸ç¿’ Clojure å’Œ Storm ä¸­ã€‚</p>
<p>ã€€ã€€ç›®å‰ä¾†èªªå¤–é¢çš„ Storm æ‹“æ’²çš„ Spout æ˜¯å¾ Kafka ä¸­æµå…¥æ•¸æ“šçš„ã€‚ä½†æ˜¯æˆ‘å€‘è¦çµ¦ Kafka ç™¼é€æ¸¬è©¦æ•¸æ“šçš„æ™‚å€™ï¼Œå°±éœ€è¦è·‘åˆ° Kafka çš„æ¸¬è©¦æœå‹™å™¨æ‰“é–‹å®ƒçš„ä¸€å€‹ç™¼é€è…³æœ¬é€²å»ç™¼é€ï¼Œéå¸¸è›‹ç–¼ï¼›è¦éº¼å°±æ˜¯ç›´æ¥é€šéç‰¹å®šçš„ç™¼é€æ¥­å‹™é‚è¼¯ä»£ç¢¼æ¸¬è©¦ï¼Œæ²’æœ‰ä¸€å€‹ç¨å¾®æ³›ä¸€é»çš„æ¸¬è©¦ç”¨ç™¼æ•¸æ“šå·¥å…·ï¼Œæ–¼æ˜¯ Mikasa èª•ç”Ÿäº†ã€‚</p>
<h2 id="æ‰¿_(ï¾Ÿ3ï¾Ÿ)ï½â™ª">æ‰¿ (ï¾Ÿ3ï¾Ÿ)ï½â™ª</h2><p>ã€€ã€€è¬›åˆ° Mikasa åå­—çš„ä¾†æºï¼Œå¯¦éš›ä¸Šçœ‹éã€å·¨äººã€éƒ½çŸ¥é“ï¼Œå…«å¡Šè…¹è‚Œçš„ä¸‰çˆºã€‚</p>
<p>ã€€ã€€é€™è£å°çˆ†æ–™ä¸€ä¸‹ï¼Œåˆæ‹é›²å’ŒèŠ±ç“£ï¼ˆéƒ½æ˜¯åŒå®—ï¼‰çš„é …ç›®åå¾ˆå¤§éƒ¨åˆ†éƒ½æ˜¯ä»¥æµ·è³Šç‹çš„è§’è‰²å‘½åçš„â€”â€”å°¤å…¶æ˜¯åˆæ‹é›²æ›´æ˜¯å–ªå¿ƒç—…ç‹‚ã€‚ä¸éé€™è®“æˆ‘é€™å€‹åƒÂ·äºŒæ¬¡å…ƒçš„å°å¤¥ä¼´ç•°å¸¸æ¬£å–œï¼Œå› çˆ²æˆ‘ä¹Ÿèƒ½ç”¨å„ç¨®å•ªå•ªå•ªä¾†å‘½åæˆ‘çš„è§’è‰²äº†ã€‚æ¯”å¦‚æˆ‘çš„ç¬¬ä¸€å€‹ Storm ç›¸é—œçš„é …ç›®å°±å« Suwakoï¼Œå³è«è¨ªå­å¤§äººï¼Œå› çˆ²è…¦å­éœ€è¦å„ç¨®è·³ï¼Œæ–¼æ˜¯å°±å°è«è¨ªå­å¤§äººé€™ä½é’è›™ä¹‹ç¥å„ç¨®è†œæ‹œã€‚</p>
<p>ã€€ã€€è‡³æ–¼é€™å€‹ç™¼å°„å™¨çˆ²ä»€éº¼è¦ç”¨ä¸‰çˆºå‘¢ï¼Ÿå› çˆ²ä¸‰çˆºç›¸ç•¶æ–¼å…ˆé‹’è»å“‡ï¼</p>
<p><img src="mikasa.jpeg" alt="Mikasa"></p>
<p>ã€€ã€€é€™è£çš„ Kafka ä¾è³´ç”¨äº†æœç‹å°å¤¥ä¼´ @<a href="http://weibo.com/crzidea" target="_blank" rel="external">Crzidea</a> ä»–å€‘åœ˜éšŠå¯«çš„æ¨¡å¡Šã€‚</p>
<h2 id="è½‰_(ã„ï¿£â–½ï¿£)ã„_ã„Ÿ(ï¿£â–½ï¿£ã„Ÿ)">è½‰ (ã„ï¿£â–½ï¿£)ã„   ã„Ÿ(ï¿£â–½ï¿£ã„Ÿ)</h2><p>ã€€ã€€æ–¼æ˜¯ï¼Œè©±ä¹Ÿä¸å¤šèªªï¼Œç›´æ¥ä¸Š repo å§ã€‚åœ¨å…¬å¸å…§ç¶²çš„ gitlab è£é¢æœ‰ä¸€ä»½ï¼Œé‚„æœ‰ä¸€å€‹ repo åœ¨ <a href="https://github.com/" target="_blank" rel="external">GitHub</a> ä¸Šã€‚</p>
<blockquote>
<p><a href="https://github.com/XadillaX/mikasa" target="_blank" rel="external">é»æˆ‘</a></p>
</blockquote>
<h3 id="Download_||_Clone">Download || Clone</h3><p>ã€€ã€€å¦‚æœè¦ç›´æ¥ä¸‹è¼‰çš„è©±å°±ç”¨é€™å€‹éˆæ¥ï¼š</p>
<blockquote>
<p><a href="https://github.com/XadillaX/mikasa/archive/master.zip" target="_blank" rel="external">https://github.com/XadillaX/mikasa/archive/master.zip</a></p>
</blockquote>
<p>ã€€ã€€å¦‚æœè¦å…‹éš†çš„è©±å°±ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/XadillaX/mikasa.git</span><br></pre></td></tr></table></figure>
<h3 id="Setup">Setup</h3><p>ã€€ã€€ç›´æ¥å®‰è£ä¸€ä¸‹ä¾è³´ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br></pre></td></tr></table></figure>
<h3 id="Configuration">Configuration</h3><p>ã€€ã€€æ¥ä¸‹å»å°±æ˜¯ç°¡å–®çš„é…ç½®ä¸€ä¸‹äº†ï¼Œå…¶å¯¦å°±æ˜¯é…ç½®ä¸‹é…ç½®æ–‡ä»¶ã€‚ç”±æ–¼æ˜¯å¿«é€Ÿé–‹ç™¼ï¼Œç›´æ¥ç”¨äº†è‡ªå·±ä¹‹å‰çš„ <a href="https://github.com/XadillaX/exframess" target="_blank" rel="external">Exframess</a> æ¡†æ¶ï¼Œæ‰€ä»¥å¾ˆå¤šç„¡ç”¨ä»£ç¢¼ä¹Ÿæ‡¶å¾—åˆªäº†ã€‚</p>
<h4 id="config/server-js">config/server.js</h4><p>ã€€ã€€é€™è£å…¶å¯¦åˆ¥çš„ä¹Ÿä¸ç”¨å‹•ï¼Œä¸»è¦æ˜¯ä¿®æ”¹ä¸‹ç«¯å£å³å¯ã€‚</p>
<h4 id="config/kafka-js">config/kafka.js</h4><p>ã€€ã€€é€™è£ä¿®æ”¹ä¸€ä¸‹ Kafka çš„ <code>Connection String</code> å°±å¥½äº†ã€‚</p>
<h3 id="Start_up">Start up</h3><p>ã€€ã€€æœ€å¾Œå•“å‹•æœå‹™å³å¯ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node app.js&#10;# or&#10;$ pm2 app.js&#10;# or some other&#39;s</span><br></pre></td></tr></table></figure>
<h2 id="åˆ_(ï¾‰â—•ãƒ®â—•)ï¾‰*:ï½¥ï¾Ÿâœ§">åˆ (ï¾‰â—•ãƒ®â—•)ï¾‰*:ï½¥ï¾Ÿâœ§</h2><p>ã€€ã€€æœ€å¾Œçš„æ•ˆæœæ˜¯é€™æ¨£çš„ï¼š</p>
<p><img src="mikasa-preview.png" alt="Preview"></p>
<p>ã€€ã€€åªè¦åœ¨ Topics æ¬„è£é¢è¼¸å…¥ä½ è¦ç™¼é€çš„ Topicï¼Œç„¶å¾Œå†ä¸‹é¢çš„æ¶ˆæ¯æ¬„è£é¢è¼¸å…¥ä½ è¦å‚³çš„æ¶ˆæ¯ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œæœ€å¾Œé»æ“Š <code>Send</code> å³å¯å°‡ä½ çš„æ¸¬è©¦æ¶ˆæ¯ç™¼é€² Kafka ä¸­å»äº†ã€‚</p>
<blockquote>
<p>è¨—å¤§å®¶çš„ç¦ï¼Œä»Šå¤©æˆ‘çš„ Suwako æ•´å€‹é‚è¼¯çµ‚æ–¼è·‘é€šäº†ï¼Œæ’’èŠ±ï¼ÎµÙ©(à¹‘&gt; â‚ƒ &lt;)Û¶Ğ·</p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="èµ·_(ç¬ÂºÏ‰Âºç¬)">èµ· (ç¬ÂºÏ‰Âºç¬)</h2><p>ã€€ã€€èªªä¾†è©±é•·ï¼Œè‡ªå¾å…¥äº†èŠ±ç“£ï¼Œæ•´å€‹äººå°±æ‰é€²é€£ç’°å‘äº†ã€‚</p>
<p>ã€€ã€€å¾Œç«¯å…ƒæ•¸æ“šæ¡é›†æ˜¯ç”¨ Storm ä¾†èµ°æ‹“æ’²æµç¨‹çš„ï¼Œåˆå› çˆ² @<a href="http://weibo.com/zolazhou" targ]]>
    </summary>
    
      <category term="Kafka" scheme="http://xcoder.in/tags/Kafka/"/>
    
      <category term="Mikasa" scheme="http://xcoder.in/tags/Mikasa/"/>
    
      <category term="èŠ±ç“£" scheme="http://xcoder.in/tags/%E8%8A%B1%E7%93%A3/"/>
    
      <category term="Programming" scheme="http://xcoder.in/categories/Programming/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Untrusted - éŠæˆ²é¡Œè§£]]></title>
    <link href="http://xcoder.in/2014/06/12/untrusted-solution/"/>
    <id>http://xcoder.in/2014/06/12/untrusted-solution/</id>
    <published>2014-06-12T03:08:34.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€<a href="http://alexnisnevich.github.io/untrusted/" target="_blank" rel="external">Trusted</a> æ˜¯ä¸€å€‹ä»£ç¢¼è§£è¬éŠæˆ²ï¼Œç”¨ Javascript ä¾†éé—œçš„ã€‚</p>
<p>ã€€ã€€æ˜¨å¤©å‡Œæ™¨èŠ±äº†ä»¨å°æ™‚é€šé—œäº†é€™å€‹éŠæˆ²ï¼Œåœ¨é€™è£å°±ç²—ç²—åšä¸€ä¸‹é¡Œè§£å§ï¼Œå¥½å¹¾é¡Œéƒ½æ˜¯ Hack éå»çš„ã€‚ï¼ˆä¸è¦è‡‰ï¼Œ( ï¾ŸĞ”ï¾Ÿ)Ïƒ</p>
<h2 id="Ceil_Block_A">Ceil Block A</h2><p>ã€€ã€€é€™æœ‰é»åƒæ•™å­¸é—œå§ï¼Œç¸½ä¹‹å…ˆæ‹¿åˆ°é‚£è‡ºé›»è…¦ä½ å°±èƒ½æ“ä½œäº†ã€‚æ‹¿åˆ°é›»è…¦å¾Œä½ å°±èƒ½ä¿®æ”¹åœ°åœ–å…§éƒ¨é»‘è‰²åº•è‰²çš„ä»£ç¢¼äº†ã€‚</p>
<p>ã€€ã€€é€™å€‹æ™‚å€™ä½ åªéœ€è¦æŠŠä¸­é–“è¨­ç½®ç‰†çš„ä»£ç¢¼å»æ‰å°±å¯ä»¥äº†ï¼Œæˆ–è€…è¨»é‡‹æ‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//for(y = 3; y &lt;= map.getHeight() - 10; y++) &#123;</span></span><br><span class="line"><span class="comment">//    map.placeObject(5, y, 'block');</span></span><br><span class="line"><span class="comment">//    map.placeObject(map.getWidth() - 5, y, 'block');</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//for(x = 5; x &lt;= map.getWidth() - 5; x++) &#123;</span></span><br><span class="line"><span class="comment">//    map.placeObject(x, 3, 'block');</span></span><br><span class="line"><span class="comment">//    map.placeObject(x, map.getHeight() - 10, 'block');</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œ <code>&lt;ctrl-5&gt;</code> é‡æ–°åŸ·è¡Œâ€”â€”å™ å™ ï½ç‰†å°±æ¶ˆå¤±äº†ï¼Œè¶•ç·Šåˆ°è—è‰²çš„å‡ºå£è™•å§ã€‚</p>
<h2 id="The_Long_Way_Out">The Long Way Out</h2><p>ã€€ã€€ä»£ç¢¼å¤§è‡´æ˜¯çµ¦ä½ å‰µå»ºäº†ä¸€å€‹è¿·å®®ï¼Œä¸¦ä¸”å‡ºå£è™•å››é¢ç”¨åœç‰†åœèµ·ä¾†ã€‚</p>
<p>ã€€ã€€æˆ‘ç”¨äº†ä¸€å€‹æ¯”è¼ƒ Hack çš„æ–¹æ³•ï¼Œåœ¨ç¬¬ä¸€å€‹é»‘è‰²å€åŸŸçš„æœ€ä¸Šæ–¹æŠŠ <code>maze.create</code> é‡å®šå‘åˆ°è‡ªå·±çš„ä¸€å€‹ç©ºå‡½æ•¸ï¼Œé€™æ¨£ä¸‹é¢èª¿ç”¨å‰µå»ºè¿·å®®çš„å‡½æ•¸å°±ä¸æœƒè¢«åŸ·è¡Œï¼Œé€™å€‹æ™‚å€™å†åŸ·è¡Œçš„è©±è¿·å®®å°±ä¸è¦‹äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maze.create = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è¿·å®®ä¸è¦‹äº†é‚„ä¸é è­œï¼Œå› çˆ²é‚„æœ‰ä¸€å€‹å‡ºå£å››å‘¨æœ‰ç‰†â€”â€”é‚£å°±è‡ªå·±å†å»ºä¸€å€‹å‡ºå£å”„ï¼Œåœ¨ç¬¬äºŒå€‹é»‘è‰²å€åŸŸå¯«ä¸Šå»ºç«‹ä¸€å€‹æ–°å‡ºå£çš„ä»£ç¢¼å³å¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.placeObject(<span class="number">0</span>, <span class="number">0</span>, <span class="string">"exit"</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‹‡æ•¢çš„å°‘å¹´å•Šï¼Œå¿«å»å‰µé€ å¥‡è¹Ÿï¼</p>
</blockquote>
<h2 id="Validation_Engaged">Validation Engaged</h2><p>ã€€ã€€é€™é¡Œçš„è¦æ±‚æ˜¯åœ¨é‚„å­˜åœ¨ç€ä¸€å®šé‡ã€å£ã€çš„æƒ…æ³ä¸‹ä½ èƒ½åˆ°é”å‡ºå£ï¼Œä¹Ÿå°±æ˜¯èªªç´”ç²¹åœ°åˆªé™¤å®ƒåŠ ã€å£ã€çš„ä»£ç¢¼æ˜¯ä¸è¡Œçš„ï¼Œé‚£æˆ‘å€‘åšé»æ”¹å‹•å°± OK äº†ã€‚æŠŠã€å£ã€å¾€å¤–ç§»å‹•ï¼Œç›´åˆ°æŠŠäººå’Œå‡ºå£éƒ½æ˜¯åœ¨ã€å£ã€å…§ã€‚</p>
<blockquote>
<p>é‚£ä¸€å¤©ï¼Œäººé¡çµ‚æ–¼å›æƒ³èµ·æ›¾ç¶“ä¸€åº¦è¢«ä»–å€‘æ‰€æ”¯é…çš„ææ€–ï¼Œé‚„æœ‰å›šç¦æ–¼é³¥ç± ä¸­çš„é‚£ä»½å±ˆè¾±ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(y = <span class="number">0</span>; y &lt;= map.getHeight() - <span class="number">3</span>; y++) &#123;</span><br><span class="line">    map.placeObject(<span class="number">5</span>, y, <span class="string">'block'</span>);</span><br><span class="line">    map.placeObject(map.getWidth() - <span class="number">5</span>, y, <span class="string">'block'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(x = <span class="number">0</span>; x &lt;= map.getWidth() - <span class="number">5</span>; x++) &#123;</span><br><span class="line">    map.placeObject(x, <span class="number">3</span>, <span class="string">'block'</span>);</span><br><span class="line">    map.placeObject(x, map.getHeight() - <span class="number">3</span>, <span class="string">'block'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Multiplicity">Multiplicity</h2><p>ã€€ã€€å˜›å˜›ï¼Œé€™æ˜¯ç¬¬äºŒé—œçš„ç°¡åŒ–ç‰ˆâ€”â€”ç›´æ¥å†æä¸€å€‹å‡ºå£å°± OK äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.placeObject(<span class="number">20</span>, <span class="number">10</span>, <span class="string">'exit'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Minesweeper">Minesweeper</h2><p>ã€€ã€€é€™æ˜¯ä¸€å€‹é›·å€ï¼Œä½ ä¸ç¢°é›·å°±å¥½ã€‚å¾ä»£ç¢¼è£é¢çœ‹å‡ºä¾†æœ‰å€‹ <code>map.setSquareColor</code> å‡½æ•¸å¯ä»¥è¨­ç½®æŸå€‹æ ¼å­çš„é¡è‰²ã€‚é‚£å¥½è¾¦ï¼Œæˆ‘å€‘åœ¨è¨­ç½®ä¸€å€‹åœ°é›·å¾ŒæŠŠå®ƒç”¨åˆ¥çš„é¡è‰²æ¨™è¨˜å‡ºä¾†å°±å¥½äº†ï¼Œç„¶å¾Œé‡æ–°åŸ·è¡Œåªè¦ä½ ä¸æ˜¯è‰²ç›²éƒ½èƒ½å®‰å…¨é€šéã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.setSquareColor(x, y, <span class="string">"#ff7800"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Drones_101">Drones 101</h2><p>ã€€ã€€é€™é¡Œå¤§æ¦‚å°±æ˜¯èªªæœ‰å€‹ç™¡æ¼¢æœƒè·Ÿä½ é è¿‘ï¼Œç„¶å¾ŒæŠŠä½ å…ˆå¥¸å¾Œæ®ºã€‚</p>
<p>ã€€ã€€ä½†æ˜¯ç™¡æ¼¢å¾ˆç¬¨ï¼Œåœ¨ä»–çš„å¿…ç¶“ä¹‹è·¯ç”¨ç‰†å µä½ä»–å°±ä¸æœƒç¹¼çºŒå‹•äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map.placeObject(<span class="number">30</span>, <span class="number">12</span>, <span class="string">'block'</span>);</span><br><span class="line">map.placeObject(<span class="number">31</span>, <span class="number">11</span>, <span class="string">'block'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Colors">Colors</h2><p>ã€€ã€€é€™å€‹æ˜¯é‚£å€‹è³£ç›¸ä¸éŒ¯çš„é›»è©±æ©Ÿçš„æ•™å­¸é—œå¡ã€‚æ‰€ä»¥å¤§è‡´çš„æ„æ€æ˜¯è¨­ç½®äº†æ‰“é›»è©±çš„å›èª¿å‡½æ•¸å³å¯ã€‚ÎµÙ©(à¹‘&gt; â‚ƒ &lt;)Û¶Ğ·</p>
<p>ã€€ã€€åˆ†æä»£ç¢¼å¯çŸ¥ï¼Œè¦é€šéé‚£å¹¾å€‹é•·å¾—è·ŸèŠèŠ±ä¸€æ¨£çš„å¸¶è‰²å…’çš„ç‰†ä½ å°±è¦è·Ÿé‚£å€‹èŠèŠ±é¡è‰²ä¸€æ¨£ã€‚æ‰€ä»¥é›»è©±æ©Ÿçš„å›èª¿å‡½æ•¸å¤§è‡´æ˜¯è®“ä½ è‡ªå·±è®Šè‰²å°±å¥½äº†ã€‚</p>
<p>ã€€ã€€æŒ‰ç…§é †åºæ‰€è¦‹ï¼Œå¦‚æœäººæ˜¯ç¶ è‰²çš„é€šéä¹‹å¾Œè¦è®Šæˆç´…è‰²ï¼Œç„¶å¾Œå†è®Šæˆé»ƒè‰²å†ç¶ è‰²ã€‚æ–¼æ˜¯å¯«ä»¥ä¸‹çš„è®Šè‰²éç¨‹å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> player = map.getPlayer();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = player.getColor();</span><br><span class="line"><span class="keyword">switch</span>(color) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"#0f0"</span>:</span><br><span class="line">        player.setColor(<span class="string">"#f00"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"#f00"</span>:</span><br><span class="line">        player.setColor(<span class="string">"#ff0"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"#ff0"</span>:</span><br><span class="line">        player.setColor(<span class="string">"#0f0"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é‡æ–°åŸ·è¡Œæ’¿èµ·é›»è©±æ©Ÿï¼Œç„¶å¾Œé€šéç¶ èŠèŠ±ä¹‹å¾ŒæŒ‰ <code>Q</code> ä½¿ç”¨é›»è©±æ©Ÿè®“è‡ªå·±è®Šè‰²å…’å°±å¥½äº†ã€‚</p>
<blockquote>
<p>â€œå“å‘€ï¼Œå¤©ï¼ä»–æ˜¯æƒ¦è¨˜å¼Ÿå¼Ÿäº†ã€‚â€¦â€¦å¯æˆ‘é‚„ä¸çŸ¥é“å‘¢ï¼é‚£éº¼é€™æ˜¯ä»–è€äººå®¶çš„ç‹—ï¼Ÿå¾ˆé«˜èˆˆã€‚â€¦â€¦ä½ æŠŠå®ƒå¸¶å»å§ã€‚â€¦â€¦é€™æ¢å°ç‹—æ€ªä¸éŒ¯çš„ã€‚â€¦â€¦æŒºä¼¶ä¿ã€‚â€¦â€¦ä¸€å£å°±æŠŠé€™å‚¢ä¼™çš„æ‰‹æŒ‡å’¬ç ´äº†ï¼å“ˆå“ˆå“ˆå“ˆï¼â€¦â€¦å’¦ï¼Œä½ å¹¹å—ç™¼æŠ–ï¼Ÿå—šå—šï¼Œâ€¦â€¦å—šå—šã€‚â€¦â€¦å®ƒç”Ÿæ°£äº†ï¼Œå°å£è›‹ï¼Œâ€¦â€¦å¥½ä¸€æ¢å°ç‹—â€¦â€¦â€</p>
</blockquote>
<h2 id="Into_the_Woods">Into the Woods</h2><p>ã€€ã€€æ£®æ—è£é¢æœ‰æ¨¹å’Œç‰†ï¼Œæˆ‘ä¹Ÿæ‡¶å¾—æƒ³æˆ–è€…å¯«ä»£ç¢¼äº†ã€‚ï¼ˆæ˜æ˜æ˜¯è‡ªå·±æƒ³ä¸å‡ºä¾†#ï¾ŸÃ…ï¾Ÿï¼‰âŠ‚å½¡â˜†))ï¾ŸĞ”ï¾Ÿ)ï½¥âˆµ</p>
<p>ã€€ã€€ç¸½ä¹‹æˆ‘æ˜¯å„˜å¯èƒ½å‘å‡ºå£é è¿‘ï¼Œç„¶å¾Œåˆ°æ­»è·¯äº†è¶•ç·Šæ‰“é›»è©±è®“æ£®æ—é‡æ–°ç”Ÿæˆä¸€éï¼Œå¦‚æ­¤å¾ªç’°å¾€å¾©ç›´åˆ°å‡ºå£ã€‚</p>
<h2 id="Fording_the_River">Fording the River</h2><p>ã€€ã€€23333333333333ï¼åšé€™é¡Œçš„æ™‚å€™å·®é»æ²’æŠŠè‡ªå·±ç€è¦½å™¨å¡æ­»ã€‚</p>
<p>ã€€ã€€å¤§è‡´çš„æ„æ€æ˜¯æ²³çš„ä¸Šé¢æœ‰ä¸€æ¢èˆ¹ï¼Œä½ ç›´æ¥é‡æ°´æœƒæ­»ï¼Œè¦ä¸Šèˆ¹ã€‚ä½†æ˜¯èˆ¹è²Œä¼¼ä¸è·Ÿä½ èµ°å•Š QAQã€‚</p>
<p>ã€€ã€€è€Œä¸”è¨­å®šå¯«ç€åªèƒ½æœ‰ä¸€æ¢ <code>raft</code>ã€‚</p>
<p>ã€€ã€€å’±å°±ä¾†å€‹å·å¤©æ›æ—¥ï¼Œè‡ªå·±é€ è«¾äºæ–¹èˆŸé‹ªæ»¿æ•´æ¢æ²³ï¼ˆå› çˆ²æ‡¶å¾—è¨ˆç®—ï¼‰ã€‚</p>
<p>ã€€ã€€é¦–å…ˆå®šç¾©è«¾äºæ–¹èˆŸçš„é¡å‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">map.defineObject(<span class="string">"noah"</span>, &#123;</span><br><span class="line">    <span class="string">'type'</span>: <span class="string">'dynamic'</span>,</span><br><span class="line">    <span class="string">'symbol'</span>: <span class="string">'a'</span>,</span><br><span class="line">    <span class="string">'color'</span>: <span class="string">'#420'</span>,</span><br><span class="line">    <span class="string">'transport'</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">'behavior'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">me</span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œå‘¢æŠŠå®ƒé‹ªæ»¿æ•´æ¢å¤§æ²³å§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> x = <span class="number">0</span>; x &lt; map.getWidth(); x++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> y = <span class="number">5</span>; y &lt; <span class="number">15</span>; y++) &#123;</span><br><span class="line">        map.placeObject(x, y, <span class="string">'noah'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸€æ¢å¤§æ²³ï¼Œå…©å²¸å¯¬ï¼Œé¢¨å¹ç¨»èŠ±é¦™å…©å²¸ã€‚ï¼ˆå–‚å–‚å–‚ï¼Œå°å¿ƒå¡æ­»<em>(â”ã€ŒÎµ:)</em></p>
</blockquote>
<h2 id="Ambush">Ambush</h2><p>ã€€ã€€å¾Œä¾†æˆ‘å» <code>Untrusted</code> çš„ repo å»çœ‹é¡Œè§£ï¼Œç™¼ç¾ä»–å€‘éƒ½æ˜¯å»é©…ä½¿é€™ç¾£ç™¡æ¼¢å¹¹å˜›å¹¹å˜›ã€‚æˆ‘æ„Ÿè¦ºæˆ‘çš„æœ€ç°¡å–®æš´åŠ›äº†â€”â€”ç›´æ¥å»¢äº†ä»–å€‘ã€‚</p>
<p>ã€€ã€€å…¶å¯¦å‘¢åªè¦æŠŠç¢°æ’å‡½æ•¸é‡å¯«ä¸€éï¼Œé€™å †ç™¡æ¼¢é¦¬ä¸Šå°±è®Šå¾—äººç•œç„¡å®³ï¼Œä½ èµ°éå»äººå®¶é‚„è¡Œç¦®å‘¢233333333333</p>
<p>ã€€ã€€ä»”ç´°çœ‹ä¸€ä¸‹æˆ‘å€‘è¦å®Œæˆçš„éƒ¨åˆ†åœ¨ <code>behavior</code> è£é¢ï¼Œæ‰€ä»¥åœ¨é€™è£é¢ç”¨ <code>this</code> æ˜¯å¦¥å¦¥ç”Ÿæ•ˆçš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.onCollision = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>çœ‹æˆ‘ç¢è›‹å¤§ç²‰æ‹³ï¼ï¼ˆå¿½ç„¶è¦ºå¾—ä¸‹èº«ä¸€é™£ç–¼ç—›  |Ğ”`)ãƒâŒ’â—ï½*</p>
</blockquote>
<h2 id="Robot">Robot</h2><p>ã€€ã€€ä½ èµ°ä¸€æ­¥æ©Ÿå™¨äººèµ°ä¸€æ­¥ï¼Œä¹Ÿæ˜¯æ•™å­¸é—œå¡ã€‚</p>
<p>ã€€ã€€æ©Ÿå™¨äººèƒ½å¾€ä¸‹èµ°å°±å¾€ä¸‹èµ°ï¼Œèƒ½å¾€å³èµ°å°±å¾€å³èµ°å°±æ‹¿åˆ°é‘°åŒ™äº†ï¼Œæœ€å¾Œä½ å†è¿½ä¸Šæ©Ÿå™¨äººæŠŠé‘°åŒ™æ¶éä¾†å°±å¥½äº†ã€‚å› çˆ²æ©Ÿå™¨äººæ˜¯å¯ä»¥ç©¿éç´«ç¿”è‰²çš„é‚£æ‰‡é–€çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(me.canMove(<span class="string">"down"</span>)) me.move(<span class="string">"down"</span>);</span><br><span class="line"><span class="keyword">else</span> me.move(<span class="string">"right"</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç«™ä½ï¼Œä¿è­·è²»ã€‚ä½ ä¸è£ X æˆ‘å€‘é‚„æ˜¯å¥½æœ‹å‹ã€‚</p>
</blockquote>
<h2 id="Robot_Nav">Robot Nav</h2><p>ã€€ã€€æˆ‘å±…ç„¶ç„¡èŠåˆ°è‡ªå·±æŠŠè·¯ç·šæ•¸å‡ºä¾†äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> road = <span class="string">"ddddrrrrrrrrrrrrrrrrrrrrrrrrrrrrrruurrrrrrrrrrrrrrrrrddddddd"</span>;</span><br><span class="line"><span class="keyword">this</span>.cur = <span class="keyword">this</span>.cur === <span class="literal">undefined</span> ? <span class="number">0</span> : (<span class="keyword">this</span>.cur + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.cur &gt;= road.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(road[<span class="keyword">this</span>.cur] === <span class="string">"d"</span>) me.move(<span class="string">"down"</span>);</span><br><span class="line"><span class="keyword">if</span>(road[<span class="keyword">this</span>.cur] === <span class="string">"r"</span>) me.move(<span class="string">"right"</span>);</span><br><span class="line"><span class="keyword">if</span>(road[<span class="keyword">this</span>.cur] === <span class="string">"u"</span>) me.move(<span class="string">"up"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Robot_Maze">Robot Maze</h2><p>ã€€ã€€å¥½å§ä½œè€…æ—©å°±æƒ³åˆ°äº†æœ‰äººæœƒç„¡èŠåœ°å»æ•¸ã€‚</p>
<p>ã€€ã€€å˜›å˜›ï¼Œå°±å¦‚ä½œè€…æ‰€é¡˜å¯«å€‹æœ€åŸºç¤çš„ DFS äº†äº‹å§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> direct = &#123;</span><br><span class="line">    <span class="string">"d"</span>: <span class="string">"down"</span>,</span><br><span class="line">    <span class="string">"u"</span>: <span class="string">"up"</span>,</span><br><span class="line">    <span class="string">"l"</span>: <span class="string">"left"</span>,</span><br><span class="line">    <span class="string">"r"</span>: <span class="string">"right"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dfs...</span></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">undefined</span> === <span class="keyword">this</span>.dfs) &#123;</span><br><span class="line">    <span class="keyword">this</span>.ans = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">this</span>.step = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> vis = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        vis.push([]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">100</span>; j++) vis[i].push(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dir = [</span><br><span class="line">        [ <span class="number">0</span>, -<span class="number">1</span>, <span class="string">"u"</span>, <span class="string">"#f00"</span> ],</span><br><span class="line">        [ <span class="number">0</span>, <span class="number">1</span>, <span class="string">"d"</span>, <span class="string">"#0f0"</span> ],</span><br><span class="line">        [ -<span class="number">1</span>, <span class="number">0</span>, <span class="string">"l"</span>, <span class="string">"#00f"</span> ],</span><br><span class="line">        [ <span class="number">1</span>, <span class="number">0</span>, <span class="string">"r"</span>, <span class="string">"#fff"</span> ]</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.dfs = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x === map.getWidth() - <span class="number">2</span> &amp;&amp; y === <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[y][x] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> newx = x + dir[i][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> newy = y + dir[i][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(newx &lt; <span class="number">0</span> || newy &lt; <span class="number">0</span> ||</span><br><span class="line">                newx &gt;= map.getWidth() ||</span><br><span class="line">                newy &gt;= map.getHeight() ||</span><br><span class="line">                vis[newy][newx] ||</span><br><span class="line">                map.getObjectTypeAt(newx, newy) === <span class="string">"block"</span></span><br><span class="line">                ) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> oldans = <span class="keyword">this</span>.ans;</span><br><span class="line">            <span class="keyword">this</span>.ans += dir[i][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">this</span>.dfs(newx, newy)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.ans = oldans;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                map.setSquareColor(x, y, dir[i][<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.dfs(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">this</span>.ans += <span class="string">"dd"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.step &gt;= <span class="keyword">this</span>.ans.length) <span class="keyword">return</span>;</span><br><span class="line">me.move(direct[<span class="keyword">this</span>.ans[<span class="keyword">this</span>.step++]]);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç´…é­”é¤¨çš„åœ°ä¸‹å®¤ä¸€æ¨£å‘¢ã€‚åæ­£æ˜¯æ©Ÿå™¨äººå¤šèµ°å¹¾æ­¥è·¯æ²’äº‹ï¼Œæ²’å¿…è¦ç”¨ BFS æ±‚æœ€å„ªè§£2333333333</p>
</blockquote>
<h2 id="Crisps_Contest">Crisps Contest</h2><p>ã€€ã€€å‰›çº”é‚£ä»¨ 2B æ©Ÿå™¨äººå¼•é ˜ä½ æ‹¿åˆ°äº†ä»¨é¡è‰²çš„é‘°åŒ™åœ¨é€™é‚Šæ´¾ä¸Šç”¨å ´äº†ã€‚</p>
<p>ã€€ã€€é‘½ç´…èŠèŠ±ä½ éœ€è¦æœ‰ç´…é‘°åŒ™ï¼Œä¸¦ä¸”ç”¨äº†ä¹‹å¾Œæœƒå°‘æ‰ã€‚å…¶å®ƒé¡è‰²ä¹Ÿä¸€æ¨£ã€‚æœ€çµ‚ä½ è¦æ‹¿åˆ° <code>A</code> æ‰€ä»£è¡¨çš„ <code>theAlgorithm</code> èµ°åˆ°å‡ºå£ã€‚</p>
<blockquote>
<p>ç­‰ç­‰ï¼å•Šå’§ï¼Ÿç¶ é‘°åŒ™çš„é€šéåˆ¤å®šæœ‰å€‹åœ°æ–¹å¯ä»¥ä¿®æ”¹ï¼Ÿå°±æ˜¯ä½ é€šéç¶ èŠèŠ±çš„æ™‚å€™éœ€è¦æœ‰ç¶ é‘°åŒ™ä¸¦ä¸”ä½ å¯ä»¥é¸æ“‡ä½ ä¸Ÿæ£„çš„æ±è¥¿ã€‚ä¸Ÿä»€éº¼å¥½å‘¢ï¼Ÿé›»è…¦ï¼Ÿä¸è¡Œä¸è¡Œï¼Œéé—œé‚„é å®ƒå‘¢ã€‚é›»è©±æ©Ÿï¼Ÿä»¥å¾Œè‚¯å®šè¦ç”¨åˆ°ã€‚å…¶å®ƒé¡è‰²é‘°åŒ™ï¼Ÿé‚£ä½ è‚¯å®šæœƒè¢«é–åœ¨æŸå€‹åœ°æ–¹å‡ºä¸ä¾†ã€‚é‚£å°±åªæœ‰ä¸Ÿæ£„ <code>theAlgorithm</code> äº†â€”â€”åæ­£åªè¦æ‹¿åˆ° <code>theAlgorithm</code> ä¹‹å¾Œä¸å†é€šéç¶ èŠèŠ±å°±æ²’äº‹äº†ã€‚</p>
</blockquote>
<p>ã€€ã€€æ–¼æ˜¯éš»è¦æŠŠç¶ èŠèŠ±çš„é€šéåˆ¤æ–·å‡½æ•¸è£é¢å¯ä¿®æ”¹çš„å€åŸŸæ”¹æˆ <code>theAlgorithm</code> å°±å¥½äº†ã€‚</p>
<p>ã€€ã€€æœ€å¾Œèµ°çš„é †åºå¤§æ¦‚æ˜¯ï¼š</p>
<blockquote>
<p>é€²å·¦ä¸Šè§’çš„é–€æ‹¿åˆ°<span style="color: yellow;">é»ƒè—¥å±</span>å’Œ<span style="color: blue;">è—è—¥å±</span>å‡ºä¾†ã€‚ç„¶å¾Œå³ä¸Šè§’æŠŠ<span style="color: red;"><strong>ç´…</strong></span>å’Œ<span style="color: blue;"><strong>è—</strong></span>æ‹¿å‡ºä¾†ã€‚ç„¶å¾Œå‘ä¸‹ç›´æ—é»ƒé¾ï¼Œå·¦é»ƒèŠèŠ±é€²æ‹¿åˆ° <code>theAlgorithm</code> è—èŠèŠ±é€šéæ‹¿åˆ°<span style="color: yellow;">é»ƒè—¥å±</span>ç„¶å¾Œå†é»ƒèŠèŠ±å‡ºã€‚</p>
<p>å¤§åŠŸå‘Šæˆï¼èµ°å‘å‹åˆ©çš„å‡ºå£å§ï¼</p>
<p><strong>è‡ªå¤ç´…è—å‡º CPï¼</strong></p>
</blockquote>
<h2 id="Exceptional_Crossing">Exceptional Crossing</h2><p>ã€€ã€€åˆæ˜¯éæ²³å•Šï¼Œé€™æ¬¡ä½ åªèƒ½æ˜¯æ­»äº†ï¼Œå› çˆ²ä½ çš„ç·¨è¼¯å€åŸŸåªæœ‰åœ¨ <code>player.killedBy()</code> è£é¢ã€‚</p>
<blockquote>
<p>ã€Šè¨‚è£½æ­»ç¥ã€‹ï¼šé€™å€‹æ™‚å€™è®“æ­»ç¥ç¬‘å°±å¯ä»¥äº†ã€‚</p>
</blockquote>
<p>ã€€ã€€è®“æˆ‘å€‘ä¸€èµ·ä¾†ç©å£å®ƒå§ï¼åœ¨è£é¢å¡«ä¸Š <code>) = (0</code> å°±å¥½äº†ã€‚ä»€éº¼ä»€éº¼çœ‹ä¸æ‡‚ï¼Ÿä½ å¡«é€²å»çœ‹ä¸€ä¸‹æ•´å¥è©±å°±çŸ¥é“äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">player.killedBy() = (<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œæ­»ç¥å°±æœƒè¢«ä½ ç©å£äº†ã€‚ä½ èµ°éå»çš„æ™‚å€™é€™å¥è©±åŸ·è¡Œå‡ºéŒ¯äº†2333333</p>
<h2 id="Lasers">Lasers</h2><p>ã€€ã€€æœ‰å¾ˆå¤šéš±è—ç·šï¼Œä½ äººå¿…é ˆè¦è·Ÿéš±è—ç·šçš„é¡è‰²ä¸€è‡´æ‰èƒ½é€šéï¼Œç„¶å¾Œç›®å‰æ‰€æœ‰ç·šéƒ½ç”¨ç™½è‰²çµ¦ç•«å‡ºä¾†ã€‚</p>
<p>ã€€ã€€ç›®æ¸¬ä½œè€…çš„æ„æ€æ˜¯è®“ä½ æŠŠç¡¬ç·¨ç¢¼çš„ç™½è‰²æ”¹æˆéš±è—ç·šçš„é¡è‰²ï¼Œé€™æ¨£å°±èƒ½æŠŠç·šçš„é¡è‰²çµ¦æ¨™è¨˜å‡ºä¾†ï¼Œç„¶å¾Œå†çµ¦é›»è©±æ©Ÿå¯«å€‹å‡½æ•¸å°±æ˜¯è®“ä½ è‡ªå·±çš„äººè®Šè‰²ã€‚</p>
<p>ã€€ã€€ä¸éæˆ‘é‚„æ˜¯ç”¨äº†å€‹ Hack çš„æ–¹æ³•â€”â€”</p>
<p>ã€€ã€€ç¬¬ä¸€æ¢ç·šä»–è¦ç•«å°±ç•«ï¼Œå’±ä¸ç¢°å®ƒå°±å¥½äº†ï¼Œåªä¸éåœ¨ç¬¬ä¸€æ¢ç·šç•«å®Œçš„å¾Œé¢æˆ‘å€‘æŠŠé€™å€‹ç•«ç·šå‡½æ•¸çµ¦ Hack æ‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// using canvas to draw the line</span></span><br><span class="line"><span class="keyword">var</span> ctx = map.getCanvasContext();</span><br><span class="line">ctx.beginPath();</span><br><span class="line">ctx.strokeStyle = <span class="string">'white'</span>;</span><br><span class="line">ctx.lineWidth = <span class="number">5</span>;</span><br><span class="line">ctx.moveTo(x1, y1);</span><br><span class="line">ctx.lineTo(x2, y2);</span><br><span class="line">ctx.stroke();</span><br><span class="line"></span><br><span class="line">createLaser = abc;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ¥ä¸‹å»æ˜¯åœ¨ç¬¬äºŒç‰‡å€åŸŸå¯«ä¸‹è‡ªå·±çš„ç•«ç·šå‡½æ•¸å§ï¼Œé€™é¡Œæœ€ä¸‹æ–¹æª¢æ¸¬äº†ç·šçš„æ•¸é‡ä¸èƒ½å°‘æ–¼ 25 æ¢ã€‚éº¼äº‹ï¼Œçˆºé«˜èˆˆç•« 100 æ¢éƒ½éº¼å•é¡Œï¼Œå› çˆ²æˆ‘éƒ½æŠŠå®ƒç¸®åœ¨å·¦ä¸Šè§’äº† 2333333</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">abc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">25</span>; i++) &#123;</span><br><span class="line">        map.createLine([<span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>], <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//... Ahahaha</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> ctx = map.getCanvasContext();</span><br><span class="line">        ctx.beginPath();</span><br><span class="line">        ctx.strokeStyle = <span class="string">'red'</span>;</span><br><span class="line">        ctx.lineWidth = <span class="number">5</span>;</span><br><span class="line">        ctx.moveTo(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        ctx.lineTo(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">        ctx.stroke();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Pointers">Pointers</h2><p>ã€€ã€€æœ‰å¥½å¤šå‚³é€é–€ï¼Œæ¯æ¬¡åŸ·è¡Œéš¨æ©Ÿç”Ÿæˆå‚³é€ä½ç½®ï¼Œæœ‰äº›å‚³é€é–€æœƒæŠŠä½ å‚³åˆ°äºŒå°å§çš„åœ°ä¸‹å®¤ç„¶å¾Œè¢«åƒæ‰ã€‚</p>
<p>ã€€ã€€æˆ‘ä¹Ÿæ‡¶å¾—å¤šå‹•è…¦ç­‹æˆ–è€…ç•«ç·šä»€éº¼çš„ï¼Œç›´æ¥å°å…©å€‹éƒ½æ˜¯å‚³é€é–€çš„ CP æ¨™è¨˜ä¸€æ¨£çš„éš¨æ©Ÿé¡è‰²å°±å¥½äº†ï¼Œæœ€å¾Œè·Ÿç€é¡è‰²èµ°åˆ°å‡ºå£å»ï¼ˆæœ‰å€‹å‘å°±æ˜¯æœ‰æ™‚å€™é€™å€‹åœ°åœ–æœ¬èº«å°±æ˜¯æ­»å±€ï¼Œæ‰€ä»¥å¾—å¤šè©¦å¹¾æ¬¡é‡æ–°åŸ·è¡Œ à®‡Ğ´à®‡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dict = <span class="string">"0123456789ABCDEF"</span>;</span><br><span class="line"><span class="keyword">if</span>(t1.getType() === <span class="string">"teleporter"</span> &amp;&amp; t2.getType() === <span class="string">"teleporter"</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> color = <span class="string">"#"</span> + dict[<span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">15</span>)] +</span><br><span class="line">        dict[<span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">15</span>)] +</span><br><span class="line">        dict[<span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">15</span>)];</span><br><span class="line"></span><br><span class="line">    map.setSquareColor(t1.getX(), t1.getY(), color);</span><br><span class="line">    map.setSquareColor(t2.getX(), t2.getY(), color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Super_Dr-_Eval_Bros">Super Dr. Eval Bros</h2><p>ã€€ã€€å¥½å§æœ¬æ„æ˜¯è®“ä½ è¨­ç½®ä¸€å€‹ <code>timer</code> ç„¶å¾Œä¸€ç›´è·³å•Šè·³çš„ã€‚</p>
<p>ã€€ã€€ä¸éå‘¢ï¼Œå®šä¸€å€‹æ–°æ–¹å¡Šçµ¦è‡ªå·±æ­ä¸€åº§æ©‹å°±æ˜¯äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">map.defineObject(<span class="string">"â¤"</span>, &#123;</span><br><span class="line">    impassable: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    symbol: <span class="string">"â¤"</span></span><br><span class="line">&#125;);</span><br><span class="line">map.placeObject(<span class="number">20</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">21</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">22</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">23</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">24</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">25</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">26</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">27</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">28</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">29</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½ åªè¦æ‰“å€‹é›»è©±æ©‹å°±æœƒå‡ºç¾çš„ã€‚</p>
</blockquote>
<h2 id="Document_Object_Madness">Document Object Madness</h2><p>ã€€ã€€å¥½ç¥å¥‡ï¼å¥½å¥‡è‘©ï¼æˆ‘éµç›¤ <code>hjkl</code> äº‚æŒ‰ä¸€é€šå°±éäº†ã€‚</p>
<h2 id="Boss_Fight">Boss Fight</h2><p>ã€€ã€€æ‰“ Boss äº†ã€‚</p>
<p>ã€€ã€€å¥½å§æˆ‘æ‰¿èªæˆ‘ Cheat äº†â€”â€”åŸè«’æˆ‘ç”¨äº† <code>console.log</code>ã€‚</p>
<blockquote>
<p>å› çˆ²ç•¶æˆ‘æ‰“é–‹æ§åˆ¶æª¯çš„æ™‚å€™ä¸‹é¢çš„èªå¥å‡ºç¾åœ¨æˆ‘çš„çœ¼è£ï¼š</p>
<blockquote>
<p><strong><em>If you can read this, you are cheating!</em></strong></p>
<p><strong><em>But really, you donâ€™t need this console to play the game. Walk around using arrow keys (or Vim keys), and pick up the computer (âŒ˜). Then the fun begins!</em></strong></p>
</blockquote>
</blockquote>
<p>ã€€ã€€å˜›å˜›ï¼Œç„¡è«–å¦‚ä½•ï¼Œéé—œäº†å°±å¥½ã€‚</p>
<p>ã€€ã€€é€™é¡Œå‘¢æ˜¯è¦è®“æ‰€æœ‰çš„ <code>boss</code> çµ¦æ¯€æ»…æ‰å³å¯â€”â€” ç•¶æ‰€æœ‰çš„ <code>boss</code> æ¯€æ»…ä¹‹å¾Œæœƒçˆ†å‡ºä»»å‹™é“å…· <code>theAlgorithm</code> ç„¶å¾Œå°±èƒ½é€šé—œäº†ã€‚</p>
<p>ã€€ã€€å¾Œä¾†æˆ‘ç™¼ç¾å¯ä»¥è®“å­å½ˆæ¶ˆæ»… <code>boss</code>ã€‚ä½†æ˜¯æˆ‘ç•¶æ™‚æ²’é€™éº¼åšã€‚</p>
<p>ã€€ã€€æˆ‘å…ˆå¼„äº†å µç‰†æŠŠå­å½ˆæ“‹ä½å…ˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">map.defineObject(<span class="string">"ä¿å‘½çš„"</span>, &#123;</span><br><span class="line">    impassable: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    symbol: <span class="string">"â¤"</span>,</span><br><span class="line">    onCollision: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; map.getWidth(); i++) &#123;</span><br><span class="line">    map.placeObject(i, <span class="number">9</span>, <span class="string">"ä¿å‘½çš„"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™ä¸‹ä½ å°±èƒ½æ’¿åˆ°é›»è©±æ©Ÿäº†â€”â€”ç„¶å¾Œçµ¦é›»è©±æ©Ÿå¯«å›èª¿å‡½æ•¸ã€‚</p>
<p>ã€€ã€€æ€éº¼èªªå‘¢ï¼Œç•¶ä½ æ¯ç”¨ä¸€æ¬¡é›»è©±æ©Ÿï¼Œæˆ‘å°±æŠŠç•¶å‰å­˜åœ¨æ–¼å±å¹•çš„ <code>boss</code> å’Œ <code>bullet</code> çµ¦åˆ†é–‹ç¾…åˆ—ï¼Œç„¶å¾ŒæŠŠ <code>boss</code> çš„ <code>_destroy</code>ï¼ˆè­¦å¯Ÿå”å”ï¼Œå°±æ˜¯é€™å€‹å‡½æ•¸æ˜¯æˆ‘ <code>console.log</code> å‡ºä¾†çš„ï¼‰çµ¦å«æ¥åˆ° <code>bullet</code> çš„ <code>_destroy</code> å»ã€‚</p>
<p>ã€€ã€€é€™æ¨£æœƒå‡ºç¾ä»€éº¼æ¨£çš„çµæœå‘¢ï¼Ÿâ€”â€”ç•¶å­å½ˆç¢°åˆ°ç‰†çš„æ™‚å€™å°±æœƒéŠ·ç‡¬ï¼Œé€™å€‹æ™‚å€™æœƒè§¸ç™¼ <code>_destroy</code> å‡½æ•¸ï¼Œä½†æ˜¯é€™å€‹æ™‚å€™çš„ <code>_destroy</code> å‡½æ•¸å·²ç¶“æœƒè®Šæˆäº† <code>boss</code> çš„äº†ï¼Œä¹Ÿå°±æ˜¯èªªé€™å€‹æ™‚å€™å­å½ˆä¸æœƒè¢«éŠ·ç‡¬åè€Œæ˜¯æŸä¸€å€‹ <code>boss</code> çš„ <code>_destroy</code> å‡½æ•¸è¢«èª¿ç”¨ç„¶å¾Œè¢«éŠ·æ¯€äº†ã€‚</p>
<p>ã€€ã€€å†æ€éº¼èªªé€™éƒ½æ˜¯ Hack çš„è¾¦æ³•ï¼Œæ‰€ä»¥ä¸¦ä¸æœƒè§¸ç™¼ <code>boss</code> çš„ <code>onDestroy</code> å‡½æ•¸ä¹Ÿå°±æ˜¯èªªå³ä½¿æ‰€æœ‰ <code>boss</code> éƒ½æ²’äº†ä¹Ÿä¸æœƒå‡ºç¾ <code>theAlgorithm</code> é€™ç©æ„å…’ã€‚</p>
<blockquote>
<p>è‡ªå·±å‹•æ‰‹è±è¡£è¶³é£Ÿï¼</p>
</blockquote>
<p>ã€€ã€€æ•µäººä¸çµ¦æˆ‘å€‘æˆ‘å€‘å°±è‡ªå·±é€ å”„ï¼åæ­£é€šé—œåˆ¤å®šæ˜¯â€”â€”<code>boss</code> æ•¸é‡çˆ² <code>0</code> ä¸”ä½ æœ‰ <code>theAlgorithm</code> é€™å€‹é“å…·ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥èªªç•¶æ‰€æœ‰ <code>boss</code> éƒ½è¢«éŠ·ç‡¬ä¹‹å¾Œï¼Œæˆ‘å€‘è‡ªå·±å» <code>map.replaceObject</code> ä¸€å€‹ <code>theAlgorithm</code> é“å…·å³å¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">map.getPlayer().setPhoneCallback(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bosses = [];</span><br><span class="line">    <span class="keyword">var</span> bullets = [];</span><br><span class="line">    <span class="keyword">var</span> objects = map.getDynamicObjects();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; objects.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(objects[i].getType() == <span class="string">"boss"</span>) &#123;</span><br><span class="line">            bosses.push(objects[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            bullets.push(objects[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">Math</span>.min(bosses.length, bullets.length); i++) &#123;</span><br><span class="line">        bullets[i]._destroy = bosses[i]._destroy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(bosses.length === <span class="number">0</span>) &#123;</span><br><span class="line">        map.placeObject(map.getPlayer().getX(), map.getPlayer().getY() + <span class="number">1</span>,</span><br><span class="line">            <span class="string">'theAlgorithm'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä»¥ä¸Šä»£ç¢¼å¯«å®Œå¾Œå°±é–‹å§‹æ‰“ <code>boss</code> å§ï¼è¶•ç·Šå»æ‹¿åˆ°é›»è©±æ©Ÿï¼Œç„¶å¾Œä½ æœƒç™¼ç¾æ‰“ä¸€å€‹é›»è©± <code>boss</code> å°±å°‘ä¸€å †ï¼Œé‚£æ„Ÿè¦ºå€çˆ½å…’ï¼</p>
<h2 id="End_of_the_Line">End of the Line</h2><p>ã€€ã€€é¦¬ä¸Šè¦é€šé—œäº†ã€‚é€™è£æ˜¯å€‹å‘ï¼Œé–‹å§‹æˆ‘é‚„ä»¥çˆ²é€™è£å°±æ˜¯çœŸÂ·é€šé—œäº† QAQã€‚</p>
<p>ã€€ã€€éš¨å¾Œçœ‹çœ‹å¾Œé¢é‚„æ˜¯æœ‰é—œå¡å•Šã€‚ä½†æ˜¯æˆ‘çªç„¶ç™¼ç¾ <code>&lt;ctrl+0&gt;</code> è·³å‡ºä¾†çš„ menu å·¦é‚Šå¤šå‡ºäº†æ–‡ä»¶å¤¾ï¼ç„¶å¾Œé€²å»éš¨æ„ç¿»çœ‹äº†ã€‚</p>
<p>ã€€ã€€æœ€å¾Œç™¼ç¾åŸä¾†æ˜¯è¦ä¿®æ”¹ <code>scripts/objects.js</code> æ–‡ä»¶â†’ï¼¿â†’ã€‚</p>
<p>ã€€ã€€å¥½å§ï¼Œåˆ†æé€šé—œé©—è­‰ä¾†çœ‹ï¼Œé€™ä¸€é—œçš„ <code>map.finalLevel</code> çˆ² <code>true</code>ã€‚æ‰€ä»¥æˆ‘å€‘åªéœ€è¦æŠŠ <code>scripts/objects.js</code> æ–‡ä»¶è£é¢çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!game.map.finalLevel) &#123;</span><br><span class="line">    game._moveToNextLevel();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çµ¦æ”¹æˆå¦‚æœæ˜¯ <code>finalLevel</code> å°±è·‘åˆ°ä¸‹ä¸€é—œå»å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(game.map.finalLevel) &#123;</span><br><span class="line">    game._moveToNextLevel();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Credits">Credits</h2><p>ã€€ã€€ç”±æ–¼äº‹å…ˆæ–‡ç« çµæ§‹æ²’æœ‰å¯«å¥½ï¼Œå°±æ¥é€™é—œçš„å‘ä½ä¾†å°çµå§ 0. 0ã€‚ï¼ˆåæ­£äººå®¶åªæ˜¯åºå¹•ç« äº†</p>
<p>ã€€ã€€å¥½çš„ï¼Œå…¶å¯¦ä¹Ÿä»€éº¼ç¸½çµçš„ï¼Œä½†æ˜¯ç¸½è¦ºå¾—å¾—æœ‰é€™éº¼å€‹å°çµçº”å°ã€‚</p>
<p>ã€€ã€€æ‰¾å·¥ä½œå•Šæ‰¾å·¥ä½œâ€”â€”æœ‰æƒ³è¦æˆ‘çš„è«‹è¯ç¹«æˆ‘ 2333333333</p>
<p>ã€€ã€€è¯ç¹«è³‡æ–™åœ¨ <a href="http://xcoder.in/curriculumvitae/">CV</a> è£é¢ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€<a href="http://alexnisnevich.github.io/untrusted/" target="_blank" rel="external">Trusted</a> æ˜¯ä¸€å€‹ä»£ç¢¼è§£è¬éŠæˆ²ï¼Œç”¨ Javascript ä¾†éé—œçš„ã€‚</p>
<p>ã€€ã€€æ˜¨å¤©]]>
    </summary>
    
      <category term="Javascript" scheme="http://xcoder.in/tags/Javascript/"/>
    
      <category term="untrusted" scheme="http://xcoder.in/tags/untrusted/"/>
    
      <category term="éŠæˆ²" scheme="http://xcoder.in/tags/%E9%81%8A%E6%88%B2/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Cocos2d-x 3.1.1 é–‹ç™¼ç’°å¢ƒæ­å»ºï¼ˆWinç¯‡ï¼‰]]></title>
    <link href="http://xcoder.in/2014/06/07/cocos2d-311-setup/"/>
    <id>http://xcoder.in/2014/06/07/cocos2d-311-setup/</id>
    <published>2014-06-07T11:34:02.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€ç”±æ–¼å·æ‡¶ï¼Œæ‰€ä»¥åœ¨æ­¤æ„Ÿè¬ Etond çš„æŒ‡å°ï¼ˆå–‚å–‚å–‚ï¼Œæ˜æ˜æ˜¯è‡ªå·±æ‡¶å¾—çœ‹æ–‡æª”ï¼Œæ˜æ˜ <a href="README"><code>READEME.md</code></a> è£é¢å°±æœ‰ï¼(Â´â‰–â—à±ªâ—Ÿâ‰–)</p>
<p>ã€€ã€€å¦ï¼Œåœ¨æ­å»ºç’°å¢ƒçš„æ™‚å€™ï¼Œæœ€å¥½ä¿è­‰ä½ åœ¨<span style="background: #222;">ç‰†å¤–</span>ã€‚ä»¥åŠæˆ‘é»˜èªè¦ºå¾—å¤§å®¶å·²ç¶“æœ‰äº† <code>Python</code> ç’°å¢ƒå’Œ <code>JDK</code>ã€‚</p>
<h2 id="å‰é©…å·¥ä½œ">å‰é©…å·¥ä½œ</h2><p>ã€€ã€€å…ˆå» <a href="http://www.cocos2d-x.org/download" target="_blank" rel="external">cocos2d-x å®˜ç¶²</a>ä¸‹å£“ç¸®åŒ…ï¼Œæ”¾åˆ°ä¸€å€‹åªæœ‰ç¥çŸ¥é“çš„ä¸–ç•Œè£é¢ã€‚</p>
<p>ã€€ã€€æ¥ä¸‹å»éœ€è¦å®‰è£ä»¨æ±è¥¿ï¼š</p>
<h3 id="Android_SDK">Android SDK</h3><p>ã€€ã€€<a href="http://developer.android.com/sdk/index.html#download" target="_blank" rel="external">é€™æ±è¥¿</a>çœŸå°¼ç‘ªå¤§å•Šï¼æˆ‘å®¶çš„å°æ°´ç®¡çœŸåƒä¸èµ·ã€‚</p>
<p>ã€€ã€€ç„¶å¾ŒæŠŠ <strong>adt-bundle-â€¦zip</strong> é€™å€‹åŒ…å£“ç¸®åˆ°ä»»æ„æœ¨æœ‰ä¸­æ–‡å’Œç©ºæ ¼çš„è·¯å¾‘ä¸‹é¢ã€‚</p>
<h3 id="NDK">NDK</h3><p>ã€€ã€€<a href="http://developer.android.com/tools/sdk/ndk/index.html#download" target="_blank" rel="external">é€™å°å¤¥ä¼´</a>ä¹Ÿä¸å°å•Šã€‚éƒ½æ˜¯ 500M çš„ä¸»å…’å•Šï¼ˆÙ©(Åï¹Åã€)Û¶</p>
<p>ã€€ã€€ä¹Ÿè§£å£“åˆ°ä¸€å€‹åœ°æ–¹ä¸ç”¨ç®¡å®ƒã€‚</p>
<h3 id="Ant">Ant</h3><p>ã€€ã€€æ“šèªªé€™è²¨æ˜¯é˜¿å¸•å¥‡å‡ºçš„ï¼Ÿç¸½ä¹‹ä¸‹è¼‰åœ°å€åœ¨<a href="http://ant.apache.org/bindownload.cgi" target="_blank" rel="external">é€™è£</a>ã€‚</p>
<h2 id="å®‰è£">å®‰è£</h2><p>ã€€ã€€å“¦å°äº†ä½ é‚„å¾—æœ‰å€‹ Python è·¯å¾‘ï¼Œé€™è£å°±ä¸ç´¯è¿°äº†ã€‚æ¥ä¸‹å»åœ¨å‘½ä»¤è¡Œè£é¢åŸ·è¡Œ Cocos2d çš„ <code>setup.py</code> æ–‡ä»¶å³å¯ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&#62; py setup.py</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ¥ä¸‹å»çµ‚ç«¯æœƒåœåœ¨ä¸‹é¢ä¸€è¡Œï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please enter the path of NDK_ROOT (or press Enter to skip):</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€åœ¨å¾Œé¢è¼¸å…¥ä½ æ”¾å¥½çš„ NDK ç›®éŒ„å³å¯ã€‚</p>
<p>ã€€ã€€å¦‚æœä¸‹é¢åˆå‡ºç¾äº†ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please enter the path of ANDROID_SDK_ROOT (or press Enter to skip):</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä½ åªéœ€åœ¨è£é¢è¼¸å…¥ä½ å‰›æ”¾å¥½çš„ Android SDK çš„ç›®éŒ„å³å¯ã€‚ï¼ˆæ³¨æ„æ˜¯è¦å‰›çº”çš„ SDK å£“ç¸®åŒ…è§£å£“å‡ºä¾†çš„ sdk è·¯å¾‘ï¼‰</p>
<p>ã€€ã€€å†å¦‚æœä¸‹é¢é‚„å‡ºç¾ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please enter the path of ANT_ROOT (or press Enter to skip):</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é‚£éº¼å†æŠŠ Ant çš„è·¯å¾‘æä¸Šå»å°±å¥½äº†ã€‚ï¼ˆåˆå¾—æ³¨æ„é€™è£å¾—æ˜¯ Ant çš„ bin ç›®éŒ„ï¼‰</p>
<p>ã€€ã€€æœ€å¾Œç¢ºä¿çµ‚ç«¯ï¼ˆæˆ–è€…èªªå‘½ä»¤è¡Œï¼‰è£é¢å‡ºç¾å¦‚ä¸‹å­—æ¨£ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please restart the terminal or restart computer to make added system variables take effect</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œä½ æŠŠçµ‚ç«¯é—œäº†å†é–‹ä¸€å€‹å°±å¥½äº†ã€‚è‡³æ­¤ï¼Œå¤§è‡´å°±å®‰è£å®Œç•¢äº†ã€‚</p>
<h2 id="æ–°å»ºä¸€å€‹_Demo_é …ç›®">æ–°å»ºä¸€å€‹ Demo é …ç›®</h2><p>ã€€ã€€éš¨æ„è·‘åˆ°ä¸€å€‹ç›®éŒ„ä¸‹é¢åŸ·è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&#62; cocos new FirstGame -p in.xcoder.firstgame -l cpp -d FirstGame</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¤§è‡´æ„æ€å°±æ˜¯èªªå‰µå»ºä¸€å€‹æ–°çš„é …ç›®è·¯å¾‘ï¼Œå« <code>FirstGame</code>ï¼Œå…¶åŒ…åå« <code>in.xcoder.firstgame</code>ï¼Œç„¶å¾Œèªè¨€æ˜¯ <code>cpp</code>ï¼Œæœ€å¾Œ <code>-d</code> æ˜¯è·¯å¾‘ã€‚</p>
</blockquote>
<p>ã€€ã€€å‘½ä»¤è©³æƒ…å¹«åŠ©å¯ä»¥çœ‹ <code>cocos --help</code>ã€‚</p>
<h3 id="ç·¨è­¯_Demo">ç·¨è­¯ Demo</h3><p>ã€€ã€€è®€æ¨™é¡Œï¼Œæ˜¯ Win ç¯‡ã€‚æ‰€ä»¥æˆ‘å€‘è·‘åˆ°é …ç›®è·¯å¾‘ä¸‹é¢çš„ <code>proj.win32</code> ç›®éŒ„ä¸‹é¢ç”¨ M$ VS æ‰“é–‹ <code>FirstGame.sln</code> å°±å¯ä»¥æ‰“é–‹å‰›å‰µå»ºçš„æ¨¡æ¿é …ç›®äº†ã€‚</p>
<p>ã€€ã€€ç„¡è«–å¦‚ä½•å…ˆç·¨è­¯çœ‹çœ‹å§ï¼ï½</p>
<p>ã€€ã€€å¦‚ä½•ï¼Ÿè·‘èµ·ä¾†äº†å§ï¼Ÿ</p>
<h3 id="æ‰“åŒ…_Demo">æ‰“åŒ… Demo</h3><p>ã€€ã€€é€™è£å°±è¬›è¬›å¦‚ä½•æ‰“åŒ…å®‰å“çš„ç‰ˆæœ¬å§ï¼š</p>
<h4 id="Debug_ç‰ˆæœ¬">Debug ç‰ˆæœ¬</h4><p>ã€€ã€€è·‘åˆ°ä½ çš„é …ç›®ç›®éŒ„ä¸‹é¢ï¼ˆå³æœ‰ <code>.cocos-project.json</code> æ–‡ä»¶çš„ç›®éŒ„ï¼‰ï¼Œç„¶å¾ŒåŸ·è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&#62; cocos run -p android</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç­‰å·¥å…·ç·¨è­¯æ‰“åŒ…å®Œæˆå°± OK äº†ã€‚ï¼ˆè¨˜å¾—è¦æŸ¥å®‰å“æ‰‹æ©Ÿä¸¦ä¸”èª¿è©¦æ¨¡å¼å“¦ï½ï¼‰</p>
<h4 id="Release_ç‰ˆæœ¬">Release ç‰ˆæœ¬</h4><p>ã€€ã€€å¦‚æœè¦ä¸Šå‚³åˆ° Google Play ä¹‹é¡çš„åœ°æ–¹ï¼Œéœ€è¦æœ‰ç°½åã€‚æ‰€ä»¥ç™¼ä½ˆ Release ç‰ˆæœ¬ä¹‹å‰ï¼Œä½ å…ˆå¾—æå¥½è‡ªå·±çš„ç°½åã€‚</p>
<h5 id="Keytool">Keytool</h5><p>ã€€ã€€åœ¨çµ‚ç«¯è·‘åˆ°ä½ çš„é …ç›®è·¯å¾‘ä¸‹é¢ï¼Œç„¶å¾ŒåŸ·è¡Œï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&#62; keytool -genkey -v -keystore FirstGame.keystore -alias FirstGame -keyalg RSA -keysize 2048 -validaty 10000</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç…§ç€å‘½ä»¤è¡Œçµ¦çš„æç¤ºå®Œæˆå‰µå»ºå¯†é‘°å³å¯ã€‚</p>
<h5 id="ç·¨è­¯">ç·¨è­¯</h5><p>ã€€ã€€ç”Ÿæˆä¹‹å¾Œå•Šå°±ç›´æ¥åŸ·è¡Œç·¨è­¯å‘½ä»¤äº†ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&#62; cocos run -p android -m release</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€åœ¨è£é¢å‘¢æœ€å¾Œæœƒè®“ä½ è¼¸å…¥ <code>.keystore</code> æ–‡ä»¶çš„è·¯å¾‘ã€‚</p>
<p>ã€€ã€€æˆ‘å€‘è¼¸å…¥ç›¸å°è·¯å¾‘ï¼Œç”±æ–¼æˆ‘å€‘å‰›çº”æŠŠé€™å€‹æ–‡ä»¶æåœ¨é …ç›®æ ¹ç›®éŒ„ï¼Œæ‰€ä»¥æˆ‘å€‘åªéœ€è¦è¼¸å…¥ <code>../FirstGame.keystore</code> å³å¯ã€‚æ¥ä¸‹å»ä»–æœƒè®“ä½ è¼¸å…¥å¯†ç¢¼ã€åˆ¥åå’Œåˆ¥åä¿¡æ¯çš„å¯†ç¢¼ã€‚ä½ éƒ½æ­£ç¢ºè¼¸å…¥ä¸€éä»–å°±æœƒå®‰å®‰åˆ†åˆ†è·‘åœ¨ä½ çš„æ‰‹æ©Ÿè£é¢äº†ã€‚</p>
<h4 id="ä»¨ç‰ˆæœ¬çš„æ–‡ä»¶è·¯å¾‘">ä»¨ç‰ˆæœ¬çš„æ–‡ä»¶è·¯å¾‘</h4><p>ã€€ã€€ä¸Šé¢éƒ½å¼„å¥½ä¹‹å¾Œï¼Œä½ çš„ä»¨ç‰ˆæœ¬ <code>*.apk</code> æ–‡ä»¶ä¹Ÿå°±ç”Ÿæˆäº†ã€‚å¾ˆå¤šäººå¯èƒ½å¾ˆå›°æƒ‘ï¼Œçˆ²ä»€éº¼æ˜¯ä»¨ç‰ˆæœ¬ã€‚å› çˆ²å…¶ä¸­ Release ç‰ˆæœ¬é‚„åˆ†å¸¶ç°½åå’Œæ²’ç°½åç‰ˆæœ¬ã€‚</p>
<p>ã€€ã€€ç¸½ä¹‹é‚£å€‹è·¯å¾‘åœ¨ <code>publish/android</code> ä¸‹é¢ï¼Œè£é¢æœ‰ä»¨ <code>*.apk</code> æ–‡ä»¶ï¼Œä½ æ‹¿å‡ºä¾†ç™¼ä½ˆå°±å¯ä»¥äº†ã€‚</p>
<h2 id="å°çµ">å°çµ</h2><p>ã€€ã€€å…¶å¯¦ä¹Ÿæ²’ä»€éº¼çµä¸çµçš„ï¼Œé€™äº›æ±è¥¿ä½ å€‘è‡ªå·±å»çœ‹çœ‹å®˜æ–¹æ–‡æª”å°±å¥½äº†ã€‚ç¸½ä¹‹å°±é€™æ¨£äº†å§ï¼Œä»¥ä¸Šã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€ç”±æ–¼å·æ‡¶ï¼Œæ‰€ä»¥åœ¨æ­¤æ„Ÿè¬ Etond çš„æŒ‡å°ï¼ˆå–‚å–‚å–‚ï¼Œæ˜æ˜æ˜¯è‡ªå·±æ‡¶å¾—çœ‹æ–‡æª”ï¼Œæ˜æ˜ <a href="README"><code>READEME.md</code></a> è£é¢å°±æœ‰ï¼(Â´â‰–â—à±ªâ—Ÿâ‰–)</p>
<p>ã€€ã€€å¦ï¼Œåœ¨æ­å»ºç’°å¢ƒçš„æ™‚å€™ï¼Œæœ€å¥½ä¿è­‰ä½ åœ¨<span styl]]>
    </summary>
    
      <category term="cocos2d" scheme="http://xcoder.in/tags/cocos2d/"/>
    
      <category term="éŠæˆ²é–‹ç™¼" scheme="http://xcoder.in/categories/%E9%81%8A%E6%88%B2%E9%96%8B%E7%99%BC/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ã€è½‰ã€‘TCP çš„é‚£äº›äº‹å…’ï¼ˆä¸Šï¼‰]]></title>
    <link href="http://xcoder.in/2014/06/07/tcp-those-things-1/"/>
    <id>http://xcoder.in/2014/06/07/tcp-those-things-1/</id>
    <published>2014-06-06T17:47:10.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€TCPæ˜¯ä¸€å€‹å·¨è¤‡é›œçš„å”è­°ï¼Œå› çˆ²ä»–è¦è§£æ±ºå¾ˆå¤šå•é¡Œï¼Œè€Œé€™äº›å•é¡Œåˆå¸¶å‡ºäº†å¾ˆå¤šå­å•é¡Œå’Œé™°æš—é¢ã€‚æ‰€ä»¥å­¸ç¿’ TCP æœ¬èº«æ˜¯å€‹æ¯”è¼ƒç—›è‹¦çš„éç¨‹ï¼Œä½†å°æ–¼å­¸ç¿’çš„éç¨‹å»èƒ½è®“äººæœ‰å¾ˆå¤šæ”¶ç©«ã€‚é—œæ–¼ TCP é€™å€‹å”è­°çš„ç´°ç¯€ï¼Œæˆ‘é‚„æ˜¯æ¨è–¦ä½ å»çœ‹ <a href="http://www.kohala.com/start/" target="_blank" rel="external">W.Richard Stevens</a> çš„ã€Š<a href="http://book.douban.com/subject/1088054/" target="_blank" rel="external">TCP/IP è©³è§£ å·1ï¼šå”è­°</a>ã€‹ï¼ˆç•¶ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å»è®€ä¸€ä¸‹ <a href="http://tools.ietf.org/html/rfc793" target="_blank" rel="external">RFC793</a> ä»¥åŠå¾Œé¢ N å¤šçš„ RFCï¼‰ã€‚å¦å¤–ï¼Œæœ¬æ–‡æˆ‘æœƒä½¿ç”¨è‹±æ–‡è¡“èªï¼Œé€™æ¨£æ–¹ä¾¿ä½ é€šéé€™äº›è‹±æ–‡é—œéµè©ä¾†æŸ¥æ‰¾ç›¸é—œçš„æŠ€è¡“æ–‡æª”ã€‚</p>
<p>ã€€ã€€ä¹‹æ‰€ä»¥æƒ³å¯«é€™ç¯‡æ–‡ç« ï¼Œç›®çš„æœ‰ä¸‰å€‹ï¼Œ</p>
<ul>
<li>ä¸€å€‹æ˜¯æƒ³é›éŠä¸€ä¸‹è‡ªå·±æ˜¯å¦å¯ä»¥ç”¨ç°¡å–®çš„ç¯‡å¹…æŠŠé€™éº¼è¤‡é›œçš„TCPå”è­°ææ¸…æ¥šçš„èƒ½åŠ›ã€‚</li>
<li>å¦ä¸€å€‹æ˜¯è¦ºå¾—ç¾åœ¨çš„å¥½å¤šç¨‹åºå“¡åŸºæœ¬ä¸Šä¸æœƒèªèªçœŸçœŸåœ°è®€æœ¬æ›¸ï¼Œå–œæ­¡å¿«é¤æ–‡åŒ–ï¼Œæ‰€ä»¥ï¼Œå¸Œæœ›é€™ç¯‡å¿«é¤æ–‡ç« å¯ä»¥è®“ä½ å°TCPé€™å€‹å¤å…¸æŠ€è¡“æœ‰æ‰€ç­è§£ï¼Œä¸¦èƒ½é«”æœƒåˆ°è»Ÿä»¶è¨­è¨ˆä¸­çš„ç¨®ç¨®é›£è™•ã€‚ä¸¦ä¸”ä½ å¯ä»¥å¾ä¸­æœ‰ä¸€äº›è»Ÿä»¶è¨­è¨ˆä¸Šçš„æ”¶ç©«ã€‚</li>
<li>æœ€é‡è¦çš„å¸Œæœ›é€™äº›åŸºç¤çŸ¥è­˜å¯ä»¥è®“ä½ ææ¸…å¾ˆå¤šä»¥å‰ä¸€äº›ä¼¼æ˜¯è€Œéçš„æ±è¥¿ï¼Œä¸¦ä¸”ä½ èƒ½æ„è­˜åˆ°åŸºç¤çš„é‡è¦ã€‚</li>
</ul>
<p>ã€€ã€€æ‰€ä»¥ï¼Œæœ¬æ–‡ä¸æœƒé¢é¢ä¿±åˆ°ï¼Œåªæ˜¯å° TCP å”è­°ã€ç®—æ³•å’ŒåŸç†çš„ç§‘æ™®ã€‚</p>
<p>ã€€ã€€æˆ‘æœ¬ä¾†åªæƒ³å¯«ä¸€å€‹ç¯‡å¹…çš„æ–‡ç« çš„ï¼Œä½†æ˜¯ TCP çœŸ TMD çš„è¤‡é›œï¼Œæ¯” C++ è¤‡é›œå¤šäº†ï¼Œé€™ 30 å¤šå¹´ä¾†ï¼Œå„ç¨®å„ªåŒ–è®Šç¨®çˆ­è«–å’Œä¿®æ”¹ã€‚æ‰€ä»¥ï¼Œå¯«ç€å¯«ç€å°±ç™¼ç¾åªæœ‰ç æˆå…©ç¯‡ã€‚</p>
<ul>
<li>ä¸Šç¯‡ä¸­ï¼Œä¸»è¦å‘ä½ ä»‹ç´¹TCPå”è­°çš„å®šç¾©å’Œä¸ŸåŒ…æ™‚çš„é‡å‚³æ©Ÿåˆ¶ã€‚</li>
<li>ä¸‹ç¯‡ä¸­ï¼Œé‡é»ä»‹ç´¹TCPçš„æµè¿­ã€æ“å¡è™•ç†ã€‚</li>
</ul>
<p>ã€€ã€€å»¢è©±å°‘èªªï¼Œé¦–å…ˆï¼Œæˆ‘å€‘éœ€è¦çŸ¥é“ TCP åœ¨ç¶²çµ¡ OSI çš„ä¸ƒå±¤æ¨¡å‹ä¸­çš„ç¬¬å››å±¤ â€”â€” å‚³è¼¸å±¤(Transport)ï¼ŒIP åœ¨ç¬¬ä¸‰å±¤ â€”â€” ç¶²çµ¡å±¤(Network)ï¼ŒARP åœ¨ç¬¬äºŒå±¤ â€”â€” æ•¸æ“šéˆè·¯å±¤(Data Link)ï¼Œåœ¨ç¬¬äºŒå±¤ä¸Šçš„æ•¸æ“šï¼Œæˆ‘å€‘å« Frameï¼Œåœ¨ç¬¬ä¸‰å±¤ä¸Šçš„æ•¸æ“šå« Packetï¼Œç¬¬å››å±¤çš„æ•¸æ“šå« Segmentã€‚</p>
<p>ã€€ã€€é¦–å…ˆï¼Œæˆ‘å€‘éœ€è¦çŸ¥é“ï¼Œæˆ‘å€‘ç¨‹åºçš„æ•¸æ“šé¦–å…ˆæœƒæ‰“åˆ° TCP çš„ Segment ä¸­ï¼Œç„¶å¾Œ TCP çš„ Segment æœƒæ‰“åˆ° IP çš„ Packet ä¸­ï¼Œç„¶å¾Œå†æ‰“åˆ°ä»¥å¤ªç¶² Ethernet çš„ Frame ä¸­ï¼Œå‚³åˆ°å°ç«¯å¾Œï¼Œå„å€‹å±¤è§£æè‡ªå·±çš„å”è­°ï¼Œç„¶å¾ŒæŠŠæ•¸æ“šäº¤çµ¦æ›´é«˜å±¤çš„å”è­°è™•ç†ã€‚</p>
<h2 id="TCPé ­æ ¼å¼">TCPé ­æ ¼å¼</h2><p>ã€€ã€€æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ TCP é ­çš„æ ¼å¼</p>
<p><img src="TCP-Header-01.jpg" alt="TCP é ­æ ¼å¼ 1"></p>
<center>TCP é ­æ ¼å¼ 1ï¼ˆ<a href="http://nmap.org/book/tcpip-ref.html" target="_blank" rel="external">åœ–ç‰‡ä¾†æº</a>ï¼‰</center>

<p>ã€€ã€€ä½ éœ€è¦æ³¨æ„é€™éº¼å¹¾é»ï¼š</p>
<ul>
<li>TCP çš„åŒ…æ˜¯æ²’æœ‰ IP åœ°å€çš„ï¼Œé‚£æ˜¯ IP å±¤ä¸Šçš„äº‹ã€‚ä½†æ˜¯æœ‰æºç«¯å£å’Œç›®æ¨™ç«¯å£ã€‚</li>
<li>ä¸€å€‹ TCP é€£æ¥éœ€è¦å››å€‹å…ƒçµ„ä¾†è¡¨ç¤ºæ˜¯åŒä¸€å€‹é€£æ¥ï¼ˆ<code>src_ip</code>, <code>src_port</code>, <code>dst_ip</code>, <code>dst_port</code>ï¼‰æº–ç¢ºèªªæ˜¯äº”å…ƒçµ„ï¼Œé‚„æœ‰ä¸€å€‹æ˜¯å”è­°ã€‚ä½†å› çˆ²é€™è£åªæ˜¯èªªTCPå”è­°ï¼Œæ‰€ä»¥ï¼Œé€™è£æˆ‘åªèªªå››å…ƒçµ„ã€‚</li>
<li>æ³¨æ„ä¸Šåœ–ä¸­çš„å››å€‹éå¸¸é‡è¦çš„æ±è¥¿ï¼š<ul>
<li><strong><em>Sequence Number</em></strong> æ˜¯åŒ…çš„åºè™Ÿï¼Œç”¨ä¾†<strong>è§£æ±ºç¶²çµ¡åŒ…äº‚åºï¼ˆreorderingï¼‰å•é¡Œ</strong>ã€‚</li>
<li><strong><em>Acknowledgement Number</em></strong> å°±æ˜¯ ACK â€”â€” ç”¨æ–¼ç¢ºèªæ”¶åˆ°ï¼Œ<strong>ç”¨ä¾†è§£æ±ºä¸ä¸ŸåŒ…çš„å•é¡Œ</strong>ã€‚</li>
<li><strong><em>Window</em></strong> åˆå« <strong><em>Advertised-Window</em></strong>ï¼Œä¹Ÿå°±æ˜¯è‘—åçš„æ»‘å‹•çª—å£ï¼ˆSliding Windowï¼‰ï¼Œ<strong>ç”¨æ–¼è§£æ±ºæµæ§çš„</strong>ã€‚</li>
<li><strong><em>TCP Flag</em></strong> ï¼Œä¹Ÿå°±æ˜¯åŒ…çš„é¡å‹ï¼Œä¸»è¦æ˜¯<strong>ç”¨æ–¼æ“æ§ TCP çš„ç‹€æ…‹æ©Ÿçš„</strong>ã€‚</li>
</ul>
</li>
</ul>
<p>ã€€ã€€é—œæ–¼å…¶å®ƒçš„æ±è¥¿ï¼Œå¯ä»¥åƒçœ‹ä¸‹é¢çš„åœ–ç¤º</p>
<p><img src="TCP-Header-02.jpg" alt="TCP é ­æ ¼å¼ 2"></p>
<center>TCP é ­æ ¼å¼ 2ï¼ˆ<a href="http://nmap.org/book/tcpip-ref.html" target="_blank" rel="external">åœ–ç‰‡ä¾†æº</a>ï¼‰</center>

<h2 id="TCPçš„ç‹€æ…‹æ©Ÿ">TCPçš„ç‹€æ…‹æ©Ÿ</h2><p>ã€€ã€€å…¶å¯¦ï¼Œ<strong>ç¶²çµ¡ä¸Šçš„å‚³è¼¸æ˜¯æ²’æœ‰é€£æ¥çš„ï¼ŒåŒ…æ‹¬ TCP ä¹Ÿæ˜¯ä¸€æ¨£çš„</strong>ã€‚è€Œ TCP æ‰€è¬‚çš„â€œé€£æ¥â€ï¼Œå…¶å¯¦åªä¸éæ˜¯åœ¨é€šè¨Šçš„é›™æ–¹ç¶­è­·ä¸€å€‹â€œé€£æ¥ç‹€æ…‹â€ï¼Œè®“å®ƒçœ‹ä¸Šå»å¥½åƒæœ‰é€£æ¥ä¸€æ¨£ã€‚æ‰€ä»¥ï¼ŒTCP çš„ç‹€æ…‹è®Šæ›æ˜¯éå¸¸é‡è¦çš„ã€‚</p>
<p>ã€€ã€€ä¸‹é¢æ˜¯ï¼šâ€œ<strong>TCP å”è­°çš„ç‹€æ…‹æ©Ÿ</strong>â€ï¼ˆ<a href="http://www.tcpipguide.com/free/t_TCPOperationalOverviewandtheTCPFiniteStateMachineF-2.htm" target="_blank" rel="external">åœ–ç‰‡ä¾†æº</a>ï¼‰ å’Œ â€œ<strong>TCP å»ºéˆæ¥</strong>â€ã€â€œ<strong>TCP æ–·éˆæ¥</strong>â€ã€â€œ<strong>å‚³æ•¸æ“š</strong>â€ çš„å°ç…§åœ–ï¼Œæˆ‘æŠŠå…©å€‹åœ–ä¸¦æ’æ”¾åœ¨ä¸€èµ·ï¼Œé€™æ¨£æ–¹ä¾¿åœ¨ä½ å°ç…§ç€çœ‹ã€‚å¦å¤–ï¼Œä¸‹é¢é€™å…©å€‹åœ–éå¸¸éå¸¸çš„é‡è¦ï¼Œä½ ä¸€å®šè¦è¨˜ç‰¢ã€‚ï¼ˆåå€‹æ§½ï¼šçœ‹åˆ°é€™æ¨£è¤‡é›œçš„ç‹€æ…‹æ©Ÿï¼Œå°±çŸ¥é“é€™å€‹å”è­°æœ‰å¤šè¤‡é›œï¼Œè¤‡é›œçš„æ±è¥¿ç¸½æ˜¯æœ‰å¾ˆå¤šå‘çˆ¹çš„äº‹æƒ…ï¼Œæ‰€ä»¥ TCP å”è­°å…¶å¯¦ä¹ŸæŒºå‘çˆ¹çš„ï¼‰</p>
<p><img src="tcpfsm.png" alt="TCP å”è­°çš„ç‹€æ…‹æ©Ÿ"> <img src="tcp_open_close.jpg" alt="æ¡æ‰‹æ¬¡æ•¸"></p>
<p>ã€€ã€€å¾ˆå¤šäººæœƒå•ï¼Œçˆ²ä»€éº¼å»ºéˆæ¥è¦ 3 æ¬¡æ¡æ‰‹ï¼Œæ–·éˆæ¥éœ€è¦ 4 æ¬¡æ®æ‰‹ï¼Ÿ</p>
<ul>
<li><strong>å°æ–¼å»ºéˆæ¥çš„ 3 æ¬¡æ¡æ‰‹</strong>ï¼Œä¸»è¦æ˜¯è¦åˆå§‹åŒ– Sequence Number çš„åˆå§‹å€¼ã€‚é€šä¿¡çš„é›™æ–¹è¦äº’ç›¸é€šçŸ¥å°æ–¹è‡ªå·±çš„åˆå§‹åŒ–çš„ Sequence Numberï¼ˆç¸®å¯«çˆ² ISNï¼šInital Sequence Numberï¼‰ â€”â€” æ‰€ä»¥å« SYNï¼Œå…¨ç¨± Synchronize Sequence Numbersã€‚ä¹Ÿå°±ä¸Šåœ–ä¸­çš„ x å’Œ yã€‚é€™å€‹è™Ÿè¦ä½œçˆ²ä»¥å¾Œçš„æ•¸æ“šé€šä¿¡çš„åºè™Ÿï¼Œä»¥ä¿è­‰æ‡‰ç”¨å±¤æ¥æ”¶åˆ°çš„æ•¸æ“šä¸æœƒå› çˆ²ç¶²çµ¡ä¸Šçš„å‚³è¼¸çš„å•é¡Œè€Œäº‚åºï¼ˆTCP æœƒç”¨é€™å€‹åºè™Ÿä¾†æ‹¼æ¥æ•¸æ“šï¼‰ã€‚</li>
<li><strong>å°æ–¼ 4 æ¬¡æ®æ‰‹</strong>ï¼Œå…¶å¯¦ä½ ä»”ç´°çœ‹æ˜¯ 2 æ¬¡ï¼Œå› çˆ² TCP æ˜¯å…¨é›™å·¥çš„ï¼Œæ‰€ä»¥ï¼Œç™¼é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½éœ€è¦ Fin å’Œ Ackã€‚åªä¸éï¼Œæœ‰ä¸€æ–¹æ˜¯è¢«å‹•çš„ï¼Œæ‰€ä»¥çœ‹ä¸Šå»å°±æˆäº†æ‰€è¬‚çš„ 4 æ¬¡æ®æ‰‹ã€‚å¦‚æœå…©é‚ŠåŒæ™‚æ–·é€£æ¥ï¼Œé‚£å°±æœƒå°±é€²å…¥åˆ° CLOSING ç‹€æ…‹ï¼Œç„¶å¾Œåˆ°é”T IME_WAIT ç‹€æ…‹ã€‚ä¸‹åœ–æ˜¯é›™æ–¹åŒæ™‚æ–·é€£æ¥çš„ç¤ºæ„åœ–ï¼ˆä½ åŒæ¨£å¯ä»¥å°ç…§ç€ TCP ç‹€æ…‹æ©Ÿçœ‹ï¼‰ï¼š</li>
</ul>
<p><img src="tcpclosesimul.png" alt="å…©ç«¯åŒæ™‚æ–·é–‹éˆæ¥"></p>
<center>å…©ç«¯åŒæ™‚æ–·é–‹éˆæ¥ï¼ˆ<a href="http://www.tcpipguide.com/free/t_TCPConnectionTermination-4.htm" target="_blank" rel="external">åœ–ç‰‡ä¾†æº</a>ï¼‰</center>

<p>ã€€ã€€å¦å¤–ï¼Œæœ‰å¹¾å€‹äº‹æƒ…éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼š</p>
<ul>
<li><strong>é—œæ–¼å»ºé€£æ¥æ™‚ SYN è¶…æ™‚</strong>ã€‚è©¦æƒ³ä¸€ä¸‹ï¼Œå¦‚æœ server ç«¯æ¥åˆ°äº† client ç™¼çš„ SYN å¾Œå›äº† SYN-ACK å¾Œ client æ‰ç·šäº†ï¼Œserver ç«¯æ²’æœ‰æ”¶åˆ° client å›ä¾†çš„ ACKï¼Œé‚£éº¼ï¼Œé€™å€‹é€£æ¥è™•æ–¼ä¸€ç®‡ä¸­é–“ç‹€æ…‹ï¼Œå³æ²’æˆåŠŸï¼Œä¹Ÿæ²’å¤±æ•—ã€‚æ–¼æ˜¯ï¼Œserver ç«¯å¦‚æœåœ¨ä¸€å®šæ™‚é–“å…§æ²’æœ‰æ”¶åˆ°çš„ TCP æœƒé‡ç™¼ SYN-ACKã€‚åœ¨ Linux ä¸‹ï¼Œé»˜èªé‡è©¦æ¬¡æ•¸çˆ² 5 æ¬¡ï¼Œé‡è©¦çš„é–“éš”æ™‚é–“å¾ 1s é–‹å§‹æ¯æ¬¡éƒ½ç¿»å”®ï¼Œ5 æ¬¡çš„é‡è©¦æ™‚é–“é–“éš”çˆ² 1s, 2s, 4s, 8s, 16sï¼Œç¸½å…± 31sï¼Œç¬¬ 5 æ¬¡ç™¼å‡ºå¾Œé‚„è¦ç­‰ 32s éƒ½çŸ¥é“ç¬¬ 5 æ¬¡ä¹Ÿè¶…æ™‚äº†ï¼Œæ‰€ä»¥ï¼Œç¸½å…±éœ€è¦ 1s + 2s + 4s+ 8s+ 16s + 32s = 2^6 - 1 = 63sï¼ŒTCP çº”æœƒæŠŠæ–·é–‹é€™å€‹é€£æ¥ã€‚</li>
<li><strong>é—œæ–¼ SYN Flood æ”»æ“Š</strong>ã€‚ä¸€äº›æƒ¡æ„çš„äººå°±çˆ²æ­¤è£½é€ äº† SYN Flood æ”»æ“Š â€”â€” çµ¦æœå‹™å™¨ç™¼äº†ä¸€å€‹ SYN å¾Œï¼Œå°±ä¸‹ç·šäº†ï¼Œæ–¼æ˜¯æœå‹™å™¨éœ€è¦é»˜èªç­‰ 63s çº”æœƒæ–·é–‹é€£æ¥ï¼Œé€™æ¨£ï¼Œæ”»æ“Šè€…å°±å¯ä»¥æŠŠæœå‹™å™¨çš„ syn é€£æ¥çš„éšŠåˆ—è€—ç›¡ï¼Œè®“æ­£å¸¸çš„é€£æ¥è«‹æ±‚ä¸èƒ½è™•ç†ã€‚æ–¼æ˜¯ï¼ŒLinux ä¸‹çµ¦äº†ä¸€å€‹å« <code>tcp_syncookies</code> çš„åƒæ•¸ä¾†æ‡‰å°é€™å€‹äº‹ â€”â€” ç•¶ SYN éšŠåˆ—æ»¿äº†å¾Œï¼ŒTCP æœƒé€šéæºåœ°å€ç«¯å£ã€ç›®æ¨™åœ°å€ç«¯å£å’Œæ™‚é–“æˆ³æ‰“é€ å‡ºä¸€å€‹ç‰¹åˆ¥çš„ Sequence Number ç™¼å›å»ï¼ˆåˆå« cookieï¼‰ï¼Œå¦‚æœæ˜¯æ”»æ“Šè€…å‰‡ä¸æœƒæœ‰éŸ¿æ‡‰ï¼Œå¦‚æœæ˜¯æ­£å¸¸é€£æ¥ï¼Œå‰‡æœƒæŠŠé€™å€‹ SYN Cookie ç™¼å›ä¾†ï¼Œç„¶å¾Œæœå‹™ç«¯å¯ä»¥é€šé cookie å»ºé€£æ¥ï¼ˆå³ä½¿ä½ ä¸åœ¨ SYN éšŠåˆ—ä¸­ï¼‰ã€‚è«‹æ³¨æ„ï¼Œè«‹å…ˆåƒè¬åˆ¥ç”¨ <code>tcp_syncookies</code> ä¾†è™•ç†æ­£å¸¸çš„å¤§è² è¼‰çš„é€£æ¥çš„æƒ…æ³ã€‚å› çˆ²ï¼Œ<code>synccookies</code> æ˜¯å¦¥å”ç‰ˆçš„ TCP å”è­°ï¼Œä¸¦ä¸åš´è¬¹ã€‚å°æ–¼æ­£å¸¸çš„è«‹æ±‚ï¼Œä½ æ‡‰è©²èª¿æ•´ä¸‰å€‹ TCP åƒæ•¸å¯ä¾›ä½ é¸æ“‡ï¼Œç¬¬ä¸€å€‹æ˜¯ï¼š<code>tcp_synack_retries</code> å¯ä»¥ç”¨ä»–ä¾†æ¸›å°‘é‡è©¦æ¬¡æ•¸ï¼›ç¬¬äºŒå€‹æ˜¯ï¼š<code>tcp_max_syn_backlog</code>ï¼Œå¯ä»¥å¢å¤§ SYN é€£æ¥æ•¸ï¼›ç¬¬ä¸‰å€‹æ˜¯ï¼š<code>tcp_abort_on_overflow</code> è™•ç†ä¸éä¾†ä¹¾è„†å°±ç›´æ¥æ‹’çµ•é€£æ¥äº†ã€‚</li>
<li><strong>é—œæ–¼ ISN çš„åˆå§‹åŒ–</strong>ã€‚ISN æ˜¯ä¸èƒ½ hard code çš„ï¼Œä¸ç„¶æœƒå‡ºå•é¡Œçš„ â€”â€” æ¯”å¦‚ï¼šå¦‚æœé€£æ¥å»ºå¥½å¾Œå§‹çµ‚ç”¨ 1 ä¾†åš ISNï¼Œå¦‚æœ client ç™¼äº† 30 å€‹ segment éå»ï¼Œä½†æ˜¯ç¶²çµ¡æ–·äº†ï¼Œæ–¼æ˜¯ client é‡é€£ï¼Œåˆç”¨äº† 1 åš ISNï¼Œä½†æ˜¯ä¹‹å‰é€£æ¥çš„é‚£äº›åŒ…åˆ°äº†ï¼Œæ–¼æ˜¯å°±è¢«ç•¶æˆäº†æ–°é€£æ¥çš„åŒ…ï¼Œæ­¤æ™‚ï¼Œclient çš„ Sequence Number å¯èƒ½æ˜¯ 3ï¼Œè€Œ Server ç«¯èªçˆ² client ç«¯çš„é€™å€‹è™Ÿæ˜¯ 30 äº†ã€‚å…¨äº‚äº†ã€‚RFC793 ä¸­èªªï¼ŒISN æœƒå’Œä¸€å€‹å‡çš„æ™‚é˜ç¶åœ¨ä¸€èµ·ï¼Œé€™å€‹æ™‚é˜æœƒåœ¨æ¯4å¾®ç§’å° ISN åšåŠ ä¸€æ“ä½œï¼Œç›´åˆ°è¶…é 2^32ï¼Œåˆå¾ 0 é–‹å§‹ã€‚é€™æ¨£ï¼Œä¸€å€‹ISNçš„é€±æœŸå¤§ç´„æ˜¯ 4.55 å€‹å°æ™‚ã€‚å› çˆ²ï¼Œæˆ‘å€‘å‡è¨­æˆ‘å€‘çš„ TCP Segment åœ¨ç¶²çµ¡ä¸Šçš„å­˜æ´»æ™‚é–“ä¸æœƒè¶…é Maximum Segment Lifetimeï¼ˆç¸®å¯«çˆ² MSL - Wikipedia èªæ¢ï¼‰ï¼Œæ‰€ä»¥ï¼Œåªè¦ MSL çš„å€¼å°æ–¼ 4.55 å°æ™‚ï¼Œé‚£éº¼ï¼Œæˆ‘å€‘å°±ä¸æœƒé‡ç”¨åˆ° ISNã€‚</li>
<li><strong>é—œæ–¼ MSL å’Œ TIME_WAIT</strong>ã€‚é€šéä¸Šé¢çš„ ISN çš„æè¿°ï¼Œç›¸ä¿¡ä½ ä¹ŸçŸ¥é“ MSL æ˜¯æ€éº¼ä¾†çš„äº†ã€‚æˆ‘å€‘æ³¨æ„åˆ°ï¼Œåœ¨ TCP çš„ç‹€æ…‹åœ–ä¸­ï¼Œå¾ TIME_WAIT ç‹€æ…‹åˆ° CLOSED ç‹€æ…‹ï¼Œæœ‰ä¸€å€‹è¶…æ™‚è¨­ç½®ï¼Œé€™å€‹è¶…æ™‚è¨­ç½®æ˜¯ 2 * MSLï¼ˆRFC793 å®šç¾©äº† MSL çˆ² 2 åˆ†é˜ï¼ŒLinux è¨­ç½®æˆäº† 30sï¼‰çˆ²ä»€éº¼è¦é€™æœ‰ TIME_WAITï¼Ÿçˆ²ä»€éº¼ä¸ç›´æ¥çµ¦è½‰æˆ CLOSED ç‹€æ…‹å‘¢ï¼Ÿä¸»è¦æœ‰å…©å€‹åŸå› ï¼š<ol>
<li>TIME_WAIT ç¢ºä¿æœ‰è¶³å¤ çš„æ™‚é–“è®“å°ç«¯æ”¶åˆ°äº† ACKï¼Œå¦‚æœè¢«å‹•é—œé–‰çš„é‚£æ–¹æ²’æœ‰æ”¶åˆ° Ackï¼Œå°±æœƒè§¸ç™¼è¢«å‹•ç«¯é‡ç™¼ Finï¼Œä¸€ä¾†ä¸€å»æ­£å¥½ 2 å€‹MSLï¼›</li>
<li>æœ‰è¶³å¤ çš„æ™‚é–“è®“é€™å€‹é€£æ¥ä¸æœƒè·Ÿå¾Œé¢çš„é€£æ¥æ··åœ¨ä¸€èµ·ï¼ˆä½ è¦çŸ¥é“ï¼Œæœ‰äº›è‡ªåšä¸»å¼µçš„è·¯ç”±å™¨æœƒç·©å­˜IPæ•¸æ“šåŒ…ï¼Œå¦‚æœé€£æ¥è¢«é‡ç”¨äº†ï¼Œé‚£éº¼é€™äº›å»¶é²æ”¶åˆ°çš„åŒ…å°±æœ‰å¯èƒ½æœƒè·Ÿæ–°é€£æ¥æ··åœ¨ä¸€èµ·ï¼‰ã€‚ä½ å¯ä»¥çœ‹çœ‹é€™ç¯‡æ–‡ç« ã€Š<a href="http://www.serverframework.com/asynchronousevents/2011/01/time-wait-and-its-design-implications-for-protocols-and-scalable-servers.html" target="_blank" rel="external">TIME_WAIT and its design implications for protocols and scalable client server systems</a>ã€‹</li>
</ol>
</li>
<li><strong>é—œæ–¼ TIME_WAIT æ•¸é‡å¤ªå¤š</strong>ã€‚å¾ä¸Šé¢çš„æè¿°æˆ‘å€‘å¯ä»¥çŸ¥é“ï¼ŒTIME_WAIT æ˜¯å€‹å¾ˆé‡è¦çš„ç‹€æ…‹ï¼Œä½†æ˜¯å¦‚æœåœ¨å¤§ä¸¦ç™¼çš„çŸ­éˆæ¥ä¸‹ï¼ŒTIME_WAIT å°±æœƒå¤ªå¤šï¼Œé€™ä¹Ÿæœƒæ¶ˆè€—å¾ˆå¤šç³»çµ±è³‡æºã€‚åªè¦æœä¸€ä¸‹ï¼Œä½ å°±æœƒç™¼ç¾ï¼Œåæœ‰å…«ä¹çš„è™•ç†æ–¹å¼éƒ½æ˜¯æ•™ä½ è¨­ç½®å…©å€‹åƒæ•¸ï¼Œä¸€å€‹å« <code>tcp_tw_reuse</code>ï¼Œå¦ä¸€å€‹å« <code>tcp_tw_recycle</code> çš„åƒæ•¸ï¼Œé€™å…©å€‹åƒæ•¸é»˜èªå€¼éƒ½æ˜¯è¢«é—œé–‰çš„ï¼Œå¾Œè€… recyle æ¯”å‰è€… resue æ›´çˆ²æ¿€é€²ï¼Œresue è¦æº«æŸ”ä¸€äº›ã€‚å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ <code>tcp_tw_reuse</code>ï¼Œå¿…éœ€è¨­ç½® <code>tcp_timestamps = 1</code>ï¼Œå¦å‰‡ç„¡æ•ˆã€‚é€™è£ï¼Œä½ ä¸€å®šè¦æ³¨æ„ï¼Œ<strong>æ‰“é–‹é€™å…©å€‹åƒæ•¸æœƒæœ‰æ¯”è¼ƒå¤§çš„å‘ â€”â€” å¯èƒ½æœƒè®“ TCP é€£æ¥å‡ºä¸€äº›è©­ç•°çš„å•é¡Œ</strong>ï¼ˆå› çˆ²å¦‚ä¸Šè¿°ä¸€æ¨£ï¼Œå¦‚æœä¸ç­‰å¾…è¶…æ™‚é‡ç”¨é€£æ¥çš„è©±ï¼Œæ–°çš„é€£æ¥å¯èƒ½æœƒå»ºä¸ä¸Šã€‚æ­£å¦‚<a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt" target="_blank" rel="external">å®˜æ–¹æ–‡æª”</a>ä¸Šèªªçš„ä¸€æ¨£â€œ<strong><em>It should not be changed without advice/request of technical experts</em></strong>â€ï¼‰ã€‚<ol>
<li><strong>é—œæ–¼ <code>tcp_tw_reuse</code></strong>ã€‚å®˜æ–¹æ–‡æª”ä¸Šèªª <code>tcp_tw_reuse</code> åŠ ä¸Š <code>tcp_timestamps</code>ï¼ˆåˆå« PAWS, for Protection Against Wrapped Sequence Numbersï¼‰å¯ä»¥ä¿è­‰å”è­°çš„è§’åº¦ä¸Šçš„å®‰å…¨ï¼Œä½†æ˜¯ä½ éœ€è¦ <code>tcp_timestamps</code> åœ¨å…©é‚Šéƒ½è¢«æ‰“é–‹ï¼ˆä½ å¯ä»¥è®€ä¸€ä¸‹ <code>tcp_twsk_unique</code> çš„æºç¢¼ ï¼‰ã€‚æˆ‘å€‹äººä¼°è¨ˆé‚„æ˜¯æœ‰ä¸€äº›å ´æ™¯æœƒæœ‰å•é¡Œã€‚</li>
<li><strong>é—œæ–¼ <code>tcp_tw_recycle</code></strong>ã€‚å¦‚æœæ˜¯ <code>tcp_tw_recycle</code> è¢«æ‰“é–‹äº†è©±ï¼Œæœƒå‡è¨­å°ç«¯é–‹å•“äº† <code>tcp_timestamps</code>ï¼Œç„¶å¾Œæœƒå»æ¯”è¼ƒæ™‚é–“æˆ³ï¼Œå¦‚æœæ™‚é–“æˆ³è®Šå¤§äº†ï¼Œå°±å¯ä»¥é‡ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°ç«¯æ˜¯ä¸€å€‹ NAT ç¶²çµ¡çš„è©±ï¼ˆå¦‚ï¼šä¸€å€‹å…¬å¸åªç”¨ä¸€å€‹ IP å‡ºå…¬ç¶²ï¼‰æˆ–æ˜¯å°ç«¯çš„ IP è¢«å¦ä¸€è‡ºé‡ç”¨äº†ï¼Œé€™å€‹äº‹å°±è¤‡é›œäº†ã€‚å»ºéˆæ¥çš„ SYN å¯èƒ½å°±è¢«ç›´æ¥ä¸Ÿæ‰äº†ï¼ˆä½ å¯èƒ½æœƒçœ‹åˆ° connection time out çš„éŒ¯èª¤ï¼‰ï¼ˆå¦‚æœä½ æƒ³è§€æ‘©ä¸€ä¸‹ Linux çš„å…§æ ¸ä»£ç¢¼ï¼Œè«‹åƒçœ‹æºç¢¼ <code>tcp_timewait_state_process</code>ï¼‰ã€‚</li>
<li><strong>é—œæ–¼ <code>tcp_max_tw_buckets</code></strong>ã€‚é€™å€‹æ˜¯æ§åˆ¶ä¸¦ç™¼çš„ TIME_WAIT çš„æ•¸é‡ï¼Œé»˜èªå€¼æ˜¯ 180000ï¼Œå¦‚æœè¶…é™ï¼Œé‚£éº¼ï¼Œç³»çµ±æœƒæŠŠå¤šçš„çµ¦ destory æ‰ï¼Œç„¶å¾Œåœ¨æ—¥èªŒè£æ‰“ä¸€å€‹è­¦å‘Šï¼ˆå¦‚ï¼štime wait bucket table overflowï¼‰ï¼Œå®˜ç¶²æ–‡æª”èªªé€™å€‹åƒæ•¸æ˜¯ç”¨ä¾†å°æŠ— DDoS æ”»æ“Šçš„ã€‚ä¹Ÿèªªçš„é»˜èªå€¼ 180000 ä¸¦ä¸å°ã€‚é€™å€‹é‚„æ˜¯éœ€è¦æ ¹æ“šå¯¦éš›æƒ…æ³è€ƒæ…®ã€‚</li>
</ol>
</li>
</ul>
<blockquote>
<p>Againï¼Œä½¿ç”¨ <code>tcp_tw_reuse</code> å’Œ <code>tcp_tw_recycle</code> ä¾†è§£æ±º TIME_WAIT çš„å•é¡Œæ˜¯éå¸¸éå¸¸å±éšªçš„ï¼Œå› çˆ²é€™å…©å€‹åƒæ•¸é•åäº†TCPå”è­°ï¼ˆ<a href="http://tools.ietf.org/html/rfc1122" target="_blank" rel="external">RFC 1122</a>ï¼‰ ã€‚</p>
</blockquote>
<h2 id="æ•¸æ“šå‚³è¼¸ä¸­çš„_Sequence_Number">æ•¸æ“šå‚³è¼¸ä¸­çš„ Sequence Number</h2><p>ã€€ã€€ä¸‹åœ–æ˜¯æˆ‘å¾ Wireshark ä¸­æˆªäº†å€‹æˆ‘åœ¨è¨ªå• coolshell.cn æ™‚çš„æœ‰æ•¸æ“šå‚³è¼¸çš„åœ–çµ¦ä½ çœ‹ä¸€ä¸‹ï¼ŒSeqNum æ˜¯æ€éº¼è®Šçš„ã€‚ï¼ˆä½¿ç”¨ Wireshark èœå–®ä¸­çš„ <code>Statistics -&gt; Flow Graphâ€¦</code>ï¼‰</p>
<p><img src="tcp_data_seq_num.jpg" alt="æ•¸æ“šå‚³è¼¸åœ–"></p>
<p>ã€€ã€€ä½ å¯ä»¥çœ‹åˆ°ï¼ŒSeqNum çš„å¢åŠ æ˜¯å’Œå‚³è¼¸çš„å­—ç¯€æ•¸ç›¸é—œçš„ã€‚ä¸Šåœ–ä¸­ï¼Œä¸‰æ¬¡æ¡æ‰‹å¾Œï¼Œä¾†äº†å…©å€‹ Len:1440 çš„åŒ…ï¼Œè€Œç¬¬äºŒå€‹åŒ…çš„ SeqNum å°±æˆäº† 1441ã€‚ç„¶å¾Œç¬¬ä¸€å€‹ ACK å›çš„æ˜¯ 1441ï¼Œè¡¨ç¤ºç¬¬ä¸€å€‹ 1440 æ”¶åˆ°äº†ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½ ç”¨ Wireshark æŠ“åŒ…ç¨‹åºçœ‹ 3 æ¬¡æ¡æ‰‹ï¼Œä½ æœƒç™¼ç¾ SeqNum ç¸½æ˜¯çˆ²0ï¼Œä¸æ˜¯é€™æ¨£çš„ï¼ŒWireshark çˆ²äº†é¡¯ç¤ºæ›´å‹å¥½ï¼Œä½¿ç”¨äº† Relative SeqNum â€”â€” ç›¸å°åºè™Ÿï¼Œä½ åªè¦åœ¨å³éµèœå–®ä¸­çš„ protocol preference ä¸­å–æ¶ˆæ‰å°±å¯ä»¥çœ‹åˆ°â€œAbsolute SeqNumâ€äº†ã€‚</p>
</blockquote>
<h2 id="TCPé‡å‚³æ©Ÿåˆ¶">TCPé‡å‚³æ©Ÿåˆ¶</h2><p>ã€€ã€€TCP è¦ä¿è­‰æ‰€æœ‰çš„æ•¸æ“šåŒ…éƒ½å¯ä»¥åˆ°é”ï¼Œæ‰€ä»¥ï¼Œå¿…éœ€è¦æœ‰é‡å‚³æ©Ÿåˆ¶ã€‚</p>
<p>ã€€ã€€æ³¨æ„ï¼Œæ¥æ”¶ç«¯çµ¦ç™¼é€ç«¯çš„ Ack ç¢ºèªåªæœƒç¢ºèªæœ€å¾Œä¸€å€‹é€£çºŒçš„åŒ…ï¼Œæ¯”å¦‚ï¼Œç™¼é€ç«¯ç™¼äº† 1,2,3,4,5 ä¸€å…±äº”ä»½æ•¸æ“šï¼Œæ¥æ”¶ç«¯æ”¶åˆ°äº† 1ï¼Œ2ï¼Œæ–¼æ˜¯å› ack 3ï¼Œç„¶å¾Œæ”¶åˆ°äº† 4ï¼ˆæ³¨æ„æ­¤æ™‚ 3 æ²’æ”¶åˆ°ï¼‰ï¼Œæ­¤æ™‚çš„ TCP æœƒæ€éº¼è¾¦ï¼Ÿæˆ‘å€‘è¦çŸ¥é“ï¼Œå› çˆ²æ­£å¦‚å‰é¢æ‰€èªªçš„ï¼ŒSeqNum å’Œ Ack æ˜¯ä»¥å­—ç¯€æ•¸çˆ²å–®ä½ï¼Œæ‰€ä»¥ ack çš„æ™‚å€™ï¼Œä¸èƒ½è·³ç€ç¢ºèªï¼Œåªèƒ½ç¢ºèªæœ€å¤§çš„é€£çºŒæ”¶åˆ°çš„åŒ…ï¼Œä¸ç„¶ï¼Œç™¼é€ç«¯å°±ä»¥çˆ²ä¹‹å‰çš„éƒ½æ”¶åˆ°äº†ã€‚</p>
<h3 id="è¶…æ™‚é‡å‚³æ©Ÿåˆ¶">è¶…æ™‚é‡å‚³æ©Ÿåˆ¶</h3><p>ã€€ã€€ä¸€ç¨®æ˜¯ä¸å› ackï¼Œæ­»ç­‰ 3ï¼Œç•¶ç™¼é€æ–¹ç™¼ç¾æ”¶ä¸åˆ° 3 çš„ ack è¶…æ™‚å¾Œï¼Œæœƒé‡å‚³ 3ã€‚ä¸€æ—¦æ¥æ”¶æ–¹æ”¶åˆ° 3 å¾Œï¼Œæœƒ ack å› 4 â€”â€” æ„å‘³ç€ 3 å’Œ 4 éƒ½æ”¶åˆ°äº†ã€‚</p>
<p>ã€€ã€€ä½†æ˜¯ï¼Œé€™ç¨®æ–¹å¼æœƒæœ‰æ¯”è¼ƒåš´é‡çš„å•é¡Œï¼Œé‚£å°±æ˜¯å› çˆ²è¦æ­»ç­‰ 3ï¼Œæ‰€ä»¥æœƒå°è‡´ 4 å’Œ 5 å³ä¾¿å·²ç¶“æ”¶åˆ°äº†ï¼Œè€Œç™¼é€æ–¹ä¹Ÿå®Œå…¨ä¸çŸ¥é“ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Œå› çˆ²æ²’æœ‰æ”¶åˆ° Ackï¼Œæ‰€ä»¥ï¼Œç™¼é€æ–¹å¯èƒ½æœƒæ‚²è§€åœ°èªçˆ²ä¹Ÿä¸Ÿäº†ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¹Ÿæœƒå°è‡´ 4 å’Œ 5 çš„é‡å‚³ã€‚</p>
<p>ã€€ã€€å°æ­¤æœ‰å…©ç¨®é¸æ“‡ï¼š</p>
<ul>
<li>ä¸€ç¨®æ˜¯åƒ…é‡å‚³ timeout çš„åŒ…ã€‚ä¹Ÿå°±æ˜¯ç¬¬ 3 ä»½æ•¸æ“šã€‚</li>
<li>å¦ä¸€ç¨®æ˜¯é‡å‚³ timeout å¾Œæ‰€æœ‰çš„æ•¸æ“šï¼Œä¹Ÿå°±æ˜¯ç¬¬ 3ï¼Œ4ï¼Œ5 é€™ä¸‰ä»½æ•¸æ“šã€‚</li>
</ul>
<p>ã€€ã€€é€™å…©ç¨®æ–¹å¼æœ‰å¥½ä¹Ÿæœ‰ä¸å¥½ã€‚ç¬¬ä¸€ç¨®æœƒç¯€çœå¸¶å¯¬ï¼Œä½†æ˜¯æ…¢ï¼Œç¬¬äºŒç¨®æœƒå¿«ä¸€é»ï¼Œä½†æ˜¯æœƒæµªè²»å¸¶å¯¬ï¼Œä¹Ÿå¯èƒ½æœƒæœ‰ç„¡ç”¨åŠŸã€‚ä½†ç¸½é«”ä¾†èªªéƒ½ä¸å¥½ã€‚å› çˆ²éƒ½åœ¨ç­‰ timeoutï¼Œtimeout å¯èƒ½æœƒå¾ˆé•·ï¼ˆåœ¨ä¸‹ç¯‡æœƒèªª TCP æ˜¯æ€éº¼å‹•æ…‹åœ°è¨ˆç®—å‡º timeout çš„ï¼‰</p>
<h3 id="å¿«é€Ÿé‡å‚³æ©Ÿåˆ¶">å¿«é€Ÿé‡å‚³æ©Ÿåˆ¶</h3><p>ã€€ã€€æ–¼æ˜¯ï¼ŒTCP å¼•å…¥äº†ä¸€ç¨®å« <strong><em>Fast Retransmit</em></strong> çš„ç®—æ³•ï¼Œä¸ä»¥æ™‚é–“é©…å‹•ï¼Œè€Œä»¥æ•¸æ“šé©…å‹•é‡å‚³ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœï¼ŒåŒ…æ²’æœ‰é€£çºŒåˆ°é”ï¼Œå°± ack æœ€å¾Œé‚£å€‹å¯èƒ½è¢«ä¸Ÿäº†çš„åŒ…ï¼Œå¦‚æœç™¼é€æ–¹é€£çºŒæ”¶åˆ° 3 æ¬¡ç›¸åŒçš„ ackï¼Œå°±é‡å‚³ã€‚<strong><em>Fast Retransmit</em></strong> çš„å¥½è™•æ˜¯ä¸ç”¨ç­‰ timeout äº†å†é‡å‚³ã€‚</p>
<p>ã€€ã€€æ¯”å¦‚ï¼šå¦‚æœç™¼é€æ–¹ç™¼å‡ºäº† 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5 ä»½æ•¸æ“šï¼Œç¬¬ä¸€ä»½å…ˆåˆ°é€äº†ï¼Œæ–¼æ˜¯å°± ack å› 2ï¼Œçµæœ 2 å› çˆ²æŸäº›åŸå› æ²’æ”¶åˆ°ï¼Œ3 åˆ°é”äº†ï¼Œæ–¼æ˜¯é‚„æ˜¯ ack å› 2ï¼Œå¾Œé¢çš„ 4 å’Œ 5 éƒ½åˆ°äº†ï¼Œä½†æ˜¯é‚„æ˜¯ ack å› 2ï¼Œå› çˆ² 2 é‚„æ˜¯æ²’æœ‰æ”¶åˆ°ï¼Œæ–¼æ˜¯ç™¼é€ç«¯æ”¶åˆ°äº†ä¸‰å€‹ ack = 2 çš„ç¢ºèªï¼ŒçŸ¥é“äº† 2 é‚„æ²’æœ‰åˆ°ï¼Œæ–¼æ˜¯å°±é¦¬ä¸Šé‡è½‰ 2ã€‚ç„¶å¾Œï¼Œæ¥æ”¶ç«¯æ”¶åˆ°äº† 2ï¼Œæ­¤æ™‚å› çˆ² 3ï¼Œ4ï¼Œ5 éƒ½æ”¶åˆ°äº†ï¼Œæ–¼æ˜¯ ack å› 6ã€‚ç¤ºæ„åœ–å¦‚ä¸‹ï¼š</p>
<p><img src="FASTIncast021.png" alt="å¿«é€Ÿé‡å‚³"></p>
<p>ã€€ã€€Fast Retransmit åªè§£æ±ºäº†ä¸€å€‹å•é¡Œï¼Œå°±æ˜¯ timeout çš„å•é¡Œï¼Œå®ƒä¾ç„¶é¢è‡¨ä¸€å€‹è‰±é›£çš„é¸æ“‡ï¼Œå°±æ˜¯é‡è½‰ä¹‹å‰çš„ä¸€å€‹é‚„æ˜¯é‡è£æ‰€æœ‰çš„å•é¡Œã€‚å°æ–¼ä¸Šé¢çš„ç¤ºä¾‹ä¾†èªªï¼Œæ˜¯é‡å‚³ #2 å‘¢é‚„æ˜¯é‡å‚³ #2ï¼Œ#3ï¼Œ#4ï¼Œ#5 å‘¢ï¼Ÿå› çˆ²ç™¼é€ç«¯ä¸¦ä¸æ¸…æ¥šé€™é€£çºŒçš„ 3 å€‹ ack(2) æ˜¯èª°å‚³å›ä¾†çš„ï¼Ÿä¹Ÿè¨±ç™¼é€ç«¯ç™¼äº† 20 ä»½æ•¸æ“šï¼Œæ˜¯ #6ï¼Œ#10ï¼Œ#20 å‚³ä¾†çš„å‘¢ã€‚é€™æ¨£ï¼Œç™¼é€ç«¯å¾ˆæœ‰å¯èƒ½è¦é‡å‚³å¾ 2 åˆ° 20 çš„é€™å †æ•¸æ“šï¼ˆé€™å°±æ˜¯æŸäº› TCP çš„å¯¦éš›çš„å¯¦ç¾ï¼‰ã€‚å¯è¦‹ï¼Œé€™æ˜¯ä¸€æŠŠé›™åˆƒåŠã€‚</p>
<h3 id="SACK_æ–¹æ³•">SACK æ–¹æ³•</h3><p>ã€€ã€€å¦å¤–ä¸€ç¨®æ›´å¥½çš„æ–¹å¼å«ï¼š<strong>Selective Acknowledgment (SACK)</strong>ï¼ˆåƒçœ‹ <a href="http://tools.ietf.org/html/rfc2018" target="_blank" rel="external">RFC 2018</a>ï¼‰ï¼Œé€™ç¨®æ–¹å¼éœ€è¦åœ¨ TCP é ­é‡ŒåŠ ä¸€å€‹ SACK çš„æ±è¥¿ï¼ŒACK é‚„æ˜¯ Fast Retransmit çš„ ACKï¼ŒSACK å‰‡æ˜¯å½™å ±æ”¶åˆ°çš„æ•¸æ“šç¢ç‰ˆã€‚åƒçœ‹ä¸‹åœ–ï¼š</p>
<p><img src="tcp_sack_example-1024x577.jpg" alt="SACKæ–¹æ³•"></p>
<p>ã€€ã€€é€™æ¨£ï¼Œåœ¨ç™¼é€ç«¯å°±å¯ä»¥æ ¹æ“šå›å‚³çš„ SACK ä¾†çŸ¥é“å“ªäº›æ•¸æ“šåˆ°äº†ï¼Œå“ªäº›æ²’æœ‰åˆ°ã€‚æ–¼æ˜¯å°±å„ªåŒ–äº† Fast Retransmit çš„ç®—æ³•ã€‚ç•¶ç„¶ï¼Œé€™å€‹å”è­°éœ€è¦å…©é‚Šéƒ½æ”¯æŒã€‚åœ¨ Linux ä¸‹ï¼Œå¯ä»¥é€šé <code>tcp_sack</code> åƒæ•¸æ‰“é–‹é€™å€‹åŠŸèƒ½ï¼ˆLinux 2.4 å¾Œé»˜èªæ‰“é–‹ï¼‰ã€‚</p>
<p>ã€€ã€€é€™è£é‚„éœ€è¦æ³¨æ„ä¸€å€‹å•é¡Œ â€”â€” æ¥æ”¶æ–¹ Renegingï¼Œæ‰€è¬‚ Reneging çš„æ„æ€å°±æ˜¯æ¥æ”¶æ–¹æœ‰æ¬ŠæŠŠå·²ç¶“å ±çµ¦ç™¼é€ç«¯ SACK è£çš„æ•¸æ“šçµ¦ä¸Ÿäº†ã€‚é€™æ¨£å¹¹æ˜¯ä¸è¢«é¼“å‹µçš„ï¼Œå› çˆ²é€™å€‹äº‹æœƒæŠŠå•é¡Œè¤‡é›œåŒ–äº†ï¼Œä½†æ˜¯ï¼Œæ¥æ”¶æ–¹é€™éº¼åšå¯èƒ½æœƒæœ‰äº›æ¥µç«¯æƒ…æ³ï¼Œæ¯”å¦‚è¦æŠŠå…§å­˜çµ¦åˆ¥çš„æ›´é‡è¦çš„æ±è¥¿ã€‚æ‰€ä»¥ï¼Œç™¼é€æ–¹ä¹Ÿä¸èƒ½å®Œå…¨ä¾è³´ SACKï¼Œé‚„æ˜¯è¦ä¾è³´ ACKï¼Œä¸¦ç¶­è­· Time-Outï¼Œå¦‚æœå¾ŒçºŒçš„ ACK æ²’æœ‰å¢é•·ï¼Œé‚£éº¼é‚„æ˜¯è¦æŠŠ SACK çš„æ±è¥¿é‡å‚³ï¼Œå¦å¤–ï¼Œæ¥æ”¶ç«¯é€™é‚Šæ°¸é ä¸èƒ½æŠŠ SACK çš„åŒ…æ¨™è¨˜çˆ² Ackã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šSACK æœƒæ¶ˆè²»ç™¼é€æ–¹çš„è³‡æºï¼Œè©¦æƒ³ï¼Œå¦‚æœä¸€å€‹æ”»æ“Šè€…çµ¦æ•¸æ“šç™¼é€æ–¹ç™¼ä¸€å † SACK çš„é¸é …ï¼Œé€™æœƒå°è‡´ç™¼é€æ–¹é–‹å§‹è¦é‡å‚³ç”šè‡³éæ­·å·²ç¶“ç™¼å‡ºçš„æ•¸æ“šï¼Œé€™æœƒæ¶ˆè€—å¾ˆå¤šç™¼é€ç«¯çš„è³‡æºã€‚è©³ç´°çš„æ±è¥¿è«‹åƒçœ‹ã€Š<a href="http://www.ibm.com/developerworks/cn/linux/l-tcp-sack/" target="_blank" rel="external">TCP SACKçš„æ€§èƒ½æ¬Šè¡¡</a>ã€‹</p>
</blockquote>
<h3 id="Duplicate_SACK_â€“_é‡è¤‡æ”¶åˆ°æ•¸æ“šçš„å•é¡Œ">Duplicate SACK â€“ é‡è¤‡æ”¶åˆ°æ•¸æ“šçš„å•é¡Œ</h3><p>ã€€ã€€Duplicate SACK åˆç¨± D-SACKï¼Œå…¶ä¸»è¦ä½¿ç”¨äº† SACK ä¾†å‘Šè¨´ç™¼é€æ–¹æœ‰å“ªäº›æ•¸æ“šè¢«é‡è¤‡æ¥æ”¶äº†ã€‚<a href="http://www.ietf.org/rfc/rfc2883.txt" target="_blank" rel="external">RFC-2833</a> è£æœ‰è©³ç´°æè¿°å’Œç¤ºä¾‹ã€‚ä¸‹é¢èˆ‰å¹¾å€‹ä¾‹å­ï¼ˆä¾†æºæ–¼ <a href="http://www.ietf.org/rfc/rfc2883.txt" target="_blank" rel="external">RFC-2833</a>ï¼‰</p>
<p>ã€€ã€€D-SACKä½¿ç”¨äº†SACKçš„ç¬¬ä¸€å€‹æ®µä¾†åšæ¨™èªŒï¼Œ</p>
<ul>
<li>å¦‚æœ SACK çš„ç¬¬ä¸€å€‹æ®µçš„ç¯„åœè¢« ACK æ‰€è¦†è“‹ï¼Œé‚£éº¼å°±æ˜¯ D-SACK</li>
<li>å¦‚æœ SACK çš„ç¬¬ä¸€å€‹æ®µçš„ç¯„åœè¢« SACK çš„ç¬¬äºŒå€‹æ®µè¦†è“‹ï¼Œé‚£éº¼å°±æ˜¯ D-SACK</li>
</ul>
<h4 id="ç¤ºä¾‹ä¸€ï¼šACK_ä¸ŸåŒ…">ç¤ºä¾‹ä¸€ï¼šACK ä¸ŸåŒ…</h4><p>ã€€ã€€ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸Ÿäº†å…©å€‹ ACKï¼Œæ‰€ä»¥ï¼Œç™¼é€ç«¯é‡å‚³äº†ç¬¬ä¸€å€‹æ•¸æ“šåŒ…ï¼ˆ3000 - 3499ï¼‰ï¼Œæ–¼æ˜¯æ¥æ”¶ç«¯ç™¼ç¾é‡è¤‡æ”¶åˆ°ï¼Œæ–¼æ˜¯å›äº†ä¸€å€‹ SACK = 3000 - 3500ï¼Œå› çˆ² ACK éƒ½åˆ°äº† 4000 æ„å‘³ç€æ”¶åˆ°äº† 4000 ä¹‹å‰çš„æ‰€æœ‰æ•¸æ“šï¼Œæ‰€ä»¥é€™å€‹ SACK å°±æ˜¯ D-SACK â€”â€” æ—¨åœ¨å‘Šè¨´ç™¼é€ç«¯æˆ‘æ”¶åˆ°äº†é‡è¤‡çš„æ•¸æ“šï¼Œè€Œä¸”æˆ‘å€‘çš„ç™¼é€ç«¯é‚„çŸ¥é“ï¼Œæ•¸æ“šåŒ…æ²’æœ‰ä¸Ÿï¼Œä¸Ÿçš„æ˜¯ ACK åŒ…ã€‚</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Transmitted  Received    ACK Sent</span><br><span class="line">Segment      Segment     (Including SACK Blocks)</span><br><span class="line"></span><br><span class="line"><span class="number">3000-3499</span>    <span class="number">3000-3499</span>   3500 (ACK dropped)</span><br><span class="line"><span class="number">3500-3999</span>    <span class="number">3500-3999</span>   4000 (ACK dropped)</span><br><span class="line"><span class="number">3000-3499</span>    <span class="number">3000-3499</span>   4000, SACK=<span class="number">3000-3500</span></span><br><span class="line">                                    ---------</span><br></pre></td></tr></table></figure>
<h4 id="ç¤ºä¾‹äºŒï¼šç¶²çµ¡å»¶èª¤">ç¤ºä¾‹äºŒï¼šç¶²çµ¡å»¶èª¤</h4><p>ã€€ã€€ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œç¶²çµ¡åŒ…ï¼ˆ1000 - 1499ï¼‰è¢«ç¶²çµ¡çµ¦å»¶èª¤äº†ï¼Œå°è‡´ç™¼é€æ–¹æ²’æœ‰æ”¶åˆ° ACKï¼Œè€Œå¾Œé¢åˆ°é”çš„ä¸‰å€‹åŒ…è§¸ç™¼äº†â€œFast Retransmit ç®—æ³•â€ï¼Œæ‰€ä»¥é‡å‚³ï¼Œä½†é‡å‚³æ™‚ï¼Œè¢«å»¶èª¤çš„åŒ…åˆåˆ°äº†ï¼Œæ‰€ä»¥ï¼Œå›äº†ä¸€å€‹ SACK = 1000 - 1500ï¼Œå› çˆ² ACK å·²åˆ°äº† 3000ï¼Œæ‰€ä»¥ï¼Œé€™å€‹ SACK æ˜¯ D-SACK â€”â€” æ¨™è­˜æ”¶åˆ°äº†é‡è¤‡çš„åŒ…ã€‚</p>
<p>ã€€ã€€é€™å€‹æ¡ˆä¾‹ä¸‹ï¼Œç™¼é€ç«¯çŸ¥é“ä¹‹å‰å› çˆ²â€œFast Retransmit ç®—æ³•â€è§¸ç™¼çš„é‡å‚³ä¸æ˜¯å› çˆ²ç™¼å‡ºå»çš„åŒ…ä¸Ÿäº†ï¼Œä¹Ÿä¸æ˜¯å› çˆ²è¿´æ‡‰çš„ ACK åŒ…ä¸Ÿäº†ï¼Œè€Œæ˜¯å› çˆ²ç¶²çµ¡å»¶æ™‚äº†ã€‚</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Transmitted    Received    ACK Sent</span><br><span class="line">Segment        Segment     (Including SACK Blocks)</span><br><span class="line"> </span><br><span class="line"><span class="number">500-999</span>        <span class="number">500-999</span>     1000</span><br><span class="line"><span class="number">1000-1499</span>      (delayed)</span><br><span class="line"><span class="number">1500-1999</span>      <span class="number">1500-1999</span>   1000, SACK=<span class="number">1500-2000</span></span><br><span class="line"><span class="number">2000-2499</span>      <span class="number">2000-2499</span>   1000, SACK=<span class="number">1500-2500</span></span><br><span class="line"><span class="number">2500-2999</span>      <span class="number">2500-2999</span>   1000, SACK=<span class="number">1500-3000</span></span><br><span class="line"><span class="number">1000-1499</span>      <span class="number">1000-1499</span>   3000</span><br><span class="line">               <span class="number">1000-1499</span>   3000, SACK=<span class="number">1000-1500</span></span><br><span class="line">                                      ---------</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¯è¦‹ï¼Œå¼•å…¥äº† D-SACKï¼Œæœ‰é€™éº¼å¹¾å€‹å¥½è™•ï¼š</p>
<ol>
<li>å¯ä»¥è®“ç™¼é€æ–¹çŸ¥é“ï¼Œæ˜¯ç™¼å‡ºå»çš„åŒ…ä¸Ÿäº†ï¼Œé‚„æ˜¯å›ä¾†çš„ ACK åŒ…ä¸Ÿäº†ã€‚</li>
<li>æ˜¯ä¸æ˜¯è‡ªå·±çš„ timeout å¤ªå°äº†ï¼Œå°è‡´é‡å‚³ã€‚</li>
<li>ç¶²çµ¡ä¸Šå‡ºç¾äº†å…ˆç™¼çš„åŒ…å¾Œåˆ°çš„æƒ…æ³ï¼ˆåˆç¨± reorderingï¼‰</li>
<li>ç¶²çµ¡ä¸Šæ˜¯ä¸æ˜¯æŠŠæˆ‘çš„æ•¸æ“šåŒ…çµ¦è¤‡è£½äº†ã€‚</li>
</ol>
<p>ã€€ã€€<strong>çŸ¥é“é€™äº›æ±è¥¿å¯ä»¥å¾ˆå¥½å¾—å¹«åŠ©TCPç­è§£ç¶²çµ¡æƒ…æ³ï¼Œå¾è€Œå¯ä»¥æ›´å¥½çš„åšç¶²çµ¡ä¸Šçš„æµæ§ã€‚</strong></p>
<p>ã€€ã€€Linux ä¸‹çš„ <code>tcp_dsack</code> åƒæ•¸ç”¨æ–¼é–‹å•“é€™å€‹åŠŸèƒ½ï¼ˆLinux 2.4 å¾Œé»˜èªæ‰“é–‹ï¼‰</p>
<p>ã€€ã€€å¥½äº†ï¼Œä¸Šç¯‡å°±åˆ°é€™è£çµæŸäº†ã€‚å¦‚æœä½ è¦ºå¾—æˆ‘å¯«å¾—é‚„æ¯”è¼ƒæ·ºé¡¯æ˜“æ‡‚ï¼Œé‚£éº¼ï¼Œæ­¡è¿ç§»æ­¥çœ‹ä¸‹ç¯‡ã€Š<a href="http://coolshell.cn/articles/11609.html" target="_blank" rel="external">TCPçš„é‚£äº›äº‹ï¼ˆä¸‹ï¼‰</a>ã€‹</p>
<p>ã€€ã€€[åŸæ–‡éˆæ¥ï¼š<a href="http://coolshell.cn/articles/11564.html" target="_blank" rel="external">http://coolshell.cn/articles/11564.html</a>]</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€TCPæ˜¯ä¸€å€‹å·¨è¤‡é›œçš„å”è­°ï¼Œå› çˆ²ä»–è¦è§£æ±ºå¾ˆå¤šå•é¡Œï¼Œè€Œé€™äº›å•é¡Œåˆå¸¶å‡ºäº†å¾ˆå¤šå­å•é¡Œå’Œé™°æš—é¢ã€‚æ‰€ä»¥å­¸ç¿’ TCP æœ¬èº«æ˜¯å€‹æ¯”è¼ƒç—›è‹¦çš„éç¨‹ï¼Œä½†å°æ–¼å­¸ç¿’çš„éç¨‹å»èƒ½è®“äººæœ‰å¾ˆå¤šæ”¶ç©«ã€‚é—œæ–¼ TCP é€™å€‹å”è­°çš„ç´°ç¯€ï¼Œæˆ‘é‚„æ˜¯æ¨è–¦ä½ å»çœ‹ <a href="http://www.kohala.co]]>
    </summary>
    
      <category term="TCP" scheme="http://xcoder.in/tags/TCP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ä¸€å€‹ä»»å‹™éšŠåˆ—çš„ module]]></title>
    <link href="http://xcoder.in/2014/06/03/scartlet-task/"/>
    <id>http://xcoder.in/2014/06/03/scartlet-task/</id>
    <published>2014-06-02T16:17:38.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€äº‹æƒ…å¾ˆæ›²æŠ˜ï¼Œæˆ‘æŸå¤©åœ¨èŒå¦æ”¶éŸ³æ©Ÿè£é¢è½åˆ°äº†ä¸€é¦–æ­Œï¼Œå¾ˆå¥½è½ï¼Œå« <code>hypnotized</code>ï¼Œæ–¼æ˜¯ç´…å¿ƒäº†ã€‚</p>
<p>ã€€ã€€éäº†å¹¾å¤©æˆ‘å†å»è½â€”â€”ç™¼ç¾é€™é¦–æ­Œè®Šäº†ã€‚</p>
<p>ã€€ã€€æœ€å¾Œç¶“éå¤šæ–¹é¢æ±‚è­‰ï¼Œæˆ‘å¤§æ¦‚å¾—å‡ºçµæœå°±æ˜¯æ‡‰è©²æœ‰äººå‚³éŒ¯äº†æ­Œï¼Œç„¶å¾Œå¾Œä¾†æœ‰äººé‡æ–°å‚³äº†ä¸€éï¼Œå°è‡´æˆ‘è½çš„ä¸æ˜¯åŸä¾†é‚£é¦–æ­Œäº†ã€‚é‚£æˆ‘é‚£å¤©è½çš„é‚£é¦–æ­Œåˆ°åº•å«ä»€éº¼åå­—å‘¢ï¼Ÿ</p>
<p>ã€€ã€€ç„¶å¾Œå¤§è‡´çœ‹äº†ä¸€ä¸‹ï¼Œé›–ç„¶æ­Œè¢«é‡æ–°å‚³äº†ï¼Œä½†æ˜¯<a href="http://moe.fm/music/9600" target="_blank" rel="external">é€™è£</a>é¡¯ç¤ºçš„é€™é¦–æ­Œçš„æ™‚é–“æ²’è®Šï¼é‚„æ˜¯11åˆ†é˜ï¼Œç›®æ¸¬æ˜¯æ•¸æ“šåº«æ²’æ›´æ–°ã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯æˆ‘å°±æƒ³äº†å€‹ç¬¨è¾¦æ³•ï¼Œå»çˆ¬æ”¶éŸ³æ©Ÿè£é¢æ‰€æœ‰ tag çˆ² <code>æ±æ–¹project</code> çš„å°ˆè¼¯ï¼Œç„¶å¾Œè·‘åˆ°å°ˆè¼¯é çœ‹æ­Œæ›²çš„é•·åº¦ã€‚</p>
<p>ã€€ã€€å•é¡Œä¾†äº†ï¼Œå¦‚æœæˆ‘ç›´æ¥çˆ¬ï¼Œç„¶å¾Œçˆ¬å®Œ <code>callback</code> ä¹‹å¾Œåˆç›´æ¥çˆ¬ï¼Œæ²’æœ‰ä»»ä½•é–“éš”ï¼Œå°±ç›¸ç•¶æ–¼æˆ‘åœ¨ <code>DDOS</code> å®ƒçš„ç«™å­ã€‚æˆ–è€…å³ä½¿æ²’é‚£éº¼åš´é‡â€”â€”åæ­£æœ€å¾Œåˆ°ä¸€å®šç¨‹åº¦ä½µç™¼å¤ªå¤§æˆ‘å°±è¨ªå•ä¸äº†äº†ã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯æˆ‘å°±æƒ³åˆ°äº†åšä¸€å€‹ä»»å‹™éšŠåˆ—çš„ moduleã€‚è©² module çš„ä½œç”¨å°±æ˜¯æŠŠä¸€å †ä»»å‹™æ‰”åˆ°éšŠåˆ—ä¸­ï¼Œå®Œæˆä¸€å€‹çº”é–‹å§‹ä¸‹ä¸€å€‹ã€‚</p>
<p>ã€€ã€€ç„¶å¾Œå¦‚æœåŒæ™‚åŸ·è¡Œä¸€å€‹ä¹Ÿå¤ªæ…¢ï¼Œmodule é‚„å…è¨±ä½ é–‹å¤šå¹¾å€‹å­éšŠåˆ—åŒæ™‚åŸ·è¡Œã€‚</p>
<p>ã€€ã€€æ¨¡å¡Šçš„ repo åœ¨ <a href="https://github.com/XadillaX/scarlet-task" target="_blank" rel="external">GitHub</a> ä¸Šé¢ã€‚åå­—å« <code>Scarlet Task</code> çš„åŸå› ä¸€æ˜¯æˆ‘æœ¬èº«å°±å–œæ­¡äºŒå°å§ï¼ŒäºŒæ˜¯çˆ²äº†ç´€å¿µé€™æ¬¡äº‹ä»¶æˆ‘æ˜¯çˆ²äº†æ‰¾æœ‰é—œäºŒå°å§çš„æ­Œã€‚</p>
<p>ã€€ã€€è¦å®‰è£ä¹Ÿå¾ˆç°¡å–®ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install scarlet-task</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œ repo çš„ <code>README.md</code> è£é¢æœ‰ä½¿ç”¨æ–¹æ³•çš„â€”â€”å¤§è‡´å°±æ˜¯å¯¦ä¾‹åŒ–ä¸€å€‹å°è±¡ï¼Œç„¶å¾Œå®šç¾©å¥½æŸå€‹ä»»å‹™çš„ä»»å‹™æ¨™è­˜ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ˜¯ json å°è±¡ï¼Œå¯ä»¥æ˜¯ä»»ä½•é¡å‹çš„æ•¸æ“šï¼‰ï¼Œç„¶å¾Œå†å®šç¾©å¥½è™•ç†é€™å€‹ä»»å‹™çš„å‡½æ•¸ï¼Œå°‡é€™å€‹æ•¸æ“šæ¨å€’éšŠåˆ—ä¸­å³å¯ã€‚ç„¶å¾Œåœ¨è™•ç†å‡½æ•¸ä¸­ä»»å‹™è™•ç†å®Œçš„æ™‚å€™åŸ·è¡Œä»¥ä¸‹ä»»å‹™å®Œæˆçš„å‡½æ•¸å³å¯ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€äº‹æƒ…å¾ˆæ›²æŠ˜ï¼Œæˆ‘æŸå¤©åœ¨èŒå¦æ”¶éŸ³æ©Ÿè£é¢è½åˆ°äº†ä¸€é¦–æ­Œï¼Œå¾ˆå¥½è½ï¼Œå« <code>hypnotized</code>ï¼Œæ–¼æ˜¯ç´…å¿ƒäº†ã€‚</p>
<p>ã€€ã€€éäº†å¹¾å¤©æˆ‘å†å»è½â€”â€”ç™¼ç¾é€™é¦–æ­Œè®Šäº†ã€‚</p>
<p>ã€€ã€€æœ€å¾Œç¶“éå¤šæ–¹é¢æ±‚è­‰ï¼Œæˆ‘å¤§æ¦‚å¾—å‡ºçµæœå°±æ˜¯æ‡‰è©²æœ‰äººå‚³éŒ¯äº†æ­Œï¼Œç„¶å¾Œå¾Œä¾†æœ‰äººé‡æ–°å‚³]]>
    </summary>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="ä»»å‹™éšŠåˆ—" scheme="http://xcoder.in/tags/%E4%BB%BB%E5%8B%99%E9%9A%8A%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æ­å»º VIM ä¸‹çš„ Hexo ç·¨è¼¯ç’°å¢ƒ]]></title>
    <link href="http://xcoder.in/2014/06/02/vim-hexo-environment/"/>
    <id>http://xcoder.in/2014/06/02/vim-hexo-environment/</id>
    <published>2014-06-01T20:52:30.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€æœ¬æ–‡åªè¬›å…©å€‹å‡½æ•¸ï¼Œå°æ–¼ <code>markdown</code> å¦‚ä½•é«˜äº®ä¹‹é¡çš„å•é¡Œé‚„è«‹è‡ªè¡Œè°·æ­Œã€‚</p>
<p>ã€€ã€€ç„¶å¾Œè«‹æ‰“é–‹ä½ è‡ªå·±çš„ <code>.vimrc</code> æ–‡ä»¶ã€‚</p>
<h2 id="é å‚™å·¥ä½œ">é å‚™å·¥ä½œ</h2><p>ã€€ã€€é¦–å…ˆå®šç¾©ä¸€å€‹è®Šé‡â€”â€”ä½ è‡ªå·±çš„ <code>hexo</code> ç›®éŒ„ï¼Œå¦‚æœè¦è·¨å¹³è‡ºå¯ä»¥åšå€‹åˆ¤æ–·ä¹‹é¡çš„ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if has(&#34;win32&#34;)&#10;    let g:hexoProjectPath=&#34;E:\\cygwin\\home\\XadillaX\\hexo&#34;&#10;else&#10;    let g:hexoProjectPath=&#34;~/hexo/&#34;&#10;endif</span><br></pre></td></tr></table></figure>
<h2 id="å¹¾å€‹å‡½æ•¸">å¹¾å€‹å‡½æ•¸</h2><h3 id="é€²å…¥_Hexo_ç›®éŒ„">é€²å…¥ Hexo ç›®éŒ„</h3><p>ã€€ã€€é€™å€‹å‡½æ•¸å¤§è‡´å°±æ˜¯è®“ä½ é€²å…¥ä½ è‡ªå·±çš„ <code>Hexo</code> è·¯å¾‘ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fun! OpenHexoProjPath()&#10;    execute &#34;cd &#34; . g:hexoProjectPath&#10;endfun</span><br></pre></td></tr></table></figure>
<h3 id="æ‰“é–‹ä¸€ç¯‡_Post">æ‰“é–‹ä¸€ç¯‡ Post</h3><p>ã€€ã€€æ¥ä¸‹å»å°±æ˜¯ä¸€å€‹æ‰“é–‹ <code>Post</code> çš„å‡½æ•¸äº†ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function! OpenHexoPost(...)&#10;    call OpenHexoProjPath()&#10;&#10;    let filename = &#34;source/_posts/&#34; . a:1 . &#34;.md&#34;&#10;    execute &#34;e &#34; . filename&#10;endfunction</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è§£æï¼šä¸Šé¢çš„ä»£ç¢¼å¤§æ„å°±æ˜¯é€²å…¥ Hexo è·¯å¾‘ï¼Œç„¶å¾Œè¨­å®šå¥½æ–‡ä»¶åï¼Œæœ€å¾ŒåŸ·è¡Œ <code>:e filename</code> å³å¯æ‰“é–‹æ–‡ä»¶äº†ã€‚</p>
</blockquote>
<h3 id="æ–°å»ºä¸€ç¯‡_Post">æ–°å»ºä¸€ç¯‡ Post</h3><p>ã€€ã€€æ–°å»ºçš„æµç¨‹è·Ÿæ‰“é–‹ç›¸ä¼¼ï¼Œåªä¸éé¦–å…ˆè¦åœ¨ <code>Hexo</code> ç›®éŒ„ä¸‹åŸ·è¡Œä¸€é <code>hexo new FOO</code> çš„å‘½ä»¤è€Œå·²ï¼Œå‘½ä»¤åŸ·è¡Œå®Œç•¢ä¹‹å¾Œå†æ‰“é–‹å³å¯ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function! NewHexoPost(...)&#10;    call OpenHexoProjPath()&#10;&#10;    let filename = a:1&#10;    execute &#34;!hexo new &#34; . filename&#10;&#10;    call OpenHexoPost(a:1)&#10;endfunction</span><br></pre></td></tr></table></figure>
<h2 id="æŒ‡ä»¤æ˜ å°„">æŒ‡ä»¤æ˜ å°„</h2><p>ã€€ã€€å‡½æ•¸å¯«å¥½å¾Œæˆ‘å€‘æœ€å¾ŒæŠŠå‡½æ•¸æ˜ å°„æˆé¡ä¼¼æ–¼ <code>:e</code>, <code>:w</code> ä¹‹é¡çš„å¾Œé¢èƒ½è·Ÿç€åƒæ•¸çš„æŒ‡ä»¤å³å¯ã€‚</p>
<p>ã€€ã€€ä»¥å‰æœ¨æœ‰æ¥è§¸éçš„åŒå­¸å¯ä»¥åƒè€ƒä¸€ä¸‹<a href="http://vimdoc.sourceforge.net/htmldoc/usr_40.html#40.2" target="_blank" rel="external">é€™è£</a>çš„æ–‡æª”ã€‚</p>
<h3 id="æ‰“é–‹æŒ‡ä»¤">æ‰“é–‹æŒ‡ä»¤</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command -nargs=+ HexoOpen :call OpenHexoPost(&#34;&#60;args&#62;&#34;)</span><br></pre></td></tr></table></figure>
<h3 id="æ–°å»ºæŒ‡ä»¤">æ–°å»ºæŒ‡ä»¤</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command -nargs=+ HexoNew :call NewHexoPost(&#34;&#60;args&#62;&#34;)</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h2><p>ã€€ã€€ç•¶ä½ åšå®Œä»¥ä¸Šæ­¥é©Ÿçš„æ™‚å€™ï¼Œä½ å°±å¯ä»¥ç„¡è«–åœ¨ä»€éº¼ç›®éŒ„ä¸‹åœ¨ VIM è£é¢é€šéä¸‹é¢çš„æŒ‡ä»¤é€²è¡Œæ–°å»ºä¸€ç¯‡æ—¥èªŒäº†ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:HexoNew artical-name</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä»¥åŠä¸‹é¢çš„æŒ‡ä»¤ä¾†æ‰“é–‹ä¸€ç¯‡å·²å­˜åœ¨çš„æ—¥èªŒï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:HexoOpen artical-name</span><br></pre></td></tr></table></figure>
<h2 id="éºç•™å•é¡Œ">éºç•™å•é¡Œ</h2><p>ã€€ã€€ç›¸ä¿¡çœ‹åˆ°é€™è£ä¹‹å¾Œï¼Œå¤§å®¶ä¹Ÿèƒ½è‡ªå·±å¯«å‡ºä¸€å€‹ç”Ÿæˆçš„æŒ‡ä»¤äº†ï¼Œé€™è£å°±ä¸ç´¯è¿°äº†ï¼Œç„¡éå°±æ˜¯ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:!hexo generate</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€æœ¬æ–‡åªè¬›å…©å€‹å‡½æ•¸ï¼Œå°æ–¼ <code>markdown</code> å¦‚ä½•é«˜äº®ä¹‹é¡çš„å•é¡Œé‚„è«‹è‡ªè¡Œè°·æ­Œã€‚</p>
<p>ã€€ã€€ç„¶å¾Œè«‹æ‰“é–‹ä½ è‡ªå·±çš„ <code>.vimrc</code> æ–‡ä»¶ã€‚</p>
<h2 id="é å‚™å·¥ä½œ">é å‚™å·¥ä½œ</h2><p>ã€€ã€€é¦–å…ˆå®šç¾©ä¸€å€‹è®Šé‡â€”]]>
    </summary>
    
      <category term="hexo" scheme="http://xcoder.in/tags/hexo/"/>
    
      <category term="vim" scheme="http://xcoder.in/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ã€ŒNBUT 2014 æ ¡è³½Â·ç¶²çµ¡åŒæ­¥è³½ã€é¡Œè§£ (æœªå®Œæˆ...)]]></title>
    <link href="http://xcoder.in/2014/05/05/nbut-2014-acm-contest-solution/"/>
    <id>http://xcoder.in/2014/05/05/nbut-2014-acm-contest-solution/</id>
    <published>2014-05-05T07:08:39.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€é€™æ¬¡æ¯”è³½ç”± <a href="http://blog.163.com/surgy_han/" target="_blank" rel="external">Hungar</a>ï¼Œ<a href="http://www.cnblogs.com/Wine93/" target="_blank" rel="external">8Mao</a> ä»¥åŠæˆ‘è² è²¬çš„ã€‚æ˜æ˜éƒ½è®€ç ”äº†ï¼Œé‚„è©å±å›ä¾†å‡ºé¡Œâ€”â€”æ­¸çµèµ·ä¾†å¤§æ¦‚æ˜¯å› çˆ²å„ç¨®é¢è©¦ä¸é †å§ï¼Œæƒ³ä¾†è™è™å­¸å¼Ÿå¦¹å€‘æ€’åˆ·å­˜åœ¨æ„Ÿã€‚çµæœç¶²çµ¡è³½é‚„æ˜¯è¢«è™å¾—æ­»å»æ´»ä¾†ã€‚ï¼ˆæœç„¶æˆ‘æ˜¯è’Ÿè’» (â—“Ğ”â—’)âœ„â•°â‹ƒâ•¯</p>
<p>ã€€ã€€å¥½äº†å»¢è©±ä¸å¤šèªªï¼Œé‚„æ˜¯ç›´æ¥ä¸Šé¡Œè§£å§ã€‚</p>
<h2 id="Minecraft_Server_Bug">Minecraft Server Bug</h2><p>ã€€ã€€é¡Œæ„å¤§æ¦‚å°±æ˜¯èªªä¸€æ’å·–æ¼¿å’Œæ°´ï¼Œä½ è¦æ‹¿ä¸€æ¡¶æ°´å’Œå·–æ¼¿ï¼Œä¸¦ä¸”æ°´çš„ä¸‹æ¨™å°æ–¼å·–æ¼¿ã€‚</p>
<p>ã€€ã€€çˆ²äº†æ›´ä¾¿æ–¼ç†è§£ï¼Œæˆ‘å€‘å¾å¾Œå¾€å‰åšã€‚é¦–å…ˆå°‡åºåˆ—è®€é€²ä¾†ä¹‹å¾Œå¾å¾Œå¾€å‰éæ­·â€”â€”è‹¥æ˜¯å·–æ¼¿ï¼Œé‚£éº¼å·–æ¼¿æ•¸åŠ ä¸€ï¼Œå¦‚æœæ˜¯æ°´ï¼Œé‚£éº¼é€™æ¡¶æ°´èƒ½é¸æ“‡å¾Œé¢å·–æ¼¿çš„ä»»æ„ä¸€æ¡¶ï¼Œä¹Ÿå°±æ˜¯èªªç­”æ¡ˆåŠ ä¸Šç•¶å‰çš„å·–æ¼¿æ•¸å³å¯ã€‚</p>
<blockquote>
<p>æ³¨æ„ç”¨ <code>__int64</code>ã€‚</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">char</span> ch[<span class="number">1000005</span>];</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d\n"</span>, &amp;n))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> tmp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%c%c"</span>, ch + i, &amp;tmp);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        __int64 ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(ch[i] == <span class="string">'L'</span>) cnt++;</span><br><span class="line">            <span class="keyword">else</span> ans += (__int64)cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Beautiful_Walls">Beautiful Walls</h2><p>ã€€ã€€ä¸€å µç‰†ï¼Œæ¯å–®ä½é«˜åº¦ä¸å®šã€‚ä½ éœ€è¦é¸æ“‡å…¶ä¸­ä»»æ„é€£çºŒçš„ç‰†ï¼Œä½¿å¾—ä½ é¸æ“‡çš„ç‰†æ¯å–®ä½çš„é«˜åº¦éƒ½æ˜¯å”¯ä¸€çš„â€”â€”å•æœ‰å¤šå°‘ç¨®é¸æ³•ã€‚</p>
<p>ã€€ã€€å…ˆæ±‚å‡ºç¸½çš„ç¨®æ•¸ï¼Œç„¶å¾Œæ±‚ä¸æ»¿è¶³çš„æ•¸é‡ï¼Œæœ€å¾Œç”¨ç¸½æ•¸æ¸›å»ä¸æ»¿è¶³æ•¸å³çˆ²ç­”æ¡ˆã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> lint long long</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> N <span class="number">100005</span></span></span><br><span class="line"><span class="keyword">int</span> p[N], A[N];</span><br><span class="line"><span class="function">lint <span class="title">solution</span><span class="params">(lint n)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(p, -<span class="number">1</span>, <span class="keyword">sizeof</span>(p));</span><br><span class="line">    lint ans = n * (n + <span class="number">1</span>) / <span class="number">2</span>, Max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(lint i=<span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(~p[A[i]])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Max &lt; p[A[i]]) Max = p[A[i]];</span><br><span class="line">            p[A[i]] = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            p[A[i]] = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ans -= Max;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, x;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, A + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, solution(n));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€é€™æ¬¡æ¯”è³½ç”± <a href="http://blog.163.com/surgy_han/" target="_blank" rel="external">Hungar</a>ï¼Œ<a href="http://www.cnblogs.com/Wine93/" targe]]>
    </summary>
    
      <category term="ACM" scheme="http://xcoder.in/tags/ACM/"/>
    
      <category term="ç®—æ³•" scheme="http://xcoder.in/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="ACM" scheme="http://xcoder.in/categories/ACM/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æ­»æœˆå‡ºå“ï¼šHero Snake è‹±é›„è›‡]]></title>
    <link href="http://xcoder.in/2014/04/11/hero-snake/"/>
    <id>http://xcoder.in/2014/04/11/hero-snake/</id>
    <published>2014-04-11T05:53:35.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>æ³¨ï¼šå‚™ä»½åˆ°é€™ç¯‡æ—¥èªŒçš„æ™‚å€™ï¼Œæ„Ÿè¦ºçœ¼ç›é€²äº†ä»€éº¼å¥‡æ€ªçš„æ±è¥¿ã€‚ï¼ˆæ‰â€¦â€¦çº”ä¸æ˜¯çœ¼æ·šå‘¢ï¼Œé‚£ä¸€å®šæ˜¯æ²™å­ï¼(;Â´à¼àº¶Ğ”à¼àº¶`)</p>
<p>ä¸»è¦å¼•èµ·æ„Ÿå‚·çš„é‚„æ˜¯é€™é¦–è»’è½…åŠçš„ BGM å§ã€‚å› çˆ² Hero Snake çš„BGMå°±æ˜¯é€™å€‹ã€‚</p>
<p>é€™ç¯‡æ–‡ç« åŸæ–‡æ˜¯åœ¨ 2011å¹´5æœˆ1æ—¥ ç™¼çš„ã€‚éŠæˆ²æ˜¯è·Ÿ <strong>MatRush</strong> åœ¨2011å¹´å¯’å‡ä¸€èµ·å¯«çš„ï¼Œé›–ç„¶æ˜¯æˆ‘é‚Šæ•™é‚Šå¯«çš„ã€‚å‘µå‘µï¼Œè½‰çœ¼é–“ä¸‰å¹´éå»äº†ã€‚</p>
<p>æƒ³ç•¶å¹´æˆ‘é‚„æ˜¯é‚£éº¼åŸ·ç€æ–¼éŠæˆ²è¡Œæ¥­ï¼Œç¾åœ¨ç³¾çµæ–¼åˆ°åº•è¦å¾äº‹éŠæˆ²è¡Œæ¥­é‚„æ˜¯äº’è¯ç¶²å‘¢ï¼ŸåŠå¹´çœŸçš„èƒ½æ”¹è®Šå¾ˆå¤šï¼Œè¦æ˜¯æˆ‘ç•¶æ™‚æ²’æœ‰å»æ±½æ—ç¶²å¯¦ç¿’ï¼Œä¹Ÿè¨±ç¾åœ¨ä¸¦ä¸æœƒæœ‰é‚£éº¼å¤§çš„æ”¹è®Šå§ã€‚</p>
<p>è‡ªå¾è¢« <a href="http://weibo.com/shyvo" target="_blank" rel="external">@æ¨¸å¤§</a> åˆ·äº†ä¹‹å¾Œï¼Œæˆ‘åˆé–‹å§‹ç€é‡è€ƒæ…®äº†ã€‚æ˜¯ä¸æ˜¯æˆ‘ç©äº’è¯ç¶²åªæ˜¯è¦ºå¾—æ–°é®®å¥½ç©è€Œå·²å‘¢ï¼Ÿç•¢ç«Ÿæˆ‘æ˜¯åŠè·¯å‡ºå®¶çš„ï¼Œé›–ç„¶æœ‰ç€åä¾†å¹´çš„ <code>Webç¶“æ­·</code>ï¼Œä½†é‚£éƒ½æ˜¯å°æ‰“å°é¬§å“‡ã€‚é‚„è¨˜å¾—å°å­¸çš„æ™‚å€™è²·çš„ç¬¬ä¸€æœ¬é›»è…¦æ›¸â€”â€”<a href="http://www.amazon.cn/%E5%9C%A8%E7%BD%91%E4%B8%8A%E5%AE%89%E4%B8%AA%E5%AE%B6-%E6%9C%B1%E6%83%A0%E5%BC%BA/dp/B0011A9QSA/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1397196202&amp;sr=1-1&amp;keywords=%E5%9C%A8%E7%BD%91%E4%B8%8A%E5%AE%89%E4%B8%AA%E5%AE%B6" target="_blank" rel="external">ã€Šåœ¨ç¶²ä¸Šå®‰å€‹å®¶ã€‹</a>ï¼Œåˆ°ç¾åœ¨é‚„è¨˜å¾—é‚£å€‹æ™‚å€™æ§ç€æ›¸çš„æ¿€å‹•å¿ƒæƒ…ã€‚</p>
<p>æˆ‘æ˜¯ä¸æ˜¯æœ‰é»åé›¢äº†è‡ªå·±æœ¬èº«çš„è»Œé“å‘¢ï¼Ÿç¸½ä¹‹é‚„æ˜¯åœ¨é€™å…©å¡Šé ˜åŸŸçŒ¶è±«ä¸æ±ºã€‚</p>
<p>å»¢è©±æœ‰é»æ‰¯é äº†ï¼Œé‚„æ˜¯æŠŠæ–‡ç« å¾ Capture å‚™ä»½å›ä¾†å†èªªå§ã€‚</p>
</blockquote>
<p>ã€€ã€€é€™æ˜¯ä¸€æ¬¾æ­£å®—åŸºæ–¼HGEçš„å°éŠæˆ²ï¼Œç®—æ˜¯æˆ‘åšçš„éŠæˆ²ä¸­è‡ªå·±æ¯”è¼ƒæ»¿æ„çš„å°éŠæˆ²å§ã€‚</p>
<p>ã€€ã€€å¹•å¾Œæ•…äº‹æ˜¯é€™æ¨£çš„ï¼šMatRushå¯’å‡æ‰¾æˆ‘ä¸€èµ·åšéŠæˆ²ï¼Œå› çˆ²ä»–å€‘å­¸æ ¡å¼„äº†ä¸€å€‹è›‹ç–¼çš„éŠæˆ²è£½ä½œæ¯”è³½ã€‚ç„¶å¾Œå‘½é¡Œæ˜¯è²ªåƒè›‡ï¼Œæ–¼æ˜¯æˆ‘å€‘åŠ äº†ä¸€é»è‡ªå·±çš„å°å‰µæ„ï¼Œçµ¦ä»–è¬›è§£äº†ä¸€äº›HGEçš„åŸºç¤ä¹‹å¾Œï¼Œå°±å¯«äº†é€™å€‹éŠæˆ²äº†ã€‚ç„¶å¾Œå› çˆ²æˆ‘å€‘éƒ½æ¯”è¼ƒå–œæ­¡è»’è½…åŠï¼Œæ–¼æ˜¯BGMå°±æ˜¯è»’è½…åŠçš„ã€Šæ°¸é çš„ä¸‰å€‹äººçš„å¿«æ¨‚æ™‚å…‰ã€‹ï¼Œç”±æ–¼MatRushæ¯”è¼ƒå–œæ­¡MapleStoryï¼Œä¾¿æœ‰äº†ç´ ææ˜¯é‚£äº›åƒç´ ç•«é¢ã€‚</p>
<p>ã€€ã€€é¦–å…ˆé€™å€‹éŠæˆ²æœ‰å…©ç¨®æ¨¡å¼ï¼šå–®äººæ¨¡å¼å’Œé›™äººæ¨¡å¼ã€‚</p>
<p>ã€€ã€€é—œæ–¼å–®äººæ¨¡å¼ï¼Œé€™æ˜¯ä¸€å€‹é—–é—œå‹æ¨¡å¼ï¼Œå¤§å®¶åœ¨æ¯ä¸€é—œå¿…é ˆé€šéåƒé“å…·ç²å¾—ä¸€å®šçš„åˆ†æ•¸ä»¥åŠåƒåœˆåœˆç²å¾—ä¸€å®šåœˆåœˆæ•¸æ‰èƒ½é–‹å•“é€šå¾€ä¸‹ä¸€é—œçš„é–€ï¼Œé»˜èªä¸€å…±20é—œï¼Œå¯ä»¥è‡ªå·±ç·¨è¼¯é—œå¡ï¼Œé€™æ˜¯å¾Œè©±ã€‚ä¸‹é¢æ˜¯å¹¾ç¨®é“å…·çš„è§£èªªï¼š</p>
<blockquote>
<p><img src="treasure0.png" alt="é–‹å±±æ–§"></p>
<p>é–‹å±±æ–§ï¼šæ’¿åˆ°é€™è²¨éš¨æ©Ÿç²å¾—1~3å€‹æ–§é ­ä¸¦ä¸”é™„è´ˆ100åˆ†æ•¸ã€‚æ–§é ­çš„ä½œç”¨æ˜¯èƒ½ç ´é–‹æœ¨æ¡¶ï¼Œå®‰å…¨é€šéï¼Œä¸€å€‹æ–§é ­ç”¨ä¸€æ¬¡ã€‚æ–§é ­æ•¸åœ¨å·¦ä¸‹è§’çš„Axe(s)å¾Œé¢ã€‚</p>
<p><img src="treasure1.png" alt="å‘½é‹ä¹‹å‰ª"></p>
<p>å‘½é‹ä¹‹å‰ªï¼šæ’¿åˆ°é€™å€‹ä¹‹å¾Œç²å¾—100åˆ†ä¸¦ä¸”çµ¦ä½ æ–·æ‰ä¸€å€‹å°¾å·´ä»¥é™ä½é›£åº¦ã€‚</p>
<p><img src="treasure2.png" alt="é™é€Ÿå™¨"></p>
<p>é™é€Ÿå™¨ï¼šå› çˆ²ä½ æ¯åƒä¸€å€‹åœˆåœˆæœƒå¢åŠ ä¸€å®šé€Ÿåº¦ï¼Œè€Œé€™å€‹é™é€Ÿå™¨æ˜¯é™ä½ä½ çš„é€Ÿåº¦è®“ä½ å®¹æ˜“äº›ã€‚ä¸¦ä¸”é™„è´ˆ100åˆ†ã€‚</p>
<p><img src="treasure8.png" alt="è—¥æ°´"></p>
<p>è—¥æ°´ï¼šè—¥æ°´æ˜¯è£é£¾è®Šè‰²ç”¨çš„ï¼Œå…¶å¯¦æ˜¯é€åˆ†çš„ã€‚å‰å››ç¨®è—¥æ°´100åˆ†ï¼Œç´«è‰²çš„300åˆ†ã€‚</p>
<p><img src="treasure3.png" alt="é™é€Ÿå™¨"></p>
<p>éª·é«é ­ï¼šæƒ³æ­»çš„è©±å°±ç¢°ç¢°å®ƒè©¦è©¦ã€‚</p>
<p><img src="door.png" alt="å‚³é€é–€"></p>
<p>å‚³é€é–€ï¼šé‡åˆ°é€™è²¨å°±èªªæ˜ä½ åŠŸå¾·åœ“æ»¿äº†ã€‚æ­å–œï¼Œå¯ä»¥é€šéå®ƒå‰å¾€ä¸‹ä¸€é—œã€‚</p>
</blockquote>
<p>ã€€ã€€æ¥ä¸‹å»æ˜¯é›™äººæ¨¡å¼ã€‚é›™äººæ¨¡å¼å› çˆ²ç•¶åˆè¨­æƒ³æœ‰äº›å•é¡Œï¼Œæ‰€ä»¥å¯¦ç¾èµ·ä¾†åƒ…åƒ…æ˜¯ç°¡å–®çš„é›™äººèµ°å•Šèµ°ï¼Œçœ‹èª°ç¢°åˆ°èª°èª°å°±è¼¸ã€‚åœ¨é›™äººæ¨¡å¼ä¸­ï¼Œå…ˆè¦é¸æ“‡ä¸€å¼µå°æˆ°åœ°åœ–ï¼Œç„¶å¾Œé–‹å§‹é›™äººèµ°å•Šèµ°å•Šèµ°ã€‚</p>
<p>ã€€ã€€ç„¶å¾ŒRankæ˜¯æ’è¡Œæ¦œï¼ŒOptionæ˜¯éŠæˆ²çš„ä¸€äº›é¸é …ï¼ŒIntroductionæ˜¯éŠæˆ²ä»‹ç´¹ï¼Œé€™å€‹ä»‹ç´¹æœ‰äº›è›‹ç–¼ï¼Œæœ€å¾Œä¸ç”¨èªªExitå°±æ˜¯é€€å‡ºäº†ã€‚</p>
<p>ã€€ã€€ä¸‹é¢æ˜¯é—œæ–¼åœ°åœ–ç·¨è¼¯å™¨çš„èªªæ˜ï¼š</p>
<p>ã€€ã€€é¦–å…ˆåœ¨éŠæˆ²ç›®éŒ„å°æœ‰ä¸€å€‹config.iniæ–‡ä»¶ï¼Œæ˜¯ä¸€äº›éŠæˆ²è¨­ç½®ã€‚å…¶ä¸­levelnumæ˜¯éŠæˆ²é—œå¡æ•¸ã€‚æ³¨æ„é€™å€‹æ•¸å­—å¿…é ˆè¦è·Ÿåœ°åœ–æ•¸é‡ä¸€è‡´æˆ–è€…å°æ–¼å®ƒï¼Œå¦å‰‡æœƒå› çˆ²æ‰¾ä¸åˆ°ä¹‹å¾Œçš„åœ°åœ–è€Œå‡ºéŒ¯ã€‚åœ°åœ–å°±å­˜åœ¨dataè£ï¼Œå‘½åæ–¹å¼æ˜¯mapX.txtï¼Œå¾0é–‹å§‹ã€‚åœ°åœ–ç·¨è¼¯å™¨å‰‡åœ¨MapEditoræ–‡ä»¶å¤¾ä¸‹ã€‚æ“ä½œå¾ˆç°¡å–®ï¼Œèªªæ˜éƒ½åœ¨ç·¨è¼¯å™¨ä¸‹æ–¹çš„æ–‡å­—ä¸Šï¼Œå°±å¹¾å€‹å¿«æ·éµã€‚å¯ä»¥ç”¨é¼ æ¨™æ“ä½œä¹Ÿå¯ä»¥ç”¨ä¸Šä¸‹å·¦å³æ§åˆ¶æ–¹å‘ã€‚</p>
<p>ã€€ã€€æœ€å¾Œï¼Œé ç¥å¤§å®¶ç©å¾—æ„‰å¿«ã€‚é™„ä¸Šä¸‹è¼‰åœ°å€å’Œå¹¾å¼µé è¦½åœ–å§ï¼š</p>
<p>ã€€ã€€<a href="bin.7z">é»æ“Šä¸‹è¼‰</a></p>
<p>ã€€ã€€<a href="https://github.com/XadillaX/hero-snake" target="_blank" rel="external">ä»£ç¢¼åœ°å€</a></p>
<p><img src="1.png" alt="æ¨™é¡Œç•«é¢"><br><img src="2.png" alt="ç©çš„ç•«é¢"><br><img src="4.png" alt="é›™äººæ¨¡å¼"></p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>æ³¨ï¼šå‚™ä»½åˆ°é€™ç¯‡æ—¥èªŒçš„æ™‚å€™ï¼Œæ„Ÿè¦ºçœ¼ç›é€²äº†ä»€éº¼å¥‡æ€ªçš„æ±è¥¿ã€‚ï¼ˆæ‰â€¦â€¦çº”ä¸æ˜¯çœ¼æ·šå‘¢ï¼Œé‚£ä¸€å®šæ˜¯æ²™å­ï¼(;Â´à¼àº¶Ğ”à¼àº¶`)</p>
<p>ä¸»è¦å¼•èµ·æ„Ÿå‚·çš„é‚„æ˜¯é€™é¦–è»’è½…åŠçš„ BGM å§ã€‚å› çˆ² Hero Snake çš„BGMå°±æ˜¯é€™å€‹ã€‚</p>
<p>é€™ç¯‡æ–‡ç« åŸæ–‡æ˜¯åœ¨]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="HGE" scheme="http://xcoder.in/tags/HGE/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="éŠæˆ²é–‹ç™¼" scheme="http://xcoder.in/tags/%E9%81%8A%E6%88%B2%E9%96%8B%E7%99%BC/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[è®“Node.jså’ŒC++ä¸€èµ·æåŸº â€”â€” 3 (æœªå®Œæˆ...)]]></title>
    <link href="http://xcoder.in/2014/04/06/nodejs-cpp-addons-3/"/>
    <id>http://xcoder.in/2014/04/06/nodejs-cpp-addons-3/</id>
    <published>2014-04-06T08:15:39.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€<a href="/2014/04/03/nodejs-cpp-addons-2/">ä¸Šä¸€ç« </a>æˆ‘å€‘å·å·å­¸ç¿’ç­å¦‚ä½•åœ¨ <code>C++</code> ä¸­å¯¦ç¾ <code>Node.js</code> èª¿ç”¨æ™‚å‚³åƒæ•¸å’Œèª¿ç”¨å›èª¿å‡½æ•¸ï¼Œä¸¦ä¸”æˆ‘è‡ªå·±ä¹Ÿå¿ƒè¡€ä¾†æ½®å¯«äº†å€‹<a href="/2014/04/05/cpp-class-inline-keng/#simpleini">å° Demo</a> ä¾›å¤§å®¶åƒè€ƒã€‚</p>
<p>ã€€ã€€ä»Šå¤©æˆ‘å€‘å°±ä¸è¤‡ç¿’äº†ï¼Œç›´æ—é»ƒé¾å§ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€<a href="/2014/04/03/nodejs-cpp-addons-2/">ä¸Šä¸€ç« </a>æˆ‘å€‘å·å·å­¸ç¿’ç­å¦‚ä½•åœ¨ <code>C++</code> ä¸­å¯¦ç¾ <code>Node.js</code> èª¿ç”¨æ™‚å‚³åƒæ•¸å’Œèª¿ç”¨å›èª¿å‡½æ•¸ï¼Œä¸¦ä¸”æˆ‘è‡ªå·±ä¹Ÿå¿ƒè¡€ä¾†æ½®å¯«äº†å€‹<a hr]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="NodeJS" scheme="http://xcoder.in/categories/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[C++ä¸­é¡æˆå“¡å‡½æ•¸ inline çš„å‘]]></title>
    <link href="http://xcoder.in/2014/04/05/cpp-class-inline-keng/"/>
    <id>http://xcoder.in/2014/04/05/cpp-class-inline-keng/</id>
    <published>2014-04-05T08:55:57.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€ä»Šå¤©æˆ‘ä¾†è¬›ä¸€è¬› <code>C++</code> ä¸­é¡æˆå“¡å‡½æ•¸ <code>inline</code> ä¿®é£¾ç¬¦çš„ä¸€å€‹å‘ã€‚</p>
<p>ã€€ã€€é€™å€‹å‘æ˜¯æˆ‘åœ¨å˜—è©¦ç€å¯«æˆ‘çš„ç¬¬ä¸€å€‹ <code>Node.js</code> æ“´å±• <code>simpleini</code> æ™‚å€™é‡åˆ°çš„ã€‚</p>
<h2 id="å‘æè¿°">å‘æè¿°</h2><p>ã€€ã€€å› çˆ²åªæ˜¯å˜—è©¦ç€å¯«ï¼Œæ‰€ä»¥æ‡¶å¾—è‡ªå·±å¯¦ç¾ï¼Œæ–¼æ˜¯ç¶²ä¸Šæ‰¾äº†å€‹é–‹æºçš„ <code>C++</code> é–±è®€ ini æ–‡ä»¶çš„é …ç›®ï¼Œåä¸è¦‹ç¶“å‚³ï¼Œå« <a href="http://miniini.tuxfamily.org/" target="_blank" rel="external">miniini</a>ã€‚</p>
<p>ã€€ã€€å¥½äº†ï¼Œå•é¡Œä¾†äº†ï¼Œç•¶æˆ‘å¯«å¥½æˆ‘çš„æºæ–‡ä»¶çš„æ™‚å€™ï¼Œç„¶å¾Œå¯«å¥½äº†æˆ‘çš„ <code>binding.gyp</code> ï¼Œç¸½ä¹‹ä¸€åˆ‡å¤§åŠŸå‘Šæˆé–‹å§‹ç·¨è­¯çš„æ™‚å€™â€”â€” <code>Windows</code> ä¸‹æ²’å•é¡Œï¼Œ<code>MacOS</code> ä¸‹ä¹Ÿå¯ä»¥æ­£å¸¸é‹è¡Œï¼Œä½†æ˜¯åœ¨ <code>Linux</code> ä¸‹å°±å‡ºå•é¡Œäº†ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node: symbol lookup err: .../simpleIni.node: undefined symbol: _ZNK10INISection10ReadStringEPKcRS1_</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¤§è‡´çš„æ„æ€å‘¢å°±æ˜¯èªªæ‰¾ä¸åˆ° <code>INISection</code> çš„ <code>ReadString</code> å‡½æ•¸ç¬¦è™Ÿã€‚</p>
<h2 id="å•é¡Œåˆ†æ">å•é¡Œåˆ†æ</h2><p>ã€€ã€€åˆæ˜¯æ‡·ç€å´‡æ•¬çš„å¿ƒæƒ…å» <a href="http://stackoverflow.com/questions/22868307/undefined-symbol-in-node-js-c-addon-under-linux-why" target="_blank" rel="external">SO</a> æ±‚è§£äº†ã€‚</p>
<p>ã€€ã€€æœ€å¾Œçš„è§£ç­”å¤§æ¦‚<a href="http://isocpp.org/wiki/faq/inline-functions#inline-member-fns" target="_blank" rel="external">å¦‚ä¸‹</a>ï¼š</p>
<blockquote>
<p>å…§è¯æˆå“¡å‡½æ•¸çš„è²æ˜çœ‹èµ·ä¾†åƒä¸€å€‹éå…§è¯å‡½æ•¸çš„è²æ˜ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Fred &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">char</span> c)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ä½ çš„å…§æ–‚æˆå“¡å‡½æ•¸å®šç¾©å‰é¢åˆåŠ äº† <code>inline</code> é€™å€‹é—œéµå­—æ™‚ï¼Œä½ å¿…é ˆæŠŠé€™å€‹å®šç¾©æ”¾åˆ°é ­æ–‡ä»¶ä¸­ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span></span><br><span class="line"><span class="keyword">void</span> Fred::f(<span class="keyword">int</span> i, <span class="keyword">char</span> c)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€™éº¼åšçš„åŸå› å°±æ˜¯çˆ²äº†é¿å…éˆæ¥å™¨ <code>unresolved external</code> çš„ç™¼ç”Ÿã€‚å¦‚æœä½ ä¸é€™éº¼åšï¼Œé€™å€‹éŒ¯èª¤å°±å°‡æœƒåœ¨ä½ å¾å¦å¤–ä¸€å€‹ <code>.cpp</code> æ–‡ä»¶ä¸­èª¿ç”¨å®ƒæ™‚å‡ºç¾ã€‚</p>
</blockquote>
<p>ã€€ã€€å¥½å˜›ï¼ŒåŸä¾†æ˜¯åŸä½œè€…è‡ªå·±å¯«çš„ä»£ç¢¼æœ‰å•é¡Œå•Šã€‚ä½†æ˜¯ä¸å¾—ä¸èªªä¸€ä¸‹åˆæ¼²å§¿å‹¢äº†ã€‚C++é‚„çœŸæ˜¯æœ‰åƒå¥‡ç™¾æ€ªçš„å‘å’ŒéŒ¯èª¤å•Šã€‚</p>
<h2 id="è§£æ±ºæ–¹æ¡ˆ">è§£æ±ºæ–¹æ¡ˆ</h2><p>ã€€ã€€æœ€å¾Œçš„è§£æ±ºæ–¹æ¡ˆå¤§è‡´å°±æ˜¯æŠŠå‡½æ•¸å®šç¾©æ”¾åˆ°é ­æ–‡ä»¶ä¸­å»ï¼Œæˆ–è€…åœ¨å‡½æ•¸è²æ˜å‰é¢ä¹ŸåŠ ä¸Š <code>inline</code> é—œéµå­—ã€‚</p>
<h2 id="simpleini">simpleini</h2><p>ã€€ã€€æˆ‘çš„ç¬¬ä¸€å€‹ <code>C++</code> æ¨¡å¡Šï¼Œå« <code>simpleini</code> ï¼Œå…¶å¯¦åªæ˜¯æŠ±ç€è©¦è©¦çœ‹ <code>Node.j</code> çš„ <code>C++</code> æ¨¡å¡Šæ˜¯ä¸æ˜¯é€™éº¼å¯«çš„è€Œå·²ï¼Œä¸¦æ²’æœ‰å¤šå¤§å¯¦éš›ç”¨è™•ã€‚Repo åœ¨ <a href="https://github.com/XadillaX/node-simple-ini" target="_blank" rel="external">Github</a> ä¸Šã€‚</p>
<p>ã€€ã€€ç„¶å¾Œç”¨æ³•å¾ˆç°¡å–®ï¼Œå…ˆå®‰è£ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install simpleini</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œä¸‹é¢çš„ä»£ç¢¼å°±æ˜¯ä¾‹å­äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> simpleIni = <span class="built_in">require</span>(<span class="string">"simpleini"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.open(<span class="string">"./node_modules/simpleini/src/miniini-0.9/test/test.ini"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.read(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.read(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"d"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.read(<span class="string">"SETTINGS"</span>, <span class="string">"sections"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.read(<span class="string">"vals"</span>, <span class="string">"float"</span>));</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è®€å–é…ç½®çš„æ™‚å€™ç¬¬ä¸€å€‹åƒæ•¸æ˜¯ <code>Section</code>ï¼Œç¬¬äºŒå€‹åƒæ•¸æ˜¯ <code>Key</code>ï¼Œç¬¬ä¸‰å€‹åƒæ•¸æ˜¯å–ä¸åˆ°è©²å€¼æ™‚çš„é»˜èªå€¼ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€ä»Šå¤©æˆ‘ä¾†è¬›ä¸€è¬› <code>C++</code> ä¸­é¡æˆå“¡å‡½æ•¸ <code>inline</code> ä¿®é£¾ç¬¦çš„ä¸€å€‹å‘ã€‚</p>
<p>ã€€ã€€é€™å€‹å‘æ˜¯æˆ‘åœ¨å˜—è©¦ç€å¯«æˆ‘çš„ç¬¬ä¸€å€‹ <code>Node.js</code> æ“´å±• <code>simpleini</code> æ™‚å€™]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="Programming" scheme="http://xcoder.in/tags/Programming/"/>
    
      <category term="Programming" scheme="http://xcoder.in/categories/Programming/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[è®“Node.jså’ŒC++ä¸€èµ·æåŸº â€”â€” 2]]></title>
    <link href="http://xcoder.in/2014/04/03/nodejs-cpp-addons-2/"/>
    <id>http://xcoder.in/2014/04/03/nodejs-cpp-addons-2/</id>
    <published>2014-04-03T14:37:15.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€å¥½ï¼Œä»Šå¤©è®“æˆ‘å€‘æ›´æ·±å…¥åœ°æåŸºå§ï¼</p>
<h2 id="æº«æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥çˆ²æº¼çŸ£">æº«æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥çˆ²æº¼çŸ£</h2><p>ã€€ã€€é¦–å…ˆè«‹å¤§å®¶è¨˜ä½é€™å€‹ V8 çš„åœ¨ç·šæ‰‹å†Šâ€”â€”<a href="http://izs.me/v8-docs/main.html" target="_blank" rel="external">http://izs.me/v8-docs/main.html</a>ã€‚</p>
<p>ã€€ã€€é‚„è¨˜å¾—ä¸Šæ¬¡çš„ <code>building.gyp</code> æ–‡ä»¶å—ï¼Ÿ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">targets</span>": <span class="value">[</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">target_name</span>": <span class="value"><span class="string">"addon"</span></span>,</span><br><span class="line">      "<span class="attribute">sources</span>": <span class="value">[ <span class="string">"addon.cc"</span> ]</span><br><span class="line">    </span>&#125;</span><br><span class="line">  ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å°±åƒé€™æ¨£ï¼Œèˆ‰ä¸€åä¸‰ï¼Œå¦‚æœå¤šå¹¾å€‹ <code>*.cc</code> æ–‡ä»¶çš„è©±å°±æ˜¯é€™æ¨£çš„ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"sources": [ "addon.cc", "myexample.cc" ]</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä¸Šæ¬¡æˆ‘å€‘æŠŠå€†æ­¥é©Ÿåˆ†é–‹äº†ï¼Œå¯¦éš›ä¸Šé…ç½®å’Œç·¨è­¯å¯ä»¥æ”¾åœ¨ä¸€èµ·çš„ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node-gyp configure build</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è¤‡ç¿’å®Œäº†å—ï¼Ÿæ²’ï¼Ÿï¼</p>
<p><img src="mama.jpg" alt="å•ª"></p>
<p>ã€€ã€€å¥½çš„ï¼Œé‚£æˆ‘å€‘ç¹¼çºŒå§ã€‚</p>
<h2 id="è¡¨ç•ª">è¡¨ç•ª</h2><h3 id="å‡½æ•¸åƒæ•¸">å‡½æ•¸åƒæ•¸</h3><p>ã€€ã€€ç¾åœ¨æˆ‘å€‘çµ‚æ–¼è¦è¬›åƒæ•¸äº†å‘¢ã€‚</p>
<p>ã€€ã€€è®“æˆ‘å€‘è¨­æƒ³æœ‰é€™æ¨£ä¸€å€‹å‡½æ•¸ <code>add(a, b)</code> ä»£è¡¨æŠŠ <code>a</code> å’Œ <code>b</code> ç›¸åŠ è¿”å›çµæœï¼Œæ‰€ä»¥å…ˆæŠŠå‡½æ•¸å¤–æ¡†å¯«å¥½ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;node.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> v8;</span><br><span class="line"></span><br><span class="line">Handle&lt;Value&gt; Add(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//... åˆä¾†ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Arguments">Arguments</h4><p>ã€€ã€€é€™å€‹å°±æ˜¯å‡½æ•¸çš„åƒæ•¸äº†ã€‚æˆ‘å€‘ä¸å¦¨å…ˆçœ‹çœ‹ v8 çš„<a href="http://izs.me/v8-docs/classv8_1_1Arguments.html" target="_blank" rel="external">å®˜æ–¹æ‰‹å†Šåƒè€ƒ</a>ã€‚</p>
<ul>
<li><code>int Length() const</code></li>
<li><code>Local&lt;Value&gt; operator[](int i) const</code></li>
</ul>
<p>ã€€ã€€å…¶å®ƒçš„æˆ‘å€‘å’±ä¸é—œå¿ƒï¼Œé€™å…©å€‹å¯é‡è¦äº†ï¼ä¸€å€‹ä»£è¡¨å‚³å…¥å‡½æ•¸çš„åƒæ•¸å€‹æ•¸ï¼Œå¦ä¸€ç®‡ä¸­æ‹¬è™Ÿå°±æ˜¯é€šéä¸‹æ¨™ç´¢å¼•ä¾†è¨ªå•ç¬¬ <code>n</code> å€‹åƒæ•¸çš„ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥å¦‚ä¸Šçš„éœ€æ±‚ï¼Œæˆ‘å€‘å¤§è‡´å°±å¯ä»¥ç†è§£çˆ² <code>args.Length()</code> çˆ² <code>2</code>ï¼Œ<code>args[0]</code> ä»£è¡¨ <code>a</code> ä»¥åŠ <code>args[1]</code> ä»£è¡¨ <code>b</code> äº†ã€‚ä¸¦ä¸”æˆ‘å€‘è¦åˆ¤æ–·é€™å…©å€‹æ•¸çš„é¡å‹å¿…é ˆå¾—æ˜¯ <code>Number</code>ã€‚</p>
<p>ã€€ã€€æ³¨æ„åˆ°æ²’ï¼Œä¸­æ‹¬è™Ÿçš„ç´¢å¼•æ“ä½œç¬¦è¿”å›çµæœæ˜¯ä¸€å€‹ <code>Local&lt;Value&gt;</code> ä¹Ÿå°±æ˜¯ <code>Node.js</code> çš„æ‰€æœ‰é¡å‹åŸºé¡ã€‚æ‰€ä»¥å‚³é€²ä¾†çš„åƒæ•¸é¡å‹ä¸å®šçš„ï¼Œæˆ‘å€‘å¿…é ˆå¾—è‡ªå·±åˆ¤æ–·æ˜¯ä»€éº¼åƒæ•¸ã€‚é€™å°±é—œä¿‚åˆ°äº†é€™å€‹ <code>Value</code> é¡å‹çš„ä¸€äº›<a href="http://izs.me/v8-docs/classv8_1_1Value.html" target="_blank" rel="external">å‡½æ•¸</a>äº†ã€‚</p>
<ul>
<li><code>IsArray()</code></li>
<li><code>IsBoolean()</code></li>
<li><code>IsDate()</code></li>
<li><code>IsFunction()</code></li>
<li><code>IsInt32()</code></li>
<li><code>IsNativeError()</code></li>
<li><code>IsNull()</code></li>
<li><code>IsNumber()</code></li>
<li><code>IsRegExp()</code></li>
<li><code>IsString()</code></li>
<li>â€¦</li>
</ul>
<p>ã€€ã€€æˆ‘å°±ä¸ä¸€ä¸€åˆ—èˆ‰äº†ï¼Œå‰©ä¸‹çš„è‡ªå·±çœ‹æ–‡æª”ã€‚ï½¡:.ï¾Ÿãƒ½(*Â´âˆ€`)ï¾‰ï¾Ÿ.:ï½¡</p>
<h4 id="ThrowException">ThrowException</h4><p>ã€€ã€€é€™å€‹æ˜¯æˆ‘å€‘ç­‰ä¸‹è¦ç”¨åˆ°çš„ä¸€å€‹å‡½æ•¸ã€‚å…·é«”åœ¨ <a href="http://izs.me/v8-docs/namespacev8.html#a2469af0ac719d39f77f20cf68dd9200e" target="_blank" rel="external">v8 æ–‡æª”</a>ä¸­å¯ä»¥æ‰¾åˆ°ã€‚</p>
<p>ã€€ã€€é¡§åæ€ç¾©ï¼Œå°±æ˜¯æ‹‹å‡ºéŒ¯èª¤å•¦ã€‚åŸ·è¡Œé€™å€‹èªå¥ä¹‹å¾Œï¼Œç›¸ç•¶æ–¼åœ¨ <code>Node.js</code> æœ¬åœ°æ–‡ä»¶ä¸­åŸ·è¡Œäº†ä¸€æ¢ <code>throw()</code> èªå¥ä¸€æ¨£ã€‚æ¯”å¦‚èªªï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ThrowException(Exception::TypeError(String::New(<span class="string">"Wrong number of arguments"</span>)));</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å°±ç›¸ç•¶æ–¼åŸ·è¡Œäº†ä¸€æ¢ <code>Node.js</code> çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Wrong number of arguments"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="Undefined()">Undefined()</h4><p>ã€€ã€€é€™å€‹å‡½æ•¸å‘¢ä¹Ÿåœ¨<a href="http://izs.me/v8-docs/namespacev8.html#ad39cfade81e77137fc11ff3a24284340" target="_blank" rel="external">æ–‡æª”</a>è£é¢ã€‚</p>
<p>ã€€ã€€å…·é«”å°±æ˜¯ä¸€å€‹ç©ºå€¼ï¼Œå› çˆ²æœ‰äº›å‡½æ•¸ä¸¦ä¸éœ€è¦è¿”å›ä»€éº¼å…·é«”çš„å€¼ï¼Œæˆ–è€…èªªæ²’æœ‰è¿”å›å€¼ï¼Œé€™å€‹æ™‚å€™å°±éœ€è¦ç”¨ <code>Undefined()</code> ä¾†ä»£æ›¿äº†ã€‚</p>
<h4 id="å‹•æ‰‹å§é¨·å¹´ï¼">å‹•æ‰‹å§é¨·å¹´ï¼</h4><p>ã€€ã€€åœ¨ç†è§£äº†ä»¥ä¸Šçš„å¹¾å€‹è¦é»ä¹‹å¾Œï¼Œæˆ‘ç›¸ä¿¡ä½ å€‘å¾ˆå¿«å°±èƒ½å¯«å‡º <code>a + b</code> çš„é‚è¼¯äº†ï¼Œæˆ‘å°±æŠŠ <code>Node.js</code> å®˜æ–¹æ‰‹å†Šçš„ä»£ç¢¼æŠ„éä¾†çµ¦ä½ å€‘éä¸€éå°±ç®—å®Œäº‹äº†ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;node.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> v8;</span><br><span class="line"></span><br><span class="line">Handle&lt;Value&gt; Add(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»£è¡¨äº†å¯ä»¥å‚³å…¥ 2 å€‹ä»¥ä¸Šçš„åƒæ•¸ï¼Œä½†å¯¦éš›ä¸Šæˆ‘å€‘åªç”¨å‰å…©å€‹</span></span><br><span class="line">    <span class="keyword">if</span>(args.Length() &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ‹‹å‡ºéŒ¯èª¤</span></span><br><span class="line">        ThrowException(Exception::TypeError(String::New(<span class="string">"Wrong number of arguments"</span>)));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿”å›ç©ºå€¼</span></span><br><span class="line">        <span class="keyword">return</span> scope.Close(Undefined());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‹¥å‰å…©å€‹åƒæ•¸å…¶ä¸­ä¸€å€‹ä¸æ˜¯æ•¸å­—çš„è©±</span></span><br><span class="line">    <span class="keyword">if</span>(!args[<span class="number">0</span>]-&gt;IsNumber() || !args[<span class="number">1</span>]-&gt;IsNumber())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ‹‹å‡ºéŒ¯èª¤ä¸¦è¿”å›ç©ºå€¼</span></span><br><span class="line">        ThrowException(Exception::TypeError(String::New(<span class="string">"Wrong arguments"</span>)));</span><br><span class="line">        <span class="keyword">return</span> scope.Close(Undefined());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…·é«”åƒè€ƒ v8 æ–‡æª”</span></span><br><span class="line">    <span class="comment">//     http://izs.me/v8-docs/classv8_1_1Value.html#a6eac2b07dced58f1761bbfd53bf0e366)</span></span><br><span class="line">    <span class="comment">// çš„ `NumberValue` å‡½æ•¸</span></span><br><span class="line">    Local&lt;Number&gt; num = Number::New(args[<span class="number">0</span>]-&gt;NumberValue() + args[<span class="number">1</span>]-&gt;NumberValue());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> scope.Close(num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å‡½æ•¸å¤§åŠŸå‘Šæˆï¼</p>
<p>ã€€ã€€æœ€å¾ŒæŠŠå°¾éƒ¨çš„å°å‡ºå‡½æ•¸çµ¦å¯«å¥½å°± OK äº†ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Handle&lt;Object&gt; exports)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    exports-&gt;Set(String::NewSymbol(<span class="string">"add"</span>),</span><br><span class="line">        FunctionTemplate::New(Add)-&gt;GetFunction());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NODE_MODULE(addon, Init)</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç­‰ä½ ç·¨è­¯å¥½ä¹‹å¾Œï¼Œæˆ‘å€‘å°±èƒ½é€™æ¨£ç”¨äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addon = <span class="built_in">require</span>(<span class="string">'./build/Release/addon'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(addon.add(<span class="number">1</span>, <span class="number">1</span>) + <span class="string">"b"</span>);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä½ æœƒçœ‹åˆ°ä¸€å€‹ <code>2b</code> ï¼âœ§<em>ï½¡Ù©(ËŠá—œË‹</em>)Ùˆâœ§*ï½¡</p>
<h3 id="å›èª¿å‡½æ•¸">å›èª¿å‡½æ•¸</h3><p>ã€€ã€€ä¸Šä¸€ç« æˆ‘å€‘åªè¬›äº†å€‹ <code>Hello world</code>ï¼Œé€™ä¸€ç« é˜¿å©†ä¸»å°±è‰¯å¿ƒç™¼ç¾ä¸€ä¸‹ï¼Œå†ä¾†å€‹å›èª¿å‡½æ•¸çš„å¯«æ³•ã€‚</p>
<p>ã€€ã€€æ…£ä¾‹æˆ‘å€‘å…ˆå¯«å¥½æ¡†æ¶ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;node.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> v8;</span><br><span class="line"></span><br><span class="line">Handle&lt;Value&gt; RunCallback(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">  HandleScope scope;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... å™¼è£å•ªå•¦å™¼è£å•ªå•¦</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> scope.Close(Undefined());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œæˆ‘å€‘æ±ºå®šå®ƒçš„ç”¨æ³•æ˜¯é€™æ¨£çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func(<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å³å®ƒæœƒçµ¦å›èª¿å‡½æ•¸å‚³å…¥ä¸€å€‹åƒæ•¸ï¼Œæˆ‘å€‘è¨­æƒ³å®ƒæ˜¯ä¸€å€‹å­—ç¬¦ä¸²ï¼Œç„¶å¾Œæˆ‘å€‘å¯ä»¥ <code>console.log()</code> å‡ºä¾†çœ‹ã€‚</p>
<h4 id="é¦–å…ˆä½ è¦æœ‰ä¸€å€‹å­—ç¬¦ä¸²ç³»åˆ—">é¦–å…ˆä½ è¦æœ‰ä¸€å€‹å­—ç¬¦ä¸²ç³»åˆ—</h4><p>ã€€ã€€å»¢è©±ä¸å¤šèªªï¼Œå…ˆçµ¦å®ƒä¸€å€‹å­—ç¬¦ä¸²é¤µé£½äº†å†èªªå§ã€‚<em>(âˆš Î¶ Îµ:)</em></p>
<p>ã€€ã€€ä¸éæˆ‘å€‘å¾—è®“é€™å€‹å­—ç¬¦ä¸²æ˜¯é€šç”¨é¡å‹çš„ï¼Œå› çˆ² <code>Node.js</code> ä»£ç¢¼æ˜¯å¼±é¡å‹çš„ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Local&lt;Value&gt;::New(String::New(<span class="string">"hello world"</span>));</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä»€éº¼ï¼Ÿä½ å•æˆ‘ä»€éº¼æ˜¯ <code>Local&lt;Value&gt;</code>ï¼Ÿ</p>
<p>ã€€ã€€é‚£æˆ‘ç¨ç¨è¬›ä¸€ä¸‹å§ï¼Œåƒè€ƒè‡ª<a href="http://cnodejs.org/topic/4f16442ccae1f4aa270010c5" target="_blank" rel="external">é€™è£</a>å’Œ<a href="http://izs.me/v8-docs/classv8_1_1Local.html" target="_blank" rel="external">V8åƒè€ƒæ–‡æª”</a>ã€‚</p>
<p>ã€€ã€€å¦‚æ–‡æª”æ‰€ç¤ºï¼Œ<code>Local&lt;T&gt;</code> å¯¦éš›ä¸Šç¹¼æ‰¿è‡ª <code>Handle&lt;T&gt;</code>ï¼Œæˆ‘è¨˜å¾—<a href="/2014/04/02/nodejs-cpp-addons-1/#Handle&lt;Value">ä¸Šä¸€ç« </a>å·²ç¶“è¬›é <code>Handle&lt;T&gt;</code> é€™å€‹æ±è¥¿äº†ã€‚</p>
<p>ã€€ã€€ç„¶å¾Œä¸‹é¢å°±æ˜¯è¬› Local äº†ã€‚</p>
<blockquote>
<p>Handle æœ‰å…©ç¨®é¡å‹ï¼Œ Local Handle å’Œ Persistent Handle ï¼Œé¡å‹åˆ†åˆ¥æ˜¯ <code>Local&lt;T&gt; : Handle&lt;T&gt;</code> å’Œ <code>Persistent&lt;T&gt; : Handle&lt;T&gt;</code> ï¼Œå‰è€…å’Œ <code>Handle&lt;T&gt;</code> æ²’æœ‰å€åˆ¥ç”Ÿå­˜é€±æœŸéƒ½åœ¨ scope å…§ã€‚è€Œå¾Œè€…çš„ç”Ÿå‘½é€±æœŸè„«é›¢ scope ï¼Œä½ éœ€è¦æ‰‹å‹•èª¿ç”¨ <code>Persistent::Dispose</code> çµæŸå…¶ç”Ÿå‘½é€±æœŸã€‚ä¹Ÿå°±æ˜¯èªª Local Handle ç›¸ç•¶æ–¼åœ¨ C++`åœ¨æ£§ä¸Šåˆ†é…å°è±¡è€Œ Persistent Handle ç›¸ç•¶æ–¼ C++ åœ¨å †ä¸Šåˆ†é…å°è±¡ã€‚</p>
</blockquote>
<h4 id="ç„¶å¾Œä½ è¦æœ‰å€‹åƒæ•¸è¡¨ç³»åˆ—">ç„¶å¾Œä½ è¦æœ‰å€‹åƒæ•¸è¡¨ç³»åˆ—</h4><p>ã€€ã€€çµ‚ç«¯å‘½ä»¤è¡Œèª¿ç”¨ C/C++ ä¹‹å¾Œæ€éº¼å–å‘½ä»¤è¡Œåƒæ•¸ï¼Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å°äº†ï¼Œé€™è£çš„ <code>argc</code> å°±æ˜¯å‘½ä»¤è¡Œåƒæ•¸å€‹æ•¸ï¼Œ<code>argv[]</code> å°±æ˜¯å„å€‹åƒæ•¸äº†ã€‚é‚£éº¼èª¿ç”¨ <code>Node.js</code> çš„å›èª¿å‡½æ•¸ï¼Œ<code>v8</code> ä¹Ÿæ¡ç”¨äº†é¡ä¼¼çš„<a href="http://izs.me/v8-docs/classv8_1_1Function.html#ac61877494d2d8bb81fcef96003ec4059" target="_blank" rel="external">æ–¹æ³•</a>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">V8EXPORT Local&lt;Value&gt; v8::Function::Call(Handle&lt;Object&gt;recv,</span><br><span class="line">    <span class="keyword">int</span> argc,</span><br><span class="line">    Handle&lt;Value&gt; argv[]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><del>QAQ å¡åœ¨äº† <code>Handle&lt;Object&gt; recv</code> äº†ï¼ï¼ï¼æ˜å¤©ç¹¼çºŒå¯«ã€‚</del></p>
</blockquote>
<p>ã€€ã€€å¥½å§ï¼Œæ–°çš„ä¸€å¤©é–‹å§‹äº†æˆ‘æ„Ÿè¦ºæˆ‘å……æ»¿äº†åŠ›é‡ã€‚(âˆ©^o^)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡</p>
<p>ã€€ã€€ç¶“éæˆ‘å¤šæ–¹é¢æ±‚è­‰ï¼ˆ<a href="http://segmentfault.com/q/1010000000456217" target="_blank" rel="external">SegmentFault</a>å’Œ<a href="http://stackoverflow.com/questions/22842908/what-does-the-first-argument-of-functioncall-in-v8-engine-mean/22848601?noredirect=1#22848601" target="_blank" rel="external">StackOverflow</a>ä»¥åŠä¸€å€‹æ‰£æ‰£ç¾£ï¼‰ï¼Œçµ‚æ–¼è§£æ±ºäº†ä¸Šé¢é€™å€‹å‡½æ•¸ä»¨åƒæ•¸çš„æ„æ€ã€‚</p>
<p>ã€€ã€€å¾Œé¢å…©å€‹åƒæ•¸å°±ä¸å¤šèªªäº†ï¼Œä¸€å€‹æ˜¯åƒæ•¸å€‹æ•¸ï¼Œå¦ä¸€å€‹å°±æ˜¯ä¸€å€‹åƒæ•¸çš„æ•¸çµ„äº†ã€‚è‡³æ–¼ç¬¬ä¸€å€‹åƒæ•¸ <code>Handle&lt;Object&gt; recv</code>ï¼ŒStackOverflow ä»å…„çš„è§£é‡‹æ˜¯é€™æ¨£çš„ï¼š</p>
<blockquote>
<p>It is the same as apply in JS. In JS, you do</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> context = ...;</span><br><span class="line">cb.apply(context, [ ...args...]);</span><br></pre></td></tr></table></figure>
<p>The object passed as the first argument becomes this within the function scope. More documentation on <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply" target="_blank" rel="external">MDN</a>. If you donâ€™t know JS well, you can read more about JSâ€™s this here: <a href="http://unschooled.org/2012/03/understanding-javascript-this/" target="_blank" rel="external">http://unschooled.org/2012/03/understanding-javascript-this/</a></p>
<p style="text-align: right;">â€”â€” æ‘˜è‡ª <a href="http://stackoverflow.com/questions/22842908/what-does-the-first-argument-of-functioncall-in-v8-engine-mean/22848601?noredirect=1#22848601" target="_blank" rel="external">StackOverflow</a></p>

</blockquote>
<p>ã€€ã€€ç¸½ä¹‹å…¶ä½œç”¨å°±æ˜¯æŒ‡å®šäº†è¢«èª¿ç”¨å‡½æ•¸çš„ <code>this</code> æŒ‡é‡ã€‚é€™å€‹ <code>Call</code> çš„ç”¨æ³•å°±è·Ÿ JavaScript ä¸­çš„ <code>bind()</code>ã€<code>call()</code>ã€<code>apply()</code> é¡ä¼¼ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥æˆ‘å€‘è¦åšçš„äº‹æƒ…å°±æ˜¯å…ˆæŠŠåƒæ•¸è¡¨å»ºå¥½ï¼Œç„¶å¾Œå‚³å…¥é€™å€‹ <code>Call</code> å‡½æ•¸ä¾›å…¶åŸ·è¡Œã€‚</p>
<p>ã€€ã€€ç¬¬ä¸€æ­¥ï¼Œé¡¯ç¤ºè½‰æ›å‡½æ•¸ï¼Œå› çˆ²æœ¬ä¾†æ˜¯ <code>Object</code> é¡å‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Local&lt;Function&gt; cb = Local&lt;Function&gt;::Cast(args[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç¬¬äºŒæ­¥ï¼Œå»ºç«‹åƒæ•¸è¡¨ï¼ˆæ•¸çµ„ï¼‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Local&lt;Value&gt; argv[argc] = &#123; Local&lt;Value&gt;::New(String::New(<span class="string">"hello world"</span>)) &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="æœ€å¾Œèª¿ç”¨å‡½æ•¸ç³»åˆ—">æœ€å¾Œèª¿ç”¨å‡½æ•¸ç³»åˆ—</h4><p>ã€€ã€€èª¿ç”¨ <code>cb</code> ï¼ŒæŠŠåƒæ•¸å‚³é€²å»ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cb-&gt;Call(Context::GetCurrent()-&gt;Global(), <span class="number">1</span>, argv);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™è£ç¬¬ä¸€å€‹åƒæ•¸ <code>Context::GetCurrent()-&gt;Global()</code> æ‰€ä»£è¡¨çš„æ„æ€å°±æ˜¯ç²å–å…¨å±€ä¸Šä¸‹æ–‡ä½œçˆ²å‡½æ•¸çš„ <code>this</code>ï¼›ç¬¬äºŒå€‹åƒæ•¸å°±æ˜¯åƒæ•¸è¡¨ä¸­çš„å€‹æ•¸ï¼ˆç•¢ç«Ÿé›–ç„¶ <code>Node.js</code> çš„æ•¸çµ„æ˜¯æœ‰é•·åº¦å±¬æ€§çš„ï¼Œä½†æ˜¯ <code>C++</code> è£é¢æ•¸çµ„çš„é•·åº¦å¯¦éš›ä¸Šç³»çµ±æ˜¯ä¸çŸ¥é“çš„ï¼Œé‚„å¾—ä½ è‡ªå·±å‚³é€²ä¸€å€‹æ•¸ä¾†èªªæ˜æ•¸çµ„é•·åº¦ï¼‰ï¼›æœ€å¾Œä¸€å€‹åƒæ•¸å°±æ˜¯å‰›çº”æˆ‘å€‘å»ºç«‹å¥½çš„åƒæ•¸è¡¨äº†ã€‚</p>
<h4 id="çµ‚ç« ä¹‹çµæŸæ–‡ä»¶ç³»åˆ—">çµ‚ç« ä¹‹çµæŸæ–‡ä»¶ç³»åˆ—</h4><p>ã€€ã€€ç›¸ä¿¡é€™ä¸€æ­¥å¤§å®¶å·²ç¶“è¼•è»Šç†Ÿè·¯äº†å§ï¼Œå°±æ˜¯æŠŠå‡½æ•¸å¯«å¥½ï¼Œç„¶å¾Œæ”¾é€²å°å‡ºå‡½æ•¸è£é¢ï¼Œæœ€å¾Œç”³æ˜ä¸€ä¸‹ã€‚</p>
<p>ã€€ã€€æˆ‘å°±ç›´æ¥æ”¾å‡ºä»£ç¢¼å§ï¼Œæˆ–è€…ç›´æ¥è·‘å» <code>Node.js</code> çš„<a href="http://nodejs.org/api/addons.html#addons_callbacks" target="_blank" rel="external">æ–‡æª”</a>çœ‹ä¹Ÿè¡Œã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;node.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> v8;</span><br><span class="line"></span><br><span class="line">Handle&lt;Value&gt; RunCallback(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line">    Local&lt;Function&gt; cb = Local&lt;Function&gt;::Cast(args[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">unsigned</span> argc = <span class="number">1</span>;</span><br><span class="line">    Local&lt;Value&gt; argv[argc] = &#123; Local&lt;Value&gt;::New(String::New(<span class="string">"hello world"</span>)) &#125;;</span><br><span class="line">    cb-&gt;Call(Context::GetCurrent()-&gt;Global(), argc, argv);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> scope.Close(Undefined());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Handle&lt;Object&gt; exports, Handle&lt;Object&gt; module)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    module-&gt;Set(String::NewSymbol(<span class="string">"exports"</span>),</span><br><span class="line">        FunctionTemplate::New(RunCallback)-&gt;GetFunction());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NODE_MODULE(addon, Init)</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€Well done! æœ€å¾Œå‰©ä¸‹çš„æ­¥é©Ÿå°±è‡ªå·±å»å§ã€‚è‡³æ–¼ <code>Js</code> è£é¢é€™éº¼èª¿ç”¨é€™å€‹å‡½æ•¸ï¼Œæˆ‘åœ¨<a href="#å›èª¿å‡½æ•¸">ä¹‹å‰</a>å·²ç¶“æåˆ°éäº†ã€‚</p>
<h2 id="ç•ªå¤–">ç•ªå¤–</h2><p>ã€€ã€€å˜›å˜›ï¼Œæˆ‘æ„Ÿè¦ºæˆ‘çš„å­¸ç¿’ç­†è¨˜å¯«å¾—è¶Šä¾†è¶Šå¥”æ”¾äº†æ±‚ç ´ï½</p>
<p>ã€€ã€€ä»Šå¤©å°±å…ˆå¯«åˆ°é€™è£å§ï¼Œå¯«å­¸ç¿’ç­†è¨˜çš„éç¨‹ä¸­æˆ‘åˆæ¼²å§¿å‹¢äº†ï¼Œæ¯”å¦‚èªªé‚£å€‹ <code>Call</code> å‡½æ•¸çš„åƒæ•¸æ„ç¾©ã€‚</p>
<p>ã€€ã€€å¦‚æœä½ å€‘è¦ºå¾—æœ¬ç³»åˆ—å­¸ç¿’ç­†è¨˜å°ä½ å€‘é‚„æœ‰å¹«åŠ©çš„è©±ï¼Œå°±ä¾†å’Œæˆ‘ä¸€èµ·æåŸºå§éº¼éº¼å™ ï½Î£&gt;â€•(ã€ƒÂ°Ï‰Â°ã€ƒ)â™¡â†’</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€å¥½ï¼Œä»Šå¤©è®“æˆ‘å€‘æ›´æ·±å…¥åœ°æåŸºå§ï¼</p>
<h2 id="æº«æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥çˆ²æº¼çŸ£">æº«æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥çˆ²æº¼çŸ£</h2><p>ã€€ã€€é¦–å…ˆè«‹å¤§å®¶è¨˜ä½é€™å€‹ V8 çš„åœ¨ç·šæ‰‹å†Šâ€”â€”<a href="http://izs.me/v8-docs/main.html" target="_bl]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="NodeJS" scheme="http://xcoder.in/categories/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[è®“Node.jså’ŒC++ä¸€èµ·æåŸº â€”â€” 1]]></title>
    <link href="http://xcoder.in/2014/04/02/nodejs-cpp-addons-1/"/>
    <id>http://xcoder.in/2014/04/02/nodejs-cpp-addons-1/</id>
    <published>2014-04-01T16:53:22.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€Nä¹…ä¹‹å‰çš„ä¸€å€‹å‘â€”â€”ç”¨ <strong>Node.js</strong> ä¾†é‡æ§‹ NBUT çš„ <strong>Online Judge</strong>ï¼ŒåŒ…æ‹¬è©•æ¸¬ç«¯ä¹Ÿå¾—é‡æ§‹ä¸€éã€‚ï¼ˆè‡³æ–¼ä»€éº¼æ™‚å€™å®Œæˆå¤§å®¶å°±ä¸è¦é—œå¿ƒäº†ï¼Œ(ï¼â€µĞ”â€²)ï¼~ â•§â•§</p>
<p>ã€€ã€€ç¸½ä¹‹æˆ‘å€‘ç¾åœ¨è¦åšçš„å…¶å¯¦ç°¡è€Œè¨€ä¹‹å°±æ˜¯â€”â€”ç”¨C/C++ä¾†å¯¦ç¾ <strong>Node.js</strong> çš„æ¨¡å¡Šã€‚</p>
<h2 id="æº–å‚™å·¥ä½œ">æº–å‚™å·¥ä½œ</h2><p>ã€€ã€€å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆ<del>è€æµæ°“</del>åˆ©å…¶å™¨ã€‚</p>
<h3 id="node-gyp">node-gyp</h3><p>ã€€ã€€é¦–å…ˆä½ éœ€è¦ä¸€å€‹ <code>node-gyp</code> æ¨¡å¡Šã€‚</p>
<p>ã€€ã€€åœ¨ä»»æ„è§’è½ï¼ŒåŸ·è¡Œï¼š</p>
<figure class="highlight crmsh"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install <span class="keyword">node</span><span class="identifier"></span><span class="title">-gyp</span> -g</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€åœ¨é€²è¡Œä¸€ç³»åˆ—çš„ <code>blahblah</code> ä¹‹å¾Œï¼Œä½ å°±å®‰è£å¥½äº†ã€‚</p>
<h3 id="Python">Python</h3><p>ã€€ã€€ç„¶å¾Œä½ éœ€è¦æœ‰å€‹ <code>python</code> ç’°å¢ƒã€‚</p>
<p>ã€€ã€€è‡ªå·±å»<a href="http://python.org/" target="_blank" rel="external">å®˜ç¶²</a>æä¸€å€‹ä¾†ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> æ ¹æ“š <code>node-gyp</code> çš„<a href="https://github.com/TooTallNate/node-gyp#installation" target="_blank" rel="external">GitHub</a>é¡¯ç¤ºï¼Œè«‹å‹™å¿…ä¿è­‰ä½ çš„ <code>python</code> ç‰ˆæœ¬ä»‹æ–¼ <code>2.5.0</code> å’Œ <code>3.0.0</code> ä¹‹é–“ã€‚</p>
</blockquote>
<h3 id="ç·¨è­¯ç’°å¢ƒ">ç·¨è­¯ç’°å¢ƒ</h3><p>ã€€ã€€å˜›å˜›ï¼Œæˆ‘å°±å·æ‡¶é»ä¸ç´°å¯«äº†ï¼Œé‚„è«‹è‡ªå·±ç§»æ­¥åˆ° <a href="https://github.com/TooTallNate/node-gyp#installation" target="_blank" rel="external">node-gyp</a> å»çœ‹ç·¨è­¯å™¨çš„éœ€æ±‚ã€‚ä¸¦ä¸”å€’é¨°å¥½ã€‚</p>
<h2 id="å…¥é–€">å…¥é–€</h2><p>ã€€ã€€æˆ‘å°±æ‹¿<a href="http://nodejs.org/api/addons.html#addons_hello_world" target="_blank" rel="external">å®˜ç¶²çš„å…¥é–€ Hello World</a>èªªäº‹å…’äº†ã€‚</p>
<h3 id="Hello_World">Hello World</h3><p>ã€€ã€€è«‹æº–å‚™ä¸€å€‹ <code>C++</code> æ–‡ä»¶ï¼Œæ¯”å¦‚å°±å« <del>sb.cc</del> hello.ccã€‚</p>
<p>ã€€ã€€ç„¶å¾Œæˆ‘å€‘ä¸€æ­¥æ­¥ä¾†ï¼Œå…ˆå¾€è£é¢æå‡ºé ­æ–‡ä»¶å’Œå®šç¾©å¥½å‘½åç©ºé–“ï¼š</p>
<figure class="highlight cpp"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;node.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;v8.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> v8;</span><br></pre></td></tr></table></figure>
<h4 id="ä¸»è¦å‡½æ•¸">ä¸»è¦å‡½æ•¸</h4><p>ã€€ã€€æ¥ä¸‹å»æˆ‘å€‘å¯«ä¸€å€‹å‡½æ•¸ï¼Œå…¶è¿”å›å€¼æ˜¯ <code>Handle&lt;Value&gt;</code>ã€‚</p>
<figure class="highlight cs"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Handle&lt;Value&gt; <span class="title">Hello</span>(<span class="params"><span class="keyword">const</span> Arguments&amp; args</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//... å—·å—·å¾…å¯«</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œæˆ‘ä¾†ç²—ç²—è§£æä¸€ä¸‹é€™äº›æ±è¥¿ï¼š</p>
<h5 id="Handle&lt;Value&gt;">Handle&lt;Value&gt;</h5><p>ã€€ã€€åšäººè¦æœ‰ç¯€æ“ï¼Œæˆ‘äº‹å…ˆç”³æ˜æˆ‘æ˜¯å¾<a href="http://cnodejs.org/topic/4f16442ccae1f4aa270010c5" target="_blank" rel="external">é€™è£</a>(<a href="http://cnodejs.org/user/fool" target="_blank" rel="external">@fool</a>)åƒè€ƒçš„ã€‚</p>
<blockquote>
<p>V8 è£ä½¿ç”¨ Handle é¡å‹ä¾†è¨—ç®¡ JavaScript å°è±¡ï¼Œèˆ‡ C++ çš„ std::sharedpointer é¡ä¼¼ï¼ŒHandle é¡å‹é–“çš„è³¦å€¼å‡æ˜¯ç›´æ¥å‚³éå°è±¡å¼•ç”¨ï¼Œä½†ä¸åŒçš„æ˜¯ï¼ŒV8 ä½¿ç”¨è‡ªå·±çš„ GC ä¾†ç®¡ç†å°è±¡ç”Ÿå‘½é€±æœŸï¼Œè€Œä¸æ˜¯æ™ºèƒ½æŒ‡é‡å¸¸ç”¨çš„å¼•ç”¨è¨ˆæ•¸ã€‚</p>
<p>JavaScript é¡å‹åœ¨ C++ ä¸­å‡æœ‰å°æ‡‰çš„è‡ªå®šç¾©é¡å‹ï¼Œå¦‚ String ã€ Integer ã€ Object ã€ Date ã€ Array ç­‰ï¼Œåš´æ ¼éµå®ˆåœ¨ JavaScript ä¸­çš„ç¹¼æ‰¿é—œä¿‚ã€‚ C++ ä¸­ä½¿ç”¨é€™äº›é¡å‹æ™‚ï¼Œå¿…é ˆä½¿ç”¨ Handle è¨—ç®¡ï¼Œä»¥ä½¿ç”¨ GC ä¾†ç®¡ç†å®ƒå€‘çš„ç”Ÿå‘½é€±æœŸï¼Œè€Œä¸ä½¿ç”¨åŸç”Ÿæ£§å’Œå †ã€‚</p>
</blockquote>
<p>ã€€ã€€è€Œé€™å€‹æ‰€è¬‚çš„ <strong>Value</strong> ï¼Œå¾ V8 å¼•æ“çš„é ­æ–‡ä»¶ <a href="http://code.google.com/p/v8/source/browse/trunk/include/v8.h#1417" target="_blank" rel="external">v8.h</a> ä¸­çš„å„ç¨®ç¹¼æ‰¿é—œä¿‚ä¸­å¯ä»¥çœ‹å‡ºä¾†ï¼Œå…¶å¯¦å°±æ˜¯ JavaScript ä¸­å„ç¨®å°è±¡çš„åŸºé¡ã€‚</p>
<p>ã€€ã€€åœ¨ç­è§£äº†é€™ä»¶äº‹ä¹‹å¾Œï¼Œæˆ‘å€‘å¤§è‡´èƒ½æ˜ç™½ä¸Šé¢é‚£æ®µå‡½æ•¸çš„ç”³æ˜çš„æ„æ€å°±æ˜¯èªªï¼Œæˆ‘å€‘å¯«ä¸€å€‹ <code>Hello</code> å‡½æ•¸ï¼Œå…¶è¿”å›çš„æ˜¯ä¸€å€‹ä¸å®šé¡å‹çš„å€¼ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> æˆ‘å€‘åªèƒ½è¿”å›ç‰¹å®šçš„é¡å‹ï¼Œå³åœ¨ Handle è¨—ç®¡ä¸‹çš„ String å•Š Integer å•Šç­‰ç­‰ç­‰ç­‰ã€‚</p>
</blockquote>
<h5 id="Arguments">Arguments</h5><p>ã€€ã€€é€™å€‹å°±æ˜¯å‚³å…¥é€™å€‹å‡½æ•¸çš„åƒæ•¸äº†ã€‚æˆ‘å€‘éƒ½çŸ¥é“åœ¨ <code>Node.js</code> ä¸­ï¼Œåƒæ•¸å€‹æ•¸æ˜¯äº‚ä¾†çš„ã€‚è€Œé€™äº›åƒæ•¸å‚³é€²å»åˆ° <code>C++</code> ä¸­çš„æ™‚å€™ï¼Œå°±è½‰è®Šæˆäº†é€™å€‹ <code>Arguments</code> é¡å‹çš„å°è±¡äº†ã€‚</p>
<p>ã€€ã€€å…·é«”çš„ç”¨æ³•æˆ‘å€‘åœ¨å¾Œé¢å†èªªï¼Œåœ¨é€™è£åªéœ€è¦æ˜ç™½é€™å€‹æ˜¯å€‹ä»€éº¼æ±è¥¿å°±å¥½ã€‚ï¼ˆçˆ²æ¯›è¦è³£é—œå­ï¼Ÿå› çˆ² <code>Node.js</code> å®˜æ–¹æ–‡æª”ä¸­çš„<a href="https://github.com/rvagg/node-addon-examples" target="_blank" rel="external">ä¾‹å­</a>å°±æ˜¯åˆ†é–‹ä¾†è¬›çš„ï¼Œæˆ‘ç¾åœ¨åªæ˜¯è¬›ç¬¬ä¸€å€‹ <code>Hello World</code> çš„ä¾‹å­è€Œå·²( Â´à°¥à±ªà°¥ï¼‰Ïƒ</p>
<h4 id="æ·»ç£šåŠ ç“¦">æ·»ç£šåŠ ç“¦</h4><p>ã€€ã€€æ¥ä¸‹å»æˆ‘å€‘å°±é–‹å§‹æ·»ç£šåŠ ç“¦äº†ã€‚å°±æœ€ç°¡å–®çš„å…©å¥è©±ï¼š</p>
<figure class="highlight d"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Handle&lt;Value&gt; Hello(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope <span class="keyword">scope</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">scope</span>.Close(String::New(<span class="string">"world"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™å…©å¥è©±æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿå¤§è‡´çš„æ„æ€å°±æ˜¯è¿”å›ä¸€å€‹ <code>Node.js</code> ä¸­çš„å­—ç¬¦ä¸² <code>&quot;world&quot;</code>ã€‚</p>
<h5 id="HandleScope">HandleScope</h5><p>ã€€ã€€åŒåƒè€ƒè‡ª<a href="http://cnodejs.org/topic/4f16442ccae1f4aa270010c5" target="_blank" rel="external">é€™è£</a>ã€‚</p>
<blockquote>
<p>Handle çš„ç”Ÿå‘½é€±æœŸå’Œ C++ æ™ºèƒ½æŒ‡é‡ä¸åŒï¼Œä¸¦ä¸æ˜¯åœ¨ C++ èªç¾©çš„ scope å…§ç”Ÿå­˜ï¼ˆå³{} åŒ…åœçš„éƒ¨åˆ†ï¼‰ï¼Œè€Œéœ€è¦é€šé HandleScope æ‰‹å‹•æŒ‡å®šã€‚HandleScope åªèƒ½åˆ†é…åœ¨æ£§ä¸Šï¼ŒHandleScope å°è±¡è²æ˜å¾Œï¼Œå…¶å¾Œå»ºç«‹çš„ Handle éƒ½ç”± HandleScope ä¾†ç®¡ç†ç”Ÿå‘½é€±æœŸï¼ŒHandleScope å°è±¡ææ§‹å¾Œï¼Œå…¶ç®¡ç†çš„ Handle å°‡ç”± GC åˆ¤æ–·æ˜¯å¦å›æ”¶ã€‚</p>
</blockquote>
<p>ã€€ã€€æ‰€ä»¥å‘¢ï¼Œæˆ‘å€‘å¾—åœ¨éœ€è¦ç®¡ç†ä»–çš„ç”Ÿå‘½é€±æœŸçš„æ™‚å€™ç”³æ˜é€™å€‹ <code>Scope</code> ã€‚å¥½çš„ï¼Œé‚£éº¼çˆ²ä»€éº¼æˆ‘å€‘çš„ä»£ç¢¼ä¸é€™éº¼å¯«å‘¢ï¼Ÿ</p>
<figure class="highlight julia"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Handle&lt;Value&gt; Hello(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">String</span><span class="type-annotation">::</span>New(<span class="string">"world"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å› çˆ²ç•¶å‡½æ•¸è¿”å›æ™‚ï¼Œ<code>scope</code> æœƒè¢«ææ§‹ï¼Œå…¶ç®¡ç†çš„Handleä¹Ÿéƒ½å°‡è¢«å›æ”¶ï¼Œæ‰€ä»¥é€™å€‹ <code>String</code> å°±æœƒè®Šå¾—æ²’æœ‰æ„ç¾©ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥å‘¢ V8 å°±æƒ³å‡ºäº†å€‹ç¥å¥‡çš„é»å­â€”â€”<code>HandleScope::Close(Handle&lt;T&gt; Value)</code> å‡½æ•¸ï¼é€™å€‹å‡½æ•¸çš„ç”¨è™•å°±æ˜¯é—œé–‰é€™å€‹ Scope ä¸¦ä¸”æŠŠè£é¢çš„åƒæ•¸è½‰äº¤çµ¦ä¸Šä¸€å€‹ Scope ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯é€²å…¥é€™å€‹å‡½æ•¸å‰çš„ Scopeã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯å°±æœ‰äº†æˆ‘å€‘ä¹‹å‰çš„ä»£ç¢¼ <code>scope.Close(String::New(&quot;world&quot;));</code>ã€‚</p>
<h5 id="String::New">String::New</h5><p>ã€€ã€€é€™å€‹ <code>String</code> é¡æ‰€å°æ‡‰çš„å°±æ˜¯ <code>Node.js</code> ä¸­åŸç”Ÿçš„å­—ç¬¦ä¸²é¡ã€‚ç¹¼æ‰¿è‡ª <code>Value</code> é¡ã€‚èˆ‡æ­¤é¡ä¼¼ï¼Œé‚„æœ‰ï¼š</p>
<ul>
<li>Array</li>
<li>Integer</li>
<li>Boolean</li>
<li>Object</li>
<li>Date</li>
<li>Number</li>
<li>Function</li>
<li>â€¦</li>
</ul>
<p>ã€€ã€€é€™äº›æ±è¥¿æœ‰äº›æ˜¯ç¹¼æ‰¿è‡ª <code>Value</code>ï¼Œæœ‰äº›æ˜¯äºŒæ¬¡ç¹¼æ‰¿ã€‚æˆ‘å€‘é€™è£å°±ä¸å¤šåšç ”ç©¶ï¼Œè‡ªå·±å¯ä»¥çœ‹çœ‹ V8 çš„ä»£ç¢¼ï¼ˆè‡³å°‘æ˜¯é ­æ–‡ä»¶ï¼‰ç ”ç©¶ç ”ç©¶æˆ–è€…çœ‹çœ‹é€™å€‹<a href="http://bespin.cz/~ondras/html/classv8_1_1Value.html#a70d4afaccc7903e6a01f40a46ad04188" target="_blank" rel="external">æ‰‹å†Š</a>ã€‚</p>
<p>ã€€ã€€è€Œé€™å€‹ <code>New</code> å‘¢ï¼Ÿ<a href="http://bespin.cz/~ondras/html/classv8_1_1String.html" target="_blank" rel="external">é€™è£</a>å¯ä»¥çœ‹çš„ã€‚å°±æ˜¯æ–°å»ºä¸€å€‹ <code>String</code> å°è±¡ã€‚</p>
<p>ã€€ã€€è‡³æ­¤ï¼Œé€™å€‹ä¸»è¦å‡½æ•¸æˆ‘å€‘å°±è§£æå®Œç•¢äº†ã€‚</p>
<h4 id="å°å‡ºå°è±¡">å°å‡ºå°è±¡</h4><p>ã€€ã€€æˆ‘å€‘ä¾†æº«ç¿’ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯åœ¨ <code>Node.js</code> è£é¢å¯«çš„è©±ï¼Œæˆ‘å€‘æ€éº¼å°å‡ºå‡½æ•¸æˆ–è€…å°è±¡ä»€éº¼çš„å‘¢ï¼Ÿ</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exports.hello = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é‚£éº¼ï¼Œåœ¨ <code>C++</code> ä¸­æˆ‘å€‘è©²å¦‚ä½•åšåˆ°é€™ä¸€æ­¥å‘¢ï¼Ÿ</p>
<h5 id="åˆå§‹åŒ–å‡½æ•¸">åˆå§‹åŒ–å‡½æ•¸</h5><p>ã€€ã€€é¦–å…ˆï¼Œæˆ‘å€‘å¯«å€‹åˆå§‹åŒ–å‡½æ•¸ï¼š</p>
<figure class="highlight aspectj"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(Handle&lt;Object&gt; exports)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//... å—·å—·å¾…å¯«ä½ å¦¹å•Šï¼#ï¾ŸÃ…ï¾Ÿï¼‰âŠ‚å½¡â˜†))ï¾ŸĞ”ï¾Ÿ)ï½¥âˆµ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™æ˜¯é¾œè…šï¼å‡½æ•¸åä»€éº¼çš„ç„¡æ‰€è¬‚ï¼Œä½†æ˜¯å‚³å…¥çš„åƒæ•¸ä¸€å®šæ˜¯ä¸€å€‹ <code>Handle&amp;lt;Object&gt;</code>ï¼Œä»£è¡¨æˆ‘å€‘ä¸‹é¢å°‡è¦åœ¨é€™è²¨ä¸Šå°å‡ºæ±è¥¿ã€‚</p>
<p>ã€€ã€€ç„¶å¾Œï¼Œæˆ‘å€‘å°±åœ¨é€™è£é¢å¯«ä¸Šå°å‡ºçš„æ±è¥¿äº†ï¼š</p>
<figure class="highlight lasso"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">void</span> init(<span class="keyword">Handle</span>&lt;Object&gt; exports)</span><br><span class="line">&#123;</span><br><span class="line">    exports<span class="subst">-&gt;</span><span class="built_in">Set</span>(<span class="built_in">String</span><span class="tag">::NewSymbol</span>(<span class="string">"hello"</span>),</span><br><span class="line">        FunctionTemplate<span class="tag">::New</span>(Hello)<span class="subst">-&gt;</span>GetFunction());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¤§è‡´çš„æ„æ€å°±æ˜¯èªªï¼Œçˆ²é€™å€‹ <code>exports</code> å°è±¡æ·»åŠ ä¸€å€‹å­—æ®µå« <code>hello</code>ï¼Œæ‰€å°æ‡‰çš„æ±è¥¿æ˜¯ä¸€å€‹<a href="http://bespin.cz/~ondras/html/classv8_1_1FunctionTemplate.html" target="_blank" rel="external">å‡½æ•¸</a>ï¼Œè€Œé€™å€‹å‡½æ•¸å°±æ˜¯æˆ‘å€‘è¦ªæ„›çš„ <code>Hello</code> å‡½æ•¸äº†ã€‚</p>
<p>ã€€ã€€ç”¨åƒä»£ç¢¼å¯«ç›´ç™½é»å°±æ˜¯ï¼š</p>
<figure class="highlight dart"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> init(Handle&lt;<span class="built_in">Object</span>&gt; exports)</span><br><span class="line">&#123;</span><br><span class="line">    exports.<span class="built_in">Set</span>(<span class="string">"hello"</span>, function hello);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¤§åŠŸå‘Šæˆï¼</p>
<p>ã€€ã€€ï¼ˆå¤§åŠŸå‘Šæˆä½ å¦¹å•Šï¼é–‰å˜´( â€˜Ğ´â€˜âŠ‚å½¡â˜†))Ğ”Â´)</p>
<h5 id="çœŸÂ·å°å‡º">çœŸÂ·å°å‡º</h5><p>ã€€ã€€é€™çº”æ˜¯æœ€å¾Œä¸€æ­¥ï¼Œæˆ‘å€‘æœ€å¾Œè¦ç”³æ˜ï¼Œé€™å€‹å°±æ˜¯å°å‡ºçš„å…¥å£ï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨ä»£ç¢¼çš„æœ«å°¾åŠ ä¸Šé€™ä¸€è¡Œï¼š</p>
<figure class="highlight stylus"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">NODE_MODULE</span><span class="params">(hello, init)</span></span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç´äº†å€‹å°¼ï¼Ÿï¼é€™åˆæ˜¯ä»€éº¼æ±è¥¿ï¼Ÿ</p>
<p>ã€€ã€€å½†ç€æ€¥ï¼Œé€™å€‹ <code>NODE_MODULE</code> æ˜¯ä¸€å€‹å®ï¼Œå®ƒçš„æ„æ€å‘¢å°±æ˜¯èªªæˆ‘å€‘æ¡ç”¨ <code>init</code> é€™å€‹åˆå§‹åŒ–å‡½æ•¸ä¾†æŠŠè¦å°å‡ºçš„æ±è¥¿å°å‡ºåˆ° <code>hello</code> ä¸­ã€‚é‚£éº¼é€™å€‹ <code>hello</code> å“ªä¾†å‘¢ï¼Ÿ</p>
<p>ã€€ã€€<strong>å®ƒä¾†è‡ªæ–‡ä»¶åï¼</strong>å°ï¼Œæ²’éŒ¯ï¼Œå®ƒä¾†è‡ªæ–‡ä»¶åã€‚ä½ ä¸¦ä¸éœ€è¦äº‹å…ˆç”³æ˜å®ƒï¼Œä½ ä¹Ÿä¸å¿…æ“”å¿ƒä¸èƒ½ç”¨ï¼Œç¸½ä¹‹ä½ çš„é€™å€‹æœ€çµ‚ç·¨è­¯å¥½çš„äºŒé€²åˆ¶æ–‡ä»¶åå«ä»€éº¼ï¼Œé€™è£çš„ <code>hello</code> ä½ å°±å¡«ä»€éº¼ï¼Œç•¶ç„¶è¦é™¤å»å¾Œç¶´åäº†ã€‚</p>
<p>ã€€ã€€è©³è¦‹<a href="http://nodejs.org/api/addons.html#addons_hello_world" target="_blank" rel="external">å®˜æ–¹æ–‡æª”</a>ã€‚</p>
<blockquote>
<p>Note that all Node addons must export an initialization function:</p>
<figure class="highlight lisp"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">void Initialize <span class="list">(<span class="keyword">Handle&lt;Object&gt;</span> exports)</span><span class="comment">;</span></span><br><span class="line">NODE_MODULE<span class="list">(<span class="keyword">module_name</span>, Initialize)</span></span><br></pre></td></tr></table></figure>
<p>There is no semi-colon after NODE_MODULE as itâ€™s not a function (see node.h).</p>
<p>The module_name needs to match the filename of the final binary (minus the .node suffix).</p>
</blockquote>
<h3 id="ç·¨è­¯_(à¹‘â€¢Ì_â‚ƒ_â€¢Ì€à¹‘)">ç·¨è­¯ (à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘)</h3><p>ã€€ã€€ä¾†å§ï¼Œè®“æˆ‘å€‘ä¸€èµ·ç·¨è­¯å§ï¼</p>
<p>ã€€ã€€æˆ‘å€‘å†æ–°å»ºä¸€å€‹é¡ä¼¼æ–¼ <code>Makefile</code> çš„æ­¸æª”æ–‡ä»¶å§â€”â€”<code>binding.gyp</code>ã€‚</p>
<p>ã€€ã€€ä¸¦ä¸”åœ¨è£é¢æ·»åŠ é€™æ¨£çš„<a href="https://github.com/TooTallNate/node-gyp#the-bindinggyp-file" target="_blank" rel="external">ä»£ç¢¼</a>ï¼š</p>
<figure class="highlight json"><figcaption><span>json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">targets</span>": <span class="value">[</span><br><span class="line">    &#123;</span><br><span class="line">      "<span class="attribute">target_name</span>": <span class="value"><span class="string">"hello"</span></span>,</span><br><span class="line">      "<span class="attribute">sources</span>": <span class="value">[ <span class="string">"hello.cc"</span> ]</span><br><span class="line">    </span>&#125;</span><br><span class="line">  ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€çˆ²ä»€éº¼é€™éº¼å¯«å‘¢ï¼Ÿå¯ä»¥åƒè€ƒ <code>node-gyp</code> çš„<a href="http://code.google.com/p/gyp/wiki/GypUserDocumentation#Skeleton_of_a_typical_Chromium_.gyp_file" target="_blank" rel="external">å®˜æ–¹æ–‡æª”</a>ã€‚</p>
<h4 id="configure">configure</h4><p>ã€€ã€€åœ¨æ–‡ä»¶æå¥½ä¹‹å¾Œï¼Œæˆ‘å€‘è¦åœ¨é€™å€‹ç›®éŒ„ä¸‹é¢åŸ·è¡Œé€™å€‹å‘½ä»¤äº†ï¼š</p>
<figure class="highlight crmsh"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span><span class="identifier"></span><span class="title">-gyp</span> configure</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¦‚æœä¸€åˆ‡æ­£å¸¸çš„è©±ï¼Œæ‡‰è©²æœƒç”Ÿæˆä¸€å€‹ <code>build</code> çš„ç›®éŒ„ï¼Œç„¶å¾Œè£é¢æœ‰ç›¸é—œæ–‡ä»¶ï¼Œä¹Ÿè¨±æ˜¯ <strong>M$ Visual Studio</strong> çš„ <code>vcxproj</code> æ–‡ä»¶ç­‰ï¼Œä¹Ÿè¨±æ˜¯ <code>Makefile</code> ï¼Œè¦–å¹³è‡ºè€Œå®šã€‚</p>
<h4 id="build">build</h4><p>ã€€ã€€<code>Makefile</code> ä¹Ÿç”Ÿæˆå¥½ä¹‹å¾Œï¼Œæˆ‘å€‘å°±é–‹å§‹æ§‹é€ ç·¨è­¯äº†ï¼š</p>
<figure class="highlight crmsh"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span><span class="identifier"></span><span class="title">-gyp</span> build</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç­‰åˆ°ä¸€åˆ‡ç·¨è­¯å®Œæˆï¼Œçº”ç®—æ˜¯çœŸæ­£çš„å¤§åŠŸå‘Šæˆäº†ï¼ä¸ä¿¡ä½ å»çœ‹çœ‹ <code>build/Release</code> ç›®éŒ„ï¼Œä¸‹é¢æ˜¯ä¸æ˜¯æœ‰ä¸€å€‹ <code>hello.node</code> æ–‡ä»¶äº†ï¼Ÿæ²’éŒ¯ï¼Œé€™å€‹å°±æ˜¯ C++ ç­‰ä¸‹è¦çµ¦ Node.js æ’¿çš„è‚¥çš‚ï¼</p>
<h3 id="æåŸºå§ï¼Node_ãƒ½(âœ¿ï¾Ÿâ–½ï¾Ÿ)ãƒ_C++">æåŸºå§ï¼Node ãƒ½(âœ¿ï¾Ÿâ–½ï¾Ÿ)ãƒ C++</h3><p>ã€€ã€€æˆ‘å€‘åœ¨å‰›çº”é‚£å€‹ç›®éŒ„ä¸‹æ–°å»ºä¸€å€‹æ–‡ä»¶ <code>jianfeizao.js</code>ï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addon = <span class="built_in">require</span>(<span class="string">"./build/Release/hello"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(addon.hello());</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€çœ‹åˆ°æ²’ï¼çœ‹åˆ°æ²’ï¼å‡ºä¾†äº†å‡ºä¾†äº†ï¼Node.js å’Œ C++ æåŸºçš„çµæœï¼é€™å€‹ <code>addon.hello()</code> å°±æ˜¯æˆ‘å€‘ä¹‹å‰åœ¨ C++ ä»£ç¢¼ä¸­å¯«çš„ <code>Handle&lt;Value&gt; Hello(const Arguments&amp; args)</code> äº†ï¼Œæˆ‘å€‘ç¾åœ¨å°±å·²ç¶“æŠŠå®ƒè¿”å›çš„å€¼çµ¦è¼¸å‡ºäº†ã€‚</p>
<h2 id="æ´—æ´—ç¡å§ï¼Œä¸‹ç¯€æ›´æ·±å…¥">æ´—æ´—ç¡å§ï¼Œä¸‹ç¯€æ›´æ·±å…¥</h2><p>ã€€ã€€æ™‚é–“ä¸æ—©äº†ï¼Œä»Šå¤©å°±å¯«åˆ°é€™è£äº†ï¼Œè‡³æ­¤çˆ²æ­¢å¤§å®¶éƒ½èƒ½æå‡ºæœ€åŸºç¤çš„ <strong>Hello world</strong> çš„ C++ æ“´å±•äº†å§ã€‚ä¸‹ä¸€æ¬¡å¯«çš„æ‡‰è©²æœƒæ›´æ·±å…¥ä¸€é»ï¼Œè‡³æ–¼ä¸‹ä¸€æ¬¡æ˜¯ä»€éº¼æ™‚å€™ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å•¦å…¶å¯¦ã€‚<br>ã€€ã€€ï¼ˆå–‚å–‚å–‚ï¼Œæ“¼ä¸»æ€éº¼å¯ä»¥é€™éº¼ä¸è² è²¬ï¼(ï½ï¾Ÿï¾›ï¾Ÿ)â”Œâ”›Î£(ï¾‰Â´<em>Ï‰</em>`)ï¾‰</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€Nä¹…ä¹‹å‰çš„ä¸€å€‹å‘â€”â€”ç”¨ <strong>Node.js</strong> ä¾†é‡æ§‹ NBUT çš„ <strong>Online Judge</strong>ï¼ŒåŒ…æ‹¬è©•æ¸¬ç«¯ä¹Ÿå¾—é‡æ§‹ä¸€éã€‚ï¼ˆè‡³æ–¼ä»€éº¼æ™‚å€™å®Œæˆå¤§å®¶å°±ä¸è¦é—œå¿ƒäº†ï¼Œ(ï¼â€µĞ”â€²)ï¼~ â•§â•§</p>
<p>ã€€ã€€ç¸½ä¹‹æˆ‘å€‘ç¾åœ¨]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="NodeJS" scheme="http://xcoder.in/categories/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ï½å…¬è¡†æª”æ‰€ï½é …ç›®è§£æ]]></title>
    <link href="http://xcoder.in/2014/03/27/node-public-file-house/"/>
    <id>http://xcoder.in/2014/03/27/node-public-file-house/</id>
    <published>2014-03-26T17:34:04.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€æ‰€è¬‚â€œå…¬è¡†æª”æ‰€â€ï¼Œå…¶å¯¦å°±æ˜¯ä¸€å€‹å…¬å…±çš„è‡¨æ™‚ç¶²ç›¤äº†ã€‚é€™å€‹æ±è¥¿æ˜¯ä¸€å€‹è€ç‰©äº†ï¼Œåœ¨æˆ‘å‰›æ¥è§¸ <code>Expressjs</code> çš„æ™‚å€™å¯«çš„ã€‚ç•¶æ™‚é‚„éš¨ä¾¿æäº†ä¸€ä¸‹ <code>backbone.js</code>ï¼Œä½†æ˜¯æ²’æœ‰æ·±å…¥ï¼Œå‹¿ç¬‘ã€‚é—œæ–¼æ·±å…¥æ§‹æ¶ <code>Expressjs</code> æ–¹é¢ä¹Ÿæ²’åšï¼Œåªæ˜¯ç²—ç²—å¯«äº†ä¸‹æœ€åŸºç¤çš„è·¯ç”±ï¼Œæ‰€ä»¥æ•´å€‹æ–‡ä»¶çµæ§‹ä¹Ÿä¸æ˜¯å¾ˆè¦ç¯„ã€‚ä½†æ˜¯æ‡‰è©²èƒ½æ¯”è¼ƒé©åˆå‰›å­¸ <code>Node.js</code> ä»¥åŠå‰›æ¥è§¸ <code>Expressjs</code> çš„äººå§ã€‚</p>
<p>ã€€ã€€Repoåœ°å€åœ¨<a href="https://github.com/XadillaX/public-file-house" target="_blank" rel="external">æˆ‘çš„Github</a>ä¸Šã€‚Demoåœ°å€åœ¨ <a href="http://dang.kacaka.ca/" target="_blank" rel="external">http://dang.kacaka.ca/</a>ï¼Œç”±æ–¼å€‹äººé›»è…¦çš„ä¸ç©©å®šæ€§ï¼Œæ‰€ä»¥ä¸ä¿è­‰ä½ å€‘éš¨æ™‚å¯ä»¥è¨ªå•ï¼Œä¿ä¸å®šå“ªå¤©å°±å¤±æ•ˆäº†ï¼Œæ‰€ä»¥æœ€å¥½çš„è¾¦æ³•é‚„æ˜¯è‡ªå·± <code>clone</code> ä¸‹ä¾†å•ªå•ªå•ªã€‚</p>
<p>ã€€ã€€å®ƒæ‰€éœ€è¦çš„æ±è¥¿å¤§è‡´å°±æ˜¯ <code>Expressjs</code> + <code>Redis</code> + <code>Backbone</code> äº†ã€‚ä¸ééƒ½æ˜¯æœ€æœ€åŸºç¤çš„ä»£ç¢¼ã€‚</p>
<h2 id="éƒ¨ç½²">éƒ¨ç½²</h2><p>ã€€ã€€æŠŠéƒ¨ç½²å¯«åœ¨æœ€å‰é¢æ˜¯çˆ²äº†èƒ½è®“ä½ å€‘è‡ªå·±é›»è…¦ä¸Šæœ‰ä¸€å€‹èƒ½è·‘çš„ç’°å¢ƒå•¦ã€‚å…¬è¡†æª”æ‰€åœ¨æˆ‘è‡ªå·±é€™é‚Šçš„ç’°å¢ƒè£é¢æ˜¯ç”±ä¸‰è‡ºé›»è…¦çµ„æˆçš„ã€‚</p>
<ul>
<li>ç¶²é—œâ€œæœå‹™å™¨â€ã€‚é€™æ˜¯æˆ‘é€™é‚Šç’°å¢ƒä¸€è‡´å°å¤–çš„æ©Ÿå™¨ã€‚å¯¦éš›ä¸Šæ˜¯ä¸€ç‰‡æ¨¹è“æ´¾ï¼Œè£äº† <code>nginx</code>ï¼Œç„¶å¾Œå°å…§éƒ¨åšåå‘ä»£ç†ã€‚</li>
<li>æœ¬é«”â€œæœå‹™å™¨â€ã€‚è·‘äº† <strong>å…¬è¡†æª”æ‰€</strong> æœ¬é«”ã€‚</li>
<li>æ•¸æ“šåº«â€œæœå‹™å™¨â€ã€‚æˆ‘å€‘ç”¨çš„æ•¸æ“šåº«å¯¦éš›ä¸Šä¸æ˜¯åš´æ ¼æ„ç¾©ä¸Šçš„æ•¸æ“šåº«ï¼Œåªæ˜¯ <code>redis</code> ç½·äº†ï¼Œä¹Ÿæ²’åšèˆ‡å…¶å®ƒæ•¸æ“šåº«çš„æŒä¹…åŒ–ï¼Œåªæ˜¯ç”¨äº†ä»–å…§éƒ¨è‡ªå¸¶çš„æŒä¹…åŒ–ã€‚</li>
</ul>
<p>ã€€ã€€<strong>å¦‚æœä½ å€‘è£ä¸€è‡ºæ©Ÿå­ä¸Šï¼Œé‚£éº¼å°±æ˜¯ï¼š</strong></p>
<p>ã€€ã€€å°‡ <code>repo</code> çµ¦ clone åˆ°è‡ªå·±çš„æ©Ÿå­ä¸Šã€‚</p>
<figure class="highlight crmsh"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">https</span>://github.com/XadillaX/public-file-house</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è£å¥½ <strong>redis</strong>ï¼Œä¸¦æ ¹æ“šéœ€è¦ä¿®æ”¹ <code>redis.conf</code> æ–‡ä»¶ã€‚</p>
<p>ã€€ã€€åŸ·è¡Œ <code>redis.sh</code> æ–‡ä»¶é–‹å•“æ•¸æ“šåº«ã€‚å¦‚æœä½ è‡ªå·±æœ¬èº«å·²ç¶“é–‹å•“æ•¸æ“šåº«æˆ–è€…ç”¨å…¶å®ƒæ–¹æ³•é–‹å•“äº†ï¼Œè«‹å¿½ç•¥ä¸Šé¢æ•¸æ“šåº«ç›¸é—œæ­¥é©Ÿã€‚</p>
<p>ã€€ã€€ç„¶å¾Œæ‰“é–‹ <code>commonConst.js</code> æ–‡ä»¶é€²è¡Œç·¨è¼¯ï¼ŒæŠŠç›¸é—œçš„ä¸€äº›ä¿¡æ¯æ”¹æˆè‡ªå·±æ‰€éœ€è¦çš„ã€‚</p>
<p>ã€€ã€€å“¦å°äº†ï¼Œé‚„æœ‰ä¸€å€‹â€œæ½”ç™–ç›¸é—œâ€çš„æ­¥é©Ÿã€‚æˆ‘ä»¥å‰å¹´è¼•ä¸æ‡‚äº‹ï¼ŒæŠŠ <code>node_modules</code> æ–‡ä»¶å¤¾ä¹Ÿçµ¦åŠ åˆ°ç‰ˆæœ¬åº«ä¸­äº†ï¼Œè€Œä¸”ä¹Ÿåœ¨è£é¢å±…ç„¶è‡ªå·±åŠ äº†å…©å€‹æ²’æœ‰å¼„åˆ° <code>nmp</code> å»çš„æ¨¡å¡Šï¼ˆ<strong>è€Œä¸”é€™å…©å€‹æ¨¡å¡Šæœ¬ä¾†å°±ä¸æ‡‰è©²æ”¾åœ¨é€™å€‹æ–‡ä»¶å¤¾ä¸‹ï¼Œä½†æ˜¯ä¸è¦åœ¨æ„é€™äº›ç´°ç¯€ï¼Œåæ­£æˆ‘ç¾åœ¨è‚¯å®šä¸æœƒåšé€™éº¼å‚»çš„äº‹äº†</strong>ï¼‰ã€‚</p>
<p>ã€€ã€€è‡³æ–¼çˆ²ä»€éº¼ä¸è¦é€™éº¼åšï¼Œå°±è·Ÿ <code>node_modules</code> æ–‡ä»¶å¤¾çš„æ„ç¾©ç›¸é—œäº†ã€‚è€Œä¸”è£é¢æœ‰å¯èƒ½æœ‰ä¸€äº›åœ¨æˆ‘æœ¬æ©Ÿç·¨è­¯å¥½çš„æ¨¡å¡Šï¼Œæ‰€ä»¥æœ€å¥½é‚„æ˜¯æ¸…ç†ä¸‹è‡ªå·±é‡æ–°è£ä¸€éçˆ²ä½³ã€‚</p>
<p>ã€€ã€€å…·é«”å‘¢å¤§è‡´å°±æ˜¯æŠŠ <code>node_modules</code> æ–‡ä»¶å¤¾è£é¢çš„ <code>alphaRandomer.js</code> æ–‡ä»¶å’Œ <code>smpEncoder.js</code> æ–‡ä»¶æ‹·è²å‡ºä¾†å‚™ä»½åˆ°ä»»æ„æ–‡ä»¶å¤¾ï¼Œç„¶å¾Œåˆªé™¤æ•´å€‹ <code>node_module</code> æ–‡ä»¶å¤¾ã€‚æ¥ä¸‹å»è·‘åˆ°é …ç›®æ ¹ç›®éŒ„åŸ·è¡Œï¼š</p>
<figure class="highlight cmake"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">install</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æŠŠä¸‰æ–¹æ¨¡å¡Šé‡æ–°è£å¥½ä¹‹å¾Œï¼ŒæŠŠå‰›çº”æ‹·å‡ºå»çš„å€†æ–‡ä»¶æ”¾å›é€™å€‹ç›®éŒ„ä¸‹ã€‚ï¼ˆ<strong>ä½†æ˜¯ä»¥å¾Œä½ å€‘è‡ªå·±å¯«åˆ¥çš„é …ç›®çš„è©±åƒè¬åˆ¥å­¸æˆ‘é€™å€‹å£æ¨£å­å•Šï¼Œä»¥å‰å¹´è¼•ä¸æ‡‚äº‹ QAQ</strong>ï¼‰</p>
<p>ã€€ã€€æœ€å¾Œè·‘èµ·ä¾†å°±è¡Œå•¦ï¼š</p>
<figure class="highlight crmsh"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">pfh</span>.js</span><br></pre></td></tr></table></figure>
<h2 id="è§£æ">è§£æ</h2><p>æ¥ä¸‹å»å°±æ˜¯è¦å‰–æé€™å°ç ´æ±è¥¿äº†ã€‚</p>
<h3 id="åŸºç¤æ–‡ä»¶">åŸºç¤æ–‡ä»¶</h3><h4 id="pfh-js">pfh.js</h4><p>ã€€ã€€é€™å€‹æ–‡ä»¶å…¶å¯¦æ˜¯ <code>Expressjs</code> è‡ªå‹•ç”Ÿæˆçš„ï¼Œä»¥å‰ä¸æ˜¯å¾ˆæ‡‚ä»–ï¼Œæ‰€ä»¥ä¹Ÿæ²’æ€éº¼å‹•ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¿æŒåŸå°ä¸å‹•çš„ã€‚</p>
<h4 id="router-js">router.js</h4><p>ã€€ã€€é€™å€‹æ˜¯è·¯ç”±å®šç¾©çš„æ–‡ä»¶ã€‚æ¯”è¼ƒé†œé™‹çš„ä¸€ç¨®æ–¹æ³•ï¼ŒæŠŠéœ€è¦å®šç¾©çš„æ‰€æœ‰è·¯ç”±éƒ½å¯«é€²å…©å€‹ <code>json</code> å°è±¡ä¸­ï¼Œä¸€å€‹ <code>POST</code> å’Œä¸€å€‹ <code>GET</code>ã€‚</p>
<p>ã€€ã€€çœ‹é <code>Expressjs</code> æ–‡æª”çš„äººæˆ–è€…æ•™ç¨‹çš„äººéƒ½çŸ¥é“ï¼Œæœ€åŸºç¤çš„è·¯ç”±è¨»å†Šå¯«æ³•å…¶å¯¦å°±æ˜¯ï¼š</p>
<figure class="highlight vbnet"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">get</span>(<span class="keyword">KEY</span>, <span class="keyword">FUNCTION</span>);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æˆ–è€…ï¼š</p>
<figure class="highlight delphi"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.post(KEY, <span class="function"><span class="keyword">FUNCTION</span>);</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ‰€ä»¥æˆ‘ä¸‹é¢æœ‰ä¸€å€‹å‡½æ•¸ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">exports.setRouter = <span class="function"><span class="keyword">function</span><span class="params">(app)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>.getRouter) &#123;</span><br><span class="line">        app.<span class="keyword">get</span>(key, <span class="keyword">this</span>.getRouter[key]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> <span class="keyword">this</span>.postRouter) &#123;</span><br><span class="line">        app.post(key, <span class="keyword">this</span>.postRouter[key]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å…¶å¤§è‡´æ„æ€å°±æ˜¯æŠŠä¹‹å‰æˆ‘å€‘å®šç¾©å¥½çš„å…©å€‹è·¯ç”±å°è±¡è£çš„å…§å®¹ä¸€ä¸€çµ¦è¨»å†Šåˆ°ç³»çµ±çš„è·¯ç”±ç•¶ä¸­å»ã€‚é€™å€‹æ˜¯æˆ‘æœ€åˆæœ€ç°¡é™‹çš„æ€æƒ³ï¼Œä¸éå¾Œä¾†æˆ‘æŠŠå®ƒç¨ç¨å®Œå–„äº†ä¸€ä¸‹å¯«åˆ°<a href="https://github.com/XadillaX/exframess/blob/master/config/router.js#L17" target="_blank" rel="external">åˆ¥çš„åœ°æ–¹</a>å»äº†ã€‚</p>
<h3 id="æ¨¡å‹">æ¨¡å‹</h3><h4 id="model/fileModel-js">model/fileModel.js</h4><p>ã€€ã€€é€™å€‹å°±æ˜¯æ¨¡å‹å±¤äº†ï¼Œä¸»è¦å°±æ˜¯ <code>redis</code> çš„ä¸€äº›æ“ä½œäº†ã€‚åœ¨é€™è£æˆ‘ç”¨çš„æ˜¯ <a href="https://github.com/mranney/node_redis" target="_blank" rel="external"><code>redis</code></a> é€™å€‹æ¨¡å¡Šï¼Œå…·é«”çš„ç”¨æ³•å¤§å®¶å¯ä»¥çœ‹å®ƒ <code>repo</code> çš„ <code>README.md</code> æ–‡ä»¶ã€‚</p>
<p>ã€€ã€€å¤§è‡´å°±ä¸‰å€‹å‡½æ•¸ï¼š</p>
<ol>
<li><code>fileModel.prototype.keyExists</code>: åˆ¤æ–·æŸå€‹æå–ç¢¼å­˜åœ¨èˆ‡å¦ã€‚</li>
<li><code>fileModel.prototype.get</code>: ç²å–æŸå€‹é©—è­‰ç¢¼çš„æ–‡ä»¶ä¿¡æ¯ã€‚</li>
<li><code>fileModel.prototype.addFile</code>: æ·»åŠ ä¸€å€‹æ–‡ä»¶ä¿¡æ¯ã€‚</li>
</ol>
<blockquote>
<p>ä¸éæœ‰å€‹å£æ¨£å­å¤§å®¶ä¸è¦å­¸ï¼Œ<code>Node.js</code> å¤§å®¶éƒ½ç´„å®šä¿—æˆçš„å›èª¿å‡½æ•¸åƒæ•¸ä¸€èˆ¬éƒ½æ˜¯ <code>callback(err, data, blahblah...)</code> çš„ï¼Œç¬¬ä¸€å€‹åƒæ•¸éƒ½æ˜¯éŒ¯èª¤ï¼Œå¦‚æœæ²’éŒ¯èª¤éƒ½æ˜¯ <code>null</code> æˆ–è€…æ˜¯ <code>undefined</code> çš„ã€‚ä½†æ˜¯ä»¥å‰ä¹Ÿæ²’é€™ç¨®æ„è­˜ï¼Œæ‰€ä»¥å›èª¿å‡½æ•¸çš„åƒæ•¸ä¹Ÿéƒ½æ˜¯æ¯”è¼ƒäº‚çš„ã€‚</p>
</blockquote>
<h3 id="æ§åˆ¶å™¨">æ§åˆ¶å™¨</h3><h4 id="action/index-js">action/index.js</h4><p>ã€€ã€€é€™æ˜¯ä¸€äº›åŸºç¤æ§åˆ¶å™¨ã€‚</p>
<h5 id="exports-index">exports.index</h5><p>ã€€ã€€ç´”ç²¹çš„é¦–é é¡¯ç¤ºã€‚</p>
<h5 id="exports-download">exports.download</h5><p>ã€€ã€€æ–‡ä»¶ä¸‹è¼‰æ§åˆ¶å™¨ã€‚ç”±ä»£ç¢¼å¯çŸ¥ï¼Œé¦–å…ˆç²å– <code>token</code> å’Œ <code>code</code>ã€‚ <code>token</code> æ˜¯é©—è­‰ <strong>URL</strong> çš„æœ‰æ•ˆæ€§è€Œ <code>code</code> å³æå–ç¢¼äº†ã€‚</p>
<p>ã€€ã€€æœŸé–“æˆ‘å€‘é©—è­‰äº†ä¸‹ <code>token</code>ï¼š</p>
<figure class="highlight gcode"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span><span class="comment">(!functions.verifyBlahblah(token)</span>) &#123;</span><br><span class="line">    resp.redirect<span class="comment">(baseConfig.webroot)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è€Œé€™å€‹ <code>verifyBlahblah</code> å‡½æ•¸å°±åœ¨<a href="https://github.com/XadillaX/public-file-house/blob/master/plugin/functions.js#L21" target="_blank" rel="external">é€™å€‹æ–‡ä»¶</a>è£é¢ã€‚</p>
<figure class="highlight php"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">exports.verifyBlahblah = <span class="function"><span class="keyword">function</span><span class="params">(blahblah)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">array</span> = blahblah.split(<span class="string">"^"</span>);</span><br><span class="line">    <span class="keyword">var</span> time = <span class="keyword">array</span>[<span class="keyword">array</span>.length - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">array</span>.pop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> encoder = <span class="keyword">require</span>(<span class="string">"smpEncoder"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> text = encoder.norBack(<span class="keyword">array</span>, time.toString());</span><br><span class="line">        text = encoder.decode(text);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> now = text.substr(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">var</span> token = text.substr(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(parseInt(Date.now() / <span class="number">1000</span>) - parseInt(now) &gt; <span class="number">300</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(token !== <span class="keyword">require</span>(<span class="string">"../commonConst"</span>).token) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¤§é«”æ„æ€å°±æ˜¯æŠŠå…¶æ‰“æ•£åˆ°æ•¸çµ„è£é¢ï¼Œå…¶ä¸­æ™‚é–“æˆ³æ˜¯æœ€å¾Œä¸€ä½ã€‚ç„¶å¾Œè§£å¯†ã€‚æœ€å¾Œé©—è­‰è§£å¯†å¾Œçš„ <code>token</code> æ˜¯å¦ç­‰æ–¼ç³»çµ±çš„ <code>token</code> ä»¥åŠæ™‚é–“æˆ³æœ‰æ²’æœ‰éæœŸã€‚</p>
<p>ã€€ã€€å¤§å®¶é€šéæˆªå– <code>Chrome</code> æˆ–è€… <code>Firefox</code> çš„è«‹æ±‚ä¿¡æ¯ï¼Œä¸é›£ç™¼ç¾æœ‰é€™éº¼å€‹åœ°å€ï¼š</p>
<figure class="highlight parser3"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">Request URL:http://localhost/download?file=</span><span class="number">662</span><span class="xml">ZE&amp;token=</span><span class="number">65</span><span class="xml"></span><span class="keyword">^97</span><span class="xml"></span><span class="keyword">^74</span><span class="xml"></span><span class="keyword">^68</span><span class="xml"></span><span class="keyword">^106</span><span class="xml"></span><span class="keyword">^125</span><span class="xml"></span><span class="keyword">^88</span><span class="xml"></span><span class="keyword">^115</span><span class="xml"></span><span class="keyword">^65</span><span class="xml"></span><span class="keyword">^96</span><span class="xml"></span><span class="keyword">^66</span><span class="xml"></span><span class="keyword">^105</span><span class="xml"></span><span class="keyword">^127</span><span class="xml"></span><span class="keyword">^114</span><span class="xml"></span><span class="keyword">^87</span><span class="xml"></span><span class="keyword">^123</span><span class="xml"></span><span class="keyword">^123</span><span class="xml"></span><span class="keyword">^114</span><span class="xml"></span><span class="keyword">^84</span><span class="xml"></span><span class="keyword">^124</span><span class="xml"></span><span class="keyword">^114</span><span class="xml"></span><span class="keyword">^125</span><span class="xml"></span><span class="keyword">^120</span><span class="xml"></span><span class="keyword">^121</span><span class="xml"></span><span class="keyword">^99</span><span class="xml"></span><span class="keyword">^116</span><span class="xml"></span><span class="keyword">^100</span><span class="xml"></span><span class="keyword">^118</span><span class="xml"></span><span class="keyword">^116</span><span class="xml"></span><span class="keyword">^98</span><span class="xml"></span><span class="keyword">^124</span><span class="xml"></span><span class="keyword">^120</span><span class="xml"></span><span class="keyword">^109</span><span class="xml"></span><span class="keyword">^98</span><span class="xml"></span><span class="keyword">^120</span><span class="xml"></span><span class="keyword">^100</span><span class="xml"></span><span class="keyword">^80</span><span class="xml"></span><span class="keyword">^119</span><span class="xml"></span><span class="keyword">^120</span><span class="xml"></span><span class="keyword">^87</span><span class="xml"></span><span class="keyword">^119</span><span class="xml"></span><span class="keyword">^105</span><span class="xml"></span><span class="keyword">^116</span><span class="xml"></span><span class="keyword">^8</span><span class="xml"></span><span class="keyword">^1395904110</span><span class="xml"></span><br><span class="line">Request Method:GET</span><br><span class="line">Status Code:</span><span class="number">200</span><span class="xml"> OK</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è€Œé€™ä¸€å¨ <code>65^97^74^68^106^125^88^115^65^96^66^105^127^114^87^123^123^114^84...^1395904110</code> ä¾¿æ˜¯æ‰€è¬‚çš„ <code>token</code> äº†ã€‚è€Œä¸”æœ¬ä¾†å°±æ˜¯å€‹demoï¼Œé€™å€‹ <code>token</code> ä¹Ÿå°±æ˜¯éš¨ä¾¿åšåšæ¨£å­ç½·äº†ã€‚</p>
<p>ã€€ã€€æ¥ä¸‹å»é€šéé©—è­‰ä¹‹å¾Œï¼Œä¾¿å¯ä»¥å¾æ•¸æ“šåº«ä¸­è®€å–æ–‡ä»¶ä¿¡æ¯äº†ã€‚å¦‚æœæœ‰æ–‡ä»¶ï¼Œé‚£éº¼é€šé <code>resp.download</code> å‡½æ•¸å‘ˆç¾çµ¦ç”¨æˆ¶ã€‚</p>
<figure class="highlight armasm"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">var</span> fileModel = new FileModel()<span class="comment">;</span></span><br><span class="line"><span class="label">fileModel.get</span>(<span class="preprocessor">code</span>, <span class="preprocessor">function</span>(status, error, obj) &#123;</span><br><span class="line">    <span class="preprocessor">if</span>(error) resp.redirect(<span class="keyword">baseConfig.webroot);</span><br><span class="line"></span>    <span class="preprocessor">else</span> &#123;</span><br><span class="line">        <span class="preprocessor">if</span>(obj === null) &#123;</span><br><span class="line">            resp.redirect(<span class="keyword">baseConfig.webroot </span>+ <span class="string">"/get/"</span> + <span class="preprocessor">code</span> + <span class="string">"/not-exist"</span>)<span class="comment">;</span></span><br><span class="line">        &#125; <span class="preprocessor">else</span> &#123;</span><br><span class="line">            resp.download(<span class="keyword">baseConfig.uploadDir </span>+ <span class="preprocessor">code</span>, <span class="preprocessor">require</span>(<span class="string">"urlencode"</span>)(obj.filename))<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h5 id="exports-getToken">exports.getToken</h5><p>ã€€ã€€é€™å€‹å‡½æ•¸å°±æ˜¯ç”Ÿç”¢ä¸€å€‹æœ‰æ•ˆçš„ <code>token</code> ç”¨çš„ã€‚åœ¨å‰ç«¯æ˜¯é€šé <strong>ajax</strong> ä¾†ç²å–çš„ã€‚</p>
<figure class="highlight nimrod"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> encoder = require(<span class="string">"smpEncoder"</span>);</span><br><span class="line"><span class="keyword">var</span> token = baseConfig.token;</span><br><span class="line"><span class="keyword">var</span> now = parseInt(<span class="type">Date</span>.now() / <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = encoder.encode(now + token);</span><br><span class="line"><span class="literal">result</span> = encoder.norGo(<span class="literal">result</span>, now.toString());</span><br><span class="line"><span class="keyword">var</span> resultString = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="literal">result</span>.length; i++) resultString += (<span class="literal">result</span>[i] + <span class="string">"^"</span>);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¤§é«”å‘¢å°±æ˜¯æ ¹æ“šç›®å‰çš„æ™‚é–“æˆ³å’Œç³»çµ± <code>token</code> ä¸€èµ·åŠ å¯†ç”Ÿç”¢ä¸€å€‹æœ‰æ•ˆçš„ <code>token</code>ã€‚</p>
<h5 id="exports-send2fetion">exports.send2fetion</h5><p>ã€€ã€€é€šéè‡ªå·±çš„é£›ä¿¡çµ¦è‡ªå·±ç™¼é€æå–ç¢¼ä»¥å‚™å¿˜ã€‚</p>
<p>ã€€ã€€é€™è£çš„è©±ç”¨äº†ä¸€å€‹ <code>fetion-sender</code> çš„æ¨¡å¡Šã€‚<code>Repo</code> åœ¨<a href="https://github.com/XadillaX/fetion-sender" target="_blank" rel="external">é€™è£</a>ã€‚</p>
<h4 id="action/upload-js">action/upload.js</h4><p>ã€€ã€€é€™å€‹æ–‡ä»¶è£é¢å…¶å¯¦å°±ä¸€å€‹ <code>exports.upload</code> å‡½æ•¸ï¼Œå¦ä¸€å€‹æ˜¯ç”Ÿæˆæå–ç¢¼ç”¨çš„ã€‚</p>
<h5 id="function_genAlphaKey(time,_callback)">function genAlphaKey(time, callback)</h5><p>ã€€ã€€ç”Ÿæˆæå–ç¢¼ã€‚æˆ‘å€‘å‡è¨­æœ€å¤šå˜—è©¦10æ¬¡ï¼Œè‹¥å˜—è©¦10æ¬¡é‚„æ²’æœ‰ç”Ÿæˆå”¯ä¸€çš„é©—è­‰ç¢¼å°±è¼¸å‡ºéŒ¯èª¤è®“ç”¨æˆ¶é‡è©¦ã€‚æ‰€ä»¥å°±æœ‰äº†ï¼š</p>
<figure class="highlight nimrod"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">function genAlphaKey(time, callback) &#123;</span><br><span class="line">    <span class="keyword">var</span> keyLength = config.uploadLen;</span><br><span class="line">    <span class="keyword">var</span> filename = alphaRandomer.rand(keyLength);</span><br><span class="line">    <span class="keyword">var</span> fileModel = new <span class="type">FileModel</span>();</span><br><span class="line"></span><br><span class="line">    fileModel.keyExists(filename, function(status, <span class="literal">result</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!status) &#123;</span><br><span class="line">            <span class="keyword">if</span>(time &lt; maxTryTime) &#123;</span><br><span class="line">                genAlphaKey(time + <span class="number">1</span>, callback);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                callback(<span class="literal">false</span>, <span class="literal">result</span>, <span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">result</span>) genAlphaKey(time, callback);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                callback(<span class="literal">true</span>, <span class="string">""</span>, filename);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä¸æ–·åœ°ç”Ÿæˆå®šé•·çš„æå–ç¢¼ï¼Œç„¶å¾Œé€šéæ¨¡å‹çš„ <code>keyExists</code> å‡½æ•¸ä¾†ç¢ºå®šé€™å€‹æå–ç¢¼æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨äº†å°±éæ­¸èª¿ç”¨é‡æ–°ç”Ÿæˆï¼Œå¦å‰‡å°±ç›´æ¥å›èª¿ã€‚</p>
<h5 id="exports-upload">exports.upload</h5><p>ã€€ã€€ä¸Šå‚³æ–‡ä»¶çš„é é¢äº†ã€‚</p>
<figure class="highlight nimrod"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(req.files.files.length !== <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="literal">result</span>.status = <span class="literal">false</span>;</span><br><span class="line">    <span class="literal">result</span>.msg = <span class="string">"è«‹ç”¨æ­£ç¢ºçš„å§¿å‹¢é¤µæˆ‘æ–‡ä»¶ã€‚"</span>;</span><br><span class="line">    resp.send(<span class="number">200</span>, <span class="literal">result</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileInfo = req.files.files[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span>(fileInfo.size &gt; config.maxUploadSize) &#123;</span><br><span class="line">    <span class="literal">result</span>.status = <span class="literal">false</span>;</span><br><span class="line">    <span class="literal">result</span>.msg = <span class="string">"æ–‡ä»¶å¤ªå¤§å•¦ï¼Œå…¬è¡†æª”æ‰€ä¸€æ¬¡åªèƒ½åƒ10Mçš„æ–‡ä»¶å“¦ã€‚"</span>;</span><br><span class="line">    resp.send(<span class="number">200</span>, <span class="literal">result</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å‰é¢ä¸€å †è©±å¤§è‡´å°±æ˜¯åšä¸‹æœ‰æ•ˆæ€§åˆ¤æ–·è€Œå·²ã€‚ç„¶å¾Œèª¿ç”¨å‡½æ•¸ä¾†ç”Ÿæˆæœ‰æ•ˆçš„æå–ç¢¼ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">genAlphaKey(<span class="number">1</span>, <span class="function"><span class="keyword">function</span><span class="params">(status, msg, filename)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¦‚æœç”ŸæˆæˆåŠŸçš„è©±å°±å¾€æ•¸æ“šåº«ä¸­æ·»åŠ æ–‡ä»¶ä¿¡æ¯ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fileModel = <span class="keyword">new</span> FileModel();</span><br><span class="line">fileModel.addFile(filename,</span><br><span class="line">    fileInfo.name,</span><br><span class="line">    fileInfo.headers[<span class="string">"content-type"</span>],</span><br><span class="line">    <span class="function"><span class="keyword">function</span><span class="params">(status, msg)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¦‚æœæ·»åŠ ä¹ŸæˆåŠŸäº†çš„è©±ï¼Œé‚£éº¼æŠŠå‰›ä¸Šå‚³åˆ°è‡¨æ™‚æ–‡ä»¶å¤¾çš„æ–‡ä»¶çµ¦ç§»å‹•åˆ°ä¸Šå‚³æ–‡ä»¶å„²å­˜ç›®éŒ„ä¸­ï¼Œä»¥ä¾¿ä»¥å¾Œå¯ä»¥è¢«ä¸‹è¼‰ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.rename(fileInfo.path, uploadDir + filename, <span class="function"><span class="keyword">function</span><span class="params">(err)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¦‚æœç§»å‹•ä¹ŸæˆåŠŸäº†çš„è©±ï¼Œé‚£éº¼è¿”å›ä¸€å€‹æˆåŠŸçš„jsonä¿¡æ¯ï¼š</p>
<figure class="highlight nimrod"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">result</span>.status = <span class="literal">true</span>;</span><br><span class="line"><span class="literal">result</span>.code = filename;</span><br><span class="line">resp.send(<span class="number">200</span>, <span class="literal">result</span>);</span><br></pre></td></tr></table></figure>
<h3 id="è¦–åœ–">è¦–åœ–</h3><p>ã€€ã€€é€™è£è¦–åœ–å°±ä¸€å€‹ <code>index.ejs</code> ã€‚ç„¶å¾Œé€šé <code>backbone.js</code> ä¾†èª¿ç”¨ä¸åŒçš„é å…§æ¨¡æ¿å’Œé‚è¼¯ä¾†å¯¦ç¾çš„é¡ä¼¼æ–¼ <strong>SPA <del>(Solus Par Agula)</del> (Single Page Application)</strong> çš„æ•ˆæœã€‚</p>
<h4 id="views/index/index-ejs">views/index/index.ejs</h4><p>ã€€ã€€åƒé¡ä¼¼æ–¼ä¸‹é¢çš„é€™ç¨®å°±æ˜¯ <code>backbone.js</code> çš„æ¨¡æ¿æ¦‚å”¸äº†ï¼š</p>
<figure class="highlight xml"><figcaption><span>html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/template"</span> <span class="attribute">id</span>=<span class="value">"faq-template"</span>&gt;</span><span class="undefined"></span><br><span class="line">...</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€åˆ°æ™‚å€™å°±å¯ä»¥é€šé <code>backbone.js</code> ä¸­çš„å‡½æ•¸ä¾†å¡«å……åˆ°é é¢å¯¦é«”ç•¶ä¸­å»ã€‚</p>
<h4 id="public/js/index-js">public/js/index.js</h4><p>ã€€ã€€åœ¨æ“æœ‰äº†æ‰€æœ‰çš„å‰ç«¯jsä¾è³´ä¹‹å¾Œï¼Œé€™å€‹æ–‡ä»¶å°±æ˜¯é€™å€‹ <code>SPA</code> çš„å…¥å£äº†ã€‚</p>
<p>ã€€ã€€é‚è¼¯å¾ˆç°¡å–®ï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> workspace = <span class="literal">null</span>;</span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    workspace = <span class="keyword">new</span> Workspace();</span><br><span class="line">    Backbone.history.start(&#123; pushState: <span class="literal">true</span>, hashChange: <span class="literal">false</span> &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ–°å»ºä¸€å€‹ <code>Workscpace</code>ï¼Œç„¶å¾Œå° <code>backbone</code> é€²è¡Œä¸€é»é…ç½®ã€‚</p>
<blockquote>
<p>To indicate that youâ€™d like to use HTML5 pushState support in your application, use Backbone.history.start({pushState: true}). If youâ€™d like to use pushState, but have browsers that donâ€™t support it natively use full page refreshes instead, you can add {hashChange: false} to the options.</p>
<p style="text-align: right">â€”â€”æ‘˜è‡ª <a href="http://backbonejs.org/#History-start" target="_blank" rel="external">backbonejs.org</a></p>

</blockquote>
<p>ã€€ã€€ç„¶å¾Œé€™å€‹ <code>Workspace</code> å³é€™å€‹ <code>SPA</code> çš„æœ¬é«”äº†ã€‚</p>
<h4 id="public/backbone/router/workspace-js">public/backbone/router/workspace.js</h4><p>ã€€ã€€é€™è£å®šç¾©äº†å¹¾å€‹è·¯ç”±ï¼Œå³ä»€éº¼è·¯ç”±è¦ç”¨å“ªå€‹é¡å»è™•ç†ã€‚é€™æ¨£æ‰èƒ½åœ¨ <code>URL</code> ç•¶ä¸­å„ç¨®è·³è½‰ã€‚å…¶å¯¦ç„¡éå°±æ˜¯æŠŠå¾…æ¸²æŸ“å…ƒç´ æ¸²æŸ“æˆé å…§æ¨¡æ¿ï¼Œç„¶å¾ŒæŠŠé é¢çš„å„ç¨®äº‹ä»¶éŸ¿æ‡‰é‚è¼¯æ”¹æ‰å³å¯ã€‚å°æ–¼ <code>Backbone</code> æˆ‘å…¶å¯¦åªç”¨éå…©æ¬¡ï¼Œç¾åœ¨ä¹Ÿå¿˜ä¸å¤§å¤šäº†ï¼Œæ€•èª¤äººå­å¼Ÿï¼Œæ‰€ä»¥ä¸€äº›å…·é«”çš„å‡½æ•¸å•Šç”¨æ³•å•Šé‚„æ˜¯å»åƒè€ƒä¸‹å®˜ç¶²æ¯”è¼ƒå¥½ä¾†ç€ã€‚</p>
<h4 id="public/backbone/view/*-js">public/backbone/view/*.js</h4><p>ã€€ã€€å°±æ˜¯å„è·¯ç”±æ‰€å°æ‡‰çš„è¦–åœ–äº†ã€‚</p>
<h5 id="uploadView-js">uploadView.js</h5><p>ã€€ã€€æ¯”å¦‚èªª <code>uploadView.js</code> æ–‡ä»¶ç•¶ä¸­ï¼ŒåŸ·è¡Œæ¸²æŸ“å‡½æ•¸ï¼š</p>
<figure class="highlight groovy"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line"><span class="string">render      :</span> function() &#123;</span><br><span class="line">    $(<span class="keyword">this</span>.el).html(Mustache.to_html(</span><br><span class="line">        <span class="keyword">this</span>.template</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    $(<span class="string">"#uploadfile"</span>).fileupload(&#123;</span><br><span class="line">        <span class="string">url         :</span> <span class="string">"../../upload.pfh"</span>,</span><br><span class="line">        <span class="string">dataType    :</span> <span class="string">"json"</span>,</span><br><span class="line">        <span class="string">done        :</span> <span class="keyword">this</span>.uploaded,</span><br><span class="line">        <span class="string">progressall :</span> <span class="keyword">this</span>.processUpload,</span><br><span class="line">        <span class="string">start       :</span> <span class="keyword">this</span>.startUpload</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">".template"</span>).show(<span class="string">"normal"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å°±æ˜¯ç”¨é å…§æ¨¡æ¿ä¾†æ¸²æŸ“ï¼š</p>
<figure class="highlight cpp"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">this</span>.el).html(Mustache.to_html(</span><br><span class="line">    <span class="keyword">this</span>.<span class="keyword">template</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€è€Œé€™å€‹ <code>this.el</code> æ˜¯åœ¨ <code>Workspace</code> ä¸­å®šç¾©çš„ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">upload      : <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> uploadView = <span class="keyword">new</span> UploadView(&#123; el: <span class="string">"#main-template-container"</span> &#125;);</span><br><span class="line">    uploadView.render();</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å¦‚ä½ æ‰€è¦‹ï¼Œå°±æ˜¯é€™å€‹ <code>#main-template-container</code> äº†ã€‚</p>
<p>ã€€ã€€é€™å€‹æ¸²æŸ“å®Œç•¢ä¹‹å¾Œï¼Œç„¶å¾ŒæŠŠ <code>#uploadfile</code> çµ¦è®Šæˆä¸Šå‚³æŒ‰éˆ•ï¼ˆç”¨äº† <strong>jquery.fileupload.js</strong>ï¼‰ã€‚å†ç„¶å¾ŒæŠŠæ¸²æŸ“å¥½çš„é é¢çµ¦ <code>show</code> å‡ºä¾†ã€‚</p>
<p>ã€€ã€€ç„¶å¾Œé€™å€‹ã€€<code>uploadView.js</code> ä¸­é‚„å®šç¾©äº†å…©å€‹<a href="http://backbonejs.org/#View-delegateEvents" target="_blank" rel="external">éŸ¿æ‡‰äº‹ä»¶</a>ï¼š</p>
<figure class="highlight lasso"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">...</span>,</span><br><span class="line"></span><br><span class="line">events      : &#123;</span><br><span class="line">    <span class="string">"click .upbutton"</span>   : <span class="string">"upload"</span>,</span><br><span class="line">    <span class="string">"click #uploadpage-to-download"</span> : <span class="string">"goDownload"</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attribute">...</span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å³åœ¨æŒ‰ä¸‹ <code>.upbutton</code> çš„æ™‚å€™æœƒåŸ·è¡Œ <code>upload</code> å‡½æ•¸ï¼Œåœ¨æŒ‰ä¸‹â€œå»ä¸‹è¼‰â€çš„æŒ‰éˆ•æ™‚æœƒåŸ·è¡Œ <code>goDownload</code> å‡½æ•¸ã€‚</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">upload      : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"#uploadfile"</span>).click();</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€åŸ·è¡Œä¸Šå‚³å‡½æ•¸çš„æ™‚å€™ï¼Œå¯¦éš›ä¸Šæ˜¯è‡ªå‹•è§¸å‹•äº† <code>#uploadfile</code> æŒ‰éˆ•çš„ <code>click</code> äº‹ä»¶ã€‚é€™å€‹æ™‚å€™å°±æœƒæŒ‰ç…§ä¹‹å‰å®šç¾©å¥½çš„ <code>$(&quot;#uploadfile&quot;).fileupload(...)</code> å»è™•ç†äº†ã€‚</p>
<h5 id="getView-js">getView.js</h5><p>ã€€ã€€é€™å€‹æ˜¯ç²å–æ–‡ä»¶çš„è¦–åœ–ã€‚</p>
<p>ã€€ã€€æ¸²æŸ“æ™‚æœƒç²å– <code>code</code> ã€‚é€™å€‹ <code>code</code> åŒæ¨£æ˜¯ <code>Workspace</code> å‚³å…¥çš„ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line"><span class="keyword">get</span>         : <span class="function"><span class="keyword">function</span><span class="params">(code, err)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> getView = <span class="keyword">new</span> GetView(&#123; el: <span class="string">"#main-template-container"</span> &#125;);</span><br><span class="line">    getView.setCode(code);</span><br><span class="line">    <span class="keyword">if</span>(err !== <span class="literal">undefined</span>) getView.setError(err);</span><br><span class="line">    getView.render();</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä¸Šé¢é—œæ–¼ <code>get</code> çš„è·¯ç”±æ˜¯ <code>get/:code</code> ä¹‹é¡çš„ï¼Œæ‰€ä»¥é€™å€‹ <code>code</code> æœƒä½œçˆ²ä¸€å€‹è·¯ç”±åƒæ•¸å‚³çµ¦ <code>get</code> å‡½æ•¸ã€‚</p>
<p>ã€€ã€€æœ‰äº†é€™å€‹ <code>code</code> ä¹‹å¾Œå°±å¯ä»¥æŠŠé é¢æ¸²æŸ“å‡ºä¾†äº†ã€‚é€™å°±æ˜¯çˆ²ä»€éº¼æˆ‘å€‘åœ°å€è¼¸å…¥ <code>http://localhost/get/XXXXX</code> çš„æ™‚å€™è¼¸å…¥æ¡†è£é¢å°±æœ‰æå–ç¢¼äº†ã€‚æŠŠé€™å€‹æ¸²æŸ“å‡ºä¾†ä¹‹å¾Œï¼Œæˆ‘å€‘å°â€œäºŒç¶­ç¢¼â€çš„å…©å¼µåœ–ç‰‡åšä¸‹éŸ¿æ‡‰ï¼šé¼ æ¨™ç§»å‹•ä¸Šå»æœƒé¡¯ç¤ºå‡ºä¾†ã€‚å†ç„¶å¾Œæˆ‘å€‘è¦ç²å–äºŒç¶­ç¢¼äº†ï¼ˆ<code>this.genQRCode()</code>ï¼‰ï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">genQRCode   : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> code = <span class="keyword">this</span>.code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dpage = <span class="string">"http://dang.kacaka.ca/get/"</span> + code;</span><br><span class="line">    dpage = UrlEncode(dpage);</span><br><span class="line">    <span class="keyword">var</span> img = <span class="string">'&lt;img style="width: 150; height: 150;" src="https://chart.googleapis.com/chart?cht=qr&amp;chs=150x150&amp;choe=UTF-8&amp;chld=L|4&amp;chl='</span> + dpage + <span class="string">'" /&gt;'</span>;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">"#download-page-qr"</span>).attr(<span class="string">"data-content"</span>, img);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> opage = <span class="string">"http://dang.kacaka.ca/download?"</span>;</span><br><span class="line">    <span class="keyword">this</span>.getToken(<span class="function"><span class="keyword">function</span>(<span class="params">token</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">undefined</span> === token) &#123;</span><br><span class="line">            $(<span class="string">"#download-origin-qr"</span>).attr(<span class="string">"data-content"</span>, <span class="string">'&lt;div style="text-align: center;"&gt;äºŒç¶­ç¢¼ç”Ÿæˆå¤±æ•—ã€‚&lt;/div&gt;'</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        opage += <span class="string">"token="</span> + token;</span><br><span class="line">        opage += <span class="string">"&amp;file="</span> + code;</span><br><span class="line">        opage = UrlEncode(opage);</span><br><span class="line">        <span class="keyword">var</span> img = <span class="string">'&lt;div style="text-align: center;"&gt;&lt;img style="width: 150; height: 150;" src="https://chart.googleapis.com/chart?cht=qr&amp;chs=150x150&amp;choe=UTF-8&amp;chld=L|4&amp;chl='</span> + opage + <span class="string">'" /&gt;&lt;br /&gt;&lt;small&gt;è©²äºŒç¶­ç¢¼æœ‰æ•ˆæœŸäº”åˆ†é˜ã€‚&lt;/small&gt;&lt;/div&gt;'</span>;</span><br><span class="line">        $(<span class="string">"#download-origin-qr"</span>).attr(<span class="string">"data-content"</span>, img);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">""</span> === <span class="keyword">this</span>.code) &#123;</span><br><span class="line">        $(<span class="string">"h2 small"</span>).css(<span class="string">"display"</span>, <span class="string">"none"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> $(<span class="string">"h2 small"</span>).css(<span class="string">"display"</span>, <span class="string">"inline-block"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¡éå°±æ˜¯èª¿ç”¨è°·æ­Œçš„ API ç„¶å¾Œç”Ÿæˆåœ–ç‰‡åœ°å€æ”¾ä¸Šå»ç½·äº†ã€‚ä¸€å€‹åœ°å€å°±æ˜¯ç•¶å‰é é¢åœ°å€ï¼Œå¦ä¸€å€‹å°±æ˜¯åŠ ä¸Š <code>token</code> ä¹‹å¾Œçš„ç›´æ¥ä¸‹è¼‰åœ°å€ã€‚</p>
<p>ã€€ã€€å¦‚ä½ æ‰€è¦‹ï¼Œç²å–tokenæ˜¯é€šéajaxå¾€æœå‹™å™¨è«‹æ±‚çš„ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">getToken    : <span class="function"><span class="keyword">function</span><span class="params">(callback)</span> </span>&#123;</span><br><span class="line">    $.<span class="keyword">get</span>(<span class="string">"../../blahblah"</span>, &#123;&#125;, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> </span>&#123;</span><br><span class="line">        callback(e.token);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œäº‹ä»¶çš„è©±ï¼š</p>
<figure class="highlight livescript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">events      : &#123;</span><br><span class="line">    <span class="string">"click <span class="subst">#downloadpage-<span class="keyword">to</span>-upload</span>"</span> : <span class="string">"toUpload"</span>,</span><br><span class="line">    <span class="string">"click <span class="subst">#download-btn</span>"</span>   : <span class="string">"toDownload"</span>,</span><br><span class="line">    <span class="string">"keydown <span class="subst">#download-code</span>"</span>: <span class="string">"toDownloadKeydown"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"keyup <span class="subst">#download-code</span>"</span>  : <span class="string">"navCode"</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æŒ‰äº†â€œå»ä¸Šå‚³â€æŒ‰éˆ•æœƒè·‘å»ä¸Šå‚³ã€‚å¦‚æœæŒ‰ä¸‹â€œä¸‹è¼‰â€æŒ‰éˆ•å°±ä¸‹è¼‰æ–‡ä»¶äº†ã€‚ç„¶å¾Œè¼¸å…¥æ¡†è£é¢å½ˆèµ·éµç›¤çš„è©±ï¼Œæœƒå°è‡´è¼¸å…¥æ¡†æ–‡å­—è®ŠåŒ–ï¼Œé€™å€‹æ™‚å€™å°±è¦æ›´æ–°äºŒç¶­ç¢¼ä»¥åŠURLäº†ã€‚</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">navCode     : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> code = $(<span class="string">"#download-code"</span>).val();</span><br><span class="line">    workspace.navigate(<span class="string">"get/"</span> + code);</span><br><span class="line">    <span class="keyword">this</span>.code = code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(code === <span class="string">""</span>) &#123;</span><br><span class="line">        $(<span class="string">"h2 small"</span>).css(<span class="string">"display"</span>, <span class="string">"none"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.genQRCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ¯ç•¶è¼¸å…¥æ¡†è®ŠåŒ–ä¹‹å¾Œï¼Œåœ°å€æ¬„å°±è¦è®Šæˆæ–°çš„ <code>get/:code</code> (<code>workspace.navigate(&quot;get/&quot; + code)</code>) äº†ï¼Œç„¶å¾Œé‡æ–°ç²å–ä¸€éäºŒç¶­ç¢¼ã€‚</p>
<p>ã€€ã€€ä¸‹è¼‰æŒ‰éˆ•çš„é‚è¼¯ä»£ç¢¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">toDownload  : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> code = $(<span class="string">"#download-code"</span>).val();</span><br><span class="line">    workspace.navigate(<span class="string">"get/"</span> + code);</span><br><span class="line">    <span class="keyword">this</span>.getToken(<span class="function"><span class="keyword">function</span>(<span class="params">token</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(token === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            alert(<span class="string">"ç²å–é©—è­‰ä¿¡æ¯å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦ã€‚"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> url = <span class="string">"../../download?file="</span> + code + <span class="string">"&amp;token="</span> + token;</span><br><span class="line">            <span class="built_in">window</span>.location.href = url;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€åæ­£å°±æ˜¯æ ¹æ“š <code>code</code> ä¾†ç”Ÿæˆåœ°å€ï¼Œç„¶å¾Œå¾ç²å–tokençš„åœ°å€ä¸­æŠŠtokenæ‹¿å‡ºä¾†æ‹¼æ¥æˆä¸‹è¼‰åœ°å€ä¹‹å¾Œå†è¨ªå•ï¼ˆ<code>window.location.href = url</code>ï¼‰å°±å¥½äº†ã€‚</p>
<h5 id="uploadedView-js">uploadedView.js</h5><p>ã€€ã€€é€™å€‹è¦–åœ–æ˜¯ä¸Šå‚³æˆåŠŸè¦–åœ–ã€‚åŠŸèƒ½å¾ˆç°¡å–®ï¼Œå°±æ˜¯ç¾å¯¦ä¸‹æå–ç¢¼ï¼Œç„¶å¾Œé£›ä¿¡èƒ½ç™¼é€ä¸€ä¸‹ï¼Œä»¥åŠèƒ½è¤‡è£½é©—è­‰ç¢¼ç½·äº†ã€‚</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">render      : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">undefined</span> === <span class="keyword">this</span>.code) &#123;</span><br><span class="line">        workspace.navigate(<span class="string">"upload"</span>, &#123; trigger: <span class="literal">true</span>, replace: <span class="literal">true</span> &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(<span class="keyword">this</span>.el).html(Mustache.to_html(</span><br><span class="line">        <span class="keyword">this</span>.template,</span><br><span class="line">        &#123; code: <span class="keyword">this</span>.code &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> phoneinfo = store.get(<span class="string">"fetion-info"</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">undefined</span> !== phoneinfo) &#123;</span><br><span class="line">        $(<span class="string">"#phonenumber"</span>).val(phoneinfo.phonenumber);</span><br><span class="line">        $(<span class="string">"#password"</span>).val(phoneinfo.password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">".template"</span>).show(<span class="string">"normal"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">'#copy-code-btn-parent'</span>).zclip(&#123;</span><br><span class="line">            path:<span class="string">'../../ZeroClipboard.swf'</span>,</span><br><span class="line">            copy:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> $(<span class="string">"#code-input"</span>).val();</span><br><span class="line">            &#125;,</span><br><span class="line">            afterCopy: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                alert(<span class="string">"æå–ç¢¼å·²ç¶“æˆåŠŸè¤‡è£½åˆ°å‰ªåˆ‡æ¿äº†ã€‚"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€šéåˆ¤æ–·æœ‰æ²’æœ‰ <code>code</code> ä¾†åˆ¤æ–·æ˜¯å¦ä¸Šå‚³æˆåŠŸã€‚é€™å€‹ <code>code</code> çš„ä¾†æºæ˜¯ <code>uploadView.js</code> ä¸­çš„ <code>uploaded (done: this.uploaded)</code> å‡½æ•¸ï¼š</p>
<figure class="highlight nimrod"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">uploaded    : function(e, data) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="literal">result</span> = data.<span class="literal">result</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="literal">result</span>.status) &#123;</span><br><span class="line">        $(<span class="string">"#progress"</span>).css(<span class="string">"display"</span>, <span class="string">"none"</span>);</span><br><span class="line">        $(<span class="string">"#progress .progress-bar"</span>).html(<span class="string">"å·²ä¸Šå‚³ 0%"</span>);</span><br><span class="line">        $(<span class="string">"#progress .progress-bar"</span>).attr(<span class="string">"aria-valuenow"</span>, <span class="string">"0"</span>);</span><br><span class="line">        $(<span class="string">"#progress .progress-bar"</span>).css(<span class="string">"width"</span>, <span class="string">"0%"</span>);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">"#upload-div #feed-doc"</span>).removeClass(<span class="string">"alert-info"</span>);</span><br><span class="line">        $(<span class="string">"#upload-div #feed-doc"</span>).addClass(<span class="string">"alert-danger"</span>);</span><br><span class="line">        $(<span class="string">"#upload-div #feed-doc"</span>).html(<span class="literal">result</span>.msg);</span><br><span class="line">        $(<span class="string">"#upload-div #feed-doc"</span>).css(<span class="string">"display"</span>, <span class="string">"block"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        store.<span class="type">set</span>(<span class="string">"code"</span>, <span class="literal">result</span>.code);</span><br><span class="line">        workspace.navigate(<span class="string">"uploaded"</span>, &#123; trigger: <span class="literal">true</span>, replace: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€<code>e</code> å’Œ <code>data</code> é€™å…©å€‹åƒæ•¸å“ªä¾†ï¼Ÿé¦–å…ˆé€™å€‹ <code>uploaded</code> å‡½æ•¸æ˜¯åœ¨ä¹‹å‰æ¸²æŸ“çš„æ™‚å€™å®šç¾©æˆ <code>jquery.fileupload</code> çš„ä¸Šå‚³çµæŸå›èª¿å‡½æ•¸çš„ï¼Œæ‰€ä»¥é€™å…©å€‹åƒæ•¸è‡ªç„¶æ˜¯ <code>jquery.fileupload</code> å‚³éä¾†çš„ã€‚è©³è¦‹<a href="https://github.com/blueimp/jQuery-File-Upload/wiki/Options#done" target="_blank" rel="external">é€™è£</a>ã€‚</p>
<p>ã€€ã€€ç¸½ä¹‹å°±æ˜¯ä¸Šæ¬¡æˆåŠŸä¹‹å¾Œï¼Œé€™å€‹uploadå‡½æ•¸æœƒç²å–ä¸€å€‹ <code>code</code>ï¼Œç„¶å¾Œå®ƒå°±æœƒæ‹¿é€™å€‹ <code>code</code> å­˜åˆ° <code>store</code> ä¸­ã€‚é€™å€‹ <code>store.js</code> æ˜¯ä¸€å€‹ <code>localStorage</code> çš„å°è£ã€‚å®ƒçš„ä»£ç¢¼å’Œæ–‡æª”åœ¨<a href="https://github.com/cloudhead/store.js" target="_blank" rel="external">é€™è£</a>ã€‚</p>
<p>ã€€ã€€å­˜å¥½ä¹‹å¾Œè®“ <code>Workspace</code> çµ¦å°èˆªåˆ° <code>uploaded</code> è¦–åœ–ä¸­ã€‚</p>
<p>ã€€ã€€è€Œé€™å€‹ <code>uploaded</code> è¦–åœ–çš„åˆå§‹åŒ–å‡½æ•¸è£é¢æœ‰é€™æ¨£çš„ä»£ç¢¼ï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">initialize  : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.code = store.get(<span class="string">"code"</span>);</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">"#sending"</span>).click(self.sending);</span><br><span class="line">    $(<span class="string">"#cancel-sending"</span>).click(self.cancelSending);</span><br><span class="line">    $(<span class="string">"#phonenumber, #password"</span>).keydown(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; <span class="keyword">if</span>(e.keyCode === <span class="number">13</span>) self.sending(); &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å°±æ˜¯åˆå§‹åŒ–çš„æ™‚å€™ï¼Œå¾ <code>localStorage</code> ä¸­æŠŠ <code>code</code> çµ¦å–å‡ºä¾†ã€‚</p>
<h2 id="çµæŸ">çµæŸ</h2><p>ã€€ã€€ä»£ç¢¼é‡å°‘ï¼Œç”¨åˆ°çš„æ±è¥¿ä¹Ÿæ˜¯åŸºç¤ï¼›ä¸éä»¥å‰çš„ä»£ç¢¼ç”±æ–¼ä¸ç­è§£ <code>Node.js</code> å•Š <code>Expressjs</code> å•Šç­‰ç­‰çš„ï¼Œæ‰€ä»¥å°è‡´ä»£ç¢¼é›œäº‚ç„¡ç« ã€é«’äº‚ç„¡æ¯”ï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šé˜»ç¤™äº†å¯è®€æ€§çš„å­˜åœ¨ã€‚</p>
<p>ã€€ã€€å¸Œæœ›æœ¬æ–‡èƒ½çµ¦å„ä½çœ‹å®˜ç¨ç¨ç†æ¸…æ€è·¯ã€‚æˆ‘ä¹Ÿä¸å¿…å¯«å¾—é¢é¢ä¿±åˆ°ï¼Œåªæ˜¯åœ¨æŸå€‹ç¨‹åº¦ä¸Šé»é¡Œä¸€ä¸‹è€Œå·²ã€‚æ›´å¤šçš„å¤§å®¶è‡ªå·±çœ‹ä»£ç¢¼å³å¯äº†ã€‚ä¸éå¸Œæœ›é‚„ä¸è¦æŠŠå¤§å®¶çµ¦èª¤å°äº†å°±å¥½ï¼Œç•¢ç«Ÿé€™ä»£ç¢¼æˆ‘è‡ªå·±ç¾åœ¨çœ‹è¦ºå¾—å¥½ä¸Ÿè‡‰å•Š QAQã€‚å¤§å®¶å°±å»å…¶ç³Ÿç²•å–å…¶ç²¾è¯å§ã€‚ï¼ˆå–‚å–‚å–‚ï¼Œæˆ‘å»å¹´è²·äº†å€‹è¡¨ï¼Œå“ªæœ‰ä»€éº¼ç²¾è¯å•Šï¼</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€æ‰€è¬‚â€œå…¬è¡†æª”æ‰€â€ï¼Œå…¶å¯¦å°±æ˜¯ä¸€å€‹å…¬å…±çš„è‡¨æ™‚ç¶²ç›¤äº†ã€‚é€™å€‹æ±è¥¿æ˜¯ä¸€å€‹è€ç‰©äº†ï¼Œåœ¨æˆ‘å‰›æ¥è§¸ <code>Expressjs</code> çš„æ™‚å€™å¯«çš„ã€‚ç•¶æ™‚é‚„éš¨ä¾¿æäº†ä¸€ä¸‹ <code>backbone.js</code>ï¼Œä½†æ˜¯æ²’æœ‰æ·±å…¥ï¼Œå‹¿ç¬‘ã€‚é—œæ–¼æ·±å…¥æ§‹æ¶ <code>Express]]>
    </summary>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="Project Parse" scheme="http://xcoder.in/tags/Project-Parse/"/>
    
      <category term="Document" scheme="http://xcoder.in/categories/Document/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æµ™æ±Ÿå¤§å­¸XPlané …ç›®æ–°èçˆ¬èŸ²æ‰‹æ©Ÿå±å¹•é©é…æ–‡æª”]]></title>
    <link href="http://xcoder.in/2013/12/28/xplan-spider-doc/"/>
    <id>http://xcoder.in/2013/12/28/xplan-spider-doc/</id>
    <published>2013-12-27T16:00:00.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p><strong>XPlan</strong> æ˜¯ä¸€å€‹â€œåŸºæ–¼æ ¡åœ’å¼·é—œä¿‚çš„ç¤¾äº¤æ‡‰ç”¨â€çš„é–‹ç™¼ä»£è™Ÿã€‚å…¶ä¸­æœ‰ä¸€å€‹åŠŸèƒ½æ˜¯å¾å­¸æ ¡ç¶²ç«™ä¸Šé€šéç¶²çµ¡çˆ¬èŸ²ï¼ˆWeb Crawlerï¼‰å½¢å¼å°‡å­¸æ ¡æ–°èæŠ“å–åˆ°XPlanè‡ªèº«çš„æ•¸æ“šåº«ç•¶ä¸­ã€‚</p>
<p>è€Œé€™è£å‡ºç¾çš„ä¸€å€‹å•é¡Œå°±æ˜¯å­¸æ ¡ç¶²ç«™ä¸Šé¢çš„æ–‡ç« æ˜¯é€šéé¡ä¼¼æ–¼ <a href="http://kindeditor.net/" target="_blank" rel="external"><code>KindEditor</code></a>ã€<a href="http://ueditor.baidu.com/website/" target="_blank" rel="external"><code>UEditor</code></a>é€™é¡<strong>åœ¨ç·šå¯Œæ–‡æœ¬ç·¨è¼¯å™¨</strong>ç”Ÿæˆçš„ä»£ç¢¼ã€‚</p>
<p>é€™é¡ä»£ç¢¼æœ‰å¹¾å€‹å…±æ€§ï¼š</p>
<ol>
<li>ä»£ç¢¼æœ‰å¤§é‡å†—é¤˜ã€å¤šé‡ç„¡ç”¨åµŒå¥—ã€‚</li>
<li>éå¸¸ä½çš„ä»£ç¢¼å¯è®€æ€§ã€‚</li>
<li>åœ¨PCç€è¦½å™¨ä¸­è¡¨ç¾åŠ›ä¸éŒ¯ï¼Œå¾€å¾€èƒ½ä»¥ä½æ•ˆçš„ä»£ç¢¼å¯¦ç¾é æœŸæ’ç‰ˆã€‚</li>
</ol>
<p>æ‰€ä»¥é€™äº›å¯Œæ–‡æœ¬ç·¨è¼¯å™¨å¯ä»¥åœ¨PCå„å¤§å…§æ ¸ç€è¦½å™¨ä¸­è¡¨ç¾è‰¯å¥½ï¼Œä½†æ˜¯ä¸ä¾¿äººå·¥ä¿®æ”¹ä»£ç¢¼ã€‚</p>
<p>è€Œ <strong>XPlan</strong> ç¢ºæ˜¯ä¸€å€‹ç”±æ™ºèƒ½æ‰‹æ©Ÿä¸»å°çš„æ‡‰ç”¨ï¼Œæ–°èå°‡æœƒé€šéä¸€å€‹ <strong>WebView</strong> é«”ç¾å‡ºä¾†ã€‚æ‰€ä»¥å°±éœ€è¦ä¸€å®šçš„æ–¹æ³•å°‡é€™äº›é«’äº‚çš„ä»£ç¢¼é©é…æˆæ‰‹æ©Ÿå±å¹•ä¸‹è¡¨ç¾åŠ›è‰¯å¥½çš„ä»£ç¢¼ã€‚</p>
<h2 id="é è™•ç†">é è™•ç†</h2><p>åœ¨é€™è£ï¼Œæˆ‘å€‘å°‡æ–°èçš„ä»£ç¢¼é–å®šåœ¨æ–°èå…§å®¹æ’ç‰ˆï¼Œè€Œæ’é™¤äº†å…¶å®ƒé¡ä¼¼æ–¼æ–°èæ¨™é¡Œã€æ–°èä½œè€…ç­‰å…¶å®ƒä¿¡æ¯ã€‚</p>
<p>ä»¥æˆ‘å€‘æµ™æ±Ÿå¤§å­¸è»Ÿä»¶å­¸é™¢çˆ²ä¾‹ï¼Œæˆ‘å€‘çˆ¬å–çš„æ–°èå…§å®¹ä»£ç¢¼å°‡å¦‚ä¸‹ï¼š</p>
<figure class="highlight applescript"><figcaption><span>html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"vid_wz"</span>&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure>
<p>æ‰€æœ‰å…§å®¹å°‡è¢«åŒ…æ‹¬åœ¨é€™å€‹é¡å‹çˆ² <code>vid_wz</code> çš„ <code>div</code> ç•¶ä¸­ã€‚</p>
<p>é€™æ™‚ï¼Œæˆ‘å€‘å°‡å…¶åŒ…æ‹¬åœ¨ä¸€å€‹è‡ªå·±å¯¦ç¾å®šç¾©å¥½çš„æ¨¡æ¿ç•¶ä¸­ã€‚è©²æ¨¡æ¿èˆ‡æ–°èå…§å®¹å°‡æœƒå½¢æˆä¸€å€‹å®Œæ•´çš„ç¶²é ï¼ŒåŒ…æ‹¬å®Œæ•´çš„ <code>html</code>ã€<code>head</code>ã€<code>body</code> ç­‰æ¨™ç±¤ã€‚</p>
<figure class="highlight xml"><figcaption><span>html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>æ–°èå…§é <span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=UTF-8"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">article</span> <span class="attribute">id</span>=<span class="value">"_xplan-wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"vid_wz"</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">article</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é€™è£éœ€è¦æ³¨æ„çš„ä¸€é»çš„å°±æ˜¯å…¶ä¸­çš„ä¸€å€‹ <code>meta</code> æ¨™ç±¤ï¼š</p>
<figure class="highlight applescript"><figcaption><span>html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta <span class="property">name</span>=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>å®ƒçš„æ„æ€æ˜¯å®šç¾© <code>viewport</code> çš„ä¸€äº›å±¬æ€§ï¼Œå¯¦ç¾äº†åˆæ­¥çš„æ‰‹æ©Ÿç¶²é é©é…ã€‚</p>
<h3 id="Viewport">Viewport</h3><p>æ‰‹æ©Ÿç€è¦½å™¨æ˜¯æŠŠé é¢æ”¾åœ¨ä¸€å€‹è™›æ“¬çª—å£ï¼ˆå³ <code>viewport</code>ï¼‰ä¸­ï¼Œç”¨æˆ¶å¯ä»¥é€šéå¹³ç§»å’Œç¸®æ”¾ä¾†çœ‹ç¶²é çš„ä¸åŒéƒ¨åˆ†ã€‚</p>
<p>é€šé <code>viewport</code> æˆ‘å€‘èƒ½å°é é¢çš„ä¸€äº›ç¸®æ”¾é€²è¡Œæ‰‹æ©Ÿé©é…ã€‚</p>
<p>æˆ‘å€‘æ‰€éœ€è¦åšçš„åƒ…æ˜¯åœ¨ <code>head</code> ä¸­æ’å…¥ä¸€å€‹ <code>meta</code> æ¨™ç±¤ï¼Œå‘½åçˆ² <code>viewport</code>ï¼Œç„¶å¾Œå®šç¾©å¥½å…¶ <code>content</code>ã€‚</p>
<p><code>content</code> çš„èªæ³•å¦‚ä¸‹ï¼š</p>
<h4 id="width">width</h4><p>æ§åˆ¶ <code>viewport</code> çš„å¯¬åº¦ï¼Œå¯ä»¥æŒ‡å®šä¸€å€‹å€¼æˆ–è€…ç‰¹æ®Šçš„å€¼ï¼Œå¦‚ <code>device-width</code> çˆ²è¨­å‚™å¯¬åº¦ã€‚</p>
<h4 id="height">height</h4><p>èˆ‡ <code>width</code> ç›¸å°æ‡‰ï¼ŒæŒ‡å®šé«˜åº¦</p>
<h4 id="initial-scale">initial-scale</h4><p>åˆå§‹ç¸®æ”¾ï¼Œå³é é¢åˆå§‹ç¸®æ”¾ç¨‹åº¦ã€‚é€™æ˜¯ä¸€å€‹æµ®é»å€¼ï¼Œæ˜¯é é¢å¤§å°çš„ä¸€å€‹ä¹˜æ•¸ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è¨­ç½®åˆå§‹ç¸®æ”¾çˆ² <code>1.0</code>ï¼Œé‚£éº¼é é¢åœ¨å±•ç¾çš„æ™‚å€™å°±æœƒä»¥åˆ†è¾¨ç‡çš„1:1ä¾†å±•ç¾ã€‚å¦‚æœä½ è¨­ç½®çˆ²<code>2.0</code>ï¼Œé‚£éº¼é€™å€‹é é¢å°±æœƒæ”¾å¤§çˆ²2å€ã€‚</p>
<h4 id="maximum-scale">maximum-scale</h4><p>æœ€å¤§æ”¾å¤§å€æ•¸ã€‚</p>
<h4 id="user-scaleble">user-scaleble</h4><p>ç”¨æˆ¶èª¿æ•´ç¸®æ”¾ï¼Œå³ç”¨æˆ¶æ˜¯å¦èƒ½æ”¹è®Šé é¢ç¸®æ”¾ç¨‹åº¦ã€‚å¦‚æœçˆ² <code>yes</code> å³çˆ²å¯ä»¥ï¼Œ <code>no</code> çˆ²ä¸å¯ä»¥ã€‚</p>
<h2 id="Cheerioæ¨¡å¡Š*">Cheerioæ¨¡å¡Š*</h2><p>ç”±æ–¼ <strong>XPlan</strong> çš„å¾Œç«¯æ˜¯åŸºæ–¼ <code>node.js</code> æ§‹æ¶çš„ï¼Œæ‰€ä»¥ <strong>cheerio</strong> æ¨¡å¡Šæ˜¯ä¸€å€‹ <code>node.js</code> å°ˆæœ‰çš„æ¨¡å¡Šã€‚</p>
<p>å®ƒçš„ä½œç”¨æ˜¯å°‡ä¸€æ®µHTMLä»£ç¢¼è½‰æ›çˆ²ä¸€æ£µDOMå…ƒç´ æ¨¹ã€‚</p>
<p>åœ¨å…¶å®˜ç¶²ä¸Šæ˜¯é€™éº¼è©®é‡‹çš„ï¼šçˆ²æœå‹™ç«¯å®šè£½çš„å¿«é€Ÿã€éˆæ´»ã€è¼•é‡ç´šå¯¦ç¾çš„ jQuery å…§æ ¸ã€‚é€šå¸¸ç†Ÿæ‚‰ jQuery ä½¿ç”¨çš„é–‹ç™¼è€…æ‡‰è©²æœƒå°å…¶ä½¿ç”¨æ–¹æ³•æ¯”è¼ƒç†Ÿæ‚‰ã€‚</p>
<p>æ‰€ä»¥åœ¨æˆ‘å€‘åšæ¥ä¸‹å»é©é…ä¿®æ”¹çš„ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦å°‡æˆ‘å€‘å‰›çº”ç”Ÿæˆçš„å®Œæ•´HTMLä»£ç¢¼ è½‰æ›çˆ²ä¸€æ£µæˆ‘å€‘å¯ä»¥æ“ä½œçš„DOMå…ƒç´ æ¨¹ã€‚</p>
<figure class="highlight lasso"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> cheerio = <span class="keyword">require</span>(<span class="string">"cheerio"</span>);</span><br><span class="line">$ = cheerio<span class="built_in">.</span>load(<span class="attribute">...</span>);</span><br></pre></td></tr></table></figure>
<p>é€™æ™‚æˆ‘å€‘ä¾¿èƒ½ä»¥ç†Ÿæ‚‰çš„jQueryæ¨¡å¼å°å…¶é€²è¡Œæ“ä½œäº†ï¼Œå¦‚ï¼š</p>
<figure class="highlight elixir"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(</span><span class="string">"p"</span>).html(<span class="string">"hello foo!"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Bootstrap">Bootstrap</h2><p>Bootstrapæ˜¯Twitteræ¨å‡ºçš„ä¸€å€‹é–‹æºçš„ç”¨æ–¼å‰ç«¯é–‹ç™¼çš„å·¥å…·åŒ…ã€‚å®ƒæœ‰ä¸€å€‹éå¸¸å¥½çš„éŸ¿æ‡‰å¼çš„é é¢é¢¨æ ¼ï¼Œä½¿å…¶åœ¨å€‹å°ºå¯¸å±å¹•ä¸Šè¡¨ç¾è‰¯å¥½ã€‚</p>
<p>çˆ²äº†èƒ½æ›´å¥½é©æ‡‰å±å¹•ï¼Œæˆ‘å€‘æ±ºå®šæ¡ç”¨å…¶è‡ªå¸¶çš„æŸµæ ¼ç³»çµ±ï¼Œæ–¼æ˜¯å‰›çº”çš„é é¢æ¨¡æ¿å°±æœ‰äº†æ–°çš„è®ŠåŒ–ï¼š</p>
<figure class="highlight xml"><figcaption><span>html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>æ–°èå…§é <span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=UTF-8"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">article</span> <span class="attribute">class</span>=<span class="value">"container"</span> <span class="attribute">id</span>=<span class="value">"_xplan-wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"row"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"col-md-12"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"vid_wz"</span>&gt;</span>...<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">article</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæœ€å¤–æ¡†çš„ <code>container</code>ï¼Œç”¨å…¶åŒ…è£¹çš„å…ƒç´ å°‡å¯¦ç¾å±…ä¸­å°é½Šã€‚åœ¨ä¸åŒçš„åª’é«”æŸ¥è©¢é–¾å€¼ç¯„åœå…§éƒ½çˆ² <code>container</code> è¨­ç½®äº† <code>width</code>ï¼Œç”¨ä»¥åŒ¹é…æŸµæ ¼ç³»çµ±ã€‚</p>
<p><code>row</code> æ˜¯ä¸€è¡ŒæŸµæ ¼ç³»çµ±çš„å¤–åŒ…å…ƒç´ ã€‚ä¸€è¡Œå¯ä»¥æœ‰12å€‹æŸµæ ¼ã€‚</p>
<p>ä»¥ <code>.col-md-</code> é–‹é ­çš„æŸµæ ¼çš„æœ€å¤§ <code>container</code> å¯¬åº¦çˆ²970ï¼Œæœ€å¤§åˆ—å¯¬çˆ²78ï¼Œä¸¦èƒ½è‡ªé©æ‡‰å±å¹•ã€‚</p>
<h2 id="ç´°ç¯€è™•ç†">ç´°ç¯€è™•ç†</h2><p>åœ¨å®Œæˆäº†ä»¥ä¸Šæ“ä½œä»¥å¾Œï¼Œæˆ‘å€‘å°‡å°å„å…ƒç´ é€²è¡Œå¾®èª¿è™•ç†ã€‚</p>
<p>å¥½åœ¨åœ¨æ‰‹æ©Ÿç€è¦½å™¨æˆ–è€… <code>WebView</code> ä¸­ï¼Œå°å„ç¨®å­—é«”çš„è¨­ç½®ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œæ‰€ä»¥æˆ‘å€‘ä»ç„¶å¯ä»¥ä¸è™•ç†ä¸€äº›é—œæ–¼å­—é«”è®Šæ›´çš„è¨­ç½®ï¼Œä»¥æ¸›è¼•é–‹é«®é‡ã€‚</p>
<p>é€™è£è·å¹¾å€‹å¾®èª¿çš„ä¾‹å­ã€‚</p>
<h3 id="&lt;img_/&gt;">&lt;img /&gt;</h3><p>åœ¨æ–°èç•¶ä¸­ï¼Œåœ–ç‰‡å……ç•¶çš„åŸºæœ¬ä¸Šæ˜¯æ–°èç…§ç‰‡çš„è§’è‰²ï¼Œåœ¨æ‰‹æ©Ÿç•¶ä¸­ä»¥å–®è¡Œå‡ºç¾çˆ²ä½³ã€‚</p>
<p>è€Œ Bootstrap ç•¶ä¸­æœ¬èº«å°±æœ‰å…ƒç´ é¡å‹ä¾†è®“åœ–ç‰‡å…ƒç´ éŸ¿æ‡‰å±å¹•å¯¬åº¦ï¼Œä¸¦å¯ä»¥åŠ ä¸Šåœ“è§’é‚Šæ¡†ã€‚</p>
<p>æ‰€ä»¥æˆ‘å€‘éœ€è¦åšçš„å°±æ˜¯çˆ²æ‰€æœ‰åœ–ç‰‡åŠ ä¸ŠéŸ¿æ‡‰çš„é¡å‹ï¼š</p>
<figure class="highlight elixir"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(</span><span class="string">"img"</span>).addClass(<span class="string">"img-thumbnail"</span>);</span><br><span class="line"><span class="variable">$(</span><span class="string">"img"</span>).addClass(<span class="string">"img-responsive"</span>);</span><br><span class="line"><span class="variable">$(</span><span class="string">"img"</span>).removeAttr(<span class="string">"style"</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> æœ€å¾Œçš„ä¸€å€‹ç§»é™¤ <code>img</code> å…ƒç´ è‡ªå¸¶çš„ <code>style</code> å±¬æ€§æ˜¯å› çˆ²åœ¨æ–‡ç« ç™¼ä½ˆçš„æ™‚å€™ï¼Œæœ‰å¯èƒ½æœƒè¢«å¯Œæ–‡æœ¬ç·¨è¼¯å™¨è‡ªå‹•åŠ ä¸Šä¸€äº›å¯¬é«˜ã€é‚Šæ¡†ç­‰ä¿¡æ¯ã€‚çˆ²äº†çµ±ä¸€æ‰€æœ‰åœ–ç‰‡é¢¨æ ¼ä»¥åŠè®“éŸ¿æ‡‰å¼ç”Ÿæ•ˆï¼Œéœ€è¦å°‡å…¶ <code>style</code> å±¬æ€§å…¨éƒ¨ç§»é™¤ã€‚</p>
</blockquote>
<p>ä¸‹é¢æ˜¯æ˜¯é©é…å‰èˆ‡é©é…å¾Œçš„å°æ¯”ï¼š</p>
<p><img src="./xplan-news-2.jpg" alt="é©é…å‰"><br><img src="./xplan-news-1.jpg" alt="é©é…å¾Œ"></p>
<h3 id="&lt;table&gt;&lt;/table&gt;">&lt;table&gt;&lt;/table&gt;</h3><p>å°æ–¼ <code>table</code> å…ƒç´ ä¹Ÿéœ€è¦å°å®ƒé€²è¡Œè‡ªé©é…ï¼Œä¸ç„¶å¾ˆæœ‰å¯èƒ½æœƒæº¢å‡ºå±å¹•ï¼Œä½¿å…¶å¤šå‡ºäº†ä¸€å€‹æ©«å‘çš„æ»¾å‹•æ¢ã€‚</p>
<figure class="highlight elixir"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(</span><span class="string">"table"</span>).removeAttr(<span class="string">"style"</span>);</span><br><span class="line"><span class="variable">$(</span><span class="string">"table"</span>).removeAttr(<span class="string">"border"</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$(</span><span class="string">"table"</span>).addClass(<span class="string">"table"</span>);</span><br><span class="line"><span class="variable">$(</span><span class="string">"table"</span>).addClass(<span class="string">"table-bordered"</span>);</span><br><span class="line"><span class="variable">$(</span><span class="string">"table"</span>).addClass(<span class="string">"table-striped"</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å…©å¥æ˜¯ç§»é™¤ <code>table</code> çš„åŸæœ‰çš„ä¸€äº›é¢¨æ ¼ä¿¡æ¯ä»¥åŠå±¬æ€§ã€‚å¾Œé¢æ˜¯çˆ²å…¶åŠ ä¸Š Bootstrap ç‰¹æœ‰çš„ <code>table</code> é¡å‹ã€‚</p>
<p>ç•¶ç„¶ï¼Œæ›´å¤šçš„ <code>table</code> å…ƒç´ é‚„éœ€è¦å…¶å®ƒæ›´å¤šæ“ä½œã€‚ä¸éå°±ç›®å‰çˆ²æ­¢ï¼Œ<strong>XPlan</strong> é‚„æ²’æœ‰ç€æ‰‹é—œæ–¼ <code>table</code> çš„æ›´æ·±ä¸€å±¤å®¹éŒ¯è™•ç†ã€‚ä¸éé€™è£å¯ä»¥æä¾›ä¸€å€‹æ€è·¯ã€‚</p>
<p>æ¯”å¦‚èªª <a href="http://www.cst.zju.edu.cn/index.php?c=Index&amp;a=detail&amp;catid=72&amp;id=1885" target="_blank" rel="external">é€™ç¯‡æ–‡ç« ä¸­</a>ï¼Œä¸çŸ¥é“æ˜¯èª°çµ¦çš„åœ¨ç·šå¯Œæ–‡æœ¬ç·¨è¼¯å™¨å‹‡æ°£ï¼Œä½¿å…¶ä¸‹é¢å¹¾å¼µåœ–ç‰‡éƒ½å„è‡ªè¢«ä¸€å€‹ <code>table</code> åŠå…¶å­å…ƒç´ æ‰€åŒ…å«ã€‚æ›´æœ‰ç”šè€…ï¼Œæœ‰ä¸€ç¯‡æ–‡ç« çš„ä¸€å€‹æ®µè½è¢«ä¸€å€‹ <code>table</code> æ‰€åŒ…å®¹ï¼Œä¸¦ä¸”åœ¨å…¶å·¦å´é‚„æœ‰ä¸€å€‹çœ‹ä¸è¦‹çš„ <code>td</code> å…ƒç´ ã€‚</p>
<p>æˆ‘å€‘å¯ä»¥æä¾›çš„æ€è·¯å°±æ˜¯å¦‚æœä¸€å€‹ <code>table</code> åªæœ‰ä¸€è¡Œä¸€åˆ—å°±ç›´æ¥å°‡å…¶å…§å®¹å–å‡ºä¸¦åˆªé™¤è©² <code>table</code> ã€‚</p>
<h3 id="&lt;a_/&gt;">&lt;a /&gt;</h3><p>è¶…éˆæ¥å…ƒç´ æ˜¯ä¸€å€‹æ–°èèˆ‡ç”¨æˆ¶äº’å‹•çš„æ¯”è¼ƒé‡è¦çš„å…ƒç´ ä¹‹ä¸€ã€‚æˆ‘å€‘éœ€è¦ä¿æŒå…¶ç¾è§€æ€§ã€‚</p>
<p>èˆ‰å¹¾å€‹ä¾‹å­ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥å°‡è¶…éˆæ¥ä»¥ä¸€å€‹é¡æŒ‰éˆ•çš„å½¢å¼å‡ºç¾ï¼š</p>
<figure class="highlight smalltalk"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="char">$(</span><span class="comment">"a"</span>).removeAttr(<span class="comment">"style"</span>);</span><br><span class="line"><span class="char">$(</span><span class="comment">"a"</span>).addClass(<span class="comment">"btn btn-default btn-xs btn-info"</span>);</span><br></pre></td></tr></table></figure>
<p>ç„¶å¾Œæˆ‘å€‘ç”šè‡³å¯ä»¥å°å…¶åšä¸€äº›ç´°å¾®çš„è©å½™ä¿®æ”¹ã€‚</p>
<p>æ¯”å¦‚ç•¶æ–°èç™¼ä½ˆè€…ä¸Šå‚³äº†ä¸€å€‹é™„ä»¶ç„¶å¾Œä¸è² è²¬ä»»åœ°ç›´æ¥å°‡æ–‡ä»¶åè²¼ä¸Šçš„æ™‚å€™ï¼Œæˆ‘å€‘å¯ä»¥è²¼å¿ƒåœ°å°‡å…¶é¡¯ç¤ºæ–‡å­—æ”¹çˆ²â€œä¸‹è¼‰é™„ä»¶â€ã€‚</p>
<p>å†æ¯”å¦‚ç™¼ä½ˆè€…ç›´æ¥ä»¥URLå½¢å¼é¡¯ç¤ºä¸€å€‹è¶…éˆæ¥çš„æ™‚å€™ï¼Œæˆ‘å€‘å¯ä»¥è²¼å¿ƒåœ°å°‡å…¶æ”¹è®Šçˆ²â€œæ‰“é–‹éˆæ¥â€ç­‰ç­‰ã€‚</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"a"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">idx, elem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>($(<span class="keyword">this</span>).html().match(<span class="regexp">/.*\.(doc|xls|ppt|docx|xlsx|pptx)/</span>)) &#123;</span><br><span class="line">        $(<span class="keyword">this</span>).html(<span class="string">"&lt;i class='glyphicon glyphicon-paperclip'&gt;&lt;/i&gt; ä¸‹è¼‰é™„ä»¶"</span>);</span><br><span class="line">        $(<span class="keyword">this</span>).removeClass(<span class="string">"btn-info"</span>);</span><br><span class="line">        $(<span class="keyword">this</span>).addClass(<span class="string">"btn-warning"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>($(<span class="keyword">this</span>).html().match(<span class="regexp">/http.*\/\/.*/</span>)) &#123;</span><br><span class="line">        $(<span class="keyword">this</span>).html(<span class="string">"&lt;i class='glyphicon glyphicon-flag'&gt;&lt;/i&gt; æ‰“é–‹éˆæ¥"</span>);</span><br><span class="line">        $(<span class="keyword">this</span>).removeClass(<span class="string">"btn-info"</span>);</span><br><span class="line">        $(<span class="keyword">this</span>).addClass(<span class="string">"btn-warning"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç„¶å¾Œæˆ‘å€‘å†è™•ç†å¹¾å€‹ç”±æ–¼èª¤æ“ä½œè€Œå¢åŠ çš„éŒ¯èª¤éˆæ¥ï¼Œå¦‚åœ¨ç¶“ä¸Šé¢æ“ä½œå¾Œï¼Œé‚„å­˜åœ¨ç€urlèˆ‡é¡¯ç¤ºå…§å®¹ç›¸é—œçš„è¶…éˆæ¥å¯ä»¥ç›´æ¥å–æ¶ˆï¼Œå¦‚é€™é¡ï¼š</p>
<figure class="highlight xml"><figcaption><span>html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è®“æˆ‘å€‘è•©<span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"èµ·é›™æ§³"</span>&gt;</span>èµ·é›™æ§³<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="çµæŸèª">çµæŸèª</h2><p>è‡³æ­¤ï¼Œç•¶ä¸‹ç‰ˆæœ¬çš„ <strong>XPlan</strong> çš„æ–°èçˆ¬èŸ²æ‰‹æ©Ÿå±å¹•é©é…åŸºæœ¬å®Œæˆã€‚å…¶ä¸­ç•¶ç„¶é‚„å­˜åœ¨ç€ä¸€äº›ç´°ç¯€è™•ç†å’Œé¡¯ç¤ºéŒ¯èª¤è™•ç†çš„ä¸è¶³ï¼Œä½†æ˜¯å·²ç¶“å®šä¸‹äº†åŸºæœ¬çš„é©é…æ€è·¯ã€‚</p>
<p>æˆ‘å€‘é‚„åœ¨æ¢ç´¢æ›´å¥½çš„é©é…æ–¹æ³•ï¼Œè€Œç•¶ä¸‹çš„é©é…å½¢å¼æš«æ™‚å·²ç¶“å¯ä»¥æ»¿è¶³äº†æˆ‘å€‘é …ç›®çš„éœ€æ±‚ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p><strong>XPlan</strong> æ˜¯ä¸€å€‹â€œåŸºæ–¼æ ¡åœ’å¼·é—œä¿‚çš„ç¤¾äº¤æ‡‰ç”¨â€çš„é–‹ç™¼ä»£è™Ÿã€‚å…¶ä¸­æœ‰ä¸€å€‹åŠŸèƒ½æ˜¯å¾å­¸æ ¡ç¶²ç«™ä¸Šé€šéç¶²çµ¡çˆ¬èŸ²ï¼ˆWeb Crawlerï¼‰å½¢å¼å°‡å­¸æ ¡æ–°èæŠ“å–åˆ°XPlanè‡ªèº«çš„æ•¸æ“šåº«ç•¶ä¸­ã€‚</p>
<p>è€Œé€™è£å‡ºç¾çš„ä¸€]]>
    </summary>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="XPlan" scheme="http://xcoder.in/tags/XPlan/"/>
    
      <category term="Programming" scheme="http://xcoder.in/categories/Programming/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[TopCoder SRM 589 DIV 2]]></title>
    <link href="http://xcoder.in/2013/08/31/srm-589-div2/"/>
    <id>http://xcoder.in/2013/08/31/srm-589-div2/</id>
    <published>2013-08-30T16:00:00.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€å¥½ä¹…æ²’æ“¼ <strong>TC</strong> äº†ï¼Œæ‰‹éƒ½ç”Ÿäº†ã€‚å‰å…©å¤©å‰›æŠ˜é¨°å¥½ <strong>LinuxMint</strong> + <strong>Cinnamon</strong>ï¼Œé †ä¾¿æ‰‹è³¤æŠŠ <strong>TC</strong> ç’°å¢ƒé…å¥½äº†ã€‚</p>
<p>ã€€ã€€éš¨ä¾¿é€²å»æ‰¯äº†ä¸€å¥—æœ€æ–°çš„ <strong>SRM</strong> ä¾†æï¼Œå…¨è·‘å®Œä¹‹å¾Œæ‰ç™¼ç¾åŸä¾†é€™å ´æ¯”è³½é‚„è™•æ–¼ <strong>System Running</strong> éšæ®µã€‚æ–¼æ˜¯çŸ¥é“äº†æ¯”è³½ä¸€çµæŸé‚„åœ¨ <strong>Running</strong> çš„æ™‚å€™ä½ å°±å·²ç¶“å¯ä»¥è‡ªå·±æ‹‰å‡ºä¾†åšäº†ã€‚å°ç¶ åå¤§å®¶ä¸è¦ç¬‘ã€‚</p>
<!-- æˆ‘æ˜¯å°å°åˆ†å‰²ç¬¦ -->
<h2 id="Summary">Summary</h2><p>ã€€ã€€é€™æ¬¡ <strong>DIV 2</strong> çš„é›£åº¦ä¸€èˆ¬ï¼Œä¸€é“ç°½åˆ°é¡ŒåŠ å…©é“æ™®é€šçš„ <strong>DP</strong>ã€‚</p>
<p>ã€€ã€€<a href="https://github.com/XadillaX/xadillax-topcoder/tree/master/code/SRM589-DIV2" target="_blank" rel="external">Code on GitHub</a>.</p>
<h2 id="250pt_-_Goose_Tattarrattat">250pt - Goose Tattarrattat</h2><p>é¡Œæ„å¾ˆç°¡å–®ï¼Œå°±æ˜¯çµ¦ä½ ä¸€å€‹å­—ç¬¦ä¸²ï¼Œå•ä½ æœ€å°‘æ”¹è®Šå¤šå°‘å­—ç¬¦è®“å­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦éƒ½ä¸€æ¨£ã€‚</p>
<p>ç°½åˆ°é¡Œï¼Œæ‰¾æœ€å¤šçš„å­—ç¬¦è·Ÿç¸½é•·åº¦ä¸€æ¸›å°±OKäº†ã€‚</p>
<figure class="highlight cpp"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> SIZE(x) ((int)(x.size()))</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> LENGTH(x) ((int)(x.length()))</span></span><br><span class="line"><span class="keyword">class</span> GooseTattarrattatDiv2 </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getmin</span><span class="params">(<span class="built_in">string</span> S)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> GooseTattarrattatDiv2::getmin(<span class="built_in">string</span> S)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> maxsame = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LENGTH(S); i++)</span><br><span class="line">    &#123;</span><br><span class="line">    	mp[S[i]]++;</span><br><span class="line">    	maxsame = max(maxsame, mp[S[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> LENGTH(S) - maxsame;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="500pt_-_Gears">500pt - Gears</h2><p>æœ‰ <strong><em>N</em></strong> å€‹é½’è¼ªåœæˆä¸€åœˆï¼Œç›¸é„°å…©å€‹é½’è¼ªè¦åæ–¹å‘è½‰æ‰èƒ½æ­£å¸¸é‹è½‰ä¸å¡åˆ°å…¶å®ƒè¼ªå­ã€‚ä½ è¦å¾ä¸­é–“æ‹¿æ‰å¹¾å€‹é½’è¼ªï¼ˆç•™ç©ºäº†å°±ä¸å½±éŸ¿å…¶å·¦é‚Šçš„å·¦é‚Šçš„é½’è¼ªï¼‰ï¼Œå•æœ€å°‘æ‹¿æ‰å¹¾å€‹ä½¿å¾—æ‰€æœ‰é½’è¼ªèƒ½æ­£å¸¸è½‰ã€‚</p>
<p>æˆ‘å€‘å»ºå…©å€‹äºŒç¶­ <strong><em>dp</em></strong> æ•¸çµ„ï¼Œæˆ–è€…ä¸€å€‹ä¸‰ç¶­ <strong><em>dp</em></strong> æ•¸çµ„ï¼š</p>
<figure class="highlight markdown"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[<span class="link_label">i</span>][<span class="link_reference">0|1</span>][<span class="link_label">0|1</span>]</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ç¶­ <code>i</code> ä»£è¡¨ç•¶å‰æ˜¯ç¬¬ <code>i</code> å€‹é½’è¼ªã€‚ç¬¬äºŒç¶­è‹¥æ˜¯ <code>0</code> å‰‡è¡¨ç¤ºé€™å€‹é½’è¼ªæ‹¿èµ°ï¼Œè‹¥æ˜¯ <code>1</code> ä»£è¡¨ç•™ä¸‹ã€‚ç¬¬ä¸‰ç¶­è‹¥æ˜¯ <code>0</code> å‰‡ä»£è¡¨ç¬¬ä¸€å€‹é½’è¼ªæ‹¿èµ°ï¼Œ<code>1</code> ä»£è¡¨ç¬¬ä¸€å€‹é½’è¼ªç•™ä¸‹ã€‚æ•´å€‹æ•¸çµ„çš„æ¯å€‹å…ƒç´ å°±ä»£è¡¨è©²é½’è¼ªç•™ä¸‹æˆ–è€…æ‹¿èµ°ä¸”ç¬¬ä¸€å€‹é½’è¼ªæ˜¯ç•™ä¸‹æˆ–è€…æ‹¿èµ°çš„æƒ…æ³ä¸‹çš„æœ€å°‘æ‹¿èµ°é½’è¼ªæ•¸ã€‚</p>
<p>æ‰€ä»¥æˆ‘å€‘èƒ½å¾—åˆ°å¹¾å€‹ç‹€æ…‹è½‰ç§»æ–¹ç¨‹ï¼š</p>
<blockquote>
<h3 id="ç¬¬ä¸€å€‹é½’è¼ª">ç¬¬ä¸€å€‹é½’è¼ª</h3></blockquote>
<figure class="highlight markdown"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dp[<span class="link_label">i</span>][<span class="link_reference">0</span>][<span class="link_label">0</span>] = 1;</span><br><span class="line">dp[<span class="link_label">i</span>][<span class="link_reference">0</span>][<span class="link_label">1</span>] = INF;</span><br><span class="line">dp[<span class="link_label">i</span>][<span class="link_reference">1</span>][<span class="link_label">1</span>] = 0;</span><br><span class="line">dp[<span class="link_label">i</span>][<span class="link_reference">1</span>][<span class="link_label">0</span>] = INF;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="ç¬¬äºŒå€‹é½’è¼ª">ç¬¬äºŒå€‹é½’è¼ª</h3><p>å¦‚æœèˆ‡ç¬¬ä¸€å€‹åŒå‘é‚£éº¼å°±æœ‰äº†ä¸€ç•™ä¸€èµ°æˆ–è€…å…©å€‹éƒ½èµ°çš„æƒ…æ³ã€‚å¦å‰‡å°±æ˜¯å››ç¨®æƒ…æ³éƒ½å¯ä»¥ã€‚</p>
</blockquote>
<figure class="highlight cpp"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(èˆ‡ç¬¬ä¸€å€‹é½’è¼ªåŒå‘)</span><br><span class="line">&#123;</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>] = INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">    dp[i][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">    dp[i][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[i][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[i][<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="ä¹‹å¾Œçš„æ‰€æœ‰é½’è¼ª">ä¹‹å¾Œçš„æ‰€æœ‰é½’è¼ª</h3><p>è‹¥è©²é½’è¼ªèˆ‡å‰ä¸€å€‹é½’è¼ªæ–¹å‘ç›¸åŒ ï¼Œé‚£éº¼è©²é½’è¼ªç•™ä¸‹çš„æ™‚å€™ï¼Œå‰ä¸€å€‹é½’è¼ªå¿…é ˆå¾—èµ°ï¼Œé‚£éº¼å°±æ˜¯ <code>dp[i - 1][0][?]</code>;è©²é½’è¼ªèµ°çš„æ™‚å€™ï¼Œå‰ä¸€å€‹é½’è¼ªå¯èµ°å¯ç•™ï¼Œå°±æ˜¯ <code>dp[i - 1][0|1][?] + 1</code> çš„ç¨å¾®å°ä¸€é»é‚£å€‹ã€‚</p>
<p>è‹¥æ–¹å‘ä¸ç›¸åŒ ï¼Œé‚£éº¼å°±æ˜¯è©²é½’è¼ªç•™ä¸‹çš„æ™‚å€™ï¼Œå‰ä¸€å€‹é½’è¼ªä¹Ÿå¯ä»¥ç•™ä¸‹ã€‚</p>
</blockquote>
<figure class="highlight accesslog"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">if(èˆ‡å‰ä¸€å€‹é½’è¼ªåŒå‘)</span><br><span class="line">&#123;</span><br><span class="line">    dp<span class="string">[i]</span><span class="string">[1]</span><span class="string">[0]</span> = dp<span class="string">[i - 1]</span><span class="string">[0]</span><span class="string">[0]</span>;</span><br><span class="line">    dp<span class="string">[i]</span><span class="string">[1]</span><span class="string">[1]</span> = dp<span class="string">[i - 1]</span><span class="string">[0]</span><span class="string">[1]</span>;</span><br><span class="line"></span><br><span class="line">    dp<span class="string">[i]</span><span class="string">[0]</span><span class="string">[0]</span> = min(dp<span class="string">[i - 1]</span><span class="string">[1]</span><span class="string">[0]</span>, dp<span class="string">[i - 1]</span><span class="string">[0]</span><span class="string">[0]</span>) + <span class="number">1</span>;</span><br><span class="line">    dp<span class="string">[i]</span><span class="string">[0]</span><span class="string">[1]</span> = min(dp<span class="string">[i - 1]</span><span class="string">[1]</span><span class="string">[1]</span>, dp<span class="string">[i - 1]</span><span class="string">[1]</span><span class="string">[0]</span>) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">else </span><br><span class="line">&#123;</span><br><span class="line">    dp <span class="string">[i]</span><span class="string">[1]</span><span class="string">[0]</span> = min(dp<span class="string">[i - 1]</span><span class="string">[0]</span><span class="string">[0]</span>, dp<span class="string">[i - 1]</span><span class="string">[1]</span><span class="string">[0]</span>);</span><br><span class="line">    dp <span class="string">[i]</span><span class="string">[1]</span><span class="string">[1]</span> = min(dp<span class="string">[i - 1]</span><span class="string">[0]</span><span class="string">[1]</span>, dp<span class="string">[i - 1]</span><span class="string">[1]</span><span class="string">[1]</span>);</span><br><span class="line"></span><br><span class="line">    dp <span class="string">[i]</span><span class="string">[0]</span><span class="string">[0]</span> = min(dp<span class="string">[i - 1]</span><span class="string">[1]</span><span class="string">[0]</span>, dp<span class="string">[i - 1]</span><span class="string">[0]</span><span class="string">[0]</span>) + <span class="number">1</span>;</span><br><span class="line">    dp <span class="string">[i]</span><span class="string">[0]</span><span class="string">[1]</span> = min(dp<span class="string">[i - 1]</span><span class="string">[1]</span><span class="string">[1]</span>, dp<span class="string">[i - 1]</span><span class="string">[1]</span><span class="string">[1]</span>) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€å¾Œè‹¥æœ€å¾Œä¸€å€‹é½’è¼ªèˆ‡ç¬¬ä¸€å€‹é½’è¼ªåŒå‘ï¼Œé‚£éº¼åœ¨ <code>dp[i - 1][0][0]</code>ã€<code>dp[i - 1][0][1]</code>ã€<code>dp[i - 1][1][0]</code> ä¸­æŒ‘ä¸€å€‹ã€‚è‹¥ä¸åŒå‘ï¼Œé‚£éº¼å¤šäº†å€‹ <code>dp[i - 1][1][1]</code> é€™å€‹é¸æ“‡ã€‚</p>
<p>ä¸‹é¢å°±æ˜¯ä»£ç¢¼äº†ï¼š</p>
<figure class="highlight cpp"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> GearsDiv2 </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getmin</span><span class="params">(<span class="built_in">string</span> Directions)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> GearsDiv2::getmin(<span class="built_in">string</span> Directions)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> dp[<span class="number">100</span>][<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LENGTH(Directions); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">10000000</span>;</span><br><span class="line">            dp[i][<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            dp[i][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">10000000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Directions[i] == Directions[i - <span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                dp[i][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">                dp[i][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">                </span><br><span class="line">                dp[i][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">                dp[i][<span class="number">1</span>][<span class="number">1</span>] = <span class="number">10000000</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                dp[i][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">                dp[i][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">                dp[i][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">                dp[i][<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span>(Directions[i] == Directions[i - <span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            dp[i][<span class="number">1</span>][<span class="number">0</span>] = dp[i - <span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">            dp[i][<span class="number">1</span>][<span class="number">1</span>] = dp[i - <span class="number">1</span>][<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">            </span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">0</span>] = min(dp[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], dp[i - <span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>]) + <span class="number">1</span>;</span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">1</span>] = min(dp[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>], dp[i - <span class="number">1</span>][<span class="number">0</span>][<span class="number">1</span>]) + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            dp[i][<span class="number">1</span>][<span class="number">0</span>] = min(dp[i - <span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>], dp[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">            dp[i][<span class="number">1</span>][<span class="number">1</span>] = min(dp[i - <span class="number">1</span>][<span class="number">0</span>][<span class="number">1</span>], dp[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">            </span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">0</span>] = min(dp[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], dp[i - <span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>]) + <span class="number">1</span>;</span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">1</span>] = min(dp[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>], dp[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>]) + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> ans;</span><br><span class="line">    <span class="keyword">int</span> mi = LENGTH(Directions) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(Directions[mi] == Directions[<span class="number">0</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        ans = min(dp[mi][<span class="number">0</span>][<span class="number">0</span>], min(dp[mi][<span class="number">1</span>][<span class="number">0</span>], dp[mi][<span class="number">0</span>][<span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ans = min(min(dp[mi][<span class="number">0</span>][<span class="number">0</span>], dp[mi][<span class="number">1</span>][<span class="number">1</span>]), min(dp[mi][<span class="number">0</span>][<span class="number">1</span>], dp[mi][<span class="number">1</span>][<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1000pt_-_Flipping_Bits">1000pt - Flipping Bits</h2><p>çµ¦ä½ ä¸€å€‹ <strong>01ä¸²</strong> èˆ‡ä¸€å€‹æ­£æ•´æ•¸ <strong><em>M</em></strong>ã€‚<strong>01ä¸²</strong> æœ‰å¦‚ä¸‹ä¸‰ç¨®æ“ä½œ:</p>
<ul>
<li>éš¨ä¾¿åè½‰ä¸€ä½ï¼ˆ0 -&gt; 1, 1 -&gt; 0ï¼‰ã€‚</li>
<li>å°‡é–‹é ­ <code>k * M</code> ä½åè½‰ã€‚k å¯ä»¥æ˜¯ä»»ä½•æ­£æ•´æ•¸ã€‚</li>
<li>å°‡æœ«å°¾ <code>k * M</code> ä½åè½‰ã€‚k å¯ä»¥æ˜¯ä»»ä½•æ­£æ•´æ•¸ã€‚</li>
</ul>
<p>å•æœ€å°‘éœ€è¦å¹¾æ­¥å°‡æ•´å€‹å­—ç¬¦ä¸²è®Šæˆéƒ½æ˜¯ <code>1</code>ã€‚</p>
<p>é€™åˆæ˜¯ä¸€å€‹ <strong>DP</strong> çš„é¡Œç›®ã€‚</p>
<p>æˆ‘å€‘å…ˆè¨­æœ‰ <strong><em>G</em></strong> çµ„ï¼Œä¸€çµ„ <strong><em>M</em></strong> å€‹ <code>01å­—ç¬¦</code>ã€‚é‚£éº¼å°±èƒ½æœ‰</p>
<figure class="highlight markdown"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dp1[<span class="link_label">i</span>][<span class="link_reference">0|1</span>]</span><br><span class="line">dp2[<span class="link_label">i</span>][<span class="link_reference">0|1</span>]</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>i</code> ä»£è¡¨ç¬¬ <code>i</code> çµ„ï¼Œç¬¬äºŒç¶­å¦‚æœæ˜¯ <code>0</code> å°±ä»£è¡¨é€™ä¸€çµ„æ¡ç”¨ä¸€ä½ä½åè½‰çš„æ“ä½œå°‡é€™çµ„å…¨è®Šæˆ <code>1</code>ï¼Œå¦‚æœæ˜¯ <code>1</code> å‰‡å°‡æ•´çµ„å…¨éƒ¨åè½‰å†æ¡ç”¨ä¸€ä½ä½åè½‰çš„æ“ä½œå°‡é€™çµ„å…¨è®Šæˆ <code>1</code> ã€‚è‡³æ–¼ <code>dp1</code> å’Œ <code>dp2</code> å‰‡ä»£è¡¨å¾é ­åˆ°å°¾å’Œå¾å°¾åˆ°é ­ã€‚</p>
<p>ç”±æ–¼åªæœ‰ <code>0</code> å’Œ <code>1</code> åè½‰ï¼Œé‚£éº¼ä¸€çµ„åè½‰å…©æ¬¡å°±èƒ½é‚„åŸåŸç‹€â€”â€”é€™æ˜¯ä¸€å€‹éå¸¸é‡è¦çš„æ€§è³ªã€‚</p>
<p>å¦‚æœæŸä¸€çµ„æ¡ç”¨<strong>æ•´çµ„åè½‰</strong>çš„æ“ä½œï¼Œè‹¥å‰ä¸€çµ„ä¹Ÿæ˜¯<strong>æ•´çµ„åè½‰</strong>ï¼Œé‚£éº¼å°±ç›¸ç•¶æ–¼æ“ä½œæ¬¡æ•¸ä¸è®Šï¼Œåªæ˜¯å°‡å‰ä¸€çµ„çš„åè½‰ç¯„åœå»¶çºŒåˆ°é€™ä¸€çµ„ï¼›è‹¥å‰ä¸€çµ„æ˜¯<strong>éæ•´çµ„åè½‰</strong>ï¼Œé‚£éº¼å°±ç›¸ç•¶æ–¼å¾é ­åˆ°é€™ä¸€çµ„åè½‰ä¹‹å¾Œï¼Œå‰é¢çš„æ‰€æœ‰çµ„å†åè½‰å›å»â€”â€”ç›¸ç•¶æ–¼æ˜¯å¤šäº†å…©æ¬¡æ“ä½œã€‚æ–¼æ˜¯å°±æœ‰äº†ï¼ˆå…ˆåªæ‹¿ <code>dp1</code> ä½œçˆ²ä¾‹å­ï¼‰ï¼š</p>
<figure class="highlight markdown"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dp1[<span class="link_label">i</span>][<span class="link_reference">1</span>] = min(</span><br><span class="line"><span class="code">    dp[i - 1][0] + é€™ä¸€çµ„1çš„æ•¸é‡ + 2,</span></span><br><span class="line"><span class="code">    dp[i - 1][1] + é€™ä¸€çµ„1çš„æ•¸é‡ </span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæŸä¸€çµ„æ¡ç”¨<strong>éæ•´çµ„åè½‰</strong>ï¼Œé‚£éº¼æ“ä½œæ¬¡æ•¸å°±æ˜¯å‰ä¸€çµ„çš„<strong>æ•´çµ„åè½‰</strong>æˆ–è€…<strong>éæ•´çµ„åè½‰</strong>çš„æ“ä½œæ¬¡æ•¸åŠ ä¸Šé€™ä¸€çµ„ <code>0</code> çš„æ•¸é‡ï¼š</p>
<figure class="highlight markdown"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dp1[<span class="link_label">i</span>][<span class="link_reference">0</span>] = min(</span><br><span class="line"><span class="code">    dp[i - 1][0] + é€™ä¸€çµ„0çš„æ•¸é‡,</span></span><br><span class="line"><span class="code">    dp[i - 1][0] + é€™ä¸€çµ„0çš„æ•¸é‡</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>ç”¨ä¸Šé¢çš„è½‰ç§»æ–¹ç¨‹æŠŠæ­£åå‘éƒ½æ±‚äº†ä¸€éä¹‹å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥æ±‚ç¸½ç­”æ¡ˆäº†ï¼Œç¸½ç­”æ¡ˆå°±æ˜¯æˆ‘å€‘æšèˆ‰ä¸­é–“åªæœ‰<strong>æ“ä½œ1</strong>çš„æ®µçš„é¦–å°¾ï¼ŒåŠ ä¸Šè©²ä¸­é–“æ®µå‰éƒ¨åˆ†çš„ <strong><em>dp</em></strong> ç­”æ¡ˆå’Œå…¶å¾Œéƒ¨åˆ†çš„ <strong><em>dp</em></strong> ç­”æ¡ˆï¼Œå–å‡ºæœ€å°å€¼å°±æ˜¯äº†ã€‚</p>
<figure class="highlight cpp"><figcaption><span>cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> FlippingBitsDiv2 </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getmin</span><span class="params">(<span class="built_in">vector</span> &lt;<span class="built_in">string</span>&gt; S, <span class="keyword">int</span> M)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">string</span> str;</span><br><span class="line">    <span class="keyword">int</span> group;</span><br><span class="line">    <span class="keyword">int</span> tn1[<span class="number">2600</span>], tnsum1[<span class="number">2600</span>];</span><br><span class="line">    <span class="keyword">int</span> tn2[<span class="number">2600</span>], tnsum2[<span class="number">2600</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> dp1[<span class="number">2600</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> dp2[<span class="number">2600</span>][<span class="number">2</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calcsum</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l &gt; r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> tot = tnsum1[r] - tnsum1[l - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> tot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> FlippingBitsDiv2::getmin(<span class="built_in">vector</span> &lt;<span class="built_in">string</span>&gt; S, <span class="keyword">int</span> M)</span><br><span class="line">&#123;</span><br><span class="line">    str = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SIZE(S); i++) str += S[i];</span><br><span class="line">    group = LENGTH(str) / M;</span><br><span class="line">    ZERO(tn1);</span><br><span class="line">    ZERO(tn2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// init.</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; group; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> op = i * M;</span><br><span class="line">        <span class="keyword">int</span> ed = op + M;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = op; j &lt; ed; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(str[j] == <span class="string">'0'</span>) tn1[i]++, tn2[group - i - <span class="number">1</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        dp1[i][<span class="number">0</span>] = <span class="number">100000</span>;</span><br><span class="line">        dp1[i][<span class="number">1</span>] = <span class="number">100000</span>;</span><br><span class="line">        dp2[i][<span class="number">0</span>] = <span class="number">100000</span>;</span><br><span class="line">        dp2[i][<span class="number">1</span>] = <span class="number">100000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// tnsum</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; group; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">0</span>) tnsum1[<span class="number">0</span>] = tn1[<span class="number">0</span>], tnsum2[<span class="number">0</span>] = tn2[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            tnsum1[i] = tnsum1[i - <span class="number">1</span>] + tn1[i];</span><br><span class="line">            tnsum2[i] = tnsum2[i - <span class="number">1</span>] + tn2[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// dp.</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= group; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            dp1[i][<span class="number">0</span>] = dp1[i][<span class="number">1</span>] = dp2[i][<span class="number">0</span>] = dp2[i][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// head -&gt; tail</span></span><br><span class="line">            dp1[i][<span class="number">0</span>] = tn1[i - <span class="number">1</span>];</span><br><span class="line">            dp1[i][<span class="number">1</span>] = <span class="number">1</span> + (M - tn1[i - <span class="number">1</span>]);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// tail -&gt; head</span></span><br><span class="line">            dp2[i][<span class="number">0</span>] = tn2[i - <span class="number">1</span>];</span><br><span class="line">            dp2[i][<span class="number">1</span>] = <span class="number">1</span> + (M - tn2[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// head -&gt; tail</span></span><br><span class="line">            dp1[i][<span class="number">0</span>] = min(</span><br><span class="line">                dp1[i - <span class="number">1</span>][<span class="number">0</span>] + tn1[i - <span class="number">1</span>],</span><br><span class="line">                dp1[i - <span class="number">1</span>][<span class="number">1</span>] + tn1[i - <span class="number">1</span>]</span><br><span class="line">            );</span><br><span class="line">            dp1[i][<span class="number">1</span>] = min(</span><br><span class="line">                dp1[i - <span class="number">1</span>][<span class="number">0</span>] + <span class="number">2</span> + (M - tn1[i - <span class="number">1</span>]),</span><br><span class="line">                dp1[i - <span class="number">1</span>][<span class="number">1</span>] + (M - tn1[i - <span class="number">1</span>])</span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// tail -&gt; head</span></span><br><span class="line">            dp2[i][<span class="number">0</span>] = min(</span><br><span class="line">                dp2[i - <span class="number">1</span>][<span class="number">0</span>] + tn2[i - <span class="number">1</span>],</span><br><span class="line">                dp2[i - <span class="number">1</span>][<span class="number">1</span>] + tn2[i - <span class="number">1</span>]</span><br><span class="line">            );</span><br><span class="line">            dp2[i][<span class="number">1</span>] = min(</span><br><span class="line">                dp2[i - <span class="number">1</span>][<span class="number">0</span>] + <span class="number">2</span> + (M - tn2[i - <span class="number">1</span>]),</span><br><span class="line">                dp2[i - <span class="number">1</span>][<span class="number">1</span>] + (M - tn2[i - <span class="number">1</span>])</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> minans = <span class="number">100000000</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= group; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= group - i; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> zzl = i;</span><br><span class="line">            <span class="keyword">int</span> zzr = group - j - <span class="number">1</span>;</span><br><span class="line">            </span><br><span class="line">            minans = min(minans,</span><br><span class="line">                min(dp1[i][<span class="number">0</span>], dp1[i][<span class="number">1</span>]) +</span><br><span class="line">                min(dp2[j][<span class="number">0</span>], dp2[j][<span class="number">1</span>]) +</span><br><span class="line">                calcsum(zzl, zzr)</span><br><span class="line">                );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> minans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€å¥½ä¹…æ²’æ“¼ <strong>TC</strong> äº†ï¼Œæ‰‹éƒ½ç”Ÿäº†ã€‚å‰å…©å¤©å‰›æŠ˜é¨°å¥½ <strong>LinuxMint</strong> + <strong>Cinnamon</strong>ï¼Œé †ä¾¿æ‰‹è³¤æŠŠ <strong>TC</strong> ç’°å¢ƒé…å¥½äº†ã€‚</p>
<p>]]>
    </summary>
    
      <category term="SRM" scheme="http://xcoder.in/tags/SRM/"/>
    
      <category term="TopCoder" scheme="http://xcoder.in/tags/TopCoder/"/>
    
      <category term="Programming" scheme="http://xcoder.in/categories/Programming/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ä¸€èµ·æ“¼Node.JSï¼ˆå£¹ï¼‰â€”â€”åŸºæœ¬èªæ³•å’Œé¡å‹]]></title>
    <link href="http://xcoder.in/2013/08/16/node-4-base/"/>
    <id>http://xcoder.in/2013/08/16/node-4-base/</id>
    <published>2013-08-15T16:00:00.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p><strong>Node.js</strong> çš„åŸºç¤æ˜¯ <strong>JavaScript</strong> é€™é–€ <strong><em>è…³æœ¬èªè¨€</em></strong>ã€‚è€Œå¤§å¤šæ•¸çš„è…³æœ¬èªè¨€ä¸€å€‹å…±åŒçš„ç‰¹é»å°±æ˜¯â€œ<a href="http://zh.wikipedia.org/wiki/%E9%A1%9E%E5%9E%8B%E7%B3%BB%E7%B5%B1#.E5.BC.B7.E5.9E.8B.E5.88.A5.E5.92.8C.E5.BC.B1.E5.9E.8B.E5.88.A5" target="_blank" rel="external">å¼±é¡å‹</a>â€ã€‚</p>
<p>ã€€ã€€ä¸åŒæ–¼ <strong>PHP</strong> çš„æ˜¯ï¼Œ<strong>PHP</strong> å°±æ˜¯æ˜¯æœ‰äº†æ–°è®Šé‡ä¹Ÿç„¡éœ€ç”³æ˜ï¼Œè€Œ <strong>JavaScript</strong> å‰‡é‚„æ˜¯éœ€è¦ <code>var</code> ä¾†ç”³æ˜ä¸€ä¸‹çš„ã€‚è€Œé€™å€‹ <code>var</code> æ¶µè“‹äº† <strong>C++</strong> ä¸­çš„<code>int</code>ã€<code>string</code>ã€<code>char</code>ç­‰ä¸€åˆ‡é¡å‹çš„å«ç¾©ï¼Œç”šè‡³æ˜¯ <code>function</code>ã€‚</p>
<p>ã€€ã€€æœ¬ç¯‡ä»¥åŠå¾Œç¯‡çš„æ‰€æœ‰å…§å®¹éƒ½æ˜¯åœ¨ <strong>Linux</strong> æˆ–è€… <strong>Cygwin</strong> ä¸‹ç”¨ <strong>vim</strong> é€²è¡Œç·¨è¼¯ï¼ˆè‹¥ä¸æ˜¯å‰‡è«‹è‡ªè¡Œè½‰è®Šæˆä½ è‡ªå·±çš„æ–¹æ³•ï¼‰ï¼Œç„¶å¾Œåœ¨å‘½ä»¤è¡Œä¸‹é€²è¡ŒæŸ¥çœ‹çµæœçš„ã€‚</p>
<!-- æˆ‘æ˜¯å°å°åˆ†å‰²ç¬¦ -->
<h2 id="åŸºæœ¬èªæ³•">åŸºæœ¬èªæ³•</h2><h3 id="è®Šé‡è²æ˜">è®Šé‡è²æ˜</h3><p>åœ¨ <strong>C/C++</strong> ä¸­ï¼Œæˆ‘å€‘é€™éº¼è²æ˜è®Šé‡çš„ï¼š</p>
<figure class="highlight cpp"><figcaption><span>c++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> b = <span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">float</span> c = <span class="number">1.0f</span>;</span><br><span class="line"><span class="keyword">void</span> (*d)() = foo;  <span class="comment">///&lt; å¿˜äº†æ˜¯ä¸æ˜¯é€™éº¼å¯«çš„äº†ï¼Œç¸½ä¹‹æ˜¯å‡½æ•¸æŒ‡é‡</span></span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨ <strong>Node.js</strong> ä¸­å‰‡æ˜¯é€™æ¨£çš„ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">var</span> c = <span class="number">1.0</span>;</span><br><span class="line"><span class="keyword">var</span> d = foo;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ï¼Œç„¡è«–æ˜¯ä»€éº¼é¡å‹çš„è®Šé‡ï¼Œåœ¨ <strong>Node.js</strong> ä¸­éƒ½æ˜¯ä»¥ä¸€å€‹ <code>var</code> ä¾†è§£æ±ºçš„ã€‚</p>
<h3 id="å¾ªç’°èªå¥">å¾ªç’°èªå¥</h3><h4 id="forâ€¦i">forâ€¦i</h4><p>é€™å€‹å¾ªç’°èªå¥åŸºæœ¬ä¸Šè·Ÿ <strong>C/C++</strong> ä¸€æ¨£ï¼Œéƒ½æ˜¯</p>
<figure class="highlight cpp"><figcaption><span>c++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; foo; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œé‘‘æ–¼ <strong>Node.js</strong> æ˜¯å¼±é¡å‹ï¼Œæ‰€ä»¥åªéœ€è¦ï¼š</p>
<figure class="highlight matlab"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(var <span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; foo; <span class="built_in">i</span>++) <span class="cell">&#123;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="forâ€¦in">forâ€¦in</h4><p>é€™æ˜¯ä¸€ç¨®å¾Œæœ‰å‹çš„å¾ªç’°èªå¥ï¼Œé¡ä¼¼æ–¼ <strong>PHP</strong> çš„ <code>foreach</code>ã€‚</p>
<p>æ¯”å¦‚æˆ‘å€‘æœ‰ä¸€å€‹ <strong>JSONå°è±¡</strong> å¦‚ä¸‹ï¼š</p>
<figure class="highlight kotlin"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> foo</span> = &#123;</span><br><span class="line">    <span class="string">"hello"</span>     : <span class="string">"world"</span>,</span><br><span class="line">    <span class="string">"node"</span>      : <span class="string">"js"</span>,</span><br><span class="line">    <span class="string">"blahblah"</span>  : <span class="string">"bar"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€™å€‹æ™‚å€™æˆ‘å€‘å°±å¯ä»¥ç”¨ <code>for...in</code> ä¾†å¾ªç’°éæ­·äº†ï¼š</p>
<figure class="highlight processing"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(var <span class="variable">key</span> in foo) &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(<span class="variable">key</span> + <span class="string">": "</span> + foo[<span class="variable">key</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘å€‘å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æ‰“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<figure class="highlight crmsh"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">foo</span>.js</span><br></pre></td></tr></table></figure>
<p>å±å¹•ä¸Šå°±æœƒé¡¯ç¤ºä¸‹é¢çš„å…§å®¹äº†ï¼š</p>
<figure class="highlight http"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hello</span>: <span class="string">world</span></span><br><span class="line"><span class="attribute">node</span>: <span class="string">js</span></span><br><span class="line"><span class="attribute">blahblah</span>: <span class="string">bar</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æç¤º</strong>ï¼šç”±ä¸Šå¯çŸ¥ï¼Œ<code>for...in</code> èªå¥æ˜¯ç”¨ä¾†éæ­· <strong>JSONå°è±¡</strong>ã€<strong>æ•¸çµ„</strong>ã€<strong>å°è±¡</strong>çš„éµåçš„ï¼Œè€Œä¸æä¾›éµå€¼çš„éæ­·ã€‚å¦‚æœè¦ç²å–éµå€¼ï¼Œåªèƒ½é€šé</p>
</blockquote>
<figure class="highlight fsharp"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo<span class="annotation">[&lt;ç•¶å‰éµå&gt;]</span></span><br></pre></td></tr></table></figure>
<p>çš„å½¢å¼ä¾†ç²å–ã€‚é€™å€‹è·Ÿ <strong>PHP</strong> çš„ <code>foreach</code> é‚„æ˜¯æœ‰ä¸€å®šå€åˆ¥çš„ã€‚</p>
<h4 id="whileâ€¦do,_doâ€¦while">whileâ€¦do, doâ€¦while</h4><p>é€™å€‹å°±ä¸å¤šåšè§£é‡‹äº†ï¼Œè·Ÿå…¶å®ƒèªè¨€æ²’ä»€éº¼å¤§çš„å€åˆ¥ï¼Œç„¡éå°±æ˜¯å¦‚æœæœ‰è®Šé‡è²æ˜çš„è©±ï¼Œéœ€è¦ç”¨ <code>var</code> å°±å¤ äº†ã€‚</p>
<h3 id="é‹ç®—ç¬¦">é‹ç®—ç¬¦</h3><h4 id="+,_-,_*,_/">+, -, *, /</h4><p>é€™å¹¾å€‹é‹ç®—ç¬¦ä¹Ÿå°±é€™æ¨£ï¼Œè¦æ³¨æ„çš„æ˜¯ <code>+</code>ã€‚å®ƒæ—¢å¯ä»¥ä½œç”¨æ–¼å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä½œç”¨æ–¼æ•¸å€¼é‹ç®—ã€‚å¼±é¡å‹èªè¨€é›–ç„¶èªªé¡å‹æ˜¯å¼±çš„ï¼Œæ•¸å­—æœ‰æ™‚å€™å¯ä»¥ä»¥å­—ç¬¦ä¸²çš„å½¢æ…‹å‡ºç¾ï¼Œå­—ç¬¦ä¸²æœ‰æ™‚å€™å¯ä»¥ç”¨æ•¸å€¼çš„å½¢æ…‹å‡ºç¾ï¼Œä½†æ˜¯åœ¨å¿…è¦çš„æ™‚å€™ä¹Ÿé‚„æ˜¯è¦èªªä¸€ä¸‹å®ƒæ˜¯ä»€éº¼é¡å‹çš„ï¼Œæˆ‘å€‘å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç¢¼å»çœ‹çœ‹çµæœï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">"1"</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a + b);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">parseInt</span>(a) + b);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é€™è£çš„ <code>parseInt</code> æ˜¯ <strong>Node.js</strong> çš„ä¸€å€‹å…§ç½®å‡½æ•¸ï¼Œä½œç”¨æ˜¯å°‡ä¸€å€‹å­—ç¬¦ä¸²è§£ææˆ <code>int</code> é¡å‹çš„è®Šé‡ã€‚</p>
</blockquote>
<p>ä¸Šé¢çš„ä»£ç¢¼åŸ·è¡Œçµæœæ˜¯</p>
<figure class="highlight cpp"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€å€‹ <code>console.log</code> çµæœæ˜¯ <code>12</code>ï¼Œç”±æ–¼ <code>a</code> æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ <code>b</code> ä¹Ÿè¢«ç³»çµ±ä»¥å­—ç¬¦ä¸²çš„å§¿æ…‹é€²è¡ŒåŠ æ“ä½œï¼Œçµæœå°±æ˜¯å°‡å…©å€‹å­—ç¬¦ä¸²é»é€£åœ¨ä¸€èµ·å°±è®Šæˆäº† <code>12</code>ã€‚è€Œç¬¬äºŒå€‹ <code>console.log</code> çµæœæ˜¯ <code>3</code>ï¼Œæ˜¯å› çˆ²æˆ‘å€‘å°‡ç¬¬ä¸€å€‹ <code>a</code> è½‰è®Šçˆ²äº† <code>int</code> é¡å‹ï¼Œå…©å€‹ <code>int</code> å‹çš„è®Šé‡ç›¸åŠ å³æ•¸å€¼ç›¸åŠ ï¼Œçµæœç•¶ç„¶å°±æ˜¯ <code>3</code> äº†ã€‚</p>
<h4 id="==,_===,_!=,_!==">==, ===, !=, !==</h4><p>é€™è£æœ‰ä¸€é»è¦è§£é‡‹ï¼Œç•¶é€™å€‹é‚è¼¯é‹ç®—ç¬¦é•·åº¦çˆ² <code>2</code> çš„æ™‚å€™ï¼ˆ<code>==</code>, <code>!=</code>ï¼‰ï¼Œåªæ˜¯åˆ¤æ–·å¤–åœ¨çš„å€¼æ˜¯ä¸æ˜¯ä¸€æ¨£çš„ï¼Œè€Œä¸æœƒåˆ¤æ–·é¡å‹ã€‚å¦‚</p>
<figure class="highlight autohotkey"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var <span class="literal">a</span> = <span class="number">1</span>, b = <span class="string">"1"</span><span class="comment">;</span></span><br><span class="line">console.log(<span class="literal">a</span> == b)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>å®ƒè¼¸å‡ºçš„çµæœå°±æ˜¯ <code>true</code>ã€‚ä½†æ˜¯å¦‚æœæˆ‘å€‘åœ¨ä¸­é–“åˆ¤æ–·çš„æ™‚å€™å†åŠ ä¸Šä¸€å€‹ç­‰è™Ÿï¼Œé‚£éº¼å°±æ˜¯åš´æ ¼åˆ¤æ–·äº†ï¼Œéœ€è¦é¡å‹å’Œå€¼éƒ½ä¸€æ¨£çš„æ™‚å€™çº”æœƒæ˜¯ <code>true</code>ï¼Œå¦å‰‡å°±æ˜¯ <code>false</code>ã€‚ä¹Ÿå°±æ˜¯èªª</p>
<figure class="highlight autohotkey"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var <span class="literal">a</span> = <span class="number">1</span>, b = <span class="string">"1"</span><span class="comment">;</span></span><br><span class="line">console.log(<span class="literal">a</span> === b)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>çš„æ™‚å€™ï¼Œè¿”å›çš„çµæœå°±æ˜¯ <code>false</code> äº†ï¼Œå› çˆ² <code>a</code> æ˜¯ <code>int</code> å‹çš„ï¼Œè€Œ <code>b</code> å‰‡æ˜¯å­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p>é †å¸¶ç€å°±æŠŠæ¢ä»¶èªå¥è¬›äº†å§ï¼Œå…¶å¯¦é€™è£çš„ <code>if</code> è·Ÿåˆ¥çš„èªè¨€æ²’ä»€éº¼å…©æ¨£ï¼Œå°±æ˜¯å¹¾å€‹é‚è¼¯é‹ç®—ç¬¦å…©å€‹ç­‰è™Ÿä¸‰å€‹ç­‰è™Ÿçš„å•é¡Œã€‚æ‰€ä»¥å°±ä¸å¤šåšç´¯è¿°äº†ã€‚</p>
</blockquote>
<h4 id="typeof">typeof</h4><p>é€™è£æˆ‘å§‘ä¸”æŠŠå®ƒç•¶æˆæ˜¯ä¸€å€‹é‹ç®—ç¬¦è€Œä¸æ˜¯å‡½æ•¸äº†ã€‚</p>
<p>é€™å€‹é‹ç®—ç¬¦çš„ä½œç”¨æ˜¯åˆ¤æ–·ä¸€å€‹è®Šé‡çš„é¡å‹ï¼Œæœƒè¿”å›ä¸€å€‹å­—ç¬¦ä¸²ï¼Œå³é¡å‹åï¼Œå…·é«”çš„åŸ·è¡Œä¸‹é¢çš„ä»£ç¢¼å°±çŸ¥é“äº†ï¼š</p>
<figure class="highlight stata"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function foo() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = 0;</span><br><span class="line"><span class="keyword">var</span> b = 'å™“~è›‹èŠ±æ¹¯åœ¨ç¡è¦ºã€‚';</span><br><span class="line"><span class="keyword">var</span> c = 1.0;</span><br><span class="line"><span class="keyword">var</span> <span class="keyword">d</span> = foo;</span><br><span class="line"><span class="keyword">var</span> <span class="keyword">e</span> = &#123; <span class="string">"a"</span> : a &#125;;</span><br><span class="line"><span class="keyword">var</span> f = [ 1, 2, 3 ];</span><br><span class="line"><span class="keyword">var</span> <span class="keyword">g</span> = null;</span><br><span class="line"><span class="keyword">var</span> <span class="keyword">h</span> = undefined;</span><br><span class="line"></span><br><span class="line">console.<span class="literal">log</span>(<span class="keyword">typeof</span> a);</span><br><span class="line">console.<span class="literal">log</span>(<span class="keyword">typeof</span> b);</span><br><span class="line">console.<span class="literal">log</span>(<span class="keyword">typeof</span> c);</span><br><span class="line">console.<span class="literal">log</span>(<span class="keyword">typeof</span> <span class="keyword">d</span>);</span><br><span class="line">console.<span class="literal">log</span>(<span class="keyword">typeof</span> <span class="keyword">e</span>);</span><br><span class="line">console.<span class="literal">log</span>(<span class="keyword">typeof</span> f);</span><br><span class="line">console.<span class="literal">log</span>(<span class="keyword">typeof</span> <span class="keyword">g</span>);</span><br><span class="line">console.<span class="literal">log</span>(<span class="keyword">typeof</span> <span class="keyword">h</span>);</span><br></pre></td></tr></table></figure>
<p>é€™è£çš„åŸ·è¡Œçµæœå°±å°‡æœƒæ˜¯ï¼š</p>
<figure class="highlight scala"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">number</span><br><span class="line">string</span><br><span class="line">number</span><br><span class="line">function</span><br><span class="line"><span class="class"><span class="keyword">object</span></span><br><span class="line"></span><span class="class"><span class="keyword">object</span></span><br><span class="line"></span><span class="class"><span class="keyword">object</span></span><br><span class="line"></span>undefined</span><br></pre></td></tr></table></figure>
<h3 id="null,_undefined,_NaN">null, undefined, NaN</h3><p>åœ¨ <strong>JavaScript</strong> ä¸­ï¼Œæœ‰ä¸‰å€‹ç‰¹æ®Šçš„å€¼ï¼Œå¦‚æ¨™é¡Œæ‰€ç¤ºã€‚å…¶ä¸­ç¬¬ä¸€å€‹å¤§å®¶å¯èƒ½éƒ½æ¯”è¼ƒç†Ÿæ‚‰å§ï¼Œ<strong>C/C++</strong> è£é¢ä¹Ÿæœ‰ï¼Œä¸éæ˜¯å¤§å¯«çš„ï¼Œå…¶æœ¬è³ªå°±æ˜¯ä¸€å€‹</p>
<figure class="highlight stylus"><figcaption><span>c++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hexcolor">#def</span>ine NULL <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨ <strong>JavaScript</strong> ä¸­ï¼Œé€™ä¸‰å€‹å€¼æ‰€ä»£è¡¨çš„æ„ç¾©éƒ½ä¸åŒã€‚</p>
<h4 id="null">null</h4><p><code>null</code> æ˜¯ä¸€ç¨®ç‰¹æ®Šçš„ <strong>object</strong>ï¼Œå¤§è‡´çš„æ„æ€å°±æ˜¯ç©ºã€‚æ¯”å¦‚èªªï¼š</p>
<figure class="highlight kotlin"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> a</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<p>å¤§å®¶éƒ½èƒ½çœ‹æ‡‚ï¼Œå°±ä¸å¤šåšè§£é‡‹äº†ã€‚ä½†æ˜¯è·Ÿ <strong>C/C++</strong> ä¸åŒçš„æ˜¯ï¼Œé€™å€‹ <code>null</code> è·Ÿ <code>0</code> ä¸ç›¸ç­‰ã€‚</p>
<h4 id="undefined">undefined</h4><p>é€™å€‹æ±è¥¿çš„æ„æ€å°±æ˜¯èªªé€™å€‹è®Šé‡æœªè²æ˜ã€‚çˆ²äº†èƒ½å¤ æ›´å¥½åœ°å€åˆ† <code>null</code>ï¼Œæˆ‘å€‘çš„æ¨£ä¾‹ä»£ç¢¼å¦‚ä¸‹å¯«ï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    <span class="string">"foo"</span>       : <span class="literal">null</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(a[<span class="string">"foo"</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(a[<span class="string">"bar"</span>]);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç¢¼ä¸­ï¼Œæˆ‘å€‘è®“ <code>a[&quot;foo&quot;]</code> çš„å€¼çˆ²ç©ºï¼Œå³ <code>null</code>ã€‚è€Œå£“æ ¹æ²’æœ‰è²æ˜ <code>a[&quot;bar&quot;]</code> é€™å€‹æ±è¥¿ï¼Œå®ƒé€£ç©ºéƒ½ä¸æ˜¯ã€‚è¼¸å‡ºçš„çµæœå¤§å®¶éƒ½å·®ä¸å¤šæ‡‰è©²çŒœåˆ°äº†ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span></span><br><span class="line"><span class="literal">undefined</span></span><br></pre></td></tr></table></figure>
<h4 id="NaN">NaN</h4><p>é€™æ˜¯ä¸€å€‹ç©ºçš„æ•¸å€¼ï¼Œæ˜¯ä¸€å€‹ç‰¹æ®Šçš„ <code>number</code>ã€‚å®ƒçš„å…¨ç¨±æ˜¯ <code>Not a Number</code>ã€‚æœ‰é»å¥‡æ€ªï¼Œå¤§å®¶å¯ä»¥ç†è§£çˆ² <strong>ä¸æ˜¯æ•¸å­—å½¢æ…‹ï¼Œæˆ–è€…æ•¸å€¼å‡ºéŒ¯çš„ <code>number</code> é¡å‹è®Šé‡</strong>ã€‚</p>
<p>å¤šåœ¨æµ®é»å‹æ•¸å€¼é‹ç®—éŒ¯èª¤ï¼ˆå¦‚è¢«0é™¤ï¼‰çš„æƒ…æ³ä¸‹å‡ºç¾ï¼Œç”šè‡³å¯ä»¥æ˜¯ç”¨æˆ¶è‡ªå·±è®“ä¸€å€‹è®Šé‡ç­‰æ–¼ <code>NaN</code> ä»¥ä¾¿è¿”å›ä¸€å€‹éŒ¯èª¤å€¼è®“å¤§å®¶çŸ¥é“é€™å€‹å‡½æ•¸é‹ç®—å‡ºéŒ¯äº†äº‘äº‘ã€‚</p>
<h3 id="å°é›œç¢">å°é›œç¢</h3><p>å…¶å®ƒå‰©é¤˜çš„èªå¥ä¹Ÿè·Ÿå·²å­˜åœ¨çš„å…¶å®ƒèªè¨€å·®ä¸å¤šï¼Œæ¯”å¦‚èªª <code>break</code> å•Šã€<code>switch</code> å•Šã€<code>continue</code> å•Šç­‰ç­‰ç­‰ç­‰ã€‚</p>
<h2 id="è®Šé‡é¡å‹">è®Šé‡é¡å‹</h2><p>é€™ä¸€ç¯€ä¸»è¦è¬›çš„æ˜¯ <strong>JavaScript</strong> å°è±¡ï¼Œå…¶å®ƒé¡å‹å·®ä¸å¤šä¸€å¸¶è€Œéå§ã€‚</p>
<h3 id="åŸºç¤é¡å‹">åŸºç¤é¡å‹</h3><p><strong>Node.js</strong> åŒ…å«çš„åŸºç¤é¡å‹å·®ä¸å¤šæœ‰å¦‚ä¸‹å¹¾å€‹ï¼š</p>
<ul>
<li>number</li>
<li>string</li>
<li>boolean</li>
<li>array</li>
</ul>
<p>å…¶ä¸­å‰ä¸‰ç¨®é¡å‹å¯ä»¥ç›´æ¥è³¦å€¼ï¼Œè€Œ <code>array</code> çš„è³¦å€¼åªæ˜¯ä¸€å€‹å¼•ç”¨è³¦å€¼è€Œå·²ï¼Œåœ¨æ–°è®Šé‡ä¸­æ”¹è®ŠæŸå€‹å€¼çš„è©±èˆŠè®Šé‡çš„å€¼ä¹Ÿæœƒæ”¹è®Šï¼Œç›´æ¥å¯ä»¥è©¦è©¦ä¸‹é¢çš„ä»£ç¢¼ï¼š</p>
<figure class="highlight cpp"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var foo = [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ];</span><br><span class="line">var bar = foo;</span><br><span class="line">bar[<span class="number">0</span>] = <span class="number">3</span>;</span><br><span class="line">console.<span class="built_in">log</span>(foo);</span><br></pre></td></tr></table></figure>
<p>å®ƒå¾—å‡ºçš„çµæœæ˜¯ï¼š</p>
<figure class="highlight json"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span> ]</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯èªª <code>array</code> è¦æ˜¯è¤‡è£½å‡ºä¸€å€‹æ–°çš„æ•¸çµ„çš„è©±ï¼Œä¸èƒ½ç”¨ç›´æ¥è³¦å€¼çš„æ–¹æ³•ï¼Œè€Œå¿…é ˆâ€œ<strong><a href="#æ·±æ‹·è²">æ·±æ‹·è²</a></strong>â€ã€‚</p>
<p>é€™è£æœ‰å¿…è¦è¬›ä¸€ä¸‹ <code>array</code> çš„ä¸‰ç¨®å‰µå»ºæ–¹æ³•ã€‚</p>
<p>ç¬¬ä¸€ç¨®ï¼š</p>
<figure class="highlight cpp"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var dog = <span class="keyword">new</span> Array();</span><br><span class="line">dog[<span class="number">0</span>] = <span class="string">"å™“~"</span>;</span><br><span class="line">dog[<span class="number">1</span>] = <span class="string">"è›‹èŠ±æ¹¯"</span>;</span><br><span class="line">dog[<span class="number">2</span>] = <span class="string">"åœ¨ç¡è¦º"</span>;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç¨®ï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> <span class="built_in">Array</span>( <span class="string">"å™“~"</span>, <span class="string">"è›‹èŠ±æ¹¯"</span>, <span class="string">"åœ¨ç¡è¦º"</span> );</span><br></pre></td></tr></table></figure>
<p>ç¬¬å››ç¨®ï¼š</p>
<figure class="highlight kotlin"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> dog</span> = [</span><br><span class="line">    <span class="string">"å™“~"</span>,</span><br><span class="line">    <span class="string">"è›‹èŠ±æ¹¯"</span>,</span><br><span class="line">    <span class="string">"åœ¨ç¡è¦º"</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>æˆ‘å€‹äººæ¯”è¼ƒå–œæ­¡ç¬¬ä¸‰ç¨®å¯«æ³•ï¼Œæ¯”è¼ƒç°¡æ½”ã€‚</p>
<h3 id="JSONå°è±¡">JSONå°è±¡</h3><p>é€™è£æˆ‘æŠŠ <strong>JSONå°è±¡</strong> å–®ç¨æ‹å‡ºä¾†è€Œä¸æ˜¯æŠŠå®ƒæ­¸é¡çˆ² <strong>JavaScriptå°è±¡</strong>ï¼Œå¦‚æœè¦ºå¾—æˆ‘æœ‰é»èª¤äººå­å¼Ÿå°±å¯ä»¥ç›´æ¥è·³éé€™ä¸€ç¯€äº†ã€‚</p>
<p>æœ¬äººå°æ–¼ <strong>JSONå°è±¡</strong> å’Œ <strong>JavaScript</strong> å°è±¡çš„å€åˆ†æ”¾åœ¨ <strong>æ˜¯å¦åªç”¨ä¾†å­˜å„²æ•¸æ“šï¼Œè€Œä¸¦éæ˜¯ä¸€å€‹é¡çš„å¯¦ä¾‹åŒ–</strong>ã€‚å…¶å¯¦ <strong>JSON</strong> çš„æœ¬è³ªä¾¿æ˜¯ <strong>JavaScript Object Notation</strong>ã€‚</p>
<blockquote>
<p>æ›´å¤šæœ‰é—œ <strong><a href="http://zh.wikipedia.org/wiki/JSON" target="_blank" rel="external">JSON</a></strong> çš„ä¿¡æ¯è«‹è‡ªè¡Œç™¾ç§‘ã€‚</p>
</blockquote>
<p>åœ¨ <strong>Node.js</strong> ä¸­è²æ˜ä¸€å€‹ <strong>JSONå°è±¡</strong> éå¸¸ç°¡å–®ï¼š</p>
<figure class="highlight kotlin"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> dog</span> = &#123;</span><br><span class="line">    <span class="string">"pre"</span>       : <span class="string">"å™“~"</span>,</span><br><span class="line">    <span class="string">"sub"</span>       : &#123;</span><br><span class="line">        <span class="string">"name"</span>  : <span class="string">"è›‹èŠ±æ¹¯"</span>,</span><br><span class="line">        <span class="string">"act"</span>   : <span class="string">"åœ¨ç¡è¦º"</span>,</span><br><span class="line">        <span class="string">"time"</span>  : <span class="number">12</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">"suf"</span>       : [ <span class="string">"æˆ‘èªªäº†"</span>, <span class="string">"å®ƒåœ¨ç¡è¦º"</span>, <span class="string">"å°±æ˜¯åœ¨ç¡è¦º"</span> ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æœ‰å…©ç¨®æ–¹å¼èƒ½å¾—åˆ° <strong>JSONå°è±¡</strong> ä¸­çš„æŸå€‹éµåçš„éµå€¼ï¼Œç¬¬ä¸€ç¨®æ˜¯ç”¨é»é€£æ¥ï¼Œç¬¬äºŒç¨®æ˜¯ç”¨ä¸­æ‹¬è™Ÿï¼š</p>
<figure class="highlight css"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">dog</span><span class="class">.pre</span>;</span><br><span class="line"><span class="tag">dog</span><span class="attr_selector">["pre"]</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>è©¦è©¦çœ‹</strong>ï¼šç¾åœ¨ä½ è‡ªå·±å‹•æ‰‹è©¦è©¦çœ‹ï¼Œç”¨ <code>for...in</code> çš„å½¢å¼éæ­·ä¸€éä¸Šé¢çš„ <code>JSONå°è±¡</code>ã€‚åˆ¥å¿˜äº†ç”¨ä¸Š <code>typeof</code> å–µ~</p>
</blockquote>
<h3 id="é¡ï¼ˆå°è±¡ï¼‰çš„åŸºç¤">é¡ï¼ˆå°è±¡ï¼‰çš„åŸºç¤</h3><p>åš´æ ¼æ„ç¾©ä¸Šä¾†è¬›ï¼Œ<strong>Node.js</strong> çš„é¡ä¸èƒ½ç®—æ˜¯é¡ï¼Œå…¶å¯¦å®ƒåªæ˜¯ä¸€å€‹å‡½æ•¸çš„é›†åˆé«”ï¼ŒåŠ ä¸€äº›æˆå“¡è®Šé‡ã€‚å®ƒçš„æœ¬è³ªå…¶å¯¦æ˜¯ä¸€å€‹å‡½æ•¸ã€‚</p>
<p>ä¸éçˆ²äº†é€šä¿—åœ°è¬›ï¼Œæˆ‘å€‘æ¥ä¸‹å»ä»¥åŠä»¥å¾Œéƒ½å°‡å…¶ç¨±çˆ²â€œé¡â€ï¼Œå¯¦ä¾‹åŒ–çš„å«â€œå°è±¡â€ã€‚</p>
<p>å› çˆ²é¡æœ‰ç€å¾ˆå¤š <strong>å‡½æ•¸</strong> çš„ç‰¹æ€§ï¼Œæˆ–è€…èªªå®ƒçš„æœ¬è³ªå°±æ˜¯ä¸€å€‹ <strong>å‡½æ•¸</strong>ï¼Œæ‰€ä»¥é€™è£é¢æˆ‘å€‘å¯èƒ½ä¸€ä¸ç•™ç¥å°±é †å¸¶ç€æŠŠå‡½æ•¸åŸºç¤çµ¦è¬›äº†ã€‚</p>
<h4 id="é¡çš„è²æ˜å’Œå¯¦ä¾‹åŒ–">é¡çš„è²æ˜å’Œå¯¦ä¾‹åŒ–</h4><p>è²æ˜ä¸€å€‹é¡éå¸¸ç°¡å–®ï¼Œå¤§å®¶ä¸è¦ç¬‘ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œæˆ‘å€‘å·²ç¶“å¯«å¥½äº†ä¸€å€‹ <code>foo</code> é¡äº†ã€‚</p>
<blockquote>
<p>çœŸçš„å‡çš„ï¼Ÿï¼çœŸçš„ã€‚</p>
</blockquote>
<p>ä¸ä¿¡ï¼Ÿä¸ä¿¡ä½ å¯ä»¥æ¥ä¸‹å»æ‰“ä¸€æ®µä»£ç¢¼çœ‹çœ‹ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> foo();</span><br></pre></td></tr></table></figure>
<p>åˆ¥çœ‹å®ƒæ˜¯ä¸€å€‹å‡½æ•¸ï¼Œå¦‚æœä»¥é€™æ¨£çš„å½¢å¼ï¼ˆ<code>new</code>ï¼‰å¯«å‡ºä¾†ï¼Œå®ƒå°±æ˜¯é€™å€‹é¡çš„å¯¦ä¾‹åŒ–ã€‚</p>
<p>è€Œé€™å€‹æ‰€è¬‚çš„ <code>foo()</code> å…¶å¯¦å°±æ˜¯é€™å€‹ <code>foo()</code> é¡çš„æ§‹é€ å‡½æ•¸ã€‚</p>
<h4 id="æˆå“¡è®Šé‡">æˆå“¡è®Šé‡</h4><p>æˆå“¡è®Šé‡æœ‰å¥½å…©ç¨®æ–¹æ³•ã€‚</p>
<p>ç¬¬ä¸€ç¨®å°±æ˜¯åœ¨é¡çš„æ§‹é€ å‡½æ•¸æˆ–è€…ä»»ä½•æ§‹é€ å‡½æ•¸ä¸­ä½¿ç”¨ <code>this.&lt;è®Šé‡å&gt;</code> ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•æ™‚å€™è²æ˜ä¸€å€‹æˆå“¡è®Šé‡ï¼Œåœ¨å¤–éƒ¨ä¸å½±éŸ¿ä½¿ç”¨ï¼Œåæ­£å°±ç®—åœ¨é‚„æœªè²æ˜çš„æ™‚å€™ä½¿ç”¨å®ƒï¼Œä¹Ÿæœƒæœ‰ä¸€å€‹ <code>undefined</code> ä¾†æ’ç€ã€‚æ‰€ä»¥èªªé€™å°±æ˜¯ç¬¬ä¸€ç¨®æ–¹æ³•ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hello = <span class="string">"world"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šåªæœ‰åœ¨åŠ äº† <code>this</code> çš„æ™‚å€™çº”æ˜¯èª¿ç”¨é¡çš„<strong>æˆå“¡è®Šé‡</strong>ï¼Œå¦å‰‡åªæ˜¯å‡½æ•¸å…§çš„ä¸€å€‹å±€éƒ¨è®Šé‡è€Œå·²ã€‚è¦åˆ†æ¸…æ¥šæœ‰æ²’æœ‰ <code>this</code> çš„æ™‚å€™è®Šé‡çš„ä½œç”¨ç¯„åœã€‚</p>
</blockquote>
<p>ç¬¬äºŒç¨®æ–¹æ³•å°±æ˜¯åœ¨æ§‹é€ å‡½æ•¸æˆ–è€…ä»»ä½•æˆå“¡å‡½æ•¸å¤–éƒ¨è²æ˜ï¼Œå…¶æ ¼å¼æ˜¯ <code>&lt;é¡å&gt;.prototype.&lt;è®Šé‡å&gt;</code>ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo.prototype.hello = <span class="string">"world"</span>;</span><br></pre></td></tr></table></figure>
<p>ç„¡èŠä¸Šé¢å“ªç¨®æ–¹æ³•éƒ½æ˜¯å°æˆå“¡è®Šé‡çš„è²æ˜ï¼Œæˆ‘å€‘å¯ä»¥çœ‹çœ‹æ•ˆæœï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> foo();</span><br><span class="line"><span class="built_in">console</span>.log(bar.hello);</span><br></pre></td></tr></table></figure>
<p>ç”šè‡³ä½ å¯ä»¥é€™éº¼ä¿®æ”¹é€™å€‹é¡ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hello = <span class="string">"world"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo.prototype.hello = <span class="string">"è›‹èŠ±æ¹¯"</span>;</span><br></pre></td></tr></table></figure>
<p>ç„¶å¾Œå†ç”¨ä¸Šé¢çš„ä»£ç¢¼è¼¸å‡ºã€‚</p>
<blockquote>
<p>æƒ³æƒ³çœ‹çˆ²ä»€éº¼è¼¸å‡ºçš„é‚„æ˜¯ <code>world</code> è€Œä¸æ˜¯ <code>è›‹èŠ±æ¹¯</code>ã€‚</p>
</blockquote>
<h4 id="æ§‹é€ å‡½æ•¸">æ§‹é€ å‡½æ•¸</h4><p>æˆ‘å€‘ä¹‹å‰èªªéäº†é€™å€‹ <code>foo()</code> å¯¦éš›ä¸Šæ˜¯ä¸€å€‹ <strong>æ§‹é€ å‡½æ•¸</strong>ã€‚é‚£éº¼é¡¯ç„¶æˆ‘å€‘å¯ä»¥çµ¦æ§‹é€ å‡½æ•¸å‚³åƒæ•¸ï¼Œæ‰€ä»¥å°±æœ‰äº†ä¸‹é¢çš„ä»£ç¢¼ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç¢¼2.1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(hello)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(hello === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.hello = <span class="string">"world"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.hello = hello;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘å€‘çœ‹åˆ°ä¸Šé¢æœ‰ä¸€å€‹å¥‡è‘©çš„åˆ¤æ–· <code>if(hello === undefined)</code>ï¼Œé€™å€‹åˆ¤æ–·æœ‰ä»€éº¼ç”¨å‘¢ï¼Ÿç¬¬ä¸€ç¨®å¯èƒ½ï¼Œå°±æ˜¯é–‹ç™¼è€…å¾ˆè›‹ç–¼åœ°ç‰¹æ„å‚³é€²å»ä¸€å€‹ <code>undefined</code> é€²å»ï¼Œé€™å€‹æ™‚å€™å®ƒæ˜¯ <code>undefined</code> ç„¡å¯åšéã€‚</p>
<p>é‚„æœ‰ä¸€ç¨®æƒ…æ³ã€‚æˆ‘å€‘ä¸€é–‹å§‹å°±èªªäº† <strong>JavaScript</strong> æ˜¯ä¸€é–€å¼±é¡å‹èªè¨€ï¼Œå…¶å¯¦ä¸åƒ…åƒ…æ˜¯å¼±é¡å‹ï¼Œå®ƒçš„å‚³åƒæ•¸ä¹Ÿéå¸¸ä¸åš´è¬¹ã€‚ä½ å¯ä»¥å¤šå‚³æˆ–è€…å°‘å‚³ï¼ˆåªè¦ä¿è­‰ä½ å¤šå‚³æˆ–è€…å°‘å‚³çš„æ™‚å€™å¯ä»¥ä¿è­‰ç¨‹åºä¸å‡ºéŒ¯ï¼Œæˆ–è€…é‚è¼¯ä¸å‡ºéŒ¯ï¼‰ï¼ŒåŸå‰‡ä¸Šéƒ½æ˜¯å¯ä»¥çš„ã€‚å¤šå‚³çš„åƒæ•¸æœƒè¢«è‡ªå‹•å¿½ç•¥ï¼Œè€Œå°‘å‚³çš„åƒæ•¸æœƒä»¥ <code>undefined</code> è£œè¶³ã€‚</p>
<p>çœ‹çœ‹ä¸‹é¢çš„ä»£ç¢¼å°±æ˜ç™½äº†ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸Šæ¥ä»£ç¢¼2.1</span></span><br><span class="line"><span class="keyword">var</span> bar1 = <span class="keyword">new</span> foo();</span><br><span class="line"><span class="keyword">var</span> bar2 = <span class="keyword">new</span> foo(<span class="string">"è›‹èŠ±æ¹¯"</span>);</span><br></pre></td></tr></table></figure>
<p>è«‹è‡ªè¡Œè¼¸å‡ºä¸€ä¸‹å…©å€‹ <code>bar</code> çš„ <code>hello</code> è®Šé‡ï¼Œæœƒç™¼ç¾ä¸€å€‹æ˜¯ <strong>world</strong> ä¸€å€‹æ˜¯ <strong>è›‹èŠ±æ¹¯</strong>ã€‚é¡¯è€Œæ˜“è¦‹ï¼Œæˆ‘å€‘çš„ç¬¬ä¸€å€‹ <code>bar1</code> åœ¨è²æ˜çš„æ™‚å€™ï¼Œè¢« <strong>Node.js</strong> è‡ªå‹•çœ‹æˆäº†ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar1 = <span class="keyword">new</span> foo(<span class="literal">undefined</span>);</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥å°±æœ‰äº†å®ƒæ˜¯ <strong>world</strong> ä¸€èªªã€‚</p>
<p>é‚„æœ‰å°±æ˜¯åœ¨é€™å€‹æ§‹é€ å‡½æ•¸ä¸­ï¼Œæˆ‘å€‘çœ‹åˆ°äº†å‚³é€²å»çš„åƒæ•¸æ˜¯ <code>hello</code> è€Œé€™å€‹é¡ä¸­æœ¬ä¾†å°±æœ‰å€‹æˆå“¡è®Šé‡å°±æ˜¯ <code>this.hello</code>ã€‚ä¸éæˆ‘å€‘ä¹‹å‰èªªéäº†æœ‰ <code>this</code> å’Œæ²’ <code>this</code> çš„æ™‚å€™ä½œç”¨åŸŸä¸åŒï¼Œé‚£å€‹åƒæ•¸åªæ˜¯ä½œç”¨æ–¼æ§‹é€ å‡½æ•¸ä¸­ï¼Œè€ŒåŠ äº† <code>this</code> çš„é‚£å€‹å‰‡æ˜¯æˆå“¡è®Šé‡ã€‚ç”¨ä¸€å€‹ <code>this</code> å°±é¦¬ä¸Šå€åˆ†é–‹ä¾†ä»–å€‘äº†ï¼Œæ‰€ä»¥å³ä½¿åŒåä¹Ÿæ²’é—œä¿‚ã€‚</p>
<h4 id="æˆå“¡å‡½æ•¸">æˆå“¡å‡½æ•¸</h4><h5 id="æˆå“¡å‡½æ•¸è²æ˜">æˆå“¡å‡½æ•¸è²æ˜</h5><p>æˆå“¡å‡½æ•¸çš„è²æ˜è·Ÿæˆå“¡è®Šé‡çš„ç¬¬äºŒç¨®è²æ˜æ–¹æ³•å·®ä¸å¤šï¼Œå³ <code>&lt;é¡å&gt;.prototype.&lt;å‡½æ•¸å&gt; = &lt;å‡½æ•¸&gt;;</code></p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸Šæ¥ä»£ç¢¼2.1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setHello</span><span class="params">(hello)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hello = hello;</span><br><span class="line">&#125;</span><br><span class="line">foo.prototype.setHello = setHello;</span><br><span class="line"></span><br><span class="line">bar1.setHello(<span class="string">"é›è›‹é¤…"</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢é€™æ®µä»£ç¢¼é¡¯è€Œæ˜“è¦‹ï¼Œæˆ‘å€‘å¯¦ç¾äº† <code>foo</code> é¡çš„ <code>setHello</code> å‡½æ•¸ï¼Œèƒ½é€šéå®ƒä¿®æ”¹ <code>foo.hello</code> çš„å€¼ã€‚</p>
<p>ä½†æ˜¯é€™éº¼å¯«æ˜¯ä¸æ˜¯æœ‰é»éº»ç…©ï¼Ÿæ¥ä¸‹å»æˆ‘è¦è¬›ä¸€å€‹ <strong>JavaScript</strong> å‡½æ•¸é‡è¦çš„ç‰¹æ€§äº†ã€‚</p>
<h4 id="â˜…_åŒ¿åå‡½æ•¸">â˜… åŒ¿åå‡½æ•¸</h4><p>å¾ˆå¤šæ™‚å€™æˆ‘å€‘çš„æŸäº›å‡½æ•¸åªåœ¨ä¸€å€‹åœ°æ–¹è¢«å¼•ç”¨æˆ–è€…èª¿ç”¨ï¼Œé‚£éº¼æˆ‘å€‘çˆ²é€™å€‹å‡½æ•¸èµ·ä¸€å€‹åå­—å°±å¤ªä¸å€¼äº†ï¼Œæ²’å¿…è¦ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥è‡¨æ™‚å¯«å¥½é€™å€‹å‡½æ•¸ï¼Œç›´æ¥è®“å¼•ç”¨å®ƒçš„äººå¼•ç”¨å®ƒï¼Œèª¿ç”¨å®ƒçš„äººèª¿ç”¨å®ƒã€‚æ‰€ä»¥å‡½æ•¸å¯ä»¥çœç•¥å‡½æ•¸åï¼Œå¦‚ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span><span class="params">(hello)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hello = hello;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡³æ–¼æ€éº¼å¼•ç”¨æˆ–è€…èª¿ç”¨å‘¢ï¼Ÿå¦‚æœæ˜¯ä¸Šé¢çš„é‚£å€‹é¡éœ€è¦å¼•ç”¨çš„è©±ï¼Œå°±æ˜¯å¯«æˆé€™æ¨£çš„ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foo.prototype.setHello = <span class="function"><span class="keyword">function</span><span class="params">(hello)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hello = hello;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€™æ¨£çš„å¯«æ³•è·Ÿ <strong><a href="#æˆå“¡å‡½æ•¸è²æ˜">2.3.3.1. æˆå“¡å‡½æ•¸è²æ˜</a></strong> æ˜¯ä¸€å€‹æ•ˆæœçš„ï¼Œè€Œä¸”çœäº†å¾ˆå¤šçš„ä»£ç¢¼é‡ã€‚è€Œä¸”å¯¦éš›ä¸Šï¼ŒåŸºæœ¬ä¸Šçš„é¡æˆå“¡å‡½æ•¸çš„è²æ˜éƒ½æ˜¯æ¡ç”¨é€™ç¨®åŒ¿åå‡½æ•¸çš„æ–¹å¼ä¾†è²æ˜çš„ã€‚</p>
<p>è‡³æ–¼èªªæ€éº¼æ¨£è®“åŒ¿åå‡½æ•¸è¢«èª¿ç”¨å‘¢ï¼Ÿé€™é€šå¸¸ç”¨æ–¼å‚³å…¥ä¸€å€‹åªè¢«æŸå€‹å‡½æ•¸èª¿ç”¨çš„å‡½æ•¸æ™‚é€™æ¨£å¯«ã€‚</p>
<p>æ¯”å¦‚æˆ‘å€‘æœ‰ä¸€å€‹å‡½æ•¸çš„åŸå‹æ˜¯ï¼š</p>
<figure class="highlight swift"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * æˆ‘å€‘å°‡å‚³å…¥aï¼Œbå…©å€‹è®Šé‡ï¼Œ</span><br><span class="line"> * åœ¨ç®—å‡ºa+bçš„å€¼å¾Œï¼Œäº¤ç”±func(num)</span><br><span class="line"> * å»é€²è¡Œè¼¸å‡º</span><br><span class="line"> */</span></span><br><span class="line">function sumab(a, b, <span class="func"><span class="keyword">func</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">c</span> = a + b;</span><br><span class="line">    <span class="func"><span class="keyword">func</span><span class="params">(a, b, <span class="built_in">c</span>)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚æˆ‘å€‘æœ‰å…©å€‹ç‰ˆæœ¬çš„è¼¸å‡ºå‡½æ•¸ï¼Œä¸€å€‹æ˜¯ä¸­æ–‡è¼¸å‡ºï¼Œä¸€å€‹æ˜¯è‹±æ–‡è¼¸å‡ºï¼Œé‚£éº¼å¦‚æœä¸ç”¨åŒ¿åå‡½æ•¸æ™‚å€™æ˜¯é€™éº¼å¯«çš„ï¼š</p>
<figure class="highlight cpp"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">zh</span><span class="params">(a, b, sum)</span> </span>&#123;</span><br><span class="line">    console.<span class="built_in">log</span>(a + <span class="string">" + "</span> + b + <span class="string">" çš„å€¼æ˜¯ï¼š"</span> + sum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">function <span class="title">en</span><span class="params">(a, b, sum)</span> </span>&#123;</span><br><span class="line">    console.<span class="built_in">log</span>(a + <span class="string">" plus "</span> + b + <span class="string">" is "</span> + sum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sumab(<span class="number">1</span>, <span class="number">2</span>, zh);</span><br><span class="line">sumab(<span class="number">3</span>, <span class="number">4</span>, en);</span><br></pre></td></tr></table></figure>
<p>åŸ·è¡Œä¸€éé€™æ®µä»£ç¢¼ï¼Œè¼¸å‡ºçš„çµæœå°‡æœƒæ˜¯ï¼š</p>
<figure class="highlight cpp"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="number">2</span> çš„å€¼æ˜¯ï¼š<span class="number">3</span></span><br><span class="line"><span class="number">3</span> plus <span class="number">4</span> is <span class="number">7</span></span><br></pre></td></tr></table></figure>
<p>é€™æ¨£çš„ä»£ç¢¼å¦‚æœæ¡ç”¨åŒ¿åå‡½æ•¸çš„å½¢å¼å‰‡å°‡æœƒæ˜¯ï¼š</p>
<figure class="highlight lisp"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sumab<span class="list">(<span class="number">1</span>, <span class="number">2</span>, function<span class="list">(<span class="keyword">a</span>, b, sum)</span> &#123;</span><br><span class="line">    console.log<span class="list">(<span class="keyword">a</span> + <span class="string">" + "</span> + b + <span class="string">" çš„å€¼æ˜¯ï¼š"</span> + sum)</span><span class="comment">;</span></span><br><span class="line">&#125;)</span><span class="comment">;</span></span><br><span class="line">sumab<span class="list">(<span class="number">3</span>, <span class="number">4</span>, function<span class="list">(<span class="keyword">a</span>, b, sum)</span> &#123;</span><br><span class="line">    console.log<span class="list">(<span class="keyword">a</span> + <span class="string">" plus "</span> + b + <span class="string">" is "</span> + sum)</span><span class="comment">;</span></span><br><span class="line">&#125;)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>é€™ç¨®å½¢å¼é€šå¸¸ä½¿ç”¨æ–¼å›èª¿å‡½æ•¸ã€‚å›èª¿æ©Ÿåˆ¶ç®—æ˜¯ <strong>Node.js</strong> æˆ–è€…èªª <strong>JavaScript</strong> çš„ç²¾é«“ã€‚åœ¨ä»¥å¾Œçš„ç¯‡ç« æœƒåšä»‹ç´¹ã€‚</p>
<h4 id="æˆå“¡å‡½æ•¸è²æ˜çš„åŒ¿åå‡½æ•¸è²æ˜æ–¹å¼">æˆå“¡å‡½æ•¸è²æ˜çš„åŒ¿åå‡½æ•¸è²æ˜æ–¹å¼</h4><p>é›–ç„¶ä¸Šä¸€ç¯€è¬›éäº†ï¼Œä¸éé‚„æ˜¯å†è¬›ä¸€éå§ã€‚</p>
<p>é€šå¸¸æˆ‘å€‘è²æ˜é¡çš„æˆå“¡å‡½æ•¸æ™‚å€™éƒ½æ˜¯ç”¨åŒ¿åå‡½æ•¸ä¾†è²æ˜çš„ï¼Œå› çˆ²åæ­£é‚£å€‹å‡½æ•¸ä¹Ÿå°±æ˜¯é€™å€‹é¡çš„ä¸€å€‹æˆå“¡å‡½æ•¸è€Œå·²ï¼Œä¸æœƒåœ¨å…¶å®ƒåœ°æ–¹è¢«å–®ç¨å¼•ç”¨æˆ–è€…èª¿ç”¨ï¼Œæ‰€ä»¥å°±æœ‰äº†ä¸‹é¢çš„ä»£ç¢¼ï¼š</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸Šæ¥ä»£ç¢¼2.1</span></span><br><span class="line">foo.prototype.setHello = <span class="function"><span class="keyword">function</span><span class="params">(hello)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hello = hello;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€™æ¨£æˆ‘å€‘å°±ä½¿å¾— <code>foo</code> é¡æœ‰äº† <code>setHello</code> é€™å€‹å‡½æ•¸äº†ã€‚</p>
<h4 id="é¡çš„éš¨æ„æ€§">é¡çš„éš¨æ„æ€§</h4><p>é€™å€‹åˆæ˜¯æˆ‘èƒ¡æ‰¯çš„ã€‚æ‰€è¬‚é¡çš„éš¨æ„æ€§å³ <strong>JavaScript</strong> ä¸­ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä¿®æ”¹ä½ çš„é¡ï¼Œé€™è·Ÿ <strong>Ruby</strong> æœ‰ç€ä¸€å®šçš„ç›¸ä¼¼ä¹‹è™•ã€‚</p>
<p>æ¯”å¦‚èªª <code>string</code> ï¼Œå®ƒå…¶å¯¦ä¹Ÿæ˜¯ä¸€å€‹é¡ï¼Œæœ‰ç€è«¸å¦‚ <code>length</code> é€™æ¨£çš„æˆå“¡è®Šé‡ï¼Œä¹Ÿæœ‰ <code>indexOf</code>ã€<code>substr</code> ç­‰æˆå“¡å‡½æ•¸ã€‚ä½†æ˜¯è¬ä¸€æˆ‘å€‘è¦ºå¾—é€™å€‹ <code>string</code> æœ‰äº›åœ°æ–¹ä¸å®Œå–„ï¼Œæƒ³åŠ è‡ªå·±çš„æ–¹æ³•ï¼Œé‚£éº¼å¯ä»¥åœ¨ä½ æƒ³è¦çš„åœ°æ–¹çµ¦å®ƒå¢åŠ ä¸€å€‹å‡½æ•¸ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.sb = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newstr = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i % <span class="number">2</span> === <span class="number">0</span>) newstr += <span class="string">"s"</span>;</span><br><span class="line">        <span class="keyword">else</span> newstr += <span class="string">"b"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newstr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€™å€‹å‡½æ•¸çš„æ„æ€å°±æ˜¯å¡«å……ä¸€å€‹å­—ç¬¦ä¸²ï¼Œä½¿å…¶è®Šæˆ <code>sb</code> çš„åŒ–èº«ã€‚</p>
<p>æˆ‘å€‘ä¾†æ¸¬è©¦ä¸€ä¸‹ï¼š</p>
<figure class="highlight openscad"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">str</span> = <span class="string">"å™“~è›‹èŠ±æ¹¯åœ¨ç¡è¦ºã€‚"</span>;</span><br><span class="line">console.<span class="built_in">log</span>(<span class="built_in">str</span>.sb());</span><br></pre></td></tr></table></figure>
<p>ä½ å°‡æœƒå¾—åˆ°é€™æ¨£çš„çµæœï¼š</p>
<figure class="highlight"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbsbsbsbs</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½ è·Ÿä½ çš„é›»è…¦èªªâ€œå™“~è›‹èŠ±æ¹¯åœ¨ç¡è¦ºã€‚â€ï¼Œä½ çš„é›»è…¦æœƒç½µä½ å››æ¬¡åŠå‚»é€¼ã€‚ï¼ˆè¶•å¿«ç ¸äº†å®ƒï¼‰</p>
</blockquote>
<h2 id="é™„">é™„</h2><h3 id="æ·±æ‹·è²">æ·±æ‹·è²</h3><p>æ‰€è¬‚æ·±æ‹·è²å°±æ˜¯è‡ªå·±æ–°å»ºä¸€å€‹æ•¸çµ„æˆ–è€…å°è±¡ï¼ŒæŠŠæºæ•¸çµ„æˆ–è€…å°è±¡ä¸­çš„åŸºç¤é¡å‹è®Šé‡å€¼ä¸€å€‹å€‹æ‰‹å‹•æ‹·éå»ï¼Œè€Œä¸æ˜¯éš»æŠŠæºæ•¸çµ„æˆ–è€…å°è±¡çš„å¼•ç”¨æ‹¿éä¾†ã€‚æ‰€ä»¥é€™å°±æ¶‰åŠåˆ°äº†ä¸€å€‹éæ­¸çš„èª¿ç”¨ä»€éº¼çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘å¯¦ç¾çš„ä¸€å€‹æ·±æ‹·è²å‡½æ•¸ï¼Œå¤§å®¶å¯ä»¥å¯«ä¸€å€‹è‡ªå·±çš„ç„¶å¾ŒåŠ å…¥åˆ°è‡ªå·±çš„ <strong>Node.js</strong> çŸ¥è­˜åº«ä¸­ã€‚</p>
<figure class="highlight actionscript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneObject</span><span class="params">(src)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dest = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> src) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> src === <span class="string">"object"</span>) dest[key] = cloneObject(src[key]);</span><br><span class="line">        <span class="keyword">else</span> dest[key] = src[key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç³»çµ±é»˜èªå°è±¡åƒè€ƒæ‰‹å†Š">ç³»çµ±é»˜èªå°è±¡åƒè€ƒæ‰‹å†Š</h3><ul>
<li><strong>å­—ç¬¦ä¸²</strong>ï¼š<a href="http://www.w3school.com.cn/js/jsref_obj_string.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_string.asp</a></li>
<li><strong>æ•¸å­—</strong>: <a href="http://www.w3school.com.cn/js/jsref_obj_number.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_number.asp</a></li>
<li><strong>æ•¸çµ„</strong>: <a href="http://www.w3school.com.cn/js/jsref_obj_array.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_array.asp</a></li>
<li><strong>å¸ƒçˆ¾</strong>: <a href="http://www.w3school.com.cn/js/jsref_obj_boolean.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_boolean.asp</a></li>
<li><strong>æ—¥æœŸ</strong>: <a href="http://www.w3school.com.cn/js/jsref_obj_date.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_date.asp</a></li>
<li><strong>æ•¸å­¸åº«</strong>ï¼š<a href="http://www.w3school.com.cn/js/jsref_obj_math.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_math.asp</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p><strong>Node.js</strong> çš„åŸºç¤æ˜¯ <strong>JavaScript</strong> é€™é–€ <strong><em>è…³æœ¬èªè¨€</em></strong>ã€‚è€Œå¤§å¤šæ•¸çš„è…³æœ¬èªè¨€ä¸€å€‹å…±åŒçš„ç‰¹é»å°±æ˜¯â€œ<a href="http://zh.wikiped]]>
    </summary>
    
      <category term="JavaScript" scheme="http://xcoder.in/tags/JavaScript/"/>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="ä¸€èµ·æ“¼Node.JS" scheme="http://xcoder.in/tags/%E4%B8%80%E8%B5%B7%E6%93%BCNode-JS/"/>
    
      <category term="NodeJS" scheme="http://xcoder.in/categories/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ä¸€èµ·æ“¼Node.JSï¼ˆè² è²³ï¼‰â€”â€”ç’°å¢ƒ]]></title>
    <link href="http://xcoder.in/2013/08/15/node-2-environment-in-windows/"/>
    <id>http://xcoder.in/2013/08/15/node-2-environment-in-windows/</id>
    <published>2013-08-14T16:00:00.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€ç”±æ–¼<a href="!--ï¿¼11--&gt;#linux-ç’°å¢ƒ">Linux</a>ä¸­çš„ç’°å¢ƒæ­å»ºæ¯”è¼ƒç°¡å–®ï¼Œæ‰€ä»¥è‰è‰ç•¥éã€‚</p>
<p>ã€€ã€€å…¶å¯¦<a href="!--ï¿¼12--&gt;#windows-ç’°å¢ƒ">Windows</a>ä¸‹ä¹Ÿä¸ç®—éº»ç…©ï¼Œä½†æ˜¯é€™è£æœƒè¬›ä¸€å®šé‡çš„åˆ¥çš„ç’°å¢ƒçš„æ­å»ºã€‚</p>
<!-- æˆ‘æ˜¯å°å°åˆ†å‰²ç¬¦ -->
<h2 id="Linux_ç’°å¢ƒ">Linux ç’°å¢ƒ</h2><p>è¬›åˆ°é€™å€‹å°±å¾ˆç°¡å–®äº†ï¼Œè·Ÿç€ä¸‹é¢çš„ <strong>bash</strong> æ“ä½œå³å¯ï¼š</p>
<figure class="highlight crmsh"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/local/bin</span><br><span class="line">$ wget http://nodejs.org/dist/v0.<span class="number">00.00</span>/<span class="keyword">node</span><span class="identifier"></span><span class="title">-v0</span>.<span class="number">00.00</span>-linux-x00.tar.gz</span><br><span class="line">$ tar zxf <span class="keyword">node</span><span class="identifier"></span><span class="title">-v0</span>.<span class="number">00.00</span>-linux-x00.tar.gz</span><br><span class="line">$ cd <span class="keyword">node</span><span class="identifier"></span><span class="title">-v0</span>.<span class="number">00.00</span>-linux-x00</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…¶ä¸­å°‡ä¸Šæ–¹çš„ <strong>v0.00.00</strong> æ›¿æ›æˆ <strong>Node.js</strong> æœ€æ–°çš„ç‰ˆæœ¬è™Ÿï¼ŒæŠŠ <strong>x00</strong> æ›¿æ›æˆä½ è‡ªå·±é›»è…¦çš„ä½æ•¸ã€‚</p>
<p>ä¹Ÿå¯ä»¥ç›´æ¥å»å®˜ç¶² <a href="http://nodejs.org/download/" target="_blank" rel="external">http://nodejs.org/download/</a> æ‰¾åˆ°ç›¸æ‡‰çš„åœ°å€ã€‚</p>
</blockquote>
<p>æœ€å¾Œå°‡å…¶çš„é€£æ¥åŠ å…¥åˆ° <code>/usr/bin</code> ä¸‹å³å¯ã€‚</p>
<figure class="highlight crmsh"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd bin</span><br><span class="line">$ ln <span class="keyword">node</span><span class="identifier"> </span><span class="title">/usr</span>/bin</span><br><span class="line">$ ln npm /usr/bin</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š è©²ç”¨ <code>sudo</code> çš„åœ°æ–¹å°±ç”¨ <code>sudo</code> æˆ–è€… <code>su</code> ã€‚</p>
</blockquote>
<p>è‡³æ­¤ï¼Œ<strong>Linux</strong> ä¸‹çš„ <strong>Node.js</strong> ç’°å¢ƒåŸºæœ¬æ­å»ºå®Œç•¢ã€‚</p>
<h2 id="Windows_ç’°å¢ƒ">Windows ç’°å¢ƒ</h2><h3 id="Cygwin_å®‰è£å’Œé…ç½®">Cygwin å®‰è£å’Œé…ç½®</h3><p><strong><em>Cygwin</em></strong> æ˜¯ä¸€å€‹åœ¨ <strong><em>Windows</em></strong> å¹³è‡ºä¸Šé‹è¡Œçš„ <strong><em>Unix</em></strong> æ¨¡æ“¬ç’°å¢ƒã€‚å°æ–¼å­¸ç¿’ <strong><em>Unix/Linux</em></strong> æ“ä½œç’°å¢ƒï¼Œæˆ–è€…å¾ <strong><em>Unix</em></strong> åˆ° <strong><em>Windows</em></strong> çš„æ‡‰ç”¨ç¨‹åºç§»æ¤ï¼Œæˆ–è€…é€²è¡ŒæŸäº›ç‰¹æ®Šçš„é–‹ç™¼å·¥ä½œï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ <strong><em>GNUå·¥å…·é›†</em></strong> åœ¨ <strong><em>Windows</em></strong> ä¸Šé€²è¡ŒåµŒå…¥å¼ç³»çµ±é–‹ç™¼ï¼Œéå¸¸æœ‰ç”¨ã€‚</p>
<h4 id="Cygwin_å®‰è£">Cygwin å®‰è£</h4><p>æˆ‘å€‘å…ˆè·‘åˆ° <strong>Cygwin</strong> çš„å®˜ç¶²ä¸Šå»æŠŠæ±è¥¿ä¸‹ä¾†ï¼š</p>
<blockquote>
<p><a href="http://cygwin.com/install.html" target="_blank" rel="external">http://cygwin.com/install.html</a></p>
<blockquote>
<p>æ³¨æ„ï¼Œæœ€å¥½ä¸‹ <strong>x86</strong> çš„åŒ…ï¼Œå› çˆ²æˆ‘å€‘ä¹‹å¾Œè¦è¬›ä¸€å€‹ <code>cyg-apt</code> çš„è…³æœ¬æ’ä»¶ï¼Œé€™æ˜¯ä¸€å€‹èƒ½è®“ <strong>Cygwin</strong> èƒ½è·Ÿ <strong>Linux</strong> ä¸€æ¨£é€šéè…³æœ¬å¾æºå®‰è£è»Ÿä»¶åŒ…çš„è…³æœ¬ã€‚çˆ²äº†æ–¹ä¾¿ä¿®æ”¹ï¼Œæˆ‘å€‘å°‡å…¶ä¸‹æˆ <strong>x86</strong> çš„ç‰ˆæœ¬ã€‚</p>
</blockquote>
</blockquote>
<p>ç„¶å¾Œå°±æ˜¯å®‰è£æ­¥é©Ÿäº†ã€‚</p>
<center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-1.png" alt="å¾ç¶²çµ¡å®‰è£"></center><br><center><small>[åœ–2.1]</small></center>

<p>åˆ° <strong>[åœ–2.1]</strong> é€™å€‹æ­¥é©Ÿçš„æ™‚å€™ï¼Œé¸æ“‡é»˜èªçš„ <code>Install from Internet</code> å³å¯ã€‚</p>
<center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-2.png" alt="é¸æ“‡å®‰è£è·¯å¾‘"></center><br><center><small>[åœ–2.2]</small></center>

<p>åœ¨ <strong>[åœ–2.2]</strong> çš„æ™‚å€™é¸ä¸€å€‹å®‰è£è·¯å¾‘ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå„˜å¯èƒ½è®“é€™å€‹å®‰è£è·¯å¾‘ç°¡å–®ï¼Œè€Œä¸è¦æ˜¯é¡ä¼¼æ–¼</p>
<p><code>c:\Program Files\blahblah</code></p>
<p>é€™æ¨£çš„æ–‡ä»¶è·¯å¾‘ã€‚</p>
</blockquote>
<center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-3.png" alt="æœ¬åœ°åŒ…è·¯å¾‘"></center><br><center><small>[åœ–2.3]</small></center>

<p><strong>[åœ–2.3]</strong> çš„æ™‚å€™é¸ä¸€å€‹æœ¬åœ°åŒ…çš„è·¯å¾‘ï¼Œæˆ‘é€™è£é¸çš„æ˜¯ <code>e:\cygwin\tmp</code>ã€‚</p>
<center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-4.png" alt="ç›´é€£"></center><br><center><small>[åœ–2.4]</small></center>

<p><strong>[åœ–2.4]</strong> é¸æ“‡ç›´æ¥é€£æ¥ã€‚</p>
<center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-5.png" alt="163"></center><br><center><small>[åœ–2.5]</small></center>

<p>æˆ‘å€‘åœ‹å…§çš„ç”¨æˆ¶æºé‚„æ˜¯é¸æ“‡ <code>163</code> çš„é€Ÿåº¦æ¯”è¼ƒå¿«ã€‚æ‰€ä»¥åœ¨ <strong>[åœ–2.5]</strong> é€™ä¸€æ­¥çš„æ™‚å€™å°±ç›´æ¥é¸ç”¨é»˜èªçš„ <code>163</code> çš„æºäº†ã€‚å¦‚æœä¸æ˜¯é»˜èªçš„è©±ï¼Œè«‹é¸ä¸­å®ƒã€‚</p>
<p>åœ¨ <strong>Select Package</strong> ä¹Ÿå°±æ˜¯é¸æ“‡é å®‰è£çš„è»Ÿä»¶çš„æ™‚å€™ï¼ŒæŠŠä¸‹åˆ—è¡¨ä¸­çš„è»Ÿä»¶åŒ…å‹¾é¸èµ·ä¾†ï¼š</p>
<blockquote>
<ul>
<li><strong>wget</strong>: åœ¨ <strong>Utils</strong> ä¸­</li>
<li><strong>vim</strong>: åœ¨ <strong>Editors</strong> ä¸­</li>
<li><strong>gcc</strong>: åœ¨ <strong>Devel</strong> ä¸­</li>
<li><strong>gcc-g++</strong>: åœ¨ <strong>Devel</strong> ä¸­</li>
<li><strong>make</strong>: åœ¨ <strong>Devel</strong> ä¸­</li>
<li><strong>cmake</strong>: åœ¨ <strong>Devel</strong> ä¸­</li>
</ul>
</blockquote>
<p>è‹¥æ˜¯é€™äº›é¸é …å·²ç¶“è¢«é¸èµ·ä¾†äº†å°±ä¸ç”¨å†é¸äº†ï¼Œå¦‚æœæ²’æœ‰é¸èµ·ä¾†å‰‡æŠŠå®ƒé¸ä¸­ã€‚</p>
<p>å‹¾é¸å¥½äº†ä¹‹å¾Œå°±å¯ä»¥ä¸‹ä¸€æ­¥å®‰è£äº†ï¼Œç›´è‡³å®‰è£å®Œç•¢ï¼Œä½ å°±å¯ä»¥æ‰“é–‹ä½ çš„ <strong>Cygwin</strong> äº†ã€‚</p>
<center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-6.png" alt="Cygwin"></center><br><center><small>[åœ–2.6]</small></center>

<blockquote>
<p><strong>æç¤º</strong>ï¼šä½ å¯ä»¥é»æ“Šçª—å£å·¦ä¸Šè§’çš„å°åœ–ç‰‡ï¼Œç„¶å¾Œè£é¢çš„ <strong>Options</strong> ä¸­ï¼Œä½ å¯ä»¥èª¿æ•´ä½ è‡ªå·±çš„ <strong>Cygwin</strong> å¤–è§€ã€‚</p>
</blockquote>
<h3 id="vim_é…ç½®">vim é…ç½®</h3><p>ä¸Šä¸€æ­¥æˆ‘å€‘å·²ç¶“é¸ä¸­äº† <strong>vim</strong> ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘å·²ç¶“åœ¨ <strong>Cygwin</strong> ä¸­è£ä¸Šäº† <strong>vim</strong>ã€‚ä½†æ˜¯ç”±æ–¼é€™è£çš„ <strong>vim</strong> é»˜èªé…ç½®éå¸¸è›‹ç–¼ï¼Œæ‰€ä»¥æˆ‘å€‘å¾—æ”¹ä¸€ä¸‹ã€‚</p>
<p>åœ¨ä½ çš„ <strong>Cygwin</strong> ä¸­ä¸€å¥å¥è¼¸å…¥ä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<figure class="highlight crystal"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>cd /home/&lt;ä½ è‡ªå·±çš„ç”¨æˆ¶å&gt;</span><br><span class="line"><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/blog-xcoder-in.qiniudn.com/</span>.vimrc</span><br><span class="line"><span class="variable">$ </span>mkdir .vim</span><br><span class="line"><span class="variable">$ </span>cd .vim</span><br><span class="line"><span class="variable">$ </span>mkdir colors</span><br><span class="line"><span class="variable">$ </span>cd colors</span><br><span class="line"><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/blog-xcoder-in.qiniudn.com/molokai</span>.vim</span><br></pre></td></tr></table></figure>
<p>é€™æ¨£ä½ çš„ <strong>vim</strong> å°±ç”¨ä¸Šäº†ä¸Šé¢çš„é‚£å€‹åœ°å€çš„é…ç½®æ–‡ä»¶ï¼Œç•¶ç„¶ä½ ä¹Ÿå¯ä»¥ç·¨è¼¯ä½ è‡ªå·±çš„é…ç½®æ–‡ä»¶æˆ–è€…èªªå¾ç¶²ä¸Šä¸‹åˆ¥çš„é…ç½®æ–‡ä»¶ä»¥æ»¿è¶³ä½ çš„å€‹æ€§åŒ–éœ€æ±‚ã€‚</p>
<p><strong>vim</strong> é…ç½®ä»¥åŠä½¿ç”¨è«‹åƒç…§ï¼š<a href="https://wiki.archlinux.org/index.php/Vim" target="_blank" rel="external">https://wiki.archlinux.org/index.php/Vim</a></p>
<blockquote>
<p>äº‹ç„¡é‰…ç´°å• <strong>ArchWiki</strong>ã€‚</p>
<div style="text-align: right;"><em>â€“ <a href="https://github.com/kalxd" target="_blank" rel="external">kalxd</a></em></div>

</blockquote>
<h3 id="apt-cyg">apt-cyg</h3><blockquote>
<p>apt-cyg is a command-line installer for Cygwin which cooperates with Cygwin Setup and uses the same repository. The syntax is similar to apt-get.</p>
<div style="text-align: right;"><em>â€“ From apt-cyg googlecode page</em></div>

</blockquote>
<p>ç¸½ä¹‹æ„æ€å°±æ˜¯èªª <code>apt-cyg</code> æ˜¯é¡ä¼¼æ–¼ <strong>Linux</strong> ä¸­çš„ <code>apt-get</code>ï¼Œ <code>yum</code>, <code>zypper</code> ç­‰å‘½ä»¤è¡Œè»Ÿä»¶åŒ…å®‰è£å™¨ä¸€æ¨£ï¼Œå¯ä»¥é€šé</p>
<ul>
<li><code>apt-cyg install &lt;package names&gt;</code> ä¾†å®‰è£è»Ÿä»¶åŒ…</li>
<li><code>apt-cyg remove &lt;package names&gt;</code> ä¾†ç§»é™¤è»Ÿä»¶åŒ…</li>
<li><code>apt-cyg update</code> ä¾†æ›´æ–° setup.ini</li>
<li><code>apt-cyg show</code> ä¾†åˆ—å‡ºå·²å®‰è£çš„è»Ÿä»¶åŒ…</li>
<li><code>apt-cyg find &lt;pattern(s)&gt;</code> ä¾†æŸ¥æ‰¾ç¬¦åˆæ¢ä»¶çš„è»Ÿä»¶åŒ…</li>
<li><code>apt-cyg describe &lt;pattern(s)&gt;</code> ä¾†æè¿°ç¬¦åˆæ¢ä»¶çš„è»Ÿä»¶åŒ…</li>
<li><code>apt-cyg packageof &lt;commands or files&gt;</code> ä¾†å®šä½å…¶çˆ¶è»Ÿä»¶åŒ…</li>
</ul>
<h4 id="apt-cyg_å®‰è£">apt-cyg å®‰è£</h4><p>å…¶å¯¦ä¹Ÿä¸èƒ½èªªæ˜¯å®‰è£ï¼Œç´”ç²¹æ˜¯æŠŠè…³æœ¬å¾ç¶²çµ¡ä¸Šæ‹·åˆ°è‡ªå·±çš„ <strong>Cygwin</strong> çš„ç’°å¢ƒç›®éŒ„ä¸­ã€‚</p>
<p>åœ¨ä½ çš„ <strong>Cygwin</strong> ä¸­è¼¸å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight crystal"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>cd /usr/local/bin</span><br><span class="line"><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/apt-cyg.googlecode.com/svn</span><span class="regexp">/trunk/apt</span>-cyg</span><br></pre></td></tr></table></figure>
<p>é€™æ¨£ä½ å°±â€œå®‰è£â€å¥½äº† <strong>apt-cyg</strong> äº†ã€‚ä¸éé€™è£ç”¨çš„æ˜¯é»˜èªçš„æºï¼Œæ‰€æœ‰æ±è¥¿éƒ½æ˜¯é»˜èªçš„ã€‚</p>
<p>å¦‚æœä½ ç¾åœ¨å·²ç¶“å¿ƒå®‰ç†å¾—æˆ–è€…ä¸æƒ³æŠ˜é¨°äº†å¯ä»¥è·³é <strong><a href="#apt-cyg-ä¿®æ”¹">2.1.3.2. apt-cyg ä¿®æ”¹</a></strong>ï¼Œå¦‚æœä½ æƒ³æŠŠæºæ›æˆ <code>163</code> çš„è©±é‚£éº¼ç¨å¾®çœ‹ä¸€ä¸‹å§ã€‚</p>
<h4 id="apt-cyg_ä¿®æ”¹">apt-cyg ä¿®æ”¹</h4><p>æ¥ä¸‹å»æˆ‘å€‘è¦å° <strong>apt-cyg</strong> åšä¸€äº›ç·¨è¼¯ã€‚</p>
<p>ä½ æœ‰ä¸‹é¢å…©å€‹é¸æ“‡ï¼š</p>
<ol>
<li>å¦‚æœä½ æƒ³å­¸ç¿’ <strong>vim</strong> æ“ä½œæˆ–è€…ä½ å·²ç¶“ç†Ÿæ‚‰äº†ï¼Œé‚£éº¼ç›´æ¥ä½¿ç”¨ <code>vim apt-cyg</code> ä¾†é€²è¡Œç·¨è¼¯ã€‚</li>
<li>å¦‚æœä½ æ˜¯æ‡¶äººé‚„æ˜¯æƒ³è¦ç›´æ¥ç·¨è¼¯çš„è©±ï¼Œè«‹è·‘åˆ°ä½ çš„ <strong>Cygwin</strong> çš„å®‰è£ç›®éŒ„ï¼Œæ‰¾åˆ° <strong>usr</strong> æ–‡ä»¶å¤¾ï¼Œé£›é€² <strong>local/bin</strong> ç›®éŒ„ä¸­å»ï¼Œç”¨ä½ è‡ªå·±å–œæ­¡çš„æ–‡æœ¬ç·¨è¼¯å™¨æ‰“é–‹ä¸¦ç·¨è¼¯ã€‚</li>
</ol>
<p>å¤§ç´„æ˜¯ <code>68</code> è¡Œä¸Šä¸‹å§ï¼Œæœ‰ä¸€å¥æ˜¯ï¼š</p>
<figure class="highlight groovy"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mirror=<span class="string">ftp:</span><span class="comment">//mirror.mcs.anl.gov/pub/cygwin</span></span><br></pre></td></tr></table></figure>
<p>å°‡å…¶æ”¹æˆï¼š</p>
<figure class="highlight groovy"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mirror=<span class="string">http:</span><span class="comment">//mirrors.163.com/cygwin</span></span><br></pre></td></tr></table></figure>
<p>é‚„æœ‰å°±æ˜¯å¤§æ¦‚åœ¨ <code>98</code> è¡Œå’Œ <code>105</code> è¡Œå·¦å³ï¼š</p>
<figure class="highlight xquery"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -N <span class="variable">$mirror</span>/setup.bz2</span><br><span class="line">...</span><br><span class="line">wget -N <span class="variable">$mirror</span>/setup.ini</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹æˆï¼š</p>
<figure class="highlight xquery"><figcaption><span>bash</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -N <span class="variable">$mirror</span>/x86/setup.bz2</span><br><span class="line">...</span><br><span class="line">wget -N <span class="variable">$mirror</span>/x86/setup.ini</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œä½ çš„ <strong>Cygwin</strong> ç’°å¢ƒåŸºæœ¬å®Œæˆï¼Œä»¥å¾Œå¯ä»¥å†æ…¢æ…¢å®Œå–„ã€‚</p>
<h3 id="Node-js_å®‰è£">Node.js å®‰è£</h3><p>é€™å€‹å°±å¾ˆç°¡å–®äº†ï¼Œæ‰“é–‹ <strong><a href="http://nodejs.org/download/" target="_blank" rel="external">Node.js</a></strong> å®˜ç¶²ä¸‹è¼‰å®‰è£å³å¯ã€‚</p>
<blockquote>
<p>é¸æ“‡ <strong>Windows Installer (.msi)</strong> æˆ–è€… <strong>Windows Binary (.exe)</strong>ã€‚</p>
</blockquote>
<p>å®‰è£å¥½å¾Œå°±èƒ½ç›´æ¥åœ¨ <strong>Cygwin</strong> è£é¢ä½¿ç”¨äº†ã€‚</p>
<h2 id="çœŸÂ·Hello_World">çœŸÂ·Hello World</h2><p>ç¾åœ¨ï¼Œç„¡è«–ä½ æ˜¯ <strong>Linux</strong> ç”¨æˆ¶é‚„æ˜¯ <strong>Windows</strong> ç”¨æˆ¶ï¼Œéƒ½å¯ä»¥ç”¨ä¸€æ¨£çš„æ­¥é©Ÿä¾†å®Œæˆä¸‹é¢çš„ <code>Hello World</code> äº†ã€‚</p>
<p>éš¨ä¾¿è·‘ä¸€å€‹ç›®éŒ„è£é¢æ–°å»ºä¸€å€‹æ–‡ä»¶ä¸¦ä¸”ç”¨ <strong>vim</strong> ç·¨è¼¯ï¼š</p>
<figure class="highlight crystal"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>vim hello.js</span><br></pre></td></tr></table></figure>
<p>åœ¨è£é¢è¼¸å…¥ä¸‹é¢çš„æ±è¥¿ï¼š</p>
<figure class="highlight applescript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="command">log</span>(<span class="string">"Hello world!"</span>);</span><br></pre></td></tr></table></figure>
<p>ç„¶å¾Œé€€å‡º <strong>vim</strong> åŸ·è¡Œï¼š</p>
<figure class="highlight crmsh"><figcaption><span>sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">hello</span>.js</span><br></pre></td></tr></table></figure>
<p>çµ‚æ–¼ï¼Œ<strong>çœŸÂ·Hello world</strong> å‡ºç¾åœ¨äº†ä½ çš„çœ¼å‰ï¼Œè€Œä¸éœ€è¦è—‰åŠ© <strong><a href="http://ideone.com/" target="_blank" rel="external">IDEOne</a></strong> äº†ã€‚</p>
<p><strong><em>To be continuedâ€¦</em></strong></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€ç”±æ–¼<a href="!--ï¿¼11--&gt;#linux-ç’°å¢ƒ">Linux</a>ä¸­çš„ç’°å¢ƒæ­å»ºæ¯”è¼ƒç°¡å–®ï¼Œæ‰€ä»¥è‰è‰ç•¥éã€‚</p>
<p>ã€€ã€€å…¶å¯¦<a href="!--ï¿¼12--&gt;#windows-ç’°å¢ƒ">Windows</a>ä¸‹ä¹Ÿä¸ç®—éº»ç…©ï¼Œä½†æ˜¯é€™è£æœƒè¬›ä¸€å®šé‡çš„]]>
    </summary>
    
      <category term="JavaScript" scheme="http://xcoder.in/tags/JavaScript/"/>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="ä¸€èµ·æ“¼Node.JS" scheme="http://xcoder.in/tags/%E4%B8%80%E8%B5%B7%E6%93%BCNode-JS/"/>
    
      <category term="NodeJS" scheme="http://xcoder.in/categories/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ä¸€èµ·æ“¼Node.JSï¼ˆè² å„ï¼‰â€”â€”æ¦‚è¿°]]></title>
    <link href="http://xcoder.in/2013/08/13/node-1-summary/"/>
    <id>http://xcoder.in/2013/08/13/node-1-summary/</id>
    <published>2013-08-12T16:00:00.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€æœ¬ç³»åˆ—æ•™ç¨‹ä¸»è¦æ˜¯å¯«çµ¦æˆ‘å¸¶çš„é‚£å¹«ç†Šå­©å­å€‘çœ‹çš„ã€‚æˆ‘è‡ªå·±çš„ <strong>Node.js</strong> æ°´å¹³åŠæ–¤å…«å…©ï¼Œæªè¾­ä¹‹ä¸­ä¹Ÿå…ä¸äº†æœ‰è‡ªå·±éŒ¯èª¤çš„ç†è§£ï¼Œæœƒèª¤äººå­å¼Ÿã€‚ä½†æ˜¯å°æ–¼åˆå­¸è€…ä¾†èªªï¼ŒæŸäº›è‡ªå·±åŠ©è¨˜çš„ç†è§£é‚„æ˜¯å¯å–çš„ã€‚æœ‰äº›æ¦‚å¿µæ€§çš„éŒ¯èª¤å¯ä»¥ç­‰ä»–å€‘é€²ä¸€æ­¥æ·±å…¥ç ”ç©¶ä¹‹å¾Œå†è‡ªè¡Œæ›´æ­£ã€‚</p>
<p>ã€€ã€€ç”±æ–¼é‚£å¹«äººå¤§å¤šé‚„è™•æ–¼ä½¿ç”¨ <strong>M$ Windows</strong> çš„ä»¤äººä¸æ„‰å¿«çš„éšæ®µï¼Œæ‰€ä»¥æœ¬æ•™ç¨‹å°‡æœƒé€€è€Œæ±‚å…¶æ¬¡ï¼Œä½¿å…¶åœ¨ <strong>Cygwin</strong> ä¸­æ¨¡æ“¬ <strong>linux</strong> çš„å‘½ä»¤ï¼ˆWindowsçš„batè…³æœ¬å¯¦åœ¨æ˜¯è®“äººä¸æ•¢æ­ç¶­ï¼‰ã€‚ä»¥åŠåœ¨é€™è£æœƒè¬›è¿°ä¸€äº› <strong>Git</strong> æ“ä½œçš„åˆæ­¥ã€‚ç•¶ç„¶ï¼Œå¦‚æœä½ å·²ç¶“åœ¨ä½¿ç”¨ <strong>linux</strong> é€²è¡Œé–‹ç™¼çš„è©±ï¼Œå¯ä»¥è·³éå‰é¢ä¸€å †ä»¤äººæ„Ÿåˆ°å­ç…©çš„ç’°å¢ƒé…ç½®ç« ç¯€ã€‚æˆ–è€…ä½ åœ¨ä½¿ç”¨ <strong>M$ Windows</strong> ä½†å»ä¸æƒ³æ”¹è®Šè‡ªå·±çš„è…³æœ¬ç¿’æ…£çš„è©±ï¼Œä¹Ÿå¯ä»¥é¸æ“‡æ€§åœ°è·³éä¸€äº›ç« ç¯€å’Œæ­¥é©Ÿã€‚</p>
<!-- æˆ‘æ˜¯å°å°åˆ†å‰²ç¬¦ -->
<h2 id="Node-JSæ˜¯ä»€éº¼ï¼Ÿ">Node.JSæ˜¯ä»€éº¼ï¼Ÿ</h2><p>å¾ˆå¤šäººéƒ½çŸ¥é“JSæ˜¯ä¸€é–€èªè¨€ï¼Œè€Œä¸”æ˜¯ä¸€é–€è…³æœ¬èªè¨€ï¼Œå…¶å…¨ç¨±å°±æ˜¯ <strong>JavaScript</strong>ï¼Œè€Œä¸”èˆ‡æ‰€è¬‚çš„ <strong>Java</strong> æ²’æœ‰ä¸€å€‹å±çš„é—œä¿‚ã€‚</p>
<h3 id="å‰ç«¯_JavaScript">å‰ç«¯ JavaScript</h3><p>åœ¨å¥½å¤šå¹´å‰ï¼Œ<strong>JavaScript</strong> æ˜¯ç¶²é çš„ä¸€å€‹å¯„ç”ŸèŸ²ï¼Œå®ƒå¿…é ˆä¾è³´æ–¼ç¶²é çš„ç€è¦½å™¨ä¸­æ‰èƒ½åŸ·è¡Œï¼Œä¸¦ä¸”ä½œçˆ²ç¶²é çš„ä¸€éƒ¨åˆ†ï¼Œä»¥</p>
<figure class="highlight xml"><figcaption><span>html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="actionscript"></span><br><span class="line"><span class="comment">//blahblah...</span></span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¨™ç±¤é€²è¡ŒåŒ…å«ï¼Œé€™æ¨£æ‰èƒ½æä¾›å…¶ä¸Šä¸‹æ–‡ç’°å¢ƒã€‚æˆ–è€…èªªå°‡å…¶å–®ç¨å¯«å…¥ä¸€å€‹ <code>*.js</code> æ–‡ä»¶ä¸­ï¼Œä¸¦ä¸”åœ¨ç¶²é è£ä»¥</p>
<figure class="highlight xml"><figcaption><span>html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"foo/bar.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>çš„å½¢å¼å°‡å…¶åŒ…å«é€²ä¾†ã€‚</p>
<p>ä½†ç¸½è€Œè¨€ä¹‹ï¼Œ<strong>JavaScript</strong> åªæ˜¯å¯„ç”Ÿåœ¨ç¶²é è£é¢çš„ä¸€éš»å°å°å¯æ†èŸ²ç½·äº†ã€‚å®ƒçš„ä½œç”¨ç„¡éå°±æ˜¯ä½¿ç¶²é çš„äº¤äº’æ€§æ›´å¼·ï¼Œé é¢æ•ˆæœæ›´å¤šè€Œå·²ã€‚</p>
<p>å¾Œä¾†ï¼Œé€™å¹«ä¸ç”˜å¯‚å¯çš„äººé¡å°‡ <strong>JavaScript</strong> å¾ç¶²é ï¼ˆæˆ–è€…èªªå‰ç«¯ï¼‰çš„å¸åœ‹ä¸­ç¨ç«‹äº†å‡ºä¾†ï¼ˆå°å¿ƒå¿«éï¼‰ï¼Œæ–¼æ˜¯å°±å‡ºç¾äº† <strong>CommonJS</strong>ã€‚</p>
<h3 id="CommonJS">CommonJS</h3><p><strong>CommonJS</strong> å…¶å¯¦ä¸æ˜¯ä¸€é–€æ–°çš„èªè¨€ï¼Œç”šè‡³éƒ½ä¸èƒ½èªªå®ƒæ˜¯ä¸€å€‹æ–°çš„è§£é‡‹å™¨â€”â€”å¯¦éš›ä¸Šå®ƒåªæ˜¯ä¸€å€‹æ¦‚å¿µæˆ–è€…æ˜¯ä¸€å€‹è¦ç¯„ã€‚</p>
<p>åœ¨é€™å€‹è¦ç¯„ä¸­ï¼Œå®ƒå®šç¾©äº†å¾ˆå¤š <strong>API</strong> ï¼Œè¬›é€šä¿—é»æˆ–è€…ç›´æˆªäº†ç•¶é»å°±æ˜¯å‡½æ•¸å•Šé¡å•Šä»€éº¼çš„ï¼Œè€Œé€™äº› <strong>API</strong> æ˜¯çˆ²é‚£äº›æ™®é€šæ‡‰ç”¨ç¨‹åºï¼ˆNative Appï¼‰è€Œéç€è¦½å™¨æ‡‰ç”¨ä½¿ç”¨ã€‚å®ƒçš„çµ‚æ¥µç›®æ¨™å°±æ˜¯æä¾›ä¸€å€‹é¡ä¼¼æ–¼ <strong>Python</strong>ã€<strong>Ruby</strong> ä¹‹é¡çš„è…³æœ¬ä¸€æ¨£çš„æ¨™æº–åº«ï¼Œé–‹ç™¼è€…å¯ä»¥ç”¨é€™æ¨£çš„æ±è¥¿ä¸€æ¨£ä¾†åšåˆ° <strong>Python</strong>ã€<strong>Ruby</strong> èƒ½åšåˆ°çš„äº‹ï¼Œè€Œéåƒ…åƒ…ä¾·é™æ–¼ç¶²é ä¸­çš„æ•ˆæœæˆ–è€…åŠŸèƒ½å¯¦ç¾ï¼Œå®ƒä¹Ÿå¯ä»¥è·‘åœ¨æœ¬åœ°ã€‚</p>
<p>æ‰€ä»¥èªªä¸‹é¢çš„äº‹æƒ…å°æ–¼ <strong>JavaScript</strong> ä¾†èªªä¸å†æ˜¯å¤¢ï¼š</p>
<ul>
<li>æœå‹™ç«¯JavaScriptæ‡‰ç”¨</li>
<li>å‘½ä»¤è¡Œå·¥å…·</li>
<li>åœ–å½¢ç•Œé¢æ‡‰ç”¨</li>
<li>æ··åˆæ‡‰ç”¨ï¼ˆTitaniumã€Adobe AIRç­‰ï¼‰</li>
</ul>
<p>é‚£éº¼ï¼Œå®ƒå…·é«”å½Œè£œäº† <strong>å‰ç«¯JavaScript</strong> çš„å“ªäº›ç©ºç™½å‘¢ï¼Ÿå…¶å¯¦é€™ä¹Ÿæ¶‰åŠäº†å¾ˆå¤š <strong>å‰ç«¯JavaScript</strong> æ‰€æ²’æœ‰æ¶‰åŠçš„æ±è¥¿ï¼Œå¦‚äºŒé€²åˆ¶ã€ç·¨ç¢¼ã€IOã€æ–‡ä»¶ã€ç³»çµ±ã€æ–·è¨€æ¸¬è©¦ã€å¥—æ¥å­—ã€äº‹ä»¶éšŠåˆ—ã€Workerã€æ§åˆ¶æª¯ç­‰ç­‰ã€‚</p>
<p>é—œæ–¼ <strong>CommonJS</strong> çš„æ›´é€²ä¸€æ­¥ç­è§£å¯ä»¥ç¿»é–±ä¸€ä¸‹å…¶ <strong><a href="http://wiki.commonjs.org/wiki/CommonJS" target="_blank" rel="external">Wiki</a></strong>ã€‚</p>
<h3 id="Node-JS">Node.JS</h3><p>ä¸Šé¢è¬›äº†é‚£éº¼å¤šï¼Œå»å§‹çµ‚åœç•™åœ¨â€œè¦ç¯„â€é€™å€‹å±¤é¢ä¸Šã€‚è€Œ <strong>Node.JS</strong> çš„å‡ºç¾ä¾¿æ˜¯è®“ <strong>CommonJS</strong> æˆçˆ²äº†ç¾å¯¦ã€‚</p>
<p>é€™è£è¦å¤§å®¶æ˜ç¢ºçš„ä¸€é»çš„å°±æ˜¯ <strong>Node.JS</strong> ä¸¦ä¸æ˜¯ä¸€é–€æ–°çš„èªè¨€ï¼Œå®ƒçš„èªè¨€é‚„æ˜¯ <strong>JavaScript</strong> ï¼Œç¡¬è¦èªªæ˜¯ä¸€é–€æ–°çš„èªè¨€é‚£ä¹Ÿæ‡‰è©²æ˜¯ <strong>Common JavaScript</strong>ã€‚<strong>Node.JS</strong> åªæ˜¯ <strong>CommonJS</strong> çš„ä¸€å€‹<a href="http://zh.wikipedia.org/wiki/%E8%A7%A3%E9%87%8A%E5%99%A8" target="_blank" rel="external">è§£é‡‹å™¨</a>ç½·äº†ã€‚</p>
<p>å®ƒæ˜¯åŸºæ–¼ <strong>Google</strong> çš„ <strong>V8è™›æ“¬æ©Ÿ</strong>(Chromeç€è¦½å™¨æ‰€ä½¿ç”¨çš„JavaScriptåŸ·è¡Œç’°å¢ƒ) çš„ä¸€å€‹è§£é‡‹å™¨ã€‚</p>
<p>å¾ˆå¤šäººå°è±¡ä¸­çš„æ¦‚å¿µé‚„æ˜¯æ²’èƒ½æ“ºè„« <strong>å‰ç«¯JavaScript</strong> çš„é™°éœ¾ï¼Œèªçˆ² <strong>JavaScript</strong> å°±æ˜¯åšç¶²ç«™çš„ï¼Œ <strong>Node.JS</strong> ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<p>åŒ…æ‹¬æœ¬äººåœ¨ <strong><a href="http://cnodejs.org/" target="_blank" rel="external">cnodejs.org</a></strong> ä¸­çœ‹åˆ°çš„å¸–å­å¤§å¤šä¹Ÿéƒ½æ˜¯è¬› <strong>Node.JS</strong> å¦‚ä½•å¦‚ä½•åšç¶²ç«™ï¼ˆæœå‹™ç«¯ï¼‰äº‘äº‘ï¼Œå¦‚ä½•å¦‚ä½•ä½¿ç”¨ <strong>Express</strong> æ¨¡å¡Šä¾†æ­å»ºä¸€å€‹ç¶²ç«™äº‘äº‘ã€‚</p>
<blockquote>
<p>é€™æ˜¯ä¸€å€‹èª¤å€ã€‚</p>
</blockquote>
<p><strong>PHP</strong> é‚„èƒ½ç”¨ <strong><a href="http://www.php-cli.com/" target="_blank" rel="external">PHP-CLI</a></strong> ä¾†å¯«å€‹è…³æœ¬æ”¾æœ¬åœ°è·‘å‘¢ï¼Œ<strong>Node.JS</strong> æ›´æ˜¯å¯ä»¥å¯«ä»»ä½•ç¨‹åºã€‚é›–ç„¶é€™éº¼è¬›æœ‰äº›èª‡å¤§äº†ï¼Œä½†æ˜¯æˆ‘é€™éº¼èªªçš„ç†ç”±æ˜¯å¸Œæœ›å¤§å®¶èƒ½æ“ºè„«é€™éº¼ä¸€å€‹èª¤å€ã€‚</p>
<p>èˆ‰å€‹ç°¡å–®çš„ä¾‹å­å§ï¼Œå¤§å®¶éƒ½æ˜¯æé <strong>ACM</strong> çš„å­©å­äº†ï¼Œç¸½å°çµ‚ç«¯çª—å£çš„è¼¸å…¥è¼¸å‡ºæœ‰ä¸€å®šæ„Ÿè¦ºäº†å§ã€‚ç¾åœ¨çµ¦æˆ‘ä»¥æœ€å¿«é€Ÿåº¦ç¢¼ä¸€å€‹ <strong><em><a href="http://acm.nbut.edu.cn/problem/view.xhtml?id=1000" target="_blank" rel="external">A + B Problem</a></em></strong> çµ¦æˆ‘çœ‹çœ‹ã€‚</p>
<p>è¼•è»Šç†Ÿè·¯ï¼Œæˆ‘çŸ¥é“ã€‚ä½†æ˜¯ä½ å€‘ç¾åœ¨åšçš„äº‹ç”¨ <strong>Node.JS</strong> åŒæ¨£èƒ½åšåˆ°ã€‚</p>
<figure class="highlight javascript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">process.stdin.resume();</span><br><span class="line">process.stdin.setEncoding(<span class="string">"utf8"</span>);</span><br><span class="line">process.stdin.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> datas = chunk.trim().split(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; datas.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> ab = datas[i].trim().split(<span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">parseInt</span>(ab[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">var</span> b = <span class="built_in">parseInt</span>(ab[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">console</span>.log(a + b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç”±æ–¼<del>æˆ‘å€‘å­¸æ ¡</del>æˆ‘çš„å‰ä»»å­¸æ ¡OJä¸æ”¯æŒ <strong>Node.JS</strong>ï¼Œæ‰€ä»¥è«‹ä½ å€‘ç§»æ­¥åˆ° <strong><a href="http://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=1000" target="_blank" rel="external">AIZU OJ</a></strong> å»æŠŠä¸Šé¢çš„ä»£ç¢¼äº¤éå»çœ‹çœ‹çµæœçœ‹ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šèªè¨€è¦é¸æ“‡ <strong>JavaScript</strong>ã€‚</p>
</blockquote>
<p>æ€éº¼æ¨£ï¼ŒåŒæ¨£èƒ½éé¡Œçš„å°å§ï¼Ÿ</p>
<h2 id="å°çµ">å°çµ</h2><p>ä¸Šé¢å°é€™äº›æ±è¥¿åšäº†å€‹ç°¡å–®çš„ä»‹ç´¹ï¼Œæˆ‘éœ€è¦ä½ å€‘çŸ¥é“çš„æ±è¥¿å¾ˆç°¡å–®ï¼š</p>
<ol>
<li><strong>Node.JS</strong> æ˜¯ä¸€å€‹è…³æœ¬è§£é‡‹å™¨ï¼Œç”¨çš„èªè¨€æ˜¯ <strong>JavaScript</strong>ã€‚</li>
<li><strong>Node.JS</strong> åŠŸèƒ½å¾ˆå¼·å¤§ï¼Œä¸æ˜¯éš»èƒ½æ‹¿ä¾†åšç¶²ç«™çš„ï¼Œçœ¼å…‰æ”¾é–‹é—Šäº›ã€‚</li>
<li>çµ¦æˆ‘å¥½å¥½å­¸ã€‚</li>
</ol>
<h2 id="ç•ªå¤–">ç•ªå¤–</h2><blockquote>
<p>æœ‰å€‹ç¢¼ç•œè€äº†ï¼Œæƒ³å­¸å­¸æ›¸æ³•ä¾†ä¿®èº«é¤Šæ€§ã€‚ç•¶ä»–å±•é–‹å®£ç´™ï¼ŒçŒ¶è±«äº†åŠå¤©ä¹‹å¾Œï¼Œçµ‚æ–¼æ®æ¯«æ½‘å¢¨ï¼Œåœ¨ç´™ä¸Šé¾é£›é³³èˆå¯«ä¸‹å¹¾å€‹å¤§å­—ï¼š</p>
<blockquote>
<p><strong><em>Hello World</em></strong></p>
</blockquote>
</blockquote>
<p>é›–ç„¶é€™ä¸€ç¯‡æ–‡ç« æ²’æœ‰è¬›åˆ°ä»»ä½• <strong>Node.JS</strong> çš„èªæ³•ï¼Œä½†æ˜¯é‚„æ˜¯å¯ä»¥è®“ä½ å€‘ç·´ç·´æ›¸æ³•çš„ã€‚</p>
<p><strong>Cèªè¨€</strong> çš„æ¨™æº–è¼¸å‡ºå‡½æ•¸æ˜¯ <code>printf</code>ï¼Œè€Œ <strong>Node.JS</strong> çš„æ¨™æº–è¼¸å‡ºå‰‡æ˜¯ï¼š</p>
<figure class="highlight applescript"><figcaption><span>javascript</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="command">log</span>(<span class="string">"blahblah..."</span>);</span><br></pre></td></tr></table></figure>
<p>å¥½çš„ï¼Œå³ä½¿æ²’æœ‰è£ä¸Š <strong>Node.JS</strong> ç’°å¢ƒä¹Ÿé˜»æ­¢ä¸äº†æˆ‘å€‘å‘ä¸–ç•Œå•å¥½ã€‚</p>
<p>æ‰“é–‹ <strong><a href="http://ideone.com/" target="_blank" rel="external">IDEOne</a></strong>ï¼Œå°‡ä½ çš„ <code>Hello World</code> è²¼åˆ°ç·¨è¼¯æ¡†ä¸­ï¼Œç„¶å¾Œåœ¨å·¦å´çš„èªè¨€æ¬„è£é¢é¸ä¸­ <strong>Node.JS</strong> ï¼Œé»æ“Šé€å‡ºï¼Œä½ å°±èƒ½çœ‹åˆ°ä½ çš„ç¬¬ä¸€å€‹ <strong>Node.JS</strong> ç¨‹åºçš„é‹è¡Œçµæœäº†ã€‚</p>
<p><strong><em>To be continuedâ€¦</em></strong></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€æœ¬ç³»åˆ—æ•™ç¨‹ä¸»è¦æ˜¯å¯«çµ¦æˆ‘å¸¶çš„é‚£å¹«ç†Šå­©å­å€‘çœ‹çš„ã€‚æˆ‘è‡ªå·±çš„ <strong>Node.js</strong> æ°´å¹³åŠæ–¤å…«å…©ï¼Œæªè¾­ä¹‹ä¸­ä¹Ÿå…ä¸äº†æœ‰è‡ªå·±éŒ¯èª¤çš„ç†è§£ï¼Œæœƒèª¤äººå­å¼Ÿã€‚ä½†æ˜¯å°æ–¼åˆå­¸è€…ä¾†èªªï¼ŒæŸäº›è‡ªå·±åŠ©è¨˜çš„ç†è§£é‚„æ˜¯å¯å–çš„ã€‚æœ‰äº›æ¦‚å¿µæ€§çš„éŒ¯èª¤å¯ä»¥ç­‰ä»–å€‘é€²ä¸€æ­¥æ·±å…¥ç ”ç©¶ä¹‹å¾Œå†è‡ªè¡Œæ›´æ­£ã€‚]]>
    </summary>
    
      <category term="JavaScript" scheme="http://xcoder.in/tags/JavaScript/"/>
    
      <category term="Node.js" scheme="http://xcoder.in/tags/Node-js/"/>
    
      <category term="ä¸€èµ·æ“¼Node.JS" scheme="http://xcoder.in/tags/%E4%B8%80%E8%B5%B7%E6%93%BCNode-JS/"/>
    
      <category term="NodeJS" scheme="http://xcoder.in/categories/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[é—œæ–¼JavaScriptä¸­callbackå‡½æ•¸çš„thisæŒ‡é‡é‡å®šç¾©]]></title>
    <link href="http://xcoder.in/2013/07/15/javascript-callback-this-bind/"/>
    <id>http://xcoder.in/2013/07/15/javascript-callback-this-bind/</id>
    <published>2013-07-15T06:20:29.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€æœ€è¿‘åœ¨å¯« <strong>NBUT Virtual Judge</strong> çš„å…§æ ¸æ¡†æ¶ï¼Œç”¨çš„åˆæ˜¯ <strong>Node.JS</strong> äº†ï¼ŒæŠŠå®ƒç•¶ä½œä¸€å€‹æœ¬åœ°é‹è¡Œçš„è…³æœ¬ä¸æ–·é€²è¡Œè¼ªè©¢ã€‚</p>
<p>ã€€ã€€è¡†æ‰€å‘¨çŸ¥JSä¸­çš„ä¸€å€‹ç²¾é«“å°±æ˜¯ç•°æ­¥å›èª¿ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥åœ¨æˆ‘è‡ªå·±å¯«çš„æ¡†æ¶ä¸­ä¹Ÿç¶“å¸¸æœƒå‡ºç¾é¡ä¼¼æ–¼ä¸‹é¢çš„ä»£ç¢¼ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo.bar(a, b, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç¸½è€Œè¨€ä¹‹å°±æ˜¯å¯«ä¸€å€‹å‡½æ•¸ï¼Œé€™å€‹å‡½æ•¸å°‡æœƒèª¿ç”¨ä¸€å€‹å›èª¿å‡½æ•¸ã€‚</p>
<p>ã€€ã€€ä½†æ˜¯å•é¡Œå‡ºç¾äº†ï¼šåœ¨é‚£å€‹å›èª¿å‡½æ•¸ <code>function</code> ä¸­ï¼Œä½ å¦‚æœä½¿ç”¨äº†ä¸€å€‹ <code>this</code> æŒ‡é‡çš„è©±ï¼Œå®ƒå°‡æœƒæŒ‡å‘æ ¹ï¼Œè€Œä¸æ˜¯ <code>foo</code> çš„æœ¬é«”ã€‚</p>
<p>ã€€ã€€é‚£éº¼å¦‚æœæˆ‘å€‘æƒ³åœ¨ <code>function</code> ä¸­ä¹Ÿç”¨ <code>this</code> ä¾†æŒ‡ä»£é€™å€‹ <code>foo</code> å°è±¡è©²æ€éº¼è¾¦å‘¢ï¼Ÿ</p>
<p>ã€€ã€€çµæœé‚„æ˜¯IRCæœ‰ç”¨ã€‚æœ¬äººè·‘ <strong>Node.JS</strong> çš„ <strong>IRC</strong> ä¸Šå•äº†é€™å€‹å•é¡Œï¼Œçµæœæœ‰äººå°±é€™æ¨£å›è¦†æˆ‘äº†ï¼š</p>
<blockquote>
<p>13:07 &lt;shama&gt; xadillax: foo(a, b callback.bind(foo))</p>
<p>13:10 &lt;olalonde&gt; foo (a, b fn) { fn = fn.bind(this); â€¦. }</p>
</blockquote>
<p>ã€€ã€€ç„¶å¾Œé‚„å¾ˆç†±å¿ƒåœ°çµ¦äº†æˆ‘å€‹ç¶²å€ï¼š<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind</a></p>
<p>ã€€ã€€ç¸½ä¹‹æœ€å¾Œå¾—å‡ºçš„çµè«–å°±æ˜¯èªªï¼š</p>
<p>ã€€ã€€ä½ åªè¦çµ¦ä½ çš„ <code>callback</code> å‡½æ•¸æŒ‡å®šä¸€å€‹ <code>this</code> æŒ‡é‡å³å¯ã€‚</p>
<p>ã€€ã€€å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cb = callback.bind(foo);</span><br><span class="line">foo.bar(a, b, cb);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™æ¨£å°±èƒ½åœ¨å›èª¿å‡½æ•¸ä¸­ä½¿ç”¨fooä¾†ä½œçˆ²å…¶thisæŒ‡é‡äº†ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€æœ€è¿‘åœ¨å¯« <strong>NBUT Virtual Judge</strong> çš„å…§æ ¸æ¡†æ¶ï¼Œç”¨çš„åˆæ˜¯ <strong>Node.JS</strong> äº†ï¼ŒæŠŠå®ƒç•¶ä½œä¸€å€‹æœ¬åœ°é‹è¡Œçš„è…³æœ¬ä¸æ–·é€²è¡Œè¼ªè©¢ã€‚</p>
<p>ã€€ã€€è¡†æ‰€å‘¨çŸ¥JSä¸­çš„ä¸€å€‹ç²¾é«“å°±æ˜¯ç•°æ­¥å›èª¿ã€‚</p>
<p]]>
    </summary>
    
      <category term="Javascript" scheme="http://xcoder.in/tags/Javascript/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[é—œæ–¼Node.jsä¸‹çš„MongoDBé˜»å¡æ¨¡å¼å¯¦ç¾]]></title>
    <link href="http://xcoder.in/2013/03/29/nodejs-mongodb-sync/"/>
    <id>http://xcoder.in/2013/03/29/nodejs-mongodb-sync/</id>
    <published>2013-03-29T01:31:38.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€<strong><em>æ³¨ï¼šæœ¬æ–‡åƒ…çˆ²æˆ‘åˆå­¸ Node.JS çš„æ™‚å€™çš„ç¨šå«©ç­†è¨˜ã€‚æ˜¯å¾ <a href="http://web.archive.org/" target="_blank" rel="external">http://web.archive.org/</a> æ‰’å›ä¾†çš„ã€‚ç¾åœ¨çœ‹ä¾†å·²ç„¡å¤šå¤§åƒè€ƒåƒ¹å€¼ï¼Œå„ä½å¯ä»¥ç•¥éã€‚æˆ‘åªæ˜¯æŠŠå®ƒæ‰’å›ä¾†ç´€å¿µä¸€ä¸‹è€Œå·²ï¼Œä»¥è¨˜éŒ„æˆ‘çš„æ­·ç¨‹ã€‚è€Œé‚£å€‹ç›¸å°æ‡‰çš„ <code>SevenzJS</code> ä¹Ÿå·²ç¶“è¢«éºæ£„</em></strong></p>
<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><p>ã€€ã€€æœ€è¿‘åœ¨åšå…¬å¸é …ç›®çš„ä¸€å€‹æ¨¡å¡Šï¼Œä¸»è¦ç”¨æ–¼ <strong>JSON Api</strong> çš„å‚³è¼¸ï¼Œæ‰€ä»¥é–‹ç™¼ç’°å¢ƒçš„ç›®æ¨™å°±é–å®šåœ¨äº† <strong>Node.js</strong>ã€‚è€Œé€™ä¸€å¡Šçš„ç™»é™¸ç”¨æˆ¶åˆæ˜¯å­˜åœ¨ <strong>MongoDB</strong> è£é¢çš„ï¼Œæ‰€ä»¥å°±æœ‰ç­å¦‚ä¸‹çš„å•é¡Œã€‚</p>
<ul>
<li>ç¶²ä¸Šçš„ Node.JS æ¡†æ¶éƒ½æ¯”è¼ƒé‡å‹æˆ–è€…è‡ƒè…«çš„ï¼Œå­¸äº† Node ä¹‹å¾Œé‚„éœ€è¦å­¸é¡å¤–çš„æ±è¥¿ã€‚</li>
<li>æ‰€ä»¥æˆ‘å°±æ‰“ç®—è‡ªå·±å¯«ä¸€å€‹å°ˆæ³¨æ–¼ JSON Api çš„å¿«é€Ÿé–‹ç™¼æ¡†æ¶ï¼Œæ–¼æ˜¯æœ‰äº† SevenJSã€‚</li>
<li>å•é¡Œå‡ºç¾äº†ï¼Œé›–ç„¶ Node.JS æ¥µåº¦æ¨å´‡ç•°æ­¥éé˜»å¡æ¨¡å¼ï¼Œä½†æ˜¯é˜»å¡æ¨¡å¼åœ¨å¹³å¸¸é–‹ç™¼ä¸­é‚„æ˜¯å¤ªå¸¸ç”¨äº†ã€‚</li>
</ul>
<p>ã€€ã€€æˆ‘å€‘è©¦æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘å€‘æœ‰å¹¾å¥MongoDBçš„æŸ¥è©¢ä¹‹é¡çš„ï¼Œç”¨node-mongodb-nativeä¾†å¯«çš„è©±æ˜¯é€™æ¨£çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Db(<span class="string">'test'</span>, <span class="keyword">new</span> Server(<span class="string">"127.0.0.1"</span>, <span class="number">27017</span>, &#123;&#125;));</span><br><span class="line"><span class="keyword">var</span> test = <span class="function"><span class="keyword">function</span> (<span class="params">err, collection</span>) </span>&#123;</span><br><span class="line">    collection.insert(&#123;a:<span class="number">2</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">        collection.count(<span class="function"><span class="keyword">function</span>(<span class="params">err, count</span>) </span>&#123;</span><br><span class="line">            test.assertEquals(<span class="number">1</span>, count); &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Locate all the entries using find</span></span><br><span class="line">            collection.find().toArray(<span class="function"><span class="keyword">function</span>(<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">            test.assertEquals(<span class="number">1</span>, results.length);</span><br><span class="line">            test.assertTrue(results[<span class="number">0</span>].a === <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Let's close the db</span></span><br><span class="line">            client.close();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">client.open(<span class="function"><span class="keyword">function</span>(<span class="params">err, client</span>) </span>&#123;</span><br><span class="line">    client.collection(<span class="string">'test_insert'</span>, test);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å„ç¨®åµŒå¥—å›èª¿æœ‰æœ¨æœ‰ï¼é€™ä¸æ˜¯æˆ‘å€‘æƒ³è¦çš„ï¼Œå°¤å…¶æ˜¯æˆ‘çš„é‚£å€‹æ¡†æ¶ï¼Œå› çˆ²æˆ‘çš„æ¡†æ¶æ˜¯æµå¼çš„ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥æˆ‘å°±æƒ³æœ‰é€™æ¨£çš„ä¸€ç¨®æ–¹æ¡ˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> client = mongodb.connect();</span><br><span class="line"><span class="keyword">var</span> collection = mongodb.getCollection(client, <span class="string">"dbname"</span>);</span><br><span class="line"><span class="keyword">var</span> result = mongodb.find(&#123; <span class="string">"foo"</span> : <span class="string">"bar"</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä½¿å¾—é€™æ¨£å°±èƒ½æ‰¾å‡ºdbnameè¡¨ä¸‹çš„fooçˆ²barå€¼çš„è¨˜éŒ„äº†ã€‚</p>
<h2 id="æ­£é¡Œ">æ­£é¡Œ</h2><p>ã€€ã€€å‡ºæ–¼é€™æ¨£çš„æƒ³æ³•ï¼Œæˆ‘åœ¨ç¶²ä¸Šæ‰¾éäº†å¤§æ±Ÿå—åŒ—ï¼Œé™¤äº† CNode ç¤¾å€æœ‰äººå•åˆ°äº†é¡ä¼¼çš„å•é¡Œä»¥å¤–ï¼Œå†ä¹Ÿæ‰¾ä¸åˆ°éŸ³ä¿¡äº†ï¼Œè€Œä¸”é‚£è£ä¹Ÿæ²’æœ‰ä¸€å€‹å¥½çš„å›ç­”ã€‚</p>
<p>ã€€ã€€ä¸éé€™ä¹Ÿæ­£å¸¸ï¼Œå› çˆ² Node.js å®˜æ–¹æœ¬èº«å°±ä¸æ¨è–¦é€™éº¼åšâ€”â€”ä»–å€‘èªçˆ²ç•°æ­¥éé˜»å¡æ˜¯éå¸¸å„ªé›…çš„ä¸€ä»¶äº‹æƒ…ã€‚</p>
<p>ã€€ã€€åŒ…æ‹¬æˆ‘åœ¨ Node.js çš„ IRC èŠå¤©å®¤è£é¢å•äº†é€™å€‹å•é¡Œï¼Œä¹Ÿæœ‰äººæ˜¯é€™éº¼å›ç­”æˆ‘çš„ï¼š</p>
<blockquote>
<p>You canâ€™t use a car as a boat. If you want a boat, use a boat.</p>
</blockquote>
<p>ã€€ã€€è¨€ç°¡æ„è³…ï¼Œç›´æˆªäº†ç•¶åœ°èªªæ˜ Node.js æ˜¯ä¸æ”¯æŒé€™æ¨£çš„ï¼Œå¦‚æœä½ æƒ³é€™æ¨£åšï¼Œå°±ç”¨ python æˆ–è€… ruby å»å§ã€‚</p>
<p>ã€€ã€€ä¸éå¥½åœ¨å¾Œä¾† IRC è£é¢æœ‰äººæ¨è–¦äº†æˆ‘ä¸€å€‹æ¨¡å¡Šï¼š<a href="https://github.com/laverdet/node-fibers" target="_blank" rel="external">fibers</a>ã€‚</p>
<p>ã€€ã€€æœ‰äº†é€™å€‹æ¨¡å¡Šå¥½å•Šï¼Œç›´æ¥èƒ½ç”¨äº†æœ‰æœ¨æœ‰ï¼</p>
<p>ã€€ã€€æ¥ä¸‹ä¾†å°±ä¾†è¬›ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨å§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params">collection, selector, callback</span>) </span>&#123;</span><br><span class="line">    collection.find(selector).toArray(callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Fiber = <span class="built_in">require</span>(<span class="string">'fibers'</span>);</span><br><span class="line"><span class="keyword">var</span> Future = <span class="built_in">require</span>(<span class="string">'fibers/future'</span>);</span><br><span class="line"><span class="keyword">var</span> wait = Future.wait;</span><br><span class="line"></span><br><span class="line">Fiber(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> wrapper = Future.wrap(fund);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** é€™è£å°±æ˜¯æ­£é¡Œäº†ï¼Œæˆ‘å€‘å‡è¨­å·²ç¶“ç²å–ä¸€å€‹collectionäº† */</span></span><br><span class="line">    <span class="keyword">var</span> result = wrapper(collection, &#123; <span class="string">"foo"</span> : <span class="string">"bar"</span> &#125;).wait();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">&#125;).run();</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€é€™å°±æ˜¯ä¸€å€‹éå¸¸ç°¡å–®çš„åŒæ­¥æŸ¥è©¢ MongoDB çš„ä¾‹å­äº†ï¼Œå¯¦éš›ä¸Šæœ¬è³ªé‚„æ˜¯ä¸€å€‹ç•°æ­¥ï¼Œæ³¨æ„åˆ°æ²’æœ‰ï¼Œå…¶å¯¦ <code>Fiber()</code> å…§éƒ¨çš„é‚£å€‹ <code>function</code> æœ¬è³ªä¸Šé‚„æ˜¯ä¸€å€‹å›èª¿å‡½æ•¸ï¼Œåªä¸éåœ¨é€™å€‹å›èª¿å‡½æ•¸è£é¢ï¼Œè£é¢çš„æ‰€æœ‰ <code>callback</code> éƒ½å¯ä»¥è¢«åŒæ­¥äº†ã€‚ä¸éæˆ‘å€‘åªéœ€è¦å°å‹•ä¸€äº›æ‰‹è…³å°±èƒ½åŠ ä¸Šé€™å€‹å¤–æ®¼äº†ã€‚å…·é«”è«‹åƒè¦‹ <a href="https://github.com/XadillaX/SevenzJS/blob/a0a0476000c492dd8e70c062cfa432f559edbd16/sevenz/sRouter.js" target="_blank" rel="external">sRouter.js</a> ç´„ 121 è¡Œçš„å¤–æ®¼ä»¥åŠ <a href="https://github.com/XadillaX/SevenzJS/blob/a0a0476000c492dd8e70c062cfa432f559edbd16/sevenz/sMongoSync.js" target="_blank" rel="external">sMongoSync.js</a> çš„å¯¦ç¾ï¼ŒåŠ ä¸Š <a href="http://web.archive.org/web/20130726042859/https://github.com/XadillaX/SevenzJS/blob/a0a0476000c492dd8e70c062cfa432f559edbd16/actions/index.js" target="_blank" rel="external">index.js</a> ä¸­çš„æŸ¥è©¢ demoã€‚</p>
<h2 id="çµå°¾">çµå°¾</h2><p>ã€€ã€€æ‰€ä»¥èªªç•¶æˆ‘å€‘åšä¸åˆ°æŸä»¶äº‹çš„æ™‚å€™ï¼Œå¤šå»IRCçœ‹çœ‹ï¼Œå¤šå»ç¤¾å€æ··æ··ï¼Œä¹Ÿå¤šå»æ‰¾æ‰¾æ¨¡å¡Šï¼Œè¦çœŸæ²’æœ‰çš„è©±å°±åªèƒ½è‡ªå·±è±è¡£è¶³é£Ÿäº†ï¼ˆæˆ‘é‚„æ²’åˆ°é‚£æ°´å¹³ï¼Œç¬‘ï¼‰ã€‚ç¸½ä¹‹é€™æ¬¡Fiberså¹«äº†æˆ‘ä¸€å€‹å¤§å¿™ã€‚</p>
<p>ã€€ã€€æœ€å¾Œï¼ŒSevenzJS æ­¡è¿ <a href="https://github.com/XadillaX/SevenzJS" target="_blank" rel="external">Fork</a>ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€<strong><em>æ³¨ï¼šæœ¬æ–‡åƒ…çˆ²æˆ‘åˆå­¸ Node.JS çš„æ™‚å€™çš„ç¨šå«©ç­†è¨˜ã€‚æ˜¯å¾ <a href="http://web.archive.org/" target="_blank" rel="external">http://web.archive.org/</a> ]]>
    </summary>
    
      <category term="MongoDB" scheme="http://xcoder.in/tags/MongoDB/"/>
    
      <category term="Node.JS" scheme="http://xcoder.in/tags/Node-JS/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[é—œæ–¼jQueryä¸­â€œanimate()â€å‡½æ•¸å°é¡è‰²è®ŠåŒ–çš„æ”¯æŒ]]></title>
    <link href="http://xcoder.in/2012/12/24/jquery-animate-color-support/"/>
    <id>http://xcoder.in/2012/12/24/jquery-animate-color-support/</id>
    <published>2012-12-24T01:20:16.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€æœ€è¿‘åœ¨åšä¸€å€‹æ±½è»Šåœ˜è³¼ç¶²çš„é …ç›®ï¼Œç”±æ–¼è€å¤§åŠ›æ±‚ç°¡æ½”ï¼Œæ‰€ä»¥ç•Œé¢åšå¾—æœ‰äº›å°æ¸…æ–°ã€‚ä¸éå¾—èªªä¸€ä¸‹é é¢ä¸æ˜¯æˆ‘è¨­è¨ˆçš„ï¼Œæ˜¯ä¸€ä½ç¾å·¥åŒå¿—ã€‚</p>
<p>ã€€ã€€å»¢è©±ä¸å¤šèªªï¼Œç›´æ¥åˆ‡å…¥æ­£é¡Œå§â€”â€”</p>
<p>ã€€ã€€æˆ‘è¦åšå¾—å°±æ˜¯è®“ä¸‹é¢ä¸€æ®µä»£ç¢¼ç”Ÿæ•ˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"#yourid"</span>).stop().animate(&#123; <span class="string">"backgroundColor"</span> : <span class="string">"#rrggbb"</span>, <span class="string">"color"</span> : <span class="string">"#rrggbb"</span> &#125;, <span class="string">"fast"</span>);</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä½†æ˜¯ï¼Œå¾ˆéºæ†¾ï¼Œä¸€é»ä¹Ÿæ²’æœ‰å‹•ã€‚æœ¬ä¾†æ•ˆæœæ‡‰è©²è·Ÿé€™å€‹ç‰ˆæœ¬çš„xcoderåšå®¢çš„å¤©é ­å°èˆªæ¢ä¸€æ¨£æœ‰å€‹å‹•æ…‹æ•ˆæœï¼ˆåªä¸éxcoderçš„å°èˆªæ¢æ˜¯é€æ˜åº¦è®ŠåŒ–ï¼Œè€Œé …ç›®ä¸­æˆ‘æƒ³è®“å®ƒèƒŒæ™¯è‰²è®ŠåŒ–ï¼‰ã€‚</p>
<p>ã€€ã€€åŸå› æ˜¯ä»€éº¼å‘¢ï¼Ÿæ­»æœˆä¸Šç¶²æŸ¥äº†å¾ˆä¹…ï¼Œæ‰¾åˆ°çš„æ±è¥¿éƒ½å¾ˆç°¡å–®åœ°èªªæ˜ç­ä¸€ä¸‹ï¼Œè²Œä¼¼éƒ½å¯ä»¥ã€‚å˜›ï¼Œä¹Ÿè¨±æ˜¯jQueryæ–°ç‰ˆæœ¬ä¸æ”¯æŒé€™å€‹ç‰¹æ€§äº†å§ã€‚</p>
<p>ã€€ã€€æœ€å¾Œï¼Œæ­»æœˆåœ¨jQueryçš„å®˜æ–¹æ–‡æª”ä¸­æ‰¾åˆ°äº†ä¸‹é¢é€™æ®µè©±â€”â€”</p>
<blockquote>
<p>All animated properties should be animated to <strong><em>a single numeric value</em></strong>, except as noted below; most properties that are non-numeric cannot be animated using basic jQuery functionality (For example, width, height, or left can be animated but background-color cannot be, unless the <a href="https://github.com/jquery/jquery-color" target="_blank" rel="external">jQuery.Color()</a> plugin is used). Property values are treated as a number of pixels unless otherwise specified. The units em and % can be specified where applicable.</p>
<p style="text-align: right">â€”â€” <a href="http://api.jquery.com/animate/" target="_blank" rel="external">jQueryå®˜æ–¹æ–‡æª” .animate()</a></p>

</blockquote>
<p>ã€€ã€€å¤§è‡´çš„æ„æ€å°±æ˜¯èªªæ‰€æœ‰å‹•ç•«å±¬æ€§éƒ½å¿…é ˆæ˜¯ä¸€å€‹å–®æ•¸å­—å€¼ï¼Œæ‰€ä»¥èªªå¤§å¤šæ•¸éæ•¸å­—çš„å±¬æ€§æ˜¯ä¸èƒ½è¢«å‹•ç•«åŒ–çš„ã€‚ä¾‹å¦‚é«˜åº¦ã€å¯¬åº¦ç­‰å¯ä»¥è¢«å‹•ç•«åŒ–ï¼Œä½†æ˜¯èƒŒæ™¯è‰²å°±ä¸ä¿¡äº†ã€‚<span style="color: red;"><strong><em>é™¤éä½ ç”¨äº†jQuery.Color()æ’ä»¶</em></strong></span>ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥èªªå•é¡Œæ‰¾åˆ°äº†ï¼Œæˆ‘å€‘å¿…é ˆå¾—ç”¨ä¸€å€‹jQuery.Color()æ’ä»¶ä¾†å°ä¸€äº›é¡è‰²é€²è¡Œå‹•ç•«æ“ä½œã€‚</p>
<p>ã€€ã€€è©±ä¸å¤šèªªï¼Œæˆ‘å€‘å»ä¸‹ä¸€å€‹jQuery.Color()æ’ä»¶ã€‚æŠŠå®ƒåŠ åœ¨æˆ‘å€‘çš„é é¢ä¸­ï¼Œç„¶å¾Œå°±å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼ä¾†é€²è¡Œå‹•ç•«æ“ä½œäº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">this</span>).stop().animate(&#123;</span><br><span class="line">    <span class="string">"backgroundColor"</span> : jQuery.Color(<span class="string">"rrggbb"</span>),</span><br><span class="line">    <span class="string">"color"</span> : jQuery.Color(<span class="string">"rrggbb"</span>)</span><br><span class="line">&#125;, <span class="string">"fast"</span>);</span><br></pre></td></tr></table></figure>]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€æœ€è¿‘åœ¨åšä¸€å€‹æ±½è»Šåœ˜è³¼ç¶²çš„é …ç›®ï¼Œç”±æ–¼è€å¤§åŠ›æ±‚ç°¡æ½”ï¼Œæ‰€ä»¥ç•Œé¢åšå¾—æœ‰äº›å°æ¸…æ–°ã€‚ä¸éå¾—èªªä¸€ä¸‹é é¢ä¸æ˜¯æˆ‘è¨­è¨ˆçš„ï¼Œæ˜¯ä¸€ä½ç¾å·¥åŒå¿—ã€‚</p>
<p>ã€€ã€€å»¢è©±ä¸å¤šèªªï¼Œç›´æ¥åˆ‡å…¥æ­£é¡Œå§â€”â€”</p>
<p>ã€€ã€€æˆ‘è¦åšå¾—å°±æ˜¯è®“ä¸‹é¢ä¸€æ®µä»£ç¢¼ç”Ÿæ•ˆï¼š</p>
<figure class="highl]]>
    </summary>
    
      <category term="Javascript" scheme="http://xcoder.in/tags/Javascript/"/>
    
      <category term="jQuery" scheme="http://xcoder.in/tags/jQuery/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ç·šç¨‹å®‰å…¨â€”â€”Scope Lockæ¨¡å¼]]></title>
    <link href="http://xcoder.in/2012/09/08/scope-lock/"/>
    <id>http://xcoder.in/2012/09/08/scope-lock/</id>
    <published>2012-09-07T17:31:59.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€<strong><em>å˜›ï¼Œæœ¬æ–‡æ˜¯å»ºç«‹åœ¨M$çš„Visual StudioåŸºç¤ä¸Šçš„ï¼Œlinuxâ˜­å‹¿å™´ã€‚</em></strong></p>
<p>ã€€ã€€æˆ‘æœ€å…ˆç”¨åˆ° ScopeLock æ¨¡å¼æ˜¯åœ¨è‡ªå·±é–‹ç™¼ <strong>XAEå¼•æ“</strong> çš„æ™‚å€™ã€‚åœ¨è£é¢ç”¨åˆ°æŒºå¤šçš„ç·šç¨‹å‡½æ•¸ï¼Œé‚£éº¼å¦‚ä½•è§£æ±ºè‡¨ç•Œå€å°±æˆäº†ä¸€å€‹é‡è¦çš„èª²é¡Œã€‚å¯èƒ½å¤§å®¶æƒ³ï¼Œä¸å°±ä¸€å€‹ç·šç¨‹é–è‡¨ç•Œå€ä»€éº¼çš„éº¼ï¼Œä¸€å€‹ <code>EnterCriticalSection</code> å’Œä¸€å€‹ <code>LeaveCriticalSection</code> ä¸å°±è§£æ±ºäº†éº¼ï¼Ÿ</p>
<p>ã€€ã€€å…¶å¯¦ä¸ç„¶ã€‚åœ¨ <strong>M$</strong> ä¸­ï¼Œæœ€å¸¸ç”¨çš„ç•¶ç„¶å°±æ˜¯ <code>CRITICAL_SECTION</code> äº†ï¼Œä½†æ˜¯å¦‚æœè‡¨ç•Œå€ä¸Šé–å»æœ¨æœ‰è§£é–å‘¢ï¼Ÿé€™å°±æœƒç™¼ç”Ÿæ­»é–ç¾è±¡ã€‚å°æ–¼ä¸€å€‹ç²—å¿ƒçš„ç¨‹åºçŒ¿ä¾†èªªé€™æ¨£çš„éŒ¯èª¤é‚„æ˜¯æœ‰æ©Ÿç‡ç™¼ç”Ÿçš„ã€‚å°±ç®—ä½ è¶³å¤ ç´°å¿ƒï¼Œé‚„æ˜¯æœ‰æ™‚å€™æœƒä¸€å¤±è¶³æˆåƒå¤æ¨ã€‚</p>
<p>ã€€ã€€æ‰€ä»¥å°±æœ‰äº†é€™éº¼ä¸€ç¨®æ–¹æ³•ä¾†æœçµ•é€™ç¨®æ­»é–çš„ç”¢ç”Ÿâ€”â€” <code>ScopeLock</code>ã€‚</p>
<p>ã€€ã€€é‚£éº¼ä»€éº¼å« <code>ScopeLock</code>ï¼Ÿ</p>
<p>ã€€ã€€æˆ‘å€‘è©¦æƒ³ä¸€ä¸‹å¦‚æœæœ‰é€™éº¼ä¸€å€‹é¡â€”â€”åœ¨æ§‹é€ çš„æ™‚å€™ï¼Œä½ å‚³é€²å»ä¸€å€‹ <code>CRITICAL_SECTION</code> çš„å¼•ç”¨ä¸¦ä¸”å°‡å…¶ <code>EnterCriticalSection</code> é€²å…¥åˆ°è‡¨ç•Œå€ã€‚ç•¶å®ƒææ§‹çš„æ™‚å€™ï¼Œæˆ‘å€‘ç›´æ¥ <code>LeaveCriticalSection</code> å°±å¥½äº†ã€‚</p>
<p>ã€€ã€€ä¹Ÿè¨±ä½ æœƒå•ï¼Œé€™æ¨£çš„ä¸€å€‹é¡æœƒæœ‰ä»€éº¼ç”¨å‘¢ï¼Ÿ</p>
<p>ã€€ã€€é‚£éº¼æˆ‘ä¸‹é¢æ¼”ç¤ºä¸€æ®µç°¡å–®çš„ ScopeLock ä»£ç¢¼å…ˆå§ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> ScopeLock</span><br><span class="line">&#123;</span><br><span class="line">    CRITICAL_SECTION&amp; m_cs;</span><br><span class="line"></span><br><span class="line">    ScopeLock(CRITICAL_SECTION cs) : m_cs(cs)</span><br><span class="line">    &#123;</span><br><span class="line">        EnterCriticalSection(&amp;m_cs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~ScopeLock()</span><br><span class="line">    &#123;</span><br><span class="line">        LeaveCriticalSection(&amp;m_cs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line">CRITICAL_SECTION cs;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...å‡è¨­æˆ‘å€‘å·²ç¶“åˆå§‹åŒ–å¥½äº†é€™å€‹è‡¨ç•Œå€</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ScopeLockTest</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="function">ScopeLock <span class="title">oLock</span><span class="params">(cs)</span></span>;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼Œç•¶æˆ‘å€‘å‰›é€²å…¥ <code>ScopeLockTest</code> å‡½æ•¸çš„æ™‚å€™ï¼Œè²æ˜ç­ä¸€å€‹ <code>oLock</code> å°è±¡ï¼Œé€™å€‹æ™‚å€™é‹è¡Œ <code>oLock</code> çš„æ§‹é€ å‡½æ•¸ï¼Œä¹Ÿå°±æ˜¯é€²å…¥äº† <code>cs</code> é€™å€‹è‡¨ç•Œå€ã€‚è€Œç•¶ <code>ScopeLockTest</code> å‡½æ•¸é‹è¡Œå®Œç•¢è¦é€€å‡ºé€™å€‹å‡½æ•¸çš„æ™‚å€™ï¼Œ<code>oLock</code> å°è±¡çš„ç”Ÿå‘½é€±æœŸä¹Ÿå°±èµ°åˆ°äº†ç›¡é ­ï¼Œå°æ‡‰çš„ï¼Œå®ƒå°‡æœƒåŸ·è¡Œææ§‹å‡½æ•¸ï¼Œé‚£éº¼å°±è‡ªç„¶è€Œç„¶åœ°é€€å‡ºäº† <code>cs</code> è‡¨ç•Œå€ã€‚</p>
<p>ã€€ã€€å…¶å¯¦ç„¡è«– <code>ScopeLockTest</code> é€™å€‹å‡½æ•¸æ€éº¼å¯«ï¼Œå“ªæ€•æ˜¯ä¸­é–“æœ‰ä¸€äº› <code>if</code> åˆ¤æ–·ç›´æ¥ <code>return</code> æ‰ï¼Œåªè¦æ˜¯ <code>ScopeLockTest</code> é€™å€‹å‡½æ•¸åŸ·è¡Œå®Œç•¢ï¼Œ<code>oLock</code> å°±æœƒè‡ªå‹•ææ§‹ï¼Œå¾è€Œé”åˆ°ç­è§£é–éç¨‹ã€‚é‚£éº¼ä¸ç®¡ç²—å¿ƒé‚„æ˜¯ç´°å¿ƒçš„ç«¥é‹å€‘éƒ½ä¸ç”¨çˆ²å¿˜è¨˜é€€å‡ºè‡¨ç•Œå€è€Œç…©æƒ±äº†ã€‚</p>
<p>ã€€ã€€è€Œä¸” <code>ScopeLock</code> æ¨¡å¼åªæ˜¯ä¸€ç¨®æ€æƒ³ï¼Œä¸¦ä¸æ˜¯å°æ–¼ <strong>M$</strong> çš„è‡¨ç•Œå€çš„ä¸€ç¨®å°ˆç”¨æ€§ç‰©å“ã€‚ä¾‹å¦‚åœ¨QTè£ï¼Œæˆ‘å€‘ä¸€æ¨£å¯ä»¥ç”¨ <code>ScopeLock</code> ä¾†å°ç·šç¨‹çš„ä¸€äº› <code>MutexLock</code> ä¹‹é¡çš„æ±è¥¿é€²è¡Œæ“ä½œã€‚</p>
<p>ã€€ã€€ä¸Šé¢æ‰€å¯«çš„ä¾‹å­åªæ˜¯æ€è·¯çš„ä¸€ç¨®å½¢æˆï¼Œä¸¦ä¸æ˜¯ä¸€å€‹å®Œæ•´çš„ScopeLocké¡ï¼ˆçµæ§‹é«”ï¼‰ï¼Œé›–ç„¶èªªå®ƒç¾åœ¨å·²ç¶“å¯ä»¥ç”¨äº†ã€‚ä½ å¯ä»¥åœ¨ä¸Šé¢å®Œå–„ï¼ŒåŠ ä¸Šè‡ªå·±çš„æ±è¥¿ï¼Œä½¿å…¶èƒ½ç¢ºç¢ºå¯¦å¯¦åœ¨é …ç›®ä¸­ä½¿ç”¨ã€‚ç”±æ–¼ä»£ç¢¼çš„é—œè¯æ€§ï¼Œæˆ‘å–®å–®ç™¼å‡ºæˆ‘çš„ <code>ScopeLock</code> çš„è©±æœƒç¼ºå°‘å¾ˆå¤šé—œè¯çš„æ±è¥¿ï¼Œæ‰€ä»¥å’±å°±ä¸ç™¼äº†ï¼Œæ€è·¯åœ¨é€™è£ï¼Œç›¸ä¿¡èª°éƒ½èƒ½å¯«å‡ºè‡ªå·±çš„ä¸€å€‹ <code>ScopeLock</code> å§ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€<strong><em>å˜›ï¼Œæœ¬æ–‡æ˜¯å»ºç«‹åœ¨M$çš„Visual StudioåŸºç¤ä¸Šçš„ï¼Œlinuxâ˜­å‹¿å™´ã€‚</em></strong></p>
<p>ã€€ã€€æˆ‘æœ€å…ˆç”¨åˆ° ScopeLock æ¨¡å¼æ˜¯åœ¨è‡ªå·±é–‹ç™¼ <strong>XAEå¼•æ“</strong> çš„æ™‚å€™ã€‚åœ¨è£é¢ç”¨åˆ°æŒºå¤šçš„ç·š]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="ScopeLock" scheme="http://xcoder.in/tags/ScopeLock/"/>
    
      <category term="ç·šç¨‹å®‰å…¨" scheme="http://xcoder.in/tags/%E7%B7%9A%E7%A8%8B%E5%AE%89%E5%85%A8/"/>
    
      <category term="ç·šç¨‹æ­»é–" scheme="http://xcoder.in/tags/%E7%B7%9A%E7%A8%8B%E6%AD%BB%E9%8E%96/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CodeForces Round 128 DIV2]]></title>
    <link href="http://xcoder.in/2012/07/04/codeforces-128-div2/"/>
    <id>http://xcoder.in/2012/07/04/codeforces-128-div2/</id>
    <published>2012-07-04T03:38:59.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€é€™æ¬¡ç©è„«äº†ã€‚å¥½ä¸å®¹æ˜“å››é¡Œéƒ½åšå‡ºä¾†ï¼Œå»å› çˆ²å°ç´°ç¯€æ›äº†å…©é¡Œã€‚</p>
<h2 id="Description">Description</h2><h3 id="Two_Problems">Two Problems</h3><p>ã€€ã€€é¡Œæ„å°±æ˜¯èªªï¼ŒCFæœ‰å…©é¡Œï¼Œæ¯é¡Œåˆå§‹åˆ†Aå’ŒBï¼Œç„¶å¾Œæ¯é¡Œåœ¨æ¯åˆ†é˜æœƒæ‰£DAå’ŒDBåˆ†ã€‚çµ¦ä½ æ¯”è³½ç¸½æ™‚é–“Tï¼Œå•ä½ æŸå€‹äººå¯ä¸å¯èƒ½æ‹¿åˆ°Xåˆ†ã€‚ï¼ˆæ³¨æ„å¯èƒ½åšå‡ºä¸€é¡Œã€å…©é¡Œæˆ–è€…ä¸€é¡Œä¹Ÿæ²’åšå‡ºï¼‰</p>
<p>ã€€ã€€(0â€‰â‰¤â€‰xâ€‰â‰¤â€‰600; 1â€‰â‰¤â€‰t,â€‰a,â€‰b,â€‰da,â€‰dbâ€‰â‰¤â€‰300ä¸”ä¿è­‰åŠæ™‚æ¯”è³½æ™‚é–“åˆ°äº†å„é¡Œçš„åˆ†æ•¸ä¹Ÿä¸æœƒå°æ–¼0)</p>
<h3 id="Game_on_Paper">Game on Paper</h3><p>ã€€ã€€æœ‰ä¸€å€‹ N<em>N æ–¹æ ¼ç´™ã€‚åœ¨ä¸Šé¢çš„æ–¹æ ¼é‡Œä¸€æ ¼æ ¼å¡—é»‘ã€‚æ¯ä¸€æ­¥å¡—ä¸€æ ¼ä¸€å…±å¡— m æ¬¡ï¼Œçµ¦å®š xi å’Œ yiã€‚å•æœ€å°‘å¡—å¹¾æ­¥æ–¹æ ¼ç´™è£æœƒå‡ºç¾ä¸€å€‹ 3</em>3 çš„æ­£æ–¹å½¢ã€‚</p>
<p>ã€€ã€€(1â€‰â‰¤â€‰nâ€‰â‰¤â€‰1000, 1â€‰â‰¤â€‰mâ€‰â‰¤â€‰min(nÂ· n,â€‰105))</p>
<h3 id="Photographer">Photographer</h3><p>ã€€ã€€ç…§ç›¸å…§å­˜å¡é‡Œæœ‰då®¹é‡ã€‚å…¶ä¸­é«˜è³ªé‡ç…§ç‰‡ä½”aå®¹é‡ã€ä½è³ªé‡ä½”bå®¹é‡ã€‚ç„¶å¾Œæœ‰nå€‹é¡§å®¢ï¼Œæ¯å€‹é¡§å®¢éœ€è¦xiå¼µé«˜è³ªé‡ç…§ç‰‡å’Œyiå¼µä½è³ªé‡ç…§ç‰‡ã€‚æ”å½±å¸«å¦‚æœçµ¦ä¸€å€‹äººæ‹ç…§äº†ï¼Œå°±æ‡‰è©²æ»¿è¶³ä»–æ‰€æœ‰è¦æ±‚ï¼ˆå³çµ¦xiå¼µé«˜è³ªé‡ç…§ç‰‡å’Œyiå¼µä½è³ªé‡ç…§ç‰‡ï¼‰ã€‚å•æ”å½±å¸«æœ€å¤šèƒ½çµ¦å¹¾å€‹äººæ‹ç…§ã€‚</p>
<p>ã€€ã€€(1â€‰â‰¤â€‰nâ€‰â‰¤â€‰105,â€‰1â€‰â‰¤â€‰dâ€‰â‰¤â€‰109, 1â€‰â‰¤â€‰aâ€‰â‰¤â€‰bâ€‰â‰¤â€‰104, 0â€‰â‰¤â€‰xi,â€‰yiâ€‰â‰¤â€‰105)</p>
<h3 id="Hit_Ball">Hit Ball</h3><p>ã€€ã€€å°é–‰æˆ¿é–“è£ï¼Œå¾æˆ¿é–“çš„ä¸€é ­æœ€åº•ä¸‹çš„ä¸­é–“ä»¥æŸå€‹æ–¹å‘è¸¢çƒï¼ˆä¸€å®šæ˜¯ç¶²å°é¢è¸¢ï¼‰ï¼Œå•è¸¢åˆ°å¦ä¸€é ­çš„ç‰†ä¸Šçš„æ™‚å€™ï¼Œxã€zå„æ˜¯å¤šå°‘ã€‚</p>
<p>ã€€ã€€(å„åº§æ¨™ä»¥åŠå‘é‡éƒ½æ˜¯å°æ–¼ç­‰æ–¼100çš„æ­£æ•´æ•¸)</p>
<p><img src="hit-ball.png" alt="Hit Ball"></p>
<h3 id="Transportation">Transportation</h3><p>ã€€ã€€é‚„æ²’çœ‹ã€‚</p>
<h2 id="Analysis">Analysis</h2><h3 id="Two_Problems-1">Two Problems</h3><p>ã€€ã€€é€™é¡Œåªè¦æ³¨æ„å¹¾å€‹trickå°±è¡Œäº†ï¼šå¯ä»¥åšå‡º0é¡Œã€1é¡Œæˆ–è€…2é¡Œã€‚ç›´æ¥å…©å€‹foræšèˆ‰å„é¡Œåœ¨å¹¾åˆ†é˜å…§åšå‡ºä¾†ï¼Œç„¶å¾Œåšä¸€ä¸‹0é¡Œã€1é¡Œçš„ç‰¹æ®Šåˆ¤æ–·å°±å¥½äº†ã€‚</p>
<h3 id="Game_on_Paper-1">Game on Paper</h3><p>ã€€ã€€åœ¨æ¯æ¬¡å¡—çš„æ™‚å€™ï¼Œä»¥ç•¶å‰å¡—çš„é»ä½ä¸­å¿ƒï¼Œè¨­å®ƒçˆ²ä¹å®®æ ¼çš„å…¶ä¸­ä¸€å€‹ä½ç½®ï¼ˆä¸€å…±ä¹ç¨®ä½ç½®ï¼‰ï¼Œå°æ–¼æ¯ç¨®ä½ç½®ï¼Œéƒ½åˆ¤æ–·å…¶å°æ‡‰çš„ä¹å®®æ ¼æ˜¯ä¸æ˜¯ 3*3 çš„é»‘è‰²å°±å¥½äº†ã€‚(æˆ‘åšçš„æ™‚å€™åœ¨è¨­ä½ç½®çš„æ™‚å€™ x - 1, y - 1 æ‰‹è³¤æ•²æˆäº† x - 1, y - 2ï¼Œlock ä¹‹å¾Œæ‰ç™¼ç¾ã€‚æ‚²åŠ‡)</p>
<h3 id="Photographer-1">Photographer</h3><p>ã€€ã€€è²ªå¿ƒã€‚å°æ–¼æ¯å€‹äººå°‡å…¶æ‰€éœ€çš„ç¸½å®¹é‡ç®—å‡ºä¾†å†é€²è¡Œéå¢æ’åºã€‚æœ€å¾Œæ±‚çš„æ™‚å€™æ¨è–¦ç´¯æ¸›çš„æ–¹å¼åˆ¤æ–·ï¼Œå› çˆ²æˆ‘ç´¯åŠ ç„¶å¾Œç”¨ int æœ€å¾Œçˆ†ç¯„åœäº†ã€‚</p>
<h3 id="Hit_Ball-1">Hit Ball</h3><p>ã€€ã€€é¦–å…ˆæ‹¿å‡ºç©ºé–“å¹¾ä½•çš„ç·šé¢ç›¸äº¤æ¨¡æ¿ã€‚ç„¶å¾Œä¾†ä¸€å€‹ <code>while</code>ï¼Œæ¯æ¬¡å¾ªç’°çš„æ™‚å€™åˆ¤æ–·ç•¶å‰æ‰€åœ¨çš„é»èˆ‡æ–¹å‘é©é‡å½¢æˆçš„ç›´ç·šèˆ‡ (X, 0, Z) é¢çš„äº¤é»åœ¨ä¸åœ¨çµ‚é»ç‰†å£å¤§å°çš„ç¯„åœå…§ã€‚è‹¥ä¸æ˜¯å‰‡èªªæ˜ä¸­é€”æ’ç‰†äº†åˆ¤æ–·æ–¹å‘å‘é‡ï¼šx &lt; 0å‰‡ç·šé¢ç›¸äº¤åˆ¤æ–·æ˜¯ä¸æ˜¯æ’å·¦ç‰†ï¼Œè‹¥æ˜¯å‰‡ x æ­£è² å€¼è®Šä¸€ä¸‹ï¼›x &gt; 0 å‰‡ç·šé¢ç›¸äº¤åˆ¤æ–·æ˜¯ä¸æ˜¯æ’å³ç‰†ï¼Œè‹¥æ˜¯å‰‡ x æ­£è² å€¼è®Šä¸€ä¸‹ã€‚z &lt; 0å‰‡åˆ¤æ–·æ˜¯ä¸æ˜¯ä»¥æ±‚æ¶åœ°ï¼Œè‹¥æ˜¯å‰‡ z æ­£è² è®Šä¸€ä¸‹ã€‚æœ€å¾Œ z &gt; 0 å‰‡åˆ¤æ–·æ˜¯ä¸æ˜¯æ’å¤©èŠ±æ¿ï¼Œè‹¥æ˜¯å‰‡zæ­£è² å€¼è®Šä¸€ä¸‹ã€‚ç„¶å¾Œä»¥çƒæ’æ“Šçš„é»çˆ²æ–°çš„èµ·é»ï¼Œèˆ‡æ–°çš„æ–¹å‘å‘é‡å½¢æˆæ–°çš„ç›´ç·šï¼Œç¹¼çºŒä¸‹ä¸€æ¬¡å¾ªç’°ã€‚å› çˆ²æˆ¿é–“å¤§å°æœ€å¤§æ˜¯ 100 <em> 100 </em> 100ï¼Œè€Œæ–¹å‘å‘é‡å„æ–¹å‘æ˜¯ 1 åˆ° 100 çš„æ•´æ•¸ï¼Œä¸æ˜¯å°æ•¸ï¼Œå‰‡æ’æ“Šæ¬¡æ•¸ä¸æœƒå¾ˆå¤šï¼Œç›´æ¥ <code>while</code> æ’æ“Šä¹Ÿä¸æœƒè¶…ã€‚</p>
<h2 id="Code">Code</h2><h3 id="Two_Problems-2">Two Problems</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, t, a, b, da, db;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d%d%d"</span>, &amp;x, &amp;t, &amp;a, &amp;b, &amp;da, &amp;db))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; t; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(x == a - i * da)</span><br><span class="line">            &#123;</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; t; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(x == b - j * db)</span><br><span class="line">                &#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(x == a - i * da + b - j * db)</span><br><span class="line">                &#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(flag) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span> == x) flag = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, flag ? <span class="string">"YES"</span> : <span class="string">"NO"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Game_on_Paper-2">Game on Paper</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> mat[<span class="number">1015</span>][<span class="number">1015</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check2</span><span class="params">(<span class="keyword">int</span> sx, <span class="keyword">int</span> sy)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//if(i == 1 &amp;&amp; j == 1) continue;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!mat[sx + i][sy + j]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(check2(x, y)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x, y - <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x, y - <span class="number">2</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">1</span>, y)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">1</span>, y - <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">1</span>, y - <span class="number">2</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">2</span>, y)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">2</span>, y - <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">2</span>, y - <span class="number">2</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="keyword">int</span> x, y;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> ans = -<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(mat, <span class="number">0</span>, <span class="keyword">sizeof</span>(mat));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">            mat[x + <span class="number">1</span>][y + <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(ans == -<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(check(x + <span class="number">1</span>, y + <span class="number">1</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    ans = i + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Photographer-2">Photographer</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> client</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">int</span> memo;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(client a, client b)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.memo &lt; b.memo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">client c[<span class="number">100005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    __int64 d;</span><br><span class="line">    <span class="keyword">int</span> a, b;</span><br><span class="line">    <span class="keyword">int</span> x, y;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d%I64d"</span>, &amp;n, &amp;d))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;a, &amp;b);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">            c[i].id = i + <span class="number">1</span>;</span><br><span class="line">            c[i].memo = a * x + b * y;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sort(c, c + n, cmp);</span><br><span class="line">        __int64 sum = <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">int</span> maxi = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(sum + c[i].memo &lt;= d) sum += c[i].memo, maxi = i;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, maxi + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= maxi; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, c[i].id, i == maxi ? <span class="string">'\n'</span> : <span class="string">' '</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Hit_Ball-2">Hit Ball</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> eps <span class="number">1e-8</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> zero(x) (((x)&gt;<span class="number">0</span>?(x):-(x))&lt;eps)</span></span><br><span class="line"><span class="keyword">struct</span> point3&#123;<span class="keyword">double</span> x,y,z;&#125;;</span><br><span class="line"><span class="keyword">struct</span> line3&#123;point3 a,b;&#125;;</span><br><span class="line"><span class="keyword">struct</span> plane3&#123;point3 a,b,c;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">point3 <span class="title">xmult</span><span class="params">(point3 u,point3 v)</span></span>&#123;</span><br><span class="line">    point3 ret;</span><br><span class="line">    ret.x=u.y*v.z-v.y*u.z;</span><br><span class="line">    ret.y=u.z*v.x-u.x*v.z;</span><br><span class="line">    ret.z=u.x*v.y-u.y*v.x;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">point3 <span class="title">subt</span><span class="params">(point3 u,point3 v)</span></span>&#123;</span><br><span class="line">    point3 ret;</span><br><span class="line">    ret.x=u.x-v.x;</span><br><span class="line">    ret.y=u.y-v.y;</span><br><span class="line">    ret.z=u.z-v.z;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">point3 <span class="title">pvec</span><span class="params">(plane3 s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> xmult(subt(s.a,s.b),subt(s.b,s.c));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">point3 <span class="title">intersection</span><span class="params">(line3 l,plane3 s)</span></span>&#123;</span><br><span class="line">    point3 ret=pvec(s);</span><br><span class="line">    <span class="keyword">double</span> t=(ret.x*(s.a.x-l.a.x)+ret.y*(s.a.y-l.a.y)+ret.z*(s.a.z-l.a.z))/</span><br><span class="line">        (ret.x*(l.b.x-l.a.x)+ret.y*(l.b.y-l.a.y)+ret.z*(l.b.z-l.a.z));</span><br><span class="line">    ret.x=l.a.x+(l.b.x-l.a.x)*t;</span><br><span class="line">    ret.y=l.a.y+(l.b.y-l.a.y)*t;</span><br><span class="line">    ret.z=l.a.z+(l.b.z-l.a.z)*t;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a, b, m;</span><br><span class="line">    <span class="keyword">double</span> vx, vy, vz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%lf%lf%lf%lf%lf%lf"</span>, &amp;a, &amp;b, &amp;m, &amp;vx, &amp;vy, &amp;vz))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/** 5 walls */</span></span><br><span class="line">        plane3 door, lw, rw, top, ground;</span><br><span class="line">        door.a.x = <span class="number">0</span>, door.a.y = <span class="number">0</span>, door.a.z = <span class="number">0</span>;</span><br><span class="line">        door.b.x = <span class="number">1</span>, door.b.y = <span class="number">0</span>, door.b.z = <span class="number">0</span>;</span><br><span class="line">        door.c.x = <span class="number">0</span>, door.c.y = <span class="number">0</span>, door.c.z = <span class="number">1</span>;</span><br><span class="line">        lw.a.x = <span class="number">0</span>, lw.a.y = <span class="number">0</span>, lw.a.z = <span class="number">0</span>;</span><br><span class="line">        lw.b.x = <span class="number">0</span>, lw.b.y = <span class="number">1</span>, lw.b.z = <span class="number">0</span>;</span><br><span class="line">        lw.c.x = <span class="number">0</span>, lw.c.y = <span class="number">0</span>, lw.c.z = <span class="number">1</span>;</span><br><span class="line">        rw.a.x = a, rw.a.y = <span class="number">0</span>, rw.a.z = <span class="number">0</span>;</span><br><span class="line">        rw.b.x = a, rw.b.y = <span class="number">1</span>, rw.b.z = <span class="number">0</span>;</span><br><span class="line">        rw.c.x = a, rw.c.y = <span class="number">0</span>, rw.c.z = <span class="number">1</span>;</span><br><span class="line">        ground.a.x = <span class="number">0</span>, ground.a.y = <span class="number">0</span>, ground.a.z = <span class="number">0</span>;</span><br><span class="line">        ground.b.x = a, ground.b.y = <span class="number">0</span>, ground.b.z = <span class="number">0</span>;</span><br><span class="line">        ground.c.x = a / <span class="number">2</span>, ground.c.y = m, ground.c.z = <span class="number">0</span>;</span><br><span class="line">        top.a.x = <span class="number">0</span>, top.a.y = <span class="number">0</span>, top.a.z = b;</span><br><span class="line">        top.b.x = a, top.b.y = <span class="number">0</span>, top.b.z = b;</span><br><span class="line">        top.c.x = a / <span class="number">2</span>, top.c.y = m, top.c.z = b;</span><br><span class="line"></span><br><span class="line">        line3 l;</span><br><span class="line"></span><br><span class="line">        l.a.x = a / <span class="number">2</span>;</span><br><span class="line">        l.a.y = m;</span><br><span class="line">        l.a.z = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        l.b.x = (a / <span class="number">2</span>) + vx;</span><br><span class="line">        l.b.y = m + vy;</span><br><span class="line">        l.b.z = vz;</span><br><span class="line"></span><br><span class="line">        point3 v;</span><br><span class="line">        v.x = vx, v.y = vy, v.z = vz;</span><br><span class="line"></span><br><span class="line">        point3 myans;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            point3 ans, ans1, ans2, ans3, ans4;</span><br><span class="line">            <span class="built_in">memset</span>(&amp;ans1, <span class="number">0</span>, <span class="keyword">sizeof</span>(point3));</span><br><span class="line">            <span class="built_in">memset</span>(&amp;ans2, <span class="number">0</span>, <span class="keyword">sizeof</span>(point3));</span><br><span class="line">            <span class="built_in">memset</span>(&amp;ans3, <span class="number">0</span>, <span class="keyword">sizeof</span>(point3));</span><br><span class="line">            <span class="built_in">memset</span>(&amp;ans4, <span class="number">0</span>, <span class="keyword">sizeof</span>(point3));</span><br><span class="line"></span><br><span class="line">            ans = intersection(l, door);</span><br><span class="line">            <span class="keyword">if</span>(ans.x &gt;= <span class="number">0</span> &amp;&amp; ans.z &gt;= <span class="number">0</span> &amp;&amp; ans.x &lt;= a &amp;&amp; ans.z &lt;= b)</span><br><span class="line">            &#123;</span><br><span class="line">                myans = ans;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            point3 totans;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(v.x &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ans1 = intersection(l, lw);</span><br><span class="line">                <span class="keyword">if</span>(ans1.z &gt;= <span class="number">0</span> &amp;&amp; ans1.z &lt;= b)</span><br><span class="line">                &#123;</span><br><span class="line">                    v.x = -v.x;</span><br><span class="line">                    totans = ans1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span>(v.x &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ans2 = intersection(l, rw);</span><br><span class="line">                <span class="keyword">if</span>(ans2.z &gt;= <span class="number">0</span> &amp;&amp; ans2.z &lt;= b)</span><br><span class="line">                &#123;</span><br><span class="line">                    v.x = -v.x;</span><br><span class="line">                    totans = ans2;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(v.z &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ans3 = intersection(l, top);</span><br><span class="line">                <span class="keyword">if</span>(ans3.x &gt;= <span class="number">0</span> &amp;&amp; ans3.x &lt;= a)</span><br><span class="line">                &#123;</span><br><span class="line">                    v.z = -v.z;</span><br><span class="line">                    totans = ans3;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span>(v.z &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ans4 = intersection(l, ground);</span><br><span class="line">                <span class="keyword">if</span>(ans4.x &gt;= <span class="number">0</span> &amp;&amp; ans4.x &lt;= a)</span><br><span class="line">                &#123;</span><br><span class="line">                    v.z = -v.z;</span><br><span class="line">                    totans = ans4;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            l.a = totans;</span><br><span class="line">            l.b = totans;</span><br><span class="line">            l.b.x += v.x;</span><br><span class="line">            l.b.y += v.y;</span><br><span class="line">            l.b.z += v.z;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%.10lf %.10lf\n"</span>, myans.x, myans.z);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€é€™æ¬¡ç©è„«äº†ã€‚å¥½ä¸å®¹æ˜“å››é¡Œéƒ½åšå‡ºä¾†ï¼Œå»å› çˆ²å°ç´°ç¯€æ›äº†å…©é¡Œã€‚</p>
<h2 id="Description">Description</h2><h3 id="Two_Problems">Two Problems</h3><p>ã€€ã€€é¡Œæ„å°±æ˜¯èªªï¼ŒCFæœ‰å…©é¡Œï¼Œæ¯é¡Œåˆå§‹åˆ†Aå’ŒBï¼Œ]]>
    </summary>
    
      <category term="CodeForces" scheme="http://xcoder.in/tags/CodeForces/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[HGEåšæ ¼é¬¥éŠæˆ²çš„ç†±é»åœ–ç‰‡ç¢°æ’æª¢æ¸¬æ³•]]></title>
    <link href="http://xcoder.in/2011/10/18/hge-hotspot-collision/"/>
    <id>http://xcoder.in/2011/10/18/hge-hotspot-collision/</id>
    <published>2011-10-18T07:22:21.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€ç¢°æ’æª¢æ¸¬å§‹çµ‚æ˜¯åš2DéŠæˆ²ä¸­çš„ä¸€å€‹ç†±é»è©±é¡Œï¼Œæˆ‘æœ¬äººä¸¦æ²’æœ‰åšéé€™é¡éŠæˆ²ï¼Œæ‰€ä»¥ä¸€åˆ‡åªæ˜¯ç†è«–è€Œå·²ï¼Œä¸éæ­£æ‰“ç®—åšé€™éº¼å€‹å°éŠæˆ²ç·´ç·´æ‰‹ã€‚</p>
<p>ã€€ã€€å‰å¹¾å¤©åœ¨HGEçš„ç¾£è£çœ‹åˆ°æœ‰äººçªç„¶å•åˆ°å¦‚ä½•åˆ¤æ–·é¼ æ¨™æœ‰æ²’æœ‰é»åˆ°äººï¼ˆé»åˆ°ç´‹ç†çš„é€æ˜å€åŸŸä¸ç®—ï¼‰ï¼Œå¾è€Œå¼•ç”³å‡ºäº†ç¢°æ’æª¢æ¸¬å•é¡Œã€‚</p>
<p>ã€€ã€€ä»–çš„å•é¡Œç›¸å°å¥½å¯¦ç¾ï¼Œåªè¦ç®—å‡ºç´‹ç†æ‰€æŒ‰çš„é»æ˜¯ä¸æ˜¯é€æ˜å³å¯ã€‚</p>
<p>ã€€ã€€æ¥ä¸‹ä¾†æˆ‘å¾—åšä¸‹ç¢°æ’æª¢æ¸¬çš„ç­†è¨˜ï¼š</p>
<p>ã€€ã€€ç¢°æ’æª¢æ¸¬æœ€å¸¸ç”¨ä¸€å€‹æ–¹æ³•å°±æ˜¯é—œç¯€è¨­ç½®ï¼ˆç•¶ç„¶æˆ‘ä¸¦æ²’æœ‰åšéï¼‰ï¼Œé—œç¯€è¨­ç½®çš„è©±å› çˆ²åªæ˜¯åˆ¤æ–·å¤šé‚Šå½¢çš„é‡ç–Šç‹€æ³ï¼Œç®—æ³•çš„è¤‡é›œåº¦ä½ã€æ•ˆç‡é«˜ï¼Œé›–ç„¶åšå·¥æœ‰é»ç²—ï¼Œä½†ç¸½é«”æ•ˆæœé‚„æ˜¯æ€§åƒ¹æ¯”æ¯”è¼ƒé«˜çš„ä¸€ç¨®æ–¹æ³•ã€‚ç•¶ç„¶ï¼Œé€™æ¨£çš„æ–¹æ³•éœ€è¦å°æ¯ä¸€å¹€çš„ç´‹ç†éƒ½è¨­ç½®ä¸€å€‹é—œç¯€ï¼Œå°æ–¼äººå·¥çš„ä»£åƒ¹å°±ç¨å¾®å¤§äº†ä¸€äº›äº†ï¼Œä¸¦ä¸”é‚„è¦å¯«å€‹é—œç¯€ç·¨è¼¯å™¨å•Šç¥é¦¬çš„ï¼Œæ–¼æ˜¯ä¹ä»£ç¢¼é‡åˆå¢åŠ äº†ã€‚æˆ‘é€™æ¬¡æ˜¯å’ŒåŒå¯¢å®¤æœ¨æœ‰ä¸€é»åŸºç¤çš„ç«¥é‹ä¸€èµ·ç·´æ‰‹çš„ï¼Œæ‰€ä»¥ä¸¦æ²’æœ‰æ‰“ç®—å¼•é€²é€™å€‹æ–¹æ³•ã€‚</p>
<p>ã€€ã€€æ–¼æ˜¯æˆ‘å°±ç”¨äº†å¦ä¸€ç¨®ç¨å¾®â€œéä¸»æµâ€ä¸€äº›çš„æ–¹æ³•äº†â€”â€”é€åƒç´ åˆ¤æ–·ã€‚</p>
<p>ã€€ã€€ä½†æ˜¯é€åƒç´ åˆ¤æ–·é‚„æ˜¯æœ‰å•é¡Œçš„â€”â€”å¦‚æœä½ çš„ä¸€å€‹â€œæ•ˆæœâ€å› çˆ²â€œæº«åº¦éé«˜â€è€Œä¸éœ€è¦é¡¯ç¤ºï¼Œç›´æ¥éš±è—ï¼Œä½†åˆç®—å‚·å®³ï¼Œé€™æ™‚ç´‹ç†çš„é€åƒç´ å°±å¤±å»äº†æ„ç¾©ã€‚æ–¼æ˜¯åˆæœ‰äº†å€‹â€œè‡ƒè…«â€çš„è¾¦æ³•ï¼Œçˆ²éœ€è¦â€œé¡å¤–é™„åŠ åƒç´ â€çš„ç´‹ç†å¦åšä¸€å¼µåœ–ç‰‡ï¼Œé€™å¼µåœ–ç‰‡ä¸Šæœ‰å…©ç¨®å€åŸŸâ€”â€”ç†±é»å€å’Œéç†±é»å€ã€‚æˆ‘å€‘æŠŠéœ€è¦â€œç•¶åšç©ºæ°£â€çš„é‚£äº›å€åŸŸä¸€å¾‹ç”¨æŸä¸€ç¨®æ¥µå…¶ä¸å¸¸ç”¨çš„é¡è‰²è¦†è“‹ï¼Œå¦‚ <code>ff00ff</code> é€™ç¨®è®Šæ…‹çš„ç²‰è‰²ï¼Œç„¶å¾Œå…¶å®ƒå€åŸŸçš„é¡è‰²å°±éš¨ä½ æ€éº¼æäº†ã€‚æˆ‘å€‘è¼‰å…¥çš„æ™‚å€™å…©å¼µç´‹ç†ä¸€èµ·è¼‰å…¥ï¼Œé¡¯ç¤ºçš„æ™‚å€™é¡¯ç¤ºæ­£å¸¸çš„ç´‹ç†ï¼Œè€Œåœ¨ç¢°æ’æª¢æ¸¬çš„æ™‚å€™ç”¨â€œç†±é»åœ–ç‰‡â€ä¾†é€²è¡Œé€åƒç´ æª¢æ¸¬ã€‚</p>
<p>ã€€ã€€èˆ‡ä¸Šé¢çš„é—œç¯€è¨­ç½®æ³•æ¯”è¼ƒçš„è©±ï¼Œäººå·¥çš„å·¥ä½œé‡æˆ‘å€‹äººèªçˆ²æ˜¯å¤§å¤§åœ°æ¸›å°‘äº†ï¼Œè‡³æ–¼å°æ–¼æ©Ÿå™¨çš„åŸ·è¡Œèƒ½åŠ›ä¾†èªªï¼ŒæŠŠæ™‚é–“è¤‡é›œåº¦æåˆ°äº† <code>O(mn)</code> ï¼Œå¹³æ–¹ç´šçš„è¤‡é›œåº¦äº†ï¼Œå³ç´‹ç†ç›¸äº¤å€åŸŸçš„å¯¬å’Œé«˜ã€‚</p>
<p>ã€€ã€€æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹é€™ç¨®ç¢°æ’æª¢æ¸¬çš„å¤§é«”æµç¨‹å§ï¼š</p>
<ol>
<li>ç²å¾—å…©å€‹ç²¾éˆçš„çŸ©å½¢ï¼Œä¸¦å¾—åˆ°ç›¸äº¤çŸ©å½¢ã€‚è‹¥ç„¡ç›¸äº¤å‰‡ç›´æ¥è¿”å› <code>false</code>ã€‚</li>
<li>æ ¹æ“šç›¸äº¤çŸ©å½¢ï¼Œæˆ‘å€‘å¯ä»¥å¾—åˆ°ç²¾éˆ1ã€2çš„ç´‹ç†ä¸­éœ€è¦æª¢æ¸¬çš„åˆå§‹åº§æ¨™ã€‚</li>
<li>å°‡ç²¾éˆ1ã€ç²¾éˆ2çš„ç†±é»åœ–ç‰‡çš„ç›¸äº¤å€åŸŸçš„é‚£ä¸€éƒ¨åˆ†åƒç´ æ‹·è²å‡ºä¾†å‚™ç”¨ã€‚ï¼ˆå› çˆ²æœ‰å¯èƒ½å…©å€‹ç´‹ç†å¥æŸ„æ˜¯ä¸€æ¨£çš„ï¼Œä¸å¥½åŒæ™‚ <code>lock</code>ï¼‰</li>
<li>é–‹å§‹å°æ–¼æ‹·è²å‡ºä¾†çš„åƒç´ ä¿¡æ¯é€ä¸€åˆ¤æ–·å°æ‡‰åƒç´ é»æ˜¯å¦éƒ½â€œä¸æ˜¯ç©ºæ°£â€ï¼Œè‹¥éƒ½â€œä¸æ˜¯ç©ºæ°£â€å‰‡å¯ä»¥åˆ¤æ–·çˆ²ç¢°æ’ã€‚</li>
</ol>
<p>ã€€ã€€ç•¶ç„¶ä»¥ä¸Šçš„æµç¨‹æˆ‘å€‘é‚„å¯ä»¥å„ªåŒ–ä¸€ä¸‹ï¼Œçœå»æ‹·è²çš„é‚£ä¸€æ®µæ™‚é–“ã€‚æˆ‘å€‘å¯ä»¥ç›´æ¥ <code>hge-&gt;Texture_Lock()</code> ä¾†é€²è¡Œå¾—åˆ°å…©å€‹ç´‹ç†çš„åƒç´ ä¿¡æ¯çš„é¦–æŒ‡é‡ï¼Œå¦‚æœå…©å€‹ç´‹ç†å…¶å¯¦åªæ˜¯ä¸€å€‹ç´‹ç†çš„è©±ï¼Œå‰‡åªéœ€ <code>hge-&gt;Texture_Lock()</code> ä¸€æ¬¡ï¼Œè€Œå¦ä¸€å€‹æŒ‡é‡ä¹Ÿåªæƒ³ <code>hge-&gt;Texture_Lock</code> å³å¯ï¼Œç„¶å¾Œç›´æ¥é–‹å§‹åˆ¤æ–·ã€‚</p>
<p>ã€€ã€€ä¸‹é¢ç»ä¸Šæˆ‘é€™å€‹å‡½æ•¸çš„å¯¦ç¾ä»¥åŠæ¸¬è©¦ä»£ç¢¼å’Œç´ æï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief   Test the collision by the "hot" texture</span><br><span class="line"> * @author  XadillaX</span><br><span class="line"> * @email   admin@xcoder.in</span><br><span class="line"> * @date    2011/10/18</span><br><span class="line"> * @http://xcoder.in</span><br><span class="line"> *</span><br><span class="line"> * @param spr1 The first sprite to test the collision</span><br><span class="line"> * @param x1 "x" of top-left corner of sprite 1</span><br><span class="line"> * @param y1 "y" of top-left corner of sprite 1</span><br><span class="line"> * @param spr2 The second sprite to test the collision</span><br><span class="line"> * @param x2 "x" of top-left corner of sprite 2</span><br><span class="line"> * @param y2 "y" of top-left corner of sprite 2</span><br><span class="line"> * @param hot1 The "hot" texture for sprite 1. It will be the default texture of spr1 if it equal to 0</span><br><span class="line"> * @param hot2 The "hot" texture for sprite 2. It will be the default texture of spr2 if it equal to 0</span><br><span class="line"> * @param airColor The color which considered of "air"</span><br><span class="line"> *</span><br><span class="line"> * @return if they are collided, return true</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsCollision</span><span class="params">(hgeSprite* spr1, <span class="keyword">float</span> x1, <span class="keyword">float</span> y1, hgeSprite* spr2, <span class="keyword">float</span> x2, <span class="keyword">float</span> y2, HTEXTURE hot1 = <span class="number">0</span>, HTEXTURE hot2 = <span class="number">0</span>, DWORD airColor = <span class="number">0xffff00ff</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** Set the rect */</span></span><br><span class="line">    hgeRect r1, r2;</span><br><span class="line">    r1.Set(x1, y1, x1 + spr1-&gt;GetWidth(), y1 + spr1-&gt;GetHeight());</span><br><span class="line">    r2.Set(x2, y2, x2 + spr2-&gt;GetWidth(), y2 + spr2-&gt;GetHeight());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Test for the intersect of rectangles */</span></span><br><span class="line">    <span class="keyword">if</span>(r1.Intersect(&amp;r2))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> x[] = &#123; x1, x2, x1 + spr1-&gt;GetWidth(), x2 + spr2-&gt;GetWidth() &#125;;</span><br><span class="line">        <span class="keyword">int</span> y[] = &#123; y1, y2, y1 + spr1-&gt;GetHeight(), y2 + spr2-&gt;GetHeight() &#125;;</span><br><span class="line">        <span class="built_in">std</span>::sort(x, x + <span class="number">4</span>);</span><br><span class="line">        <span class="built_in">std</span>::sort(y, y + <span class="number">4</span>);</span><br><span class="line">        hgeRect r;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Set the rectangle area where the two rectangles intersected. */</span></span><br><span class="line">        r.Set(x[<span class="number">1</span>], y[<span class="number">1</span>], x[<span class="number">2</span>], y[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** The start point of sprite1 and sprite2. (From the intersected area) */</span></span><br><span class="line">        <span class="keyword">int</span> sx1, sy1, sx2, sy2;</span><br><span class="line">        sx1 = x[<span class="number">1</span>] - x1;</span><br><span class="line">        sy1 = y[<span class="number">1</span>] - y1;</span><br><span class="line">        sx2 = x[<span class="number">1</span>] - x2;</span><br><span class="line">        sy2 = y[<span class="number">1</span>] - y2;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Get the "hotspot" of texture */</span></span><br><span class="line">        HTEXTURE hTex1 = hot1;</span><br><span class="line">        HTEXTURE hTex2 = hot2;</span><br><span class="line">        <span class="keyword">if</span>(hTex1 == <span class="number">0</span>) hTex1 = spr1-&gt;GetTexture();</span><br><span class="line">        <span class="keyword">if</span>(hTex2 == <span class="number">0</span>) hTex2 = spr2-&gt;GetTexture();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> tx1, ty1, tw1, th1, tx2, ty2, tw2, th2;</span><br><span class="line">        <span class="keyword">int</span> w1 = hge-&gt;Texture_GetWidth(hTex1), w2 = hge-&gt;Texture_GetWidth(hTex2);</span><br><span class="line">        spr1-&gt;GetTextureRect(&amp;tx1, &amp;ty1, &amp;tw1, &amp;th1);</span><br><span class="line">        spr2-&gt;GetTextureRect(&amp;tx2, &amp;ty2, &amp;tw2, &amp;th2);</span><br><span class="line"></span><br><span class="line">        DWORD* color1 = <span class="keyword">new</span> DWORD[(x[<span class="number">2</span>] - x[<span class="number">1</span>]) * (y[<span class="number">2</span>] - y[<span class="number">1</span>])];</span><br><span class="line">        DWORD* color2 = <span class="keyword">new</span> DWORD[(x[<span class="number">2</span>] - x[<span class="number">1</span>]) * (y[<span class="number">2</span>] - y[<span class="number">1</span>])];</span><br><span class="line">        DWORD* color;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Copy the effectivearea of texture 1 */</span></span><br><span class="line">        color = hge-&gt;Texture_Lock(hTex1, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; y[<span class="number">2</span>] - y[<span class="number">1</span>]; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x[<span class="number">2</span>] - x[<span class="number">1</span>]; j++)</span><br><span class="line">            &#123; </span><br><span class="line">                color1[i * (x[<span class="number">2</span>] - x[<span class="number">1</span>]) + j] = color[((<span class="keyword">int</span>)ty1 + sy1) * w1 + (<span class="keyword">int</span>)tx1 + sx1 + i * w1 + j];</span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        hge-&gt;Texture_Unlock(hTex1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Copy the effectivearea of texture 2 */</span></span><br><span class="line">        color = hge-&gt;Texture_Lock(hTex2, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; y[<span class="number">2</span>] - y[<span class="number">1</span>]; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x[<span class="number">2</span>] - x[<span class="number">1</span>]; j++) </span><br><span class="line">            &#123; </span><br><span class="line">                color2[i * (x[<span class="number">2</span>] - x[<span class="number">1</span>]) + j] = color[((<span class="keyword">int</span>)ty2 + sy2) * w2 + (<span class="keyword">int</span>)tx2 + sx2 + i * w1 + j]; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        hge-&gt;Texture_Unlock(hTex2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Test for the collision */</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; y[<span class="number">2</span>] - y[<span class="number">1</span>]; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x[<span class="number">2</span>] - x[<span class="number">1</span>]; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(color1[i * (x[<span class="number">2</span>] - x[<span class="number">1</span>]) + j] != airColor &amp;&amp; color2[i * (x[<span class="number">2</span>] - x[<span class="number">1</span>]) + j] != airColor)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">delete</span> []color1;</span><br><span class="line">                    <span class="keyword">delete</span> []color2;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span> []color1;</span><br><span class="line">        <span class="keyword">delete</span> []color2;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="src.rar">é»æ“Šä¸‹è¼‰</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€ç¢°æ’æª¢æ¸¬å§‹çµ‚æ˜¯åš2DéŠæˆ²ä¸­çš„ä¸€å€‹ç†±é»è©±é¡Œï¼Œæˆ‘æœ¬äººä¸¦æ²’æœ‰åšéé€™é¡éŠæˆ²ï¼Œæ‰€ä»¥ä¸€åˆ‡åªæ˜¯ç†è«–è€Œå·²ï¼Œä¸éæ­£æ‰“ç®—åšé€™éº¼å€‹å°éŠæˆ²ç·´ç·´æ‰‹ã€‚</p>
<p>ã€€ã€€å‰å¹¾å¤©åœ¨HGEçš„ç¾£è£çœ‹åˆ°æœ‰äººçªç„¶å•åˆ°å¦‚ä½•åˆ¤æ–·é¼ æ¨™æœ‰æ²’æœ‰é»åˆ°äººï¼ˆé»åˆ°ç´‹ç†çš„é€æ˜å€åŸŸä¸ç®—ï¼‰ï¼Œå¾è€Œå¼•ç”³å‡ºäº†ç¢°æ’æª¢æ¸¬å•é¡Œã€‚</p>
<p]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="HGE" scheme="http://xcoder.in/tags/HGE/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[é—œæ–¼HGEçš„é€æ˜èƒŒæ™¯è™•ç†]]></title>
    <link href="http://xcoder.in/2011/09/13/hge-transparent-color/"/>
    <id>http://xcoder.in/2011/09/13/hge-transparent-color/</id>
    <published>2011-09-13T04:12:32.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€å˜› = = åœ¨åšé‚£å€‹é …ç›®çš„å‹•ç•«é è¦½å™¨çš„æ™‚å€™ï¼Œå› çˆ²é‚£å¼•æ“å°è£å¾—å¤ªéº»ç…©äº†ï¼Œæ–¼æ˜¯è‡ªå·±åŸºæ–¼HGEå†ç§»æ¤ä¸€éï¼Œç™¼ç¾å…¶ä¸­æœ‰ä¸€å€‹SetTransparentColorå‡½æ•¸ï¼Œå³è¨­ç½®é€æ˜è‰²ã€‚</p>
<p>ã€€ã€€æ‹¿å‡ºä¾†åˆ†äº«ä¸€ä¸‹å§ã€‚</p>
<p>ã€€ã€€å…¶å¯¦æ–¹æ³•å¾ˆç°¡å–®ï¼Œ<code>HTEXTURE</code> æ˜¯ç´‹ç†å¥æŸ„ï¼Œç•¶ä½ ç”¨ <code>Texture_Lock</code> é€™å€‹å‡½æ•¸é–å®šé€™å€‹ç´‹ç†çš„æ™‚å€™ï¼Œå®ƒçš„è¿”å›å€¼å°±æ˜¯é€™å€‹ç´‹ç†åœ¨å…§å­˜ä¸­çš„é¦–åœ°å€ã€‚ä¹Ÿå°±æ˜¯èªªæ¥ä¸‹ä¾†çš„ width * height å€‹åœ°å€ä¸­å°±æ˜¯é€™å€‹ç´‹ç†çš„æ¯ä¸€å€‹åƒç´ äº†ã€‚æ—¢ç„¶è¦è¨­ç½®é€æ˜è‰²ï¼Œåªè¦å°æ–¼æ¯å€‹åƒç´ åˆ¤æ–·ä¸€ä¸‹èˆ‡é‹ç®—ä¸€ä¸‹å°±å¥½äº†ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HTEXTURE <span class="title">SetTransColor</span><span class="params">(HTEXTURE hTex, DWORD dwColor)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** æ³¨ï¼šä¸Šé¢çš„dwColorä»£è¡¨çš„æ˜¯RGBï¼Œä¸æ˜¯ARGB */</span></span><br><span class="line">    <span class="keyword">static</span> HGE* hge = hgeCreate(HGE_VERSION);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size = hge-&gt;Texture_GetWidth(hTex) * hge-&gt;Texture_GetHeight(hTex);</span><br><span class="line">    DWORD* dwTex = hge-&gt;Texture_Lock(hTex);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((dwTex[i] &amp; <span class="number">0x00FFFFFF</span>) == dwColor)</span><br><span class="line">        &#123;</span><br><span class="line">            dwTex[i] &amp;= <span class="number">0x00FFFFFF</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    hge-&gt;Texture_Unlock(hTex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hTex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å˜›ï¼Œé€™æ¨£ä¸€ä¾†ï¼Œå°±é€æ˜ç­~</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€å˜› = = åœ¨åšé‚£å€‹é …ç›®çš„å‹•ç•«é è¦½å™¨çš„æ™‚å€™ï¼Œå› çˆ²é‚£å¼•æ“å°è£å¾—å¤ªéº»ç…©äº†ï¼Œæ–¼æ˜¯è‡ªå·±åŸºæ–¼HGEå†ç§»æ¤ä¸€éï¼Œç™¼ç¾å…¶ä¸­æœ‰ä¸€å€‹SetTransparentColorå‡½æ•¸ï¼Œå³è¨­ç½®é€æ˜è‰²ã€‚</p>
<p>ã€€ã€€æ‹¿å‡ºä¾†åˆ†äº«ä¸€ä¸‹å§ã€‚</p>
<p>ã€€ã€€å…¶å¯¦æ–¹æ³•å¾ˆç°¡å–®ï¼Œ<code>HTEXTU]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="HGE" scheme="http://xcoder.in/tags/HGE/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[é—œæ–¼éŠæˆ²è³‡æºåŒ…çš„æ›´æ–°ã€åˆªé™¤]]></title>
    <link href="http://xcoder.in/2011/06/16/resource-pack/"/>
    <id>http://xcoder.in/2011/06/16/resource-pack/</id>
    <published>2011-06-15T17:20:31.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€æœ€è¿‘é™¤äº†å¿™å„ç¨®å„æ¨£çš„æœŸæœ«è€ƒè©¦ã€å»è¥¿ç­ç‰™çš„ç°½è­‰ï¼Œå°±æ˜¯å…¬å¸çš„é‚£å€‹éŸ“åœ‹é …ç›®äº†ã€‚</p>
<p>ã€€ã€€æˆ‘çš„ä»»å‹™åŸºæœ¬å®Œæˆâ€”â€”å°‡åŸæœ¬å–®å±çš„éŠæˆ²æ”¹æˆä¸‰å±ï¼Œå®Œå–„æ•´å€‹ GUIç³»çµ± ä»¥åŠâ€œåŠ«æŒâ€äº†åŸéŠæˆ²ä¸­çš„ä¸€äº›é‚è¼¯ï¼Œæ¯”å¦‚æ»¾è»¸çš„æ’åˆ—å¯ä»¥ä»»æ„æ§åˆ¶ç­‰ã€‚ç”±æ–¼åŸä»£ç¢¼ä¸­çš„GUIç³»çµ±æ²’æœ‰æ–‡æœ¬ç·¨è¼¯æ¡†ï¼Œæˆ‘é‚„å¾—è‡ªå·±å¯«ä¸€å€‹ã€‚ç„¶è€Œæˆ‘å°æ–¼IMEçš„æ“ä½œã€GDIå’ŒDXçš„çµåˆä¸æ˜¯éå¸¸ç†Ÿæ‚‰ï¼Œæ‰€ä»¥é‚„æ˜¯åƒç…§äº†ä¸€ä¸‹ <strong>ShowLong</strong> æ‰€ä¿®æ”¹çš„å¾®å¦™çš„å¹³è¡¡çµ¦HGEå¯«çš„ä¸­æ–‡è§£æ±ºæ–¹æ¡ˆã€‚</p>
<p>ã€€ã€€å®Œæˆäº†ä»¥ä¸Šçš„ä»»å‹™ä¹‹å¾Œï¼Œç”±æ–¼æˆ‘çš„è€ƒè©¦ä»¥åŠç°½è­‰å•é¡Œä»¥åŠæˆ‘æœ¬èº«çš„ä»»å‹™å·®ä¸å¤šäº†ï¼Œå°±æŠŠé€™å€‹æ”¤å­å°±æ‰”å›å…¬å¸å»äº†ã€‚åœ¨äº¤æ¥çš„æ™‚å€™ï¼Œè€å¤§çµ¦æˆ‘æ´¾äº†ä¸€å€‹ä»»å‹™ï¼Œè®“æˆ‘ä¾†å¯«é€™å€‹éŠæˆ²è³‡æºåŒ…çš„ä»£ç¢¼ã€‚</p>
<p>ã€€ã€€åŸç‰ˆéŠæˆ²ä»£ç¢¼ä¸­æœ‰è³‡æºåŒ…ä»£ç¢¼ï¼Œä½†æ˜¯å¯«å¾—éå¸¸äº‚ï¼Œæ–¼æ˜¯éœ€è¦æˆ‘ä¾†å¯«ä¸€å€‹æ–°çš„æ–‡ä»¶çµæ§‹ã€æ–°çš„åŠ å¯†ç®—æ³•ï¼Œç„¶å¾Œä»ç„¶æ˜¯â€œåŠ«æŒâ€æ‰åŸä»£ç¢¼ä¸­çš„è³‡æºåŒ…åŠ è¼‰å‡½æ•¸ã€‚</p>
<p>ã€€ã€€åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘æ‹œè®€äº†é›²é¢¨çš„ã€Š<a href="http://blog.codingnow.com/2010/08/resource_pack.html" target="_blank" rel="external">éŠæˆ²è³‡æºçš„å£“ç¸®ã€æ‰“åŒ…èˆ‡è£œä¸æ›´æ–°</a>ã€‹ï¼Œæœ‰äº†é»éˆæ„Ÿã€‚</p>
<p>ã€€ã€€<strong>æœ€ä¸»è¦çš„å°±æ˜¯å…¶åˆªé™¤é€™ä¸€å¡Šã€‚çˆ²äº†è®“ç”¨æˆ¶åœ¨æ›´æ–°çš„æ™‚å€™æ¸›å°‘å¤§é‡çš„æ–‡ä»¶IOæ“ä½œï¼Œåšæ³•å°±æ˜¯æ¸›å°‘æ–‡ä»¶å…§å®¹çš„å¤§å¹…åº¦ç§»å‹•ã€‚</strong></p>
<p>ã€€ã€€è€Œæˆ‘ä¾¿æ˜¯åƒè€ƒäº†é›²é¢¨å¤§å¤§çš„é€™å€‹æ€æƒ³ä¾†å¯«æˆ‘çš„æ–‡ä»¶åŒ…ã€‚é¦–å…ˆå› çˆ²åœ¨éŠæˆ²ä¸­éœ€è¦å¯¦æ™‚è®€å–ï¼Œæ‰€ä»¥æ–‡ä»¶æ²’æœ‰å£“ç¸®ï¼Œåªæ˜¯åšäº†å…©å±¤åŠ å¯†è™•ç†ï¼Œå¯†é‘°ä¹Ÿæ˜¯é€šéå“ˆå¸Œå¾—åˆ°çš„ï¼Œæ‰€ä»¥æ¯å€‹æ–‡ä»¶çš„å¯†é‘°æ˜¯ä¸åŒçš„ã€‚</p>
<p>ã€€ã€€ç„¶å¾Œåœ¨æ–‡ä»¶ç´¢å¼•çš„æ™‚å€™ï¼Œæˆ‘é€™è£æ˜¯åˆ†äº†å…©ç¨®ç´¢å¼•ï¼š<strong>æ–‡ä»¶ç´¢å¼•</strong>ä»¥åŠ<strong>ç©ºå¡Šç´¢å¼•</strong>ã€‚</p>
<p>ã€€ã€€æ‰€è¬‚ç©ºå¡Šç´¢å¼•å°±æ˜¯ï¼šåœ¨æ–‡ä»¶åŒ…ä¸­åˆªé™¤æŸä¸€å€‹æ–‡ä»¶çš„æ™‚å€™ï¼Œä¸æŠŠå¾Œé¢çš„æ–‡ä»¶å…§å®¹å…¨éƒ¨å¾€å‰æŒªä»¥è¦†è“‹é€™ä¸€å¡Šçš„å…§å®¹ã€å°è‡´æ•´å€‹æ–‡ä»¶åŒ…åœ¨åˆªé™¤æ–‡ä»¶ä¹‹å¾Œçš„ä¿¡æ¯å…¨éƒ¨å¾€å‰æŒªè€Œç”¢ç”Ÿçš„å¤§é‡IOæ“ä½œï¼Œè€Œæ˜¯å°é€™ä¸€å¡Šå…§å®¹ä¸ä½œä»»ä½•è™•ç†ã€æŠŠé€™ä¸€å¡Šå…§å®¹çš„ç´¢å¼•å¾æ–‡ä»¶ç´¢å¼•ä¸­ç§»é™¤ä¸¦é™„åŠ åˆ°ç©ºå¡Šç´¢å¼•ä¸­ä»¥ä¾›ä»¥å¾Œæ–°æ–‡ä»¶åŠ å…¥æ™‚æ‰€ç”¨ï¼Œ<strong>é€™æ¨£å°±åªç”¢ç”Ÿäº†ä¸€é»å°æ–¼ç´¢å¼•çš„æ–‡ä»¶IOæ›´æ–°</strong>ï¼Œä¸éç´¢å¼•çš„æ›´æ–°å……å…¶é‡ä¹Ÿå°±é‚£éº¼é»ï¼Œç›¸å°æ–¼æ–‡ä»¶çš„æ“ä½œä¾†èªªåªæ˜¯ä¹ç‰›ä¸€æ¯›ï¼Œç•¶ç„¶å‰ææ˜¯é€™å€‹ç´¢å¼•æ˜¯åœ¨æ•´å€‹æ–‡ä»¶åŒ…çš„æœ€å¾Œã€‚è€Œåœ¨æœ‰æ–°æ–‡ä»¶æ’å…¥çš„æ™‚å€™ï¼Œå…ˆåœ¨ç©ºå¡Šç´¢å¼•ä¸­æ‰¾æœ‰æ¯”æ–°æ–‡ä»¶å¤§çš„ç©ºå¡Šï¼Œå¦‚æœæœ‰çš„è©±å°±ç›´æ¥æŠŠé€™å€‹æ–‡ä»¶æ’å…¥åˆ°é‚£å€‹ç©ºå¡Šä¸­ï¼Œç„¶å¾Œæ›´æ–°ä¸€ä¸‹æ–‡ä»¶ç´¢å¼•ä»¥åŠç©ºå¡Šç´¢å¼•å³å¯ï¼Œé€™è£åˆå°‘æ‰äº†ä¸€äº›IOæ“ä½œã€‚</p>
<p>ã€€ã€€æ­£å¦‚é›²é¢¨æ‰€èªªï¼š</p>
<blockquote>
<p>å¦‚æœæ–°å¢åŠ çš„æ–‡ä»¶è¼ƒä¹‹å°ï¼Œå°±é‡è¤‡åˆ©ç”¨é€™å€‹ç©ºé–“ã€‚å¦‚æœåˆ©ç”¨ä¸ä¸Šï¼Œå°±æµªè²»åœ¨é‚£è£ã€‚é€™æœ‰é»åƒå…§å­˜ç®¡ç†ç®—æ³•ï¼Œ<strong>æ™‚é–“ä¹…äº†ï¼Œè³‡æºåŒ…å…§æœƒæœ‰ä¸€äº›ç©ºæ´ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚</strong></p>
</blockquote>
<p>ã€€ã€€æ¥ç€å°±æ˜¯è³‡æºåŒ…åœ¨éŠæˆ²ä¸­çš„ä½¿ç”¨äº†ã€‚åœ¨åŸå…ˆçš„éŠæˆ²ä»£ç¢¼ä¸­æ˜¯æœ‰åˆ¤æ–·é‡è¤‡åŠ è¼‰çš„ä»£ç¢¼ï¼Œä¹Ÿå°±æ˜¯èªªæŠŠå·²åŠ è¼‰çš„è³‡æºå­˜åˆ°nodeè£ï¼Œåœ¨ä¹‹å¾Œå†æ¬¡éœ€è¦åŠ è¼‰é€™å€‹è³‡æºï¼ˆé€šéæ–‡ä»¶ååˆ¤æ–·ï¼‰å°±ç›´æ¥å¾nodeä¸­å»ï¼Œé€™æ¨£å°±å°‘äº†å¾ˆå¤šå…§å­˜é–‹éŠ·ï¼Œå°¤å…¶æ˜¯ç•¶æˆ‘æŠŠå–®å±æ”¹çˆ²ä¸‰å±ä¹‹å¾Œï¼Œé€™æ¨£çš„å„ªåŒ–æ•ˆæœæ›´çˆ²æ˜é¡¯ï¼ˆå¦å‰‡ç›¸åŒçš„è³‡æºè¦åŠ è¼‰ä¸‰æ¬¡ï¼Œç­‰æ–¼æ¶ˆè€—äº†ä¸‰å€çš„å…§å­˜ï¼‰ã€‚ä¸å¾—è´Šä¸€ä¸‹é€™05å¹´é–‹ç™¼çš„ä»£ç¢¼ï¼Œé›–ç„¶æ˜¯æ£’å­ã€‚ä¸éåŸéŠæˆ²ä»£ç¢¼ä¸­çš„é«˜è€¦åˆåº¦è®“æˆ‘è›‹ç–¼ã€‚</p>
<p>ã€€ã€€æƒ³åˆ°ä»¥å¾Œé€™å€‹è³‡æºåŒ…é¡è¦ç”¨åˆ°ä»¥å¾Œçš„ä¸€äº›é …ç›®ï¼Œæ–¼æ˜¯æˆ‘è‡ªå·±ä¹Ÿå¯«äº†ä¸€å€‹Cacheæ©Ÿåˆ¶ã€‚å°±æ˜¯åœ¨ä¸€å€‹åŒ…ä¸­ï¼Œç•¶åŠ è¼‰æŸå€‹è³‡æºçš„æ™‚å€™ï¼Œé †ä¾¿æŠŠé€™å€‹è³‡æºçš„BufferåŠ åˆ°ä¸€å€‹Cacheä¸­ï¼Œç•¶ä¸‹æ¬¡å†éœ€è¦ç”¨åˆ°é€™å€‹è³‡æºçš„æ™‚å€™å°±ç›´æ¥å¾Cacheä¸­å–å°±å¥½äº†ï¼Œå¯¦éš›ä¸Šé€™å°±é‚„æ˜¯ä¹‹å‰çš„ä»£ç¢¼å¯¦ç¾çš„åŠŸèƒ½ï¼Œåªä¸éæˆ‘è‡ªå·±åœ¨é€™åŸºç¤ä¸Šç²¾ç°¡äº†ä¸€ä¸‹ã€‚æœ€å¾Œå¯«ä¸€å€‹ClearCacheçš„å‡½æ•¸èƒ½æ¸…é™¤Cacheï¼Œæˆ‘é€™å€‹è³‡æºåŒ…é¡å°±ç®—å®Œæˆäº†ã€‚</p>
<p>ã€€ã€€é‚„æœ‰åœ¨ç²å–è³‡æºçš„æ™‚å€™ï¼Œçˆ²äº†é˜²æ­¢å…§å­˜çªå¢ï¼Œæˆ‘çš„Bufferæ˜¯ä¸€æ®µä¸€æ®µç²å–çš„ï¼Œé¡ä¼¼æ–¼Socketä¸­çš„ç²å–æ¶ˆæ¯ä¸€ç›´åˆ°æ¶ˆæ¯çµæŸçˆ²æ­¢ã€‚ç•¶ç„¶ï¼Œæ¯ä¸€æ®µBufferçš„å¤§å°æ˜¯å¯ä»¥è‡ªå·±å‚³é€²å»çš„ã€‚æˆ‘é€™ç¨®ä»¥æ™‚é–“æ›ç©ºé–“çš„åšæ³•é‚„æ²’è‡ªå·±å¯¦éš›æ¸¬è©¦éæ•ˆæœå¦‚ä½•ï¼Œåªä¸éæ˜¯è‡ªå·±æƒ³æƒ³å¯èƒ½æœƒæ¯”è¼ƒå„ªç½·äº†ï¼Œå› çˆ²æœ€è¿‘å¯¦åœ¨æ˜¯å¤ªæ…¢ï¼Œé€™ç¯‡æ—¥èªŒé‚„æ˜¯è€ƒå®Œäº†æ¦‚ç‡ç„¶å¾Œæ‘¸ç€é»‘åœ°å¯«çš„ã€‚</p>
<p>ã€€ã€€æˆ‘å°æ–‡ä»¶ç³»çµ±æœ¬èº«ä¸æ˜¯éå¸¸ç­è§£ï¼Œæ“ä½œç³»çµ±é‚„æ²’è€ƒå‘¢ã€‚æ‰€ä»¥æˆ‘ç¾åœ¨åƒ…åƒ…åšåˆ°çš„æ˜¯é›²é¢¨ä¹å¹´å‰çš„ä¸€ç¨®è¨­è¨ˆï¼Œç„¶å¾ŒåŠ ä¸Šäº†åŸå…ˆä»£ç¢¼æœ‰çš„Cacheæ©Ÿåˆ¶è€Œå·²ã€‚ä¸éå¯«ä¸‹é€™ç¯‡æ—¥èªŒä¾†è¨˜éŒ„æˆ‘è‡ªå·±æˆé•·çš„è¶³è·¡ç½·äº†ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€æœ€è¿‘é™¤äº†å¿™å„ç¨®å„æ¨£çš„æœŸæœ«è€ƒè©¦ã€å»è¥¿ç­ç‰™çš„ç°½è­‰ï¼Œå°±æ˜¯å…¬å¸çš„é‚£å€‹éŸ“åœ‹é …ç›®äº†ã€‚</p>
<p>ã€€ã€€æˆ‘çš„ä»»å‹™åŸºæœ¬å®Œæˆâ€”â€”å°‡åŸæœ¬å–®å±çš„éŠæˆ²æ”¹æˆä¸‰å±ï¼Œå®Œå–„æ•´å€‹ GUIç³»çµ± ä»¥åŠâ€œåŠ«æŒâ€äº†åŸéŠæˆ²ä¸­çš„ä¸€äº›é‚è¼¯ï¼Œæ¯”å¦‚æ»¾è»¸çš„æ’åˆ—å¯ä»¥ä»»æ„æ§åˆ¶ç­‰ã€‚ç”±æ–¼åŸä»£ç¢¼ä¸­çš„GUIç³»çµ±æ²’æœ‰æ–‡æœ¬ç·¨è¼¯æ¡†ï¼Œæˆ‘é‚„å¾—]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="äºŒé€²åˆ¶æ–‡ä»¶" scheme="http://xcoder.in/tags/%E4%BA%8C%E9%80%B2%E5%88%B6%E6%96%87%E4%BB%B6/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è³‡æºåŒ…" scheme="http://xcoder.in/tags/%E8%B3%87%E6%BA%90%E5%8C%85/"/>
    
      <category term="éŠæˆ²è£½ä½œ" scheme="http://xcoder.in/tags/%E9%81%8A%E6%88%B2%E8%A3%BD%E4%BD%9C/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[é€£é€£çœ‹æ ¸å¿ƒç®—æ³•å°åˆ†äº«â€”â€”1]]></title>
    <link href="http://xcoder.in/2011/05/16/lianlinakan-algorighm-i/"/>
    <id>http://xcoder.in/2011/05/16/lianlinakan-algorighm-i/</id>
    <published>2011-05-16T04:30:12.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€<strong>æ³¨ï¼šé€™ç¯‡æ–‡ç« æˆ‘åˆ°ç¾åœ¨ä¹Ÿæ²’æœ‰å¡«ç¬¬äºŒç¯‡çš„å‘ã€‚æ•¸æ“šæ²’äº†é‡æ–°å¾ Capture è£é¢å–å‡ºä¾†ï¼Œçœ‹çœ‹æ¨ä¸å¾—ï¼Œæ–¼æ˜¯æŠŠé€™ç¯‡æ–‡ç« ä¹Ÿæ‹¿å›ä¾†äº†ã€‚æ¬Šç•¶ç´€å”¸å§ï¼Œä»¥åŠç•¶æ™‚å’Œ <code>Kalxd</code> çš„å°è©±ã€‚</strong></p>
<h2 id="æ­£æ–‡">æ­£æ–‡</h2><p>ã€€ã€€å‰›å¿™å®Œé‚€è«‹è³½ï¼Œè¹­äº†å¡ŠéŠ…ã€‚å‰›çº”åœ¨é€›åˆ¥äººåšå®¢çš„æ™‚å€™çœ‹åˆ¥äººçš„æ–‡ç« ï¼Œçªç„¶å¿ƒè¡€ä¾†æ½®æƒ³è¨˜ä¸€äº›æ±è¥¿ã€‚</p>
<p>ã€€ã€€é€£é€£çœ‹æ˜¯æˆ‘å­¸HGEåšçš„ç¬¬ä¸€å€‹å°éŠæˆ²ï¼Œç´ æç”¨çš„æ˜¯QQçš„ã€‚æ™‚é–“å¤§æ¦‚æ˜¯å»å¹´åœ‹æ…¶å§ã€‚å¥½å§ï¼Œå»¢è©±ä¸å¤šèªªï¼Œå°±è¬›è¬›é€£é€£çœ‹æ€éº¼æ‰¾åˆ°èƒ½æ¶ˆçš„å…©å¡Šå§ã€‚</p>
<p>ã€€ã€€é¦–å…ˆä¾†å›é¡§ä¸€ä¸‹æ¶ˆæ–¹å¡Šçš„è¦å‰‡ï¼Œä¸€å…±æœ‰ä¸‰ç¨®å¯èƒ½æ€§ï¼š</p>
<ol>
<li>ç›´ç·šæ¶ˆé™¤ï¼ˆåŒ…æ‹¬æ°´å¹³æˆ–è€…å‚ç›´ï¼‰</li>
<li>ä¸€å€‹æ‹è§’æ¶ˆé™¤</li>
<li>å…©å€‹æ‹è§’æ¶ˆé™¤</li>
</ol>
<p>ã€€ã€€å—¯ï¼Œæ¥ä¸‹å»æˆ‘å€‘å°±é‡å°æ¯ç¨®å¯èƒ½æ€§é–‹å§‹å¯«ä»£ç¢¼ã€‚</p>
<p>ã€€ã€€é¦–å…ˆè¬›è¬›ä¸€äº›å®šç¾©ï¼š</p>
<p>ã€€ã€€åº§æ¨™çµæ§‹é«”ï¼Œé€™å€‹çµæ§‹é«”åŒ…å«äº†xã€yçš„å€¼ä»¥åŠä¸€äº›åº§æ¨™ä¸­å¸¸ç”¨çš„å‡½æ•¸ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief åœ°åœ–åº§æ¨™çµæ§‹é«”</span><br><span class="line"> *</span><br><span class="line"> * åœ°åœ–åº§æ¨™çµæ§‹é«”ï¼ŒåŒ…å«xè»¸å€¼ã€yè»¸å€¼</span><br><span class="line"> * ä»¥åŠä¸€äº›æ“ä½œå‡½æ•¸ã€‚</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">struct</span> CoorType &#123;</span><br><span class="line">    <span class="keyword">int</span> x;                                          <span class="comment">///&lt; xè»¸</span></span><br><span class="line">    <span class="keyword">int</span> y;                                          <span class="comment">///&lt; yè»¸</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * é‡è¼‰æ§‹é€ å‡½æ•¸</span><br><span class="line">     * å°‡xã€yå€¼å„åˆå§‹åŒ–çˆ²-1</span><br><span class="line">     */</span></span><br><span class="line">    CoorType()</span><br><span class="line">    &#123;</span><br><span class="line">        x = -<span class="number">1</span>, y = -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * æ§‹é€ å‡½æ•¸é‡è¼‰</span><br><span class="line">     * å°‡xã€yå„è³¦å€¼çˆ²bã€a</span><br><span class="line">     * @param a å°‡è¦è³¦å€¼çš„yè»¸æ•¸å€¼</span><br><span class="line">     * @param b å°‡è¦è³¦å€¼çš„xè»¸æ•¸å€¼</span><br><span class="line">     */</span></span><br><span class="line">    CoorType(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span><br><span class="line">    &#123;</span><br><span class="line">        y = a, x = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * è¨­ç½®åº§æ¨™</span><br><span class="line">     * å°‡xã€yå„è³¦å€¼çˆ²bã€a</span><br><span class="line">     * @param a å°‡è¦è³¦å€¼çš„yè»¸æ•¸å€¼</span><br><span class="line">     * @param b å°‡è¦è³¦å€¼çš„xè»¸æ•¸å€¼</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        y = a, x = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * é‹ç®—ç¬¦"+="é‡è¼‰</span><br><span class="line">     * å°‡æ­¤åº§æ¨™èˆ‡å¦ä¸€åº§æ¨™ç›¸åŠ </span><br><span class="line">     * @param &amp;a å¦ä¸€åº§æ¨™</span><br><span class="line">     * @return è¿”å›çµæœåº§æ¨™å€¼</span><br><span class="line">     */</span></span><br><span class="line">    CoorType &amp; <span class="keyword">operator</span> += (<span class="keyword">const</span> CoorType &amp;a)</span><br><span class="line">    &#123;</span><br><span class="line">        y += a.y, x += a.x;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * é‡è¼‰é‹ç®—ç¬¦"!="</span><br><span class="line">     * åˆ¤æ–·èˆ‡å¦ä¸€åº§æ¨™æ˜¯å¦è¡¨ç¤ºåŒä¸€å€‹å€¼</span><br><span class="line">     * @param &amp;a å¦ä¸€åº§æ¨™</span><br><span class="line">     * @return è¿”å›å¸ƒçˆ¾é¡å‹è¡¨ç¤ºæ˜¯å¦ç›¸ç­‰</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> != (<span class="keyword">const</span> CoorType &amp;a)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(y != a.y || x != a.x) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * åˆ¤æ–·æ­¤åº§æ¨™æ˜¯å¦åˆæ³•</span><br><span class="line">     * è‹¥å‡ºç•Œå‰‡ä¸åˆæ³•</span><br><span class="line">     * @return è¿”å›å¸ƒçˆ¾é¡å‹è¡¨ç¤ºæ˜¯å¦åˆæ³•</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isIll</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(y &gt;= <span class="number">0</span> &amp;&amp; x &gt;= <span class="number">0</span> &amp;&amp; y &lt; MAP_HEIGHT &amp;&amp; x &lt; MAP_WIDTH) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œæ˜¯é—œæ–¼åœ°åœ–æ•¸çµ„çš„å®šç¾©ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> Map[MAP_HEIGHT][MAP_WIDTH];</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ¥ç€æ˜¯è·¯å¾‘çµæ§‹é«”ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief è·¯ç·šçµæ§‹é«”</span><br><span class="line"> *</span><br><span class="line"> * åˆæ³•è·¯ç·šçµæ§‹é«”</span><br><span class="line"> * å„²å­˜æœ€å¤šå››å€‹é»ï¼ˆèµ·é»çµ‚é»å’Œå…©å€‹è½‰æŠ˜é»ï¼‰</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">struct</span> PointPath &#123;</span><br><span class="line">    <span class="keyword">bool</span> bExist;                                    <span class="comment">///&lt; æ˜¯å¦æœ‰è·¯å¾‘</span></span><br><span class="line">    <span class="keyword">int</span> Num;                                        <span class="comment">///&lt; é§é»å€‹æ•¸</span></span><br><span class="line">    CoorType Points[<span class="number">4</span>];                             <span class="comment">///&lt; å„é§é»</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€æ¥ç€å¯ä»¥æ­£å¼é–‹å§‹äº†ã€‚é¦–å…ˆæˆ‘å€‘ä¾†æƒ³ä¸€ä¸‹ï¼Œå“ªäº›æ¢ä»¶å„ç¬¦åˆä¸Šé¢ä¸‰ç¨®æƒ…æ³çš„å“ªä¸€ç¨®ã€‚å°æ–¼ä¸€æ¢ç›´ç·šçš„ï¼Œé¡¯ç„¶æ˜¯xç›¸ç­‰æˆ–è€…yç›¸ç­‰ï¼›å°æ–¼æœ‰ä¸€å€‹è½‰æŠ˜é»çš„è©±ï¼Œæˆ‘å€‘åªéœ€è¦åˆ¤æ–·èµ·é»æ©«å‘ç•«ç·šï¼ˆæˆ–è€…ç¸±å‘ï¼‰ï¼Œç„¶å¾Œçµ‚é»ç¸±å‘ç•«ç·šï¼ˆæˆ–è€…æ©«å‘ï¼‰ï¼Œç„¶å¾Œå¾èµ·é»åˆ°äº¤é»ä»¥åŠå¾äº¤é»åˆ°çµ‚é»å„å¯è¡Œä¸ï¼›å°æ–¼å…©å€‹è½‰æŠ˜é»ï¼Œå…¶ä¸­ä¸€å€‹è½‰æŠ˜é»çš„xæˆ–è€…yè·Ÿèµ·é»çš„xæˆ–è€…yç›¸ç­‰ï¼Œå¦ä¸€å€‹è½‰æŠ˜é»è·Ÿçµ‚é»çš„xæˆ–è€…yç›¸ç­‰ã€‚æ–¼æ˜¯é€™å…©å€‹è½‰æŠ˜é»å°±æ ¹æ“šé€™æ¨£çš„æ€§è³ªé€²è¡Œæšèˆ‰ã€‚å› çˆ²é€£é€£çœ‹çš„åœ°åœ–æ¯”è¼ƒå°ï¼Œæ‰€ä»¥é€™ç¨®O(n^2)çš„æ™‚é–“è¤‡é›œåº¦ä¸ç¤™äº‹ã€‚</p>
<p>ã€€ã€€çˆ²äº†æ–¹ä¾¿ï¼Œæˆ‘å€‘å¯«ä¸€å€‹ <code>Abled(CoorType, CoorType, bool, bool);</code> å‡½æ•¸ä¾†é€²è¡Œåˆ¤æ–·å…©å€‹é»ï¼ˆç•¶ç„¶å…©é»æ˜¯åœ¨åŒä¸€ç›´ç·šä¸Šçš„ï¼‰æ˜¯å¦æœ‰åŒè·¯ï¼ˆå³ä¸­é–“æ²’æœ‰æ±è¥¿æ“‹ç€ï¼‰ã€‚æˆ‘å€‘å…ˆæ”¾ç€é€™å€‹Abledä¸ç®¡ï¼Œå…ˆå¯¦ç¾å°‹è·¯éç¨‹å§ã€‚</p>
<p>ã€€ã€€æˆ‘æ˜¯ç”¨ä¸€å€‹CMapSearché¡ä¾†å¯¦ç¾çš„ï¼Œè²æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief åœ°åœ–æœç´¢é¡</span><br><span class="line"> *</span><br><span class="line"> * æ ¹æ“šæŒ‡å®šåœ°åœ–æœç´¢å‡ºå„åˆæ³•è·¯å¾‘ã€‚</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">class</span> CMapSearch</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> Map[MAP_HEIGHT][MAP_WIDTH];                                             <span class="comment">///&lt; åœ°åœ–æ•¸æ“šçŸ©é™£</span></span><br><span class="line">    PointPath dis[MAP_HEIGHT][MAP_WIDTH][MAP_HEIGHT][MAP_WIDTH];                <span class="comment">///&lt; è·¯å¾‘æ•¸çµ„</span></span><br><span class="line">    STLMap grap;                                                                <span class="comment">///&lt; STLæ˜ å°„</span></span><br><span class="line">    CoorType dir[<span class="number">4</span>];                                                            <span class="comment">///&lt; å¸¸é‡åº§æ¨™å¢é‡</span></span><br><span class="line">    PointPath Hint;                                                             <span class="comment">///&lt; æç¤ºæ™‚ç”¨çš„åˆæ³•è·¯å¾‘</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief å…©é»å°‹å¾‘</span><br><span class="line">     *</span><br><span class="line">     * å°(x1, y1)å’Œ(x2, y2)é€²è¡Œå°‹å¾‘</span><br><span class="line">     * @param x1 ç¬¬ä¸€å€‹åº§æ¨™çš„xè»¸</span><br><span class="line">     * @param y1 ç¬¬ä¸€å€‹åº§æ¨™çš„yè»¸</span><br><span class="line">     * @param x2 ç¬¬äºŒå€‹åº§æ¨™çš„xè»¸</span><br><span class="line">     * @param y2 ç¬¬äºŒå€‹åº§æ¨™çš„yè»¸</span><br><span class="line">     * @return è¿”å›ä¸€å€‹è·¯ç·šçµæ§‹é«”çš„å€¼ï¼Œè‹¥ä¸å­˜åœ¨è·¯å¾‘ï¼Œå‰‡çµæ§‹é«”çš„bExistçˆ²å‡</span><br><span class="line">     * @see Abled</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">PointPath <span class="title">DoSearch</span><span class="params">(<span class="keyword">int</span> y1, <span class="keyword">int</span> x1, <span class="keyword">int</span> y2, <span class="keyword">int</span> x2)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief æ§‹é€ å‡½æ•¸</span><br><span class="line">     *</span><br><span class="line">     * @param _Map[][Map_Width] åœ°åœ–çŸ©é™£</span><br><span class="line">     */</span></span><br><span class="line">    CMapSearch(<span class="keyword">int</span> _Map[][MAP_WIDTH]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief ææ§‹å‡½æ•¸</span><br><span class="line">     */</span></span><br><span class="line">    ~CMapSearch(<span class="keyword">void</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief è¼‰å…¥åœ°åœ–</span><br><span class="line">     * å¾çŸ©é™£ä¸­è¼‰å…¥åœ°åœ–åˆ°å°è±¡</span><br><span class="line">     *</span><br><span class="line">     * @param _Map[][Map_Width] åœ°åœ–çŸ©é™£</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">LoadMap</span><span class="params">(<span class="keyword">int</span> _Map[][MAP_WIDTH])</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief æœç´¢åœ°åœ–</span><br><span class="line">     * å°æ•´å€‹åœ°åœ–é€²è¡Œæœç´¢æ¯å…©å€‹ç›¸åŒæ–¹å¡Šä¹‹é–“çš„è·¯å¾‘</span><br><span class="line">     *</span><br><span class="line">     * @return å¦‚æœå­˜åœ¨è‡³å°‘ä¸€æ¢è·¯å¾‘å‰‡è¿”å›çœŸï¼Œå¦å‰‡çˆ²å‡ï¼Œç”¨æ–¼æ˜¯å¦é‡åˆ—</span><br><span class="line">     * @see CreateSTLMap</span><br><span class="line">     * @see DoSearch</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Search</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief å‰µå»ºmapæ˜ å°„</span><br><span class="line">     * å‰µå»ºä¸€å€‹æ–¹å¡ŠIDçš„æ˜ å°„ï¼Œå°æ¯å€‹IDå‰µå»ºä¸€æ¢çš„è©²IDçš„æ–¹å¡Šåœ¨åœ°åœ–ä¸­çš„å„åº§æ¨™çš„éˆè¡¨</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CreateSTLMap</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief åˆ¤æ–·æ˜¯å¦æœ‰éšœç¤™</span><br><span class="line">     * å°æ–¼aã€bå…©åº§æ¨™ï¼ˆåœ¨åŒä¸€ç›´ç·šï¼‰é€²è¡Œåˆ¤æ–·æœŸé–“æ˜¯å¦æœ‰æ–¹å¡Šéšœç¤™è€Œå°è‡´ä¸èƒ½é€£ç·š</span><br><span class="line">     *</span><br><span class="line">     * @param a åº§æ¨™aï¼ˆé ­åº§æ¨™ï¼‰</span><br><span class="line">     * @param b åº§æ¨™bï¼ˆå°¾åº§æ¨™ï¼‰</span><br><span class="line">     * @param head è‹¥åŒ…æ‹¬é ­åº§æ¨™å‰‡çˆ²trueï¼Œå¦å‰‡çˆ²false</span><br><span class="line">     * @param tail è‹¥åŒ…æ‹¬å°¾åº§æ¨™å‰‡çˆ²trueï¼Œå¦å‰‡çˆ²false</span><br><span class="line">     * @return è‹¥æœ‰éšœç¤™å‰‡è¿”å›falseï¼Œå¦å‰‡çˆ²true</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Abled</span><span class="params">(CoorType a, CoorType b, <span class="keyword">bool</span> head = <span class="literal">false</span>, <span class="keyword">bool</span> tail = <span class="literal">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief å¾—åˆ°è·¯å¾‘</span><br><span class="line">     * å¾—åˆ°å…©å€‹åº§æ¨™çš„é€£ç·šå…·é«”è·¯å¾‘</span><br><span class="line">     *</span><br><span class="line">     * @param y1 ç¬¬ä¸€å€‹åº§æ¨™çš„yè»¸</span><br><span class="line">     * @param x1 ç¬¬ä¸€å€‹åº§æ¨™çš„xè»¸</span><br><span class="line">     * @param y2 ç¬¬äºŒå€‹åº§æ¨™çš„yè»¸</span><br><span class="line">     * @param x2 ç¬¬äºŒå€‹åº§æ¨™çš„xè»¸</span><br><span class="line">     * @return è¿”å›ä¸€å€‹è·¯ç·šçµæ§‹é«”ï¼Œè¡¨ç¤ºè©²å…©å€‹åº§æ¨™ç›´æ¥çš„è·¯ç·š</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">PointPath <span class="title">GetPath</span><span class="params">(<span class="keyword">int</span> y1, <span class="keyword">int</span> x1, <span class="keyword">int</span> y2, <span class="keyword">int</span> x2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief å¾—åˆ°æç¤ºè·¯å¾‘</span><br><span class="line">     * å¾—åˆ°ä¸€æ¢æç¤ºçš„è·¯å¾‘çš„ç›¸æ‡‰å…©å€‹æ–¹å¡Š</span><br><span class="line">     *</span><br><span class="line">     * @param &amp;a æ¥å—ç¬¬ä¸€å€‹æ–¹å¡ŠIDçš„è®Šé‡</span><br><span class="line">     * @param &amp;b æ¥å—ç¬¬äºŒå€‹æ–¹å¡ŠIDçš„è®Šé‡</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetRandomHint</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ç„¶å¾Œæˆ‘é€™å€‹åˆ†äº«è£æ‰€è¬›çš„ç®—æ³•å°±æ˜¯DoSearchå’ŒAbledå‡½æ•¸äº†ï¼Œå› çˆ²å…¶å®ƒå‡½æ•¸å°±æ˜¯ç”¨æ–¼â€œæç¤ºâ€é“å…·çš„ã€‚åœ¨DoSearchä¸­æˆ‘å€‘å…ˆå®šç¾©å…©å€‹è‡¨æ™‚è®Šé‡ï¼Œä¸€å€‹æ˜¯è¿”å›å€¼ï¼ˆä¸€å€‹PointPathï¼‰ï¼Œå››å€‹åº§æ¨™è®Šé‡ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PointPath ans;</span><br><span class="line">CoorType a(y1, x1), b(y2, x2), c, d;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å…¶ä¸­aã€bè¡¨ç¤ºèµ·é»å’Œçµ‚é»ï¼Œcã€dè¡¨ç¤ºå¯èƒ½ç”¨åˆ°çš„å…©å€‹è½‰æŠ˜é»ã€‚</p>
<p>ã€€ã€€é¦–å…ˆæˆ‘å€‘å…ˆä¾†åˆ¤æ–·ç›´ç·šæƒ…æ³å§ï¼Œé€™ç¨®æƒ…æ³æ¯”è¼ƒç°¡å–®ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœæ˜¯ç›´ç·š</span></span><br><span class="line"><span class="keyword">if</span>(a.x == b.x || a.y == b.y)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(Abled(a, b, <span class="literal">true</span>, <span class="literal">true</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        ans.bExist = <span class="literal">true</span>;</span><br><span class="line">        ans.Num = <span class="number">2</span>;</span><br><span class="line">        ans.Points[<span class="number">0</span>] = a, ans.Points[<span class="number">1</span>] = b;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€å°æ–¼é€™ç¨®æƒ…æ³ï¼Œæˆ‘å€‘åªéœ€ç›´æ¥åˆ¤æ–·aã€bç›´æ¥æœ‰æ²’æœ‰é€šè·¯å°±å¥½ï¼Œå¦‚æœæœ‰é€šè·¯æˆ‘å€‘å°±å°‡çµæœè¨˜éŒ„åˆ°ansä¸­ä¸¦è¿”å›å³å¯ã€‚</p>
<p>ã€€ã€€è€Œæœ‰ä¸€å€‹è½‰æŠ˜é»ã€å…©å€‹è½‰æŠ˜é»çš„æƒ…æ³ä»¥åŠAbledå‡½æ•¸å°‡åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å°åˆ†äº«ä¸€ä¸‹ã€‚</p>
<h2 id="å›æ†¶æ™‚é–“">å›æ†¶æ™‚é–“</h2><p>ã€€ã€€ç„¶å¾Œä¸‹é¢å°±æ˜¯åœ¨é€™ç¯‡æ–‡ç« è£é¢æˆ‘è·Ÿ <code>Kalxd</code> çš„å°è©±äº†ï¼Œæƒ³æƒ³ç¾åœ¨çœŸæ˜¯æ»„æµ·æ¡‘ç”°å•Šã€‚</p>
<p>ã€€ã€€CSS æ¨£å¼æ—©å·²ç¶“ä¸åœ¨äº†ï¼Œæˆªåœ–è£é¢æ˜¯ä¸€ç¯‡ç™½æ¿</p>
<p><img src="comment.png" alt="è©•è«–å›æ†¶"></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€<strong>æ³¨ï¼šé€™ç¯‡æ–‡ç« æˆ‘åˆ°ç¾åœ¨ä¹Ÿæ²’æœ‰å¡«ç¬¬äºŒç¯‡çš„å‘ã€‚æ•¸æ“šæ²’äº†é‡æ–°å¾ Capture è£é¢å–å‡ºä¾†ï¼Œçœ‹çœ‹æ¨ä¸å¾—ï¼Œæ–¼æ˜¯æŠŠé€™ç¯‡æ–‡ç« ä¹Ÿæ‹¿å›ä¾†äº†ã€‚æ¬Šç•¶ç´€å”¸å§ï¼Œä»¥åŠç•¶æ™‚å’Œ <code>Kalxd</code> çš„å°è©±ã€‚</strong></p>
<h2 id="æ­£æ–‡">æ­£æ–‡</h]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="HGE" scheme="http://xcoder.in/tags/HGE/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æˆ‘çš„ç·¨ç¨‹ç”Ÿæ¶¯ä¸­ç¬¬ä¸€å€‹å•†æ¥­éŠæˆ²]]></title>
    <link href="http://xcoder.in/2011/04/25/my-first-game/"/>
    <id>http://xcoder.in/2011/04/25/my-first-game/</id>
    <published>2011-04-25T04:30:53.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€æœ€è¿‘ç¶²ä¹‹éŠåœ¨å’Œæ£’å­ä¸€èµ·é–‹ç™¼ä¸€å€‹é¡ä¼¼è³­åšçš„ç¶²éŠï¼ˆåˆ¥ç‰†æˆ‘ï¼Œåšå¥½æ˜¯çµ¦æ£’å­è‡ªå·±ç©çš„ï¼‰ï¼Œç„¶å¾Œæ©Ÿç·£å·§åˆï¼Œä»–å€‘çš„å¼•æ“æ˜¯çµåˆäº†MFCä»¥åŠå¾æˆ‘ç”¨éçš„å¹¾å€‹å¼•æ“ä¹‹ä¸€ç§»æ¤éä¾†çš„ã€‚å°±å¼•æ“æœ¬èº«è€Œè¨€å¾ˆå¼·å¤§ï¼Œç„¶å¾Œæˆ‘åˆæœ‰ä¸€é»å°ç¶“é©—ï¼Œæ‰€ä»¥ç¶²ä¹‹éŠçš„æŸ¯ç¸½ä¾¿ä¹Ÿè®“æˆ‘åŠ å…¥äº†é–‹ç™¼è¡Œåˆ—ã€‚ä¹‹å‰ä¹Ÿæ˜¯è¨—ç¶²ä¹‹éŠçš„ç¦è®“æˆ‘ç ”ç©¶äº†ä¸€ç•ªç¶²ç‹çš„å¹³è‡ºã€‚</p>
<p>ã€€ã€€é–‹ç™¼éç¨‹ä¸­å­¸åˆ°äº†ä¸å°‘åº•å±¤çš„æ±è¥¿ã€‚æˆ‘çš„ä»»å‹™æ˜¯å…ˆå°‡éŠæˆ²çš„å–®å±çµ¦å¼„æˆä¸‰ä»½ï¼Œä»¥ä¸‰å€‹é‚è¼¯ä¾†å¯¦ç¾ã€‚ç”±æ–¼å·¥ç¨‹è€¦åˆæ€§å¤ªé«˜ï¼ŒåŸç¨‹åºå“¡æ˜¯Cèªè¨€å‡ºç”Ÿçš„ï¼Œé€ æˆäº†æˆ‘ä¿®æ”¹å·¥ç¨‹ä¸€å®šç¨‹åº¦ä¸Šçš„éº»ç…©ã€‚å…ˆè‡ªå·±å¯«äº†å€‹Wrapperé¡ä¾†åŒ…å«ä¸‰å€‹SceneGAMEï¼Œç„¶å¾Œä¸€æ¬¡æ€§å°‡ä¸‰å€‹SceneGAMEæ¸²æŸ“åˆ°ç›®æ¨™ä¸Šã€‚é€™æ¨£æ”¹äº†ä¸€ä¸‹ä¹‹å¾Œï¼Œæœ‰å…©ç™¾å¤šå€‹éŒ¯èª¤ã€‚ä¸çŸ¥é“å…¶å®ƒéŠæˆ²æ˜¯ä¸æ˜¯ä¹Ÿæœ‰é€™æ¨£çš„ç‰¹é»ï¼Œå› çˆ²é€™æ˜¯æˆ‘é–‹ç™¼çš„ç¬¬ä¸€æ¬¾éŠæˆ²ï¼Œæ‰€ä»¥ä¹Ÿæ²’ç¶“é©—ã€‚</p>
<p>ã€€ã€€ä¸éå¹¸å¥½æœ€å¾Œé‚„æ˜¯è®“æˆ‘çµ¦å®Œæˆäº†é€™ç¬¬ä¸€å€‹questã€‚æ¥ç€æ˜¯æ·»åŠ GUIï¼Œå°±æ˜¯ç¾åœ¨æ­£åœ¨åšçš„ã€‚é‚„æœ‰å°±æ˜¯å®Œå…¨åˆ†é›¢ä¸‰å¡Šåˆ†å±çš„é‚è¼¯ä»£ç¢¼ã€‚è®“æˆ‘é€™å€‹å¤§äºŒå­¸ç”Ÿèˆˆå¥®çš„æ˜¯ï¼Œé€™å€‹éŠæˆ²å®Œæˆä¹‹å¾Œï¼Œæ˜¯æœƒæœ‰çé‡‘çš„ã€‚é€™å€‹å¯æ˜¯è®“æˆ‘é€™å€‹çª®å­©å­å…©çœ¼æ”¾å…‰è«ã€‚YYä¸€ä¸‹åˆ°åº•æœƒæœ‰å¤šå°‘å‘¢ï¼Œæˆ‘æœ¬èº«ä¹Ÿåªæ˜¯éå»è¦‹è­˜ä¸€ä¸‹çœŸæ­£çš„å·¥ç¨‹è€Œå·²ï¼Œå£“æ ¹æ²’æƒ³émoneyé€™äº‹ã€‚</p>
<p>ã€€ã€€ä»Šå¤©ï¼Œé¡å¥½å§ï¼Œä»¥ç¾åœ¨çš„æ™‚é–“ä¾†èªªæ‡‰è©²æ˜¯æ˜¨å¤©äº†ï¼Œä¸€å€‹éŸ“åœ‹äººä»¥åŠå¦ä¸€ç®‡ä¸­åœ‹å…¬å¸çš„äººéä¾†é©—æ”¶æˆ‘å€‘ç¾åœ¨çš„é€²åº¦ã€‚æˆ‘æ‰“é–‹è‡ªå·±é›»è…¦è£ç·¨è­¯å¥½çš„å¯åŸ·è¡Œæ–‡ä»¶ï¼Œå¿ƒä¸­é‚£ç¨®è‡ªè±ªæ„Ÿæ²¹ç„¶è€Œç”Ÿå•Šï¼Œç•¢ç«Ÿæˆ‘é‚„æ˜¯newbieï¼Œç•¶ç„¶æ˜¯æœ‰äº›å°èˆˆå¥®å•Šã€‚æœŸé–“é‚£ç®‡ä¸­åœ‹å…¬å¸çš„äººèªªè¦è¶•åœ¨éŸ“åœ‹äººé‚£é‚Šä»»å‹™å®Œæˆä¹‹å‰å®Œæˆï¼Œé€™æ¨£å¥½é«”ç¾æˆ‘å€‘è‡ªå·±ç¨‹åºå“¡ä¸æ¯”ä»–å€‘å·®ã€‚ç„¡å½¢ä¹‹é–“çš„è¼ƒé‡å•Šï¼Œè¡¨ç¤ºé´¨æ¢¨å¾ˆå¤§ã€‚æ“šèªªä»–å€‘é‚£é‚Šç¾åœ¨é‡åˆ°å°å•é¡Œäº†ï¼Œæˆ‘å€‘è¶…å‰çš„å¯èƒ½æ€§é‚„æ˜¯è »å¤§çš„ï¼Œæ¥ä¸‹å»æˆ‘å°±æ˜¯è¦å¯è¶³å‹ä¾†åˆ†é›¢é‚è¼¯ä»¥åŠè¨­ç½®GUIäº†ã€‚æŸ¯ç¸½é‚£é‚Šå·²ç¶“æŠŠç¶²çµ¡é€šè¨Šæ–¹é¢å·®ä¸å¤šå®Œæˆäº†ï¼Œæˆ‘é€™ä¸€å¡Šåšå¥½ï¼Œä¸€å°æ¥ï¼Œå·®ä¸å¤šèƒ½åœ¨äº”æœˆåˆäº¤å·¥äº†ã€‚</p>
<p>ã€€ã€€æœ€è¿‘é‚„æ˜¯æ¯”è¼ƒå¿™å•Šï¼Œè¦å­¸è»Šï¼Œæœ‰å€‹å¯§å·¥åŸºé‡‘æœƒç¶²ç«™ã€æ¸¯åŸé—œä¿‚ç ”ç©¶æ‰€ç¶²ç«™ä»¥åŠåœ‹éš›æ¸¯å£èˆ‡ç‰©æµä¸­å¿ƒç¶²ç«™ï¼Œç„¶å¾Œåœ˜å€å§”é‚£é‚Šçš„å¿—é¡˜è€…ç¶²ç«™é‚„æœ‰é»å°å°¾å·´ï¼Œæµ™æ±Ÿèƒ½æºé›†åœ˜é‚£å€‹ç”¨C#å¯«çš„å“¡å·¥ç‰†å®Œå·¥äº†é‚„ä¸çŸ¥é“é‚£é‚Šæ€éº¼èªªï¼Œæ¥ç€æ‡‰è©²é‚„æœ‰ä¸€å€‹å§œè€å¸«é‚£é‚Šçš„ç«™å­ã€‚éƒ½å †åœ¨ä¸€å¨äº†ã€‚ä¸éæœ€è¿‘æœ€è¦ç·Šçš„é‚„æ˜¯é€™å€‹éŠæˆ²ä»¥åŠåŸºé‡‘æœƒç¶²ç«™ä»¥åŠå»è¥¿ç­ç‰™å¯¦ç¿’çš„ä¸€äº›ç›¸é—œäº‹å®œäº†ã€‚ä¸ç®¡äº†ï¼Œå…ˆç¡è¦ºã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€æœ€è¿‘ç¶²ä¹‹éŠåœ¨å’Œæ£’å­ä¸€èµ·é–‹ç™¼ä¸€å€‹é¡ä¼¼è³­åšçš„ç¶²éŠï¼ˆåˆ¥ç‰†æˆ‘ï¼Œåšå¥½æ˜¯çµ¦æ£’å­è‡ªå·±ç©çš„ï¼‰ï¼Œç„¶å¾Œæ©Ÿç·£å·§åˆï¼Œä»–å€‘çš„å¼•æ“æ˜¯çµåˆäº†MFCä»¥åŠå¾æˆ‘ç”¨éçš„å¹¾å€‹å¼•æ“ä¹‹ä¸€ç§»æ¤éä¾†çš„ã€‚å°±å¼•æ“æœ¬èº«è€Œè¨€å¾ˆå¼·å¤§ï¼Œç„¶å¾Œæˆ‘åˆæœ‰ä¸€é»å°ç¶“é©—ï¼Œæ‰€ä»¥ç¶²ä¹‹éŠçš„æŸ¯ç¸½ä¾¿ä¹Ÿè®“æˆ‘åŠ å…¥äº†é–‹ç™¼è¡Œåˆ—ã€‚ä¹‹å‰ä¹Ÿæ˜¯è¨—ç¶²ä¹‹éŠçš„ç¦è®“æˆ‘ç ”ç©¶äº†ä¸€]]>
    </summary>
    
      <category term="ç‰¢é¨·" scheme="http://xcoder.in/tags/%E7%89%A2%E9%A8%B7/"/>
    
      <category term="ç¶²ä¹‹éŠ" scheme="http://xcoder.in/tags/%E7%B6%B2%E4%B9%8B%E9%81%8A/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="éŠæˆ²é–‹ç™¼" scheme="http://xcoder.in/tags/%E9%81%8A%E6%88%B2%E9%96%8B%E7%99%BC/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[C++å°è±¡å·¥å» æ¨¡å¼ï¼šObjectFactoryå­¸ç¿’ç­†è¨˜]]></title>
    <link href="http://xcoder.in/2010/11/17/objectfactory-learning/"/>
    <id>http://xcoder.in/2010/11/17/objectfactory-learning/</id>
    <published>2010-11-17T07:49:45.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€å°è±¡å·¥å» ï¼Œé¡§åæ€ç¾©ï¼Œå°±æ˜¯ç”¢ç”Ÿå°è±¡çš„ä¸€å€‹â€œå·¥å» â€ã€‚æ ¹æ“šå‚³å…¥çš„ä¸€å€‹åƒæ•¸è€Œç”¢ç”Ÿç›¸æ‡‰çš„ä¸åŒç¨®é¡çš„å°è±¡ã€‚</p>
<p>ã€€ã€€ç”¨æ–¼æ‰¹é‡ç”ŸæˆåŒä¸€å€‹çˆ¶é¡çš„ä¸åŒå­é¡çš„å°è±¡æ™‚ç”¨åˆ°ã€‚</p>
<p>ã€€ã€€æœ¬å­¸ç¿’ç­†è¨˜åŸºæ–¼Singletonï¼ˆå–®ä»¶æ¨¡å¼ï¼‰åŸºç¤ä¸Šé€²è¡Œæ“´å±•ã€‚</p>
<p>ã€€ã€€çœ‹ã€ŠC++å–®ä»¶æ¨¡å¼ï¼šSingletonå­¸ç¿’ç­†è¨˜ã€‹è«‹é»æ“Š<a href="/2010/11/13/singleton-learning/">éˆæ¥</a>ã€‚</p>
<p>ã€€ã€€å°æ–¼å·¥å» æ¨¡å¼ï¼Œç¶²ä¸Šæœ‰å¾ˆå¤šä¸åŒçš„å¯¦ç¾æ–¹æ³•ã€‚æˆ‘é€™è£æ˜¯ä¸€å€‹HGEçš„RPG Demoä¸­æ‰€ç”¨çš„ï¼Œé€™æ®µä»£ç¢¼æœ¬èº«å¯«çš„éå¸¸çš„å¥½ï¼Œé–‹å§‹å¥½äº›èªå¥æ²’çœ‹æ‡‚ï¼Œé›–ç„¶å°±é€™éº¼å¹¾å¥è©±ã€‚èŠ±äº†ä¸€é»æ™‚é–“å»ç ”ç©¶äº†å…¶ä»£ç¢¼ï¼Œä¸¦è‡ªå·±é‡æ–°å¯¦ç¾äº†ä¸€éï¼ŒåŠ ä¸Šäº†é€šä¿—æ˜“æ‡‚çš„è¨»é‡‹ã€‚</p>
<p>ã€€ã€€å·¥å» é¡ä»¥æ¨¡æ¿å½¢å¼å¯¦ç¾ï¼ŒåŸºæ–¼Singletonï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**--------------------------------</span><br><span class="line"> * å°è±¡å·¥å» æ¨¡å¼(Object Factory)</span><br><span class="line"> *</span><br><span class="line"> * Code by XadillaX</span><br><span class="line"> * http://www.xcoder.in</span><br><span class="line"> * Created at 2010-11-17 1:33</span><br><span class="line"> */</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifndef</span> OBJECTFACTORY_H</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> OBJECTFACTORY_H</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"../å–®ä»¶æ¨¡å¼/Singleton.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> ObjectFactory : <span class="keyword">public</span> Singleton&lt;ObjectFactory&lt;T&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> T* (*tCreator)();                               <span class="comment">///&lt; é‡å®šç¾©å°è±¡ç”Ÿæˆå‡½æ•¸æŒ‡é‡</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>, tCreator&gt; tCreatorMap;    <span class="comment">///&lt; å°è±¡ç”Ÿæˆå‡½æ•¸æŒ‡é‡map</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief è¨»å†Šæ–°â€œç”Ÿç”¢è»Šé–“â€</span><br><span class="line">     * å°‡ç”Ÿæˆå°è±¡çš„å‡½æ•¸åŠ å…¥å°è±¡å·¥å» </span><br><span class="line">     *</span><br><span class="line">     * @param *name é¡åç¨±</span><br><span class="line">     * @param procedure â€œç”Ÿç”¢â€å°è±¡çš„å‡½æ•¸</span><br><span class="line">     * @return æ˜¯å¦æˆåŠŸè¨»å†Š</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Register</span><span class="params">(<span class="keyword">char</span> *type, tCreator procedure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief æ‰¾åˆ°â€œç”Ÿç”¢è»Šé–“â€</span><br><span class="line">     * æ ¹æ“šå‚³å…¥çš„é¡åè¿”å›ç›¸æ‡‰çš„æ–°å°è±¡çš„ç”Ÿæˆå‡½æ•¸</span><br><span class="line">     *</span><br><span class="line">     * @param &amp;type é¡å</span><br><span class="line">     * @return ç›¸æ‡‰çš„æ–°å°è±¡çš„ç”Ÿæˆå‡½æ•¸</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">T* <span class="title">Create</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;type)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/** â€œç”Ÿç”¢è»Šé–“â€æ˜ å°„ */</span></span><br><span class="line">    tCreatorMap _map;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span><br><span class="line"><span class="keyword">bool</span> ObjectFactory&lt;T&gt;::Register(<span class="keyword">char</span> *type, tCreator procedure)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">tmp</span><span class="params">(type)</span></span>;</span><br><span class="line">    <span class="comment">/** å°‡æ–°å‡½æ•¸åŠ å…¥mapä¸­ */</span></span><br><span class="line">    _map[tmp] = procedure;</span><br><span class="line">    <span class="keyword">return</span> _map[tmp];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span><br><span class="line">T* ObjectFactory&lt;T&gt;::Create(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;type)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/** åœ¨æ˜ å°„ä¸­æ‰¾åˆ°ç›¸æ‡‰â€œç”Ÿç”¢è»Šé–“â€ */</span></span><br><span class="line">    tCreatorMap::iterator iter = _map.find(type);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** æª¢æ¸¬â€œè»Šé–“â€æ˜¯å¦å­˜åœ¨ */</span></span><br><span class="line">    <span class="keyword">if</span>(iter != _map.end())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/** è®“è¿”å›å€¼çˆ²ç›¸æ‡‰çš„â€œç”Ÿç”¢è»Šé–“â€ */</span></span><br><span class="line">        tCreator r = iter-&gt;second;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** è¿”å›â€œç”Ÿç”¢è»Šé–“â€ */</span></span><br><span class="line">        <span class="keyword">return</span> r();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€ä»¥ä¸Šå°±æ˜¯åŸºæ–¼å–®ä»¶æ¨¡å¼è€Œå¯¦ç¾çš„å·¥å» æ¨¡å¼äº†ã€‚</p>
<p>ã€€ã€€åœ¨æ¨£ä¾‹ä¸­ï¼Œæˆ‘å»ºç«‹äº†ä¸€å€‹åŸºé¡Baseï¼Œç„¶å¾Œç”¨Aå’ŒBä¾†ç¹¼æ‰¿å®ƒã€‚</p>
<p>ã€€ã€€åœ¨ä¸€å€‹forå¾ªç’°ä¸­ï¼Œäº¤æ›¿å»ºç«‹äº†Aå°è±¡å’ŒBå°è±¡ã€‚é€™åªæ˜¯ä¸€å€‹Demoï¼Œçœ‹ä¸å‡ºæœ‰ä»€éº¼æ–¹ä¾¿çš„ï¼Œæ„Ÿè¦ºç”¨ä¸€å€‹ifä¾†å„è‡ªç”Ÿæˆå°±å¥½äº†ï¼Œå°±åƒ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(type == <span class="string">"A"</span>) p = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">else</span> p = <span class="keyword">new</span> B();</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€<strong>ç•¶ç„¶ï¼Œä¸Šé¢ä¹Ÿæ˜¯ä¸€ç¨®æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œè©¦æƒ³ä¸€ä¸‹ï¼Œæˆ‘å€‘å°‡è¦å‰µå»ºçš„Aã€Bã€Cã€Dã€Eã€Fã€Gé¡æ”¾åˆ°ä¸€å€‹é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶å¾Œæˆ‘å€‘å¾é…ç½®æ–‡ä»¶ä¸­è®€å–é€™äº›æ•¸æ“šä¸¦å‰µå»ºç›¸æ‡‰çš„å°è±¡ï¼Œä¸¦ä¸”é€™äº›å°è±¡çš„é †åºæ˜¯æ‰“äº‚çš„ï¼Œä½ å°±è¦æœ‰nå€‹ifä¾†åˆ¤æ–·äº†ï¼Œè€Œä¸”æ“´å±•æ€§ä¸é«˜ã€‚ç”¨ä¸€å€‹å°è±¡å·¥å» é€²è¡Œå°è£çš„è©±ï¼Œå„¼ç„¶å½¢æˆäº†ä¸€å€‹éœè€Œæœ‰åºçš„ç”Ÿç”¢å·¥å» ï¼Œæœ‰ç§©åºåœ°ç®¡ç†ç€ä¸åŒçš„å°è±¡è»Šé–“ï¼Œä¸è¦ºå¾—é€™æ˜¯ä¸€ä»¶éå¸¸ç¾å¦™çš„äº‹æƒ…éº¼ï¼Ÿ</strong></p>
<p>ã€€ã€€å¥½äº†ï¼Œè©±ä¸å¤šèªªï¼Œç›´æ¥ä¸ŠDemoã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"ObjectFactory.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">/** åŸºé¡ */</span></span><br><span class="line"><span class="keyword">class</span> Base;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Baseé¡åŠå…¶å­é¡çš„å°è±¡å·¥å»  */</span></span><br><span class="line"><span class="keyword">typedef</span> ObjectFactory&lt;Base&gt; BaseFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Base</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Base()&#123;&#125;;</span><br><span class="line">    ~Base()&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> A : <span class="keyword">public</span> Base</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A()&#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"An A object created."</span> &lt;&lt; endl; &#125;;</span><br><span class="line">    ~A()&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> B : <span class="keyword">public</span> Base</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B()&#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"A B object Created."</span> &lt;&lt; endl; &#125;</span><br><span class="line">    ~B();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å°è±¡Açš„â€œç”Ÿç”¢è»Šé–“â€ */</span></span><br><span class="line"><span class="function">Base* <span class="title">ACreator</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> A();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å°è±¡Bçš„â€œç”Ÿç”¢è»Šé–“â€ */</span></span><br><span class="line"><span class="function">Base* <span class="title">BCreator</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> B();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief ä¸»å‡½æ•¸</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** å°‡Aã€Bçš„â€œç”Ÿç”¢è»Šé–“â€è¨»å†Šåˆ°å°è±¡å·¥å» ä¸­ */</span></span><br><span class="line">    <span class="keyword">bool</span> AFlag = BaseFactory::Instance().Register(<span class="string">"A"</span>, ACreator);</span><br><span class="line">    <span class="keyword">bool</span> BFlag = BaseFactory::Instance().Register(<span class="string">"B"</span>, BCreator);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** è‹¥è¨»å†Šå¤±æ•—å‰‡é€€å‡º */</span></span><br><span class="line">    <span class="keyword">if</span>(!AFlag || !BFlag) <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    Base *p;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> type = (i % <span class="number">2</span>) ? <span class="built_in">string</span>(<span class="string">"A"</span>) : <span class="built_in">string</span>(<span class="string">"B"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** pç”¨ç›¸æ‡‰â€œç”Ÿç”¢è»Šé–“â€é€²è¡Œç”Ÿç”¢ */</span></span><br><span class="line">        p = BaseFactory::Instance().Create(type);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€å°è±¡å·¥å» ï¼Œé¡§åæ€ç¾©ï¼Œå°±æ˜¯ç”¢ç”Ÿå°è±¡çš„ä¸€å€‹â€œå·¥å» â€ã€‚æ ¹æ“šå‚³å…¥çš„ä¸€å€‹åƒæ•¸è€Œç”¢ç”Ÿç›¸æ‡‰çš„ä¸åŒç¨®é¡çš„å°è±¡ã€‚</p>
<p>ã€€ã€€ç”¨æ–¼æ‰¹é‡ç”ŸæˆåŒä¸€å€‹çˆ¶é¡çš„ä¸åŒå­é¡çš„å°è±¡æ™‚ç”¨åˆ°ã€‚</p>
<p>ã€€ã€€æœ¬å­¸ç¿’ç­†è¨˜åŸºæ–¼Singletonï¼ˆå–®ä»¶æ¨¡å¼ï¼‰åŸºç¤ä¸Šé€²è¡Œæ“´å±•ã€‚</p>
<p>ã€€ã€€çœ‹ã€ŠC++]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è¨­è¨ˆæ¨¡å¼" scheme="http://xcoder.in/tags/%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[C++å–®ä»¶æ¨¡å¼ï¼šSingletonå­¸ç¿’ç­†è¨˜]]></title>
    <link href="http://xcoder.in/2010/11/13/singleton-learning/"/>
    <id>http://xcoder.in/2010/11/13/singleton-learning/</id>
    <published>2010-11-13T07:44:15.000Z</published>
    <updated>2015-11-27T07:22:28.000Z</updated>
    <content type="html"><![CDATA[<p>ã€€ã€€å–®ä»¶æ¨¡å¼ï¼ˆSingletonï¼‰æ˜¯ä¸€ç¨®ç”¨æ–¼ç¢ºä¿æ•´å€‹æ‡‰ç”¨ç¨‹åºä¸­åªæœ‰ä¸€å€‹é¡å¯¦ä¾‹ä¸”é€™å€‹å¯¦ä¾‹æ‰€ä½”è³‡æºåœ¨æ•´å€‹æ‡‰ç”¨ç¨‹åºä¸­æ˜¯å…±äº«æ™‚çš„ç¨‹åºè¨­è¨ˆæ–¹æ³•ï¼ˆæ ¹æ“šå¯¦éš›æƒ…æ³ï¼Œå¯èƒ½éœ€è¦å¹¾å€‹é¡å¯¦ä¾‹ï¼‰ã€‚åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œé€™ç¨®ç¨‹åºè¨­è¨ˆæ–¹æ³•æ˜¯å¾ˆæœ‰ç”¨è™•çš„ã€‚</p>
<p>ã€€ã€€åœ¨å°å°åœ°å­¸ç¿’äº†ä¸€ä¸‹C++çš„å–®ä»¶æ¨¡å¼ä¹‹å¾Œï¼Œçªç„¶è¯æƒ³åˆ°PHPçš„ThinkPHPçš„MVCæ¡†æ¶ï¼Œè¦ºå¾—é€™å°±æ˜¯ä¸€å€‹å–®ä»¶æ¨¡å¼çš„å¾ˆå¥½å¯¦ä¾‹å§ï¼Ÿ</p>
<p>ã€€ã€€æˆ‘ä¸Šæ¬¡åœ¨PUDNä¸Šè¼‰äº†ä¸€å€‹HGEçš„RPG Demoï¼Œè£é¢å°±ç”¨äº†Singletonæ¨¡å¼é‚„æœ‰ObjectFactoryæ¨¡å¼å¯«çš„ã€‚æ²’çœ‹æ‡‚ï¼Œæ–¼æ˜¯å•äº†è°·æ­Œã€‚</p>
<blockquote>
<p>Singletonå¯ä»¥èªªæ˜¯ã€ŠDesign Patternã€‹ä¸­æœ€ç°¡å–®ä¹Ÿæœ€å¯¦ç”¨çš„ä¸€å€‹è¨­è¨ˆæ¨¡å¼ã€‚é‚£éº¼ï¼Œä»€éº¼æ˜¯Singletonï¼Ÿ<br>é¡§åæ€ç¾©ï¼ŒSingletonå°±æ˜¯ç¢ºä¿ä¸€å€‹é¡åªæœ‰å”¯ä¸€çš„ä¸€å€‹å¯¦ä¾‹ã€‚Singletonä¸»è¦ç”¨æ–¼å°è±¡çš„å‰µå»ºï¼Œé€™æ„å‘³ç€ï¼Œå¦‚æœæŸå€‹é¡æ¡ç”¨äº†Singletonæ¨¡å¼ï¼Œå‰‡åœ¨é€™å€‹é¡è¢«å‰µå»ºå¾Œï¼Œå®ƒå°‡æœ‰ä¸”åƒ…æœ‰ä¸€å€‹å¯¦ä¾‹å¯ä¾›è¨ªå•ã€‚å¾ˆå¤šæ™‚å€™æˆ‘å€‘éƒ½æœƒéœ€è¦Singletonæ¨¡å¼ï¼Œæœ€å¸¸è¦‹çš„æ¯”å¦‚æˆ‘å€‘å¸Œæœ›æ•´å€‹æ‡‰ç”¨ç¨‹åºä¸­åªæœ‰ä¸€å€‹é€£æ¥æ•¸æ“šåº«çš„Connectionå¯¦ä¾‹ï¼›åˆæ¯”å¦‚è¦æ±‚ä¸€å€‹æ‡‰ç”¨ç¨‹åºä¸­åªå­˜åœ¨æŸå€‹ç”¨æˆ¶æ•¸æ“šçµæ§‹çš„å”¯ä¸€å¯¦ä¾‹ã€‚æˆ‘å€‘éƒ½å¯ä»¥é€šéæ‡‰ç”¨Singletonæ¨¡å¼é”åˆ°ç›®çš„ã€‚</p>
<p>ä¸€çœ¼çœ‹å»ï¼ŒSingletonä¼¼ä¹æœ‰äº›åƒå…¨å±€å°è±¡ã€‚ä½†æ˜¯å¯¦éš›ä¸Šï¼Œä¸¦ä¸èƒ½ç”¨å…¨å±€å°è±¡ä»£æ›¿Singletonæ¨¡å¼ï¼Œé€™æ˜¯å› çˆ²ï¼šå…¶ä¸€ï¼Œå¤§é‡ä½¿ç”¨å…¨å±€å°è±¡æœƒä½¿å¾—ç¨‹åºè³ªé‡é™ä½ï¼Œè€Œä¸”æœ‰äº›ç·¨ç¨‹èªè¨€ä¾‹å¦‚C#ï¼Œæ ¹æœ¬å°±ä¸æ”¯æŒå…¨å±€è®Šé‡ã€‚å…¶äºŒï¼Œå…¨å±€å°è±¡çš„æ–¹æ³•ä¸¦ä¸èƒ½é˜»æ­¢äººå€‘å°‡ä¸€å€‹é¡å¯¦ä¾‹åŒ–å¤šæ¬¡ï¼šé™¤äº†é¡çš„å…¨å±€å¯¦ä¾‹å¤–ï¼Œé–‹ç™¼äººå“¡ä»ç„¶å¯ä»¥é€šéé¡çš„æ§‹é€ å‡½æ•¸å‰µå»ºé¡çš„å¤šå€‹å±€éƒ¨å¯¦ä¾‹ã€‚è€ŒSingletonæ¨¡å¼å‰‡é€šéå¾æ ¹æœ¬ä¸Šæ§åˆ¶é¡çš„å‰µå»ºï¼Œå°‡â€ä¿è­‰åªæœ‰ä¸€å€‹å¯¦ä¾‹â€é€™å€‹ä»»å‹™äº¤çµ¦äº†é¡æœ¬èº«ï¼Œé–‹ç™¼äººå“¡ä¸å¯èƒ½å†æœ‰å…¶å®ƒé€”å¾‘å¾—åˆ°é¡çš„å¤šå€‹å¯¦ä¾‹ã€‚é€™ä¸€é»æ˜¯å…¨å±€å°è±¡æ–¹æ³•èˆ‡Singletonæ¨¡å¼çš„æ ¹æœ¬å€åˆ¥ã€‚</p>
<p style="text-align: right;">â€”â€”æ‘˜è‡ªç™¾åº¦ç™¾ç§‘ï¼ˆæˆ‘ä¸æ˜¯æœ‰æ„åœ¨è°·æ­Œæ‰¾ç™¾åº¦çš„ï¼‰</p>

</blockquote>
<p>ã€€ã€€æˆ‘åœ¨çœ‹äº†é€™å€‹RPG Demoçš„Patternè£çš„Singletonä¹‹å¾Œï¼Œä»¿ç…§ç€è‡ªå·±å¯«äº†ä¸€å€‹æœ€ç°¡å–®çš„Singletonæ¨¡æ¿å¯¦ä¾‹ã€‚</p>
<p>ã€€ã€€<strong><em>æ€æƒ³å°±æ˜¯ï¼Œåœ¨Singletonä¸­å»ºç«‹ä¸€å€‹éœæ…‹å°è±¡ï¼Œç„¶å¾Œä»¥å¾Œå°±ç”¨ <code>Singleton::Instance()</code> ä¾†èª¿ç”¨é€™å€‹éœæ…‹å°è±¡ã€‚</em></strong></p>
<p>ã€€ã€€<strong><em>è€Œä½œçˆ²æ¨¡æ¿å°±æ˜¯å¯ä»¥ <code>class A : public Singleton</code> ä¾†è®“Aç¹¼æ‰¿Singletonçš„å±¬æ€§ï¼Œé‚£éº¼æˆ‘å€‘å°±å¯ä»¥ç›´æ¥ç”¨<br><code>A::Instance()</code> ä¾†è¨ªå•Aé€™å€‹éœæ…‹å°è±¡äº†ã€‚é€™å€‹å°±æ˜¯é€™æ®µSingletonä»£ç¢¼çš„ä¸»è¦æ€æƒ³äº†ã€‚</em></strong></p>
<p>ã€€ã€€å…ˆæ˜¯å»ºç«‹äº†ä¸€å€‹ç©ºå·¥ç¨‹ï¼Œå¾€è£é¢æ”¾äº†ï¼š</p>
<p>ã€€ã€€Singleton.h</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifndef</span> SINGLETON_H</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> SINGLETON_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> Singleton</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> T&amp; <span class="title">Instance</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Singleton()&#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~Singleton()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * é˜²æ­¢æ‹·è²è¤‡è£½</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Singleton(<span class="keyword">const</span> Singleton &amp;);</span><br><span class="line">    Singleton &amp; <span class="keyword">operator</span> = (<span class="keyword">const</span> Singleton &amp;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span><br><span class="line">T&amp; Singleton::Instance()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/** å»ºç«‹ä¸€å€‹éœæ…‹å°è±¡ */</span></span><br><span class="line">    <span class="keyword">static</span> T instance;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€TestSingleton.h</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifndef</span> TESTSINGLETON_H</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> TESTSINGLETON_H</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"Singleton.h"</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> TestSingleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å¾Singletonç¹¼æ‰¿æœ¬é¡ */</span></span><br><span class="line"><span class="keyword">class</span> TestSingleton : <span class="keyword">public</span> Singleton</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    TestSingleton(<span class="keyword">void</span>);</span><br><span class="line">    <span class="keyword">virtual</span> ~TestSingleton(<span class="keyword">void</span>);</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AddCount</span><span class="params">()</span></span>&#123; count++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CoutCount</span><span class="params">()</span></span>&#123; <span class="built_in">cout</span> &lt;&lt; count &lt;&lt; endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>ã€€ã€€TestSingleton.cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"TestSingleton.h"</span></span></span><br><span class="line"></span><br><span class="line">TestSingleton::TestSingleton(<span class="keyword">void</span>)</span><br><span class="line">: count(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TestSingleton::~TestSingleton(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€€ã€€main.cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"TestSingleton.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/** å–®ä»¶å°è±¡countå€¼åŠ 1 */</span></span><br><span class="line">        TestSingleton::Instance().AddCount();</span><br><span class="line">        <span class="comment">/** è¼¸å‡ºæ­¤å–®ä»¶å°è±¡çš„countå€¼ */</span></span><br><span class="line">        TestSingleton::Instance().CoutCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>ã€€ã€€å–®ä»¶æ¨¡å¼ï¼ˆSingletonï¼‰æ˜¯ä¸€ç¨®ç”¨æ–¼ç¢ºä¿æ•´å€‹æ‡‰ç”¨ç¨‹åºä¸­åªæœ‰ä¸€å€‹é¡å¯¦ä¾‹ä¸”é€™å€‹å¯¦ä¾‹æ‰€ä½”è³‡æºåœ¨æ•´å€‹æ‡‰ç”¨ç¨‹åºä¸­æ˜¯å…±äº«æ™‚çš„ç¨‹åºè¨­è¨ˆæ–¹æ³•ï¼ˆæ ¹æ“šå¯¦éš›æƒ…æ³ï¼Œå¯èƒ½éœ€è¦å¹¾å€‹é¡å¯¦ä¾‹ï¼‰ã€‚åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œé€™ç¨®ç¨‹åºè¨­è¨ˆæ–¹æ³•æ˜¯å¾ˆæœ‰ç”¨è™•çš„ã€‚</p>
<p>ã€€ã€€åœ¨å°å°åœ°å­¸ç¿’äº†ä¸€ä¸‹C++çš„å–®ä»¶æ¨¡å¼ä¹‹å¾Œï¼Œ]]>
    </summary>
    
      <category term="C++" scheme="http://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
      <category term="è¨­è¨ˆæ¨¡å¼" scheme="http://xcoder.in/tags/%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="è€åšå®¢å‚™ä»½æ­¸æª”" scheme="http://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%82%99%E4%BB%BD%E6%AD%B8%E6%AA%94/"/>
    
  </entry>
  
</feed>
