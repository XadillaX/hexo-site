<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>è‰¾å…‹æ–¯ã®ç¼–ç è€…</title>
  
  <subtitle>ä¸€ä¸ªä¼ªå®…çº§åˆ«çš„ç ç•œã€‚</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://xcoder.in/"/>
  <updated>2017-12-13T05:15:26.509Z</updated>
  <id>https://xcoder.in/</id>
  
  <author>
    <name>æ­»æœˆÂ·åƒåœ¡è•¾ç‰¹</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Node.js ä¸­é‡åˆ°å«ç©ºæ ¼ URL çš„ç¥å¥‡â€œBugâ€â€”â€”å°èŒƒå›´æ·±å…¥ HTTP åè®®</title>
    <link href="https://xcoder.in/2017/12/13/node-http-parser-spaces-in-url/"/>
    <id>https://xcoder.in/2017/12/13/node-http-parser-spaces-in-url/</id>
    <published>2017-12-13T01:16:45.000Z</published>
    <updated>2017-12-13T05:15:26.509Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://zhuanlan.zhihu.com/p/31966196" target="_blank" rel="external">æœ¬æ–‡</a>é¦–å‘äºçŸ¥ä¹ä¸“æ <a href="https://zhuanlan.zhihu.com/xtech" target="_blank" rel="external">èš‚èšé‡‘æœä½“éªŒç§‘æŠ€</a>ã€‚</p></blockquote><p>é¦–å…ˆå£°æ˜ï¼Œæˆ‘åœ¨â€œBugâ€å­—çœ¼ä¸ŠåŠ äº†å¼•å·ï¼Œè‡ªç„¶æ˜¯ä¸ºäº†è¯´æ˜å®ƒå¹¶éä¸€ä¸ªçœŸ Bugã€‚</p><h2 id="é—®é¢˜æŠ›å‡º"><a href="#é—®é¢˜æŠ›å‡º" class="headerlink" title="é—®é¢˜æŠ›å‡º"></a>é—®é¢˜æŠ›å‡º</h2><p>æ˜¨å¤©æœ‰ä¸ªç«¥é‹åœ¨çœ‹åå°ç›‘æ§çš„æ—¶å€™ï¼Œçªç„¶å‘ç°äº†ä¸€ä¸ªé”™è¯¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[error] 000001#0: ... upstream prematurely closed connection while reading response header from upstream.</span><br><span class="line">  client: 10.10.10.10</span><br><span class="line">  server: foo.com</span><br><span class="line">  request: &quot;GET /foo/bar?rmicmd,begin run clean docker images job HTTP/1.1&quot;</span><br><span class="line">  upstream: &quot;http://...&quot;</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ„æ€å°±æ˜¯è¯´ï¼šä¸€å°æœåŠ¡å™¨é€šè¿‡ HTTP åè®®å»è¯·æ±‚å¦ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå•æ–¹é¢è¢«å¯¹æ–¹æœåŠ¡å™¨æ–­å¼€äº†è¿æ¥â€”â€”å¹¶ä¸”å¹¶æ²¡æœ‰ä»»ä½•è¿”å›ã€‚</p><h2 id="å¼€å§‹é‡ç°"><a href="#å¼€å§‹é‡ç°" class="headerlink" title="å¼€å§‹é‡ç°"></a>å¼€å§‹é‡ç°</h2><h3 id="å®¢æˆ·ç«¯-CURL-æŒ‡ä»¤"><a href="#å®¢æˆ·ç«¯-CURL-æŒ‡ä»¤" class="headerlink" title="å®¢æˆ·ç«¯ CURL æŒ‡ä»¤"></a>å®¢æˆ·ç«¯ CURL æŒ‡ä»¤</h3><p>å…¶å®è¿™æ¬¡è¯·æ±‚çš„ä¸€äº›çŒ«è…»å¾ˆå®¹æ˜“å°±èƒ½å‘ç°â€”â€”åœ¨ URL ä¸­æœ‰ç©ºæ ¼ã€‚æ‰€ä»¥æˆ‘ä»¬èƒ½ç®€åŒ–å‡ºä¸€æ¡æœ€ç®€å•çš„ CURL æŒ‡ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ curl <span class="string">"http://foo/bar baz"</span> -v</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„ï¼š</strong>ä¸å¸¦ä»»ä½•è½¬ä¹‰ã€‚</p></blockquote><h3 id="æœ€å°-Node-js-æºç "><a href="#æœ€å°-Node-js-æºç " class="headerlink" title="æœ€å° Node.js æºç "></a>æœ€å° Node.js æºç </h3><p>å¥½çš„ï¼Œé‚£ä¹ˆæ¥ä¸‹å»å¼€å§‹å†™ç›¸åº”çš„æœ€ç®€å•çš„ Node.js HTTP æœåŠ¡ç«¯æºç ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, resp</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ğŸŒš'</span>);</span><br><span class="line">    resp.end(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">5555</span>);</span><br></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆï¼Œå¯åŠ¨è¿™æ®µ Node.js ä»£ç ï¼Œå¼€å§‹è¯•è¯•çœ‹ä¸Šé¢çš„æŒ‡ä»¤å§ã€‚</p><p>å¦‚æœä½ ä¹Ÿæ­£åœ¨è·Ÿç€å°è¯•è¿™ä»¶äº‹æƒ…çš„è¯ï¼Œä½ å°±ä¼šå‘ç° Node.js çš„å‘½ä»¤è¡Œæ²¡æœ‰è¾“å‡ºä»»ä½•ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯å˜²è®½çš„ <code>&#39;ğŸŒš&#39;</code>ï¼Œè€Œåœ¨ CURL çš„ç»“æœä¸­ï¼Œä½ å°†ä¼šçœ‹è§ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl &apos;http://127.0.0.1:5555/d d&apos; -v</span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 5555 (#0)</span><br><span class="line">&gt; GET /d d HTTP/1.1</span><br><span class="line">&gt; Host: 127.0.0.1:5555</span><br><span class="line">&gt; User-Agent: curl/7.54.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">* Empty reply from server</span><br><span class="line">* Connection #0 to host 127.0.0.1 left intact</span><br><span class="line">curl: (52) Empty reply from server</span><br></pre></td></tr></table></figure><p>ç§ï¼Œ<strong>Empty reply from server</strong>ã€‚</p><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>å‘ç°äº†é—®é¢˜ä¹‹åï¼Œå°±æœ‰å¦ä¸€ä¸ªé—®é¢˜å€¼å¾—æ€è€ƒäº†ï¼šå°± Node.js ä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Œè¿˜æ˜¯å…¶å®ƒä¸€äº› HTTP æœåŠ¡å™¨ä¹Ÿä¼šæœ‰è¿™ç§æƒ…å†µå‘¢ã€‚</p><p>äºæ˜¯æ‹¿å°ç™½é¼  Nginx åšäº†ä¸ªå®éªŒã€‚æˆ‘å†™äº†è¿™ä¹ˆä¸€ä¸ªé…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">5555</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">200</span> <span class="variable">$uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€ä¹Ÿæ‰§è¡Œä¸€é CURLï¼Œå¾—åˆ°äº†å¦‚ä¸‹çš„ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl &apos;http://127.0.0.1:5555/d d&apos; -v</span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 5555 (#0)</span><br><span class="line">&gt; GET /d d HTTP/1.1</span><br><span class="line">&gt; Host: 127.0.0.1:5555</span><br><span class="line">&gt; User-Agent: curl/7.54.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Server: openresty/1.11.2.1</span><br><span class="line">&lt; Date: Tue, 12 Dec 2017 09:07:56 GMT</span><br><span class="line">&lt; Content-Type: application/octet-stream</span><br><span class="line">&lt; Content-Length: 4</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt;</span><br><span class="line">* Connection #0 to host xcoder.in left intact</span><br><span class="line">/d d</span><br></pre></td></tr></table></figure><center><img src="word_bro.png"><br><small>å‰å®³äº†ï¼Œæˆ‘çš„ Nginx</small></center><p>äºæ˜¯ä¹ï¼Œç†æ‰€å½“ç„¶ï¼Œæˆ‘<strong>æš‚æ—¶</strong>å°†è¿™ä¸ªäº‹ä»¶å®šæ€§ä¸º Node.js çš„ä¸€ä¸ª Bugã€‚</p><h2 id="Node-js-æºç æ’æŸ¥"><a href="#Node-js-æºç æ’æŸ¥" class="headerlink" title="Node.js æºç æ’æŸ¥"></a>Node.js æºç æ’æŸ¥</h2><p>è®¤å®šäº†å®ƒæ˜¯ä¸ª Bug ä¹‹åï¼Œæˆ‘å°±å¼€å§‹äº†ä¸€è´¯çš„çœ‹æºç ç¯èŠ‚â€”â€”ç”±äºè¿™ä¸ª Bug çš„å¤ç°æ¡ä»¶æ¯”è¾ƒæ˜æ˜¾ï¼Œæˆ‘æš‚æ—¶å°†å…¶å®šæ€§ä¸ºâ€œNode.js HTTP æœåŠ¡ç«¯æ¨¡å—åœ¨æ¥åˆ°è¯·æ±‚åè§£æ HTTP æ•°æ®åŒ…çš„æ—¶å€™è§£æ URI æ—¶å‡ºäº†é—®é¢˜â€ã€‚</p><h3 id="http-js-gt-http-server-js-gt-http-common-js"><a href="#http-js-gt-http-server-js-gt-http-common-js" class="headerlink" title="http.js -&gt; _http_server.js -&gt; _http_common.js"></a>http.js -&gt; _http_server.js -&gt; _http_common.js</h3><blockquote><p>æºç ä»¥ <a href="https://github.com/nodejs/node/tree/v8.9.2" target="_blank" rel="external">Node.js 8.9.2</a> ä¸ºå‡†ã€‚</p></blockquote><p>è¿™é‡Œå…ˆé¢„ç•™ä¸€ä¸‹æˆ‘ä»¬èƒ½é©¬ä¸Šæƒ³åˆ°çš„ <strong>node_http_parser.cc</strong>ï¼Œè€Œå…ˆè®²è¿™å‡ ä¸ªæ–‡ä»¶ï¼Œæ˜¯æœ‰åŸå› çš„â€”â€”è¿™æ¶‰åŠåˆ°æœ€åçš„ä¸€ä¸ªåº”å¯¹æ–¹å¼ã€‚</p><p>é¦–å…ˆçœ‹çœ‹ <a href="https://github.com/nodejs/node/blob/v8.9.2/lib/http.js#L33-L35" target="_blank" rel="external"><strong>lib/http.js</strong></a> çš„ç›¸åº”æºç ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">const server = <span class="built_in">require</span>(<span class="string">'_http_server'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Server &#125; = server;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createServer</span>(<span class="params">requestListener</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Server(requestListener);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œé©¬ä¸Šè¿›å…¥ <strong>lib/_http_server.js</strong> çœ‹å§ã€‚</p><p>é¦–å…ˆæ˜¯åˆ›å»ºä¸€ä¸ª HttpParser å¹¶ç»‘ä¸Šç›‘å¬è·å–åˆ° HTTP æ•°æ®åŒ…åè§£æç»“æœçš„å›è°ƒå‡½æ•°çš„ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  parsers,</span><br><span class="line">  ...</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">'_http_common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connectionListener</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  var parser = parsers.alloc();</span><br><span class="line">  parser.reinitialize(HTTPParser.REQUEST);</span><br><span class="line">  parser.socket = socket;</span><br><span class="line">  socket.parser = parser;</span><br><span class="line">  parser.incoming = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  state.onData = socketOnData.bind(<span class="literal">undefined</span>, <span class="keyword">this</span>, socket, parser, state);</span><br><span class="line">  ...</span><br><span class="line">  socket.on(<span class="string">'data'</span>, state.onData);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">socketOnData</span>(<span class="params">server, socket, parser, state, d</span>) </span>&#123;</span><br><span class="line">  assert(!socket._paused);</span><br><span class="line">  debug(<span class="string">'SERVER socketOnData %d'</span>, d.length);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ret = parser.execute(d);</span><br><span class="line">  onParserExecuteCommon(server, socket, parser, state, ret, d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»æºç ä¸­æ–‡æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œå½“ä¸€ä¸ª HTTP è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œç›‘å¬å‡½æ•° <code>connectionListener()</code> ä¼šæ‹¿ç€ Socket å¯¹è±¡åŠ ä¸Šä¸€ä¸ª <code>data</code> äº‹ä»¶ç›‘å¬â€”â€”ä¸€æ—¦æœ‰è¯·æ±‚è¿æ¥è¿‡æ¥ï¼Œå°±å»æ‰§è¡Œ <code>socketOnData()</code> å‡½æ•°ã€‚</p><p>è€Œåœ¨ <code>socketOnData()</code> å‡½æ•°ä¸­ï¼Œåšçš„ä¸»è¦äº‹æƒ…å°±æ˜¯ <code>parser.execute(d)</code> æ¥è§£æ HTTP æ•°æ®åŒ…ï¼Œåœ¨è§£æå®Œæˆåæ‰§è¡Œä¸€ä¸‹å›è°ƒå‡½æ•° <code>onParserExecuteCommon()</code>ã€‚</p><p>è‡³äºè¿™ä¸ª <code>parser</code>ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°å®ƒæ˜¯ä» <a href="https://github.com/nodejs/node/blob/v8.9.2/lib/_http_common.js#L170-L193" target="_blank" rel="external"><strong>lib/_http_common.js</strong></a> ä¸­æ¥çš„ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> parsers = <span class="keyword">new</span> FreeList(<span class="string">'parsers'</span>, <span class="number">1000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> parser = <span class="keyword">new</span> HTTPParser(HTTPParser.REQUEST);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  parser[kOnHeaders] = parserOnHeaders;</span><br><span class="line">  parser[kOnHeadersComplete] = parserOnHeadersComplete;</span><br><span class="line">  parser[kOnBody] = parserOnBody;</span><br><span class="line">  parser[kOnMessageComplete] = parserOnMessageComplete;</span><br><span class="line">  parser[kOnExecute] = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> parser;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>èƒ½çœ‹å‡ºæ¥ <code>parsers</code> æ˜¯ <code>HTTPParser</code> çš„ä¸€æ¡ Free Listï¼ˆæ•ˆæœç±»ä¼¼äºæœ€ç®€æ˜“çš„åŠ¨æ€å†…å­˜æ± ï¼‰ï¼Œæ¯ä¸ª Parser åœ¨åˆå§‹åŒ–çš„æ—¶å€™ç»‘å®šä¸Šäº†å„ç§å›è°ƒå‡½æ•°ã€‚å…·ä½“çš„ä¸€äº›å›è°ƒå‡½æ•°å°±ä¸ç»†è®²äº†ï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯è‡ªè¡Œç¿»é˜…ã€‚</p><p>è¿™ä¹ˆä¸€æ¥ï¼Œé“¾è·¯å°±æ¯”è¾ƒæ˜æ™°äº†ï¼š</p><p><strong>è¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼ŒServer å¯¹è±¡ä¼šä¸ºè¯¥æ¬¡è¯·æ±‚çš„ Socket åˆ†é…ä¸€ä¸ª <code>HttpParser</code> å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ <code>execute()</code> å‡½æ•°è¿›è¡Œè§£æï¼Œåœ¨è§£æå®Œæˆåè°ƒç”¨ <code>onParserExecuteCommon()</code> å‡½æ•°ã€‚</strong></p><h3 id="node-http-parser-cc"><a href="#node-http-parser-cc" class="headerlink" title="node_http_parser.cc"></a>node_http_parser.cc</h3><p>æˆ‘ä»¬åœ¨ <strong>lib/_http_common.js</strong> ä¸­èƒ½å‘ç°ï¼Œ<code>HTTPParser</code> çš„å®ç°å­˜åœ¨äº <strong>src/node_http_parser.cc</strong> ä¸­ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> binding = process.binding(<span class="string">'http_parser'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; methods, HTTPParser &#125; = binding;</span><br></pre></td></tr></table></figure><blockquote><p>è‡³äºä¸ºä»€ä¹ˆ <code>const binding = process.binding(&#39;http_parser&#39;)</code> å°±æ˜¯å¯¹åº”åˆ° <strong>src/node_http_parser.cc</strong> æ–‡ä»¶ï¼Œä»¥åŠè¿™ä¸€å°èŠ‚ä¸­ä¸‹é¢çš„ä¸€äº› C++ æºç ç›¸å…³åˆ†æï¼Œä¸æ˜ç™½ä¸”æœ‰å…´è¶£çš„ç«¥é‹å¯è‡ªè¡Œå»é˜…è¯»æ›´æ·±ä¸€å±‚çš„æºç ï¼Œæˆ–è€…ç½‘ä¸Šæœç´¢ç­”æ¡ˆï¼Œæˆ–è€…æˆ‘æå‰æ— è€»ç¡¬å¹¿ä¸€ä¸‹æˆ‘å¿«è¦ä¸Šå¸‚çš„ä¹¦ã€ŠNode.jsï¼šæ¥ä¸€æ‰“ C++ æ‰©å±•ã€‹â€”â€”é‡Œé¢ä¹Ÿæœ‰è¯´æ˜ï¼Œä»¥åŠæˆ‘çš„æœ‰ä¸€åœºçŸ¥ä¹ Liveã€Šæ·±å…¥ç†è§£ Node.js åŒ…ä¸æ¨¡å—æœºåˆ¶ã€‹ã€‚</p></blockquote><p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬æ¥ä¸‹å»è¦çœ‹çš„å°±æ˜¯ <a href="https://github.com/nodejs/node/blob/v8.9.2/src/node_http_parser.cc#L796-L804" target="_blank" rel="external"><strong>src/node_http_parser.cc</strong></a> äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">env-&gt;SetProtoMethod(t, <span class="string">"close"</span>, Parser::Close);</span><br><span class="line">env-&gt;SetProtoMethod(t, <span class="string">"execute"</span>, Parser::Execute);</span><br><span class="line">env-&gt;SetProtoMethod(t, <span class="string">"finish"</span>, Parser::Finish);</span><br><span class="line">env-&gt;SetProtoMethod(t, <span class="string">"reinitialize"</span>, Parser::Reinitialize);</span><br><span class="line">env-&gt;SetProtoMethod(t, <span class="string">"pause"</span>, Parser::Pause&lt;<span class="literal">true</span>&gt;);</span><br><span class="line">env-&gt;SetProtoMethod(t, <span class="string">"resume"</span>, Parser::Pause&lt;<span class="literal">false</span>&gt;);</span><br><span class="line">env-&gt;SetProtoMethod(t, <span class="string">"consume"</span>, Parser::Consume);</span><br><span class="line">env-&gt;SetProtoMethod(t, <span class="string">"unconsume"</span>, Parser::Unconsume);</span><br><span class="line">env-&gt;SetProtoMethod(t, <span class="string">"getCurrentBuffer"</span>, Parser::GetCurrentBuffer);</span><br></pre></td></tr></table></figure><p>å¦‚ä»£ç ç‰‡æ®µæ‰€ç¤ºï¼Œå‰æ–‡ä¸­ <code>parser.execute()</code> æ‰€å¯¹åº”çš„å‡½æ•°å°±æ˜¯ <code>Parser::Execute()</code> äº†ã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">class Parser : public AsyncWrap &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  static void Execute(const FunctionCallbackInfo&lt;Value&gt;&amp; args) &#123;</span><br><span class="line">    Parser* parser;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    Local&lt;Object&gt; buffer_obj = args[0].As&lt;Object&gt;();</span><br><span class="line">    char* buffer_data = Buffer::Data(buffer_obj);</span><br><span class="line">    size_t buffer_len = Buffer::Length(buffer_obj);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    Local&lt;Value&gt; ret = parser-&gt;Execute(buffer_data, buffer_len);</span><br><span class="line"></span><br><span class="line">    if (!ret.IsEmpty())</span><br><span class="line">      args.GetReturnValue().Set(ret);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Local&lt;Value&gt; Execute(char* data, size_t len) &#123;</span><br><span class="line">    EscapableHandleScope scope(env()-&gt;isolate());</span><br><span class="line"></span><br><span class="line">    current_buffer_len_ = len;</span><br><span class="line">    current_buffer_data_ = data;</span><br><span class="line">    got_exception_ = false;</span><br><span class="line"></span><br><span class="line">    size_t nparsed =</span><br><span class="line">      http_parser_execute(&amp;parser_, &amp;settings, data, len);</span><br><span class="line"></span><br><span class="line">    Save();</span><br><span class="line"></span><br><span class="line">    // Unassign the 'buffer_' variable</span><br><span class="line">    current_buffer_.Clear();</span><br><span class="line">    current_buffer_len_ = 0;</span><br><span class="line">    current_buffer_data_ = nullptr;</span><br><span class="line"></span><br><span class="line">    // If there was an exception in one of the callbacks</span><br><span class="line">    if (got_exception_)</span><br><span class="line">      return scope.Escape(Local&lt;Value&gt;());</span><br><span class="line"></span><br><span class="line">    Local&lt;Integer&gt; nparsed_obj = Integer::New(env()-&gt;isolate(), nparsed);</span><br><span class="line">    // If there was a parse error in one of the callbacks</span><br><span class="line">    // TODO(bnoordhuis) What if there is an error on EOF?</span><br><span class="line">    if (!parser_.upgrade &amp;&amp; nparsed != len) &#123;</span><br><span class="line">      enum http_errno err = HTTP_PARSER_ERRNO(&amp;parser_);</span><br><span class="line"></span><br><span class="line">      Local&lt;Value&gt; e = Exception::Error(env()-&gt;parse_error_string());</span><br><span class="line">      Local&lt;Object&gt; obj = e-&gt;ToObject(env()-&gt;isolate());</span><br><span class="line">      obj-&gt;Set(env()-&gt;bytes_parsed_string(), nparsed_obj);</span><br><span class="line">      obj-&gt;Set(env()-&gt;code_string(),</span><br><span class="line">               OneByteString(env()-&gt;isolate(), http_errno_name(err)));</span><br><span class="line"></span><br><span class="line">      return scope.Escape(e);</span><br><span class="line">    &#125;</span><br><span class="line">    return scope.Escape(nparsed_obj);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿›å…¥ <code>Parser</code> çš„é™æ€ <code>Execute()</code> å‡½æ•°ï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒæŠŠä¼ è¿›æ¥çš„ <code>Buffer</code> è½¬åŒ–ä¸º C++ ä¸‹çš„ <code>char*</code> æŒ‡é’ˆï¼Œå¹¶è®°å½•å…¶æ•°æ®é•¿åº¦ï¼ŒåŒæ—¶å»æ‰§è¡Œå½“å‰è°ƒç”¨çš„ <code>parser</code> å¯¹è±¡æ‰€å¯¹åº”çš„ <code>Execute()</code> å‡½æ•°ã€‚</p><p>åœ¨è¿™ä¸ª <code>Execute()</code> å‡½æ•°ä¸­ï¼Œæœ‰ä¸ªæœ€é‡è¦çš„ä»£ç ï¼Œå°±æ˜¯ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">size_t</span> nparsed =</span><br><span class="line">    http_parser_execute(&amp;parser_, &amp;settings, data, len);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯è°ƒç”¨çœŸæ­£è§£æ HTTP æ•°æ®åŒ…çš„å‡½æ•°ï¼Œå®ƒæ˜¯ Node.js è¿™ä¸ªé¡¹ç›®çš„ä¸€ä¸ªè‡ªç ”ä¾èµ–ï¼Œå« <a href="https://github.com/nodejs/node/tree/v8.9.2/deps/http_parser" target="_blank" rel="external">http-parser</a>ã€‚å®ƒç‹¬ç«‹çš„é¡¹ç›®åœ°å€åœ¨ <a href="https://github.com/nodejs/http-parser" target="_blank" rel="external">https://github.com/nodejs/http-parser</a>ï¼Œæˆ‘ä»¬æœ¬æ–‡ä¸­ç”¨çš„æ˜¯ Node.js v8.9.2 ä¸­æ‰€ä¾èµ–çš„æºç ï¼Œåº”è¯¥ä¼šæœ‰åå·®ã€‚</p><h3 id="http-parser"><a href="#http-parser" class="headerlink" title="http-parser"></a>http-parser</h3><h4 id="HTTP-Request-æ•°æ®åŒ…ä½“"><a href="#HTTP-Request-æ•°æ®åŒ…ä½“" class="headerlink" title="HTTP Request æ•°æ®åŒ…ä½“"></a>HTTP Request æ•°æ®åŒ…ä½“</h4><blockquote><p>å¦‚æœä½ å·²ç»å¯¹ HTTP åŒ…ä½“äº†è§£äº†ï¼Œå¯ä»¥ç•¥è¿‡è¿™ä¸€èŠ‚ã€‚</p></blockquote><p>HTTP çš„ Request æ•°æ®åŒ…å…¶å®æ˜¯æ–‡æœ¬æ ¼å¼çš„ï¼Œåœ¨ Raw çš„çŠ¶æ€ä¸‹ï¼Œå¤§æ¦‚æ˜¯ä»¥è¿™æ ·çš„å½¢å¼å­˜åœ¨ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–¹æ³• URI HTTP/ç‰ˆæœ¬</span><br><span class="line">å¤´1: æˆ‘æ˜¯å¤´1</span><br><span class="line">å¤´2: æˆ‘æ˜¯å¤´2</span><br></pre></td></tr></table></figure><blockquote><p>ç®€å•èµ·è§ï¼Œè¿™é‡Œå°±å†™å‡ºæœ€åŸºç¡€çš„ä¸€äº›å†…å®¹ï¼Œè‡³äº Body ä»€ä¹ˆçš„å¤§å®¶è‡ªå·±æ‰¾èµ„æ–™çœ‹å§ã€‚</p></blockquote><p>ä¸Šé¢çš„æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬çœ‹çœ‹ CURL çš„ç»“æœå°±çŸ¥é“äº†ï¼Œå®é™…ä¸Šå¯¹åº” <code>curl ... -v</code> çš„ä¸­é—´è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET /test HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:5555</span><br><span class="line">User-Agent: curl/7.54.0</span><br><span class="line">Accept: */*</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å®é™…ä¸Šå¤§å®¶å¹³æ—¶åœ¨æ–‡ç« ä¸­ã€æµè§ˆå™¨è°ƒè¯•å·¥å…·ä¸­çœ‹åˆ°çš„ä»€ä¹ˆè¯·æ±‚å¤´å•Šä»€ä¹ˆçš„ï¼Œéƒ½æ˜¯ä»¥æ–‡æœ¬å½¢å¼å­˜åœ¨çš„ï¼Œä»¥æ¢è¡Œç¬¦åˆ†å‰²ã€‚</p><p>è€Œâ€”â€”é‡ç‚¹æ¥äº†ï¼Œå¯¼è‡´æˆ‘ä»¬æœ¬æ–‡æ‰€è¿°â€œBugâ€å‡ºç°çš„è¯·æ±‚ï¼Œå®ƒçš„è¯·æ±‚åŒ…å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET /foo bar HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:5555</span><br><span class="line">User-Agent: curl/7.54.0</span><br><span class="line">Accept: */*</span><br></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨ç¬¬ä¸€è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET /foo bar HTTP/1.1</span><br></pre></td></tr></table></figure><h4 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h4><p>è¯ä¸å¤šå°‘ï¼Œæˆ‘ä»¬ä¹‹é—´å‰å¾€ http-parser çš„ <a href="https://github.com/nodejs/node/blob/v8.9.2/deps/http_parser/http_parser.c#L634" target="_blank" rel="external">http_parser.c</a> çœ‹ <code>http_parser_execute ()</code> å‡½æ•°ä¸­çš„çŠ¶æ€æœºå˜åŒ–ã€‚</p><p>ä»æºç ä¸­æ–‡æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œhttp-parser çš„æµç¨‹æ˜¯ä»å¤´åˆ°å°¾ä»¥ O(n) çš„æ—¶é—´å¤æ‚åº¦å¯¹å­—ç¬¦ä¸²é€å­—æ‰«æï¼Œå¹¶ä¸”ä¸åé€€ä¹Ÿä¸å¾€å‰è·³ã€‚</p><p>é‚£ä¹ˆæ‰«æåˆ°æ¯ä¸ªå­—ç¬¦çš„æ—¶å€™ï¼Œéƒ½æœ‰å±äºå½“å‰çš„ä¸€ä¸ªçŠ¶æ€ï¼Œå¦‚â€œæ­£åœ¨æ‰«æå¤„ç† uriâ€ã€â€œæ­£åœ¨æ‰«æå¤„ç† HTTP åè®®å¹¶ä¸”å¤„ç†åˆ°äº† Hâ€ã€â€œæ­£åœ¨æ‰«æå¤„ç† HTTP åè®®å¹¶ä¸”å¤„ç†åˆ°äº† HTâ€ã€â€œæ­£åœ¨æ‰«æå¤„ç† HTTP åè®®å¹¶ä¸”å¤„ç†åˆ°äº† HTTâ€ã€â€œæ­£åœ¨æ‰«æå¤„ç† HTTP åè®®å¹¶ä¸”å¤„ç†åˆ°äº† HTTPâ€ã€â€¦â€¦</p><center><img src="baoqingtian.png"></center><p>æ†‹ç¬‘ï¼Œè¿™æ˜¯çœŸçš„ï¼Œæˆ‘ä»¬çœ‹çœ‹ä»£ç å°±çŸ¥é“äº†ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> s_req_server:</span><br><span class="line"><span class="keyword">case</span> s_req_server_with_at:</span><br><span class="line"><span class="keyword">case</span> s_req_path:</span><br><span class="line"><span class="keyword">case</span> s_req_query_string_start:</span><br><span class="line"><span class="keyword">case</span> s_req_query_string:</span><br><span class="line"><span class="keyword">case</span> s_req_fragment_start:</span><br><span class="line"><span class="keyword">case</span> s_req_fragment:</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">switch</span> (ch) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">' '</span>:</span><br><span class="line">      UPDATE_STATE(s_req_http_start);</span><br><span class="line">      CALLBACK_DATA(url);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> CR:</span><br><span class="line">    <span class="keyword">case</span> LF:</span><br><span class="line">      parser-&gt;http_major = <span class="number">0</span>;</span><br><span class="line">      parser-&gt;http_minor = <span class="number">9</span>;</span><br><span class="line">      UPDATE_STATE((ch == CR) ?</span><br><span class="line">        s_req_line_almost_done :</span><br><span class="line">        s_header_field_start);</span><br><span class="line">      CALLBACK_DATA(url);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      UPDATE_STATE(parse_url_char(CURRENT_STATE(), ch));</span><br><span class="line">      <span class="keyword">if</span> (UNLIKELY(CURRENT_STATE() == s_dead)) &#123;</span><br><span class="line">        SET_ERRNO(HPE_INVALID_URL);</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ‰«æçš„æ—¶å€™ï¼Œå¦‚æœå½“å‰çŠ¶æ€æ˜¯ URI ç›¸å…³çš„ï¼ˆå¦‚ <code>s_req_path</code>ã€<code>s_req_query_string</code> ç­‰ï¼‰ï¼Œåˆ™æ‰§è¡Œä¸€ä¸ªå­ <code>switch</code>ï¼Œé‡Œé¢çš„å¤„ç†å¦‚ä¸‹ï¼š</p><ul><li>è‹¥å½“å‰å­—ç¬¦æ˜¯ç©ºæ ¼ï¼Œåˆ™å°†çŠ¶æ€æ”¹å˜ä¸º <code>s_req_http_start</code> å¹¶è®¤ä¸º URI å·²ç»è§£æå¥½äº†ï¼Œé€šè¿‡å® <code>CALLBACK_DATA()</code> è§¦å‘ URI è§£æå¥½çš„äº‹ä»¶ï¼›</li><li>è‹¥å½“å‰å­—ç¬¦æ˜¯æ¢è¡Œç¬¦ï¼Œåˆ™è¯´æ˜è¿˜åœ¨è§£æ URI çš„æ—¶å€™å°±è¢«æ¢è¡Œäº†ï¼Œåé¢å°±ä¸å¯èƒ½è·Ÿç€ HTTP åè®®ç‰ˆæœ¬çš„ç”³æ˜äº†ï¼Œæ‰€ä»¥è®¾ç½®é»˜è®¤çš„ HTTP ç‰ˆæœ¬ä¸º <code>0.9</code>ï¼Œå¹¶ä¿®æ”¹å½“å‰çŠ¶æ€ï¼Œæœ€åè®¤ä¸º URI å·²ç»è§£æå¥½äº†ï¼Œé€šè¿‡å® <code>CALLBACK_DATA()</code> è§¦å‘ URI è§£æå¥½çš„äº‹ä»¶ï¼›</li><li>å…¶ä½™æƒ…å†µï¼ˆæ‰€æœ‰å…¶å®ƒå­—ç¬¦ï¼‰ä¸‹ï¼Œé€šè¿‡è°ƒç”¨ <code>parse_url_char()</code> å‡½æ•°æ¥è§£æä¸€äº›ä¸œè¥¿å¹¶æ›´æ–°å½“å‰çŠ¶æ€ã€‚ï¼ˆå› ä¸ºå“ªæ€•æ˜¯åœ¨è§£æ URI çŠ¶æ€ä¸­ï¼Œä¹Ÿè¿˜æœ‰å„ç§ä¸åŒçš„ç»†åˆ†ï¼Œå¦‚ <code>s_req_path</code>ã€<code>s_req_query_string</code> ï¼‰</li></ul><p>è¿™é‡Œçš„é‡ç‚¹è¿˜æ˜¯å½“çŠ¶æ€ä¸ºè§£æ URI çš„æ—¶å€™é‡åˆ°äº†ç©ºæ ¼çš„å¤„ç†ï¼Œä¸Šé¢ä¹Ÿè§£é‡Šè¿‡äº†ï¼Œä¸€æ—¦é‡åˆ°è¿™ç§æƒ…å†µï¼Œåˆ™ä¼šè®¤ä¸º URI å·²ç»è§£æå¥½äº†ï¼Œå¹¶ä¸”å°†çŠ¶æ€ä¿®æ”¹ä¸º <code>s_req_http_start</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰â€œBugâ€çš„é‚£ä¸ªæ•°æ®åŒ…<br> <code>GET /foo bar HTTP/1.1</code> åœ¨è§£æåˆ° <code>foo</code> åé¢çš„ç©ºæ ¼çš„æ—¶å€™å®ƒå°±å°†çŠ¶æ€æ”¹ä¸º <code>s_req_http_start</code> å¹¶ä¸”è®¤ä¸º URI å·²ç»è§£æç»“æŸäº†ã€‚</p><p>å¥½çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ <code>s_req_http_start</code> æ€ä¹ˆå¤„ç†ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> s_req_http_start:</span><br><span class="line">  <span class="keyword">switch</span> (ch) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'H'</span>:</span><br><span class="line">      UPDATE_STATE(s_req_http_H);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">' '</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      SET_ERRNO(HPE_INVALID_CONSTANT);</span><br><span class="line">      <span class="keyword">goto</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> s_req_http_H:</span><br><span class="line">  STRICT_CHECK(ch != <span class="string">'T'</span>);</span><br><span class="line">  UPDATE_STATE(s_req_http_HT);</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> s_req_http_HT:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> s_req_http_HTT:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> s_req_http_HTTP:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> s_req_first_http_major:</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p>å¦‚ä»£ç æ‰€è§ï¼Œè‹¥å½“å‰çŠ¶æ€ä¸º <code>s_req_http_start</code>ï¼Œåˆ™å…ˆåˆ¤æ–­å½“å‰å­—ç¬¦æ˜¯ä¸æ˜¯åˆæ ‡ã€‚å› ä¸ºå°± HTTP è¯·æ±‚åŒ…ä½“çš„æ ¼å¼æ¥çœ‹ï¼Œå¦‚æœ URI è§£æç»“æŸçš„è¯ï¼Œç†åº”å‡ºç°ç±»ä¼¼ <code>HTTP/1.1</code> çš„è¿™ä¹ˆä¸€ä¸ªç‰ˆæœ¬ç”³æ˜ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™ http-parser ä¼šç›´æ¥åˆ¤æ–­å½“å‰å­—ç¬¦æ˜¯å¦ä¸º <code>H</code>ã€‚</p><ul><li>è‹¥æ˜¯ <code>H</code>ï¼Œåˆ™å°†çŠ¶æ€æ”¹ä¸º <code>s_req_http_H</code> å¹¶ç»§ç»­æ‰«æå¾ªç¯çš„ä¸‹ä¸€ä½ï¼ŒåŒç†åœ¨ <code>s_req_http_H</code> ä¸‹è‹¥åˆæ³•çŠ¶æ€å°±ä¼šå˜æˆ <code>s_req_http_HT</code>ï¼Œä»¥æ­¤ç±»æ¨ï¼›<br>+è‹¥æ˜¯ç©ºæ ¼ï¼Œåˆ™è®¤ä¸ºæ˜¯å¤šä½™çš„ç©ºæ ¼ï¼Œé‚£ä¹ˆå½“å‰çŠ¶æ€ä¸åšä»»ä½•æ”¹å˜ï¼Œå¹¶ç»§ç»­ä¸‹ä¸€ä¸ªæ‰«æï¼›</li><li>ä½†å¦‚æœå½“å‰å­—ç¬¦æ—¢ä¸æ˜¯ç©ºæ ¼ä¹Ÿä¸æ˜¯ <code>H</code>ï¼Œé‚£ä¹ˆå¥½äº†ï¼Œhttp-parser ç›´æ¥è®¤ä¸ºä½ çš„è¯·æ±‚åŒ…ä¸åˆæ³•ï¼Œå°†ä½ æœ¬æ¬¡çš„è§£æè®¾ç½®é”™è¯¯ <code>HPE_INVALID_CONSTANT</code> å¹¶ <code>goto</code> åˆ° <code>error</code> ä»£ç å—ã€‚</li></ul><p>è‡³æ­¤ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå·²ç»æ˜ç™½äº†åŸå› äº†ï¼š</p><p><strong>http-parser è®¤ä¸ºåœ¨ HTTP è¯·æ±‚åŒ…ä½“ä¸­ï¼Œç¬¬ä¸€è¡Œçš„ URI è§£æé˜¶æ®µä¸€æ—¦å‡ºç°äº†ç©ºæ ¼ï¼Œå°±ä¼šè®¤ä¸º URI è§£æå®Œæˆï¼Œç»§è€Œè§£æ HTTP åè®®ç‰ˆæœ¬ã€‚ä½†è‹¥æ­¤æ—¶ç´§è·Ÿç€çš„ä¸æ˜¯ HTTP åè®®ç‰ˆæœ¬çš„æ ‡å‡†æ ¼å¼ï¼Œhttp-parser å°±ä¼šè®¤ä¸ºä½ è¿™æ˜¯ä¸€ä¸ª <code>HPE_INVALID_CONSTANT</code> çš„æ•°æ®åŒ…ã€‚</strong></p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç»§ç»­çœ‹çœ‹å®ƒçš„ <code>error</code> ä»£ç å—å§ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">error:</span><br><span class="line">  <span class="keyword">if</span> (HTTP_PARSER_ERRNO(parser) == HPE_OK) &#123;</span><br><span class="line">    SET_ERRNO(HPE_UNKNOWN);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  RETURN(p - data);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸­é¦–å…ˆåˆ¤æ–­ä¸€ä¸‹å½“è·³åˆ°è¿™æ®µä»£ç çš„æ—¶å€™æœ‰æ²¡æœ‰è®¾ç½®é”™è¯¯ï¼Œè‹¥æ²¡æœ‰è®¾ç½®é”™è¯¯åˆ™å°†é”™è¯¯è®¾ç½®ä¸ºæœªçŸ¥é”™è¯¯ï¼ˆ<code>HPE_UNKNOWN</code>ï¼‰ï¼Œç„¶åè¿”å›å·²è§£æçš„æ•°æ®åŒ…é•¿åº¦ã€‚</p><blockquote><p><code>p</code> æ˜¯å½“å‰è§£æå­—ç¬¦æŒ‡é’ˆï¼Œ<code>data</code> æ˜¯è¿™ä¸ªæ•°æ®åŒ…çš„èµ·å§‹æŒ‡é’ˆï¼Œæ‰€ä»¥ <code>p - data</code> å°±æ˜¯å·²è§£æçš„æ•°æ®é•¿åº¦ã€‚å¦‚æœæˆåŠŸè§£æå®Œï¼Œè¿™ä¸ªæ•°æ®åŒ…ç†è®ºä¸Šæ˜¯ç­‰äºè¿™ä¸ªæ•°æ®åŒ…çš„å®Œæ•´é•¿åº¦ï¼Œè‹¥ä¸ç­‰åˆ™ç†è®ºä¸Šè¯´æ˜è‚¯å®šæ˜¯ä¸­é€”å‡ºé”™æå‰è¿”å›ã€‚</p></blockquote><h3 id="å›åˆ°-node-http-parser-cc"><a href="#å›åˆ°-node-http-parser-cc" class="headerlink" title="å›åˆ° node_http_parser.cc"></a>å›åˆ° node_http_parser.cc</h3><p>çœ‹å®Œäº† http-parser çš„åŸç†åï¼Œå¾ˆå¤šåœ°æ–¹èŒ…å¡é¡¿å¼€ã€‚ç°åœ¨æˆ‘ä»¬å›åˆ°å®ƒçš„è°ƒç”¨åœ° <a href="https://github.com/nodejs/node/blob/v8.9.2/src/node_http_parser.cc#L630-L666" target="_blank" rel="external"><strong>node_http_parser.cc</strong></a> ç»§ç»­é˜…è¯»å§ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Local&lt;Value&gt; Execute(<span class="keyword">char</span>* data, <span class="keyword">size_t</span> len) &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="keyword">size_t</span> nparsed =</span><br><span class="line">    http_parser_execute(&amp;parser_, &amp;settings, data, len);</span><br><span class="line"></span><br><span class="line">  Local&lt;Integer&gt; nparsed_obj = Integer::New(env()-&gt;isolate(), nparsed);</span><br><span class="line">  <span class="keyword">if</span> (!parser_.upgrade &amp;&amp; nparsed != len) &#123;</span><br><span class="line">    <span class="keyword">enum</span> http_errno err = HTTP_PARSER_ERRNO(&amp;parser_);</span><br><span class="line"></span><br><span class="line">    Local&lt;Value&gt; e = Exception::Error(env()-&gt;parse_error_string());</span><br><span class="line">    Local&lt;Object&gt; obj = e-&gt;ToObject(env()-&gt;isolate());</span><br><span class="line">    obj-&gt;Set(env()-&gt;bytes_parsed_string(), nparsed_obj);</span><br><span class="line">    obj-&gt;Set(env()-&gt;code_string(),</span><br><span class="line">             OneByteString(env()-&gt;isolate(), http_errno_name(err)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> scope.Escape(e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> scope.Escape(nparsed_obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è°ƒç”¨å¤„æˆ‘ä»¬èƒ½çœ‹è§ï¼Œåœ¨æ‰§è¡Œå®Œ <code>http_parser_execute()</code> åæœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œè‹¥å½“å‰è¯·æ±‚ä¸æ˜¯ <code>upgrade</code> è¯·æ±‚ï¼ˆå³è¯·æ±‚å¤´ä¸­æœ‰è¯´æ˜ <code>Upgrade</code>ï¼Œé€šå¸¸ç”¨äº WebSocketï¼‰ï¼Œå¹¶ä¸”è§£æé•¿åº¦ä¸ç­‰äºåŸæ•°æ®åŒ…é•¿åº¦ï¼ˆå‰æ–‡è¯´äº†è¿™ç§æƒ…å†µå±äºå‡ºé”™äº†ï¼‰çš„è¯ï¼Œé‚£ä¹ˆè¿›å…¥ä¸­é—´çš„é”™è¯¯ä»£ç å—ã€‚</p><p>åœ¨é”™è¯¯ä»£ç å—ä¸­ï¼Œå…ˆ <code>HTTP_PARSER_ERRNO(&amp;parser_)</code> æ‹¿åˆ°é”™è¯¯ç ï¼Œç„¶åé€šè¿‡ <code>Exception::Error()</code> ç”Ÿæˆé”™è¯¯å¯¹è±¡ï¼Œå°†é”™è¯¯ä¿¡æ¯å¡è¿›é”™è¯¯å¯¹è±¡ä¸­ï¼Œæœ€åè¿”å›é”™è¯¯å¯¹è±¡ã€‚</p><p>å¦‚æœæ²¡é”™ï¼Œåˆ™è¿”å›è§£æé•¿åº¦ï¼ˆ<code>nparsed_obj</code> å³ <code>nparsed</code>ï¼‰ã€‚</p><blockquote><p>åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œçœ¼å°–çš„ç«¥é‹å¯èƒ½å‘ç°äº†ï¼Œæ‰§è¡Œ <code>Execute()</code> æœ‰å¥½å¤šå¤„ï¼Œè¿™æ˜¯å› ä¸ºå®é™…ä¸Šä¸€ä¸ª HTTP è¯·æ±‚å¯èƒ½æ˜¯æµå¼çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å€™å¯èƒ½ä¼šåªæ‹¿åˆ°éƒ¨åˆ†æ•°æ®åŒ…ã€‚æ‰€ä»¥æœ€åæœ‰ä¸€ä¸ªç»“æŸç¬¦éœ€è¦è¢«ç¡®è®¤ã€‚<strong>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ http-parser åœ¨è§£æçš„æ—¶å€™åªèƒ½é€å­—è§£æè€Œä¸èƒ½è·³è·ƒæˆ–è€…åé€€äº†ã€‚</strong></p></blockquote><h3 id="å›åˆ°-http-server-js"><a href="#å›åˆ°-http-server-js" class="headerlink" title="å›åˆ° _http_server.js"></a>å›åˆ° _http_server.js</h3><p>æˆ‘ä»¬æŠŠ <code>Parser::Execute()</code> ä¹Ÿå°±æ˜¯ JavaScript ä»£ç ä¸­çš„ <code>parser.execute()</code> ç»™ææ¸…æ¥šåï¼Œæˆ‘ä»¬å°±èƒ½å›åˆ° <a href="https://github.com/nodejs/node/blob/v8.9.2/lib/_http_server.js#L462-L507" target="_blank" rel="external">_http_server.js</a> çœ‹ä»£ç äº†ã€‚</p><p>å‰æ–‡è¯´äº†ï¼Œ<code>socketOnData</code> åœ¨è§£æå®Œæ•°æ®åŒ…åä¼šæ‰§è¡Œ <code>onParserExecuteCommon</code> å‡½æ•°ï¼Œç°åœ¨å°±æ¥çœ‹çœ‹è¿™ä¸ª <code>onParserExecuteCommon()</code> å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onParserExecuteCommon</span>(<span class="params">server, socket, parser, state, ret, d</span>) </span>&#123;</span><br><span class="line">  resetSocketTimeout(server, socket, state);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ret <span class="keyword">instanceof</span> <span class="built_in">Error</span>) &#123;</span><br><span class="line">    debug(<span class="string">'parse error'</span>, ret);</span><br><span class="line">    socketOnError.call(socket, ret);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parser.incoming &amp;&amp; parser.incoming.upgrade) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é•¿é•¿çš„ä¸€ä¸ªå‡½æ•°è¢«æˆ‘ç²¾ç®€æˆè¿™ä¹ˆå‡ å¥è¯ï¼Œé‡ç‚¹å¾ˆæ˜æ˜¾ã€‚<code>ret</code> å°±æ˜¯ä» <code>socketOnData</code> ä¼ è¿›æ¥å·²è§£æçš„æ•°æ®é•¿åº¦ï¼Œä½†æ˜¯åœ¨ C++ ä»£ç ä¸­æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†å®ƒè¿˜æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¸€å¼€å§‹å°±åšäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œåˆ¤æ–­è§£æçš„ç»“æœæ˜¯ä¸æ˜¯ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼Œå¦‚æœæ˜¯é”™è¯¯å¯¹è±¡åˆ™è°ƒç”¨ <code>socketOnError()</code>ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">socketOnError</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Ignore further errors</span></span><br><span class="line">  <span class="keyword">this</span>.removeListener(<span class="string">'error'</span>, socketOnError);</span><br><span class="line">  <span class="keyword">this</span>.on(<span class="string">'error'</span>, () =&gt; &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.server.emit(<span class="string">'clientError'</span>, e, <span class="keyword">this</span>))</span><br><span class="line">    <span class="keyword">this</span>.destroy(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œå¦‚æœçœŸçš„ä¸å°å¿ƒèµ°åˆ°è¿™ä¸€æ­¥çš„è¯ï¼ŒHTTP Server å¯¹è±¡ä¼šè§¦å‘ä¸€ä¸ª <code>clientError</code> äº‹ä»¶ã€‚</p><p>æ•´ä¸ªäº‹æƒ…ä¸²è”èµ·æ¥äº†ï¼š</p><ul><li>æ”¶åˆ°è¯·æ±‚åä¼šé€šè¿‡ http-parser è§£ææ•°æ®åŒ…ï¼›</li><li><code>GET /foo bar HTTP/1.1</code> ä¼šè¢«è§£æå‡ºé”™å¹¶è¿”å›ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼›</li><li>é”™è¯¯å¯¹è±¡ä¼šè¿›å…¥ <code>if (ret instanceof Error)</code> æ¡ä»¶åˆ†æ”¯å¹¶è°ƒç”¨ <code>socketOnError()</code> å‡½æ•°ï¼›</li><li><code>socketOnError()</code> å‡½æ•°ä¸­ä¼šå¯¹æœåŠ¡å™¨è§¦å‘ä¸€ä¸ª <code>clientError</code> äº‹ä»¶ï¼›ï¼ˆ<code>this.server.emit(&#39;clientError&#39;, e, this)</code>ï¼‰</li><li><strong>è‡³æ­¤ï¼ŒHTTP Server å¹¶ä¸ä¼šèµ°åˆ°ä½ çš„é‚£ä¸ª <code>function(req, resp)</code> ä¸­å»ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»»ä½•çš„æ•°æ®è¢«è¿”å›å°±ç»“æŸäº†ï¼Œä¹Ÿå°±è§£ç­”äº†ä¸€å¼€å§‹çš„é—®é¢˜â€”â€”æ”¶ä¸åˆ°ä»»ä½•æ•°æ®å°±è¯·æ±‚ç»“æŸã€‚</strong></li></ul><p>è¿™å°±æ˜¯æˆ‘è¦é€çº§è¿›æ¥çœ‹ä»£ç ï¼Œè€Œä¸æ˜¯ç›´è¾¾ http-parser çš„åŸå› äº†â€”â€”<code>clientError</code> æ˜¯ä¸€ä¸ªå…³é”®ã€‚</p><h2 id="å¤„ç†åŠæ³•"><a href="#å¤„ç†åŠæ³•" class="headerlink" title="å¤„ç†åŠæ³•"></a>å¤„ç†åŠæ³•</h2><p>è¦è§£å†³è¿™ä¸ªâ€œBugâ€å…¶å®ä¸éš¾ï¼Œç›´æ¥ç›‘å¬ <a href="https://nodejs.org/api/http.html#http_event_clienterror" target="_blank" rel="external"><code>clientError</code> äº‹ä»¶</a>å¹¶åšä¸€äº›å¤„ç†å³å¯ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, resp</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ğŸŒš'</span>);</span><br><span class="line">    resp.end(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;).on(<span class="string">'clientError'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, sock</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ğŸ·'</span>);</span><br><span class="line">    sock.end(<span class="string">'HTTP/1.1 400 Bad Request\r\n\r\n'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">5555</span>);</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„ï¼š</strong>ç”±äºè¿è¡Œåˆ° <code>clientError</code> äº‹ä»¶æ—¶ï¼Œå¹¶æ²¡æœ‰ä»»ä½• Request å’Œ Response çš„å°è£…ï¼Œä½ èƒ½æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ª Node.js ä¸­åŸå§‹çš„ Socket å¯¹è±¡ï¼Œæ‰€ä»¥å½“ä½ è¦è¿”å›æ•°æ®çš„æ—¶å€™éœ€è¦è‡ªå·±æŒ‰ç…§ HTTP è¿”å›æ•°æ®åŒ…çš„æ ¼å¼æ¥è¾“å‡ºã€‚</p></blockquote><p>è¿™ä¸ªæ—¶å€™å†æŒ¥èµ·ä½ çš„å°æ‰‹è¯•ä¸€ä¸‹ CURL å§ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl &apos;http://127.0.0.1:5555/d d&apos; -v</span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 5555 (#0)</span><br><span class="line">&gt; GET /d d HTTP/1.1</span><br><span class="line">&gt; Host: 127.0.0.1:5555</span><br><span class="line">&gt; User-Agent: curl/7.54.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">&lt; HTTP/1.1 400 Bad Request</span><br><span class="line">* no chunk, no close, no size. Assume close to signal end</span><br><span class="line">&lt;</span><br><span class="line">* Closing connection 0</span><br></pre></td></tr></table></figure><p>å¦‚æ„¿ä»¥å¿åœ°è¾“å‡ºäº† 400 çŠ¶æ€ç ã€‚</p><h2 id="å¼•ç”³"><a href="#å¼•ç”³" class="headerlink" title="å¼•ç”³"></a>å¼•ç”³</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦å¼•ç”³è®¨è®ºçš„ä¸€ä¸ªç‚¹æ˜¯ï¼Œä¸ºä»€ä¹ˆè¿™è´§ä¸æ˜¯ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šçš„ Bugã€‚</p><p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹ Nginx è¿™ä¹ˆå®ç°è¿™ä¸ªé»‘ç§‘æŠ€çš„å§ã€‚</p><h3 id="Nginx-å®ç°"><a href="#Nginx-å®ç°" class="headerlink" title="Nginx å®ç°"></a>Nginx å®ç°</h3><p>æ‰“å¼€ Nginx æºç çš„<a href="https://github.com/nginx/nginx/blob/release-1.13.7/src/http/ngx_http_parse.c#L104" target="_blank" rel="external">ç›¸åº”ä½ç½®</a>ã€‚</p><p>æˆ‘ä»¬èƒ½çœ‹åˆ°å®ƒçš„çŠ¶æ€æœºå¯¹äº URI å’Œ HTTP åè®®å£°æ˜ä¸­é—´å¤šäº†ä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œå« <code>sw_check_uri_http_09</code>ï¼Œä¸“é—¨å¤„ç† URI åé¢çš„ç©ºæ ¼ã€‚</p><p>åœ¨å„ç§ URI è§£æçŠ¶æ€ä¸­ï¼ŒåŸºæœ¬ä¸Šéƒ½èƒ½æ‰¾åˆ°è¿™ä¹ˆä¸€å¥è¯ï¼Œè¡¨ç¤ºè‹¥å½“å‰çŠ¶æ€æ­£åˆ™è§£æ URI çš„å„ç§çŠ¶æ€å¹¶ä¸”é‡åˆ°ç©ºæ ¼çš„è¯ï¼Œåˆ™å°†çŠ¶æ€æ”¹ä¸º <code>sw_check_uri_http_09</code>ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> sw_check_uri:</span><br><span class="line">  <span class="keyword">switch</span> (ch) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">' '</span>:</span><br><span class="line">    r-&gt;uri_end = p;</span><br><span class="line">    state = sw_check_uri_http_09;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ <code>sw_check_uri_http_09</code> çŠ¶æ€æ—¶ä¼šåšä¸€äº›æ£€æŸ¥ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> sw_check_uri_http_09:</span><br><span class="line">    <span class="keyword">switch</span> (ch) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">' '</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> CR:</span><br><span class="line">        r-&gt;http_minor = <span class="number">9</span>;</span><br><span class="line">        state = sw_almost_done;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LF:</span><br><span class="line">        r-&gt;http_minor = <span class="number">9</span>;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'H'</span>:</span><br><span class="line">        r-&gt;http_protocol.data = p;</span><br><span class="line">        state = sw_http_H;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        r-&gt;space_in_uri = <span class="number">1</span>;</span><br><span class="line">        state = sw_check_uri;</span><br><span class="line">        p--;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><ul><li>é‡åˆ°ç©ºæ ¼åˆ™ç»§ç»­ä¿æŒå½“å‰çŠ¶æ€å¼€å§‹æ‰«æä¸‹ä¸€ä½ï¼›</li><li>å¦‚æœæ˜¯æ¢è¡Œç¬¦åˆ™è®¾ç½®é»˜è®¤ HTTP ç‰ˆæœ¬å¹¶ç»§ç»­æ‰«æï¼›</li><li>å¦‚æœé‡åˆ°çš„æ˜¯ <code>H</code> æ‰ä¿®æ”¹çŠ¶æ€ä¸º <code>sw_http_H</code> è®¤ä¸ºæ¥ä¸‹å»å¼€å§‹ HTTP ç‰ˆæœ¬æ‰«æï¼›</li><li>å¦‚æœæ˜¯å…¶å®ƒå­—ç¬¦ï¼Œåˆ™æ ‡æ˜ä¸€ä¸‹ URI ä¸­æœ‰ç©ºæ ¼ï¼Œç„¶åå°†çŠ¶æ€æ”¹å› <code>sw_check_uri</code>ï¼Œç„¶åå€’é€€å›ä¸€æ ¼ä»¥ <code>sw_check_uri</code> ç»§ç»­æ‰«æå½“å‰çš„ç©ºæ ¼ã€‚</li></ul><p>åœ¨ç†è§£äº†è¿™ä¸ªâ€œé»‘ç§‘æŠ€â€åï¼Œæˆ‘ä»¬å¾ˆå¿«èƒ½æ‰¾åˆ°ä¸€ä¸ªå¾ˆå¥½ç©çš„ç‚¹ï¼Œå¼€å¯ä½ çš„ Nginx å¹¶ç”¨ CURL è¯·æ±‚ä»¥ä¸‹é¢çš„ä¾‹å­ä¸€ä¸‹å®ƒçœ‹çœ‹å§ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl &apos;http://xcoder.in:5555/d H&apos; -v</span><br><span class="line">*   Trying 103.238.225.181...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to xcoder.in (103.238.225.181) port 5555 (#0)</span><br><span class="line">&gt; GET /d H HTTP/1.1</span><br><span class="line">&gt; Host: xcoder.in:5555</span><br><span class="line">&gt; User-Agent: curl/7.54.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">&lt; HTTP/1.1 400 Bad Request</span><br><span class="line">&lt; Server: openresty/1.11.2.1</span><br><span class="line">&lt; Date: Tue, 12 Dec 2017 11:18:13 GMT</span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line">&lt; Content-Length: 179</span><br><span class="line">&lt; Connection: close</span><br><span class="line">&lt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body bgcolor=&quot;white&quot;&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;openresty/1.11.2.1&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">* Closing connection 0</span><br></pre></td></tr></table></figure><p>æ€ä¹ˆæ ·ï¼Ÿæ˜¯ä¸æ˜¯å‘ç°ç»“æœè·Ÿä¹‹å‰çš„ä¸ä¸€æ ·äº†â€”â€”å®ƒå±…ç„¶ä¹Ÿè¿”å›äº† 400 Bad Requestã€‚</p><p>åŸå› ä¸ºä½•å°±äº¤ç»™ç«¥é‹ä»¬è‡ªå·±è€ƒè™‘å§ã€‚</p><h3 id="RFC-2616-ä¸-RFC-2396"><a href="#RFC-2616-ä¸-RFC-2396" class="headerlink" title="RFC 2616 ä¸ RFC 2396"></a>RFC 2616 ä¸ RFC 2396</h3><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆå³ä½¿åœ¨ Nginx æ”¯æŒç©ºæ ¼ URI çš„æƒ…å†µä¸‹ï¼Œæˆ‘è¿˜è¯´ Node.js è¿™ä¸ªä¸ç®— Bugï¼Œå¹¶ä¸”æŒ‡æ˜ Nginx æ˜¯â€œé»‘ç§‘æŠ€â€å‘¢ï¼Ÿ</p><p>åæ¥æˆ‘å»çœ‹äº† HTTP åè®® RFCã€‚</p><p>åŸå› åœ¨äº Network Working Group çš„ <a href="http://www.ietf.org/rfc/rfc2616.txt" target="_blank" rel="external">RFC 2616</a>ï¼Œå…³äº HTTP åè®®çš„è§„èŒƒã€‚</p><p>åœ¨ RFC 2616 çš„ <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.2.1" target="_blank" rel="external">3.2.1 èŠ‚</a>ä¸­åšäº†ä¸€äº›è¯´æ˜ï¼Œå®ƒè¯´äº†åœ¨ HTTP åè®®ä¸­å…³äº URI çš„æ–‡æ³•å’Œè¯­ä¹‰å‚ç…§äº† <a href="http://www.ietf.org/rfc/rfc2396.txt" target="_blank" rel="external">RFC 2396</a>ã€‚</p><blockquote><p>URIs in HTTP can be represented in absolute form or relative to some known base URI, depending upon the context of their use. The two forms are differentiated by the fact that absolute URIs always begin with a scheme name followed by a colon. For definitive information on URL syntax and semantics, see â€œUniform Resource Identifiers (URI): Generic Syntax and Semantics,â€ RFC 2396 (which replaces RFCs 1738 and RFC 1808). This specification adopts the definitions of â€œURI-referenceâ€, â€œabsoluteURIâ€, â€œrelativeURIâ€, â€œportâ€, â€œhostâ€,â€abs_pathâ€, â€œrel_pathâ€, and â€œauthorityâ€ from that specification.</p></blockquote><p>è€Œåœ¨ <a href="http://www.ietf.org/rfc/rfc2396.txt" target="_blank" rel="external">RFC 2396</a> ä¸­ï¼Œæˆ‘ä»¬åŒæ ·æ‰¾åˆ°äº†å®ƒçš„ <a href="http://www.ietf.org/rfc/rfc2396.txt" target="_blank" rel="external">2.4.3 èŠ‚</a>ã€‚é‡Œé¢å¯¹äº Disallow çš„ US-ASCII å­—ç¬¦åšäº†è§£é‡Šï¼Œå…¶ä¸­æœ‰ï¼š</p><ul><li><p>æ§åˆ¶ç¬¦ï¼ŒæŒ‡ ASCII ç åœ¨ 0x00-0x1F èŒƒå›´å†…ä»¥åŠ 0x7Fï¼›</p><p>  æ§åˆ¶ç¬¦é€šå¸¸ä¸å¯è§ï¼›</p></li><li><p>ç©ºæ ¼ï¼ŒæŒ‡ 0x20ï¼›</p><p>  ç©ºæ ¼ä¸å¯æ§ï¼Œå¦‚ç»ç”±ä¸€äº›æ’ç‰ˆè½¯ä»¶è½¬å½•åå¯èƒ½ä¼šæœ‰å˜åŒ–ï¼Œ<span style="color: #ccc;">è€Œåˆ°äº† HTTP åè®®è¿™å±‚æ—¶ï¼Œåæ­£ç©ºæ ¼ä¸æ¨èä½¿ç”¨äº†ï¼Œæ‰€ä»¥å°±ç´¢æ€§ç”¨ç©ºæ ¼ä½œä¸ºé¦–è¡Œåˆ†éš”ç¬¦äº†ï¼›</span></p></li><li><p>åˆ†éš”ç¬¦ï¼Œ<code>&quot;&lt;&quot;</code>ã€<code>&quot;&gt;&quot;</code>ã€<code>&quot;#&quot;</code>ã€<code>&quot;%&quot;</code>ã€<code>&quot;\&quot;&quot;</code>ã€‚</p><p>  å¦‚ <code>#</code> å°†ç”¨äºæµè§ˆå™¨åœ°å€æ çš„ Hashï¼›è€Œ <code>%</code> åˆ™ä¼šä¸ URI è½¬ä¹‰ä¸€åŒä½¿ç”¨ï¼Œæ‰€ä»¥ä¸åº”å•ç‹¬å‡ºç°åœ¨ URI ä¸­ã€‚</p></li></ul><p><strong>äºæ˜¯ä¹ï¼ŒHTTP è¯·æ±‚ä¸­ï¼ŒåŒ…ä½“çš„ URI ä¼¼ä¹æœ¬å°±ä¸åº”è¯¥å‡ºç°ç©ºæ ¼ï¼Œè€Œ Nginx æ˜¯ä¸€ä¸ªé»‘é­”æ³•çš„å§¿åŠ¿ã€‚</strong></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>åš¯ï¼Œå†™å¾—ç´¯æ­»äº†ã€‚æœ¬æ¬¡çš„ä¸€ä¸ªæ¢ç´¢åŸºäºäº†ä¸€ä¸ªæœ‰ç©ºæ ¼éæ­£å¸¸çš„ URI é€šè¿‡ CURL æˆ–è€…å…¶å®ƒä¸€äº›å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼ŒNode.js å‡ºç°çš„ Bug çŠ¶æ€ã€‚</p><blockquote><p>å®é™…ä¸Šå‘ç°è¿™ä¸ª Bug çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ä¼¼ä¹æ˜¯å› ä¸ºé‚£è¾¹çš„å¼€å‘è€…æ‰‹æŠ–ï¼Œä¸å°å¿ƒå°†ä¸åº”è¯¥æ‹¼æ¥è¿›æ¥çš„å†…å®¹ç»™æ‹¼æ¥åˆ°äº† URL ä¸­ï¼Œç±»ä¼¼äº <code>$ rm -rf /</code>ã€‚</p></blockquote><p>ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºè¿™æ˜¯ Node.js çš„ Bugï¼Œåœ¨æ¢å¯»ä¹‹åå‘ç°æ˜¯å› ä¸ºæˆ‘ä»¬è‡ªå·±æ²¡ç”¨ Node.js HTTP Server æä¾›çš„ <code>clientError</code> äº‹ä»¶åšæ­£ç¡®çš„å¤„ç†ã€‚è€Œ Nginx çš„æ­£å¸¸è¯·æ±‚åˆ™æ˜¯å®ƒçš„é»‘ç§‘æŠ€ã€‚è¿™äº›ç­”æ¡ˆéƒ½èƒ½ä» RFC ä¸­å¯»æ‰¾â€”â€”<strong>å†æ¬¡ä½“ç°äº†é‡åˆ°é—®é¢˜çœ‹æºç çœ‹è§„èŒƒçš„é‡è¦æ€§ã€‚</strong></p><p>å¦ï¼Œæˆ‘æœ¬æ‰“ç®—ç»™ http-parser ä¹ŸåŠ ä¸Šé»‘é­”æ³•ï¼Œåæ¥æˆ‘å¿«å†™å¥½çš„æ—¶å€™å‘ç°å®ƒæ˜¯æµå¼çš„ï¼Œå¾ˆå¤šçŠ¶æ€æ²¡æ³•åœ¨ç°æœ‰çš„ä½“ç³»ä¸­ä¿ç•™ä¸‹æ¥ï¼Œæœ€åæ”¾å¼ƒäº†ï¼Œåæ­£è¿™ä¹Ÿä¸ç®— Bugã€‚ä¸è¿‡åœ¨ä»¥åæœ‰æ—¶é—´çš„æ—¶å€™ï¼Œæ„Ÿè§‰è¿˜æ˜¯å¯ä»¥å¥½å¥½æ•´ç†ä¸€ä¸‹ä»£ç ï¼Œå¥½å¥½ä¿®æ”¹ä¸€ä¸‹ç»™æä¸ª PR ä¸Šå»ï¼Œä»¥æ­¤è‡ªå‹‰ã€‚</p><p>æœ€åï¼Œæ±‚ fafaã€‚</p><center><img src="http://ww2.sinaimg.cn/bmiddle/a15b4afely1fme81d41wpg206o06oabl"></center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/31966196&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æœ¬æ–‡&lt;/a&gt;é¦–å‘äºçŸ¥ä¹ä¸“æ &lt;a href=&quot;https://zhuanlan.zhihu.
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="HTTP" scheme="https://xcoder.in/tags/HTTP/"/>
    
      <category term="Nginx" scheme="https://xcoder.in/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>ä»æš´åŠ›åˆ° NAN å†åˆ° NAPIâ€”â€”Node.js åŸç”Ÿæ¨¡å—å¼€å‘æ–¹å¼å˜è¿</title>
    <link href="https://xcoder.in/2017/07/01/nodejs-addon-history/"/>
    <id>https://xcoder.in/2017/07/01/nodejs-addon-history/</id>
    <published>2017-07-01T07:55:08.000Z</published>
    <updated>2017-12-11T07:59:20.526Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ç”±æˆ‘é¦–å‘äº <a href="http://gitbook.cn/books/5938f4ae8b55d47644b7a445/index.html" target="_blank" rel="external">GitChat</a> ä¸­ã€‚</p></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ Node.js å¼€å‘é¢†åŸŸä¸­ï¼ŒåŸç”Ÿ C++ æ¨¡å—çš„å¼€å‘ä¸€ç›´æ˜¯ä¸€ä¸ªè¢«äººå†·è½çš„è§’è½ã€‚ä½†æ˜¯å®é™…ä¸Šåœ¨å¿…è¦çš„æ—¶å€™ï¼Œç”¨ C++ è¿›è¡Œ Node.js çš„åŸç”Ÿæ¨¡å—å¼€å‘èƒ½æœ‰æ„æƒ³ä¸åˆ°çš„å¥½å¤„ã€‚</p><ul><li>æ€§èƒ½æå‡ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½¿ç”¨ C++ è¿›è¡Œ Node.js åŸç”Ÿæ¨¡å—å¼€å‘çš„æ€§èƒ½ä¼šæ¯”çº¯ Node.js å¼€å‘è¦é«˜ï¼Œå°‘æ•°æƒ…å†µé™¤å¤–ã€‚</li><li>å¼€å‘æˆæœ¬èŠ‚çº¦ã€‚åœ¨ä¸€äº›å³æœ‰çš„ C++ ä»£ç ä¸Šåšå°è£…ï¼Œå¼€å‘æˆæœ¬è¿œè¿œä½äºä»é›¶å¼€å§‹å†™ Node.js ä»£ç ã€‚</li><li>Node.js æ— æ³•å®Œæˆçš„å·¥ä½œã€‚ä¸ªåˆ«æƒ…å†µï¼Œå¼€å‘è€…åªèƒ½å¾—åˆ°ä¸€ä¸ªåº“çš„é™æ€è¿æ¥åº“æˆ–è€…åŠ¨æ€é“¾æ¥åº“ä»¥åŠä¸€å † C++ å¤´æ–‡ä»¶ï¼Œå…¶ä½™éƒ½æ˜¯é»‘ç›’çš„ï¼Œè¿™ç§æƒ…å†µå°±ä¸å¾—ä¸ä½¿ç”¨ C++ è¿›è¡Œæ¨¡å—å¼€å‘äº†ã€‚</li></ul><p>æœ¬æ–‡å°†ä»æ—©æœŸçš„ Node.js å¼€å§‹ï¼Œé€æ¸æŠ«éœ² Node.js åŸç”Ÿ C++ æ¨¡å—å¼€å‘æ–¹å¼çš„å˜è¿ã€‚ä¸€ç›´åˆ°æœ€åï¼Œä¼šæ¯”è¾ƒè¯¦ç»†åœ°å¯¹ Node.js v8.x æ–°å‡ºçš„åŸç”Ÿæ¨¡å—å¼€å‘æ¥å£ N-API åšä¸€æ¬¡åˆæ­¥çš„å°è¯•å’Œè§£æï¼Œä½¿å¾—å¤§å®¶å¯¹ Node.js åŸç”Ÿ C++ æ¨¡å—å¼€å‘çš„å›ºæœ‰å°è±¡ï¼ˆè®¤ä¸ºç‰¹åˆ«éº»çƒ¦ï¼‰æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ”¹è§‚ï¼Œè®©å¤§å®¶éƒ½æ¥å°è¯•ä¸€ä¸‹ Node.js åŸç”Ÿ C++ æ¨¡å—çš„å¼€å‘ã€‚</p><h2 id="ä¸å˜åº”ä¸‡å˜"><a href="#ä¸å˜åº”ä¸‡å˜" class="headerlink" title="ä¸å˜åº”ä¸‡å˜"></a>ä¸å˜åº”ä¸‡å˜</h2><p>è™½ç„¶ Node.js åŸç”Ÿ C++ æ¨¡å—å¼€å‘æ–¹å¼æœ‰äº†å¾ˆå¤§çš„æ”¹å˜ï¼Œä½†æ˜¯æœ‰ä¸€äº›å†…å®¹æ˜¯ä¸å˜çš„ï¼Œè‡³å°‘åˆ°ç°åœ¨æ¥è¯´éƒ½æ˜¯åŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆ Breaking çš„å˜åŒ–ã€‚</p><h3 id="åŸç”Ÿæ¨¡å—æœ¬è´¨"><a href="#åŸç”Ÿæ¨¡å—æœ¬è´¨" class="headerlink" title="åŸç”Ÿæ¨¡å—æœ¬è´¨"></a>åŸç”Ÿæ¨¡å—æœ¬è´¨</h3><p>è¿™å°±è¦ä» Node.js æœ€æœ¬è´¨çš„ C++ æ¨¡å—å¼€å‘è®²èµ·äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ Linux ä¸‹æœ‰ä¸€ä¸ªåˆæ³•çš„åŸç”Ÿæ¨¡å— <strong>ons.node</strong>ï¼Œå®ƒå…¶å®æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ— æ³•æ­£å¸¸åœ°çœ‹å‡ºä»€ä¹ˆé¬¼ï¼Œç›´åˆ°æˆ‘ä»¬é‡åˆ°äº†äºŒè¿›åˆ¶æ–‡ä»¶æŸ¥çœ‹å™¨ã€‚</p><p><img src="http://images.gitbook.cn/81655b10-4cbe-11e7-920d-2570ff832158" alt="ons.node äºŒè¿›åˆ¶å†…å®¹"></p><p>çœ¼å°–çš„åŒå­¦ä¼šçœ‹åˆ°å®ƒçš„ Magic Number[^1] æ˜¯ <code>0x7F454C46</code>ï¼Œå…¶æŒ‰ä½çš„ ASCII ç ä»£è¡¨çš„å­—ç¬¦ä¸²æ˜¯ <code>ELF</code>ã€‚äºæ˜¯ç­”æ¡ˆå‘¼ä¹‹æ¬²å‡ºï¼Œè¿™å°±æ˜¯ä¸€ä¸ª Linux ä¸‹çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚</p><p>äº‹å®ä¸Šï¼Œä¸åªæ˜¯åœ¨ Linux ä¸­ã€‚å½“ä¸€ä¸ª Node.js çš„ C++ æ¨¡å—åœ¨ OSX ä¸‹ç¼–è¯‘ä¼šå¾—åˆ°ä¸€ä¸ªåç¼€æ˜¯ <strong>*.node</strong> æœ¬è´¨ä¸Šæ˜¯ <strong>*.dylib</strong> çš„åŠ¨æ€é“¾æ¥åº“ï¼›è€Œåœ¨ Windows ä¸‹åˆ™ä¼šå¾—åˆ°ä¸€ä¸ªåç¼€æ˜¯ <strong>*.node</strong> æœ¬è´¨ä¸Šæ˜¯ <strong>*.dll</strong> çš„åŠ¨æ€é“¾æ¥åº“ã€‚</p><p>è¿™ä¹ˆä¸€ä¸ªæ¨¡å—åœ¨ Node.js ä¸­è¢« <code>require</code> çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡ <code>process.dlopen()</code> å¯¹å…¶è¿›è¡Œå¼•å…¥çš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Node.js v6.9.4 çš„ <code>DLOpen</code>[^2] å‡½æ•°å§ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">void DLOpen(const FunctionCallbackInfo&lt;Value&gt;&amp; args) &#123;</span><br><span class="line">  Environment* env = Environment::GetCurrent(args);</span><br><span class="line">  uv_lib_t lib;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  Local&lt;Object&gt; module = args[0]-&gt;ToObject(env-&gt;isolate());</span><br><span class="line">  node::Utf8Value filename(env-&gt;isolate(), args[1]);</span><br><span class="line"></span><br><span class="line">  // ä½¿ç”¨ uv_dlopen åŠ è½½é“¾æ¥åº“</span><br><span class="line">  const bool is_dlopen_error = uv_dlopen(*filename, &amp;lib);</span><br><span class="line">  node_module* const mp = modpending;</span><br><span class="line">  modpending = nullptr;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  // å°†åŠ è½½çš„é“¾æ¥åº“å¥æŸ„è½¬ç§»åˆ° mp ä¸Š</span><br><span class="line">  mp-&gt;nm_dso_handle = lib.handle;</span><br><span class="line">  mp-&gt;nm_link = modlist_addon;</span><br><span class="line">  modlist_addon = mp;</span><br><span class="line"></span><br><span class="line">  Local&lt;String&gt; exports_string = env-&gt;exports_string();</span><br><span class="line"></span><br><span class="line">  // exports_string å…¶å®å°±æ˜¯ `"exports"`</span><br><span class="line">  // è¿™å¥çš„æ„æ€æ˜¯ `exports = module.exports`</span><br><span class="line">  Local&lt;Object&gt; exports = module-&gt;Get(exports_string)-&gt;ToObject(env-&gt;isolate());</span><br><span class="line"></span><br><span class="line">  if (mp-&gt;nm_context_register_func != nullptr) &#123;</span><br><span class="line">    mp-&gt;nm_context_register_func(exports, module, env-&gt;context(), mp-&gt;nm_priv);</span><br><span class="line">  &#125; else if (mp-&gt;nm_register_func != nullptr) &#123;</span><br><span class="line">    mp-&gt;nm_register_func(exports, module, mp-&gt;nm_priv);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    uv_dlclose(&amp;lib);</span><br><span class="line">    env-&gt;ThrowError("Module has no declared entry point.");</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§é€»è¾‘æ¥è®²ï¼Œè¿™ä¸ªåŠ è½½è¿‡ç¨‹å…¶å®å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚</p><ol><li>é€šè¿‡ <code>uv_dlopen</code> åŠ è½½é“¾æ¥åº“ã€‚</li><li>å°†åŠ è½½çš„é“¾æ¥åº“æŒ‚åˆ°åŸç”Ÿæ¨¡å—é“¾è¡¨ä¸­å»ã€‚</li><li>é€šè¿‡ <code>mp-&gt;nm_register_func()</code> åˆå§‹åŒ–è¿™ä¸ªæ¨¡å—ï¼Œå¹¶å¾—åˆ°è¯¥æœ‰çš„ <code>module</code> å’Œ <code>module.exports</code>ã€‚</li></ol><p>æµç¨‹èµ°ä¸‹æ¥å°±è·Ÿè¿™ä¸ªæµç¨‹å›¾å·®ä¸å¤šã€‚</p><p><img src="http://images.gitbook.cn/4c391290-4cc0-11e7-be96-bb59812ba34f" alt="DLOpen æµç¨‹å›¾"></p><h3 id="node-gyp"><a href="#node-gyp" class="headerlink" title="node-gyp"></a>node-gyp</h3><p>è¿™è´§æ˜¯ Node.js ä¸­ç¼–è¯‘åŸç”Ÿæ¨¡å—ç”¨çš„ã€‚è‡ªä» Node.js v0.8 ä¹‹åï¼Œå®ƒå°±è·Ÿ Node.js é»ä¸Šäº†ï¼Œåœ¨æ­¤ä¹‹å‰å®ƒçš„é»˜è®¤ç¼–è¯‘å¸®åŠ©åŒ…æ˜¯ node-waf[^3]ï¼Œå¯¹äºè€ Noder æ¥è¯´åº”è¯¥ä¸ä¼šé™Œç”Ÿçš„ã€‚</p><h4 id="GYP"><a href="#GYP" class="headerlink" title="GYP"></a>GYP</h4><p>node-gyp æ˜¯åŸºäº GYP[^4] çš„ã€‚å®ƒä¼šè¯†åˆ«åŒ…æˆ–è€…é¡¹ç›®ä¸­çš„ <strong>binding.gyp</strong>[^5] æ–‡ä»¶ï¼Œç„¶åæ ¹æ®è¯¥é…ç½®æ–‡ä»¶ç”Ÿæˆå„ç³»ç»Ÿä¸‹èƒ½è¿›è¡Œç¼–è¯‘çš„é¡¹ç›®ï¼Œå¦‚ Windows ä¸‹ç”Ÿæˆ Visual Studio é¡¹ç›®æ–‡ä»¶ï¼ˆ<strong>*.sln</strong> ç­‰ï¼‰ï¼ŒUnix ä¸‹ç”Ÿæˆ Makefileã€‚åœ¨ç”Ÿæˆè¿™äº›é¡¹ç›®æ–‡ä»¶ä¹‹åï¼Œnode-gyp è¿˜èƒ½è°ƒç”¨å„ç³»ç»Ÿçš„ç¼–è¯‘å·¥å…·ï¼ˆå¦‚ GCCï¼‰æ¥å°†é¡¹ç›®è¿›è¡Œç¼–è¯‘ï¼Œå¾—åˆ°æœ€åçš„åŠ¨æ€é“¾æ¥åº“ <strong>*.node</strong> æ–‡ä»¶ã€‚</p><blockquote><p>ä»ä¸Šé¢çš„æè¿°ä¸­å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼ŒWindows ä¸‹ç¼–è¯‘ C++ åŸç”Ÿæ¨¡å—æ˜¯ä¾èµ– Visual Studio çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å®¶åœ¨å®‰è£…ä¸€äº› Node.js åŒ…çš„æ—¶å€™ä¼šéœ€è¦ä½ äº‹å…ˆå®‰è£…å¥½ Vusual Studio äº†ã€‚</p><p>äº‹å®ä¸Šï¼Œå¯¹äºå¹¶æ²¡æœ‰ Visual Studio éœ€æ±‚çš„åŒå­¦ä»¬æ¥è¯´ï¼Œå®ƒä¸æ˜¯å¿…é¡»çš„ï¼Œæ¯•ç«Ÿ node-gyp åªä¾èµ–å®ƒçš„ç¼–è¯‘å™¨ï¼Œè€Œä¸æ˜¯ IDEã€‚æƒ³è¦ç²¾ç®€åŒ–å®‰è£…çš„åŒå­¦å¯ä»¥ç›´æ¥è®¿é—® <a href="http://landinghub.visualstudio.com/visual-cpp-build-tools" target="_blank" rel="external">http://landinghub.visualstudio.com/visual-cpp-build-tools</a> ä¸‹è½½ Visual CPP Build Tools å®‰è£…ï¼Œæˆ–è€…é€šè¿‡ <code>$ npm install --global --production windows-build-tools</code> å‘½ä»¤è¡Œçš„æ–¹å¼å®‰è£…ï¼Œå°±èƒ½å¾—åˆ°ä½ è¯¥å¾—åˆ°çš„ç¼–è¯‘å·¥å…·äº†ã€‚</p></blockquote><p>è¯´äº†é‚£ä¹ˆå¤šï¼Œè®©å¤§å®¶è§è¯†ä¸€ä¸‹ <strong>binding.gyp</strong> çš„åŸºæœ¬ç»“æ„å§ã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line"># binding.gyp</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "targets": [&#123;</span><br><span class="line">    "target_name": "addon1",</span><br><span class="line">    "sources": [ "1/addon.cc", "1/myobject.cc" ]</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    "target_name": "addon2",</span><br><span class="line">    "sources": [ "2/addon.cc", "2/myobject.cc" ]</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    "target_name": "addon3",</span><br><span class="line">    "sources": [ "3/addon.cc", "3/myobject.cc" ]</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    "target_name": "addon4",</span><br><span class="line">    "sources": [ "4/addon.cc", "4/myobject.cc" ]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µé…ç½®è®²è¿°äº†è¿™ä¹ˆä¸€ä¸ªæ•…äº‹ï¼š</p><ul><li>å®šä¹‰äº† 4 ä¸ª C++ åŸç”Ÿæ¨¡å—ã€‚</li><li>æ¯ä¸ªæ¨¡å—çš„æºç åˆ†åˆ«æ˜¯ <strong>*/addon.cc</strong> å’Œ <strong>*/myobject.cc</strong>ã€‚</li><li>4 ä¸ªæ¨¡å—ååˆ†åˆ«æ˜¯ <strong>addon1</strong> è‡³ <strong>addon4</strong>ã€‚</li><li>éšè—æ•…äº‹ï¼šé€šè¿‡æ­£è§„é€”å¾„ç¼–è¯‘å¥½åï¼Œè¿™äº›æ¨¡å—å­˜åœ¨äº <strong>build/Release/addon*.node</strong> ä¸­ã€‚</li></ul><p>å…³äº GYP é…ç½®æ–‡ä»¶çš„æ›´å¤šå†…å®¹ï¼Œå¤§å®¶å¯è‡ªè¡Œå»å®˜æ–¹æ–‡æ¡£è§‚æ‘©ï¼Œåœ¨è„šæ³¨ä¸­æœ‰ GYP çš„é“¾æ¥ã€‚</p><h4 id="åšçš„äº‹æƒ…"><a href="#åšçš„äº‹æƒ…" class="headerlink" title="åšçš„äº‹æƒ…"></a>åšçš„äº‹æƒ…</h4><p>node-gyp é™¤äº†è‡ªèº«æ˜¯åŸºäº GYP çš„ä¹‹å¤–ï¼Œå®ƒè¿˜åšäº†ä¸€äº›é¢å¤–çš„äº‹æƒ…ã€‚é¦–å…ˆï¼Œåœ¨æˆ‘ä»¬ç¼–è¯‘ä¸€ä¸ª C++ åŸç”Ÿæ‰©å±•çš„æ—¶å€™ï¼Œå®ƒä¼šå»æŒ‡å®šç›®å½•ä¸‹ï¼ˆé€šå¸¸æ˜¯ <strong>~/.node-gyp</strong> ç›®å½•ä¸‹ï¼‰æœæˆ‘ä»¬å½“å‰ Node.js ç‰ˆæœ¬çš„å¤´æ–‡ä»¶å’Œé™æ€è¿æ¥åº“æ–‡ä»¶ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œå®ƒå°±ä¼šç«æ€¥ç«ç‡è·‘å» Node.js å®˜ç½‘ä¸‹è½½ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ª Windows ä¸‹ node-gyp ä¸‹è½½çš„æŒ‡å®šç‰ˆæœ¬ Node.js å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶çš„ç›®å½•ç»“æ„ã€‚</p><p><img src="http://images.gitbook.cn/fca37040-4cc4-11e7-920d-2570ff832158" alt="Windows ä¸‹çš„ Node.js å¤´æ–‡ä»¶ä¸åº“æ–‡ä»¶"></p><p>è¿™ä¸ªå¤´æ–‡ä»¶ç›®å½•ä¼šåœ¨ node-gyp è¿›è¡Œç¼–è¯‘æ—¶ï¼Œä»¥ <code>&quot;include_dirs&quot;</code> å­—æ®µçš„å½¢å¼åˆå¹¶è¿›æˆ‘ä»¬äº‹å…ˆå†™å¥½çš„ <strong>binding.gyp</strong> ä¸­ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œè¿™é‡Œé¢çš„æ‰€æœ‰å¤´æ–‡ä»¶èƒ½è¢«ç›´æ¥ <code>#include &lt;&gt;</code>ã€‚</p><h4 id="å­å‘½ä»¤"><a href="#å­å‘½ä»¤" class="headerlink" title="å­å‘½ä»¤"></a>å­å‘½ä»¤</h4><p>node-gyp æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œçš„ç¨‹åºï¼Œåœ¨å®‰è£…å¥½åèƒ½é€šè¿‡ <code>$ node-gyp</code> ç›´æ¥è¿è¡Œå®ƒã€‚å®ƒæœ‰ä¸€äº›å­å‘½ä»¤ä¾›å¤§å®¶ä½¿ç”¨ã€‚</p><ul><li><code>$ node-gyp configure</code>ï¼šé€šè¿‡å½“å‰ç›®å½•çš„ binding.gyp ç”Ÿæˆé¡¹ç›®æ–‡ä»¶ï¼Œå¦‚ Makefile ç­‰ï¼›</li><li><code>$ node-gyp build</code>ï¼šå°†å½“å‰é¡¹ç›®è¿›è¡Œæ„å»ºç¼–è¯‘ï¼Œå‰ç½®æ“ä½œå¿…é¡»å…ˆ <code>configure</code>ï¼›</li><li><code>$ node-gyp clean</code>ï¼šæ¸…ç†ç”Ÿæˆçš„æ„å»ºæ–‡ä»¶ä»¥åŠè¾“å‡ºç›®å½•ï¼Œè¯´ç™½äº†å°±æ˜¯æŠŠç›®å½•æ¸…ç†äº†ï¼›</li><li><code>$ node-gyp rebuild</code>ï¼šç›¸å½“äºä¾æ¬¡æ‰§è¡Œäº† <code>clean</code>ã€<code>configure</code> å’Œ <code>build</code>ï¼›</li><li><code>$ node-gyp install</code>ï¼šæ‰‹åŠ¨ä¸‹è½½å½“å‰ç‰ˆæœ¬çš„ Node.js çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶åˆ°å¯¹åº”ç›®å½•ã€‚</li></ul><h2 id="æ—¶ä»£åœ¨å¬å”¤"><a href="#æ—¶ä»£åœ¨å¬å”¤" class="headerlink" title="æ—¶ä»£åœ¨å¬å”¤"></a>æ—¶ä»£åœ¨å¬å”¤</h2><blockquote><p>ç¬¬ N å¥—å›½é™… Node.js å¼€å‘è€…åŸç”Ÿ C++ æ¨¡å—å¼€å‘æ–¹å¼ï¼Œæ—¶ä»£åœ¨å¬å”¤ã€‚</p></blockquote><p>é™¤å»å‰æ–‡ä¸­è®²çš„ä¸€äº›ä¸å˜çš„å†…å®¹ï¼Œè¿˜æœ‰å¾ˆå¤šå†…å®¹æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ï¼Œè™½ç„¶è¯´ç”¨è€æ—§çš„å¼€å‘æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥å¼€å‘å‡ºèƒ½ç”¨çš„ C++ åŸç”Ÿæ¨¡å—ï¼Œä½†æ˜¯æ—§ä¸å¦‚æ–°ã€‚</p><p>è€Œä¸”ï¼Œå…¶å®ç›®å‰æ¥è¯´ node-gyp çš„åœ°ä½ä¹Ÿæœ‰å¯èƒ½åœ¨æœªæ¥è¿›è¡Œå˜åŒ–ã€‚å› ä¸ºå½“å¹´ Chromium æ˜¯é€šè¿‡ GYP æ¥ç®¡ç†å®ƒçš„æ„å»ºé…ç½®çš„ï¼Œç°å¦‚ä»Šå·²ç»æ­¥å…¥äº† GN[^6] çš„æ®¿å ‚ï¼Œæ˜¯å¦ä¹Ÿæ„å‘³ç€ node-gyp æœ‰ä¸€å¤©ä¹Ÿä¼šè¢«å¯èƒ½å«åš node-gn çš„ä¸œè¥¿ç»™å–ä»£å‘¢ï¼Ÿ</p><p>è¯ä¸å¤šè¯´ï¼Œå…ˆæ¥çœ‹çœ‹æ²§æµ·æ¡‘ç”°çš„æ•…äº‹å§ã€‚</p><h3 id="é»‘æš—æ—¶ä»£ï¼šnode-waf"><a href="#é»‘æš—æ—¶ä»£ï¼šnode-waf" class="headerlink" title="é»‘æš—æ—¶ä»£ï¼šnode-waf"></a>é»‘æš—æ—¶ä»£ï¼šnode-waf</h3><p>åœ¨ Node.js 0.8 ä¹‹å‰ï¼Œé€šå¸¸åœ¨å¼€å‘ C++ åŸç”Ÿæ¨¡å—çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡ node-waf æ„å»ºçš„ã€‚å½“ç„¶å½¼ node-waf ä¸æ˜¯ç°åœ¨åœ¨ NPM ä»“åº“ä¸Šèƒ½æœåˆ°çš„ node-waf äº†ï¼Œå½“å¹´é‚£ä¸ª node-waf æ—©å°±å¹´ä¹…å¤±ä¿®äº†ã€‚</p><p>è¿™ä¸ªä¸œè¥¿ä½¿ç”¨ä¸€ç§å« wscript çš„æ–‡ä»¶æ¥é…ç½®ã€‚è‡ª Node.js å‡ä¸Š 0.8 ä¹‹åï¼Œå°±è‡ªå¸¦äº† node-gyp çš„æ”¯æŒï¼Œä»æ­¤å°±ä¸å†éœ€è¦ wscript äº†ã€‚</p><p>ä¸è¿‡å°±æ˜¯å› ä¸ºæœ‰è¿™ä¸ªé’é»„äº¤æ¥çš„æ—¶å€™ï¼Œé‚£æ®µæ—¶é—´çš„å„ç§ä½¿ç”¨ C++ æ¥å¼€å‘ Node.js åŸç”Ÿæ‰©å±•çš„åŒ…ä¸ºäº†å…¼å®¹ 0.8 å‰åç‰ˆæœ¬çš„ Node.jsï¼Œé€šå¸¸éƒ½æ˜¯ binding.gyp å’Œ wscript å…±å­˜çš„ã€‚</p><p>å¤§å®¶å¯ä»¥æ¥çœ‹ä¸€ä¸‹ <strong>node-mysql-libmysqlclient</strong> è¿™ä¸ªåŒ…åœ¨å½“å¹´ç›¸åº”æ—¶é—´æ®µçš„æ—¶å€™çš„<a href="https://github.com/Sannis/node-mysql-libmysqlclient/tree/9545ea7485fcc8b07b7c56c5ec3575938bfd4e5f" target="_blank" rel="external">ä»“åº“æ–‡ä»¶</a>ã€‚ä¸ºäº†æ”¯æŒ node-gypï¼Œæœ‰ä¸€ä¸ª binding.gyp æ–‡ä»¶ï¼Œç„¶åè¿˜å­˜ç•™ç€ wscript é…ç½®æ–‡ä»¶ã€‚</p><h3 id="å°å»ºæ—¶ä»£ï¼šæš´åŠ›ï¼æš´åŠ›ï¼æš´åŠ›ï¼"><a href="#å°å»ºæ—¶ä»£ï¼šæš´åŠ›ï¼æš´åŠ›ï¼æš´åŠ›ï¼" class="headerlink" title="å°å»ºæ—¶ä»£ï¼šæš´åŠ›ï¼æš´åŠ›ï¼æš´åŠ›ï¼"></a>å°å»ºæ—¶ä»£ï¼šæš´åŠ›ï¼æš´åŠ›ï¼æš´åŠ›ï¼</h3><p>åœ¨æ—©æœŸçš„æ—¶å€™ï¼ŒNode.js åŸç”Ÿ C++ æ¨¡å—å¼€å‘æ–¹å¼æ˜¯éå¸¸æš´åŠ›çš„ï¼Œç›´æ¥ä½¿ç”¨å…¶æä¾›çš„åŸç”Ÿæ¨¡å—å¼€å‘å¤´æ–‡ä»¶ã€‚</p><p>å¼€å‘è€…ç›´æ¥æ·±å…¥åˆ° Node.js çš„å„ç§ APIï¼Œä»¥åŠ Google V8 çš„ APIã€‚</p><p>ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œåœ¨å‡ å¹´å‰ï¼Œä½ çš„ Node.js C++ åŸç”Ÿæ‰©å±•ä»£ç å¯èƒ½æ˜¯é•¿è¿™æ ·çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Handle&lt;Value&gt; Echo(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(args.Length() &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ThrowException(</span><br><span class="line">            Exception::TypeError(</span><br><span class="line">                String::New(<span class="string">"Wrong number of arguments."</span>)));</span><br><span class="line">        <span class="keyword">return</span> scope.Close(Undefined());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> scope.Close(args[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Handle&lt;Object&gt; exports)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    exports-&gt;Set(String::NewSymbol(<span class="string">"echo"</span>),</span><br><span class="line">        FunctionTemplate::New(Echo)-&gt;GetFunction());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ <code>echo</code> å‡½æ•°ï¼Œè¿”å›ä¼ è¿›æ¥çš„å‚æ•°ã€‚å†™ä½œ JavaScript ç›¸å½“äºæ˜¯è¿™æ ·çš„ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">exports.echo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">arguments</span>.length &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Wrong number of arguments."</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">arguments</span>[<span class="number">0</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é—æ†¾çš„æ˜¯ï¼Œè¿™æ ·çš„ä»£ç å¦‚æœå‘æˆä¸€ä¸ªåŒ…ï¼Œä½ ç°åœ¨æ˜¯æ— è®ºå¦‚ä½•æ— æ³•å®‰è£…çš„ï¼Œé™¤éä½ ç”¨çš„æ˜¯ 0.10.x çš„ Node.js ç‰ˆæœ¬ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œè¿™æ®µä»£ç çš„ç¡®æ˜¯åœ¨ Node.js 0.10.x çš„æ—¶å€™å¯ä»¥ç”¨çš„ã€‚ä½†æ˜¯å†å¾€ä¸Šå‡ Google V8 çš„å¤§ç‰ˆæœ¬ï¼Œè¿™æ®µä»£ç å°±æ— æ³•é€‚ç”¨äº†ï¼Œè®²ç²—æš´ç‚¹å°±æ˜¯æ²¡åŠæ³•å†ç¼–è¯‘é€šè¿‡äº†ã€‚</p><p>å°±æ‹¿ Node.js 6.x ç‰ˆæœ¬çš„ Google V8 æ¥è¯´ï¼Œå‡½æ•°å£°æ˜çš„å¯¹æ¯”æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Handle&lt;Value&gt; Echo(<span class="keyword">const</span> Arguments&amp; args);    <span class="comment">// 0.10.x</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Echo</span><span class="params">(FunctionCallbackInfo&lt;Value&gt;&amp; args)</span></span>; <span class="comment">// 6.x</span></span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Šï¼Œæ ¹æœ¬ä¸éœ€è¦ç­‰åˆ° 6.xã€‚ä¸Šé¢çš„ä»£ç åˆ° 0.12 å°±å·²ç»æ— æ³•å†ç¼–è¯‘é€šè¿‡äº†ã€‚ä¸åªæ˜¯å‡½æ•°å£°æ˜çš„å˜åŒ–ï¼Œè¿å¥æŸ„ä½œç”¨åŸŸ[^7]çš„å£°æ˜æ–¹å¼éƒ½å˜äº†ã€‚</p><p>å¦‚æœè¦è®©å®ƒåœ¨ Node.js 6.x ä¸‹èƒ½ç¼–è¯‘ï¼Œå°±éœ€è¦æ”¹ä»£ç ï¼Œå°±åƒè¿™æ ·ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Echo</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    Isolate* isolate = args.GetIsolate();</span><br><span class="line">    <span class="keyword">if</span>(args.Length() &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        isolate-&gt;ThrowException(</span><br><span class="line">            Exception::TypeError(</span><br><span class="line">                String::NewFromUtf8(isolate, <span class="string">"Wrong number of arguments."</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args.GetReturnValue().Set(args[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Local&lt;Object&gt; exports)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    NODE_SET_METHOD(exports, <span class="string">"echo"</span>, Echo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥é»‘æš—æ—¶ä»£çš„æ–¹å¼è¿›è¡Œ Node.js åŸç”Ÿæ¨¡å—å¼€å‘çš„æ—¶å€™ï¼Œä¸€ä¸ªç‰ˆæœ¬åªèƒ½æ”¯æŒç‰¹å®šå‡ ä¸ªç‰ˆæœ¬çš„ Node.jsï¼Œä¸€æ—¦ Node.js çš„åº•å±‚ API ä»¥åŠ Google V8 çš„ API å‘ç”Ÿå˜åŒ–ï¼Œè€Œè¿™äº›åŸç”Ÿæ¨¡å—åˆä¾èµ–äº†å˜åŒ–äº†çš„ API çš„è¯ï¼ŒåŒ…å°±ä½œåºŸäº†ã€‚é™¤éåŒ…çš„ç»´æŠ¤è€…å»æ”¯æŒæ–°ç‰ˆçš„ APIï¼Œä¸è¿‡è¿™æ ·ä¾èµ–ï¼Œè€ç‰ˆ Node.js ä¸‹å°±åˆæ— æ³•ç¼–è¯‘é€šè¿‡æ–°ç‰ˆçš„åŒ…äº†ã€‚</p><p>è¿™å°±å¾ˆå°´å°¬äº†ã€‚</p><h3 id="åŸå ¡æ—¶ä»£ï¼šNative-Abstractions-for-Node-js"><a href="#åŸå ¡æ—¶ä»£ï¼šNative-Abstractions-for-Node-js" class="headerlink" title="åŸå ¡æ—¶ä»£ï¼šNative Abstractions for Node.js"></a>åŸå ¡æ—¶ä»£ï¼šNative Abstractions for Node.js</h3><p>åœ¨ç»å†äº†é»‘æš—æ—¶ä»£çš„å°´å°¬å±€é¢ä¹‹åï¼Œ2013 å¹´å¹´ä¸­ï¼Œä¸€ä¸ªæ•‘ä¸–ä¸»çªç„¶ç°ä¸–ã€‚</p><p>å®ƒçš„åå­—å«ä½œ <a href="https://github.com/nodejs/nan" target="_blank" rel="external">NAN</a>ï¼Œå…¨ç§° Native Abstractions for Node.jsï¼Œå³ Node.js åŸç”Ÿæ¨¡å—æŠ½è±¡æ¥å£ã€‚</p><blockquote><p>NAN ç”± <a href="https://github.com/rvagg" target="_blank" rel="external">Rod Vagg</a> å’Œ <a href="https://github.com/kkoopa" target="_blank" rel="external">Benjamin Byholm</a> ä¸¤æ‰‹å¸¦å¤§ï¼Œè®°ååœ¨ GitHub çš„ Rod Vagg è´¦å·ä¸‹ã€‚å¹¶ä¸”åœ¨ Node.js ä¸ io.js é»‘å†å²çš„å¹´ä»£ï¼Œè¿™ä¸ªåœ¨ GitHub ä¸Šé¢é¡¹ç›®ç§»åˆ°äº† io.js çš„ç»„ç»‡ä¸‹é¢ï¼›åæ¥ç”±äºä¸¤å®¶åˆé‡å½’äºå¥½ï¼ŒNAN æœ€ç»ˆå½’å±åˆ°äº† <a href="https://github.com/nodejs" target="_blank" rel="external">nodejs</a> è¿™ä¸ªç»„ç»‡ä¸‹é¢ã€‚</p></blockquote><p>æ€»ä¹‹åœ¨ NAN å‡ºç°ä¹‹åï¼ŒNode.js çš„åŸç”Ÿå¼€å‘æ–¹å¼è¿›å…¥äº†åŸå ¡æ—¶ä»£ï¼Œå¹¶ä¸”ä¸€ç›´æŒç»­åˆ°ç°åœ¨ï¼Œç”šè‡³å¯èƒ½ä¼šæŒç»­åˆ°å¥½ä¹…ä¹‹åã€‚</p><p>è¯´ NAN æ˜¯ Node.js åŸç”Ÿæ¨¡å—æŠ½è±¡æ¥å£å¯èƒ½è¿˜æ˜¯æœ‰ç‚¹æŠ½è±¡ï¼Œé‚£ä¹ˆè®²æ˜ç™½ç‚¹ï¼Œå®ƒå°±æ˜¯ä¸€å †å®åˆ¤æ–­ã€‚æ¯”å¦‚å£°æ˜ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œåªéœ€è¦é€šè¿‡ä¸‹é¢çš„ä¸€ä¸ªå®å°±å¯ä»¥äº†ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">NAN_METHOD(Echo)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NAN çš„å®ä¼šåˆ¤æ–­å½“å‰ç¼–è¯‘æ—¶å€™çš„ Node.js ç‰ˆæœ¬ï¼Œæ ¹æ®ä¸åŒç‰ˆæœ¬çš„ Node.js æ¥å±•å¼€ä¸åŒçš„ç»“æœã€‚è¿™ä¼šå„¿å°±åˆä¼šæåˆ°å…ˆå‰çš„ä¸¤ä¸ªå‡½æ•°å£°æ˜å¯¹æ¯”äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Handle&lt;Value&gt; Echo(<span class="keyword">const</span> Arguments&amp; args);    <span class="comment">// 0.10.x</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Echo</span><span class="params">(FunctionCallbackInfo&lt;Value&gt;&amp; args)</span></span>; <span class="comment">// 6.x</span></span><br></pre></td></tr></table></figure><p><code>NAN_METHOD</code> å°†ä¼šåœ¨ä¸åŒç‰ˆæœ¬çš„ Node.js ä¸‹è¢« NAN å±•å¼€æˆä¸Šé¢ä¸¤ä¸ªè¿™æ ·ã€‚</p><p>è€Œä¸” NAN å¯ä¸åªæ˜¯æä¾›äº† <code>NAN_METHOD</code> ä¸€ä¸ªå®ï¼Œå®ƒè¿˜æœ‰ä¸€å¨ä¸€å¨æ•°ä¸æ¸…çš„å®ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚å£°æ˜å¥æŸ„ä½œç”¨åŸŸçš„ <code>Nan::HandleScope</code>ã€èƒ½é»‘ç›’è°ƒèµ· libuv[^8] è¿›è¡Œäº‹ä»¶å¾ªç¯ä¸Šçš„å¼‚æ­¥æ“ä½œçš„ <code>Nan::AsyncWorker</code> ç­‰ã€‚</p><p>äºæ˜¯ï¼Œåœ¨åŸå ¡æ—¶ä»£ï¼Œå¤§å®¶çš„ C++ åŸç”Ÿæ¨¡å—ä»£ç éƒ½å·®ä¸å¤šé•¿è¿™æ ·ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">NAN_METHOD(Echo)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(info.Length() &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Nan::ThrowError(<span class="string">"Wrong number of arguments."</span>);</span><br><span class="line">        <span class="keyword">return</span> info.GetReturnValue().Set(Nan::Undefined());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    info.GetReturnValue().Set(info[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NAN_MODULE_INIT(InitAll)</span><br><span class="line">&#123;</span><br><span class="line">    Nan::Set(</span><br><span class="line">        target,</span><br><span class="line">        Nan::New&lt;String&gt;(<span class="string">"echo"</span>).ToLocalChecked(),</span><br><span class="line">        Nan::GetFunction(Nan::New&lt;v8::FunctionTemplate&gt;(Echo)).ToLocalChecked());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼Œä»£ç åªéœ€è¦éšç€ NAN çš„å‡çº§åšæ”¹å˜å°±å¥½ï¼Œå®ƒä¼šå¸®ä½ å…¼å®¹å„ä¸åŒ Node.js ç‰ˆæœ¬ï¼Œä½¿å…¶åœ¨ä»»æ„ç‰ˆæœ¬éƒ½èƒ½è¢«ç¼–è¯‘ä½¿ç”¨ã€‚</p><blockquote><p>å³ä½¿æ˜¯ NAN è¿™æ ·çš„å¥½ç‰©ï¼Œä¹Ÿæœ‰è‡ªå·±çš„ä¸€ä¸ªä½¿å‘½ï¼Œä½¿å‘½ä¹‹å¤–çš„ä¸œè¥¿ä¼šè¢«é€æ¸å‰¥ç¦»ã€‚æ¯”å¦‚ 0.10.x å’Œ 0.12.x ç­‰ç‰ˆæœ¬å°±åº”è¯¥è¦é€€å‡ºå†å²èˆå°äº†ï¼ŒNAN ä¼šé€æ¸æ”¾å¼ƒå¯¹å®ƒä»¬çš„å…¼å®¹å’Œæ”¯æŒã€‚</p></blockquote><h3 id="å¸å›½æ—¶ä»£ï¼šç¬¦åˆ-ABI-çš„-N-API"><a href="#å¸å›½æ—¶ä»£ï¼šç¬¦åˆ-ABI-çš„-N-API" class="headerlink" title="å¸å›½æ—¶ä»£ï¼šç¬¦åˆ ABI çš„ N-API"></a>å¸å›½æ—¶ä»£ï¼šç¬¦åˆ ABI çš„ N-API</h3><p>è‡ªä»å‰å‡ å¤© Node.js v8.0.0 å‘å¸ƒä¹‹åï¼ŒNode.js æ¨å‡ºäº†å…¨æ–°çš„ç”¨äºå¼€å‘ C++ åŸç”Ÿæ¨¡å—çš„æ¥å£ï¼ŒN-APIã€‚</p><blockquote><p>æ®å®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼Œå®ƒçš„å‘éŸ³å°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„ <code>N</code>ï¼ŒåŠ ä¸Š APIï¼Œå³å››ä¸ªè‹±æ–‡å­—æ¯å•ç‹¬å‘éŸ³ã€‚</p></blockquote><p>è¿™ä¸œè¥¿ç›¸è¾ƒäºå…ˆå‰ä¸‰ä¸ªæ—¶ä»£æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿä¸ºä»€ä¹ˆä¼šæ˜¯æ›´è¿›ä¸€æ­¥çš„å¸å›½æ—¶ä»£å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå³ä½¿æ˜¯åœ¨ NAN çš„å¼€å‘æ–¹å¼ä¸‹ï¼Œä¸€æ¬¡ç¼–å†™å¥½çš„ä»£ç åœ¨ä¸åŒç‰ˆæœ¬çš„ Node.js ä¸‹ä¹Ÿéœ€è¦é‡æ–°ç¼–è¯‘ï¼Œå¦åˆ™ç‰ˆæœ¬ä¸ç¬¦çš„è¯ Node.js æ— æ³•æ­£å¸¸è½½å…¥ä¸€ä¸ª C++ æ‰©å±•ã€‚å³ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„ç¼–è¯‘ã€‚</p><p>è€Œ N-API ç›¸è¾ƒäº NAPI æ¥è¯´ï¼Œå®ƒæŠŠ Node.js çš„æ‰€æœ‰åº•å±‚æ•°æ®ç»“æ„å…¨éƒ¨é»‘ç›’åŒ–ï¼ŒæŠ½è±¡æˆ N-API å½“ä¸­çš„æ¥å£ã€‚</p><p>ä¸åŒç‰ˆæœ¬çš„ Node.js ä½¿ç”¨åŒæ ·çš„æ¥å£ï¼Œè¿™äº›æ¥å£æ˜¯ç¨³å®šåœ° ABI åŒ–çš„ï¼Œå³åº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼‰ã€‚è¿™ä½¿å¾—åœ¨ä¸åŒ Node.js ä¸‹ï¼Œåªè¦ ABI çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œç¼–è¯‘å¥½çš„ C++ æ‰©å±•å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚äº‹å®ä¸Šï¼Œåœ¨æ”¯æŒ N-API æ¥å£çš„ Node.js ä¸­ï¼Œçš„ç¡®å°±æŒ‡å®šäº†å½“å‰ Node.js æ‰€ä½¿ç”¨çš„ ABI ç‰ˆæœ¬ã€‚</p><p>ä¸ºäº†ä½¿å¾—ä»¥åçš„ C++ æ‰©å±•å¼€å‘ã€ç»´æŠ¤æ›´æ–¹ä¾¿ï¼ŒN-API è‡´åŠ›äºä»¥ä¸‹çš„å‡ ä¸ªç›®æ ‡ï¼š</p><ul><li>ä»¥ C çš„é£æ ¼æä¾›ç¨³å®š ABI æ¥å£ï¼›</li><li>æ¶ˆé™¤ Node.js ç‰ˆæœ¬çš„å·®å¼‚ï¼›</li><li>æ¶ˆé™¤ JavaScript å¼•æ“çš„å·®å¼‚ï¼ˆå¦‚ Google V8ã€Microsoft ChakraCore ç­‰ï¼‰ã€‚</li></ul><p>è€Œè¿™äº› API ä¸»è¦å°±æ˜¯ç”¨æ¥åˆ›å»ºå’Œæ“ä½œ JavaScript çš„å€¼äº†ï¼Œæˆ‘ä»¬å°±å†ä¹Ÿä¸ç”¨ç›´æ¥ä½¿ç”¨ Google V8 æä¾›çš„æ•°æ®ç±»å‹äº†ã€‚æ¯•ç«Ÿåœ¨ NAN ä¸­ï¼Œå°±ç®—æˆ‘ä»¬æœ‰æ—¶å€™çœ‹ä¸åˆ° Google V8 çš„å½±å­ï¼Œå®é™…ä¸Šåœ¨å®å±•å¼€åè¿˜æ˜¯æ— æ•°çš„ Google V8 æ•°æ®ç»“æ„ã€‚</p><p>ä¸ºäº†è¾¾æˆä¸Šè¿°éšè—çš„ç›®æ ‡ï¼ŒN-API çš„å§¿åŠ¿å°±å˜æˆäº†è¿™æ ·ï¼š</p><ul><li>æä¾›å¤´æ–‡ä»¶ <strong>node_api.h</strong>ï¼›</li><li>ä»»ä½• N-API è°ƒç”¨éƒ½è¿”å›ä¸€ä¸ª <code>napi_status</code> æšä¸¾ï¼Œæ¥è¡¨ç¤ºè¿™æ¬¡è°ƒç”¨æˆåŠŸä¸å¦ï¼›</li><li>N-API çš„è¿”å›å€¼ç”±äºè¢« <code>napi_status</code> å å‘äº†ï¼Œæ‰€ä»¥çœŸå®è¿”å›å€¼ç”±ä¼ å…¥çš„å‚æ•°æ¥ç»§æ‰¿ï¼Œå¦‚ä¼ å…¥ä¸€ä¸ªæŒ‡é’ˆè®©å‡½æ•°æ“ä½œï¼›</li><li>æ‰€æœ‰ JavaScript æ•°æ®ç±»å‹éƒ½è¢«é»‘ç›’ç±»å‹ <code>napi_value</code> å°è£…ï¼Œä¸å†æ˜¯ç±»ä¼¼äº <code>v8::Object</code>ã€<code>v8::Number</code> ç­‰ç±»å‹ï¼›</li><li>å¦‚æœå‡½æ•°è°ƒç”¨ä¸æˆåŠŸï¼Œå¯ä»¥é€šè¿‡ <code>napi_get_last_error_info</code> å‡½æ•°æ¥è·å–æœ€åä¸€æ¬¡å‡ºé”™çš„ä¿¡æ¯ã€‚</li></ul><blockquote><p><strong>æ³¨æ„ï¼š</strong>å“ªæ€•æ˜¯ç°åœ¨çš„ Node.js v8.x ç‰ˆæœ¬ï¼ŒN-API ä»å¤„äºä¸€ä¸ªå®éªŒçŠ¶æ€ï¼Œä¸ªäººè®¤ä¸ºè¿˜æœ‰éå¸¸é•¿çš„ä¸€æ®µè·¯è¦èµ°ï¼Œæ‰€ä»¥å¤§å®¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿˜ä¸å¿…å¤ªè¿‡äºæ¿€è¿›ï¼Œä¸è¿‡ N-API ä¾ç„¶æ˜¯å¤§åŠ¿æ‰€è¶‹ï¼›ä¸è¿‡å¯¹äºä½¿ç”¨è€ç‰ˆæœ¬çš„ Node.js å¼€å‘è€…æ¥è¯´ï¼Œå¤§å®¶ä¹Ÿä¸è¦ç€æ€¥ï¼Œå³ä½¿ N-API æ˜¯åœ¨ v8.x æ‰æ­£å¼é›†æˆè¿› Node.jsï¼Œåœ¨å…¶å®ƒæ—§ç‰ˆæœ¬çš„ Node.js ä¸­ä¾ç„¶å¯ä»¥å°† N-API ä½œä¸ºå¤–æŒ‚å¼çš„å¤´æ–‡ä»¶9ä¸­ä½¿ç”¨ï¼Œåªä¸è¿‡æ— æ³•åšåˆ°è·¨ç‰ˆæœ¬çš„ç‰¹æ€§ï¼Œè¿™åªæ˜¯å®ƒåšçš„å‘åå…¼å®¹çš„ä¸€ä¸ªäº‹æƒ…è€Œå·²ã€‚</p></blockquote><p>å…³äº N-API ä¸€ç³»åˆ—çš„å‡½æ•°å¯ä»¥è®¿é—®å®ƒçš„<a href="https://nodejs.org/docs/v8.0.0/api/n-api.html" target="_blank" rel="external">æ–‡æ¡£</a>äº†è§£æ›´å¤šè¯¦æƒ…ï¼Œç°åœ¨æˆ‘ä»¬æ¥ç‚¹æ–™å„¿è®©å¤§å®¶å¯¹ N-API çš„å°è±¡ä¸æ˜¯é‚£ä¹ˆæŠ½è±¡ã€‚</p><h4 id="æ¨¡å—åˆå§‹åŒ–"><a href="#æ¨¡å—åˆå§‹åŒ–" class="headerlink" title="æ¨¡å—åˆå§‹åŒ–"></a>æ¨¡å—åˆå§‹åŒ–</h4><p>åœ¨å°å»ºæ—¶ä»£å’Œ NAN æ‰€å¤„çš„ï¼Œæ¨¡å—çš„åˆå§‹åŒ–æ˜¯äº¤ç»™ Node.js æä¾›çš„å®æ¥å®ç°çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">NODE_MODULE(addon, Init)</span><br></pre></td></tr></table></figure><p>è€Œåˆ°äº†å½“å‰çš„ N-APIï¼Œå®ƒå°±å˜æˆäº† N-API çš„ä¸€ä¸ªå®äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">NAPI_MODULE(addon, Init)</span><br></pre></td></tr></table></figure><p>ç›¸åº”åœ°ï¼Œè¿™ä¸ªåˆå§‹åŒ–å‡½æ•° <code>Init</code> çš„å†™æ³•ä¹Ÿä¼šæœ‰æ‰€æ”¹å˜ã€‚æ¯”å¦‚è¿™æ˜¯å°å»ºæ—¶ä»£å’Œ NAN æ—¶ä»£çš„ä¸¤ç§ä¸åŒå†™æ³•ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æš´åŠ›å†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Local&lt;Object&gt; exports)</span> </span>&#123;</span><br><span class="line">    NODE_SET_METHOD(exports, <span class="string">"echo"</span>, Echo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NAN å†™æ³•</span></span><br><span class="line">NAN_MODULE_INIT(Init)</span><br><span class="line">&#123;</span><br><span class="line">    Nan::Set(</span><br><span class="line">        target,</span><br><span class="line">        Nan::New&lt;String&gt;(<span class="string">"echo"</span>).ToLocalChecked(),</span><br><span class="line">        Nan::GetFunction(Nan::New&lt;v8::FunctionTemplate&gt;(Echo)).ToLocalChecked());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œåˆ°äº† N-API çš„æ—¶å€™ï¼Œè¿™ä¸ª <code>Init</code> å‡½æ•°å°±è¯¥æ˜¯è¿™æ ·çš„äº†ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(napi_env env, napi_value exports, napi_value <span class="keyword">module</span>, <span class="keyword">void</span>* priv)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    napi_status status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨äºè®¾ç½® exports å¯¹è±¡çš„æè¿°ç»“æ„ä½“</span></span><br><span class="line">    napi_property_descriptor desc =</span><br><span class="line">        &#123; <span class="string">"echo"</span>, <span class="number">0</span>, Echo, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, napi_default, <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠŠ "echo" è®¾ç½®åˆ° exports å»</span></span><br><span class="line">    status = napi_define_properties(env, exports, <span class="number">1</span>, &amp;desc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>napi_property_descriptor</code> æ˜¯ç”¨äºè®¾ç½®å¯¹è±¡å±æ€§çš„æè¿°ç»“æ„ä½“ï¼Œå®ƒçš„å£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* utf8name;</span><br><span class="line"></span><br><span class="line">  napi_callback method;</span><br><span class="line">  napi_callback getter;</span><br><span class="line">  napi_callback setter;</span><br><span class="line">  napi_value value;</span><br><span class="line"></span><br><span class="line">  napi_property_attributes attributes;</span><br><span class="line">  <span class="keyword">void</span>* data;</span><br><span class="line">&#125; napi_property_descriptor;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä¸Šé¢ <code>Init</code> å‡½æ•°ä¸­çš„ <code>desc</code> æ„æ€å°±æ˜¯ï¼Œå³å°†è¢«æŒ‚åœ¨çš„å¯¹è±¡ä¸‹ä¼šæŒ‚ä¸€ä¸ªå« <code>&quot;echo&quot;</code> çš„ä¸œè¥¿ï¼Œå®ƒçš„å‡½æ•°æ˜¯ <code>Echo</code>ï¼Œå…¶å®ƒçš„ <code>getter</code>ã€<code>setter</code> ç­‰å…¨æ˜¯ç©ºæŒ‡é’ˆï¼Œè€Œå±æ€§åˆ™æ˜¯ <code>napi_default</code>ã€‚</p><blockquote><p><code>napi_property_attributes</code> é™¤äº† <code>napi_default</code> ä¹‹å¤–ï¼Œè¿˜æœ‰è¯¸å¦‚åªè¯»ã€æ˜¯å¦å¯æšä¸¾ç­‰å±æ€§ã€‚</p></blockquote></blockquote><h4 id="å‡½æ•°å£°æ˜"><a href="#å‡½æ•°å£°æ˜" class="headerlink" title="å‡½æ•°å£°æ˜"></a>å‡½æ•°å£°æ˜</h4><p>è¿˜è®°å¾—ä¹‹å‰çš„ä¸¤ç§å‡½æ•°å£°æ˜å—ï¼Ÿç¬¬ä¸‰æ¬¡å†æ¬è¿‡æ¥ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Handle&lt;Value&gt; Echo(<span class="keyword">const</span> Arguments&amp; args);    <span class="comment">// 0.10.x</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Echo</span><span class="params">(FunctionCallbackInfo&lt;Value&gt;&amp; args)</span></span>; <span class="comment">// 6.x</span></span><br></pre></td></tr></table></figure><p>åœ¨ N-API ä¸­ï¼Œä½ ä¸ç”¨å†è¢«å‘ŠçŸ¥éœ€è¦æœ‰ C++ åŸºç¡€ï¼ŒC å³å¯ã€‚å› ä¸ºåœ¨ N-API é‡Œé¢ï¼Œå£°æ˜ä¸€ä¸ª <code>Echo</code> æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function">napi_value <span class="title">Echo</span><span class="params">(napi_env env, napi_callback_info info)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    napi_status status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">size_t</span> argc = <span class="number">1</span>;</span><br><span class="line">    napi_value argv[<span class="number">1</span>];</span><br><span class="line">    status = napi_get_cb_info(env, info, &amp;argc, argv, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(status != napi_ok || argc &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        napi_throw_type_error(env, <span class="string">"Wrong number of arguments"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// napi_value å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿”å›ç©ºæŒ‡é’ˆè¡¨ç¤ºæ— è¿”å›å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> argv[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>é‡è¦ï¼š</strong>ç›®å‰ 8.0.0 å’Œ 8.1.0 ç‰ˆæœ¬çš„ Node.js å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå…³äº N-API çš„å„ç§æ¥å£æ–‡æ¡£é”™è¯¯é¢‡å¤šï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ä»¥èƒ½ä½¿ç”¨çš„æ¥å£ä¸ºå‡†ã€‚</p><p>è€Œä¸”ç°åœ¨å¤§å®¶ä¹Ÿæœ‰å¾ˆå¤šäººæ­£åœ¨å¸®å¿™ä¸€èµ·ä¿®å¤æ–‡æ¡£ã€‚ä¾‹å¦‚ç°åœ¨çš„ JavaScript å‡½æ•°å£°æ˜è¿”å›å€¼å…¶å®æ˜¯ <code>napi_value</code>ï¼Œè€Œå®˜æ–¹æ–‡æ¡£ä¸Šè¿˜æ˜¯è€æ—§çš„ <code>void</code>ã€‚åˆæ¯”å¦‚ <code>`napi_property_descriptor_desc</code> ç»“æ„ä½“ä¸­ï¼Œåœ¨ <code>utf8name</code> ä¹‹åè¿˜æœ‰ä¸€ä¸ª <code>napi_value</code> çš„å˜é‡ï¼Œè€Œæ–‡æ¡£ä¸­å´æ˜¯æ²¡æœ‰çš„ã€‚</p><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘å‰é¢å¼ºè°ƒç›®å‰æ¥è¯´ N-API è¿˜å¤„äºè¯•éªŒé˜¶æ®µã€‚æ¯•ç«Ÿ API å¹¶æ²¡æœ‰å®Œå…¨ç¨³å®šä¸‹æ¥ï¼Œè¿˜å¤„äºä¸€ä¸ªå¿«é€Ÿè¿­ä»£çš„æ­¥ä¼ä¸­ï¼Œæ–‡æ¡£çš„æ›´æ–°å¹¶æœªè·Ÿä¸Šä»£ç çš„æ›´æ–°ã€‚è‡³å°‘åœ¨ç¬”è€…å†™ä½œçš„å½“å‰æ˜¯è¿™æ ·çš„ï¼ˆç°åœ¨æ—¥æœŸ 2017 å¹´ 6 æœˆ 9 æ—¥ï¼‰ã€‚</p></blockquote><p>ä¸Šé¢ä»£ç åˆ†æ­¥è§£æã€‚</p><ul><li>é€šè¿‡ <code>napi_get_cb_info</code> è·å–å½“æ¬¡å‡½æ•°è¯·æ±‚çš„å‚æ•°ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‚æ•°æ•°é‡å’Œå‚æ•°ä½“ï¼ˆå‚æ•°ä½“ä»¥ <code>napi_value</code> çš„æ•°ç»„å½¢å¼ä½“ç°ï¼‰ï¼›</li><li>çœ‹çœ‹è§£ææœ‰æ— å‡ºé”™ï¼ˆ<code>status</code> ä¸ç­‰äº <code>napi_ok</code>ï¼‰æˆ–è€…çœ‹çœ‹å‚æ•°æ•°é‡æ˜¯å¦å°äº 1ï¼›<ul><li>è‹¥è§£æå‡ºé”™æˆ–è€…å‚æ•°æ•°é‡å°äº 1ï¼Œé€šè¿‡ <code>napi_throw_type_error</code> åœ¨ JavaScript å±‚æŠ›å‡ºä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼Œå¹¶è¿”å›ï¼›</li><li>è‹¥æ— é”™åˆ™ç»§ç»­è¿›è¡Œï¼›</li></ul></li><li>è¿”å› <code>argv[0]</code>ï¼Œå³ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</li></ul><h4 id="Demo-å®Œæ•´ä»£ç "><a href="#Demo-å®Œæ•´ä»£ç " class="headerlink" title="Demo å®Œæ•´ä»£ç "></a>Demo å®Œæ•´ä»£ç </h4><p>è¿™é‡Œæ”¾ä¸Šè¿™ä¸ª Echo æ ·ä¾‹çš„å®Œæ•´ä»£ç ï¼Œå¤§å®¶å¯ä»¥æ‹¿å›å®¶è¯•è¯•çœ‹ã€‚</p><h5 id="binding-gyp"><a href="#binding-gyp" class="headerlink" title="binding.gyp"></a>binding.gyp</h5><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"targets"</span>: [&#123;</span><br><span class="line">    <span class="attr">"target_name"</span>: <span class="string">"addon"</span>,</span><br><span class="line">    <span class="attr">"sources"</span>: [ <span class="string">"addon.cc"</span> ],</span><br><span class="line">    <span class="attr">"cflags!"</span>: [ <span class="string">"-fno-exceptions"</span> ],</span><br><span class="line">    <span class="attr">"cflags_cc!"</span>: [ <span class="string">"-fno-exceptions"</span> ],</span><br><span class="line">    <span class="attr">"xcode_settings"</span>: &#123;</span><br><span class="line">      <span class="attr">"GCC_ENABLE_CPP_EXCEPTIONS"</span>: <span class="string">"YES"</span>,</span><br><span class="line">      <span class="attr">"CLANG_CXX_LIBRARY"</span>: <span class="string">"libc++"</span>,</span><br><span class="line">      <span class="attr">"MACOSX_DEPLOYMENT_TARGET"</span>: <span class="string">"10.7"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"msvs_settings"</span>: &#123;</span><br><span class="line">      <span class="attr">"VCCLCompilerTool"</span>: &#123; <span class="attr">"ExceptionHandling"</span>: <span class="number">1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="addon-cc"><a href="#addon-cc" class="headerlink" title="addon.cc"></a>addon.cc</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;node_api.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">napi_value <span class="title">Echo</span><span class="params">(napi_env env, napi_callback_info info)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    napi_status status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">size_t</span> argc = <span class="number">1</span>;</span><br><span class="line">    napi_value argv[<span class="number">1</span>];</span><br><span class="line">    status = napi_get_cb_info(env, info, &amp;argc, argv, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(status != napi_ok || argc &lt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        napi_throw_type_error(env, <span class="string">"Wrong number of arguments"</span>);</span><br><span class="line">        status = napi_get_undefined(env, argv);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> argv[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(napi_env env, napi_value exports, napi_value <span class="keyword">module</span>, <span class="keyword">void</span>* priv)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    napi_status status;</span><br><span class="line">    napi_property_descriptor desc =</span><br><span class="line">        &#123; <span class="string">"echo"</span>, <span class="number">0</span>, Echo, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, napi_default, <span class="number">0</span> &#125;;</span><br><span class="line">    status = napi_define_properties(env, exports, <span class="number">1</span>, &amp;desc);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NAPI_MODULE(addon, Init)</span><br></pre></td></tr></table></figure><h4 id="ä¹˜é£ç ´æµª"><a href="#ä¹˜é£ç ´æµª" class="headerlink" title="ä¹˜é£ç ´æµª"></a>ä¹˜é£ç ´æµª</h4><p>åœ¨å®Œæˆäº†ä»£ç ä¹‹åï¼Œå¤§å®¶èµ¶ç´§è¯•ä¸€ä¸‹ä»£ç å§ã€‚</p><p>é¦–å…ˆåœ¨ Node.js v8.x ä¸‹è¿›è¡Œè¯•éªŒï¼ŒæŠŠè¿™ä¸¤æ®µä»£ç åˆ†åˆ«æ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œå‘½åå¥½åï¼Œæ‰§è¡Œè¿™æ ·çš„ç»ˆç«¯å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ node-gyp rebuild</span><br><span class="line">...</span><br><span class="line">$ node --napi-modules</span><br><span class="line">(node:52264) Warning: N-API is an experimental feature and could change at any time</span><br><span class="line">&gt; const addon = require(<span class="string">"./build/Release/addon"</span>);</span><br><span class="line">undefined</span><br><span class="line">&gt; addon.echo(<span class="string">"2333"</span>);</span><br><span class="line"><span class="string">'2333'</span></span><br><span class="line">&gt; addon.echo(<span class="string">"è›‹èŠ±æ±¤ğŸ¶"</span>, <span class="string">"å—ç“œé¥¼ğŸ±"</span>);</span><br><span class="line"><span class="string">'è›‹èŠ±æ±¤ğŸ¶'</span></span><br><span class="line">&gt; addon.echo();</span><br><span class="line">TypeError: Wrong number of arguments</span><br><span class="line">    at repl:1:7</span><br><span class="line">    at ContextifyScript.Script.runInThisContext (vm.js:44:33)</span><br><span class="line">    at REPLServer.defaultEval (repl.js:239:29)</span><br><span class="line">    at bound (domain.js:301:14)</span><br><span class="line">    at REPLServer.runBound [as <span class="built_in">eval</span>] (domain.js:314:12)</span><br><span class="line">    at REPLServer.onLine (repl.js:433:10)</span><br><span class="line">    at emitOne (events.js:120:20)</span><br><span class="line">    at REPLServer.emit (events.js:210:7)</span><br><span class="line">    at REPLServer.Interface._onLine (readline.js:278:10)</span><br><span class="line">    at REPLServer.Interface._line (readline.js:625:8)</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„ï¼š</strong>è¿˜æ˜¯å› ä¸ºè¯•éªŒç‰¹æ€§ï¼Œç›®å‰åœ¨ Node.js v8.x è¦åŠ è½½å’Œæ‰§è¡Œ N-API çš„ C++ æ‰©å±•çš„è¯ï¼Œåœ¨å¯åŠ¨ <code>node</code> çš„æ—¶å€™éœ€è¦åŠ ä¸Š <code>--napi-modules</code> å‚æ•°ï¼Œè¡¨ç¤ºè¿™æ¬¡æ‰§è¡Œè¦å¯ç”¨ N-API ç‰¹æ€§ã€‚</p></blockquote><p>æ•ˆæœæ˜¾è€Œæ˜“è§ï¼Œåœ¨åˆšå¯åŠ¨ Node.js REPL çš„æ—¶å€™ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Šã€‚</p><blockquote><p>(node:52264) Warning: N-API is an experimental feature and could change at any time</p></blockquote><p>è¡¨ç¤ºå®ƒç›®å‰è¿˜ä¸æ˜¯ç‰¹åˆ«ç¨³å®šï¼Œä½†æ˜¯å€¼å¾—æˆ‘ä»¬å±•æœ›æœªæ¥ã€‚ç„¶ååœ¨æˆ‘ä»¬ <code>require()</code> æ‰©å±•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªæ‹¥æœ‰ <code>echo</code> å‡½æ•°çš„å¯¹è±¡äº†ã€‚</p><p>æˆ‘ä»¬å°è¯•äº†ä¸‰ç§è°ƒç”¨æ–¹å¼ã€‚ç¬¬ä¸€æ¬¡æ˜¯è§„è§„çŸ©çŸ©ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œ<code>echo</code> å¦‚æœŸè¿”å›æˆ‘ä»¬ä¼ å…¥çš„å‚æ•° <code>&quot;2333&quot;</code>ï¼›ç¬¬äºŒæ¬¡ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œ<code>echo</code> è¿”å›äº†ç¬¬ä¸€ä¸ªå‚æ•° <code>&quot;è›‹èŠ±æ±¤ğŸ¶&quot;</code>ï¼›æœ€åä¸€æ¬¡æˆ‘ä»¬æ²¡ä¼ ä»»ä½•å‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™å°±èµ°åˆ°äº† C++ æ‰©å±•ä¸­åˆ¤æ–­å‡½æ•°å‚æ•°æ•°é‡å¤±è´¥çš„æ¡ä»¶åˆ†æ”¯ï¼Œå°±æŠ›å‡ºäº†ä¸€ä¸ª <code>Wrong number of arguments</code> çš„é”™è¯¯å¯¹è±¡ã€‚</p><p>æ€»ä¹‹ï¼Œå®ƒæŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸè·‘èµ·æ¥äº†ã€‚å¹¶ä¸”ä»£ç é‡Œé¢å¹¶æ²¡æœ‰ä»»ä½• Node.js é N-API æ‰€æš´éœ²å‡ºæ¥çš„æ•°æ®ç»“æ„å’Œ V8 çš„æ•°æ®ç»“æ„â€”â€”ç‰ˆæœ¬å·®å¼‚æ¶ˆé™¤äº†ã€‚</p><p>æ¥ä¸‹æ¥æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»åˆ°äº†ï¼Œå¦‚æœè¯»è€…æ˜¯ä½¿ç”¨ <code>nvm</code> æ¥ç®¡ç†è‡ªå·±çš„ Node.js ç‰ˆæœ¬çš„è¯ï¼Œå¯ä»¥å°è¯•ç€å®‰è£…ä¸€ä¸ª 8.1.0 çš„ Node.js ç‰ˆæœ¬ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ nvm install 8.1.0</span><br></pre></td></tr></table></figure><p>åœ¨å®‰è£…æˆåŠŸåˆ‡æ¢ç‰ˆæœ¬æˆåŠŸåï¼Œå°è¯•ç€ç›´æ¥æ‰“å¼€ Node.js RELPï¼Œå¿˜æ‰å†æ¬¡ç¼–è¯‘åˆšæ‰ç¼–è¯‘å¥½çš„æ‰©å±•è¿™ä¸€æ­¥ã€‚ï¼ˆä¸è¿‡åˆ«å¿˜äº† <code>--napi-module</code> å‚æ•°ï¼‰</p><p>æŠŠåˆšæ‰ç”¨äºæµ‹è¯•çš„å‡ å¥ JavaScript ä»£ç å†é‡å¤åœ°è¾“å…¥â€”â€”N-API è¯šä¸æˆ‘æ¬ºï¼Œå±…ç„¶è¿˜æ˜¯èƒ½è¾“å‡ºç»“æœã€‚è¿™å¯¹äºä»¥å‰çš„æš´åŠ›åšæ³•å’Œ NAN åšæ³•æ¥è¯´ï¼Œæ— ç–‘æ˜¯éå¸¸å¤§çš„ä¸€ä¸ªè¿›æ­¥ã€‚</p><h4 id="å‘ä¸‹å…¼å®¹"><a href="#å‘ä¸‹å…¼å®¹" class="headerlink" title="å‘ä¸‹å…¼å®¹"></a>å‘ä¸‹å…¼å®¹</h4><p>è‡³æ­¤ï¼Œæˆ‘å¸Œæœ›å¤§å®¶è¿˜æ²¡æœ‰å¿˜è®° N-API æ˜¯è‡ª Node.js 8.0 ä¹‹åå‡ºçš„ç‰¹æ€§ã€‚æ‰€ä»¥ä¹‹å‰ Demo çš„ä»£ç å¹¶ä¸èƒ½åœ¨ Node.js 8.0 ä¹‹å‰çš„ç‰ˆæœ¬å¦‚æœŸç¼–è¯‘å’Œè¿è¡Œã€‚</p><p>è¾›è¾›è‹¦è‹¦å†™å¥½çš„åŒ…ï¼Œå±…ç„¶ä¸èƒ½åœ¨ Node.js 6.x ä¸‹é¢è·‘ï¼Œæä»€ä¹ˆã€‚</p><p><img src="http://images.gitbook.cn/25ae5fa0-4cf6-11e7-92f5-09e07d17628a" alt="å½“æ—¶æˆ‘å°±ä¸ä¹æ„äº†"></p><p>å…ˆåˆ«æ€¥ç€æ‘”ã€‚æ–‡ä¸­ä¹‹å‰ä¹Ÿè¯´äº†ï¼Œæœ‰ä¸€ä¸ªå¤–æŒ‚å¼å¤´æ–‡ä»¶çš„åŒ…ï¼Œå…¶åŒ…åæ˜¯ <code>node-addon-api</code>ã€‚</p><p>æˆ‘ä»¬å°±è¯•ç€é€šè¿‡å®ƒæ¥è¿›è¡Œå‘ä¸‹å…¼å®¹å§ã€‚é¦–å…ˆåœ¨æˆ‘ä»¬åˆšæ‰çš„æºç ç›®å½•æŠŠè¿™ä¸ªåŒ…ç»™å®‰è£…ä¸Šã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm install --save node-addon-api</span><br></pre></td></tr></table></figure><blockquote><p>è¿˜æ˜¯ç”±äºå¿«é€Ÿè¿­ä»£çš„åŸå› ï¼Œæˆ‘ä¸èƒ½ä¿è¯è¿™ä¸ªåŒ…å½“å‰ç‰ˆæœ¬çš„æ—¶æ•ˆæ€§ï¼Œä¸è¿‡æˆ‘ç›¸ä¿¡å¤§å®¶éƒ½æœ‰æ¢ç´¢ç²¾ç¥ï¼Œåœ¨æœªæ¥ç‰ˆæœ¬ä¸ç¬¦å¯¼è‡´çš„ API ä¸ç¬¦çš„é—®é¢˜åº”è¯¥éƒ½èƒ½è§£å†³ã€‚</p></blockquote><p>ç„¶åï¼Œç»™æˆ‘ä»¬çš„ <strong>binding.gyp</strong> å‡½æ•°åŠ ç‚¹æ–™ï¼ŒåŠ ä¸¤ä¸ªå­—æ®µï¼Œé‡Œé¢æ˜¯ä¸¤ä¸ªæŒ‡ä»¤å±•å¼€ã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"include_dirs": [ "&lt;!@(node -p \"require('node-addon-api').include\")" ],</span><br><span class="line">"dependencies": [ "&lt;!(node -p \"require('node-addon-api').gyp\")" ]</span><br></pre></td></tr></table></figure><p><code>&lt;!@</code> å’Œ <code>&lt;!</code> å¼€å¤´çš„å­—ç¬¦ä¸²åœ¨ GYP ä¸­ä»£è¡¨æŒ‡ä»¤ï¼Œè¡¨ç¤ºå®ƒçš„å€¼æ˜¯åé¢çš„æŒ‡ä»¤çš„æ‰§è¡Œç»“æœã€‚ä¸Šé¢ä¸¤æ¡æŒ‡ä»¤çš„è¿”å›ç»“æœåˆ†åˆ«æ˜¯å¤–æŒ‚å¼å¤´æ–‡ä»¶çš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œä»¥åŠå¤–æŒ‚å¼ N-API è¿™ä¸ªåŒ…ç¼–è¯‘æˆé™æ€è¿æ¥åº“ä¾›æˆ‘ä»¬è‡ªå·±çš„åŒ…ä½¿ç”¨çš„ä¾èµ–å£°æ˜ã€‚</p><p>æœ‰äº†è¿™ä¸¤ä¸ªå­—æ®µåï¼Œå°±è¡¨ç¤ºæˆ‘ä»¬ä¾èµ–äº†å¤–æŒ‚å¼ N-API å¤´æ–‡ä»¶ã€‚è€Œä¸”å®ƒå†…éƒ¨è‡ªå¸¦åˆ¤æ–­ï¼Œå¦‚æœç‰ˆæœ¬å·²ç»è¾¾åˆ°äº†æœ‰ N-API çš„è¦æ±‚ï¼Œå®ƒçš„ä¾èµ–å°±ä¼šæ˜¯ä¸€ä¸ªç©ºä¾èµ–ï¼Œå³ä¸ä¾èµ–å¤–æŒ‚å¼ N-API ç¼–è¯‘çš„é™æ€è¿æ¥åº“ã€‚</p><p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨äº†å¤–æŒ‚å¼çš„ N-APIï¼Œèƒ½è‡ªåŠ¨é€‚é… Node.js 8.x å’Œä½ç‰ˆæœ¬ã€‚</strong></p><p>äºæ˜¯è¿™ä¸ª <strong>binding.gyp</strong> ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·å­çš„ã€‚</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"targets"</span>: [&#123;</span><br><span class="line">    <span class="attr">"target_name"</span>: <span class="string">"addon"</span>,</span><br><span class="line">    <span class="attr">"sources"</span>: [ <span class="string">"addon.cc"</span> ],</span><br><span class="line">    <span class="attr">"cflags!"</span>: [ <span class="string">"-fno-exceptions"</span> ],</span><br><span class="line">    <span class="attr">"cflags_cc!"</span>: [ <span class="string">"-fno-exceptions"</span> ],</span><br><span class="line">    <span class="attr">"xcode_settings"</span>: &#123;</span><br><span class="line">      <span class="attr">"GCC_ENABLE_CPP_EXCEPTIONS"</span>: <span class="string">"YES"</span>,</span><br><span class="line">      <span class="attr">"CLANG_CXX_LIBRARY"</span>: <span class="string">"libc++"</span>,</span><br><span class="line">      <span class="attr">"MACOSX_DEPLOYMENT_TARGET"</span>: <span class="string">"10.7"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"msvs_settings"</span>: &#123;</span><br><span class="line">      <span class="attr">"VCCLCompilerTool"</span>: &#123; <span class="attr">"ExceptionHandling"</span>: <span class="number">1</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"include_dirs"</span>: [ <span class="string">"&lt;!@(node -p \"require('node-addon-api').include\")"</span> ],</span><br><span class="line">    <span class="attr">"dependencies"</span>: [ <span class="string">"&lt;!(node -p \"require('node-addon-api').gyp\")"</span> ]</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³äºæºç å±‚é¢ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦ä½œä»»ä½•ä¿®æ”¹ã€‚åœ¨ Node.js v6.x ä¸‹é¢è¯•è¯•çœ‹å§ã€‚åŒæ ·æ˜¯ä½¿ç”¨ <strong>node-gyp rebuild</strong> è¿›è¡Œç¼–è¯‘ã€‚ç„¶åé€šè¿‡ Node.js REPL è¿›å»æµ‹è¯•ã€‚</p><p>å…·ä½“çš„ç»ˆç«¯è¾“å‡ºè¿™é‡Œå°±ä¸æ”¾å‡ºæ¥äº†ï¼Œç›¸ä¿¡ç»è¿‡å®éªŒçš„å¤§å®¶éƒ½å¾—åˆ°äº†è‡ªå·±æƒ³è¦çš„ç»“æœã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ¬¡å†…å®¹ä¸»è¦è®²è§£äº†åœ¨ Node.js é¢†åŸŸä¸­åŸç”Ÿ C++ æ¨¡å—å¼€å‘çš„æ–¹å¼å˜è¿ã€‚</p><ul><li>ä» node-waf åˆ° node-gypï¼Œè¿™æ˜¯æ„å»ºå·¥å…·çš„ä¸€ä¸ªå˜è¿ï¼Œæœªæ¥è¯´ä¸å®šä¼šæ˜¯ GN æˆ–è€…å…¶å®ƒçš„æ„å»ºå·¥å…·ã€‚</li><li>ä»æš´åŠ›å†™ç ï¼Œåˆ° NAN çš„å‡ºç°ï¼Œè§è¯äº† Node.js ç¤¾åŒºçš„å„ç§çˆ±æ¨æƒ…ä»‡ï¼Œä¸€ç›´åˆ°ç°åœ¨çš„æ–°ç”Ÿå„¿ N-APIï¼Œä¸ºåŸç”Ÿ C++ æ¨¡å—çš„å¼€å‘è¾“é€äº†æ–°é²œçš„è¡€æ¶²ã€‚</li></ul><p>ç›®å‰çš„ä¸­åšåŠ›é‡ä»ç„¶æ˜¯ NAN çš„å¼€å‘æ–¹å¼ï¼Œç”šè‡³æˆ‘çŒœæµ‹æ˜¯å¦æœªæ¥æœ‰å¯èƒ½ NAN ä¼šæä¾›å…³äº N-API çš„å„ç§å®å°è£…ï¼Œä½¿å…¶å½»åº•æ¶ˆé™¤ç‰ˆæœ¬å·®å¼‚ï¼ŒåŒ…æ‹¬ ABI ç‰ˆæœ¬ä¸Šçš„å·®å¼‚ã€‚å½“ç„¶è¿™ç§ ABI ç‰ˆæœ¬å·®å¼‚å¯¼è‡´çš„éœ€è¦å¤šæ¬¡ç¼–è¯‘é—®é¢˜åº”è¯¥è¿˜æ˜¯å­˜åœ¨çš„ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ä¸€æ¬¡ç¼–ç çš„å·®å¼‚ã€‚</p><p>åœ¨å¤§å®¶è·Ÿç€æœ¬æ–‡å¯¹ N-API è¿›è¡Œäº†ä¸€æ¬¡æµ…å°è¾„æ­¢çš„å°è¯•ä¹‹åï¼Œå¸Œæœ›èƒ½å¯¹å½“ä¸‹ä»ç„¶å¤„äºå®éªŒçŠ¶æ€çš„ N-API å……æ»¡äº†å¸Œå†€ï¼Œå¹¶å¯¹ç°åœ¨å­˜åœ¨çš„å„ç§å‘å¤„ä»¥åŒ…å®¹çš„å¿ƒæ€ã€‚</p><p>æ¯•ç«Ÿï¼ŒNode.js loves you allã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li>ã€ŒConsider moving from gyp to gnã€ï¼š<a href="https://github.com/nodejs/node/issues/6089" target="_blank" rel="external">https://github.com/nodejs/node/issues/6089</a></li><li>ã€ŒGetting Started with Embedding Â· v8/v8 Wikiã€ï¼š<a href="https://github.com/v8/v8/wiki/Getting-Started-with-Embedding" target="_blank" rel="external">https://github.com/v8/v8/wiki/Getting-Started-with-Embedding</a></li><li>ã€ŒDrop support for v0.10 and v0.12?ã€ï¼š<a href="https://github.com/nodejs/nan/issues/676" target="_blank" rel="external">https://github.com/nodejs/nan/issues/676</a></li><li>ã€ŒNode Loves Rustã€ï¼š<a href="https://cnodejs.org/topic/593353775b07c1b24afa0638" target="_blank" rel="external">https://cnodejs.org/topic/593353775b07c1b24afa0638</a></li><li>ã€ŒN-API | Node.js v8.0.0 Documentationã€ï¼š<a href="https://nodejs.org/docs/v8.0.0/api/n-api.html" target="_blank" rel="external">https://nodejs.org/docs/v8.0.0/api/n-api.html</a></li><li>ã€Œdoc: fix out of date sections in n-api docã€ï¼š<a href="https://github.com/nodejs/node/pull/13508" target="_blank" rel="external">https://github.com/nodejs/node/pull/13508</a></li></ul><p>[^1]: ç”¨äºå®šä¹‰æŸç§æ–‡ä»¶ç±»å‹çš„ç‰¹æ®Šæ ‡è¯†ï¼Œè¯¦è§ <a href="https://en.wikipedia.org/wiki/Magic_number_(programming" target="_blank" rel="external">https://en.wikipedia.org/wiki/Magic_number_(programming</a>)<br>[^2]: ä»£ç å‚è§ <a href="https://github.com/nodejs/node/blob/v6.9.4/src/node.cc#L2427-L2502" target="_blank" rel="external">https://github.com/nodejs/node/blob/v6.9.4/src/node.cc#L2427-L2502</a><br>[^3]: å¹´ä¹…å¤±ä¿®ï¼Œå½“å‰ NPM ä¸Šæœç´¢åˆ°çš„ node-waf å·²ç»ä¸æ˜¯å½“å¹´çš„äº†ï¼Œä¸è¿‡è¿™ä¸ªæ˜¯ Waf çš„å®˜æ–¹ä»“åº“ <a href="https://github.com/waf-project/wafã€‚" target="_blank" rel="external">https://github.com/waf-project/wafã€‚</a><br>[^4]: å…¨ç§° Generate Your Projectsï¼Œæ˜¯è°·æ­Œå¼€å‘çš„ä¸€å¥—æ„å»ºç³»ç»Ÿï¼Œæœªå°½äº‹å®œè¯¦è¯¢ <a href="https://gyp.gsrc.ioã€‚" target="_blank" rel="external">https://gyp.gsrc.ioã€‚</a><br>[^5]: GYP çš„é…ç½®æ–‡ä»¶çš„åç¼€å°±æ˜¯ <em>.gyp æˆ–è€… </em>.gypi ç­‰ï¼Œæ˜¯ä¸ªç±» JSON æ–‡ä»¶ã€‚<br>[^6]: GN æ˜¯è°·æ­Œå¼€å‘çš„ç›¸è¾ƒäº GYP æ›´æ–°æ›´å¿«çš„ä¸€å¥—æ„å»ºå·¥å…·ï¼Œå¯ä»¥å‚è€ƒ <a href="https://chromium.googlesource.com/chromium/src/tools/gn/+/HEAD/docs/quick_start.md" target="_blank" rel="external">https://chromium.googlesource.com/chromium/src/tools/gn/+/HEAD/docs/quick_start.md</a><br>[^7]: è®©åƒåœ¾å›æ”¶æœºåˆ¶æ¥ç®¡ç† JavaScript å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ä¸€ç§ç±»ï¼Œå³ HandleScopeï¼Œåœ¨æˆ‘çš„æ–°ä¹¦ä¸­å°†ä¼šæœ‰è¯¦è§£ã€‚<br>[^8]: Node.js çš„å¼‚æ­¥äº‹ä»¶å¾ªç¯æ”¯æ’‘è€…ï¼Œè¯¦è¯¢ <a href="http://www.libuv.org/" target="_blank" rel="external">http://www.libuv.org/</a><br>[^9]: è¯¦æƒ…è¯·æŸ¥çœ‹ node-api è¿™ä¸ªåŒ…ï¼Œ<a href="https://github.com/nodejs/node-api" target="_blank" rel="external">https://github.com/nodejs/node-api</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ç”±æˆ‘é¦–å‘äº &lt;a href=&quot;http://gitbook.cn/books/5938f4ae8b55d47644b7a445/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitChat&lt;/a&gt; ä¸­ã€‚&lt;
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="NAPI" scheme="https://xcoder.in/tags/NAPI/"/>
    
  </entry>
  
  <entry>
    <title>Byakurenï¼šä¸€ä¸ª C å®ç°çš„ä¸»é¢˜è‰²æå–åº“</title>
    <link href="https://xcoder.in/2017/03/03/byakuren/"/>
    <id>https://xcoder.in/2017/03/03/byakuren/</id>
    <published>2017-03-03T10:14:35.000Z</published>
    <updated>2017-12-11T07:59:20.462Z</updated>
    
    <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡å‘æ–‡ç« äº†ï¼Œå€Ÿç€ Byakuren å¼€æºçš„æ¡£å£ç‚’ç‚’å†·é¥­å§ã€‚</p><p>å…ˆä¸Š Repo åœ°å€ï¼š<a href="https://github.com/XadillaX/byakuren" target="_blank" rel="external">https://github.com/XadillaX/byakuren</a>ã€‚</p><h2 id="ä¸»é¢˜è‰²"><a href="#ä¸»é¢˜è‰²" class="headerlink" title="ä¸»é¢˜è‰²"></a>ä¸»é¢˜è‰²</h2><p>å›¾åƒä¸»é¢˜è‰²æ˜¯ä»ä¸€å¼ å›¾åƒä¸­æå–å‡ºæ¥æœ€èƒ½ä»£è¡¨è¿™å¼ å›¾ç‰‡ä¸»è‰²è°ƒçš„å¤šç§é¢œè‰²ã€‚ ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€å¹…è‰²å½©æ–‘æ–“çš„å›¾ç‰‡é‡Œé¢ï¼Œå„ç§ä¸åŒé¢œè‰²çš„æ•°é‡å°±å¯¹åº”ç€è¯¥é¢œè‰²åœ¨å›¾ ç‰‡ä¸­çš„æ¯”ä¾‹ï¼Œç¨‹åºå¯ä»¥é€šè¿‡è®¡ç®—å›¾ç‰‡ä¸­ä¸åŒé¢œè‰²çš„åƒç´ æ•°æ¥ç®—å‡ºä¸»é¢˜è‰²ã€‚</p><h3 id="ä¸»é¢˜è‰²æå–ç®—æ³•"><a href="#ä¸»é¢˜è‰²æå–ç®—æ³•" class="headerlink" title="ä¸»é¢˜è‰²æå–ç®—æ³•"></a>ä¸»é¢˜è‰²æå–ç®—æ³•</h3><p>æå–çš„ç®—æ³•åœ¨æˆ‘ä¹‹å‰çš„åšå®¢ä¸­æœ‰è¯´æ˜ã€‚åœ¨ Byakuren ä¸­å…¶å®ç”¨çš„å°±æ˜¯ä¹‹å‰åšå®¢ä¸­è®²çš„ä¸€äº›ç®—æ³•ã€‚</p><ul><li><a href="https://xcoder.in/2014/09/17/theme-color-extract/#å…«å‰æ ‘æå–æ³•">å…«å‰æ ‘æå–æ³•</a></li><li><a href="https://xcoder.in/2014/09/17/theme-color-extract/#æœ€å°å·®å€¼æ³•">æœ€å°å·®å€¼æ³•</a></li></ul><p>é™¤å»ä¸Šé¢ä¸¤ç§ç®—æ³•ï¼ŒByakuren è¿˜æä¾›äº†å°†è¿™ä¸¤ç§ç®—æ³•ç»“åˆèµ·æ¥çš„ Mix ç®—æ³•ã€‚</p><h2 id="Byakuren"><a href="#Byakuren" class="headerlink" title="Byakuren"></a>Byakuren</h2><p>Byakuren æ˜¯æˆ‘å‰ä¸¤å¹´å†™çš„ä¸€ä¸ªä¸»é¢˜è‰²æå–åº“ï¼Œä¹Ÿæ˜¯ç»§ <a href="https://github.com/XadillaX/thmclrx/tree/e302b61b4cc70b24efa35c612899cc0b79d271f9" target="_blank" rel="external">thmclrx</a> ä¹‹åçš„ C ç‰ˆå®ç°ï¼Œä¸ªäººè®¤ä¸ºä»£ç è´¨é‡æ¯”æ—§ç‰ˆçš„ thmclrx è¦é«˜ã€‚å¹¶ä¸”å®ƒå®é™…ä¸Šç»è¿‡äº†ä¼ä¸šçº§çš„éªŒè¯ï¼Œåœ¨æŸç›¸å…³çš„å…¬å¸å·²ç»æ¬¢å¿«è·‘äº†æœ‰äº›å¹´å¤´äº†ã€‚</p><blockquote><p>åœ¨ç»è¿‡ç›¸å…³äººå‘˜çš„åŒæ„ä¸‹ï¼Œæˆ‘ä¹Ÿç®—æŠŠè¿™é›ªè—äº†å¥½ä¹…çš„ä»£ç ç»™å¼€æºå‡ºæ¥äº†ã€‚</p></blockquote><h3 id="ä¼ªÂ·Byakuren-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¼ªÂ·Byakuren-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¼ªÂ·Byakuren æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¼ªÂ·Byakuren æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><img src="byakuren.png" alt="byakuren"></p><blockquote><p>è– ç™½è“®ï¼ˆã²ã˜ã‚Š ã³ã‚ƒãã‚Œã‚“ï¼ŒHiziri Byakurenï¼‰æ˜¯ç³»åˆ—ä½œå“ã€Šä¸œæ–¹ projectã€‹ä¸­çš„è§’è‰²ï¼Œé¦–æ¬¡ç™»åœºäºã€Šä¸œæ–¹æ˜Ÿè²èˆ¹ã€‹ã€‚</p><ul><li>ç§æ—ï¼šé­”æ³•ä½¿</li><li>èƒ½åŠ›ï¼šä½¿ç”¨é­”æ³•ç¨‹åº¦çš„èƒ½åŠ›ï¼ˆé…£ç•…å¢å¼ºèº«ä½“èƒ½åŠ›çš„ï¼‰</li><li>å±é™©åº¦ï¼šä¸æ˜</li><li>äººç±»å‹å¥½åº¦ï¼šä¸­</li><li>ä¸»è¦æ´»åŠ¨åœºæ‰€ï¼šå‘½è²å¯ºä¹‹ç±»</li><li>å‘½è²å¯ºçš„ä½æŒã€‚è™½ç„¶åŸæœ¬æ˜¯äººç±»ï¼Œä¸è¿‡ç”±äºå¸¸å¹´çš„ä¿®è¡Œå·²ç»å®Œå…¨è¶…è¶Šäº†äººç±»ã€‚ç°åœ¨å·²ç»å±äºäººä»¬å¸¸è¯´çš„é­”æ³•ä½¿äº†ã€‚</li></ul><p>è™½ç„¶å·²ç»å…¥äº†ä½›é—¨ï¼Œä½†æ˜¯ä¸çŸ¥é“ä»€ä¹ˆåŸå› å´è¢«å¦–æ€ªæ•¬ä»°ç€ã€‚å¥¹ä»æ¥æ²¡æœ‰åƒç«¥è¯æ•…äº‹ä¸­çš„é­”æ³•ä½¿é‚£æ ·ï¼Œå¿µè¯µç€å’’è¯­æ²»é€€å¦–æ€ªã€‚ä½¿ç”¨çš„åŠ›é‡å®Œå…¨æ˜¯é‚ªæ¶çš„ï¼Œä¸€ç‚¹éƒ½ä¸åƒæ˜¯åœ£äººï¼Œè™½ç„¶å¹¶æ²¡æœ‰äººç›®å‡»åˆ°å¥¹ä¸äººç±»ä¸ºæ•Œï¼Œä½†å…¶å®å·²å½»åº•æˆä¸ºå¦–æ€ªçš„åŒä¼´äº†ã€‚</p></blockquote><p>å¥½å§ï¼Œæ€»ä¹‹æœ¬äººæ˜¯ä¸ªä¸œæ–¹æ§ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šé¡¹ç›®åéƒ½è·Ÿä¸œæ–¹æœ‰å…³ã€‚</p><h3 id="çœŸÂ·Byakuren-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#çœŸÂ·Byakuren-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="çœŸÂ·Byakuren æ˜¯ä»€ä¹ˆï¼Ÿ"></a>çœŸÂ·Byakuren æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å¦‚æ–‡ç« é¢˜ç›®æ‰€è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ª C å®ç°çš„å¼€æºä¸»é¢˜è‰²æå–çš„åº“ï¼Œå¤§å®¶å¯ä»¥æŠŠå®ƒç¼–è¯‘æˆé“¾æ¥åº“ä½¿ç”¨ã€‚</p><p>ä¸è¿‡ç›®å‰æš‚æ—¶åªæ”¯æŒ Makefile çš„å½¢å¼æ¥ç¼–è¯‘ï¼Œå¤§å®¶å¦‚æœæœ‰å…´è¶£ä¹Ÿå¯ä»¥è‡ªå·±å»ºä¸ª Windows ä¸‹çš„ Visual Studio é¡¹ç›®ç­‰ï¼Œä¹Ÿæ¬¢è¿æç±»ä¼¼äº CMake ä¹‹ç±»çš„ PRã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>å…¶å®è¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•åœ¨<a href="https://github.com/XadillaX/byakuren#byakuren" target="_blank" rel="external">æ–‡æ¡£</a>ä¸­å°±æœ‰è¯´æ˜ã€‚</p><p>ä¸è¿‡è¿™é‡Œè¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹å§ã€‚</p><h4 id="Clone"><a href="#Clone" class="headerlink" title="Clone"></a>Clone</h4><p>å…ˆæŠŠä»£ç ç»™ä¸‹ä¸‹æ¥ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒ Clone ä¸‹æ¥ã€‚æ€»ä¹‹ä»“åº“åœ°å€æ˜¯ï¼š<a href="https://github.com/XadillaX/byakuren" target="_blank" rel="external">https://github.com/XadillaX/byakuren</a>ã€‚</p><h4 id="make"><a href="#make" class="headerlink" title="make"></a>make</h4><p>ç„¶åè·‘åˆ°ç›®å½•ä¸‹æ‰§è¡Œ <code>make</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ make byakuren</span><br></pre></td></tr></table></figure><p>ä½ å°†å¾—åˆ°ä¸€ä¸ª <code>byakuren.a</code> çš„é™æ€é“¾æ¥åº“ã€‚</p><p>è¿™ä¸ªæ—¶å€™ä½ åªè¦æ‹¿ç€è¿™ä¸ªé™æ€é“¾æ¥åº“ï¼Œç„¶åé¡ºä¾¿åœ¨ä½ çš„é¡¹ç›®ä¸­æŠŠå¤´æ–‡ä»¶å¼•è¿›æ¥å°±å¯ä»¥äº†ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"byakuren.h"</span></span></span><br></pre></td></tr></table></figure><h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><p>æˆ‘ä»¬å‡è®¾ä½ æœ‰ <code>bkr_rgb* rgb</code> çš„å›¾ç‰‡åƒç´ ä¿¡æ¯ï¼Œä»¥åŠ <code>uint32_t color_count</code> çš„å›¾ç‰‡åƒç´ æ€»æ•°ä¸¤ä¸ªå˜é‡ï¼Œä¸‹é¢åˆ†åˆ«ç»™å‡ºä¸‰ä¸ªæ ·ä¾‹ã€‚å…·ä½“çš„ API è§£æè¿˜è¯·å»æ–‡æ¡£è§‚æ‘©ã€‚</p><h5 id="Octree"><a href="#Octree" class="headerlink" title="Octree"></a>Octree</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">bkr_color_stats stats[<span class="number">256</span>];</span><br><span class="line">bkr_octree_node* root = bkr_build_octree(rgb, color_count, <span class="number">256</span>);</span><br><span class="line"><span class="keyword">int</span> colors = bkr_octree_calculate_color_stats(root, stats);</span><br><span class="line">bkr_release_octree(root);</span><br></pre></td></tr></table></figure><blockquote><p><code>colors</code> å°±æ˜¯ä¸»é¢˜è‰²æ•°é‡äº†ï¼Œä¼ è¿›å»çš„ <code>stats</code> å°±ä¼šæ¥æ”¶åˆ°ä¸»é¢˜è‰²çš„å…·ä½“ä¿¡æ¯äº†ã€‚</p></blockquote><h5 id="Min-diff"><a href="#Min-diff" class="headerlink" title="Min-diff"></a>Min-diff</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">bkr_color_stats stats[<span class="number">256</span>];</span><br><span class="line">bkr_mindiff_parameter param;</span><br><span class="line">param.gray_offset = <span class="number">5</span>;</span><br><span class="line">param.palette = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">int</span> colors = bkr_mindiff_calculate_color_stats(rgb, color_count, stats, &amp;param);</span><br></pre></td></tr></table></figure><blockquote><p><code>colors</code> å’Œ <code>stats</code> å¦‚ä¸Šæ‰€è¿°ã€‚</p></blockquote><h5 id="Mix"><a href="#Mix" class="headerlink" title="Mix"></a>Mix</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">bkr_color_stats stats[<span class="number">256</span>];</span><br><span class="line">bkr_mindiff_parameter param;</span><br><span class="line">param.gray_offset = <span class="number">-1</span>;</span><br><span class="line">param.palette = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">int</span> colors = bkr_mix_calculate_color_stats(rgb, color_count, <span class="number">256</span>, &amp;param, stats);</span><br></pre></td></tr></table></figure><blockquote><p><code>colors</code> å’Œ <code>stats</code> å¦‚ä¸Šæ‰€è¿°ã€‚</p></blockquote><h3 id="é¢„è§ˆä¸€ä¸‹"><a href="#é¢„è§ˆä¸€ä¸‹" class="headerlink" title="é¢„è§ˆä¸€ä¸‹"></a>é¢„è§ˆä¸€ä¸‹</h3><p>å¯èƒ½æœ‰äººæƒ³çœ‹çœ‹æ•ˆæœï¼Œæˆ‘è¿™é‡Œå°±æ”¾ä¸ªæ•ˆæœå›¾ç»™å¤§å®¶çœ‹çœ‹å§ã€‚</p><p>å…¶ä¸­ Octree å’Œ Mix ä¸¤ä¸ªç®—æ³•çš„ä¸»é¢˜è‰²æœ€å¤§æ•°é‡å‚æ•°ä¼ çš„éƒ½æ˜¯ 16ã€‚</p><p><img src="result.png" alt="æ•ˆæœé¢„è§ˆ"></p><h3 id="èƒ½åšä»€ä¹ˆï¼Ÿ"><a href="#èƒ½åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="èƒ½åšä»€ä¹ˆï¼Ÿ"></a>èƒ½åšä»€ä¹ˆï¼Ÿ</h3><p>ä½ å¯ä»¥æ‹¿å®ƒæ¥å†™ä¸€äº›ä¸»é¢˜è‰²æå–çš„ä¸œè¥¿ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥æ‹¿å®ƒæ¥å®Œæˆå…¶å®ƒè¯­è¨€çš„ä¸»é¢˜è‰²æå–åº“çš„å°è£…ï¼Œå¦‚ Pythonã€Lua ç­‰ç­‰ã€‚æ¬¢è¿åé¦ˆç»™æˆ‘ã€‚</p><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>æŠŠä¸€ä»½è‡ªå·±è§‰å¾—è¿˜ä¸é”™çš„ä»£ç å¼€æºå‡ºæ¥çš„æ„Ÿè§‰ç‰¹çˆ½ï¼Œå°¤å…¶æ˜¯è¿™ç§é‡è§å¤©æ—¥çš„æ„Ÿè§‰ã€‚ï¾|ï½¥âˆ€ï½¥|ï¾‰*~â—</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¥½ä¹…æ²¡å‘æ–‡ç« äº†ï¼Œå€Ÿç€ Byakuren å¼€æºçš„æ¡£å£ç‚’ç‚’å†·é¥­å§ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆä¸Š Repo åœ°å€ï¼š&lt;a href=&quot;https://github.com/XadillaX/byakuren&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://g
      
    
    </summary>
    
    
      <category term="C" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="ä¸»é¢˜è‰²" scheme="https://xcoder.in/tags/%E4%B8%BB%E9%A2%98%E8%89%B2/"/>
    
  </entry>
  
  <entry>
    <title>æ­»æœˆçš„äºŒé›¶ä¸€å…­æ€»ç»“</title>
    <link href="https://xcoder.in/2016/12/31/my-2016/"/>
    <id>https://xcoder.in/2016/12/31/my-2016/</id>
    <published>2016-12-31T07:43:08.000Z</published>
    <updated>2017-12-11T07:59:20.521Z</updated>
    
    <content type="html"><![CDATA[<p>çœ‹äº†é‚£ä¹ˆå¤šæ€»ç»“ï¼Œè‡ªå·±ä¹Ÿæ€»ç»“ä¸€å›å§ï¼Œå›é¡¾ä¸€ä¸‹è¿™ä¸ªå³å°†è¿‡å»çš„äºŒé›¶ä¸€å…­ã€‚</p><h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><h3 id="è¶³è¿¹"><a href="#è¶³è¿¹" class="headerlink" title="è¶³è¿¹"></a>è¶³è¿¹</h3><ul><li>åƒå²›æ¹–</li><li>ä¸Šæµ·è¿ªå£«å°¼</li><li>è‰¯æ¸šæ–‡åŒ–æ‘</li><li>å—äº¬</li><li>æ¹–å·</li><li>é»„å±±</li></ul><h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><ul><li>æ‹¿è€çˆ¸çš„è½¦ç»ƒæ‰‹ï¼Œå¹¶ä¹ å¾—ä¸€å®šçš„å®æˆ˜é©¾è½¦ç»éªŒï¼›</li><li>ä¹°äº†ä¸ªæˆ¿ï¼Œæ¬ ä¸‹ä¸€ç¬”å·¨æ¬¾ï¼Œå¹¶å¼€å§‹åƒåœ¡ï¼›</li><li>ç©äº†ä¸€æ®µæ—¶é—´çš„å®ˆæœ›å±è‚¡ï¼›</li><li>è¢«å…¥æ‰‹ä¸€ä¸ªå®šç„¦äººåƒå¤´ï¼›</li><li>å°è¯•äº†å‡ æ¬¡ç§Ÿè½¦ Appï¼Œä¹Ÿç®—å°è¯•è¿‡äº†åŠ›å¸†ç”µåŠ¨è½¦å’Œåˆ«å…‹ï¼›</li><li>æ‹¿äº†ä¸ªæœ¬å­ï¼›</li><li>è¢«å…¥æ‰‹ PS4ï¼›</li><li>å‡è‚¥å¤±è´¥ï¼›</li><li>è¢«æˆ‘å¦ˆå½±å“ï¼Œä¸€æ®µæ—¶é—´æ²‰è¿·å”±æ­Œï¼Œåœ¨æŸ K æ­Œ App ä¸Šæœ‰å¥½å¤šéš¾å¬çš„ä½œå“ï¼›</li><li>ä¸€æ®µæ—¶é—´æ²‰è¿·ä¹Œå…‹ä¸½ä¸½ï¼Œåæ¥ä¸äº†äº†ä¹‹ï¼›</li><li>ä¸€æ®µæ—¶é—´æ²‰è¿·é…éŸ³ï¼Œåœ¨æŸ App ä¸Šä¹Ÿæœ‰éš¾å¬çš„ä½œå“ï¼›</li><li>å‘¨æœ«åŸºæœ¬ä¸Šå°±æ˜¯<strong><em>å‡ºå»åƒé¥­ + çœ‹ç”µè§†</em></strong>ï¼Œå•è°ƒè€Œé‡å¤ï¼›</li><li>å¤±å»äº†ä»¥å‰è¿½ç•ªçš„çƒ­æƒ…ï¼Œå†™æ–‡ç« ä¹Ÿå°‘äº†ä»¥å‰å–èŒçš„åŠ¨åŠ›â€”â€”æœç„¶è€äº†ä¹ˆã€‚</li></ul><h2 id="å·¥ä½œ-amp-æŠ€æœ¯"><a href="#å·¥ä½œ-amp-æŠ€æœ¯" class="headerlink" title="å·¥ä½œ &amp; æŠ€æœ¯"></a>å·¥ä½œ &amp; æŠ€æœ¯</h2><p>ä» 2015 å¹´ 9 æœˆå…¥èŒç°ä¸œå®¶å¤§æœè½¦å·²ç»ä¸€å¹´å¤šäº†ï¼Œç»å†äº†å…¬å¸ C è½®äº¿çº§åˆ€çš„èèµ„å’Œæ–°äº§å“çš„å‘å¸ƒï¼Œåœ¨ä»Šå¹´ä¹Ÿæœ‰å‡ ä»¶ä»¤è‡ªå·±æ¯”è¾ƒè‡ªè±ªå’ŒæŒ«è´¥çš„äº‹ã€‚</p><h3 id="å‰åç«¯åˆ†ç¦»"><a href="#å‰åç«¯åˆ†ç¦»" class="headerlink" title="å‰åç«¯åˆ†ç¦»"></a>å‰åç«¯åˆ†ç¦»</h3><p>è¿™ä¸€å—æ˜¯åœ¨å¹´åº•å€Ÿç€å…¬å¸æ–°äº§å“ã€Œ<a href="https://tangeche.com" target="_blank" rel="external">å¼¹ä¸ªè½¦</a>ã€çš„ä¸œé£æ‰å¼€å§‹çœŸæ­£è½åœ°å¼€æ¥ã€‚å…¶å®è¿™ä¸€å—å·²ç»è½åå¤§å‚å¥½å¤šä¸ªå¹´ä»£äº†â€”â€”2014 å¹´æ·˜å®çš„ä¸­é€”å²›æ–¹æ¡ˆä»¥åŠ 2015 å¹´æ­»é©¬åˆ†äº«çš„å¤©çŒ« Wormhole æ–¹æ¡ˆã€‚</p><p>ä¸€æ˜¯å› ä¸ºåœ¨æœªåˆ†ç¦»çš„é˜¶æ®µæˆ‘ä»¬å…¬å¸å‰ç«¯è¿˜æ˜¯ä»¥ä¼ ç»Ÿçš„ <strong>Java</strong> æ–¹å¼å¼€å‘ï¼ŒäºŒæ˜¯åœ¨åˆ†ç¦»çš„é˜¶æ®µç›´æ¥ä¸Šäº† <strong>Vue</strong> ç­‰æ¡†æ¶ï¼Œæ‰€ä»¥ç›´æ¥å°±è·³è¿‡é‚£ä¸€æ­¥äº†ã€‚</p><p>ä½†æ˜¯å…¶å®å¾ˆå¤šæƒ…å†µä¸‹éƒ½æ˜¯ <strong>Vue</strong> åŠ›æ‰€ä¸èƒ½åŠçš„â€”â€”æ¯”å¦‚æ—¢è¦è€ƒè™‘åˆ°é¦–å±å°±æ¸²æŸ“å¥½çš„å±•ç¤ºé¡µä½†æ˜¯åˆä¸æƒ³ç»§ç»­åœ¨ä¼ ç»Ÿ Web å¼€å‘çš„é˜´å½±ä¸‹è¿›è¡Œå·¥ä½œçš„æ—¶å€™ã€‚æˆ‘ç›¸ä¿¡å°±ç®—åœ¨é˜¿é‡Œä¹Ÿæ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜çš„â€”â€”<strong><em>è®©å‰ç«¯æ›´ä¸“æ³¨å‰ç«¯ï¼Œè®©åç«¯æ›´ä¸“æ³¨åç«¯ï¼Œè®©æµè§ˆå™¨å¾—åˆ°çš„è¿˜æ˜¯ä¼ ç»Ÿçš„ç»“æœã€‚</em></strong></p><p>é¡¹ç›®åœ¨å†…éƒ¨å”¤ä½œ <a href="http://finalfantasy.wikia.com/wiki/Oerba_Dia_Vanille" target="_blank" rel="external"><strong>Vanille</strong></a>ï¼Œç¬¬ä¸€ä¸ªä¸Šçº¿ç‰ˆæœ¬èŠ±äº†ä¸¤å‘¨çš„æ—¶é—´ï¼Œç›®å‰å·²æ­£å¸¸æœå½¹äºç¬¬ä¸€ä¸ªé¡¹ç›®ã€Œå¼¹ä¸ªè½¦ã€ã€‚è¿™ç®—æ˜¯æˆ‘ä»Šå¹´åœ¨å…¬å¸åšçš„æœ€è‡ªè±ªçš„ä¸€ä»¶äº‹ä¹‹ä¸€äº†ï¼Œ<strong><em>ç»ˆäºæ¨åŠ¨äº†ä¸€æ¬¡å†…éƒ¨æŠ€æœ¯çš„å‘å±•ã€‚</em></strong></p><h3 id="å¤§æœè½¦å•†å­¦é™¢"><a href="#å¤§æœè½¦å•†å­¦é™¢" class="headerlink" title="å¤§æœè½¦å•†å­¦é™¢"></a>å¤§æœè½¦å•†å­¦é™¢</h3><p>ä»å»å¹´ä»¥é¡¹ç›®ç»ç†çš„èº«ä»½æ¥äº†è¿™ä¸ªé¡¹ç›®ï¼Œç»å†äº†ä»æ— åˆ°æœ‰åˆ°ä¸‰ä¸ç®¡å†åˆ°ç°åœ¨çš„å¹³ç¨³çŠ¶æ€ã€‚ä»Šå¹´å¹´åˆçš„æ—¶å€™è¯¥é¡¹ç›®ç»å†äº†ä¸€æ®µæ—¶é—´ç ”å‘ï¼Œæˆä¸ºäº†å…¬å¸å†…ç¬¬ä¸€ä¸ªæ¥å…¥å†…éƒ¨æ”¯ä»˜å¹³å°çš„é¡¹ç›®ï¼Œåªä¸è¿‡åæ¥è¿è¥çš„å¤´å„¿èµ°äº†å O2O çš„æ”¯ä»˜åŠŸèƒ½ä¸€ç›´è¢«é›ªè—äº†â€”â€”ä¸€è‚¡æŒ«è´¥æ„Ÿæ²¹ç„¶è€Œç”Ÿã€‚</p><p>åˆ°äº†å¿«å¹´åº•çš„æ—¶å€™ç»ˆäºæ¥äº†ä¸€æ³¢å°éœ€æ±‚ï¼Œæ¥å…¥äº†å†…éƒ¨çš„æœç´¢å¼•æ“å’ŒåŠ äº†ä¸€æ³¢å°éœ€æ±‚ã€‚ä¸è¿‡è¿™æ®µæ—¶é—´åœ¨å¿™åˆ«çš„äº‹æƒ…ï¼Œä¸»è¦çš„å¼€å‘ä»»åŠ¡äº¤ç»™äº†åŒäº‹å¼€å‘ï¼Œè€Œæˆ‘å°±åšä¸€äº› Code Review å’Œéƒ¨ç½²çš„å·¥ä½œã€‚</p><p>æœŸé—´ä¹Ÿæƒ³æŠŠå•†å­¦é™¢ç»™å‡æ ¼æˆä¸€ä¸ªå…¬å¸å†…éƒ¨ç»Ÿä¸€çš„ CMSï¼Œåæ¥å› ä¸ºä¸€ç›´æ²¡æœ‰è½åœ°å®æ–½å’Œä¸€ç›´è¢«è°ƒé£åšå…¶å®ƒçš„ä»»åŠ¡ï¼Œæ‰€ä»¥åˆ°åé¢ä¸äº†äº†ä¹‹äº†â€”â€”é‚£æ®µæ—¶é—´å…¬å¸çš„ Noder ç€å®ä¸å¤Ÿç”¨ã€‚</p><p><strong><em>ä¸€å¼€å§‹ä¸è¦æŠŠæ‰€æœ‰äº‹æƒ…éƒ½æƒ³å¾—é¢é¢ä¿±åˆ°ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯æµªè´¹ä½ çš„ç²¾åŠ›å’Œæ„Ÿæƒ…ï¼Œåœ¨è¿­ä»£é€Ÿåº¦éå¸¸å¿«çš„äº’è”ç½‘æ—¶ä»£ï¼Œå¿«é€Ÿå‡ºäº§å“æ‰æ˜¯æœ€é‡è¦çš„äº‹ã€‚è¿˜è¦ç»ƒå°±å¼ºå¤§çš„å†…å¿ƒæ¥æ‹¥æŠ±å„ç§å˜åŒ–ã€‚</em></strong></p><h3 id="è½¦ç‰›"><a href="#è½¦ç‰›" class="headerlink" title="è½¦ç‰›"></a>è½¦ç‰›</h3><p>è¿™æ˜¯ä»Šå¹´åšçš„ä¸€äº›ä¸šåŠ¡ç›¸å…³çš„äº‹ï¼ŒæŒ‘é‡è¦çš„æ€»ç»“ä¸€ä¸‹æ„Ÿæƒ³ã€‚</p><p>åšå¾—æœ€ä¹…çš„å°±æ˜¯ä¸¤å¤§æœŸçš„è®¢é˜…ç›¸å…³çš„éœ€æ±‚äº†ï¼Œå…¶å®æœ‰ç‚¹åƒèŠ±ç“£ç½‘çš„ç€‘å¸ƒæµå…³æ³¨ï¼Œç¨åŠ æ”¹é€ å³å¯ã€‚ä¸è¿‡ç”±äºåšäº†æ¥ç›˜ä¾ ï¼Œæ¥æ‰‹ä»£ç çš„æ—¶å€™çœ‹åˆ°çš„æ˜¯ä¸€å¨æ¯”è¾ƒæ™¦æ¶©çš„è¯¡å¼‚å®ç°æ–¹æ³•ï¼Œç»å†äº†ä¸‰æœŸçš„å…¨ç›˜å¤åˆ»åŠ Promise æ›¿æ¢ï¼Œå››æœŸä»å¤´å¼€å§‹å†å®ç°ï¼Œè¿˜æ˜¯æ²¡èƒ½å°†å…¶è¿ç§»æˆæˆ‘å¿ƒç›®ä¸­çš„é‚£ä¸€å¥—æ–¹æ³•â€”â€”<strong><em>æŠ€æœ¯å€ºçš„è¿˜å€ºæˆæœ¬æ€»æ˜¯å¤§çš„ï¼Œä»¥åŠåœ¨çº¿ä¸Šè·‘äº†é‚£ä¹ˆä¹…çš„ä»£ç è‡³å°‘æ˜¯ç¨³å®šçš„ï¼Œå®ç°æ–¹æ¡ˆçš„æ”¹é€ çš„å¼€å‘æˆæœ¬è¿œå¤§äºä»£ç å±‚é¢é‡æ„çš„å¼€å‘æˆæœ¬ã€‚</em></strong>ç»¼ä¸Šæ‰€è¿°ï¼Œé™¤äº†å¾—å‡ºä¸è¦è½»æ˜“é‡æ„æ—§ä»£ç çš„ç»“è®ºï¼Œè¿˜å¾—å‡ºäº†<strong><em>ã€Œå®å¯ä¸€å¼€å§‹èŠ±æ›´å¤šçš„æ—¶é—´å’Œè®¾è®¡å»æå®šä¸€å¥—ä¸œè¥¿ï¼Œä¹Ÿä¸è¦åœ¨ä»£ç ç¨³å®šçº¿ä¸Šè·‘äº†å¥½ä¹…ä¹‹åå†é‡æ„å®ƒçš„å®ç°æ–¹å¼â€”â€”å“ªæ€•æ—§çš„æ–¹å¼æ˜¯ä¸€å¨å±ã€çš„ç»“è®ºã€‚</em></strong></p><h3 id="å¼€æº"><a href="#å¼€æº" class="headerlink" title="å¼€æº"></a>å¼€æº</h3><h4 id="Toshihiko"><a href="#Toshihiko" class="headerlink" title="Toshihiko"></a>Toshihiko</h4><p>ä»Šå¹´å¯¹ Toshihiko ä¸»è¦åªæ˜¯ä¿®ä¿®è¡¥è¡¥ã€‚ä½†æ˜¯åœ¨ Node Party ç¬¬ä¸€æ¬¡ Speak ä¹‹åï¼Œä¸‹å®šå†³å¿ƒé‡æ„äº†ä¸€æ¬¡ Toshihiko çš„ä»£ç å¹¶ä¸”ä½¿å…¶ç†è®ºä¸Šæ”¯æŒäº†å¤šé€‚é…å™¨å±‚ã€‚</p><blockquote><p><a href="https://github.com/XadillaX/Toshihiko" target="_blank" rel="external">Repo åœ°å€</a></p></blockquote><h4 id="Aliyun-ONS"><a href="#Aliyun-ONS" class="headerlink" title="Aliyun ONS"></a>Aliyun ONS</h4><p>è¿™ä¸ªé¡¹ç›®æºè‡ªäºå»å¹´æˆ‘ä»¬ Node.js å›¢é˜Ÿè¦æ¥å…¶ä»–å›¢é˜Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œä»–ä»¬ä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„ ONSã€‚ä»–ä»¬æ²¡æœ‰ Node.js çš„ SDKï¼Œæˆ‘ä»¬åªèƒ½è‡ªç»™è‡ªè¶³ã€‚</p><p>ä¸€å¼€å§‹ç”¨äº†ä¸€ä¸ªæ¯”è¾ƒè„çš„åŠæ³•ï¼Œä½¿ç”¨ä»–ä»¬çš„ PHP SDK ç„¶ååœ¨é¡¹ç›®ä¸­å¯åŠ¨å­è¿›ç¨‹ä¸ä¸»è¿›ç¨‹è¿›è¡Œé€šè®¯ï¼Œé€»è¾‘æ”¾åœ¨ä¸»è¿›ç¨‹å¤„ç†ï¼Œè€Œæ”¶å‘æ¶ˆæ¯çš„ä»»åŠ¡åˆ™äº¤ç»™ PHPã€‚</p><p>åæ¥æˆ‘æ¯›äº†ï¼Œäºæ˜¯è‡ªç»™è‡ªè¶³ï¼ŒåŸºäºä»–ä»¬çš„ C++ SDK è‡ªå·±å°è£…äº†ä¸€ä¸ª Node.js ç‰ˆæœ¬çš„ SDKã€‚ç»è¿‡äº†å‡ ä¸ªå¤§ç‰ˆæœ¬çš„è¿­ä»£å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œç›®å‰è¯¥ SDK å·²ç»ç¨³ç¨³å½“å½“æœå½¹äºå¤§æœè½¦åŠå¹´å¤šäº†ï¼Œä¸€ç›´å¾ˆç¨³å®šã€‚</p><p>è™½ç„¶é˜¿é‡Œäº‘ä¸€ç›´è¯´åœ¨å‡º Node.js çš„ SDKï¼Œä½†æ˜¯è¿Ÿè¿Ÿæœªè§äº§å‡ºï¼Œæˆ‘å§‘ä¸”ä¹Ÿè‡ªè±ªä¸€ç•ªå§ã€‚</p><blockquote><p><a href="https://github.com/XadillaX/aliyun-ons" target="_blank" rel="external">Repo åœ°å€</a></p></blockquote><h4 id="Hua"><a href="#Hua" class="headerlink" title="Hua"></a>Hua</h4><p>è¿™ä¸ªé¡¹ç›®æ˜¯ä¸ºäº†å½“æ—¶å³å°†å»ã€Œè˜‘è‡é¸¡ã€çš„å°é¾™ç«¥é‹å†™çš„ï¼Œè™½ç„¶ä»–ç”±äºèº«ä½“åŸå› æœ€åæ²¡å»æˆã€‚</p><p>ä¸»è¦ç”¨æ³•å°±æ˜¯èƒ½æ ¹æ®ä½ çš„ä¸€äº›è®¾å®šï¼ˆæ¯”å¦‚é‡‘æœ¨æ°´ç«åœŸï¼‰ç„¶åéšæœºä¸€å †èŠ±åï¼Œä¾›ä½ åœ¨é˜¿é‡Œç­‰å‚ç”¨â€”â€”é¢å‘å„ç§èµ·åå›°éš¾æˆ·ã€‚</p><blockquote><p><a href="https://github.com/BoogeeDoo/hua" target="_blank" rel="external">Repo åœ°å€</a></p></blockquote><h3 id="å…¶å®ƒ-1"><a href="#å…¶å®ƒ-1" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><ul><li>å†’ç€å†²æ’å¤´å“¥çš„é£é™©ï¼Œä¸åŒå…¶çƒ¦åœ¨å›¢é˜Ÿæ¨è¡Œè§„èŒƒåŒ–ï¼ˆGit å’Œ Eslint ç­‰ï¼‰ï¼Œç»ˆäºå‡ºäº†ä¸€äº›æˆæ•ˆï¼›</li><li>å» <a href="http://2016.jsconf.cn/" target="_blank" rel="external">NingJS</a> è½¬äº†ä¸€åœˆï¼›</li><li>æ¨è¡Œå¹¶ç»´æŠ¤äº†å…¬å¸å†…éƒ¨çš„ NPM ä»“åº“ï¼›</li><li>è·Ÿç€å¤´å“¥ä¸¾åŠäº†å‡ æ¬¡ <a href="https://github.com/hangzhou-node-party" target="_blank" rel="external">Node Party</a>ï¼Œå¹¶è´¡çŒ®äº†ä¸€ä¸ª Topicâ€”â€”ã€Œ<a href="http://htmljs.b0.upaiyun.com/uploads/1470619563805-083e5543293c4da9f6c1d489d6010e60.pdf" target="_blank" rel="external">About Node.js ORM</a>ã€ï¼›</li><li>å‘¨æœ«æ— èŠå†™äº†ç‚¹å°å¤–å¿«ï¼Œå¹¶ Get äº†ä¸€äº›æ–°æŠ€èƒ½ï¼Œå¦‚ GIF æ ¼å¼è§£æã€Chrome æ’ä»¶å¼€å‘ç­‰ï¼›</li><li>ç»™åšå®¢å†™äº†ä¸ªæ–°çš®ï¼›</li><li>å†…æ¨äº†å‡ ä¸ªæ–°åŒäº‹ï¼Œè™½ç„¶ä¸€ä¸ªæœ€åæ²¡ç®—åˆ°æˆ‘å¤´ä¸Šï¼›</li><li>å°± Vuex / MySQL /ã€Œcallback ä¸ Promise ä¸ yieldã€ç­‰æ’•äº†å¥½å¤šåœºæ— æ„ä¹‰çš„é€¼ï¼›</li><li>å¤šæ¬¡é‡å¯å¹¶å¼ƒå‘æ–°ç‰ˆ NOJ çš„å¼€å‘ï¼Œæœ€ç»ˆéƒ½æ— æœã€‚</li></ul><p>é™¤äº†ä¸Šè¿°çš„ä¸€äº›äº‹æƒ…å¤–ï¼Œè¿˜æ”¶è·äº†æœ€é‡è¦çš„ä¸€ç‚¹â€”â€”<strong><em>ä¸å†åƒä»¥å‰ä¸€æ ·åªæ— è„‘å…³å¿ƒæŠ€æœ¯æœ¬èº«ï¼Œè€Œæ˜¯æ›´å¤šåœ°å»æ€è€ƒæŠ€æœ¯ä¹‹å¤–çš„äº‹ï¼Œå¯¹å¾…æ—§çš„ä»£ç æ›´å®½å®¹äº†ã€‚</em></strong></p><p>ä¸è¿‡çº¯æŠ€æœ¯æ–¹é¢æ¥è¯´ï¼Œæ„Ÿè§‰è¿˜æ˜¯åˆ°è¾¾ä¸€å®šç“¶é¢ˆäº†ã€‚</p><h2 id="å±•æœ›äºŒã€‡ä¸€ä¸ƒ"><a href="#å±•æœ›äºŒã€‡ä¸€ä¸ƒ" class="headerlink" title="å±•æœ›äºŒã€‡ä¸€ä¸ƒ"></a>å±•æœ›äºŒã€‡ä¸€ä¸ƒ</h2><p>æœ€ååˆ—å‡ºä¸€äº›æ˜å¹´æƒ³åšçš„äº‹æƒ…ã€‚</p><ol><li>è‡³å°‘å‡ºå¢ƒæ¸¸ç©ä¸€æ¬¡ï¼›</li><li>æ”¹å˜å‘¨æœ«çš„ä¹ æƒ¯ï¼Œå¯¹ç”Ÿæ´»æ›´ç§¯æä¸€äº›ï¼›</li><li>ä¹°è½¦ï¼ˆæ„Ÿè§‰è¿™ç‚¹å¯ä»¥æ”¹å˜ä¸Šç‚¹ï¼‰ï¼›</li><li>æƒ³å†™ä¸€æœ¬ä¹¦ï¼Œå¹¶ä»˜è¯¸å®è·µï¼›</li><li>é€šå…³æ›´å¤šçš„æ¸¸æˆï¼›</li><li>å†è¿˜ä¸€éƒ¨åˆ†é¦–ä»˜ï¼›</li><li>è‹¦ç»ƒæ‘„å½±æŠ€æœ¯ï¼›</li><li>èµšæ›´å¤šé’±ï¼Œä¸è¦åƒç°åœ¨ä¸€æ ·èŠ±å¾—æ†‹å±ˆï¼›</li></ol><p><img src="flandre.jpeg" alt="èŠ™å…°"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;çœ‹äº†é‚£ä¹ˆå¤šæ€»ç»“ï¼Œè‡ªå·±ä¹Ÿæ€»ç»“ä¸€å›å§ï¼Œå›é¡¾ä¸€ä¸‹è¿™ä¸ªå³å°†è¿‡å»çš„äºŒé›¶ä¸€å…­ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç”Ÿæ´»&quot;&gt;&lt;a href=&quot;#ç”Ÿæ´»&quot; class=&quot;headerlink&quot; title=&quot;ç”Ÿæ´»&quot;&gt;&lt;/a&gt;ç”Ÿæ´»&lt;/h2&gt;&lt;h3 id=&quot;è¶³è¿¹&quot;&gt;&lt;a href=&quot;#è¶³è¿¹&quot; class=
      
    
    </summary>
    
    
      <category term="æ€»ç»“" scheme="https://xcoder.in/tags/%E6%80%BB%E7%BB%93/"/>
    
      <category term="2016" scheme="https://xcoder.in/tags/2016/"/>
    
  </entry>
  
  <entry>
    <title>è·Ÿæˆ‘ä¸€èµ·éƒ¨ç½²å’Œå®šåˆ¶ CNPMâ€”â€”è‡ªå®šä¹‰åŒ…å­˜å‚¨å±‚</title>
    <link href="https://xcoder.in/2016/07/22/lets-cnpm-storage/"/>
    <id>https://xcoder.in/2016/07/22/lets-cnpm-storage/</id>
    <published>2016-07-22T06:23:01.000Z</published>
    <updated>2017-12-11T07:59:20.519Z</updated>
    
    <content type="html"><![CDATA[<p>CNPM çš„è‡ªå®šä¹‰åŒ…å­˜å‚¨å±‚æ–‡ä»¶ç³»ç»Ÿç®€ç§° NFSï¼Œæˆ‘çŒœæ˜¯ NPM File System çš„æ„æ€ã€‚</p><p>åœ¨ä¹‹å‰ã€Š<a href="https://xcoder.in/2016/07/09/lets-cnpm-base-deploy/">è·Ÿæˆ‘ä¸€èµ·éƒ¨ç½²å’Œå®šåˆ¶ CNPMâ€”â€”åŸºç¡€éƒ¨ç½²</a>ã€‹ä¸­æåˆ°è¿‡ï¼ŒCNPM é…ç½®é¡¹é‡Œé¢æœ‰ä¸€é¡¹é…ç½® <code>nfs</code>ï¼Œå®ƒæ‰€å¯¹åº”çš„æ˜¯ä¸€ä¸ª NFS å¯¹è±¡ã€‚</p><p>åœ¨åŒæ­¥ package çš„æ—¶å€™ï¼ŒCNPM ä¼šæŠŠæºç«™çš„åŒ…ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åä¼ ç»™ NFS å¯¹è±¡ç›¸åº”çš„å‡½æ•°äº¤äºˆå»å¤„ç†ï¼Œç”± NFS å¯¹è±¡è¿”å›å¤„ç†ç»“æŸä¹‹åè¯¥åŒ…åœ¨æˆ‘ä»¬è‡ªå·±éƒ¨ç½²çš„ CNPM å¯¹åº”çš„åŒ…ä¸‹è½½é“¾æ¥ã€‚</p><p>ä¸Šé¢çš„è¿™ä¸€å¥—æµç¨‹å°±ç»™æˆ‘ä»¬è‡ªå®šä¹‰åŒ…å­˜å‚¨æä¾›äº†å¯èƒ½ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥æŠŠåŒ…åŒæ­¥åˆ°åˆæ‹äº‘å­˜å‚¨ã€é˜¿é‡Œäº‘ OSS ç­‰åœ°æ–¹å»ï¼Œä¹Ÿå¯ä»¥ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜å…¥æˆ‘ä»¬è‡ªå·±çš„æ•°æ®åº“ï¼ˆä¸æ¨èï¼‰ï¼Œç”šè‡³å¯ä»¥ä»€ä¹ˆéƒ½ä¸ç”¨åšç›´æ¥æ”¾åœ¨æœ¬åœ°ï¼Œç„¶åæŠŠæœ¬åœ°æ–‡ä»¶å¯¹å¤–ç½‘æš´éœ²å³å¯ã€‚</p><h2 id="NFS-æ¥å£"><a href="#NFS-æ¥å£" class="headerlink" title="NFS æ¥å£"></a>NFS æ¥å£</h2><p>NFS çš„æ¥å£æ˜¯å®ç°å®šä¹‰å¥½çš„ï¼Œæˆ‘ä»¬å¦‚æœè¦å†™ä¸€ä¸ªè‡ªå·±çš„ NFS ç±»ï¼Œåªéœ€è¦æŒ‰ç…§çº¦å®šçš„æ¥å£å®ç°ä»–ä»¬çš„é€»è¾‘å³å¯ã€‚</p><blockquote><p>è™½ç„¶æˆ‘è‡ªå·±ä¸å–œæ¬¢ï¼Œä½†æ˜¯ NFS çš„æ‰€æœ‰å‡½æ•°éœ€è¦åœ¨èŠèŠ±å‡½æ•°ä¸­è¢«å®ç°ã€‚</p></blockquote><p>ä¸‹é¢ç»™å‡ºæ¥å£çš„å®šä¹‰ï¼š</p><ul><li><code>function* upload(filepath, options)</code><ul><li><code>filepath</code>ï¼šæ–‡ä»¶è·¯å¾„ã€‚</li><li><code>options</code><ul><li><code>key</code>ï¼šå¾…ä¸Šä¼ æ–‡ä»¶çš„æ ‡è¯†</li><li><code>size</code>ï¼šå¾…ä¸Šä¼ æ–‡ä»¶å¤§å°</li></ul></li></ul></li><li><code>function* uploadBuffer(fileBuffer, options)</code><ul><li><code>fileBuffer</code>ï¼šå¾…ä¸Šä¼ æ–‡ä»¶çš„ Buffer</li><li><code>options</code><ul><li><code>key</code>ï¼šå¾…ä¸Šä¼ æ–‡ä»¶çš„æ ‡è¯†</li><li><code>size</code>ï¼šå¾…ä¸Šä¼ æ–‡ä»¶çš„å¤§å°</li></ul></li></ul></li><li><code>function* remove(key)</code><ul><li><code>key</code>: æ–‡ä»¶æ ‡è¯†</li></ul></li><li><code>function* download(key, savePath, options)</code>ï¼ˆå¯é€‰å®ç°ï¼‰<ul><li><code>key</code>ï¼šæ–‡ä»¶æ ‡è¯†</li><li><code>savePath</code>ï¼šä¿å­˜è·¯å¾„</li><li><code>options</code><ul><li><code>timeout</code>ï¼šè¶…æ—¶æ—¶é—´</li></ul></li></ul></li><li><code>function* createDownloadStream(key, options)</code>ï¼ˆå¯é€‰å®ç°ï¼‰<ul><li><code>key</code>: æ–‡ä»¶æ ‡è¯†</li><li><code>options</code><ul><li><code>timeout</code>ï¼šè¶…æ—¶æ—¶é—´</li></ul></li><li>è¿”å›ä¸€ä¸ª <code>ReadStream</code></li></ul></li><li><code>function[*] url(key)</code>ï¼ˆå¯é€‰å®ç°ï¼Œå¯ä»¥ä¸æ˜¯èŠèŠ±å‡½æ•°ï¼‰<ul><li><code>key</code>: æ–‡ä»¶æ ‡è¯†</li></ul></li></ul><h2 id="OSS-CNPM-è§£æ"><a href="#OSS-CNPM-è§£æ" class="headerlink" title="OSS-CNPM è§£æ"></a>OSS-CNPM è§£æ</h2><p>è¿™é‡Œæ‹¿å‡ºä¸€ä¸ª NFS çš„å®˜æ–¹å®ç°é˜¿é‡Œäº‘ OSS ç‰ˆæ¥ä½œä¸ºè§£æã€‚å®ƒçš„ Repo æ˜¯ <a href="https://github.com/cnpm/oss-cnpm" target="_blank" rel="external">https://github.com/cnpm/oss-cnpm</a>ã€‚</p><p>æ‰“å¼€ <a href="https://github.com/cnpm/oss-cnpm/tree/2.1.0/index.js" target="_blank" rel="external">index.js</a> æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œçš„ç¡® <code>OssWrapper</code> å®ç°äº†ä¸Šé¢çš„ä¸€äº›æ¥å£ã€‚</p><h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><p>åœ¨ <code>function OssWrapper</code> é‡Œé¢æˆ‘ä»¬çœ‹åˆ°å®ƒ <code>new</code> äº† <a href="https://github.com/aliyun/oss-nodejs-sdk" target="_blank" rel="external">ali-oss</a> å¯¹è±¡ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (options.cluster) &#123;</span><br><span class="line">  options.schedule = options.schedule || <span class="string">'masterSlave'</span>;</span><br><span class="line">  <span class="keyword">this</span>.client = <span class="keyword">new</span> oss.ClusterClient(options);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.client = oss(options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´åœ¨å„ç§ä¸Šä¼ ç­‰å‡½æ•°é‡Œé¢éƒ½æ˜¯ä»¥è¿™ä¸ª <code>client</code> ä¸ºä¸»ä½“åšçš„äº‹æƒ…çš„ã€‚</p><h3 id="upload-å’Œ-uploadBuffer"><a href="#upload-å’Œ-uploadBuffer" class="headerlink" title="upload å’Œ uploadBuffer"></a>upload å’Œ uploadBuffer</h3><p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹ <code>upload</code> å‡½æ•°ï¼Œä»å¤–éƒ¨ä¼ è¿›æ¥æ–‡ä»¶çš„ <code>key</code>ï¼ŒNFS å¯¹è±¡å°†è¯¥æ–‡ä»¶ä»¥ <code>key</code> ä¸ºåä¼ åˆ° OSS å»ï¼Œå¹¶è¿”å›è¯¥æ–‡ä»¶ä¸Šä¼ ä¹‹ååœ¨ OSS ä¸Šçš„åœ°å€ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">proto.upload = <span class="function"><span class="keyword">function</span>* (<span class="params">filePath, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = trimKey(options.key);</span><br><span class="line">  <span class="comment">// https://github.com/ali-sdk/ali-oss#putname-file-options</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span> <span class="keyword">this</span>.client.put(key, filePath, &#123;</span><br><span class="line">    <span class="attr">headers</span>: <span class="keyword">this</span>._defaultHeaders,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>._mode === <span class="string">'public'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">url</span>: result.url &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">key</span>: key &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>uploadBuffer</code> å…¶å®ä¹Ÿä¸€æ ·ï¼Œå‚æ•°ç¬¬ä¸€ä¸ª <code>fileBuffer</code> æ˜¯ä¸€ä¸ªæ–‡ä»¶äºŒè¿›åˆ¶ Buffer å¯¹è±¡ï¼Œè€Œ <code>ali-oss</code> åŒ…çš„ <code>put</code> å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°æ—¢å¯ä»¥ä¼ ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¼ ä¸€ä¸ª Bufferï¼Œæ‰€ä»¥ç›¸å½“äºæŠŠ <code>upload</code> è¿™ä¸ªå‡½æ•°ç›´æ¥æ‹¿è¿‡æ¥å°±èƒ½ç”¨äº†ï¼Œäºæ˜¯å°±æœ‰äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">proto.uploadBuffer = proto.upload;</span><br></pre></td></tr></table></figure><h3 id="removeã€download-å’Œ-createDownloadStream"><a href="#removeã€download-å’Œ-createDownloadStream" class="headerlink" title="removeã€download å’Œ createDownloadStream"></a>removeã€download å’Œ createDownloadStream</h3><p>è¿™ä¸¤ä¸ªå‡½æ•°å®é™…ä¸Šä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨äº† <code>ali-oss</code> çš„å‡½æ•°ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¥½è®²çš„ï¼Œå¤§å®¶è‡ªå·±çœ‹çœ‹å°±å¥½äº†ã€‚</p><h3 id="url"><a href="#url" class="headerlink" title="url"></a>url</h3><p>è¿™ä¸ªå‡½æ•°æ— éå°±æ˜¯åˆ¤æ–­ä¸‹æœ‰æ²¡æœ‰è‡ªå®šä¹‰çš„ CDN åŸŸåä»€ä¹ˆçš„ï¼Œæ ¹æ®ä¸åŒçš„è¿”å›ä¸åŒçš„ç½‘å€è€Œå·²ã€‚</p><h3 id="trimKey"><a href="#trimKey" class="headerlink" title="trimKey"></a>trimKey</h3><p>æŠŠ <code>key</code> é‡Œé¢å¸¦çš„æœ€å‰é¢çš„æ–œæ å»æ‰ã€‚</p><h2 id="æˆ‘çš„-OSS-CNPM-éšæ„æ”¹é€ "><a href="#æˆ‘çš„-OSS-CNPM-éšæ„æ”¹é€ " class="headerlink" title="æˆ‘çš„ OSS-CNPM éšæ„æ”¹é€ "></a>æˆ‘çš„ OSS-CNPM éšæ„æ”¹é€ </h2><p>ä¸Šé¢ä¸€èŠ‚è§£æäº† <code>oss-cnpm</code> è¿™ä¸ªåŒ…çš„ä»£ç ï¼Œå¦‚æœå®˜æ–¹å‡ºçš„å‡ ä¸ª NFS åŒ…ä¸èƒ½æ»¡è¶³ï¼Œå¤§å®¶ä¹Ÿèƒ½è‡ªå·±å»å†™ä¸€ä¸ª CNPM å­˜å‚¨å±‚çš„åŒ…äº†ã€‚</p><p>æˆ‘ä»¬å…¬å¸çš„åŒ…æ˜¯ç›´æ¥åœ¨ OSS ä¸Šé¢çš„ï¼Œæ‰€ä»¥ç”¨ <code>oss-cnpm</code> å¹¶æ²¡æœ‰ä»€ä¹ˆä¸å¦¥ã€‚</p><p>ä¸è¿‡å¯¹äºé˜¿é‡Œç³»æœ¬èº«çš„å…¬å¸é—¨æ¥è¯´ï¼ŒOSS å¹¶ä¸æ˜¯ä»€ä¹ˆå¤§äº‹å„¿ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼ŒOSS çš„ bucket èµ„æºè¿˜æ˜¯è›®ç¨€ç¼ºçš„ï¼Œä¸Šæ¬¡å°±è¾¾åˆ°ä¸Šé™äº†ã€‚æ‰€ä»¥æˆ‘ä»¬ç›®å‰çš„ NPM åŒ…è·Ÿå…¬å¸åˆ«çš„æµ‹è¯•ä¸šåŠ¡ç”¨çš„æ˜¯åŒä¸€ä¸ª bucketã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p><p><strong><code>oss-cnpm</code> ç›´æ¥æŠŠæ‰€æœ‰æ–‡ä»¶æ”¾åœ¨æ ¹ç›®å½•ä¸‹å»ºæ–‡ä»¶å¤¹ï¼Œå¤ªä¹±äº†ï¼Œè€Œä¸”çš„ç¡®æ˜¯æœ‰å°å¯èƒ½å†²çªçš„ã€‚è€Œè¿™ä¸ªåŒ…åˆä¸èƒ½è®©äººè‡ªå®šä¹‰å‰ç¼€ä»€ä¹ˆä»€ä¹ˆçš„ã€‚</strong></p><p>äºæ˜¯æˆ‘å°±è‡ªå·± Fork å°å°æ”¹è£…äº†ä¸€ä¸‹è¿™ä¸ªåŒ…ï¼Œè®©å®ƒé€‚åˆæˆ‘ä»¬å…¬å¸è‡ªå·±ã€‚</p><p>æ”¹è£…å¾ˆç®€å•ï¼Œåœ¨ä¸Šä¼ çš„ç›®å½•ä¸­åŠ ä¸€ä¸ªæ–‡ä»¶å¤¹å‰ç¼€ã€‚</p><p>åŠ¨çš„æ˜¯ <code>trimKey</code> å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trimKey</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'_snpm_/'</span> + (key ? key.replace(<span class="regexp">/^\//</span>, <span class="string">''</span>) : <span class="string">''</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸‹æ‰€æœ‰åœ¨æˆ‘ä»¬å†…éƒ¨ CNPM é‡Œé¢çš„åŒ…çš„é“¾æ¥éƒ½å¤šäº†ä¸ª <code>_snpm_/</code> çš„å‰ç¼€äº†ã€‚</p><h2 id="CNPM-è°ƒç”¨è§£æ"><a href="#CNPM-è°ƒç”¨è§£æ" class="headerlink" title="CNPM è°ƒç”¨è§£æ"></a>CNPM è°ƒç”¨è§£æ</h2><p>ä¸Šé¢è§£æäº†æ¥å£ä¹‹åï¼Œæˆ‘ä»¬æ¥æ‰’ä¸€æ‰’ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨ä¸Šé¢å®ç°çš„æ¥å£ä»¬å§ï¼Œè¿™æ ·å°±çŸ¥é“ CNPM å¯¹äº NFS ä½¿ç”¨çš„å·¥ä½œåŸç†äº†ã€‚</p><h3 id="controllers-registry-package-download-js"><a href="#controllers-registry-package-download-js" class="headerlink" title="controllers/registry/package/download.js"></a>controllers/registry/package/download.js</h3><blockquote><p><a href="https://github.com/cnpm/cnpmjs.org/blob/2.12.2/controllers/registry/package/download.js" target="_blank" rel="external">æºç å‚è€ƒ</a></p></blockquote><p>å¯¹äºåŒ…ä¸‹è½½æ¥è¯´ï¼Œå®ƒçš„è·¯ç”±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/&#123;package&#125;/download/&#123;package&#125;-&#123;version&#125;.tgz</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é‡Œé¢åˆ¤æ–­ä¸€ä¸‹å¦‚æœ NFS å¯¹è±¡æœ‰å®ç° <code>url()</code> å‡½æ•°çš„è¯ï¼Œå…ˆç”¨ <code>url()</code> å‡½æ•°ç”Ÿæˆå¯¹è¯¥åŒ…è€Œè¨€çš„çœŸå®ä¸‹è½½é“¾æ¥ã€‚</p><p>è¯»å‡ºè¿™ä¸ªåŒ…çš„ registry ä¿¡æ¯ï¼Œé‡Œé¢å¦‚æœæ²¡æœ‰ <code>dist</code> ç­‰å‚æ•°çš„è¯ç›´æ¥ 302 åˆ°åˆšç”Ÿæˆçš„åœ°å€å»ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> nfs.url === <span class="string">'function'</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (is.generatorFunction(nfs.url)) &#123;</span><br><span class="line">    url = <span class="keyword">yield</span> nfs.url(common.getCDNKey(name, filename));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    url = nfs.url(common.getCDNKey(name, filename));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!row || !row.package || !row.package.dist) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!url) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">yield</span>* next;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.status = <span class="number">302</span>;</span><br><span class="line">  <span class="keyword">this</span>.set(<span class="string">'Location'</span>, url);</span><br><span class="line">  _downloads[name] = (_downloads[name] || <span class="number">0</span>) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹å»æ˜¯æ¶‰åŠåˆ°ä¸Šä¸€ç« æ²¡æœ‰æåˆ°è¿‡çš„ä¸€ä¸ªé…ç½®å‚æ•°ï¼Œå« <code>downloadRedirectToNFS</code>ï¼Œé»˜è®¤ä¸º <code>false</code>ã€‚å¦‚æœè¯¥å€¼ä¸º <code>true</code> çš„è¯å¹¶ä¸”åˆšæ‰ç”± <code>url()</code> å‡½æ•°ç”Ÿæˆäº†ä¸‹è½½é“¾æ¥çš„è¯ï¼Œä¹Ÿæ˜¯ç›´æ¥ 302 åˆ°çœŸå®ä¸‹è½½é“¾æ¥å»ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (config.downloadRedirectToNFS &amp;&amp; url) &#123;</span><br><span class="line">  <span class="keyword">this</span>.status = <span class="number">302</span>;</span><br><span class="line">  <span class="keyword">this</span>.set(<span class="string">'Location'</span>, url);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡å¦‚æœæœ¬èº« registry é‡Œé¢å°±æ²¡ <code>key</code> è¿™ä¸ªé€‰é¡¹çš„è¯ä¹Ÿä¼šç›´æ¥ç”¨ <code>url()</code> ç”Ÿæˆçš„é“¾æ¥ç»™è·³è¿‡å»ã€‚å¦‚æœæ²¡æœ‰ <code>url()</code> çš„é“¾æ¥ï¼Œé‚£ä¹ˆç›´æ¥ç”¨ registry é‡Œé¢çš„ <code>tarball</code> å­—æ®µã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> dist = row.package.dist;</span><br><span class="line"><span class="keyword">if</span> (!dist.key) &#123;</span><br><span class="line">  url = url || dist.tarball;</span><br><span class="line">  <span class="keyword">this</span>.status = <span class="number">302</span>;</span><br><span class="line">  <span class="keyword">this</span>.set(<span class="string">'Location'</span>, url);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å¦‚æœéƒ½è·³è¿‡å»äº†ï¼Œé‚£ä¹ˆè¯´æ˜è¦å¼€å§‹è°ƒç”¨äº‹å…ˆå†™å¥½çš„ <code>download</code> é‚£ä¸¤ä¸ªå‡½æ•°äº†ï¼ŒæŠŠæ–‡ä»¶è¯»åˆ° Buffer é‡Œé¢ï¼Œç„¶åæŠŠ Buffer æ”¾åˆ° Response é‡Œé¢ä¼ å›å»ã€‚</p><h3 id="controllers-registry-package-remove-js"><a href="#controllers-registry-package-remove-js" class="headerlink" title="controllers/registry/package/remove.js"></a>controllers/registry/package/remove.js</h3><blockquote><p><a href="https://github.com/cnpm/cnpmjs.org/blob/2.12.2/controllers/registry/package/remove.js" target="_blank" rel="external">æºç å‚è€ƒ</a></p></blockquote><p>å¯¹äºåˆ é™¤åŒ…æ¥è¯´ï¼Œé™¤äº†æŠŠåŒ…ä»æ•°æ®åº“åˆ æ‰ä¹‹å¤–ï¼Œè¿˜è¦å¾ªç¯éå†ä¸€éè¿™ä¸ªåŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ï¼ŒæŠŠæ‰€æœ‰ç‰ˆæœ¬çš„è¿™ä¸ªåŒ…éƒ½ä» NFS é‡Œé¢åˆ é™¤ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">yield</span> keys.map(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nfs.remove(key);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  logger.error(err);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±è°ƒç”¨äº†ä½ äº‹å…ˆå†™å¥½çš„ <code>remove</code> äº†ã€‚å½“ç„¶ä½ ä¸å®ç°ä¹Ÿæ²¡å…³ç³»ï¼Œæœ€å¤šæ˜¯åŒ…çš„å‹ç¼©æ–‡ä»¶ä¸åˆ é™¤è€Œå·²ã€‚</p><h3 id="controllers-registry-package-remove-version-js"><a href="#controllers-registry-package-remove-version-js" class="headerlink" title="controllers/registry/package/remove_version.js"></a>controllers/registry/package/remove_version.js</h3><blockquote><p><a href="https://github.com/cnpm/cnpmjs.org/blob/2.12.2/controllers/registry/package/remove_version.js" target="_blank" rel="external">æºç å‚è€ƒ</a></p></blockquote><p>è¿™é‡Œè·Ÿä¸Šä¸€å°èŠ‚å·®ä¸å¤šï¼Œä¹‹å‰æ˜¯åˆ é™¤æ•´ä¸ªåŒ…ï¼Œè¿™é‡Œæ˜¯åˆ é™¤åŒ…çš„æŸä¸€ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥å°±ä¸ç”¨å¾ªç¯åˆ é™¤äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">yield</span> nfs.remove(key);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  logger.error(err);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="controllers-registry-package-save-js"><a href="#controllers-registry-package-save-js" class="headerlink" title="controllers/registry/package/save.js"></a>controllers/registry/package/save.js</h3><blockquote><p><a href="https://github.com/cnpm/cnpmjs.org/blob/2.12.2/controllers/registry/package/save.js" target="_blank" rel="external">æºç å‚è€ƒ</a></p></blockquote><p>ç„¶åå°±æ˜¯ç”¨æˆ· <code>$ npm publish</code> ç”¨çš„è·¯ç”±äº†ï¼Œåœ¨ä¸€å †åˆ¤æ–­ä¹‹åï¼Œå‘å¸ƒä¼ è¿‡æ¥çš„åŒ…è¢«æ”¾åœ¨äºŒè¿›åˆ¶ Buffer å†…å­˜é‡Œé¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> tarballBuffer;</span><br><span class="line">tarballBuffer = <span class="keyword">new</span> Buffer(attachment.data, <span class="string">'base64'</span>);</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹å»åˆåˆ¤æ–­æ¥åˆ¤æ–­å»ï¼Œæœ€åäº¤ç”± NFS çš„ <code>uploadBuffer</code> æ¥ä¸Šä¼ å¹¶å¾—åˆ°ç»“æœã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> uploadResult = <span class="keyword">yield</span> nfs.uploadBuffer(tarballBuffer, options);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dist = &#123;</span><br><span class="line">  <span class="attr">shasum</span>: shasum,</span><br><span class="line">  <span class="attr">size</span>: attachment.length</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (uploadResult.url) &#123;</span><br><span class="line">  dist.tarball = uploadResult.url;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (uploadResult.key) &#123;</span><br><span class="line">  dist.key = uploadResult.key;</span><br><span class="line">  dist.tarball = uploadResult.key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æ²¡æœ‰ï¼Œå°±æ˜¯è¿™é‡Œè®°å½•çš„å®ƒåˆ°åº•æ˜¯ <code>key</code> è¿˜æ˜¯ <code>tarball</code> äº†ã€‚</p><p>å¦‚æœä½ çš„ <code>upload</code> å‡½æ•°è¿”å›çš„æ˜¯ <code>{ url: &#39;FOO&#39; }</code>ï¼Œé‚£ä¹ˆå°±æ˜¯ <code>tarball</code> è®¾ç½®æˆè¯¥å€¼ï¼Œåœ¨ä¸‹è½½çš„æ—¶å€™ä¼šç›´æ¥ 302 åˆ° <code>tarball</code> æ‰€æŒ‡çš„åœ°å€å»ï¼›å¦‚æœè¿”å›çš„æ˜¯ <code>{ key: &#39;key&#39; }</code> çš„è¯ï¼Œä¼šåœ¨ <code>dist</code> é‡Œé¢å­˜ä¸ª <code>key</code>ï¼Œä¸‹è½½çš„æ—¶å€™åˆ¤æ–­å¦‚æœæœ‰ <code>key</code> çš„è¯ä¼šæŠŠå®ƒä¼ è¿›ä½ çš„ <code>createDownloadStream</code> æˆ–è€… <code>download</code> å‡½æ•°å»äº¤ç”±ä½ çš„å‡½æ•°ç”ŸæˆåŒ… Buffer å¹¶ä¼ å› Responseã€‚</p><h3 id="controller-sync-module-worker-js"><a href="#controller-sync-module-worker-js" class="headerlink" title="controller/sync_module_worker.js"></a>controller/sync_module_worker.js</h3><blockquote><p><a href="https://github.com/cnpm/cnpmjs.org/blob/2.12.2/controllers/sync_module_worker.js" target="_blank" rel="external">æºç å‚è€ƒ</a></p></blockquote><p>è¿™ä¸ªæ–‡ä»¶æ˜¯ä»æºç«¯åŒæ­¥ç›¸å…³çš„ä¸€äº›é€»è¾‘äº†ï¼Œè¿™é‡Œé¢æœ‰ä¸¤ä¸ªæ“ä½œã€‚</p><p>ä¸€ä¸ªæ˜¯ <code>unpublish</code>ï¼Œè°ƒç”¨çš„å°±æ˜¯ NFS çš„ <code>remove</code>ï¼Œä¸ä½œè¯¦è°ˆäº†ã€‚</p><p>å¦ä¸€ä¸ªå°±æ˜¯åŒæ­¥äº†ã€‚åŒæ­¥åŒ…ä¼šè¢«æ‰“æ•£æˆåŒæ­¥ä¸€ä¸ªç‰ˆæœ¬ï¼Œç„¶åæŠŠæ¯ä¸ªç‰ˆæœ¬åŒæ­¥è¿‡æ¥ã€‚åœ¨åŒæ­¥ç‰ˆæœ¬çš„æ—¶å€™å…ˆæŠŠåŒ…æ–‡ä»¶<a href="https://github.com/cnpm/cnpmjs.org/blob/2.12.2/controllers/sync_module_worker.js#L940" target="_blank" rel="external">ä¸‹è½½</a>åˆ°æœ¬åœ°æ–‡ä»¶ <code>filepath</code> é‡Œé¢å»ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> r = <span class="keyword">yield</span> urllib.request(downurl, options);</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/node-modules/urllib" target="_blank" rel="external">urllib</a> æ˜¯è‹åƒæ­»é©¬ä»–ä»¬è‡ªå·±å†™çš„æ¯”è¾ƒæ–¹ä¾¿å’Œé€‚åˆä»–ä»¬è‡ªå·±çš„ä¸€ä¸ª http è¯·æ±‚åº“ã€‚</p></blockquote><p>ä¸Šé¢çš„ä»£ç  <code>options</code> é‡Œé¢æœ‰ä¸€ä¸ªæ–‡ä»¶æµï¼Œé“¾æ¥åˆ° <code>filepath</code> ç›®å½•çš„è¿™ä¸ªæ–‡ä»¶å»ï¼Œç›¸å½“äºè¿™ä¸€æ­¥å°±æ˜¯æŠŠæºç«¯çš„åŒ…ä¸‹è½½åˆ°æœ¬åœ° <code>filepath</code> å»äº†ã€‚</p><p>ç»è¿‡ä¸€å † blahblah çš„åˆ¤æ–­ï¼ˆæ¯”å¦‚ SHASUMï¼‰ä¹‹åï¼Œè¿™ä¸ªè¿™ä¸ªå‡½æ•°å°±ä¼š<a href="https://github.com/cnpm/cnpmjs.org/blob/2.12.2/controllers/sync_module_worker.js#L995" target="_blank" rel="external">è°ƒç”¨ NFS çš„ <code>upload</code> å‡½æ•°</a>å°†æœ¬åœ°æ–‡ä»¶åå¯¹åº”çš„æ–‡ä»¶ä¸Šä¼ åˆ°ä½ æ‰€éœ€è¦çš„åœ°æ–¹å»äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  result = <span class="keyword">yield</span> nfs.upload(filepath, options);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  logger.syncInfo(<span class="string">'[sync_module_worker] upload %j to nfs error: %s'</span>, err);</span><br><span class="line">  <span class="keyword">throw</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ç»“æœåˆ°åº•æ˜¯ <code>key</code> è¿˜æ˜¯ <code>url</code> å¯¹äºä¸‹è½½çš„å½±å“è·Ÿå‰ä¸€å°èŠ‚ä¸€ä¸ªé“ç†ã€‚</p></blockquote><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬ç« è®²äº†å¦‚ä½•ä½¿ç”¨å’Œè‡ªå·±å®šåˆ¶ä¸€ä¸ª CNPM çš„ NFS å±‚ï¼Œè®©åŒ…çš„èµ°å‘è·Ÿç€ä½ çš„å¿ƒèµ°ã€‚åœ¨æè¿°äº†å¼€å‘è§„èŒƒå’Œå‡ºç¤ºäº†æ ·ä¾‹ä»£ç å’Œæ”¹é€ å°ä¾‹å­ä¹‹åï¼Œåˆè§£æäº†è¿™ä¸ª NFS æ˜¯å¦‚ä½•åœ¨ CNPM é‡Œé¢å·¥ä½œçš„ï¼Œä¸Šé¢å·²ç»æåˆ°äº† 2.12.2 ç‰ˆæœ¬ä¸­æ‰€æœ‰ç”¨åˆ° NFS çš„åœ°æ–¹ã€‚</p><p>çœ‹äº†ä¸Šé¢çš„è§£æä¹‹åä¼šå¯¹ NFS çš„å·¥ä½œæµç¨‹æœ‰æ›´æ·±ä¸€å±‚çš„äº†è§£ï¼Œç„¶åå°±ä¸ä¼šæœ‰å†™ NFS å±‚çš„æ—¶å€™æœ‰ç§å¿ƒæ…Œæ…Œæ‘¸ä¸ç€åº•çš„æƒ…å†µäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CNPM çš„è‡ªå®šä¹‰åŒ…å­˜å‚¨å±‚æ–‡ä»¶ç³»ç»Ÿç®€ç§° NFSï¼Œæˆ‘çŒœæ˜¯ NPM File System çš„æ„æ€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¹‹å‰ã€Š&lt;a href=&quot;https://xcoder.in/2016/07/09/lets-cnpm-base-deploy/&quot;&gt;è·Ÿæˆ‘ä¸€èµ·éƒ¨ç½²å’Œå®šåˆ¶ CNPMâ€”
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="CNPM" scheme="https://xcoder.in/tags/CNPM/"/>
    
  </entry>
  
  <entry>
    <title>è·Ÿæˆ‘ä¸€èµ·éƒ¨ç½²å’Œå®šåˆ¶ CNPMâ€”â€”åŸºç¡€éƒ¨ç½²</title>
    <link href="https://xcoder.in/2016/07/09/lets-cnpm-base-deploy/"/>
    <id>https://xcoder.in/2016/07/09/lets-cnpm-base-deploy/</id>
    <published>2016-07-09T11:19:22.000Z</published>
    <updated>2017-12-11T07:59:20.518Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç« ä¼šä»‹ç» CNPM çš„åŸºç¡€éƒ¨ç½²æ–¹æ³•ã€‚</p><blockquote><p>è¯¥æ–‡ç« æ‰€å¯¹åº”çš„ cnpm ç›®æ ‡ç‰ˆæœ¬ä¸º <a href="https://github.com/cnpm/cnpmjs.org/tree/2.12.2" target="_blank" rel="external">v2.12.2</a>ï¼Œä¸Šä¸‹æµ®åŠ¨ä¸€äº›å…¼å®¹çš„ç‰ˆæœ¬é—®é¢˜ä¹Ÿéƒ½ä¸æ˜¯ç‰¹åˆ«å¤§ã€‚</p></blockquote><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>æƒ³è¦éƒ¨ç½² CNPMï¼Œä½ éœ€è¦åšä»¥ä¸‹çš„ä¸€äº›å‡†å¤‡ã€‚</p><ol><li>éƒ¨ç½²çš„å®¿ä½“ï¼Œå¦‚æœåŠ¡å™¨ã€äº‘ä¸»æœºã€è‡ªå·±çš„ç”µè„‘ç­‰ï¼›</li><li>æ•°æ®åº“ï¼Œæ”¯æŒ MySQLã€PostgreSQLã€MariaDBï¼Œå¦‚æœä½¿ç”¨ SQLite åˆ™æ— éœ€å‡†å¤‡ï¼›</li><li>Git å®¢æˆ·ç«¯ï¼ˆæ¨èï¼‰ã€‚</li></ol><h2 id="å¼€å§‹éƒ¨ç½²"><a href="#å¼€å§‹éƒ¨ç½²" class="headerlink" title="å¼€å§‹éƒ¨ç½²"></a>å¼€å§‹éƒ¨ç½²</h2><h3 id="å…‹éš†-CNPM"><a href="#å…‹éš†-CNPM" class="headerlink" title="å…‹éš† CNPM"></a>å…‹éš† CNPM</h3><p>é¦–å…ˆåœ¨æœ¬åœ°é€‰æ‹©ä¸€ä¸ªç›®å½•ï¼Œæ¯”å¦‚æˆ‘å°†å®ƒé€‰æ‹©åœ¨ <code>/usr/app</code>ï¼Œç„¶åé¢„æƒ³ CNPM çš„ç›®å½•ä¸º <code>/usr/app/cnpm</code>ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ç»ˆç«¯ <code>$ cd /usr/app</code>ã€‚</p><p>æ¥ä¸‹å»æ‰§è¡Œ Git æŒ‡ä»¤å°† CNPM å…‹éš†åˆ°ç›¸åº”ç›®å½•ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/cnpm/cnpmjs.org.git</span><br></pre></td></tr></table></figure><h4 id="Windows-ç”¨æˆ·"><a href="#Windows-ç”¨æˆ·" class="headerlink" title="Windows ç”¨æˆ·"></a>Windows ç”¨æˆ·</h4><p>Windows ç”¨æˆ·ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼ <a href="https://www.cygwin.com/" target="_blank" rel="external">Cygwin</a>ã€<a href="http://www.mingw.org/" target="_blank" rel="external">MinGW</a>ã€<a href="https://msdn.microsoft.com/en-us/powershell" target="_blank" rel="external">Powershell</a> ç”šè‡³ç›´æ¥æ˜¯ Command ç­‰æ¥è¿è¡Œ <a href="https://git-scm.com/download/win" target="_blank" rel="external">Git</a>ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ä¸€äº› GUI å·¥å…·æ¥å…‹éš†ï¼Œå¦‚ <a href="https://www.sourcetreeapp.com/" target="_blank" rel="external">SourceTree</a>ã€‚</p><h4 id="é-Git-ç”¨æˆ·"><a href="#é-Git-ç”¨æˆ·" class="headerlink" title="é Git ç”¨æˆ·"></a>é Git ç”¨æˆ·</h4><p>è·‘åˆ° CNPM çš„ Release é¡µé¢ï¼Œé€‰æ‹©ç›¸åº”çš„ç‰ˆæœ¬ä¸‹è½½ï¼Œæ¯”å¦‚è¿™é‡Œä¼šé€‰æ‹© <a href="https://github.com/cnpm/cnpmjs.org/releases/tag/2.12.2" target="_blank" rel="external">v2.12.2</a> ç‰ˆã€‚</p><p>ä¸‹è½½å®Œæ¯•åå°†æ–‡ä»¶å¤¹è§£å‹åˆ°ç›¸åº”ç›®å½•å³å¯ã€‚</p><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><p>å®‰è£…ä¾èµ–å…¶å®å°±æ˜¯ä¸€ä¸ª <code>npm install</code>ï¼Œä¸è¿‡ CNPM æŠŠè¯¥æŒ‡ä»¤å·²ç»å†™åˆ° Makefile é‡Œé¢äº†ï¼Œæ‰€ä»¥ç›´æ¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¥½äº†ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ make install</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¸‡ä¸€ä½ æ˜¯ Windows ç”¨æˆ·æˆ–è€…ä¸ä¼š <code>make</code>ï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦ç”¨ <code>npm install</code>ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm install --build-from-source --registry=https://registry.npm.taobao.org --disturl=https://npm.taobao.org/mirrors/node</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>æ–°å»ºä¸€ä»½ <code>config/config.js</code> æ–‡ä»¶ï¼Œå¹¶ä¸”å†™å…¥å¦‚ä¸‹çš„éª¨æ¶ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œé¢è¾“å…¥ä½ éœ€è¦çš„é”®å€¼å¯¹ã€‚</p><p>è¿™é‡Œå°†ä¼šåˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„é…ç½®é¡¹ï¼Œå…¶ä½™çš„ä¸€äº›é…ç½®é¡¹è¯·è‡ªè¡Œå‚è€ƒ <a href="https://github.com/cnpm/cnpmjs.org/blob/2.12.2/config/index.js" target="_blank" rel="external">config/index.js</a> æ–‡ä»¶ã€‚</p><h4 id="é…ç½®å­—æ®µå‚è€ƒ"><a href="#é…ç½®å­—æ®µå‚è€ƒ" class="headerlink" title="é…ç½®å­—æ®µå‚è€ƒ"></a>é…ç½®å­—æ®µå‚è€ƒ</h4><ul><li><code>enableCluster</code>ï¼šæ˜¯å¦å¯ç”¨ <strong>cluster-worker</strong> æ¨¡å¼å¯åŠ¨æœåŠ¡ï¼Œé»˜è®¤ <code>false</code>ï¼Œç”Ÿäº§ç¯èŠ‚æ¨èä¸º <code>true</code>;</li><li><code>registryPort</code>ï¼šAPI ä¸“ç”¨çš„ registry æœåŠ¡ç«¯å£ï¼Œé»˜è®¤ <code>7001</code>ï¼›</li><li><code>webPort</code>ï¼šWeb æœåŠ¡ç«¯å£ï¼Œé»˜è®¤ <code>7002</code>ï¼›</li><li><code>bindingHost</code>ï¼šç›‘å¬ç»‘å®šçš„ Hostï¼Œé»˜è®¤ä¸º <code>127.0.0.1</code>ï¼Œå¦‚æœå¤–é¢æ¶äº†ä¸€å±‚æœ¬åœ°çš„ <strong>Nginx</strong> åå‘ä»£ç†æˆ–è€… <strong>Apache</strong> åå‘ä»£ç†çš„è¯æ¨èä¸ç”¨æ”¹ï¼›</li><li><code>sessionSecret</code>ï¼š<strong>session</strong> ç”¨çš„ç›ï¼›</li><li><code>logdir</code>ï¼šæ—¥å¿—ç›®å½•ï¼›</li><li><code>uploadDir</code>ï¼šä¸´æ—¶ä¸Šä¼ æ–‡ä»¶ç›®å½•ï¼›</li><li><code>viewCache</code>ï¼šè§†å›¾æ¨¡æ¿ç¼“å­˜æ˜¯å¦å¼€å¯ï¼Œé»˜è®¤ä¸º <code>false</code>ï¼›</li><li><code>enableCompress</code>ï¼šæ˜¯å¦å¼€å¯ <strong>gzip</strong> å‹ç¼©ï¼Œé»˜è®¤ä¸º <code>false</code>ï¼›</li><li><code>admins</code>ï¼šç®¡ç†å‘˜ä»¬ï¼Œè¿™æ˜¯ä¸€ä¸ª <code>JSON Object</code>ï¼Œå¯¹åº”å„é”®åä¸ºå„ç®¡ç†å‘˜çš„ç”¨æˆ·åï¼Œé”®å€¼ä¸ºå…¶é‚®ç®±ï¼Œé»˜è®¤ä¸º <code>{ fengmk2: &#39;fengmk2@gmail.com&#39;, admin: &#39;admin@cnpmjs.org&#39;, dead_horse: &#39;dead_horse@qq.com&#39; }</code>ï¼›</li><li><code>logoURL</code>ï¼š<strong>Logo</strong> åœ°å€ï¼Œä¸è¿‡å¯¹äºæˆ‘è¿™ä¸ªå·²ç»æŠŠ CNPM å‰ç«¯æ”¹å¾—é¢ç›®å…¨éçš„äººæ¥è¯´å·²ç»å¿½ç•¥äº†è¿™ä¸ªé…ç½®äº†ï¼›</li><li><code>adBanner</code>ï¼šå¹¿å‘Š Banner çš„åœ°å€ï¼›</li><li><code>customReadmeFile</code>ï¼šå®é™…ä¸Šæˆ‘ä»¬çœ‹åˆ°çš„ <a href="http://cnpmjs.org" target="_blank" rel="external">cnpmjs.org</a> é¦–é¡µä¸­é—´ä¸€å¤§å †å†—é•¿çš„ä»‹ç»æ˜¯ä¸€ä¸ª Markdown æ–‡ä»¶è½¬åŒ–è€Œæˆçš„ï¼Œä½ å¯ä»¥è®¾ç½®è¯¥é¡¹æ¥è‡ªè¡Œæ›¿æ¢è¿™ä¸ªæ–‡ä»¶ï¼›</li><li><code>customFooter</code>ï¼šè‡ªå®šä¹‰é¡µè„šæ¨¡æ¿ï¼›</li><li><code>npmClientName</code>ï¼šé»˜è®¤ä¸º <code>cnpm</code>ï¼Œå¦‚æœä½ æœ‰è‡ªå·±å¼€å‘æˆ–è€… fork çš„ npm å®¢æˆ·ç«¯çš„è¯è¯·æ”¹æˆè‡ªå·±çš„ CLI å‘½ä»¤ï¼Œè¿™ä¸ªåº”è¯¥ä¼šåœ¨ä¸€äº›é¡µé¢çš„è¯´æ˜å¤„æ›¿æ¢æˆä½ æ‰€å†™çš„ï¼›</li><li><code>backupFilePrefix</code>ï¼šå¤‡ä»½ç›®å½•ï¼›</li><li><code>database</code>ï¼šæ•°æ®åº“ç›¸å…³é…ç½®ï¼Œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œé»˜è®¤å¦‚æœä¸é…ç½®å°†ä¼šæ˜¯ä¸€ä¸ª <code>~/.cnpmjs.org/data.sqlite</code> çš„ SQLiteï¼›<ul><li><code>db</code>ï¼šæ•°æ®çš„åº“åï¼›</li><li><code>username</code>ï¼šæ•°æ®åº“ç”¨æˆ·åï¼›</li><li><code>password</code>ï¼šæ•°æ®åº“å¯†ç ï¼›</li><li><code>dialect</code>ï¼šæ•°æ®åº“é€‚é…å™¨ï¼Œå¯é€‰ <code>&quot;mysql&quot;</code>ã€<code>&quot;sqlite&quot;</code>ã€<code>&quot;postgres&quot;</code>ã€<code>&quot;mariadb&quot;</code>ï¼Œé»˜è®¤ä¸º <code>&quot;sqlite&quot;</code>ï¼›</li><li><code>hsot</code>ï¼šæ•°æ®åº“åœ°å€ï¼›</li><li><code>port</code>ï¼šæ•°æ®åº“ç«¯å£ï¼›</li><li><code>pool</code>ï¼šæ•°æ®åº“è¿æ¥æ± ç›¸å…³é…ç½®ï¼Œä¸ºä¸€ä¸ªå¯¹è±¡ï¼›<ul><li><code>maxConnections</code>ï¼šæœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º <code>10</code>ï¼›</li><li><code>minConnections</code>ï¼šæœ€å°è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º <code>0</code>ï¼›</li><li><code>maxIdleTime</code>ï¼šå•æ¡é“¾æ¥æœ€å¤§ç©ºé—²æ—¶é—´ï¼Œé»˜è®¤ä¸º <code>30000</code> æ¯«ç§’ï¼›</li></ul></li><li><code>storege</code>ï¼šä»…å¯¹ SQLite é…ç½®æœ‰æ•ˆï¼Œæ•°æ®åº“åœ°å€ï¼Œé»˜è®¤ä¸º <code>~/.cnpmjs/data.sqlite</code>ï¼›</li></ul></li><li><code>nfs</code>ï¼šåŒ…æ–‡ä»¶ç³»ç»Ÿå¤„ç†å¯¹è±¡ï¼Œä¸ºä¸€ä¸ª Node.js å¯¹è±¡ï¼Œé»˜è®¤æ˜¯ <a href="https://github.com/cnpm/fs-cnpm" target="_blank" rel="external">fs-cnpm</a> è¿™ä¸ªåŒ…ï¼Œå¹¶ä¸”é…ç½®åœ¨ <code>~/.cnpmjs/nfs</code> ç›®å½•ä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤æ‰€æœ‰åŒæ­¥çš„åŒ…éƒ½ä¼šè¢«æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼›å¼€å‘è€…å¯ä»¥ä½¿ç”¨åˆ«çš„ä¸€äº›æ–‡ä»¶ç³»ç»Ÿæ’ä»¶ï¼ˆå¦‚ä¸Šä¼ åˆ°åˆæ‹äº‘ç­‰ï¼‰,åˆæˆ–è€…è‡ªå·±å»æŒ‰æ¥å£å¼€å‘ä¸€ä¸ªé€»è¾‘å±‚ï¼Œè¿™äº›éƒ½æ˜¯åè¯äº†ï¼›</li><li><code>registryHost</code>ï¼šæš‚æ—¶è¿˜æœªè¯•è¿‡ï¼Œæˆ‘çŒœæ˜¯ç”¨äº Web é¡µé¢æ˜¾ç¤ºç”¨çš„ï¼Œé»˜è®¤ä¸º <code>r.cnpmjs.org</code>ï¼›</li><li><code>enablePrivate</code>ï¼šæ˜¯å¦å¼€å¯ç§æœ‰æ¨¡å¼ï¼Œé»˜è®¤ä¸º <code>false</code>ï¼›<ul><li>å¦‚æœæ˜¯ç§æœ‰æ¨¡å¼åˆ™åªæœ‰ç®¡ç†å‘˜èƒ½å‘å¸ƒåŒ…ï¼Œå…¶å®ƒäººåªèƒ½ä»æºç«™åŒæ­¥åŒ…ï¼›</li><li>å¦‚æœæ˜¯éç§æœ‰æ¨¡å¼åˆ™æ‰€æœ‰ç™»å½•ç”¨æˆ·éƒ½èƒ½å‘å¸ƒåŒ…ï¼›</li></ul></li><li><code>scopes</code>ï¼šéç®¡ç†å‘˜å‘å¸ƒåŒ…çš„æ—¶å€™åªèƒ½ç”¨ä»¥ <code>scopes</code> é‡Œé¢åˆ—ä¸¾çš„å‘½åç©ºé—´ä¸ºå‰ç¼€æ¥å‘å¸ƒï¼Œå¦‚æœæ²¡è®¾ç½®åˆ™æ— æ³•å‘å¸ƒï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸€ä¸ªå¿…å¡«é¡¹ï¼Œé»˜è®¤ä¸º <code>[ &#39;@cnpm&#39;, &#39;@cnpmtest&#39;, &#39;@cnpm-test&#39; ]</code>ï¼Œæ®è‹åƒå¤§å¤§è§£é‡Šæ˜¯ä¸ºäº†ä¾¿äºç®¡ç†ä»¥åŠè®©å…¬å¸çš„å‘˜å·¥è‡ªè§‰æŒ‰éœ€å‘å¸ƒï¼›æ›´å¤šå…³äº NPM scope çš„è¯´æ˜è¯·å‚è§ <a href="https://docs.npmjs.com/misc/scope" target="_blank" rel="external">npm-scope</a>ï¼›</li><li><code>privatePackages</code>ï¼šå°±å¦‚è¯¥é…ç½®é¡¹çš„æ³¨é‡Šæ‰€è¿°ï¼Œå‡ºäºå†å²åŒ…è¢±çš„åŸå› ï¼Œæœ‰äº›å·²ç»å­˜åœ¨çš„ç§æœ‰åŒ…ï¼ˆå¯èƒ½ä¹‹å‰æ˜¯ç”¨ Git çš„æ–¹å¼å®‰è£…çš„ï¼‰å¹¶æ²¡æœ‰ä»¥å‘½åç©ºé—´çš„å½¢å¼æ¥å‘½åï¼Œè€Œè¿™ç§åŒ…æœ¬æ¥æ˜¯æ— æ³•ä¸Šä¼ åˆ° CNPM çš„ï¼Œè¿™ä¸ªé…ç½®é¡¹æ•°ç»„å°±æ˜¯ç”¨æ¥åŠ è¿™äº›ä¾‹å¤–ç™½åå•çš„ï¼Œé»˜è®¤ä¸ºä¸€ä¸ªç©ºæ•°ç»„ï¼›</li><li><code>sourceNpmRegistry</code>ï¼šæ›´æ–°æº NPM çš„ registry åœ°å€ï¼Œé»˜è®¤ä¸º <code>https://registry.npm.taobao.org</code>ï¼›</li><li><code>sourceNpmRegistryIsCNpm</code>ï¼šæº registry æ˜¯å¦ä¸º CNPMï¼Œé»˜è®¤ä¸º <code>true</code>ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æºæ˜¯å®˜æ–¹ NPM æºï¼Œè¯·å°†å…¶è®¾ä¸º <code>false</code>ï¼›</li><li><code>syncByInstall</code>ï¼šå¦‚æœå®‰è£…åŒ…çš„æ—¶å€™å‘ç°åŒ…ä¸å­˜åœ¨ï¼Œåˆ™å°è¯•ä»æ›´æ–°æºåŒæ­¥ï¼Œé»˜è®¤ä¸º <code>true</code>ï¼›</li><li><code>syncModel</code>ï¼šæ›´æ–°æ¨¡å¼ï¼ˆä¸è¿‡æˆ‘è§‰å¾—æ˜¯ä¸ª <code>typo</code>ï¼‰ï¼Œæœ‰ä¸‹é¢å‡ ç§æ¨¡å¼å¯ä»¥é€‰æ‹©ï¼Œé»˜è®¤ä¸º <code>&quot;none&quot;</code>;<ul><li><code>&quot;none&quot;</code>ï¼šæ°¸ä¸åŒæ­¥ï¼Œåªç®¡ç†ç§æœ‰ç”¨æˆ·ä¸Šä¼ çš„åŒ…ï¼Œå…¶å®ƒæºåŒ…ä¼šç›´æ¥ä»æºç«™è·å–ï¼›</li><li><code>&quot;exist&quot;</code>ï¼šå®šæ—¶åŒæ­¥å·²ç»å­˜åœ¨äºæ•°æ®åº“çš„åŒ…ï¼›</li><li><code>&quot;all&quot;</code>ï¼šå®šæ—¶åŒæ­¥æ‰€æœ‰æºç«™çš„åŒ…ï¼›</li></ul></li><li><code>syncInterval</code>ï¼šåŒæ­¥é—´éš”ï¼Œé»˜è®¤ä¸º <code>&quot;10m&quot;</code> å³ååˆ†é’Ÿï¼›</li><li><code>syncDevDependencies</code>ï¼šæ˜¯å¦åŒæ­¥æ¯ä¸ªåŒ…é‡Œé¢çš„ <code>devDependencies</code> åŒ…ä»¬ï¼Œé»˜è®¤ä¸º <code>false</code>ï¼›</li><li><code>badgeSubject</code>ï¼šåŒ…çš„ <strong>badge</strong> æ˜¾ç¤ºçš„åå­—ï¼Œé»˜è®¤ä¸º <code>cnpm</code>ï¼›</li><li><code>userService</code>ï¼šç”¨æˆ·éªŒè¯æ¥å£ï¼Œé»˜è®¤ä¸º <code>null</code>ï¼Œå³æ— ç”¨æˆ·ç›¸å…³åŠŸèƒ½ä¹Ÿå°±æ˜¯æ— æ³•æœ‰ç”¨æˆ·å»ä¸Šä¼ åŒ…ï¼Œè¯¥éƒ¨åˆ†éœ€è¦è‡ªå·±å®ç°æ¥å£åŠŸèƒ½å¹¶é…ç½®ï¼Œå¦‚ä¸å…¬å¸çš„ <strong>Gitlab</strong> ç›¸å¯¹æ¥ï¼Œè¿™ä¹Ÿæ˜¯åè¯äº†ï¼›</li><li><code>alwaysAuth</code>ï¼šæ˜¯å¦å§‹ç»ˆéœ€è¦ç”¨æˆ·éªŒè¯ï¼Œå³ä¾¿æ˜¯ <code>$ cnpm install</code> ç­‰å‘½ä»¤ï¼›</li><li><code>httpProxy</code>ï¼šä»£ç†åœ°å€è®¾ç½®ï¼Œç”¨äºä½ åœ¨å¢™å†…æºç«™åœ¨å¢™å¤–çš„æƒ…å†µã€‚</li></ul><h4 id="ä¸€ä¸ªå¯èƒ½çš„é…ç½®"><a href="#ä¸€ä¸ªå¯èƒ½çš„é…ç½®" class="headerlink" title="ä¸€ä¸ªå¯èƒ½çš„é…ç½®"></a>ä¸€ä¸ªå¯èƒ½çš„é…ç½®</h4><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªæ ·ä¾‹é…ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">enableCluster</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">database</span>: &#123;</span><br><span class="line">        <span class="attr">db</span>: <span class="string">"snpm"</span>,</span><br><span class="line">        <span class="attr">username</span>: <span class="string">"username"</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">"password"</span>,</span><br><span class="line"></span><br><span class="line">        <span class="attr">dialect</span>: <span class="string">"mysql"</span>,</span><br><span class="line">        <span class="attr">host</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="number">3306</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">enablePrivate</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">admins</span>: &#123;</span><br><span class="line">        <span class="attr">xadillax</span>: <span class="string">"i@2333.moe"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">syncModel</span>: <span class="string">"exist"</span>,</span><br><span class="line">    <span class="attr">nfs</span>: <span class="built_in">require</span>(<span class="string">'upyun-cnpm'</span>).create(&#123;</span><br><span class="line">        <span class="attr">bucket</span>: <span class="string">"your bucket"</span>,</span><br><span class="line">        <span class="attr">oprator</span>: <span class="string">"your id"</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">"your secret"</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">scopes</span>: [ <span class="string">'@cheniu'</span>, <span class="string">'@souche'</span>, <span class="string">'@souche-f2e'</span> ],</span><br><span class="line">    <span class="attr">badgeSubject</span>: <span class="string">'snpm'</span>,</span><br><span class="line">    <span class="attr">privatePackages</span>: [ <span class="string">'snpm'</span> ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„é…ç½®åŒ…æ–‡ä»¶ç³»ç»Ÿå±‚ç”¨çš„æ˜¯ <a href="https://github.com/cnpm/upyun-cnpm" target="_blank" rel="external">upyun-cnpm</a> æ’ä»¶ï¼Œéœ€è¦åœ¨ CNPM æºç æ ¹ç›®å½•æ‰§è¡Œ<br><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm install --save -d upyun-cnpm</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™ä½ çš„ <code>package.json</code> å°±æœ‰æ›´æ”¹ä¸æº Repo ä¸ä¸€è‡´äº†ï¼Œå¦‚æœæ˜¯ Git å…‹éš†çš„ç”¨æˆ·åœ¨ä»¥åå‡çº§æ›´æ–°ç³»ç»Ÿçš„æ—¶å€™ç¨ç¨æ³¨æ„ä¸€ä¸‹å¯èƒ½çš„å†²çªå³å¯ã€‚</p></blockquote><h4 id="å®˜æ–¹-NFS-æ’ä»¶"><a href="#å®˜æ–¹-NFS-æ’ä»¶" class="headerlink" title="å®˜æ–¹ NFS æ’ä»¶"></a>å®˜æ–¹ NFS æ’ä»¶</h4><p>ä¸‹é¢ç»™å‡ºå‡ ä¸ªå®˜æ–¹çš„ NFS æ’ä»¶ï¼š</p><ul><li><a href="https://github.com/cnpm/upyun-cnpm" target="_blank" rel="external">upyun-cnpm</a>ï¼šåŒ…æœ¬ä½“å­˜åœ¨åˆæ‹äº‘çš„æ’ä»¶ï¼›</li><li><a href="https://github.com/cnpm/fs-cnpm" target="_blank" rel="external">fs-cnpm</a>ï¼šåŒ…æœ¬ä½“å­˜åœ¨æœ¬åœ°çš„æ’ä»¶ï¼›</li><li><a href="https://github.com/cnpm/sfs-client" target="_blank" rel="external">sfs-client</a>ï¼šåŒ…æœ¬ä½“å­˜åœ¨ <a href="https://github.com/cnpm/sfs" target="_blank" rel="external">SFS</a>ï¼ˆSimple FIle Storeï¼‰æ’ä»¶ï¼›</li><li><a href="https://github.com/cnpm/qn-cnpm" target="_blank" rel="external">qn-cnpm</a>ï¼šåŒ…æœ¬ä½“å­˜åœ¨ä¸ƒç‰›çš„æ’ä»¶ï¼›</li><li><a href="https://github.com/cnpm/oss-cnpm" target="_blank" rel="external">oss-cnpm</a>ï¼šåŒ…æœ¬ä½“å­˜åœ¨é˜¿é‡Œäº‘ OSS çš„æ’ä»¶ã€‚</li></ul><p>ä»¥åå®˜æ–¹å¦‚æœæœ‰ä¸€äº›æ–°çš„æ’ä»¶è¿›æ¥ï¼Œè¿™é‡Œå¯èƒ½ä¸ä¼šæ›´æ–°äº†ï¼Œè¯·è‡ªè¡Œå» <a href="https://github.com/cnpm/cnpmjs.org/wiki/NFS-Guide#present-storage-wrappers" target="_blank" rel="external">NFS Storage Wrappers</a> è·å–æœ€æ–°çš„ NFS æ’ä»¶ä»¬ã€‚</p><h3 id="åˆå§‹åŒ–æ•°æ®åº“"><a href="#åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="åˆå§‹åŒ–æ•°æ®åº“"></a>åˆå§‹åŒ–æ•°æ®åº“</h3><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ SQLite çš„è¯ï¼Œæ•°æ®åº“æ˜¯è‡ªåŠ¨å°±å¥½äº†çš„ï¼Œå¯ä»¥å¿½ç•¥è¯¥æ­¥ã€‚</p><p>å…¶å®ƒæ•°æ®åº“éœ€è¦è‡ªè¡Œå¯¼å…¥åˆå§‹æ•°æ®åº“ç»“æ„ã€‚</p><p>åˆå§‹æ•°æ®åº“è„šæœ¬åœ¨ <strong>docs/db.sql</strong> é‡Œé¢ï¼Œä½ å¯ä»¥ç”¨ä¸€äº› GUI å·¥å…·å°†æ•°æ®å¯¼å…¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿›å…¥å‘½ä»¤è¡Œå¯¼å…¥ã€‚</p><p>æ¯”å¦‚ä½ ç”¨çš„æ˜¯ MySQLï¼Œå°±å¯ä»¥åœ¨æœ¬æœºæ“ä½œ MySQLã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ mysql -u yourname -p</span><br><span class="line">mysql&gt; use cnpmjs;</span><br><span class="line">mysql&gt; <span class="built_in">source</span> docs/db.sql</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><p>æå¥½é…ç½®ä¹‹åå°±å¯ä»¥ç›´æ¥å¯åŠ¨æœåŠ¡äº†ã€‚</p><h4 id="ç®€å•å¯åŠ¨"><a href="#ç®€å•å¯åŠ¨" class="headerlink" title="ç®€å•å¯åŠ¨"></a>ç®€å•å¯åŠ¨</h4><p>æœ€ç®€å•çš„åŠæ³•ä¹Ÿæ˜¯æˆ‘ç°åœ¨æ­£åœ¨ç”¨çš„æ–¹æ³•å°±æ˜¯ç›´æ¥ç”¨ <code>node</code> æ‰§è¡Œä¸€ä¸‹å…¥å£æ–‡ä»¶å°±å¥½äº†ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ node dispatch.js</span><br></pre></td></tr></table></figure><blockquote><p>å…¶å®æˆ‘æ˜¯åœ¨ <a href="https://tmux.github.io/" target="_blank" rel="external">tmux</a> é‡Œé¢æ‰§è¡Œä¸Šé¢çš„æŒ‡ä»¤çš„ã€‚</p></blockquote><h4 id="å®˜æ–¹è„šæœ¬å¯åŠ¨"><a href="#å®˜æ–¹è„šæœ¬å¯åŠ¨" class="headerlink" title="å®˜æ–¹è„šæœ¬å¯åŠ¨"></a>å®˜æ–¹è„šæœ¬å¯åŠ¨</h4><p>å®˜æ–¹çš„å…¶å®ƒä¸€äº›æŒ‡ä»¤ï¼Œæ¯”å¦‚ä½ å¯ä»¥ç”¨ NPM çš„ script æ¥è¿è¡Œã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm run start</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ CNPM é‡Œé¢ï¼Œnpm script è¿˜æœ‰ä¸‹é¢å‡ ç§æŒ‡ä»¤</p><ul><li><code>npm run dev</code>ï¼šè°ƒè¯•æ¨¡å¼å¯åŠ¨ï¼›</li><li><code>npm run test</code>ï¼šè·‘æµ‹è¯•ï¼›</li><li><code>npm run start</code>ï¼šå¯åŠ¨ CNPMï¼›</li><li><code>npm run status</code>ï¼šæŸ¥çœ‹ CNPM å¯åŠ¨çŠ¶æ€ï¼›</li><li><code>npm run stop</code>ï¼šåœæ­¢ CNPMã€‚</li></ul></blockquote><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>æœ¬æ–‡ä»‹ç»äº†ä¸€äº› CNPM åŸºç¡€çš„éƒ¨ç½²æ–¹æ³•ï¼ŒåŸºæœ¬ä¸Šèƒ½è¾¾åˆ°æœ€å°å¯ç”¨çŠ¶æ€ã€‚</p><p>å¦‚æœæƒ³è¦è¿›é˜¶å®šåˆ¶ä¸€äº› CNPM çš„åŠŸèƒ½ï¼Œè¯·æœŸå¾…åç»­å§ã€‚Î¾( âœ¿ï¼â—¡â›)</p><p>ä»¥åŠä¸€äº›å†™å¾—ä¸å¥½å’Œä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·å¤šå¤šæŒ‡æ­£å“¦ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬ç« ä¼šä»‹ç» CNPM çš„åŸºç¡€éƒ¨ç½²æ–¹æ³•ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯¥æ–‡ç« æ‰€å¯¹åº”çš„ cnpm ç›®æ ‡ç‰ˆæœ¬ä¸º &lt;a href=&quot;https://github.com/cnpm/cnpmjs.org/tree/2.12.2&quot; target=&quot;_blank&quot; rel=&quot;
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="CNPM" scheme="https://xcoder.in/tags/CNPM/"/>
    
  </entry>
  
  <entry>
    <title>è·Ÿæˆ‘ä¸€èµ·éƒ¨ç½²å’Œå®šåˆ¶ CNPMâ€”â€”ç´¢å¼•</title>
    <link href="https://xcoder.in/2016/07/08/lets-cnpm-toc/"/>
    <id>https://xcoder.in/2016/07/08/lets-cnpm-toc/</id>
    <published>2016-07-08T11:14:58.000Z</published>
    <updated>2017-12-11T07:59:20.519Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç³»åˆ—æ–‡ç« å°†ä¼šåŸºäº <a href="https://github.com/cnpm/cnpmjs.org" target="_blank" rel="external">cnpm</a> éƒ¨ç½²æ­å»ºä¸€å¥—å±äºè‡ªå·±ï¼ˆæˆ–è€…å…¬å¸ï¼‰çš„å†…éƒ¨ç§æœ‰ NPM ç³»ç»Ÿã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-CNPM"><a href="#ä»€ä¹ˆæ˜¯-CNPM" class="headerlink" title="ä»€ä¹ˆæ˜¯ CNPM"></a>ä»€ä¹ˆæ˜¯ CNPM</h2><p><a href="https://github.com/cnpm/cnpmjs.org" target="_blank" rel="external">cnpm</a> æ˜¯ Node.js ä¸­å›½ç¤¾åŒºæˆå‘˜ä¸»å¯¼çš„ä¸€ä¸ªç§æœ‰ NPM å¼€æºé¡¹ç›®ï¼Œå¯ä»¥ç”¨äºéƒ¨ç½²ç§æœ‰ NPMã€å…¬å…± NPM é•œåƒç­‰ã€‚</p><h2 id="é˜…è¯»å¯¹è±¡"><a href="#é˜…è¯»å¯¹è±¡" class="headerlink" title="é˜…è¯»å¯¹è±¡"></a>é˜…è¯»å¯¹è±¡</h2><ul><li>æœ‰ä¸€å®š Node.js åç«¯åŸºç¡€</li><li>éœ€è¦æœ‰ä¸€å¥—ç§æœ‰ NPM</li><li>æƒ³è¦ç ”ç©¶ CNPM å®ç°</li></ul><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ol><li><a href="https://xcoder.in/2016/07/09/lets-cnpm-base-deploy/">åŸºç¡€éƒ¨ç½²</a></li><li><a href="https://xcoder.in/2016/07/22/lets-cnpm-storage/">è‡ªå®šä¹‰åŒ…å­˜å‚¨å±‚</a></li><li>To be continued</li></ol><h2 id="è´¡çŒ®"><a href="#è´¡çŒ®" class="headerlink" title="è´¡çŒ®"></a>è´¡çŒ®</h2><p>ä½ å¯ä»¥å¯¹æœ¬ç³»åˆ—æ–‡ç« è¿›è¡Œå‹˜è¯¯æˆ–è€…æ›´æ–°ï¼Œç›´æ¥æäº¤ PR æˆ–è€…åœ¨åšå®¢æ–‡ç« åæ–¹ç•™è¨€ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« å°†ä¼šåŸºäº &lt;a href=&quot;https://github.com/cnpm/cnpmjs.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cnpm&lt;/a&gt; éƒ¨ç½²æ­å»ºä¸€å¥—å±äºè‡ªå·±ï¼ˆæˆ–è€…å…¬å¸ï¼‰çš„å†…éƒ¨ç§æœ‰ NPM ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h2 id=&quot;
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="CNPM" scheme="https://xcoder.in/tags/CNPM/"/>
    
  </entry>
  
  <entry>
    <title>è®©æˆ‘ä»¬ä¸€èµ·æ¥èµ·èŠ±åå§</title>
    <link href="https://xcoder.in/2016/02/24/lets-hua/"/>
    <id>https://xcoder.in/2016/02/24/lets-hua/</id>
    <published>2016-02-24T05:40:36.000Z</published>
    <updated>2017-12-11T07:59:20.519Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>èµ·å› æ˜¯æˆ‘ä¸€ä¸ªå«ã€å°é¾™ã€çš„å¥½åŸºå‹ç”±äºæŸäº›åŸå› ç¦»èŒå»äº†ä¸€å®¶è·Ÿé˜¿é‡Œä¸€æ ·æœ‰ç€ã€èŠ±åæ–‡åŒ–ã€çš„å…¬å¸ï¼Œäºæ˜¯å¼€å§‹ä¸ºèŠ±åçŠ¯æ„ã€‚</p><p>ç»“åˆä¹‹å‰å¦¹çº¸ã€å¼çº¾ã€åœ¨èµ·èŠ±åçš„æ—¶å€™ä¹Ÿé‡åˆ°äº†åŒæ ·çš„å›°æ‰°ï¼Œäºæ˜¯å†³å®šç”¨ Node.js å†™ä¸ªã€ä¸€æœ¬æ­£ç»ä¹±èµ·èŠ±åã€çš„ç¨‹åºã€‚</p><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><h3 id="Chinese-Random-Name"><a href="#Chinese-Random-Name" class="headerlink" title="Chinese Random Name"></a>Chinese Random Name</h3><p>é¦–å…ˆèµ·èŠ±åçš„åŸç†å°±æ˜¯èƒ¡ä¹±éšæœºä¸€ä¸²å­—å‡ºæ¥èƒ¡ä¹±æ‹¼ã€‚</p><p>äºæ˜¯å‡†å¤‡åº”è¯¥æœ‰ <a href="https://github.com/XadillaX/chinese-random-name" target="_blank" rel="external">chinese-random-name</a>ï¼Œä¸€ä¸ªéšæœºç”Ÿæˆä¸­æ–‡åçš„åŒ…ã€‚</p><p>ä½¿ç”¨å®ƒå¾ˆç®€å•ï¼Œå…ˆæŠŠå®ƒ <code>require</code> è¿›æ¥ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> randomName = <span class="built_in">require</span>(<span class="string">"chinese-random-name"</span>);</span><br></pre></td></tr></table></figure><h4 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h4><p>å¦‚æœä½ éœ€è¦éšæœºç”Ÿæˆä¸€ä¸ªåå­—åªéœ€è¦ <code>randomName.generate()</code> å°±å¯ä»¥äº†ï¼›å¦‚æœä½ è¦éšæœºä¸€ä¸ªå§“é‚£ä¹ˆå°± <code>randomName.surnames.getOne()</code>ï¼›å¦‚æœä½ åªéœ€è¦è·å¾—åå­—ï¼Œè¿™é‡Œé¢å°±æœ‰ç‚¹é—¨é“äº†ã€‚</p><h4 id="é«˜çº§ç”¨æ³•"><a href="#é«˜çº§ç”¨æ³•" class="headerlink" title="é«˜çº§ç”¨æ³•"></a>é«˜çº§ç”¨æ³•</h4><p>ä½ å¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ªåï¼ˆä¸å¸¦å§“çš„ï¼‰ <code>randomName.names.get()</code>ï¼›ä½ ä¹Ÿå¯ä»¥æŒ‡å®šåå­—çš„å­—æ•°ï¼Œä¸€äºŒä¸‰ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">randomName.names.get1();</span><br><span class="line">randomName.names.get2();</span><br><span class="line">randomName.names.get3();</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼</p><p>åˆæˆ–è€…ï¼</p><p>ç„¶åæˆ–è€…ï¼</p><p>ä½ å¯ä»¥æŒ‡å®šæ¯ä¸ªå­—çš„äº”è¡Œå“¦ï¼</p><p>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ¯”å¦‚ä½ æƒ³ç»™å­©å­èµ·ä¸ªåï¼Œç„¶åå­©å­å‘½é‡Œäº”è¡Œç¼ºé‡‘ï¼Œé‚£ä¹ˆå°±å¯ä»¥ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">randomName.names.get2(<span class="string">"é‡‘é‡‘"</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åä½ å°±å¯èƒ½å¾—åˆ°ä¸€ä¸ªã€<strong>ç´«é“¨</strong>ã€ï¼Œä¸¤ä¸ªå­—éƒ½æ˜¯å±é‡‘çš„ã€‚é‚£ä¹ˆå¦‚æœä½ å­©å­å§“æï¼Œå°±å«æç´«é“¨ï¼›å¦‚æœå­©å­å§“ç‹ï¼Œå°±å«ç‹ç´«é“¨ï¼›å¦‚æœå§“çˆ±æ–°è§‰ç½—ï¼Œé‚£ä¹ˆå°±å«çˆ±æ–°è§‰ç½—Â·ç´«é“¨ã€‚</p><p>æœ‰æœ¨æœ‰æƒ³ç»™æˆ‘è£…å¾—è¿™ä¸ªé€¼æ‰“ä¸ª 82 åˆ†å‘¢ï¼Ÿå‰©ä¸‹çš„å°±äº¤ç»™ 666 å§ã€‚(à¸‡ â€¢Ì€_â€¢Ì)à¸‡</p><h3 id="Nomnom"><a href="#Nomnom" class="headerlink" title="Nomnom"></a>Nomnom</h3><p>è¿™ä¸ªåŒ…æ˜¯ç”¨æ¥è§£æå‘½ä»¤è¡Œå‚æ•°çš„ã€‚è™½ç„¶å¸‚é¢ä¸Šæœ‰æŒºå¤šåˆ«çš„çš„ï¼Œæ¯”å¦‚ <a href="https://www.npmjs.com/package/commander" target="_blank" rel="external">commander</a> ç­‰ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯æœ€ä¹ æƒ¯ <a href="https://www.npmjs.com/package/nomnom" target="_blank" rel="external">nomnom</a>ï¼Œç”¨ç§°æ‰‹äº†å°±ä¸æƒ³æ¢äº†ã€‚</p><p>è™½ç„¶å®ƒçš„ GitHub Repo ä¸‹é¢æœ‰è¿™ä¹ˆä¸€æ®µè¯ã€‚</p><blockquote><p>Nomnom is deprecated. Check out <a href="https://github.com/tj/commander.js" target="_blank" rel="external">https://github.com/tj/commander.js</a>, which should have most, if not all of the capability that nomnom had. Thank you!</p></blockquote><p>ä¸è¿‡å†æ€ä¹ˆè¯´ nomnom ä¹Ÿæ˜¯å½“å¹´ <a href="https://github.com/substack/node-optimist" target="_blank" rel="external">substack</a> å¤§ç¥æ¨èçš„å•Šã€‚(à²¡Ï‰à²¡)</p><h3 id="Colorful"><a href="#Colorful" class="headerlink" title="Colorful"></a>Colorful</h3><p>è¿™ä¸ªåŒ…æ˜¯ç”¨æ¥ä¸Šè‰²çš„ã€‚</p><p>æ¯•ç«Ÿäº”è¡Œæ˜¯æœ‰é¢œè‰²çš„å“‡ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> color = <span class="built_in">require</span>(<span class="string">"colorful"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(color.red(<span class="string">"ï¼ˆ*/âˆ‡ï¼¼*ï¼‰"</span>));</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨ä½ çš„ç»ˆç«¯å°±å¥½çœ‹åˆ°ä¸€ä¸ªçº¢è‰²çš„ <code>ï¼ˆ*/âˆ‡ï¼¼*ï¼‰</code>ã€‚</p><h3 id="Is-Chinese"><a href="#Is-Chinese" class="headerlink" title="Is Chinese"></a>Is Chinese</h3><p>ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸­æ–‡çš„åŒ…ã€‚</p><p>ä½œä¸ºä¸€ä¸ªèµ·åçš„å‘½ä»¤è¡Œç¨‹åºï¼Œä½ æ€»å¾—å¥½å¥½ä¼ å‚æ‰è¡Œå§ï¼Œæ€»ä¸èƒ½ä½ éšä¾¿ä¼ ä¸ªå’¸é¸­è›‹ğŸ£æˆ‘ä¹Ÿå¥½å¥½å¤„ç†å§ã€‚</p><p>äºæ˜¯å°±ç”¨ <a href="https://www.npmjs.com/package/is-chinese" target="_blank" rel="external">is-chinese</a> æ¥åˆ¤æ–­æŸä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯çº¯ä¸­æ–‡ã€‚</p><p>è¿™ä¸ªåŒ…æ˜¯ç”±å‰é˜¿é‡Œå°ä¼™ä¼´ï¼ŒCNode ç«™é•¿<a href="https://github.com/alsotang" target="_blank" rel="external">å”å°‘</a>å†™çš„ã€‚</p><p>ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦ <code>isChinese(&quot;ä»€ä¹ˆä½ è¦åˆ¤æ–­ä»€ä¹ˆ&quot;)</code> å°±å¯ä»¥äº†ã€‚</p><h3 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm install --save -d chinese-random-name</span><br><span class="line">$ npm install --save -d nomnom</span><br><span class="line">$ npm install --save -d colorful</span><br><span class="line">$ npm install --save -d is-chinese</span><br></pre></td></tr></table></figure><ul><li><strong>chinese-random-name</strong>: <a href="https://github.com/XadillaX/chinese-random-name" target="_blank" rel="external">https://github.com/XadillaX/chinese-random-name</a></li><li><strong>nomnom</strong>: <a href="https://github.com/harthur/nomnom" target="_blank" rel="external">https://github.com/harthur/nomnom</a></li><li><strong>colorful</strong>: <a href="https://github.com/lepture/colorful" target="_blank" rel="external">https://github.com/lepture/colorful</a></li><li><strong>is-chinese</strong>: <a href="https://github.com/alsotang/is-chinese" target="_blank" rel="external">https://github.com/alsotang/is-chinese</a></li></ul><h2 id="å¼€å·¥"><a href="#å¼€å·¥" class="headerlink" title="å¼€å·¥"></a>å¼€å·¥</h2><p>å…¶ç»“æœåœ¨<a href="https://github.com/BoogeeDoo/hua" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p><h3 id="è§£æå‘½ä»¤è¡Œå‚æ•°"><a href="#è§£æå‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="è§£æå‘½ä»¤è¡Œå‚æ•°"></a>è§£æå‘½ä»¤è¡Œå‚æ•°</h3><p>é¦–å…ˆæ•ˆæœæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ hua --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage: hua [options]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">-p PREFIX, --prefix PREFIX          to specify a prefix.</span><br><span class="line">-s SUFFIX, --suffix SUFFIX          to specify a suffix.</span><br><span class="line">-5 WUXING, --five-elements WUXING   the file elements (Wuxing) of huaming.</span><br><span class="line">-c COUNT, --count COUNT             the count of huaming  [10]</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è€…å¯ä»¥è‡ªå·±æƒ³ä¸€ä¸ªå‰ç¼€æˆ–è€…åç¼€ï¼Œç„¶åè‡ªå®šä¹‰ï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼‰ä¸¤ä¸ªå­—çš„äº”è¡Œï¼Œä»¥åŠæŒ‡å®šä¸€æ¬¡æ€§ç”Ÿæˆå¤šå°‘ä¸ªèŠ±åã€‚</p><p>æ¯”å¦‚æƒ³è¦ç”Ÿæˆä»¥ <code>é¾™</code> å­—ä¸ºå‰ç¼€çš„èŠ±åï¼Œå°±å¯ä»¥ <code>$ hua --prefix é¾™</code>ï¼Œå¾—åˆ°ç»“æœå¯ä»¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">* é¾™å¹¼</span><br><span class="line">* é¾™å·¡</span><br><span class="line">* é¾™èº¬</span><br><span class="line">* é¾™ä»‡</span><br><span class="line">* é¾™é”¤</span><br><span class="line">* é¾™é•’</span><br><span class="line">* é¾™æ‹¾</span><br><span class="line">* é¾™å¤®</span><br><span class="line">* é¾™äº›</span><br><span class="line">* é¾™æ‚ </span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³ä¸¤ä¸ªå­—åˆ†åˆ«æ‰€å±é‡‘å’Œè°ï¼Œå°±å¯ä»¥ <code>$ hua --five-elements é‡‘æ°´</code> æ¥èµ·èŠ±åï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">* å€©å¨¥</span><br><span class="line">* é›€æ•ˆ</span><br><span class="line">* é»æ£“</span><br><span class="line">* å§¹æº¶</span><br><span class="line">* é¦¨æ²™</span><br><span class="line">* å®«é—²</span><br><span class="line">* è£•æ··</span><br><span class="line">* ä¿—å°</span><br><span class="line">* ç»¸å¨¥</span><br><span class="line">* ç‘æ·¦</span><br></pre></td></tr></table></figure><p>æƒ³è¦å¾—åˆ°è¿™æ ·ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>nomnom</code> æ¥è§£å†³ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> opts = <span class="built_in">require</span>(<span class="string">"nomnom"</span>)</span><br><span class="line">    .script(<span class="string">"hua"</span>)</span><br><span class="line">    .option(<span class="string">"prefix"</span>, &#123;</span><br><span class="line">        <span class="attr">abbr</span>: <span class="string">"p"</span>,</span><br><span class="line">        <span class="attr">help</span>: <span class="string">"to specify a prefix."</span>,</span><br><span class="line">        <span class="attr">metavar</span>: <span class="string">"PREFIX"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .option(<span class="string">"suffix"</span>, &#123;</span><br><span class="line">        <span class="attr">abbr</span>: <span class="string">"s"</span>,</span><br><span class="line">        <span class="attr">help</span>: <span class="string">"to specify a suffix."</span>,</span><br><span class="line">        <span class="attr">metavar</span>: <span class="string">"SUFFIX"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .option(<span class="string">"five-elements"</span>, &#123;</span><br><span class="line">        <span class="attr">abbr</span>: <span class="string">"5"</span>,</span><br><span class="line">        <span class="attr">help</span>: <span class="string">"the file elements (Wuxing) of huaming."</span>,</span><br><span class="line">        <span class="attr">metavar</span>: <span class="string">"WUXING"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .option(<span class="string">"count"</span>, &#123;</span><br><span class="line">        <span class="attr">abbr</span>: <span class="string">"c"</span>,</span><br><span class="line">        <span class="attr">help</span>: <span class="string">"the count of huaming"</span>,</span><br><span class="line">        <span class="attr">metavar</span>: <span class="string">"COUNT"</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="number">10</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .parse();</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™æ®µä»£ç åˆ†åˆ«æŒ‡å®šäº†è„šæœ¬åä¸º <code>hua</code>ï¼Œç„¶åæŒ‡å®šäº† <code>prefix</code> / <code>suffix</code> / <code>five-elements</code> å’Œ <code>count</code> å››ä¸ªå‚æ•°ï¼Œå¹¶æŠŠè§£æå¥½çš„å‚æ•°èµ‹å€¼ç»™ <code>opts</code> å˜é‡ã€‚</p><blockquote><p>ç”±äºæˆ‘å¸Œæœ›è¿™ä¸ªåŒ…åœ¨é€šå¸¸çš„ Node.js ä¸‹éƒ½å¯ä»¥è·‘ï¼Œæ‰€ä»¥æ²¡æœ‰ç”¨ <code>let</code> ä¹‹ç±»çš„ä¸œè¥¿ã€‚</p></blockquote><h3 id="èŠ±åç±»"><a href="#èŠ±åç±»" class="headerlink" title="èŠ±åç±»"></a>èŠ±åç±»</h3><p>æ¥ä¸‹å»è¦å†™ä¸€ä¸ªèŠ±åç±»ï¼Œè¿™ä¸ªç±»ä¸åªæ˜¯å¯ä»¥åœ¨ CLI ä¹‹ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è®©åˆ«äººä½œä¸ºä¸€ä¸ªåŒ…æ¥å¼•å…¥ã€‚ç„¶åå®é™…ä¸Šè¿™ä¸ªç±»å°±æ˜¯è¦å¯¹ <code>chinese-random-name</code> è¿›è¡Œä¸€ä¸ªå°è£…ã€‚</p><h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Hua = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.options = options;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do something...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿™ä¸ª <code>options</code> å°±æ˜¯ä¹‹å‰ç”± <code>nomnom</code> è§£æå‡ºæ¥çš„å‚æ•°ï¼Œå½“ç„¶æœ‰äº›å‚æ•°æ˜¯å¯é€‰çš„ã€‚</p><p>æ¥ä¸‹å»æˆ‘ä»¬è¦åœ¨æ„é€ å‡½æ•°ä¹Ÿå°±æ˜¯ <code>Hua</code> é‡Œé¢æ ¼å¼åŒ–å‰ç¼€æˆ–è€…åç¼€ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå°†ä»–ä»¬å¼„æˆåªæœ‰ä¸€ä¸ªæ±‰å­—çš„æ ¼å¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(options.prefix) &#123;</span><br><span class="line">    options.prefix = options.prefix[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span>(!isChinese(options.prefix)) <span class="keyword">delete</span> options.prefix;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(options.suffix) &#123;</span><br><span class="line">    options.suffix = options.suffix[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span>(!isChinese(options.suffix)) <span class="keyword">delete</span> options.suffix;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰åç¼€å¼„å¥½ä¹‹åè¦å¯¹äº”è¡Œè¿›è¡Œåˆ†æäº†ã€‚</p><p>å¦‚æœæœ‰å‰åç¼€é‚£ä¹ˆå¿½ç•¥äº”è¡Œå‚æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(options.prefix &amp;&amp; options.suffix) &#123;</span><br><span class="line">    <span class="keyword">delete</span> options[<span class="string">"file-elements"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰å‰ç¼€ï¼Œé‚£ä¹ˆå¿½ç•¥ä¼ è¿›æ¥çš„äº”è¡Œçš„ç¬¬ä¸€ä¸ªäº”è¡Œï¼›å¦‚æœæœ‰åç¼€é‚£ä¹ˆå¿½ç•¥ç¬¬äºŒä¸ªå­—çš„äº”è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> wuxing = <span class="string">"é‡‘æœ¨æ°´ç«åœŸ"</span>;</span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(options.prefix) &#123;</span><br><span class="line">    options[<span class="string">"five-elements"</span>] = options[<span class="string">"five-elements"</span>].substr(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">-1</span> === wuxing.indexOf(options[<span class="string">"five-elements"</span>])) &#123;</span><br><span class="line">        <span class="keyword">delete</span> options[<span class="string">"five-elements"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(options.suffix) &#123;</span><br><span class="line">    options[<span class="string">"five-elements"</span>] = options[<span class="string">"five-elements"</span>].substr(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">-1</span> === wuxing.indexOf(options[<span class="string">"five-elements"</span>])) &#123;</span><br><span class="line">        <span class="keyword">delete</span> options[<span class="string">"five-elements"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå‰åç¼€éƒ½æ²¡æœ‰ï¼Œé‚£ä¹ˆè¦æ ¼å¼åŒ–ä¸€ä¸‹è¯¥å‚æ•°ï¼Œä½¿å…¶ä»…å‰©ä¸¤ä¸ªæœ‰æ•ˆçš„äº”è¡Œæ±‰å­—ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    options[<span class="string">"five-elements"</span>] = options[<span class="string">"five-elements"</span>].substr(<span class="number">0</span>, <span class="number">2</span>).split(<span class="string">""</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; options[<span class="string">"five-elements"</span>].length; i++) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯æ— æ•ˆäº”è¡Œæˆ–è€…å†°æ²¡æœ‰è¿™ä¸ªå­—çš„è¯ï¼Œéšæœºä¸€ä¸ªäº”è¡Œå‡ºæ¥</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="number">-1</span> === wuxing.indexOf(options[<span class="string">"five-elements"</span>][i])) &#123;</span><br><span class="line">            options[<span class="string">"five-elements"</span>][i] = wuxing[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">5</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—æ•°ä¸å¤Ÿï¼Œéšæœºæ¥å‡‘</span></span><br><span class="line">    <span class="keyword">while</span>(options[<span class="string">"five-elements"</span>].length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        options[<span class="string">"five-elements"</span>].push(wuxing[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">5</span>)]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    options[<span class="string">"five-elements"</span>] = options[<span class="string">"five-elements"</span>].join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„è¿™äº›é€»è¾‘éƒ½å†™åœ¨æ„é€ å‡½æ•°é‡Œé¢ï¼Œå¦‚æœæƒ³è¦å®Œæ•´çš„æ„é€ å‡½æ•°å¯ä»¥çœ‹ <code>hua</code> çš„ <a href="https://github.com/BoogeeDoo/hua/blob/09f1bc7eae14faaa9e881392d3811a6073d94b1c/lib/hua.js#L14-L55" target="_blank" rel="external">hua.js</a> æ–‡ä»¶ã€‚</p><h4 id="ç”Ÿæˆä¸€ä¸ªèŠ±å"><a href="#ç”Ÿæˆä¸€ä¸ªèŠ±å" class="headerlink" title="ç”Ÿæˆä¸€ä¸ªèŠ±å"></a>ç”Ÿæˆä¸€ä¸ªèŠ±å</h4><p>ç”Ÿæˆä¸€ä¸ªèŠ±åå…¶å®å°±æ˜¯è°ƒç”¨ <code>randomName.names.get</code> ç³»åˆ—å‡½æ•°ä»¬äº†ã€‚</p><ul><li><strong>æœ‰å‰åç¼€ï¼š</strong>ç›´æ¥è¿”å›å‰ç¼€åŠ åç¼€ã€‚</li><li><strong>æœ‰å‰ç¼€ï¼š</strong>è¿”å›å‰ç¼€åŠ  <code>get1</code>ã€‚</li><li><strong>æœ‰åç¼€ï¼š</strong>è¿”å› <code>get1</code> åŠ åç¼€ã€‚</li><li><strong>æ²¡æœ‰å‰åç¼€ï¼š</strong>ç›´æ¥è¿”å› <code>get2</code>ã€‚</li></ul><blockquote><p><strong>æ³¨æ„ï¼š</strong>ä»¥ä¸Šæƒ…å†µéƒ½ä¼šä¼ è¿›ï¼ˆå“ªæ€•æ˜¯ <code>undefined</code>ï¼‰äº”è¡Œå‚æ•°ã€‚</p></blockquote><p>æ‰€ä»¥ <code>generateOne</code> å‡½æ•°é•¿<a href="https://github.com/BoogeeDoo/hua/blob/09f1bc7eae14faaa9e881392d3811a6073d94b1c/lib/hua.js#L67-L83" target="_blank" rel="external">è¿™æ ·</a>ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Hua.prototype.generateOne = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.options.prefix &amp;&amp; <span class="keyword">this</span>.options.suffix) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.options.prefix + <span class="keyword">this</span>.options.suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.options.prefix) &#123;</span><br><span class="line">        debug(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.options.prefix + randomName.names.get1(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.options.suffix) &#123;</span><br><span class="line">        debug(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]);</span><br><span class="line">        <span class="keyword">return</span> randomName.names.get1(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]) + <span class="keyword">this</span>.options.suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> randomName.names.get2(<span class="keyword">this</span>.options[<span class="string">"five-elements"</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆ-Count-ä¸ªèŠ±å"><a href="#ç”Ÿæˆ-Count-ä¸ªèŠ±å" class="headerlink" title="ç”Ÿæˆ Count ä¸ªèŠ±å"></a>ç”Ÿæˆ Count ä¸ªèŠ±å</h4><p>è¿˜è®°å¾— CLI çš„ <code>count</code> å‚æ•°ä¹ˆï¼Ÿå› ä¸ºä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¹é‡ç”ŸæˆèŠ±åï¼Œæ‰€ä»¥å°±éœ€è¦ç”Ÿæˆ Count ä¸ªèŠ±åçš„å‡½æ•°äº†ã€‚</p><p>å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¾ªç¯è°ƒç”¨ <code>generateOne</code> çš„å‡½æ•°è€Œå·²ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Hua.prototype.generate = <span class="function"><span class="keyword">function</span>(<span class="params">count</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!count) count = <span class="keyword">this</span>.options.count || <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        result.push(<span class="keyword">this</span>.generateOne());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="CLI-æ–‡ä»¶"><a href="#CLI-æ–‡ä»¶" class="headerlink" title="CLI æ–‡ä»¶"></a>CLI æ–‡ä»¶</h3><p>åˆšåˆšé‚£ä¸ª <code>nomnom</code> è§£æå°±åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œç„¶åæ¥ä¸‹å»å°±æ˜¯å®ä¾‹åŒ–ä¸€ä¸ª <code>Hua</code> å¯¹è±¡ï¼Œç„¶åç”Ÿæˆ <code>count</code> ä¸ªèŠ±åã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> hua = <span class="keyword">new</span> Hua(opts);</span><br><span class="line"><span class="keyword">var</span> result = hua.generate();</span><br></pre></td></tr></table></figure><p>æœ€åæŠŠèŠ±åè¾“å‡ºæ¥å°±å¥½äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">" * "</span> + result[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¡¥è±†éº»è¢‹ï¼"><a href="#æ¡¥è±†éº»è¢‹ï¼" class="headerlink" title="æ¡¥è±†éº»è¢‹ï¼"></a>æ¡¥è±†éº»è¢‹ï¼</h4><blockquote><p>è¯´å¥½çš„äº”è¡Œé¢œè‰²å‘¢ï¼Ÿï¼</p></blockquote><p>å¥½åƒæ˜¯çš„å“¦ï¼Œæˆ‘ä»¬è¦åœ¨è¾“å‡ºä¹‹å‰ç»™ <code>result</code> ä¸Šä¸ªè‰²å„¿ã€‚</p><p>éå† <code>result</code> é‡Œé¢çš„èŠ±åæ¯ä¸ªå­—ï¼Œè·å–å®ƒçš„äº”è¡Œå±æ€§ï¼Œç„¶åæ¶®ä¸Šè‰²å„¿ã€‚</p><p><code>chinese-random-name</code> æš´éœ²äº†å­—å…¸ä¸­æ¯ä¸ªå­—çš„äº”è¡Œå±æ€§ï¼Œåªéœ€è¦èµ‹å€¼ä¸€ä¸‹å°±å¥½äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> dict = <span class="built_in">require</span>(<span class="string">"chinese-random-name"</span>).names.dict;</span><br></pre></td></tr></table></figure><p>ç„¶åé€ä¸€å¯¹æ¯”ã€‚æœ€åå¯¹åº”é‡‘æœ¨æ°´ç«åœŸçš„é¢œè‰²å€¼åˆ†åˆ«ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> definedColors = [</span><br><span class="line">    <span class="number">220</span>, <span class="number">83</span>, <span class="number">26</span>, <span class="number">197</span>, <span class="number">59</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><blockquote><p>220 ä¸ºé»„è‰²ï¼Œä»£è¡¨é‡‘ï¼›83 ä¸ºç»¿è‰²ï¼Œä»£è¡¨æœ¨ï¼›26 è“è‰²ä»£è¡¨æ°´ï¼›197 çº¢è‰²ä»£è¡¨ç«ï¼›59 ç°è‰²ä»£è¡¨åœŸã€‚</p><p>å¦‚æœé‚£ä¸ªå­—æ— æ³•æ‰¾åˆ°å±æ€§ï¼Œåˆ™ä¸ä¸Šè‰²ï¼Œä¿æŒé»˜è®¤ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">result = result.map(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> withColor = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; wuxing.length; j++) &#123;</span><br><span class="line">            <span class="keyword">var</span> wx = wuxing[j];</span><br><span class="line">            <span class="keyword">if</span>(wx === <span class="string">" "</span>) &#123;</span><br><span class="line">                withColor += name[i];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(dict[wx].indexOf(name[i]) !== <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> color = <span class="keyword">new</span> Color(name[i]);</span><br><span class="line">                color.fgcolor = definedColors[j];</span><br><span class="line">                withColor += color.toString();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> withColor;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è‡³æ­¤æˆ‘ä»¬çš„ CLI å°±å†™å¥½äº†ï¼Œæœ€ååˆ«å¿˜äº†åœ¨ <a href="https://github.com/BoogeeDoo/hua/blob/09f1bc7eae14faaa9e881392d3811a6073d94b1c/bin/hua" target="_blank" rel="external">hua</a> è¿™ä¸ª CLI æ–‡ä»¶é¡¶éƒ¨åŠ ä¸Šä¸€å¥è¯ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env node</span></span><br></pre></td></tr></table></figure><p>è¿™ä»£è¡¨åˆ°æ—¶å€™å¦‚æœè¦ <code>./hua</code> çš„æ—¶å€™è¿™ä¸ªè„šæœ¬æ˜¯ç”¨ Node.js æ¥è·‘çš„ã€‚</p><h2 id="æ”¶æ‹¾"><a href="#æ”¶æ‹¾" class="headerlink" title="æ”¶æ‹¾"></a>æ”¶æ‹¾</h2><p>æœ¬æ¥æƒ³å¥½å¥½å†™ç¯‡èµ·èŠ±åçš„ç‰¢éªšï¼Œç»“æœä¸çŸ¥ä¸è§‰å†™æˆäº†ç»™åˆå¿ƒè€…çœ‹çš„åˆçº§æ•™ç¨‹äº†ï¼Œæ³ªç›® ( â€¢Ì¥Ì Ë â€¢Ì€à¥‚ )</p><p>ä¸å«Œå¼ƒçš„å°±è¿™ä¹ˆçœ‹çœ‹å§ã€‚</p><p>æœ€åè¿™é‡Œç»™å‡ºæˆ‘å†™å¥½çš„è¿™ä¸ª <code>hua</code> ç¨‹åºã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ [sudo] npm install -g huaming</span><br></pre></td></tr></table></figure><p>ç„¶åå°±èƒ½åœ¨å‘½ä»¤è¡Œä¸‹é¢è·‘äº†ï¼Œè·‘æ³•ä¸Šé¢å‡ ç« æœ‰ä»‹ç»è¿‡ã€‚å®ƒçš„ Repo åœ¨<a href="https://github.com/BoogeeDoo/hua" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p><p>æœ€åå¸Œæœ›è¿™ä¸ªåŒ…åœ¨ä½ ä»¬èµ·èŠ±åçš„æ—¶å€™è¿˜çœŸæœ‰é‚£ä¹ˆä¸€ä¸¢ä¸¢çš„ç”¨å¤„ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h2&gt;&lt;p&gt;èµ·å› æ˜¯æˆ‘ä¸€ä¸ªå«ã€å°é¾™ã€çš„å¥½åŸºå‹ç”±äºæŸäº›åŸå› ç¦»èŒå»äº†ä¸€å®¶è·Ÿé˜¿é‡Œä¸€æ ·æœ‰ç€ã€èŠ±åæ–‡åŒ–ã€çš„å…¬å¸ï¼Œäºæ˜¯å¼€å§‹ä¸ºèŠ±åçŠ¯æ„ã€‚&lt;/p&gt;
&lt;p&gt;ç»“åˆä¹‹å‰å¦¹çº¸ã€å¼
      
    
    </summary>
    
    
      <category term="é˜¿é‡Œå·´å·´" scheme="https://xcoder.in/tags/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4/"/>
    
      <category term="èŠ±å" scheme="https://xcoder.in/tags/%E8%8A%B1%E5%90%8D/"/>
    
  </entry>
  
  <entry>
    <title>Node.js å¯åŠ¨æ–¹å¼ï¼šä¸€é“å…³äºå…¨å±€å˜é‡çš„é¢˜ç›®å¼•å‘çš„æ€è€ƒÂ·ç»­</title>
    <link href="https://xcoder.in/2015/11/27/a-js-problem-about-global-continued/"/>
    <id>https://xcoder.in/2015/11/27/a-js-problem-about-global-continued/</id>
    <published>2015-11-27T06:36:27.000Z</published>
    <updated>2017-12-11T07:59:20.458Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯ä¸Šæ–‡ã€Š<a href="https://xcoder.in/2015/11/26/a-js-problem-about-global/">Node.js å¯åŠ¨æ–¹å¼ï¼šä¸€é“å…³äºå…¨å±€å˜é‡çš„é¢˜ç›®å¼•å‘çš„æ€è€ƒ</a>ã€‹çš„ç»­ç« ã€‚</p><h2 id="åŸé¢˜å›é¡¾"><a href="#åŸé¢˜å›é¡¾" class="headerlink" title="åŸé¢˜å›é¡¾"></a>åŸé¢˜å›é¡¾</h2><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆå›é¡¾ä¸‹åŸé¢˜å§ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢˜ç”±æˆ‘ä»¬äº²çˆ±çš„<a href="http://f2e.souche.com/blog/author/wang-xing-long/" target="_blank" rel="external">å°é¾™</a>ç«¥é‹å‘ç°å¹¶åœ¨æˆ‘ä»¬çš„ 901 ç¾¤é‡Œæé—®çš„ã€‚</p></blockquote><p>ä¸è¿‡åœ¨ä¸Šé¢ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²çš„æ˜¯åœ¨ REPL å’Œ <code>vm</code> ä¸­æœ‰ä»€ä¹ˆäº‹æƒ…ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è§£é‡Šä¸ºä»€ä¹ˆåœ¨æ–‡ä»¶æ¨¡å—çš„è½½å…¥å½¢å¼ä¸‹ï¼Œ<code>var</code> å¹¶ä¸ä¼šæŒ‚è½½åˆ°å…¨å±€å˜é‡å»ã€‚</p><p>å…¶å®åŸå› å¾ˆç®€å•ï¼Œå¤§å®¶åº”è¯¥ä¹Ÿéƒ½æ˜ç™½ï¼Œåœ¨ Node.js ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶ç›¸å½“äºæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œåœ¨ <code>require</code> çš„æ—¶å€™è¢«ç¼–è¯‘åŒ…äº†èµ·æ¥ã€‚</p><p>ä½†æ˜¯å…·ä½“æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿè™½ç„¶ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šç­”æ¡ˆï¼Œæˆ‘è¿˜æ˜¯å†³å®šåœ¨è¿™é‡ŒæŒ‰ä¸Šä¸€ç¯‡æ–‡ç« çš„å°¿æ€§ç¨å¾®è§£é‡Šä¸€ä¸‹ã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯å›åˆ°ä¸Šä¸€ç¯‡æ–‡ç« çš„ã€ŠNode REPL å¯åŠ¨çš„æ²™ç®±ã€‹ä¸€èŠ‚ï¼Œé‡Œé¢è¯´äº†å½“å¯åŠ¨ Node.js çš„æ—¶å€™æ˜¯ä»¥ <a href="https://github.com/nodejs/node/blob/dfee4e3712ac4673b5fc472a8f77ac65bdc65f87/src/node.js" target="_blank" rel="external">src/node.js</a> ä¸ºå…¥å£çš„ã€‚</p><p>å¦‚æœä»¥ REPL ä¸ºé€”å¾„å¯åŠ¨çš„è¯æ˜¯ç›´æ¥å¯åŠ¨ä¸€ä¸ª <code>vm</code>ï¼Œè€Œæ­¤æ—¶çš„æ‰€æœ‰æ ¹çº§å˜é‡éƒ½åœ¨æœ€é¡¶çº§çš„ä½œç”¨åŸŸä¸‹ï¼Œæ‰€ä»¥ä¸€ä¸ª <code>var</code> è‡ªç„¶ä¼šç»‘å®šåˆ° <code>global</code> ä¸‹é¢äº†ã€‚</p><p>è€Œå¦‚æœæ˜¯ä»¥æ–‡ä»¶ï¼Œå³ <code>$ node foo.js</code> å½¢å¼å¯åŠ¨çš„è¯ï¼Œå®ƒå°±ä¼šæ‰§è¡Œ src/node.js é‡Œé¢çš„å¦ä¸€å¨æ¡ä»¶åˆ†æ”¯äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.argv[<span class="number">1</span>]) &#123;</span><br><span class="line">  <span class="comment">// make process.argv[1] into a full path</span></span><br><span class="line">  <span class="keyword">var</span> path = NativeModule.require(<span class="string">'path'</span>);</span><br><span class="line">  process.argv[<span class="number">1</span>] = path.resolve(process.argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Module = NativeModule.require(<span class="string">'module'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  startup.preloadModules();</span><br><span class="line">  <span class="keyword">if</span> (global.v8debug &amp;&amp;</span><br><span class="line">      process.execArgv.some(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arg.match(<span class="regexp">/^--debug-brk(=[0-9]*)?$/</span>);</span><br><span class="line">      &#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> debugTimeout = +process.env.NODE_DEBUG_TIMEOUT || <span class="number">50</span>;</span><br><span class="line">    setTimeout(Module.runMain, debugTimeout);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Main entry point into most programs:</span></span><br><span class="line">    Module.runMain();</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä»£ç çœ‹å‡ºï¼Œåªè¦æ˜¯ä»¥ <code>$ node foo.js</code> å½¢å¼å¯åŠ¨çš„ï¼Œéƒ½ä¼šç»å† <code>startup.preloadModules()</code> å’Œ <code>Module.runMain()</code> ä¸¤ä¸ªå‡½æ•°ã€‚</p><h3 id="startup-preloadModules"><a href="#startup-preloadModules" class="headerlink" title="startup.preloadModules()"></a>startup.preloadModules()</h3><p>æˆ‘ä»¬æ¥çœ‹çœ‹<a href="https://github.com/nodejs/node/blob/dfee4e3712ac4673b5fc472a8f77ac65bdc65f87/src/node.js#L870" target="_blank" rel="external">è¿™ä¸ªå‡½æ•°</a>ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">startup.preloadModules = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (process._preload_modules) &#123;</span><br><span class="line">    NativeModule.require(<span class="string">'module'</span>)._preloadModules(process._preload_modules);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œçš„ lib/module.js é‡Œé¢çš„ <code>_preloadModules</code> å‡½æ•°ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ª <code>process._preload_modules</code> ç»™ä¼ è¿›å»ã€‚å½“ç„¶ï¼Œå‰ææ˜¯æœ‰è¿™ä¸ª <code>process._preload_modules</code>ã€‚</p><h4 id="process-preload-modules"><a href="#process-preload-modules" class="headerlink" title="process._preload_modules"></a>process._preload_modules</h4><p>è¿™ä¸ª <code>process._preload_modules</code> æŒ‡çš„å°±æ˜¯å½“ä½ åœ¨ä½¿ç”¨ Node.js çš„æ—¶å€™ï¼Œå‘½ä»¤è¡Œé‡Œé¢çš„ <code>--require</code> å‚æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-r, --require         module to preload (option can be repeated)</span><br></pre></td></tr></table></figure><p>ä»£ç åœ¨ <a href="https://github.com/nodejs/node/blob/master/src/node.cc#L3306" target="_blank" rel="external">src/node.cc</a> é‡Œé¢å¯è€ƒã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arg, <span class="string">"--require"</span>) == <span class="number">0</span> ||</span><br><span class="line">           <span class="built_in">strcmp</span>(arg, <span class="string">"-r"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">module</span> = argv[index + <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">module</span> == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%s: %s requires an argument\n"</span>, argv[<span class="number">0</span>], arg);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  args_consumed += <span class="number">1</span>;</span><br><span class="line">  local_preload_modules[preload_module_count++] = <span class="keyword">module</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>å¦‚æœé‡åˆ°äº† <code>--require</code> è¿™ä¸ªå‚æ•°ï¼Œåˆ™å¯¹é™æ€å˜é‡ <code>local_preload_modules</code> å’Œ <code>preload_module_count</code> åšå¤„ç†ï¼ŒæŠŠè¿™ä¸ªé¢„åŠ è½½æ¨¡å—è·¯å¾„åŠ è¿›å»ã€‚</p><p>å¾…åˆ°<a href="https://github.com/nodejs/node/blob/master/src/node.cc#L2933" target="_blank" rel="external">è¦ç”Ÿæˆ <code>process</code> è¿™ä¸ªå˜é‡çš„æ—¶å€™</a>ï¼Œå†æŠŠé¢„åŠ è½½æ¨¡å—çš„ä¿¡æ¯æ”¾åˆ° <code>process._preload_modules</code> é‡Œé¢å»ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetupProcessObject</span><span class="params">(Environment* env,</span><br><span class="line">                        <span class="keyword">int</span> argc,</span><br><span class="line">                        <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span>* argv,</span><br><span class="line">                        <span class="keyword">int</span> exec_argc,</span><br><span class="line">                        <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span>* exec_argv)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (preload_module_count) &#123;</span><br><span class="line">    CHECK(preload_modules);</span><br><span class="line">    Local&lt;Array&gt; <span class="built_in">array</span> = Array::New(env-&gt;isolate());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; preload_module_count; ++i) &#123;</span><br><span class="line">      Local&lt;String&gt; <span class="keyword">module</span> = String::NewFromUtf8(env-&gt;isolate(),</span><br><span class="line">                                                 preload_modules[i]);</span><br><span class="line">      <span class="built_in">array</span>-&gt;Set(i, <span class="keyword">module</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    READONLY_PROPERTY(process,</span><br><span class="line">                      <span class="string">"_preload_modules"</span>,</span><br><span class="line">                      <span class="built_in">array</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span>[] preload_modules;</span><br><span class="line">    preload_modules = <span class="literal">nullptr</span>;</span><br><span class="line">    preload_module_count = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€é‡è¦çš„å°±æ˜¯è¿™å¥</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">READONLY_PROPERTY(process,</span><br><span class="line">                  <span class="string">"_preload_modules"</span>,</span><br><span class="line">                  <span class="built_in">array</span>);</span><br></pre></td></tr></table></figure><h4 id="require-â€˜moduleâ€™-preloadModules"><a href="#require-â€˜moduleâ€™-preloadModules" class="headerlink" title="require(â€˜moduleâ€™)._preloadModules"></a>require(â€˜moduleâ€™)._preloadModules</h4><p>ä¸Šé¢æˆ‘ä»¬è®²äº†è¿™ä¸ª <code>process._preload_modules</code>ï¼Œç„¶åç°åœ¨æˆ‘ä»¬è¯´è¯´æ˜¯å¦‚ä½•æŠŠ <code>$ node --require bar.js foo.js</code> ç»™é¢„åŠ è½½è¿›å»çš„ã€‚</p><p>æ¥ä¸‹å»æˆ‘ä»¬å°±è¦ç§»æ­¥åˆ° lib/module.js æ–‡ä»¶é‡Œé¢å»äº†ã€‚</p><p>åœ¨<a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L496" target="_blank" rel="external">ç¬¬ 496 è¡Œå·¦å³</a>çš„åœ°æ–¹æœ‰è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Module._preloadModules = <span class="function"><span class="keyword">function</span>(<span class="params">requests</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(requests))</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Preloaded modules have a dummy parent module which is deemed to exist</span></span><br><span class="line">  <span class="comment">// in the current working directory. This seeds the search path for</span></span><br><span class="line">  <span class="comment">// preloaded modules.</span></span><br><span class="line">  <span class="keyword">var</span> parent = <span class="keyword">new</span> Module(<span class="string">'internal/preload'</span>, <span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    parent.paths = Module._nodeModulePaths(process.cwd());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.code !== <span class="string">'ENOENT'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  requests.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">    parent.require(request);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œå°±æ˜¯ä»¥ <code>internal/preload</code> ä¸º ID çš„ Module å¯¹è±¡æ¥è½½å…¥è¿™äº›é¢„åŠ è½½æ¨¡å—ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> parent = <span class="keyword">new</span> Module(<span class="string">'internal/preload'</span>, <span class="literal">null</span>);</span><br><span class="line">requests.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">  parent.require(request);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ ¹æ®è¿™ä¸ªå‡½æ•°çš„æ³¨é‡Šè¯´æ˜ï¼Œè¿™ä¸ª Module å¯¹è±¡æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ Module å¯¹è±¡ï¼Œä¸»è¦æ˜¯è·Ÿéé¢„åŠ è½½çš„é‚£äº›æ¨¡å—ç»™éš”ç¦»æˆ–è€…åŒºåˆ«å¼€æ¥ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªæ¨¡å—æœç´¢è·¯å¾„ã€‚</p><h3 id="Module-runMain"><a href="#Module-runMain" class="headerlink" title="Module.runMain()"></a>Module.runMain()</h3><p>çœ‹å®Œä¸Šé¢çš„è¯´æ˜ï¼Œæˆ‘ä»¬æ¥ä¸‹å»çœ‹çœ‹ <code>Module.runMain()</code> å‡½æ•°ã€‚</p><p>è¿™ä¸ªå‡½æ•°è¿˜æ˜¯ä½äº <a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L455" target="_blank" rel="external">lib/module.js</a>  æ–‡ä»¶é‡Œé¢ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Module.runMain = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Load the main module--the command line argument.</span></span><br><span class="line">  Module._load(process.argv[<span class="number">1</span>], <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">  <span class="comment">// Handle any nextTicks added in the first tick of the program</span></span><br><span class="line">  process._tickCallback();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°äº†å°±æ˜¯åœ¨è¿™å¥è¯ä¸­ï¼ŒModule è½½å…¥äº† <code>process.argv[1]</code> ä¹Ÿå°±æ˜¯æ–‡ä»¶åï¼Œè‡ªæ­¤ä¸€å‘ä¸å¯æ”¶æ‹¾ã€‚</p><h4 id="Module-load"><a href="#Module-load" class="headerlink" title="Module._load"></a>Module._load</h4><p>è¿™ä¸ªå‡½æ•°ç›¸ä¿¡å¾ˆå¤šäººéƒ½çŸ¥é“å®ƒçš„ç”¨å¤„äº†ï¼Œæ— éå°±æ˜¯è½½å…¥æ–‡ä»¶ï¼Œå¹¶åŠ è½½åˆ°ä¸€ä¸ªé—­åŒ…é‡Œé¢ã€‚</p><p>è¿™æ ·ä¸€æ¥åœ¨æ–‡ä»¶é‡Œé¢ <code>var</code> å‡ºæ¥çš„å˜é‡å°±ä¸åœ¨æ ¹ä½œç”¨åŸŸä¸‹é¢äº†ï¼Œæ‰€ä»¥ä¸ä¼šç²˜åˆ° <code>global</code> é‡Œé¢å»ã€‚å®ƒçš„ <code>this</code> å°±æ˜¯åŒ…èµ·æ¥çš„è¿™ä¸ªé—­åŒ…äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Module._load = <span class="function"><span class="keyword">function</span>(<span class="params">request, parent, isMain</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> filename = Module._resolveFilename(request, parent);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">var</span> cachedModule = Module._cache[filename];</span><br><span class="line">  <span class="keyword">if</span> (cachedModule) &#123;</span><br><span class="line">    <span class="keyword">return</span> cachedModule.exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (NativeModule.nonInternalExists(filename)) &#123;</span><br><span class="line">    debug(<span class="string">'load native module %s'</span>, request);</span><br><span class="line">    <span class="keyword">return</span> NativeModule.require(filename);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">module</span> = <span class="keyword">new</span> Module(filename, parent);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isMain) &#123;</span><br><span class="line">    process.mainModule = <span class="built_in">module</span>;</span><br><span class="line">    <span class="built_in">module</span>.id = <span class="string">'.'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Module._cache[filename] = <span class="built_in">module</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>.load(filename);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç é¦–å…ˆæ˜¯æ ¹æ®ä¼ å…¥çš„æ–‡ä»¶åæ‰¾åˆ°çœŸçš„æ–‡ä»¶åœ°å€ï¼Œå°±æ˜¯æ‰€è°“çš„æœç´¢è·¯å¾„äº†ã€‚æ¯”å¦‚ <code>require(&quot;foo&quot;)</code> å°±ä¼šåˆ†åˆ«ä» <code>node_modules</code> è·¯å¾„ç­‰ä¾æ¬¡æŸ¥æ‰¾ä¸‹æ¥ã€‚</p><p>æˆ‘ç»å¸¸ Hack è¿™ä¸ª <code>_resolveFilename</code> å‡½æ•°æ¥ç®€åŒ– <code>require</code> å‡½æ•°ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ›æˆ‘ç”¨ <code>require(&quot;controller/foo&quot;)</code> å°±èƒ½ç›´æ¥æ‹¿åˆ° ./src/controller/foo.js æ–‡ä»¶ã€‚æœ‰å…´è¶£è®¨è®ºä¸€ä¸‹è¿™ä¸ªç”¨æ³•çš„ç«¥é‹å¯ä»¥è½¬åˆ°æˆ‘çš„ <a href="https://gist.github.com/XadillaX/bc0e7c92925de0647477" target="_blank" rel="external">Gist</a> ä¸ŠæŸ¥çœ‹ Hack çš„ä¸€ä¸ª Demoã€‚</p><p>ç¬¬äºŒæ­¥å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç¼“å­˜äº†ã€‚å¦‚æœè¿™ä¸ªæ¨¡å—ä¹‹å‰åŠ è½½è¿‡ï¼Œé‚£ä¹ˆåœ¨ <code>Module._cache</code> ä¸‹é¢ä¼šæœ‰ä¸ªç¼“å­˜ï¼Œç›´æ¥å»å–å°±æ˜¯äº†ã€‚</p><p>ç¬¬ä¸‰æ­¥å°±æ˜¯çœ‹çœ‹æ˜¯ä¸æ˜¯ <code>NativeModule</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (NativeModule.nonInternalExists(filename)) &#123;</span><br><span class="line">  debug(<span class="string">'load native module %s'</span>, request);</span><br><span class="line">  <span class="keyword">return</span> NativeModule.require(filename);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="NativeModule"><a href="#NativeModule" class="headerlink" title="NativeModule"></a>NativeModule</h5><p>ä¹‹å‰çš„ä»£ç é‡Œé¢å…¶å®ä¹Ÿæ²¡å°‘å‡ºç°è¿™ä¸ª <code>NativeModule</code>ã€‚é‚£è¿™ä¸ª <code>NativeModule</code> åˆ°åº•æ˜¯ä¸ª shenmegui å‘¢ï¼Ÿ</p><p>å…¶å®å®ƒè¿˜æ˜¯åœ¨ Node.js çš„å…¥å£ <a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/src/node.js#L886" target="_blank" rel="external">src/node.js</a> é‡Œé¢ã€‚</p><p>å®ƒä¸»è¦ç”¨æ¥åŠ è½½ Node.js çš„ä¸€äº›åŸç”Ÿæ¨¡å—ï¼Œæ¯”å¦‚è¯´ <code>NativeModule.require(&quot;child_process&quot;)</code> ç­‰ï¼Œä¹Ÿç”¨äºä¸€äº› <code>internal</code> æ¨¡å—çš„è½½å…¥ï¼Œæ¯”å¦‚ <code>NativeModule.require(&quot;internal/repl&quot;)</code>ã€‚</p><p>ä¹‹å‰ä»£ç çš„è¿™ä¸ªåˆ¤æ–­å°±æ˜¯è¯´å¦‚æœåˆ¤æ–­è¦è½½å…¥çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªåŸç”Ÿæ¨¡å—ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ <code>NativeModule.require</code> æ¥è½½å…¥ã€‚</p><h6 id="NativeModule-require"><a href="#NativeModule-require" class="headerlink" title="NativeModule.require"></a>NativeModule.require</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">NativeModule.require = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (id == <span class="string">'native_module'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> NativeModule;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cached = NativeModule.getCached(id);</span><br><span class="line">  <span class="keyword">if</span> (cached) &#123;</span><br><span class="line">    <span class="keyword">return</span> cached.exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!NativeModule.exists(id)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'No such native module '</span> + id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  process.moduleLoadList.push(<span class="string">'NativeModule '</span> + id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> nativeModule = <span class="keyword">new</span> NativeModule(id);</span><br><span class="line"></span><br><span class="line">  nativeModule.cache();</span><br><span class="line">  nativeModule.compile();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> nativeModule.exports;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹çœ‹æ˜¯å¦æ˜¯æœ¬èº«ï¼Œå†çœ‹çœ‹æ˜¯å¦è¢«ç¼“å­˜ï¼Œç„¶åçœ‹çœ‹æ˜¯å¦åˆæ³•ã€‚æ¥ä¸‹å»å°±æ˜¯å¡«å…… <code>process.moduleLoadList</code>ï¼Œæœ€åè½½å…¥è¿™ä¸ªåŸç”Ÿæ¨¡å—ã€ç¼“å­˜ã€ç¼–è¯‘å¹¶è¿”å›ã€‚</p><blockquote><p>æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åœ¨ Node.js ä¸­è¾“å‡º <code>process.moduleLoadList</code> çœ‹çœ‹ã€‚</p></blockquote><p>è¿™ä¸ª <code>compile</code> å¾ˆé‡è¦ã€‚</p><h6 id="NativeModule-prototype-compile"><a href="#NativeModule-prototype-compile" class="headerlink" title="NativeModule.prototype.compile"></a>NativeModule.prototype.compile</h6><p>åœ¨ <code>NativeModule</code> ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå¤§æ¦‚çš„æ­¥éª¤æ˜¯è·å–ä»£ç ã€åŒ…è£¹ï¼ˆWrapï¼‰ä»£ç ï¼ŒæŠŠåŒ…è£¹çš„ä»£ç  <code>runInContext</code> ä¸€éå¾—åˆ°åŒ…è£¹å¥½çš„å‡½æ•°ï¼Œç„¶åæ‰§è¡Œä¸€éå°±ç®—è½½å…¥å¥½äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">NativeModule.prototype.compile = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> source = NativeModule.getSource(<span class="keyword">this</span>.id);</span><br><span class="line">  source = NativeModule.wrap(source);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fn = runInThisContext(source, &#123; <span class="attr">filename</span>: <span class="keyword">this</span>.filename &#125;);</span><br><span class="line">  fn(<span class="keyword">this</span>.exports, NativeModule.require, <span class="keyword">this</span>, <span class="keyword">this</span>.filename);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.loaded = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¾€è¿™ä¸ª src/node.js æ–‡ä»¶è¿™ä¸ªå‡½æ•°çš„ä¸Šé¢å‡ è¡Œçœ‹ä¸€ä¸‹ï¼Œå°±çŸ¥é“åŒ…è£¹ä»£ç æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">NativeModule.wrap = <span class="function"><span class="keyword">function</span>(<span class="params">script</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> NativeModule.wrapper[<span class="number">0</span>] + script + NativeModule.wrapper[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">NativeModule.wrapper = [</span><br><span class="line">  <span class="string">'(function (exports, require, module, __filename, __dirname) &#123;\n'</span>,</span><br><span class="line">  <span class="string">'\n&#125;);'</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬èƒ½çŸ¥é“çš„å°±æ˜¯æ¯”å¦‚æˆ‘ä»¬ä¸€ä¸ªå†…ç½®æ¨¡å—çš„ä»£ç æ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="built_in">require</span>(<span class="string">"foo"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåŒ…è£¹å¥½çš„ä»£ç å°†ä¼šæ˜¯è¿™æ ·å­çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="built_in">require</span>(<span class="string">"foo"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€çœ‹å°±æ˜ç™½äº†è¿™äº› <code>require</code>ã€<code>module</code>ã€<code>exports</code>ã€<code>__filename</code> å’Œ <code>__dirname</code> æ˜¯æ€ä¹ˆæ¥äº†å§ã€‚</p><p>å½“æˆ‘ä»¬é€šè¿‡ <code>var fn = runInThisContext(source, { filename: this.filename });</code> å¾—åˆ°äº†è¿™ä¸ªåŒ…è£¹å¥½çš„å‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬å°±æŠŠç›¸åº”çš„å‚æ•°ä¼ è¿›è¿™ä¸ªé—­åŒ…å‡½æ•°å»æ‰§è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fn(<span class="keyword">this</span>.exports, NativeModule.require, <span class="keyword">this</span>, <span class="keyword">this</span>.filename);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª <code>this</code> å°±æ˜¯å¯¹åº”çš„è¿™ä¸ª <code>module</code>ï¼Œè‡ªç„¶è¿™ä¸ª <code>module</code> é‡Œé¢å°±æœ‰å®ƒçš„ <code>exports</code>ï¼›<code>require</code> å‡½æ•°å°±æ˜¯ <code>NativeModule.require</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°çš„åœ¨ <code>lib/*.js</code> æ–‡ä»¶é‡Œé¢çš„é‚£äº› <code>require</code> å‡½æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯åŒ…è£¹å¥½ä¹‹åçš„ä»£ç çš„ <code>NativeModule.require</code> äº†ã€‚</p><p>æ‰€ä»¥è¯´å®é™…ä¸Šè¿™äº›å†…ç½®æ¨¡å—å†…éƒ¨çš„æ ¹ä½œç”¨åŸŸä¸‹çš„ <code>var</code> å†æ€ä¹ˆæ ·é«˜çº§ä¹Ÿéƒ½æ˜¯åœ¨åŒ…è£¹å¥½çš„é—­åŒ…é‡Œé¢ <code>var</code>ï¼Œæ€ä¹ˆçš„ä¹Ÿè·Ÿ <code>global</code> æ­ä¸ç€è¾¹ã€‚</p><h6 id="å†…éƒ¨åŸç”Ÿæ¨¡å—"><a href="#å†…éƒ¨åŸç”Ÿæ¨¡å—" class="headerlink" title="å†…éƒ¨åŸç”Ÿæ¨¡å—"></a>å†…éƒ¨åŸç”Ÿæ¨¡å—</h6><p>é€šè¿‡ä¸Šé¢çš„è¿½æº¯æˆ‘ä»¬çŸ¥é“äº†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä»£ç é‡Œé¢ä½¿ç”¨ <code>require</code> çš„è¯ï¼Œä¼šå…ˆçœ‹çœ‹è¿™ä¸ªæ¨¡å—æ˜¯ä¸æ˜¯åŸç”Ÿæ¨¡å—ã€‚</p><p>ä¸è¿‡å›è¿‡å¤´çœ‹ä¸€ä¸‹å®ƒçš„è¿™ä¸ªåˆ¤æ–­æ¡ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (NativeModule.nonInternalExists(filename)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ˜¯åŸç”Ÿæ¨¡å—å¹¶ä¸”ä¸æ˜¯åŸç”Ÿå†…éƒ¨æ¨¡å—çš„è¯ã€‚</p></blockquote><p>é‚£æ˜¯æ€ä¹ˆåŒºåˆ†åŸç”Ÿæ¨¡å—å’Œå†…éƒ¨åŸç”Ÿæ¨¡å—å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ª <code>NativeModule.nonInternalExists(filename)</code> å‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">NativeModule.nonInternalExists = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> NativeModule.exists(id) &amp;&amp; !NativeModule.isInternal(id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">NativeModule.isInternal = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> id.startsWith(<span class="string">'internal/'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„ä»£ç æ˜¯å»é™¤å„ç§æ‚ä¸ƒæ‚å…«çš„æ¡ä»¶ä¹‹åçš„ä¸€ç§æƒ…å†µï¼Œåˆ«çš„æƒ…å†µè¿˜è¯·å„ä½ç«¥é‹è‡ªè¡Œçœ‹ Node.js æºç ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨æˆ‘ä»¬è‡ªå·±çš„ä»£ç é‡Œé¢æ˜¯è¯·æ±‚ä¸åˆ° Node.js æºç é‡Œé¢ <code>lib/internal/*.js</code> è¿™äº›æ–‡ä»¶çš„â€”â€”å› ä¸ºå®ƒä»¬è¢«ä¸Šé¢çš„è¿™ä¸ªæ¡ä»¶åˆ†æ”¯ç»™è¿‡æ»¤äº†ã€‚ï¼ˆæ¯”å¦‚ <code>require(&quot;internal/module&quot;)</code> åœ¨è‡ªå·±çš„ä»£ç é‡Œé¢æ˜¯æ— æ³•è¿è¡Œçš„ï¼‰</p><blockquote><p><strong>æ³¨æ„ï¼š</strong> ä¸è¿‡æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œé‚£å°±æ˜¯ <code>require(&quot;internal/repl&quot;)</code>ã€‚è¯¦æƒ…å¯ä»¥å‚è€ƒè¿™ä¸ª <a href="https://github.com/nodejs/node/issues/3393" target="_blank" rel="external">Issue</a> å’Œ<a href="https://github.com/nodejs/node/blob/9148114c93861359a502801499d4c26d0b761174/lib/module.js#L276-L277" target="_blank" rel="external">è¿™æ®µä»£ç </a>ã€‚</p></blockquote><h5 id="Module-prototype-load"><a href="#Module-prototype-load" class="headerlink" title="Module.prototype.load"></a>Module.prototype.load</h5><p>è§£é‡Šå®Œäº†ä¸Šé¢çš„ <code>NativeModule</code> ä¹‹åï¼Œæˆ‘ä»¬è¦å°±ä¸Šé¢ <code>Module._load</code> é‡Œé¢çš„ä¸‹ä¸€æ­¥ <code>module.load</code> ä¹Ÿå°±æ˜¯ <code>Module.prototype.load</code> åšè§£æäº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Module.prototype.load = <span class="function"><span class="keyword">function</span>(<span class="params">filename</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> extension = path.extname(filename) || <span class="string">'.js'</span>;</span><br><span class="line">  <span class="keyword">if</span> (!Module._extensions[extension]) extension = <span class="string">'.js'</span>;</span><br><span class="line">  Module._extensions[extension](<span class="keyword">this</span>, filename);</span><br><span class="line">  <span class="keyword">this</span>.loaded = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åšäº†ä¸€ç³»åˆ—æ“ä½œä¹‹åå¾—åˆ°äº†çœŸÂ·æ–‡ä»¶åï¼Œç„¶ååˆ¤æ–­ä¸€ä¸‹åç¼€ã€‚å¦‚æœæ˜¯ <code>&quot;.js&quot;</code> çš„è¯æ‰§è¡Œ <code>Module._extensions[&quot;.js&quot;]</code> è¿™ä¸ªå‡½æ•°å»ç¼–è¯‘ä»£ç ï¼Œå¦‚æœæ˜¯ <code>&quot;.json&quot;</code> åˆ™æ˜¯ <code>Module._extensions[&quot;.json&quot;]</code>ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç•¥è¿‡ JSON å’Œ C++ Addonï¼Œç›´å¥” <code>Module._extensions[&quot;.js&quot;]</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Module._extensions[<span class="string">'.js'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params">module, filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> content = fs.readFileSync(filename, <span class="string">'utf8'</span>);</span><br><span class="line">  <span class="built_in">module</span>._compile(internalModule.stripBOM(content), filename);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®ƒä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å¥”ç€ <code>_compile</code> å»çš„ã€‚</p><h6 id="Module-prototype-compile"><a href="#Module-prototype-compile" class="headerlink" title="Module.prototype._compile"></a>Module.prototype._compile</h6><p>å…ˆä¸Š<a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L378-L426" target="_blank" rel="external">ä»£ç </a>ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Module.prototype._compile = <span class="function"><span class="keyword">function</span>(<span class="params">content, filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// remove shebang</span></span><br><span class="line">  content = content.replace(shebangRe, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> self.require(path);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">require</span>.resolve = <span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Module._resolveFilename(request, self);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">require</span>.main = process.mainModule;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Enable support to add extra extension types</span></span><br><span class="line">  <span class="built_in">require</span>.extensions = Module._extensions;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">require</span>.cache = Module._cache;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> dirname = path.dirname(filename);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create wrapper function</span></span><br><span class="line">  <span class="keyword">var</span> wrapper = Module.wrap(content);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> compiledWrapper = runInThisContext(wrapper,</span><br><span class="line">                                      &#123; <span class="attr">filename</span>: filename, <span class="attr">lineOffset</span>: <span class="number">-1</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> args = [self.exports, <span class="built_in">require</span>, self, filename, dirname];</span><br><span class="line">  <span class="keyword">return</span> compiledWrapper.apply(self.exports, args);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰æµç¨‹ä¸Šè·Ÿ <code>NativeModule</code> çš„ç¼–è¯‘ç›¸ä¼¼ï¼Œä¸è¿‡è¿™é‡Œæ˜¯äº‹å…ˆå‡†å¤‡å¥½è¦åœ¨è½½å…¥çš„æ–‡ä»¶é‡Œé¢ç”¨çš„ <code>require</code> å‡½æ•°ï¼Œä»¥åŠä¸€äº› <code>require</code> çš„å‘¨è¾¹ã€‚</p><p>æ¥ä¸‹å»å°±æ˜¯ç”¨ <code>Module.wrap</code> æ¥åŒ…è£¹ä»£ç äº†ï¼ŒåŒ…è£¹å®Œä¹‹åæŠŠå¾—åˆ°çš„å‡½æ•°ç”¨å‚æ•° <code>self.exports, require, self, filename, dirname</code> å»æ‰§è¡Œä¸€éï¼Œå°±ç®—æ˜¯æ–‡ä»¶è½½å…¥å®Œæ¯•äº†ã€‚</p><p>æœ€åå›åˆ°ä¹‹å‰è½½å…¥ä»£ç çš„é‚£ä¸€åˆ»ï¼ŒæŠŠè½½å…¥å®Œæ¯•å¾—åˆ°çš„ <code>module.exports</code> å† <code>return</code> å‡ºå»å°±å¥½äº†ã€‚</p><h6 id="Module-wrap"><a href="#Module-wrap" class="headerlink" title="Module.wrap"></a>Module.wrap</h6><p>è¿™ä¸ªå°±ä¸ç”¨è¯´äº†ã€‚</p><p>åœ¨ lib/module.js çš„<a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L46-L48" target="_blank" rel="external">æœ€é¡¶ç«¯é™„è¿‘</a>æœ‰è¿™ä¹ˆå‡ è¡Œä»£ç ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Module.wrapper = NativeModule.wrapper;</span><br><span class="line">Module.wrap = NativeModule.wrap;</span><br><span class="line">Module._debug = util.debuglog(<span class="string">'module'</span>);</span><br></pre></td></tr></table></figure><p>ä¸€åˆ‡è±ç„¶å¼€æœ—äº†å§ã€‚</p><p>è¿ <code>NativeModule</code> çš„ä»£ç éƒ½é€ƒä¸å¼€è¢«ä¹‹å‰è¯´çš„é—­åŒ…æ‰€åŒ…è£¹ï¼Œé‚£ä¹ˆä½ è‡ªå·±å†™çš„ JS æ–‡ä»¶å½“ç„¶ä¹Ÿä¼šè¢« <code>NativeModule.wrap</code> æ‰€åŒ…è£¹ã€‚</p><p>é‚£ä¹ˆä½ åœ¨ä»£ç æ ¹ä½œç”¨åŸŸç”³æ˜çš„å‡½æ•°å®é™…ä¸Šåœ¨è¿è¡Œæ—¶é‡Œé¢å·²ç»è¢«ä¸€ä¸ªé—­åŒ…ç»™åŒ…ä½äº†ã€‚</p><p>ä»¥å‰å¯èƒ½å¾ˆå¤šåŒå­¦åªçŸ¥é“æ˜¯è¢«é—­åŒ…åŒ…ä½äº†ï¼Œä½†æ˜¯åŒ…çš„æ–¹æ³•ã€æµç¨‹ä»Šå¤©ç®—æ˜¯è§£æäº†ä¸€éäº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª <code>var a</code> æ€ä¹ˆä¹Ÿä¸å¯èƒ½ç»‘åˆ° <code>global</code> å»å•Šã€‚</p><h6 id="Module-prototype-require"><a href="#Module-prototype-require" class="headerlink" title="Module.prototype.require"></a>Module.prototype.require</h6><p>è™½ç„¶æˆ‘ä»¬ä¸Šé¢è®²å¾—å·®ä¸å¤šäº†ï¼Œå¯èƒ½å¾ˆå¤šç«¥é‹ä¹ŸåŒçƒ¦äº†ã€‚</p><p>ä¸è¿‡è¯¥è®²å®Œçš„è¿˜æ˜¯å¾—è®²å®Œã€‚</p><p>æˆ‘ä»¬åœ¨æˆ‘ä»¬è‡ªå·±æ–‡ä»¶ä¸­ç”¨çš„ <code>require</code> åœ¨ä¸Šä¸€èŠ‚é‡Œé¢æœ‰æåˆ°è¿‡ï¼Œä¼ åˆ°æˆ‘ä»¬é—­åŒ…é‡Œé¢çš„ <code>require</code> å®é™…ä¸Šæ˜¯é•¿è¿™æ ·çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> self.require(path);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å®é™…ä¸Šå°±æ˜¯ä¸ª <code>Module.prototype.require</code>ã€‚</p><p>æˆ‘ä»¬å†çœ‹çœ‹<a href="https://github.com/nodejs/node/blob/e25f8683f1735f55a27c00d41691be286f50e13f/lib/module.js#L362-L366" target="_blank" rel="external">è¿™ä¸ªå‡½æ•°</a>ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Module.prototype.require = <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  assert(path, <span class="string">'missing path'</span>);</span><br><span class="line">  assert(<span class="keyword">typeof</span> path === <span class="string">'string'</span>, <span class="string">'path must be a string'</span>);</span><br><span class="line">  <span class="keyword">return</span> Module._load(path, <span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸‹å­åˆç»•å›åˆ°äº†æˆ‘ä»¬ä¸€å¼€å§‹çš„ <code>Module._load</code>ã€‚</p><p>æ‰€ä»¥åŸºæœ¬ä¸Šå°±å·®ä¸å¤šåˆ°è¿™è¿‡äº†ã€‚</p><h2 id="REPL-vs-æ–‡ä»¶å¯åŠ¨"><a href="#REPL-vs-æ–‡ä»¶å¯åŠ¨" class="headerlink" title="REPL vs æ–‡ä»¶å¯åŠ¨"></a>REPL vs æ–‡ä»¶å¯åŠ¨</h2><p>æœ€åæˆ‘ä»¬å†ç‚¹ä¸€ä¸‹ï¼Œæˆ–è€…è¯´å›é¡¾ä¸€ä¸‹å§ã€‚</p><p>REPL å¯åŠ¨çš„æ—¶å€™ Node.js æ˜¯å¼€äº†ä¸ª <code>vm</code> ç›´æ¥è®©ä½ è·‘ï¼Œå¹¶æ²¡æœ‰æŠŠä»£ç åŒ…åœ¨ä¸€ä¸ªé—­åŒ…é‡Œé¢ï¼Œæ‰€ä»¥å†æ ¹ä½œç”¨åŸŸä¸‹çš„å˜é‡ä¼š <code>Biu</code> ä¸€ä¸‹è´´åˆ° <code>global</code> ä¸­å»ã€‚</p><p>è€Œæ–‡ä»¶å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåšæœ¬æ–‡ä¸­è¯´çš„ä¸€ç³»åˆ—äº‹æƒ…ï¼Œç„¶åå°±ä¼šæŠŠå„æ–‡ä»¶éƒ½åŒ…åˆ°ä¸€ä¸ªé—­åŒ…å»ï¼Œæ‰€ä»¥å˜é‡å°±æ— æ³•é€šè¿‡è¿™ç§æ–¹å¼æ¥è´´åˆ° <code>global</code> å»äº†ã€‚</p><p>ä¸è¿‡è¿™ç§äºŒä¹‰æ€§ä¼šåœ¨ <code>&quot;use strict&quot;;</code> ä¸­æˆ›ç„¶è€Œæ­¢ã€‚</p><p>ççˆ±ç”Ÿå‘½ï¼Œ<code>use strict</code>ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬æ–‡å¯èƒ½å¾ˆå¤šç«¥é‹çœ‹å®Œåæ‚”è§‰å¾—å¾ˆå‘â€”â€”JS ä¸ºä»€ä¹ˆæœ‰é‚£ä¹ˆå¤šäºŒä¹‰æ€§é‚£ä¹ˆå‘å‘¢ã€‚</p><p>å…¶å®ä¸ç„¶ï¼Œä¸»è¦æ˜¯å¯èƒ½å¾ˆå¤šäººå¯¹ Node.js æ‰§è¡Œçš„æœºåˆ¶ä¸æ˜¯å¾ˆäº†è§£ã€‚</p><p>æœ¬æ–‡ä»å°é¾™æŠ›å‡ºçš„ä¸€ä¸ªç®€å•é—®é¢˜è¿›å…¥ï¼Œç„¶åæµ…å…¥æµ…å‡º Node.js çš„ä¸€äº›æ‰§è¡Œæœºåˆ¶ä»€ä¹ˆçš„ï¼Œå¸Œæœ›å¯¹å¤§å®¶è¿˜æ˜¯æœ‰ç‚¹å¸®åŠ©ï¼Œæ›´ä½•å†µæˆ‘åœ¨æ„çš„ä¸æ˜¯é—®é¢˜æœ¬èº«ï¼Œè€Œæ˜¯åˆ†æçš„è¿™ä¸ªè¿‡ç¨‹ã€‚</p><h2 id="ç•ªå¤–"><a href="#ç•ªå¤–" class="headerlink" title="ç•ªå¤–"></a>ç•ªå¤–</h2><blockquote><p>ä»¥ä¸‹å‡ä¸ºè‡†æƒ³ã€‚</p><p><strong>å°é¾™ï¼š</strong> å–‚å–‚å–‚ï¼Œæˆ‘å°±é—®ä¸€ä¸ªç®€å•çš„å°ç ´é¢˜ç›®ï¼Œä½ è‡³äºå˜›ï¼</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡æ˜¯ä¸Šæ–‡ã€Š&lt;a href=&quot;https://xcoder.in/2015/11/26/a-js-problem-about-global/&quot;&gt;Node.js å¯åŠ¨æ–¹å¼ï¼šä¸€é“å…³äºå…¨å±€å˜é‡çš„é¢˜ç›®å¼•å‘çš„æ€è€ƒ&lt;/a&gt;ã€‹çš„ç»­ç« ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åŸé¢˜å›é¡¾&quot;&gt;&lt;a href=
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="æºç åˆ†æ" scheme="https://xcoder.in/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
      <category term="REPL" scheme="https://xcoder.in/tags/REPL/"/>
    
      <category term="vm" scheme="https://xcoder.in/tags/vm/"/>
    
  </entry>
  
  <entry>
    <title>Node.js å¯åŠ¨æ–¹å¼ï¼šä¸€é“å…³äºå…¨å±€å˜é‡çš„é¢˜ç›®å¼•å‘çš„æ€è€ƒ</title>
    <link href="https://xcoder.in/2015/11/26/a-js-problem-about-global/"/>
    <id>https://xcoder.in/2015/11/26/a-js-problem-about-global/</id>
    <published>2015-11-26T13:51:37.000Z</published>
    <updated>2017-12-11T07:59:20.459Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸé¢˜"><a href="#åŸé¢˜" class="headerlink" title="åŸé¢˜"></a>åŸé¢˜</h2><p>ã€€ã€€é¢˜ç›®æ˜¯è¿™æ ·çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢˜ç”±æˆ‘ä»¬äº²çˆ±çš„<a href="http://f2e.souche.com/blog/author/wang-xing-long/" target="_blank" rel="external">å°é¾™</a>ç«¥é‹å‘ç°å¹¶åœ¨æˆ‘ä»¬çš„ 901 ç¾¤é‡Œæé—®çš„ã€‚</p></blockquote><h2 id="ç»è¿‡"><a href="#ç»è¿‡" class="headerlink" title="ç»è¿‡"></a>ç»è¿‡</h2><p>ã€€ã€€ç„¶åæœ‰ä¸‹é¢çš„å°å¯¹è¯ã€‚</p><blockquote><p><strong>å°é¾™ï¼š</strong>ä½ ä»¬çŒœè¿™ä¸ªè¾“å‡ºä»€ä¹ˆï¼Ÿ</p><p><strong>å¼çº¾ï¼š</strong>2</p><p><strong>åŠ›å”ï¼š</strong>2 å•Š</p><p><strong>æ­»æœˆÂ·ä¸å¡è•¾ç‰¹ï¼š</strong>2</p><p><strong>åŠ›å”ï¼š</strong>æœ‰ä»€ä¹ˆé—®é¢˜ä¹ˆï¼Ÿ</p><p><strong>å°é¾™ï¼š</strong>è¾“å‡º undefindã€‚</p><p><strong>æ­»æœˆÂ·ä¸å¡è•¾ç‰¹ï¼š</strong>ä½ ç¡®å®šï¼Ÿ</p><p><strong>å°é¾™ï¼š</strong>æ˜¯ä¸æ˜¯æˆ‘ç”µè„‘åäº†</p><p><strong>åŠ›å”ï¼š</strong>ä½ ç¡®å®šï¼Ÿ</p><p><strong>å¼çº¾ï¼š</strong>ä½ ç¡®å®šï¼Ÿ</p><p><strong>å°é¾™ï¼š</strong>ä¸ºä»€ä¹ˆæˆ‘ node æ–‡ä»¶åè·‘å‡ºæ¥çš„æ˜¯ undefinedï¼Ÿ</p><p><strong>éƒ‘æ˜±ï¼š</strong>-.- ä¸€æ ·é˜¿ã€‚undefined</p></blockquote><p>ã€€ã€€ä»¥ä¸Šå°±æ˜¯åˆšè§åˆ°è¿™ä¸ªé¢˜ç›®çš„æ—¶å€™ç¾¤é‡Œçš„ä¸€ä¸ªå°è®¨è®ºã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ã€€ã€€åæ¥æˆ‘å°±è§‰å¾—å¥‡æ€ªï¼Œæ—¢ç„¶å°é¾™éªŒè¯è¿‡äº†ï¼Œè¯´æ˜ä»–ä¹Ÿä¸æ˜¯éšåœ°å¤§å°ä¾¿ï¼Œæ— çš„æ”¾çŸ¢ä»€ä¹ˆçš„ã€‚</p><p>ã€€ã€€äºæ˜¯æˆ‘ä¹ŸéªŒè¯äº†ä¸€ä¸‹ï¼Œä¸è¿‡ç”±äºå·æ‡’ï¼Œæ²¡æœ‰è·Ÿä»–ä»¬ä¸€æ ·å†™åœ¨æ–‡ä»¶é‡Œé¢ï¼Œè€Œæ˜¯ç›´æ¥ node å¼€äº†ä¸ª REPL æ¥è¾“å…¥ä¸Šè¿°ä»£ç ã€‚</p><blockquote><p><strong>ç»“æœæ˜¯ 2ï¼</strong></p><p><strong>ç»“æœæ˜¯ 2ï¼</strong></p><p><strong>ç»“æœæ˜¯ 2ï¼</strong></p></blockquote><p>ã€€ã€€äºæ˜¯è¿™å°±å‡ºç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ã€‚</p><p>ã€€ã€€å°¼ç›ä¸ºæ¯›æˆ‘æ˜¯ <code>2</code> ä»–ä»¬ä¿©æ˜¯ <code>undefined</code> å•Šï¼</p><p>ã€€ã€€ä¸è¿‡é©¬ä¸Šæˆ‘å°±ååº”è¿‡æ¥äº†â€”â€”æˆ‘ä»¬å‡ ä¸ªçš„ç¯å¢ƒä¸åŒï¼Œä»–ä»¬æ˜¯ <code>$ node foo.js</code> è€Œæˆ‘æ˜¯ç›´æ¥ node å¼€äº†ä¸ª REPLï¼Œæ‰€ä»¥æœ‰ä¸€å®šçš„åŒºåˆ«ã€‚</p><p>ã€€ã€€è€ŒåŠ›å”æœ¬èº«å°±æ˜¯å‰ç«¯å¤§ç¥ï¼Œæˆ‘ä¼°è®¡æ˜¯ä»¥ Chrome çš„è°ƒè¯•å·¥å…·ä¸‹ä¸ºåŸºç¡€å‡ºçš„ç­”æ¡ˆã€‚</p><h2 id="REPL-vs-æ–‡ä»¶æ‰§è¡Œ"><a href="#REPL-vs-æ–‡ä»¶æ‰§è¡Œ" class="headerlink" title="REPL vs æ–‡ä»¶æ‰§è¡Œ"></a>REPL vs æ–‡ä»¶æ‰§è¡Œ</h2><p>ã€€ã€€å…¶å®ä¸Šè¿°çš„é—®é¢˜ï¼Œéœ€è¦è§£é‡Šçš„é—®é¢˜å¤§æ¦‚å°±æ˜¯ <code>a</code> åˆ°åº•æŒ‚åœ¨å“ªäº†ã€‚</p><p>ã€€ã€€å› ä¸ºç»†ç»†ä¸€æƒ³ï¼Œåœ¨ <code>function</code> å½“ä¸­ï¼Œ<code>this</code> æŒ‡å‘çš„ç›®æ ‡æ˜¯ <code>global</code> æˆ–è€… <code>window</code>ã€‚</p><blockquote><p>è¿˜æ— æ³•ç†è§£ä¸Šé¢è¿™å¥è¯çš„ç«¥é‹éœ€è¦å…ˆè¡¥ä¸€ä¸‹åŸºç¡€ã€‚</p></blockquote><p>ã€€ã€€é‚£ä¹ˆæœ€ç»ˆéœ€è¦è§£é‡Šçš„å°±æ˜¯ <code>a</code> åˆ°åº•æœ‰æ²¡æœ‰æŒ‚åœ¨å…¨å±€å˜é‡ä¸Šé¢ã€‚</p><p>ã€€ã€€è¿™ä¹ˆä¸€æƒ³å°±æœ‰ç‚¹ç»†æ€ææçš„å‘³é“äº†â€”â€”å¦‚æœåœ¨ node çº¿ä¸Šè¿è¡Œç¯å¢ƒé‡Œé¢çš„æºä»£ç æ–‡ä»¶é‡Œé¢éšä¾¿ <code>var</code> ä¸€ä¸ªå˜é‡å°±æŒ‚åˆ°äº†å…¨å±€å˜é‡é‡Œé¢é‚£æ˜¯æœ‰å¤šææ€–ï¼</p><p>ã€€ã€€äºæ˜¯å°±æœ‰äº›é‡Šç„¶äº†ã€‚</p><p>ã€€ã€€ä½†ç©¶ç«Ÿæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´ REPL å’Œæ–‡ä»¶æ‰§è¡Œæ–¹å¼ä¸ä¸€æ ·çš„å‘¢ï¼Ÿ</p><h3 id="å…¨å±€å¯¹è±¡çš„å±æ€§"><a href="#å…¨å±€å¯¹è±¡çš„å±æ€§" class="headerlink" title="å…¨å±€å¯¹è±¡çš„å±æ€§"></a>å…¨å±€å¯¹è±¡çš„å±æ€§</h3><p>ã€€ã€€é¦–å…ˆæ˜¯å¼çº¾æ‰¾å‡ºäº†é˜®è€å¸ˆ ES6 ç³»åˆ—æ–‡ç« ä¸­çš„<a href="http://es6.ruanyifeng.com/#docs/let" target="_blank" rel="external">å…¨å±€å¯¹è±¡å±æ€§</a>ä¸€èŠ‚ã€‚</p><blockquote><p>å…¨å±€å¯¹è±¡æ˜¯æœ€é¡¶å±‚çš„å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒæŒ‡çš„æ˜¯ window è±¡ï¼Œåœ¨ Node.js æŒ‡çš„æ˜¯ global å¯¹è±¡ã€‚ES5 ä¹‹ä¸­ï¼Œå…¨å±€å¯¹è±¡çš„å±æ€§ä¸å…¨å±€å˜é‡æ˜¯ç­‰ä»·çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.a = <span class="number">1</span>;</span><br><span class="line">a <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">window</span>.a <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå…¨å±€å¯¹è±¡çš„å±æ€§èµ‹å€¼ä¸å…¨å±€å˜é‡çš„èµ‹å€¼ï¼Œæ˜¯åŒä¸€ä»¶äº‹ã€‚ï¼ˆå¯¹äºNodeæ¥è¯´ï¼Œè¿™ä¸€æ¡åªå¯¹REPLç¯å¢ƒé€‚ç”¨ï¼Œæ¨¡å—ç¯å¢ƒä¹‹ä¸­ï¼Œå…¨å±€å˜é‡å¿…é¡»æ˜¾å¼å£°æ˜æˆglobalå¯¹è±¡çš„å±æ€§ã€‚ï¼‰</p></blockquote><p>æœ‰äº†é˜®è€å¸ˆçš„æ–‡ç« éªŒè¯äº†è¿™ä¸ªçŒœæƒ³ï¼Œæˆ‘å¯ä»¥æ”¾å¿ƒå¤§èƒ†ç»§ç»­çœ‹ä¸‹å»äº†ã€‚</p><h3 id="repl-js"><a href="#repl-js" class="headerlink" title="repl.js"></a>repl.js</h3><p>ã€€ã€€çŸ¥é“äº†ä¸Šæ–‡çš„å†…å®¹ä¹‹åï¼Œæ„Ÿè§‰é¦–è¦æŸ¥çœ‹çš„å°±æ˜¯ Node.js æºç ä¸­çš„ <a href="https://github.com/nodejs/node/blob/master/lib/repl.js#L513" target="_blank" rel="external">repl.js</a> äº†ã€‚</p><p>ã€€ã€€å…ˆæ˜¯ç»“åˆäº†ä¸€ä¸‹è‡ªå·±ä»¥å‰ç”¨è‡ªå®šä¹‰ REPL çš„æƒ…å†µï¼Œä¸€èˆ¬çš„æ­¥éª¤å…ˆæ˜¯è·å– REPL çš„ä¸Šä¸‹æ–‡ï¼Œç„¶ååœ¨ä¸Šä¸‹æ–‡é‡Œé¢è´´ä¸Šå„ç§è‡ªå·±éœ€è¦çš„ä¸œè¥¿ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> r = relp.start(<span class="string">" âœ "</span>);</span><br><span class="line"><span class="keyword">var</span> c = r.context;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ c é‡Œé¢è´´ä¸Šå„ç§ä¸Šä¸‹æ–‡</span></span><br><span class="line">c.foo = bar;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><blockquote><p>å…³äºè‡ªå®šä¹‰ REPL çš„ä¸€äº›ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒä¸‹è€é›·å†™çš„ã€Š<a href="https://cnodejs.org/topic/563735ed677332084c319d95" target="_blank" rel="external">Node.js å®šåˆ¶ REPL çš„å¦™ç”¨</a>ã€‹ã€‚</p></blockquote><p>ã€€ã€€æœ‰äº†ä¹‹å‰å†™ REPL çš„ç»éªŒï¼Œå¤§è‡´æ˜ç™½äº† REPL é‡Œé¢æœ‰ä¸ªä¸Šä¸‹æ–‡çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆåœ¨ repl.js é‡Œé¢æˆ‘ä»¬ä¹Ÿæ‰¾åˆ°äº†ç±»ä¼¼çš„ä»£ç ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">REPLServer.prototype.createContext = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> context;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.useGlobal) &#123;</span><br><span class="line">    context = global;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    context = vm.createContext();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> global) context[i] = global[i];</span><br><span class="line">    context.console = <span class="keyword">new</span> Console(<span class="keyword">this</span>.outputStream);</span><br><span class="line">    context.global = context;</span><br><span class="line">    context.global.global = context;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  context.module = <span class="built_in">module</span>;</span><br><span class="line">  context.require = <span class="built_in">require</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.lines = [];</span><br><span class="line">  <span class="keyword">this</span>.lines.level = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// make built-in modules available directly</span></span><br><span class="line">  <span class="comment">// (loaded lazily)</span></span><br><span class="line">  exports._builtinLibs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(context, name, &#123;</span><br><span class="line">      <span class="attr">get</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> lib = <span class="built_in">require</span>(name);</span><br><span class="line">        context._ = context[name] = lib;</span><br><span class="line">        <span class="keyword">return</span> lib;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// allow the creation of other globals with this name</span></span><br><span class="line">      set: <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> context[name];</span><br><span class="line">        context[name] = val;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€çœ‹åˆ°äº†å…³é”®å­— <code>vm</code>ã€‚æˆ‘ä»¬æš‚æ—¶å…ˆä¸ç®¡ <code>vm</code>ï¼Œå…‰ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ<code>context</code> è¦ä¹ˆç­‰äº <code>global</code>ï¼Œè¦ä¹ˆå°±æ˜¯æŠŠ <code>global</code> ä¸Šé¢çš„æ‰€æœ‰ä¸œè¥¿éƒ½ç²˜è¿‡æ¥ã€‚</p><p>ã€€ã€€ç„¶åé¡ºå¸¦ç€æŠŠå¿…é¡»çš„ä¸¤ä¸ªä¸åœ¨ <code>global</code> é‡Œçš„ä¸¤ä¸ªä¸œè¥¿ <code>require</code> å’Œ <code>module</code> ç»™å¼„è¿‡æ¥ã€‚</p><p>ã€€ã€€ä¸‹é¢çš„ä¸œè¥¿å°±ä¸éœ€è¦é‚£ä¹ˆå…³å¿ƒäº†ã€‚</p><h3 id="VM"><a href="#VM" class="headerlink" title="VM"></a>VM</h3><p>ã€€ã€€æ¥ä¸‹å»æˆ‘ä»¬æ¥è®²è®² <code>vm</code>ã€‚</p><p>ã€€ã€€VM æ˜¯ node ä¸­çš„ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œå¯ä»¥åœ¨<a href="https://nodejs.org/dist/v4.2.2/docs/api/vm.html" target="_blank" rel="external">æ–‡æ¡£</a>ä¸­çœ‹åˆ°è¯´æ˜å’Œä½¿ç”¨æ–¹æ³•ã€‚</p><p>ã€€ã€€å¤§è‡´å°±æ˜¯å°†ä»£ç è¿è¡Œåœ¨ä¸€ä¸ªæ²™ç®±ä¹‹å†…ï¼Œå¹¶ä¸”äº‹å…ˆèµ‹äºˆå…¶ä¸€äº› <code>global</code> å˜é‡ã€‚</p><p>ã€€ã€€è€ŒçœŸæ­£èµ·åˆ°ä¸Šè¿° <code>var</code> å’Œ <code>global</code> åŒºåˆ«çš„å°±æ˜¯è¿™ä¸ª <code>vm</code> äº†ã€‚</p><p>ã€€ã€€<code>vm</code> ä¹‹ä¸­åœ¨æ ¹ä½œç”¨åŸŸï¼ˆä¹Ÿå°±æ˜¯æœ€å¤–å±‚ä½œç”¨åŸŸï¼‰ä¸­ä½¿ç”¨ <code>var</code> åº”è¯¥æ˜¯è·Ÿåœ¨æµè§ˆå™¨ä¸­ä¸€æ ·ï¼Œä¼šæŠŠå˜é‡ç²˜åˆ° <code>global</code>ï¼ˆæµè§ˆå™¨ä¸­æ˜¯ <code>window</code>ï¼‰ä¸­å»ã€‚</p><p>ã€€ã€€æˆ‘ä»¬å¯ä»¥è¯•è¯•è¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="built_in">require</span>(<span class="string">'vm'</span>);</span><br><span class="line"><span class="keyword">var</span> localVar = <span class="string">'initial value'</span>;</span><br><span class="line"></span><br><span class="line">vm.runInThisContext(<span class="string">'var localVar = "vm";'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'localVar: '</span>, localVar);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'global.localVar: '</span>, global.localVar);</span><br></pre></td></tr></table></figure><p>ã€€ã€€å…¶è¾“å‡ºç»“æœæ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">localVar: initial value</span><br><span class="line">global.localVar: vm</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æ–‡æ¡£ä¸­æ‰€è¯´ï¼Œ<code>vm</code> çš„ä¸€ç³»åˆ—å‡½æ•°ä¸­è·‘è„šæœ¬éƒ½æ— æ³•å¯¹å½“å‰çš„å±€éƒ¨å˜é‡è¿›è¡Œè®¿é—®ã€‚å„å‡½æ•°èƒ½è®¿é—®è‡ªå·±çš„ <code>global</code>ï¼Œè€Œ <code>runInThisContext</code> çš„ <code>global</code> ä¸å½“å‰ä¸Šä¸‹æ–‡çš„ <code>global</code> æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥èƒ½è®¿é—®å½“å‰çš„å…¨å±€å˜é‡ã€‚</p><p>ã€€ã€€æ‰€ä»¥å‡ºç°ä¸Šè¿°ç»“æœä¹Ÿæ˜¯ç†æ‰€å½“ç„¶çš„äº†ã€‚</p><p>ã€€ã€€æ‰€ä»¥åœ¨ <code>vm</code> ä¸­è·‘æˆ‘ä»¬ä¸€å¼€å§‹æŠ›å‡ºçš„é—®é¢˜ï¼Œç­”æ¡ˆè‡ªç„¶å°±æ˜¯ <code>2</code> äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="built_in">require</span>(<span class="string">"vm"</span>);</span><br><span class="line"><span class="keyword">var</span> sandbox = &#123;</span><br><span class="line">    <span class="attr">console</span>: <span class="built_in">console</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vm.createContext(sandbox);</span><br><span class="line">vm.runInContext(<span class="string">"var a = 2;function foo()&#123;console.log(this.a);&#125;foo();"</span>, sandbox);</span><br></pre></td></tr></table></figure><h3 id="Node-REPL-å¯åŠ¨çš„æ²™ç®±"><a href="#Node-REPL-å¯åŠ¨çš„æ²™ç®±" class="headerlink" title="Node REPL å¯åŠ¨çš„æ²™ç®±"></a>Node REPL å¯åŠ¨çš„æ²™ç®±</h3><p>ã€€ã€€æœ€åæˆ‘ä»¬å†åªéœ€è¦éªŒè¯ä¸€ä»¶äº‹å°±èƒ½çœŸç›¸å¤§ç™½äº†ã€‚</p><p>ã€€ã€€å¹³æ—¶æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ª <code>repl.js</code> ç„¶åæ‰§è¡Œ <code>$ node repl.js</code> çš„è¯æ˜¯ä¼šå¯åŠ¨ä¸€ä¸ª REPLï¼Œè€Œè¿™ä¸ª REPL ä¼šå»è°ƒ <code>vm</code>ï¼Œæ‰€ä»¥ä¼šå‡ºç° <code>2</code> çš„ç­”æ¡ˆï¼›æˆ–è€…æˆ‘ä»¬è‡ªå·±åœ¨ä»£ç é‡Œé¢å†™ä¸€ä¸ª <code>vm</code> ç„¶åè·‘ä¹‹å‰çš„ä»£ç ï¼Œä¹Ÿæ˜¯ç†æ‰€å½“ç„¶å‡ºç° <code>2</code>ã€‚</p><p>ã€€ã€€é‚£ä¹ˆæˆ‘ä»¬å°±è¾“å…¥ <code>$ node</code> æ¥è¿›å…¥çš„ REPL è·Ÿæˆ‘ä»¬ä¹‹å‰è®²çš„ REPL æ˜¯ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿å‘¢ï¼Ÿ</p><p>ã€€ã€€å¦‚æœæ˜¯çš„è¯ï¼Œä¸€åˆ‡å°±é‡Šç„¶äº†ã€‚</p><p>ã€€ã€€é¦–å…ˆæˆ‘ä»¬è¿›å…¥åˆ° Node çš„å…¥å£æ–‡ä»¶â€”â€”C++ çš„ <code>int main()</code>ã€‚</p><p>ã€€ã€€å®ƒåœ¨ Node.js æºç  <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/src/node_main.cc#L45" target="_blank" rel="external">src/node_main.cc</a> ä¹‹ä¸­ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="literal">NULL</span>, _IOLBF, <span class="number">1024</span>);</span><br><span class="line">  <span class="keyword">return</span> node::Start(argc, argv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å°±åœ¨ä¸»å‡½æ•°ä¸­æ‰§è¡Œäº† <code>node::Start</code>ã€‚è€Œè¿™ä¸ª <code>node::Start</code> åˆå­˜åœ¨ <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/src/node.cc#L4109" target="_blank" rel="external">src/node.cc</a> é‡Œé¢ã€‚</p><p>ã€€ã€€ç„¶ååœ¨ <code>node::Start</code> é‡Œé¢åˆè°ƒç”¨ <code>StartNodeInstance</code>ï¼Œåœ¨è¿™é‡Œé¢æ˜¯ <code>LoadEnvironment</code> å‡½æ•°ã€‚</p><p>ã€€ã€€æœ€ååœ¨ <code>LoadEnvironment</code> ä¸­çœ‹åˆ°äº†å‡ å¥å…³é”®çš„è¯­å¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Local&lt;String&gt; script_name = FIXED_ONE_BYTE_STRING(env-&gt;isolate(), <span class="string">"node.js"</span>);</span><br><span class="line">Local&lt;Value&gt; f_value = ExecuteString(env, MainSource(env), script_name);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">Local&lt;Function&gt; f = Local&lt;Function&gt;::Cast(f_value);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">Local&lt;Object&gt; global = env-&gt;context()-&gt;Global();</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">Local&lt;Value&gt; arg = env-&gt;process_object();</span><br><span class="line">f-&gt;Call(global, <span class="number">1</span>, &amp;arg);</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿˜æœ‰è¿™ä¹ˆä¸€æ®µå…³é”®çš„æ³¨é‡Šã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Now we call 'f' with the 'process' variable that we've built up with</span></span><br><span class="line"><span class="comment">// all our bindings. Inside node.js we'll take care of assigning things to</span></span><br><span class="line"><span class="comment">// their places.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// We start the process this way in order to be more modular. Developers</span></span><br><span class="line"><span class="comment">// who do not like how 'src/node.js' setups the module system but do like</span></span><br><span class="line"><span class="comment">// Node's I/O bindings may want to replace 'f' with their own function.</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯åŠ¨ <code>node</code> çš„æ—¶å€™ï¼Œåœ¨åšäº†ä¸€äº›å‡†å¤‡ä¹‹åæ˜¯å¼€å§‹è½½å…¥æ‰§è¡Œ src æ–‡ä»¶å¤¹ä¸‹é¢çš„ <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/src/node.js" target="_blank" rel="external">node.js</a> æ–‡ä»¶ã€‚</p><p>ã€€ã€€åœ¨ <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/src/node.js#L92" target="_blank" rel="external">92 è¡Œ</a>é™„è¿‘æœ‰é’ˆå¯¹ <code>$ node foo.js</code> å’Œ <code>$ node</code> çš„åˆ¤æ–­å¯åŠ¨ä¸åŒçš„é€»è¾‘ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.argv[<span class="number">1</span>]) &#123;</span><br><span class="line">  <span class="comment">// make process.argv[1] into a full path</span></span><br><span class="line">  <span class="keyword">var</span> path = NativeModule.require(<span class="string">'path'</span>);</span><br><span class="line">  process.argv[<span class="number">1</span>] = path.resolve(process.argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Module = NativeModule.require(<span class="string">'module'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  startup.preloadModules();</span><br><span class="line">  <span class="keyword">if</span> (global.v8debug &amp;&amp;</span><br><span class="line">      process.execArgv.some(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arg.match(<span class="regexp">/^--debug-brk(=[0-9]*)?$/</span>);</span><br><span class="line">      &#125;)) &#123;</span><br><span class="line">    <span class="keyword">var</span> debugTimeout = +process.env.NODE_DEBUG_TIMEOUT || <span class="number">50</span>;</span><br><span class="line">    setTimeout(Module.runMain, debugTimeout);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Main entry point into most programs:</span></span><br><span class="line">    Module.runMain();</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> Module = NativeModule.require(<span class="string">'module'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process._forceRepl || NativeModule.require(<span class="string">'tty'</span>).isatty(<span class="number">0</span>)) &#123;</span><br><span class="line">    <span class="comment">// REPL</span></span><br><span class="line">    <span class="keyword">var</span> cliRepl = Module.requireRepl();</span><br><span class="line">    cliRepl.createInternalRepl(process.env, <span class="function"><span class="keyword">function</span>(<span class="params">err, repl</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€åœ¨ä¸Šè¿°èŠ‚é€‰ä»£ç çš„ç¬¬ä¸€ä¸ª <code>else if</code> ä¸­ï¼Œå°±æ˜¯å¯¹ <code>$ node foo.js</code> è¿™ç§æƒ…å†µè¿›è¡Œå¤„ç†äº†ï¼Œå†åšå®Œå„ç§åˆå§‹åŒ–ä¹‹åï¼Œä½¿ç”¨ <code>Module.runMain();</code> æ¥è¿è¡Œå…¥å£ä»£ç ã€‚</p><p>ã€€ã€€ç¬¬äºŒä¸ª <code>else if</code> é‡Œé¢å°±æ˜¯ <code>$ node</code> è¿™ç§æƒ…å†µäº†ã€‚</p><p>ã€€ã€€æˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­æ‰“å¼€ <code>$ node</code> çš„æ—¶å€™ï¼ŒTTY é€šå¸¸æ˜¯å…³è¿ç€çš„ï¼Œæ‰€ä»¥ <code>require(&#39;tty&#39;).isatty(0)</code> ä¸º <code>true</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šè¿›åˆ°æ¡ä»¶åˆ†æ”¯å¹¶ä¸”æ‰§è¡Œé‡Œé¢çš„ <code>cliRepl</code> ç›¸å…³ä»£ç ã€‚</p><p>ã€€ã€€æˆ‘ä»¬è¿›å…¥åˆ° <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/lib/module.js#L490" target="_blank" rel="external">lib/module.js</a> çœ‹çœ‹è¿™ä¸ª <code>Module.requireRepl</code> æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Module.requireRepl = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Module._load(<span class="string">'internal/repl'</span>, <span class="string">'.'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å¾—è½¬å…¥ <a href="https://github.com/nodejs/node/blob/0966ab99966b7d3fbe4d7b93797fb299595fca72/lib/internal/repl.js#L23" target="_blank" rel="external">lib/internal/repl.js</a> æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><p>ã€€ã€€ä¸Šé¢åœ¨ <code>node.js</code> é‡Œé¢æˆ‘ä»¬çœ‹åˆ°å®ƒæ‰§è¡Œäº†è¿™ä¸ª <code>cliRepl</code> çš„ <code>createInternalRepl</code> å‡½æ•°ï¼Œå®ƒçš„å®ç°å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createRepl</span>(<span class="params">env, opts, cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  opts = opts || &#123;</span><br><span class="line">    <span class="attr">ignoreUndefined</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">terminal</span>: process.stdout.isTTY,</span><br><span class="line">    <span class="attr">useGlobal</span>: <span class="literal">true</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  opts.replMode = &#123;</span><br><span class="line">    <span class="string">'strict'</span>: REPL.REPL_MODE_STRICT,</span><br><span class="line">    <span class="string">'sloppy'</span>: REPL.REPL_MODE_SLOPPY,</span><br><span class="line">    <span class="string">'magic'</span>: REPL.REPL_MODE_MAGIC</span><br><span class="line">  &#125;[<span class="built_in">String</span>(env.NODE_REPL_MODE).toLowerCase().trim()];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> repl = REPL.start(opts);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è½¬å¤´ä¸€çœ‹è¿™ä¸ª lib/internal/repl.js é¡¶ç«¯çš„æ¨¡å—å¼•å…¥ï¼Œèµ«ç„¶çœ‹åˆ°ä¸€å¥è¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> REPL = <span class="built_in">require</span>(<span class="string">'repl'</span>);</span><br></pre></td></tr></table></figure><p>ã€€ã€€çœŸç›¸å¤§ç™½ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ã€€ã€€æœ€åå†æ¢³ç†ä¸€éã€‚</p><p>ã€€ã€€åœ¨äº Node.js çš„ <code>vm</code> é‡Œé¢ï¼Œé¡¶çº§ä½œç”¨åŸŸä¸‹çš„ <code>var</code> ä¼šæŠŠå˜é‡è´´åˆ° <code>global</code> ä¸‹é¢ã€‚è€Œ REPL ä½¿ç”¨äº† <code>vm</code>ã€‚ç„¶å <code>$ node</code> è¿›å…¥çš„ä¸€ä¸ªæ¨¡å¼å°±æ˜¯ä¸€ä¸ªç‰¹å®šå‚æ•°ä¸‹é¢å¯åŠ¨çš„ä¸€ä¸ª <code>REPL</code>ã€‚</p><p>ã€€ã€€æ‰€ä»¥æˆ‘ä»¬ä¸€å¼€å§‹æå‡ºçš„é—®é¢˜é‡Œé¢åœ¨ <code>$ node foo.js</code> æ¨¡å¼ä¸‹æ‰§è¡Œæ˜¯ <code>undefined</code>ï¼Œå› ä¸ºä¸åœ¨å…¨å±€å˜é‡ä¸Šï¼Œä½†æ˜¯å¯ç”¨ <code>$ node</code> è¿™ç§ REPL æ¨¡å¼çš„æ—¶å€™å¾—åˆ°çš„ç»“æœæ˜¯ <code>2</code>ã€‚</p><h2 id="ç•ªå¤–"><a href="#ç•ªå¤–" class="headerlink" title="ç•ªå¤–"></a>ç•ªå¤–</h2><blockquote><p><strong>å°é¾™ï¼š</strong>æˆ‘ç”¨ node test.js è·‘å‡ºæ¥æ˜¯ <code>a: undefined</code>ï¼›é‚£æˆ‘åº”è¯¥æ€ä¹ˆä¿®æ”¹â€œç¯å¢ƒâ€ï¼Œæ¥è®©ä»–è·‘å‡ºï¼š<code>a: 2</code> å‘¢ï¼Ÿ</p></blockquote><p>ã€€ã€€äºæ˜¯æœ‰äº†ä¸Šé¢å†™çš„é‚£æ®µä»£ç ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="built_in">require</span>(<span class="string">"vm"</span>);</span><br><span class="line"><span class="keyword">var</span> sandbox = &#123;</span><br><span class="line">    <span class="attr">console</span>: <span class="built_in">console</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vm.createContext(sandbox);</span><br><span class="line">vm.runInContext(<span class="string">"var a = 2;function foo()&#123;console.log(this.a);&#125;foo();"</span>, sandbox);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åŸé¢˜&quot;&gt;&lt;a href=&quot;#åŸé¢˜&quot; class=&quot;headerlink&quot; title=&quot;åŸé¢˜&quot;&gt;&lt;/a&gt;åŸé¢˜&lt;/h2&gt;&lt;p&gt;ã€€ã€€é¢˜ç›®æ˜¯è¿™æ ·çš„ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td clas
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="æºç åˆ†æ" scheme="https://xcoder.in/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
      <category term="REPL" scheme="https://xcoder.in/tags/REPL/"/>
    
      <category term="vm" scheme="https://xcoder.in/tags/vm/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å“ˆå¸Œ</title>
    <link href="https://xcoder.in/2015/10/16/why-i-use-hash/"/>
    <id>https://xcoder.in/2015/10/16/why-i-use-hash/</id>
    <published>2015-10-16T06:52:06.000Z</published>
    <updated>2017-12-11T07:59:20.548Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯å“ˆå¸Œï¼ˆHashï¼‰"><a href="#ä»€ä¹ˆæ˜¯å“ˆå¸Œï¼ˆHashï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯å“ˆå¸Œï¼ˆHashï¼‰"></a>ä»€ä¹ˆæ˜¯å“ˆå¸Œï¼ˆHashï¼‰</h2><p>æœ¬æ¥è¿™é‡Œä¸åº”è¯¥å‡ºç°è¿™ä¸€èŠ‚çš„ï¼Œå› ä¸ºå®é™…ä¸Šå¤§å®¶åº”è¯¥éƒ½çŸ¥é“ä»€ä¹ˆæ˜¯å“ˆå¸Œã€‚ä¸è¿‡æœ‰æ—¶å€™ä¸ºäº†æ–‡ç« çš„å®Œæ•´æ€§ï¼Œæˆ‘è¿™é‡Œå°±ç¨å¾®æ•™æ¡æ€§åœ°è¯´æ˜ä¸€ä¸‹å§ã€‚ãƒ½(Ìâ—•â—à±ªâ—Ÿâ—•â€µ)ï¾‰</p><blockquote><p>æ•£åˆ—ï¼ˆè‹±è¯­ï¼šHashingï¼‰ï¼Œé€šå¸¸éŸ³è¯‘ä½œå“ˆå¸Œï¼Œæ˜¯ç”µè„‘ç§‘å­¦ä¸­ä¸€ç§å¯¹èµ„æ–™çš„å¤„ç†æ–¹æ³•ï¼Œé€šè¿‡æŸç§ç‰¹å®šçš„å‡½æ•°ã€ç®—æ³•å°†è¦æ£€ç´¢çš„é¡¹ä¸ç”¨æ¥æ£€ç´¢çš„ç´¢å¼•å…³è”èµ·æ¥ï¼Œç”Ÿæˆä¸€ç§ä¾¿äºæœç´¢çš„æ•°æ®ç»“æ„ã€‚ä¹Ÿè¯‘ä¸ºæ•£åˆ—ã€‚</p><p style="text-align: right;">â€“ From <a href="https://zh.wikipedia.org/wiki/%E6%95%A3%E5%88%97" target="_blank">æ•£åˆ—</a>, Wikipedia</p></blockquote><p>å®é™…ä¸Šé€šä¿—çš„è¯´æ³•å°±æ˜¯æŠŠæŸç§çŠ¶æ€æˆ–è€…èµ„æ–™ç»™æ˜ å°„åˆ°æŸä¸ªå€¼ä¸Šçš„æ“ä½œã€‚</p><p>æœ¬é…±å¤§æ¦‚å°±è§£é‡Šåˆ°è¿™é‡Œäº†ï¼Œè‡³äºå“ˆå¸Œçš„è¿›ä¸€æ­¥è®¤çŸ¥åŒ…æ‹¬å†²çªçš„äº§ç”Ÿå’Œè§£å†³ç­‰ï¼Œå¦‚æœç±³å¨œæ¡‘ä¸äº†è§£çš„è¯è¿˜è¯·è‡ªè¡Œå­¦ä¹ å’•ã€‚à°¥à±ªà°¥</p><h2 id="å¼•å­â€”â€”å­æ ‘é—®é¢˜"><a href="#å¼•å­â€”â€”å­æ ‘é—®é¢˜" class="headerlink" title="å¼•å­â€”â€”å­æ ‘é—®é¢˜"></a>å¼•å­â€”â€”å­æ ‘é—®é¢˜</h2><p>è¿™ä¸ªä¸æ˜¯æˆ‘åœ¨å®è·µä¸­é‡åˆ°çš„é—®é¢˜ï¼Œè€Œæ˜¯å½“å¹´å»æŸä¸ä½œæ¶çš„å¤§å‚é¢è¯•æ—¶å€™é‡åˆ°çš„é—®é¢˜ï¼Œè§‰å¾—æ¯”è¾ƒç»å…¸ï¼Œæ‰€ä»¥å°±æ‹¿å‡ºæ¥äº†ã€‚á•™à¼¼àºˆÙ„Íœàºˆà¼½á•—</p><h3 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œå‡è®¾æ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®åªæœ‰å·¦å³å­èŠ‚ç‚¹ï¼Œè‡ªèº«å¹¶ä¸å­˜å‚¨æ•°æ®ã€‚è¯·æ‰¾å‡ºä¸¤ä¸¤å®Œå…¨ç›¸ç­‰çš„å­æ ‘ä»¬ã€‚</p><blockquote><p>æœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥è‡ªå·±å…ˆæ€è€ƒä¸€ä¸‹ã€‚â‚â‚â—(ï½¥â€™Ï‰â€™ï½¥)â—Ÿâ¾â¾ </p></blockquote><h3 id="æˆ‘çš„åšæ³•"><a href="#æˆ‘çš„åšæ³•" class="headerlink" title="æˆ‘çš„åšæ³•"></a>æˆ‘çš„åšæ³•</h3><p>å®é™…ä¸Šæˆ‘ä¹Ÿä¸çŸ¥é“è‡ªå·±çš„åšæ³•æ˜¯ä¸æ˜¯æ­£ç¡®åšæ³•ï¼Œä¸è¿‡æ—¢ç„¶é€šè¿‡äº†é‚£ä¸€è½®é¢è¯•ï¼Œæƒ³æ¥ä¹Ÿä¸ä¼šåå·®åˆ°å“ªå»å–µã€‚áƒšï¼ˆâ•¹Îµâ•¹áƒšï¼‰</p><p>åšæ³•å¤§æ¦‚å¦‚ä¸‹ï¼š</p><ol><li><a href="https://zh.wikipedia.org/wiki/%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86#.E5.90.8E.E5.BA.8F.E9.81.8D.E5.8E.86" target="_blank" rel="external">ååºéå†</a>ä¸€éæ•´æ£µæ ‘ã€‚</li><li>å¯¹äºéå†åˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œéƒ½è·å–åˆ°å·¦å³å­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼ï¼Œç„¶åå°†å…¶æ‹¼æ¥é‡æ–°è®¡ç®—å‡ºè‡ªèº«çš„å“ˆå¸Œå€¼ï¼Œå¹¶è¿”å›ç»™çˆ¶äº²èŠ‚ç‚¹ã€‚</li></ol><p>è‡³äºå“ˆå¸Œå€¼æ€ä¹ˆç®—ï¼Œæ–¹æ³•æœ‰å¾ˆå¤šã€‚æœ€ç®€å•çš„å°±æ˜¯è®¾å¶å­èŠ‚ç‚¹ä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œæ¯”å¦‚æ˜¯ <code>md5(&quot;&quot;)</code>ï¼Œç„¶åæ¯æ¬¡éå¶å­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼å°±ç”¨ <code>md5(LEFT_HASH + RIGHT_HASH)</code> æ¥è®¡ç®—ã€‚å¤§å®¶ä¹Ÿå¯ä»¥è‡ªå·±éšä¾¿æƒ³ä¸€ç§æ–¹æ³•æ¥åšå°±å¥½äº†ã€‚</p><p>å¾ˆå¤šäººå¯èƒ½ä¸è§£äº†ï¼Œæ˜æ˜æ˜¯ç”¨ <code>md5</code>ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯è®²å“ˆå¸Œï¼Œæœ‰æ¯›çº¿å…³ç³»ã€‚(â•¯Â°OÂ°)â•¯â”»â”â”»</p><p>å®é™…ä¸Š <code>md5</code> å°±æ˜¯ä¸€ç§å“ˆå¸Œç®—æ³•ï¼Œè€Œä¸”æ˜¯éå¸¸ç»å…¸çš„å“ˆå¸Œç®—æ³•ã€‚</p><blockquote><p>å…¸å‹çš„å“ˆå¸Œç®—æ³•åŒ…æ‹¬ MD2ã€MD4ã€MD5 å’Œ SHA-1 ç­‰ã€‚å½“ç„¶ä¸å±€é™äºè¿™äº›ï¼Œå¯¹äºæ•°å­—æ¥è¯´ï¼Œå–æ¨¡ä¹Ÿç®—æ˜¯å“ˆå¸Œç®—æ³•ï¼Œå¯¹äºå­—ç¬¦ä¸²çŠ¶æ€è½¬æ•´æ•°çŠ¶æ€å“ˆå¸Œæ¥è¯´è¿˜æœ‰è¯¸å¦‚ <a href="http://www.partow.net/programming/hashfunctions/#BKDRHashFunction" target="_blank" rel="external">BKDR</a>ã€<a href="http://www.partow.net/programming/hashfunctions/#ELFHashFunction" target="_blank" rel="external">ELF</a> ç­‰ç­‰ã€‚</p></blockquote><p>å¦‚æœå¤§å®¶æƒ³å¤šäº†è§£ä¸€äº›å­—ç¬¦ä¸²è½¬æ•°å­—å“ˆå¸Œçš„ç®—æ³•ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ BYVoid çš„è¿™ç¯‡ã€Š<a href="https://www.byvoid.com/blog/string-hash-compare/" target="_blank" rel="external">å„ç§å­—ç¬¦ä¸²Hashå‡½æ•°æ¯”è¾ƒ</a>ã€‹ï¼Œæˆ–è€…æƒ³ç›´æ¥åœ¨ Node.js é‡Œé¢ä½¿ç”¨çš„å°ä¼™ä¼´ä»¬å¯ä»¥å…‰é¡¾ä¸‹è¿™ä¸ªåŒ…â€”â€”<a href="https://github.com/XadillaX/bling_hashes" target="_blank" rel="external">bling-hashes</a>ã€‚</p><p>åˆæ­¥çš„è½®å»“å·²ç»æ˜æ™°äº†ï¼Œè¯´ç™½äº†å°±æ˜¯å°†æ¯ä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œå…¨ç®—å‡ºæ¥ï¼Œå¦‚æœæ˜¯çˆ¶äº²èŠ‚ç‚¹å°±ç”¨å­èŠ‚ç‚¹çš„å“ˆå¸Œæ‹¼æ¥èµ·æ¥å†å“ˆå¸Œä¸€éã€‚Ïƒ`âˆ€Â´)Ïƒ</p><p>æŠŠè¿™äº›å“ˆå¸Œç®—å‡ºæ¥ä¹‹åæ”¾åœ¨ä¸€ä¸ªæ•£åˆ—è¡¨é‡Œé¢å¾…æŸ¥ã€‚å¦‚æœä¸€ä¸ªç®—å‡ºæ¥çš„å“ˆå¸Œè·Ÿä¹‹å‰å·²æœ‰çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±æ˜¯è¯´è¿™ä¸ªèŠ‚ç‚¹è·Ÿé‚£ä¸ªèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘æœ‰å¯èƒ½å®Œå…¨ç›¸ç­‰ã€‚</p><blockquote><p>æ³¨æ„ï¼š<strong>æœ‰å¯èƒ½</strong>å®Œå…¨ç›¸ç­‰ã€‚</p><p>æ³¨æ„ï¼šåªæ˜¯<strong>æœ‰å¯èƒ½</strong>å®Œå…¨ç›¸ç­‰ã€‚</p><p>æ³¨æ„ï¼šé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼Œåªæ˜¯<strong>æœ‰å¯èƒ½</strong>å®Œå…¨ç›¸ç­‰ã€‚</p></blockquote><p>å“ˆå¸Œæ˜¯å­˜åœ¨ç€ä¸€å®šçš„å†²çªæ¦‚ç‡çš„ï¼Œæ‰€ä»¥è¯´ä¸¤ä¸ªç›¸ç­‰çš„å“ˆå¸Œæ‰€æ£€ç´¢åˆ°çš„æºä¸ä¸€å®šä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬æ ¹æ®è¿™äº›è®¡ç®—åˆ°çš„å“ˆå¸Œå»ºç«‹å“ˆå¸Œè¡¨ï¼Œç„¶åæŠŠè¡¨ä¸­åŒå“ˆå¸Œå€¼çš„å­æ ‘å†ä¸¤ä¸¤åŒæ—¶éå†ä¸€éä»¥æ£€éªŒæ˜¯å¦ç›¸ç­‰ã€‚</p><ol><li>åŒæ—¶é€’å½’ï¼Œå–ä¸¤ä¸ªå­æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</li><li>ååºéå†ï¼Œçœ‹çœ‹æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯éƒ½ä¸€æ ·å­˜åœ¨ï¼ˆæˆ–è€…ä¸å­˜åœ¨ï¼‰å·¦å­èŠ‚ç‚¹ä»¥åŠå­˜åœ¨ï¼ˆæˆ–è€…ä¸å­˜åœ¨ï¼‰å³å­èŠ‚ç‚¹ã€‚</li><li>å¾ªç¯å¾€å¤ä¸€ç›´åˆ°ä¸¤ä¸¤éå†å®Œæ•´æ£µæ ‘å¾—åˆ°éªŒè¯ç»“æœã€‚å¦‚æœåŠè·¯æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹çŠ¶æ€ä¸ä¸€æ ·å°±å¯ä»¥ç›´æ¥è·³å‡ºé€’å½’è¿”å› <code>false</code>ã€‚</li></ol><p>è‡³æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå¤§æ¦‚æ˜¯ä¸¤å¤§æ­¥â€”â€”<strong>è®¡ç®—å„å­æ ‘çš„å“ˆå¸Œå€¼</strong>å’Œ<strong>éªŒè¯å„åŒå“ˆå¸Œå­æ ‘çš„ç›¸ç­‰æ€§</strong>ã€‚ä¸è¿‡ç¨å¾®å˜é€šä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è®¡ç®—å‡ºå“ˆå¸Œå€¼çš„æ—¶å€™å°±å»è·Ÿä»¥å‰çš„å¯¹æ¯”äº†ã€‚</p><h4 id="å‰ªæ"><a href="#å‰ªæ" class="headerlink" title="å‰ªæ"></a>å‰ªæ</h4><p>å®é™…ä¸Šä¸Šé¢çš„åšæ³•è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–çš„æ–¹æ¡ˆï¼Œä¸è¿‡è·Ÿå“ˆå¸Œç›¸å…³æ€§å·²ç»åŸºæœ¬ä¸Šå¾ˆå°äº†ã€‚ä¸è¿‡è¿˜æ˜¯è·Ÿ<strong>è§£å†³å†²çª</strong>æœ‰ä¸€ä¸¢ä¸¢çš„å…³ç³»çš„ï¼Œæ²¡å…´è¶£çš„ç«¥é‹ä¹Ÿå¯ä»¥ç›´æ¥è·³è¿‡äº†ã€‚(à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘)</p><p>ç”±äºå­æ ‘å“ˆå¸Œå€¼æ˜¯å­˜åœ¨ä¸€å®šçš„å†²çªæ¦‚ç‡çš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªåŒå“ˆå¸Œçš„å­æ ‘ä¸ä¸€å®šç›¸åŒã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚æœèƒ½ä¸€çœ¼çœ‹å‡ºè¿™æ ·çš„ä¸¤æ£µå­æ ‘æ˜¯ä¸ç›¸ç­‰çš„ï¼Œå°±å¯ä»¥çœç•¥éªŒè¯è¿™ä¸€ä¸ªé€’å½’çš„æ­¥éª¤äº†ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ç§æœ€æ˜¾è€Œæ˜“è§çš„æƒ…å†µæˆ‘ä»¬æ˜¯å¯ä»¥å¿½ç•¥çœç•¥æ­¥éª¤çš„ï¼Œé‚£å°±æ˜¯æ·±åº¦ã€‚</p><p>å¦‚æœä¸¤æ£µå­æ ‘ä¸¤ä¸¤å®Œå…¨ç›¸ç­‰ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¿©åŸºä½¬çš„æ·±åº¦ï¼ˆæˆ–è€…è¯´é«˜åº¦ï¼‰æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœè¿æ·±åº¦éƒ½ä¸ä¸€æ ·äº†è¿˜å¦‚ä½•æ„‰å¿«æåŸºâ€”â€”æ‰€ä»¥è¯´å¦‚æœæœ‰ä¸¤ä¸ªç›¸ç­‰å“ˆå¸Œå€¼çš„å­æ ‘çš„æ·±åº¦ä¸ä¸€æ ·çš„è¯å¯ä»¥ç›´æ¥ç•¥è¿‡éªŒè¯æ­¥éª¤äº†ã€‚</p><p>é‚£ä¹ˆå°±å¯ä»¥è¿™ä¹ˆåšï¼š</p><ol><li>è®¾æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„æ·±åº¦ä¸º <code>0</code>ï¼Œç„¶åæ¯å¾€ä¸Šä¸€å±‚åŠ ä¸€ã€‚</li><li>é‡åˆ°å·¦å³å­èŠ‚ç‚¹æ·±åº¦ä¸ä¸€æ ·çš„çˆ¶èŠ‚ç‚¹æ—¶ï¼Œå–æ·±åº¦å¤§çš„é‚£ä¸ªå­èŠ‚ç‚¹æ·±åº¦å»åŠ ä¸€ã€‚</li></ol><p>ä»¥ä¸Šæ­¥éª¤åœ¨éå†è®¡ç®—å“ˆå¸Œçš„æ—¶å€™é¡ºä¾¿ä¹Ÿåšäº†ï¼Œè¿™æ ·å°±å¤šäº†ä¸€ä¸ªéªŒè¯æ ‡è®°äº†ã€‚</p><p>æ‰€ä»¥å·®ä¸å¤šå°±è¿™æ ·äº†ï¼Œæµ…å°è¾„æ­¢ã€‚( Ë˜ï½¥Ğ·ï½¥)</p><h3 id="å¼•å­çš„å°ç»“"><a href="#å¼•å­çš„å°ç»“" class="headerlink" title="å¼•å­çš„å°ç»“"></a>å¼•å­çš„å°ç»“</h3><p>å°±ä¸Šè¿°çš„åœºæ™¯æ¥è¯´ï¼Œå“ˆå¸Œéå¸¸å¥½åœ°å°†ä¸€ä¸ªéå¸¸å¤æ‚çš„çŠ¶æ€è½¬åŒ–æˆä¸€ä¸ªå¯ä»¥æ£€ç´¢çš„çŠ¶æ€ã€‚æœ¬æ¥æ¯«æ— å¤´ç»ªçš„ä¸€ä¸ªé—®é¢˜ä½¿ç”¨äº†å“ˆå¸Œä¹‹åå°±å®Œå…¨å˜æˆäº†ä¸€ä¸ªæ£€ç´¢åŠ éªŒè¯çš„è¿‡ç¨‹äº†ã€‚</p><h2 id="æŠ¥å‘Šå›¾é—®é¢˜"><a href="#æŠ¥å‘Šå›¾é—®é¢˜" class="headerlink" title="æŠ¥å‘Šå›¾é—®é¢˜"></a>æŠ¥å‘Šå›¾é—®é¢˜</h2><p>è¿™ä¸ªé—®é¢˜å°±æ˜¯æˆ‘åœ¨å¤§æœè½¦ä¸­ç¡®å®é‡åˆ°çš„åœºæ™¯äº†ã€‚å¤§å®¶ä¹Ÿä¸éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯æŠ¥å‘Šå›¾ï¼Œå°±å½“å®ƒæ˜¯ä¸€ä¸ªä»£å·äº†ã€‚</p><h3 id="é—®é¢˜æè¿°-1"><a href="#é—®é¢˜æè¿°-1" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><blockquote><p>è¦åšçš„äº‹æƒ…å¤§æ¦‚å°±æ˜¯è¯´ç»™å®šä¸€ä¸ªæŠ¥å‘Šï¼Œæˆ‘ä»¬æ ¹æ®æŠ¥å‘Šçš„å„ä¸ªç»†èŠ‚é€‰å®šå„ç§å›¾å±‚ç„¶åæ‰æˆä¸€å›¢å åŠ åœ¨ä¸€èµ·å½¢æˆæœ€åä¸€ä¸ªç»“æœå›¾ã€‚</p></blockquote><p>å…¶å®æœ¬æ¥å°±æœ‰ä¸ªç³»ç»Ÿåœ¨åšè¿™ä»¶äº‹æƒ…çš„â€”â€”æ¯æ¥ä¸€ä¸ªæŠ¥å‘Šå°±ç”Ÿæˆä¸€å¼ å›¾ï¼Œç„¶åå­˜å‚¨å¥½ä¹‹åç»™å‰ç«¯ä½¿ç”¨ã€‚</p><p>æˆ‘åšçš„äº‹æƒ…æ˜¯å°†é€»è¾‘è¿ç§»åˆ°å¦ä¸€å¥—è®¡ç®—å¯†é›†å‹ä»»åŠ¡é›†ä¸­å¤„ç†ç³»ç»Ÿä¸­å»ã€‚(<em>Â´è‰¸`</em>)</p><p>å…¶å®ç”Ÿæˆè¿™æ ·ä¸€å¼ å›¾ç‰‡çš„é€»è¾‘æ˜¯ CPU è®¡ç®—å¯†é›†å‹çš„é€»è¾‘ï¼Œæ‰€ä»¥æ¯”è¾ƒè€—è´¹èµ„æºå’Œæ—¶é—´çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½åœ¨è¿™ä¸Šé¢åšç‚¹æ‰‹è„šä¼˜åŒ–ä¸€ä¸‹ã€‚</p><h3 id="ä¼˜åŒ–æ–¹æ³•"><a href="#ä¼˜åŒ–æ–¹æ³•" class="headerlink" title="ä¼˜åŒ–æ–¹æ³•"></a>ä¼˜åŒ–æ–¹æ³•</h3><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“çš„æ˜¯ï¼Œæœ‰å“ªäº›å›¾å±‚æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å…¶å®è¿™ç®—åŠä¸ªæ’åˆ—ç»„åˆçš„é—®é¢˜äº†ã€‚</p><p>ä¸è¿‡æˆ‘ä»¬ä¹ŸçŸ¥é“æ’åˆ—ç»„åˆçš„å¢é•¿æ€§éå¸¸å¿«ï¼Œæ›´ä½•å†µæˆ‘è¿™é‡Œæœ‰çº¦ 100 ä¸ªå›¾å±‚é€‰æ‹©ï¼Œæ‰€ä»¥å¯èƒ½æ€§éå¸¸å¤šï¼Œä¸€ä¸‹å­å…¨ç”Ÿæˆå¥½ä¸å¯èƒ½ã€‚</p><p>é‚£ä¹ˆå°±å¯ä»¥ç”¨å“ˆå¸Œå’Œæ‡’æƒ°çš„æ€æƒ³æ¥å®ç°äº†ã€‚(<em>Ë‡Ï‰Ë‡</em>äºº)</p><p>è™½ç„¶æŠ¥å‘Šæ˜¯æœ‰æ— é™ç§å¯èƒ½çš„ï¼Œä½†æ˜¯æŠŠæŠ¥å‘Šè½¬æˆå›¾å±‚æ•°æ®ä¹‹åï¼Œæ‹¥æœ‰å®Œå…¨ä¸€æ ·çš„å›¾å±‚æ•°æ®çš„æŠ¥å‘Šå°±å¯ä»¥ç”¨åŒä¸€å¼ å›¾ç‰‡äº†ï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§èŠ‚çœç©ºé—´å’Œæ—¶é—´äº†ã€‚</p><p>å…¶å®å¤§æ¦‚çš„æ­¥éª¤éå¸¸ç®€å•ï¼š</p><ol><li>æŠŠå›¾å±‚æ•°æ®è®¡ç®—æˆå“ˆå¸Œã€‚ï¼ˆæ¯”å¦‚æŠŠæ‰€æœ‰å›¾å±‚æ–‡ä»¶è·¯å¾„ç”¨æŸç§ç¬¦å·æ‹¼æ¥ï¼Œå†ç”¨ <code>md5</code> è®¡ç®—ä¸€ä¸‹ï¼‰</li><li>å»æ•°æ®åº“æŸ¥æ‰¾è¿™ä¸ªå“ˆå¸Œä¸»é”®å­˜ä¸å­˜åœ¨ã€‚<ul><li>å¦‚æœå­˜åœ¨åˆ™éªŒè¯æºå›¾å±‚æ•°æ®åŸŸå½“å‰å›¾å±‚æ•°æ®æ˜¯å¦å»åˆã€‚<ul><li>å¦‚æœä¸å»åˆåˆ™æŒ‰æŸç§ç®—æ³•é‡æ–°è®¡ç®—å“ˆå¸Œï¼Œç»§ç»­æ­¥éª¤ 2ã€‚</li><li><strong>å¦‚æœå»åˆåˆ™å¯ä»¥ç›´æ¥æ‹¿ç€è¿™ä¸ªæ•°æ®è¿”å›äº†ï¼Œè·³å‡ºè®¡ç®—ã€‚</strong></li></ul></li><li>å¦‚æœä¸å­˜åœ¨å°±è¯´æ˜å½“å‰æ•°æ®åº“è¿˜æ²¡æœ‰è¿™ä¸ªå›¾å±‚æƒ…å†µçš„æŠ¥å‘Šå›¾ç”Ÿæˆï¼Œé‚£ä¹ˆå°±æ‰§è¡Œç”ŸæˆæŠ¥å‘Šå›¾é€»è¾‘ã€‚</li></ul></li><li>æŠ¥å‘Šå›¾ç”Ÿæˆä¹‹åï¼Œå°†å…¶å­˜å…¥æ•°æ®åº“ä¸­ã€‚<ul><li>è®¡ç®—å‡ºè¿™ä¸ªæŠ¥å‘Šå›¾å›¾å±‚æ•°æ®çš„å“ˆå¸Œï¼Œå»æ•°æ®åº“æŸ¥å­˜ä¸å­˜åœ¨ã€‚<ul><li>å¦‚æœä¸å­˜åœ¨åˆ™è¯´æ˜å“ˆå¸Œä¸å†²çªï¼Œèƒ½ç”¨ï¼Œç›´æ¥ç”¨è¿™ä¸ªå“ˆå¸Œå­˜è¿›å»ã€‚</li><li>å¦‚æœå­˜åœ¨åˆ™è¯´æ˜å“ˆå¸Œå†²çªï¼Œé‚£ä¹ˆæŒ‰æŸç§ç®—æ³•é‡æ–°è®¡ç®—å“ˆå¸Œï¼Œç»§ç»­ä¸Šé¢çš„æ­¥éª¤ç›´åˆ°ä¸å†²çªä¸ºæ­¢ã€‚</li></ul></li></ul></li></ol><p>å¦‚æœå¤§å®¶æƒ³çŸ¥é“â€œæŒ‰æŸç§ç®—æ³•é‡æ–°ç”Ÿæˆå“ˆå¸Œâ€é‡Œé¢â€œæŸç§ç®—æ³•â€çš„è¯å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„çç‹—çœ¼çš„è¯´æ˜äº†ã€‚(ï¾‰â—•ãƒ®â—•)ï¾‰*:ï½¥ï¾Ÿâœ§</p><blockquote><p>å…¶å®å¾ˆç®€å•ï¼ŒæŠŠå›¾å±‚æ•°æ®çš„è¿™ä¸ªå­—ç¬¦ä¸²åŠ æŸä¸ªå›ºå®šå­—ç¬¦å½“å°å°¾å·´ï¼Œå¦‚æœå“ˆå¸Œè¿˜æ˜¯å†²çªåˆ™ç»§ç»­åŠ è¿™ä¸ªå°å°¾å·´ï¼Œç›´åˆ°è®¡ç®—å‡ºæ¥çš„å“ˆå¸Œä¸å†²çªä¸ºæ­¢ã€‚</p><p>æ¯”å¦‚æˆ‘å°±ç”¨äº†è¿™å­—ç¬¦å½“å°å°¾å·´â€”â€”<strong>ğŸ€£</strong>ï¼ˆéº»å°†ç‰Œä¸­çš„å…°ï¼‰ã€‚(â™›â€¿â™›)</p></blockquote><h3 id="æŠ¥å‘Šå›¾çš„å°ç»“"><a href="#æŠ¥å‘Šå›¾çš„å°ç»“" class="headerlink" title="æŠ¥å‘Šå›¾çš„å°ç»“"></a>æŠ¥å‘Šå›¾çš„å°ç»“</h3><p>åœ¨è¿™ç§åœºæ™¯ä¸­ï¼Œæˆ‘æŠŠå“ˆå¸Œæ‹¿æ¥ä½œæ£€ç´¢æŸç§æŠ¥å‘Šå›¾æ˜¯å¦å·²ç»ç”Ÿæˆçš„ç”¨é€”ã€‚å¦‚æœæ²¡æœ‰ç”Ÿæˆåˆ™ç”Ÿæˆä¸€å¼ ï¼Œå¦‚æœå·²ç»ç”Ÿæˆåˆ™ç›´æ¥æ‹¿å·²æœ‰çš„æŠ¥å‘Šå›¾å»ç”¨ã€‚</p><p>è‡³å°‘æ¯”åŸæ¥çš„æ¥ä¸€å¼ æŠ¥å‘Šå°±ç”Ÿæˆä¸€å¼ å›¾ç‰‡æ¥å¾—å¿«ï¼Œå¹¶ä¸”çœç©ºé—´â€”â€”ç›¸å½“äºä½œå†—ä½™å¤„ç†äº†ã€‚</p><p>äº‹å®ä¸Šåœ¨å¾ˆå¤šçš„ç½‘ç›˜ç³»ç»Ÿä¸­ä¹Ÿæœ‰ä½œå†—ä½™å¤„ç†çš„ã€‚ä½ ä»¥ä¸ºä½ æœ‰å¤šå°‘å¤šå°‘ T çš„ç©ºé—´ï¼Œå®é™…ä¸Šç›¸åŒçš„æ–‡ä»¶æœ€ç»ˆåœ¨ç½‘ç›˜ç³»ç»Ÿé‡Œé¢åªå­˜ä¸€ä»½ï¼ˆä¸è¿‡æ’é™¤å¤‡ä»½çš„é‚£äº›ï¼‰ï¼Œè€Œæˆ‘ç›¸ä¿¡åšè¿™äº›å†—ä½™åˆ¤æ–­çš„åŸç†å°±æ˜¯å“ˆå¸Œäº†ï¼ŒSHA-1 ä¹Ÿå¥½ MD5 ä¹Ÿå¥½ï¼Œåæ­£å°±æ˜¯è¿™æ ·ã€‚</p><blockquote><p>ä¸Šé¢ç½‘ç›˜çš„å†—ä½™å¤„ç†åŸç†ä¹Ÿåªæ˜¯æˆ‘çš„çŒœæµ‹ï¼Œæˆ‘æ²¡åœ¨é‚£äº›å‚å­é‡Œé¢å·¥ä½œè¿‡æ‰€ä»¥ä¸èƒ½è¯´å°±æ˜¯å°±æ˜¯è¿™æ ·å­çš„ã€‚æ¬¢è¿æŒ‡æ­£ã€‚ï½¡ï¾Ÿãƒ½(ï¾ŸÂ´Ğ”`)ï¾‰ï¾Ÿï½¡</p></blockquote><h2 id="å”¯ä¸€ä¸»é”®é—®é¢˜"><a href="#å”¯ä¸€ä¸»é”®é—®é¢˜" class="headerlink" title="å”¯ä¸€ä¸»é”®é—®é¢˜"></a>å”¯ä¸€ä¸»é”®é—®é¢˜</h2><p>è¿™æ˜¯æˆ‘æ¥è¿™è¾¹å·¥ä½œåçš„å¦ä¸€ä¸ªå°æ’æ›²äº†ï¼Œé‡åˆ°ä¸€ä¸ªä¸»é”®ç”Ÿæˆçš„å°éœ€æ±‚ã€‚</p><h3 id="é—®é¢˜æè¿°-2"><a href="#é—®é¢˜æè¿°-2" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>æœ‰ä¸€ä¸ªæ•°æ®è¦æ’å…¥åˆ°æ•°æ®åº“ï¼Œæ‰€ä»¥è¦ç»™å®ƒç”Ÿæˆä¸€ä¸ªä¸»é”®ï¼Œä½†æ˜¯éœ€æ±‚æ¯”è¾ƒå¥‡è‘©ï¼Œå¯èƒ½æ˜¯å†å²é—ç•™é—®é¢˜å§ã€‚(ëˆˆâ€¸ëˆˆ)</p><ul><li>éè‡ªå¢ã€‚</li><li>æ˜¯ä¸€ä¸ªå…¨æ˜¯æ•°å­—çš„å­—ç¬¦ä¸²ã€‚</li><li>ä¸åŒç±»å‹çš„è¿™ä¸ªè¡¨çš„æ•°æ®ç”¨ä¸åŒçš„å‰ç¼€ï¼Œæ¯”å¦‚ <code>10</code>ã€<code>11</code>ã€<code>12</code> ç­‰ã€‚</li><li>ä½æ•°åœ¨åå‡ ä½å·¦å³ï¼ˆä¸è¿‡åœ¨æˆ‘è¿™é‡Œå°±å›ºå®šäº†ï¼‰ã€‚</li></ul><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å¦‚æœæ˜¯ <code>å‰ç¼€ + éšæœºæ•°</code> çš„å†²çªæ¦‚ç‡ä¼šæ¯”è¾ƒå¤§çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨å“ˆå¸Œæ¥æã€‚</p><p>éå¸¸ç®€å•ã€‚é¦–å…ˆå‰ç¼€æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å°±ä¸ç®¡äº†ï¼Œç„¶åæˆ‘æ ¹æ®è¿™æ¬¡è¿›æ¥çš„æ•°æ®æ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼ˆæ•°æ®ä¸ä¼šå®Œå…¨ä¸€æ ·çš„ï¼‰ï¼ŒåŠ ä¸Šä¸€ç‚¹éšæœºç›ï¼Œç„¶åç”¨å­—ç¬¦ä¸²å“ˆå¸Œè®¡ç®—ä¸€éï¼ŒåŠ ä¸Šå‰å¯¼é›¶ï¼ŒåŠ ä¸Šå½“å‰æ—¶é—´æˆ³çš„åå‡ ä½æ‹¼æ¥èµ·æ¥ï¼Œæœ€åæ¥ä¸Šå‰ç¼€å°±å¥½äº†ã€‚</p><p>è¿™ä¸ª <code>generate</code> å‡½æ•°çœ‹èµ·æ¥å°±åƒè¿™æ ·å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> bling = <span class="built_in">require</span>(<span class="string">"bling-hashes"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate</span>(<span class="params">type, bodyParamStr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> basePrefix;</span><br><span class="line">    <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'foo'</span>: basePrefix = <span class="string">'10'</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'bar'</span>: basePrefix = <span class="string">'11'</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: base_prefix = <span class="string">'00'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> date = moment();</span><br><span class="line">    <span class="keyword">var</span> hash = bling.bkdr(bodyParamStr + date.valueOf()).pad(<span class="number">10</span>);</span><br><span class="line">    hash = date.millisecond().pad(<span class="number">3</span>) + hash;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> basePrefix + hash;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„ï¼š</strong>è¿™é‡Œçš„ <code>bling</code> å°±æ˜¯ä¸Šé¢æåˆ°è¿‡çš„é‚£ä¸ª <a href="https://github.com/XadillaX/bling_hashes" target="_blank" rel="external">bling-hashes</a>ï¼Œé‡‡ç”¨äº† <code>BKDR</code> ç®—æ³•æ¥è®¡ç®—å“ˆå¸Œã€‚ä»¥åŠ <code>Number.prototype.pad</code> å‡½æ•°æ˜¯æˆ‘é‚ªæ¶å¾—ä½¿ç”¨äº† <a href="http://sugarjs.com/api/Number/pad" target="_blank" rel="external">SugarJs</a> é‡Œé¢çš„å‡½æ•°ï¼Œå°±æ˜¯åŠ ä¸Šå‰å¯¼é›¶çš„æ„æ€ã€‚å¦‚æœå—â€œåƒä¸‡ä¸è¦ä¿®æ”¹åŸå‹é“¾â€å½±å“è¾ƒæ·±åœ°ç«¥é‹åˆ«å­¦æˆ‘å“¦ã€‚<code>bodyParamStr</code> æ˜¯å‰ç«¯ä¼ è¿‡æ¥çš„ <strong>Raw Form Data</strong>ï¼Œå®ƒçœ‹èµ·æ¥åƒ <code>&quot;data1=1&amp;data2=2&amp;...&quot;</code>ã€‚</p></blockquote><p>æœ€åå¾—åˆ°çš„è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯æˆ‘ä»¬æ‰€è¦çš„ä¸»é”®äº†ã€‚ï½¡:.ï¾Ÿãƒ½(*Â´âˆ€`)ï¾‰ï¾Ÿ.:ï½¡</p><p>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¸»é”®ä»ç„¶åˆå†²çªçš„å¯èƒ½æ€§ï¼Œæ‰€ä»¥ä¸€æ—¦å†²çªäº†ï¼ˆæ— è®ºæ˜¯è‡ªå·±æ£€æµ‹åˆ°çš„è¿˜æ˜¯æ’å…¥æ•°æ®åº“çš„æ—¶å€™ç–¼äº†ï¼‰å°±éœ€è¦å†ç”Ÿäº§ä¸€éã€‚å°±ç›®å‰æ¥è¯´å†ç”Ÿæˆçš„æ—¶å€™æ¯«ç§’æ—¶é—´æˆ³åä¸‰ä½ä¼šä¸ä¸€æ ·ï¼Œæ‰€ä»¥é—®é¢˜ä¸å¤§ï¼Œå…è®¸å­˜åœ¨çš„è¯¯å·®â€”â€”æ¯•ç«Ÿä¸æ˜¯é‚£ç§åˆ†åˆ†é’Ÿé›†åƒä¸‡æ¡çš„æ•°æ®ï¼Œè‚¯å®šåœ¨ <code>int</code> èŒƒå›´å†…ã€‚å¦‚æœåˆ°æ—¶å€™çœŸå‡ºé—®é¢˜äº†å†æ”¹è¿›ã€‚</p><h3 id="ä¸»é”®çš„å°ç»“"><a href="#ä¸»é”®çš„å°ç»“" class="headerlink" title="ä¸»é”®çš„å°ç»“"></a>ä¸»é”®çš„å°ç»“</h3><p>è¿™é‡Œçš„å“ˆå¸Œæ˜¯ç”¨åœ¨ç”ŸæˆåŸºæœ¬ä¸Šæ²¡æœ‰ç¢°æ’çš„ä¸»é”®èº«ä¸Šï¼Œæ„Ÿè§‰æ•ˆæœä¹Ÿæ˜¯éå¸¸ä¸é”™çš„â€”â€”å‰ææ˜¯ä½ ä¹Ÿæœ‰è¿™ç§å¥‡è‘©éœ€æ±‚ã€‚</p><h2 id="çœŸÂ·å°ç»“"><a href="#çœŸÂ·å°ç»“" class="headerlink" title="çœŸÂ·å°ç»“"></a>çœŸÂ·å°ç»“</h2><p>æœ¬æ–‡å¤§è‡´ä»‹ç»äº†å“ˆå¸Œçš„å‡ ç§ç”¨é€”ï¼Œæœ‰å¯èƒ½æ˜¯å¤§å®¶ç†ŸçŸ¥çš„ç”¨é€”ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å·§ç”¨ï¼Œæ€»ä¹‹å°±æ˜¯è¯´äº†ä¸ºä»€ä¹ˆæˆ‘è¦ç”¨å“ˆå¸Œã€‚</p><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œæ— è®ºæ˜¯å®é™…ç”¨é€”è¿˜æ˜¯è‡ªå·±ç©ç©çš„é¢˜ç›®ï¼Œå¤šåŠ¨åŠ¨è„‘å­å°±ä¼šå‡ºæ¥ä¸€äº›â€œå¥‡æŠ€æ·«å·§â€ã€‚å“ˆå¸Œä¹Ÿå¥½ï¼Œåˆ«çš„ä¸œè¥¿ä¹Ÿç½¢ï¼Œåæ­£éƒ½æ˜¯ä¸ºäº†è§£å†³é—®é¢˜çš„â€”â€”åƒä¸‡åˆ«å› ä¸ºå®é™…å¼€å‘ä¸­é€šå¸¸æ€§çš„â€œå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨â€è€Œå»å¿½è§†å®ƒä»¬ï¼Œè™½ç„¶å“ˆå¸Œå·²ç»æ˜¯å¤Ÿå¸¸ç”¨çš„äº†ã€‚(à¹‘â€¢à«…Ï‰â€¢Â´à¹‘)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯å“ˆå¸Œï¼ˆHashï¼‰&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯å“ˆå¸Œï¼ˆHashï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯å“ˆå¸Œï¼ˆHashï¼‰&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯å“ˆå¸Œï¼ˆHashï¼‰&lt;/h2&gt;&lt;p&gt;æœ¬æ¥è¿™é‡Œä¸åº”è¯¥å‡ºç°è¿™ä¸€èŠ‚çš„ï¼Œå› ä¸ºå®é™…ä¸Šå¤§å®¶åº”è¯¥éƒ½çŸ¥é“ä»€ä¹ˆæ˜¯å“ˆå¸Œã€‚ä¸è¿‡
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="æ•°æ®ç»“æ„" scheme="https://xcoder.in/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
      <category term="å“ˆå¸Œ" scheme="https://xcoder.in/tags/%E5%93%88%E5%B8%8C/"/>
    
  </entry>
  
  <entry>
    <title>åˆæ¢ MySQL çš„ Binlog</title>
    <link href="https://xcoder.in/2015/08/10/mysql-binlog-try/"/>
    <id>https://xcoder.in/2015/08/10/mysql-binlog-try/</id>
    <published>2015-08-10T03:39:53.000Z</published>
    <updated>2017-12-11T07:59:20.522Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€èŠ±ç“£ç½‘çš„æœç´¢æ¶æ„éœ€è¦é‡æ„ï¼Œå°¤å…¶æ˜¯åœ¨ç´¢å¼•å»ºç«‹æˆ–è€…æ›´æ–°å±‚é¢ã€‚</p><p>ã€€ã€€ç›®å‰çš„ä¸€ä¸ªæ¶æ„å¯¼è‡´çš„ç»“æœå°±æ˜¯æ—¶é—´è¶Šä¹…ï¼Œæ•°æ®æœ¬ä½“ä¸æœç´¢å¼•æ“ç´¢å¼•ä¸­çš„æ•°æ®è¶Šä¸åŒæ­¥ï¼Œç›¸å·®ç”šå¤§ã€‚</p><p>ã€€ã€€æ–°çš„ä¸€ä¸ªæ¶æ„æ‰“ç®—ä» MySQL çš„ Binlog ä¸­è¯»å–æ•°æ®æ›´æ–°ã€åˆ é™¤ã€æ–°å¢ç­‰å†å²è®°å½•ï¼Œå¹¶æŠŠç›¸åº”ä¿¡æ¯æå–å‡ºæ¥ä¸¢åˆ°é˜Ÿåˆ—ä¸­æ…¢æ…¢å»åŒæ­¥ã€‚</p><p>ã€€ã€€æ‰€ä»¥æˆ‘å°±åœ¨è¿™é‡Œå°å°å»äº†è§£ä¸€ä¸‹ Binlogã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="ä»€ä¹ˆæ˜¯-Binlog"><a href="#ä»€ä¹ˆæ˜¯-Binlog" class="headerlink" title="ä»€ä¹ˆæ˜¯ Binlog"></a>ä»€ä¹ˆæ˜¯ Binlog</h3><p>ã€€ã€€MySQL Server æœ‰å››ç§ç±»å‹çš„æ—¥å¿—â€”â€”Error Logã€General Query Logã€Binary Log å’Œ Slow Query Logã€‚</p><p>ã€€ã€€ç¬¬ä¸€ä¸ªæ˜¯é”™è¯¯æ—¥å¿—ï¼Œè®°å½• mysqld çš„ä¸€äº›é”™è¯¯ã€‚ç¬¬äºŒä¸ªæ˜¯ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼Œè®°å½• mysqld æ­£åœ¨åšçš„äº‹æƒ…ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯çš„è¿æ¥å’Œæ–­å¼€ã€æ¥è‡ªå®¢æˆ·ç«¯æ¯æ¡ Sql Statement è®°å½•ä¿¡æ¯ï¼›å¦‚æœä½ æƒ³å‡†ç¡®çŸ¥é“å®¢æˆ·ç«¯åˆ°åº•ä¼ äº†ä»€ä¹ˆç [å“”å“”] ç©æ„å„¿ç»™æœåŠ¡ç«¯ï¼Œè¿™ä¸ªæ—¥å¿—å°±éå¸¸ç®¡ç”¨äº†ï¼Œä¸è¿‡å®ƒéå¸¸å½±å“æ€§èƒ½ã€‚ç¬¬å››ä¸ªæ˜¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®°å½•ä¸€äº›æŸ¥è¯¢æ¯”è¾ƒæ…¢çš„ SQL è¯­å¥â€”â€”è¿™ç§æ—¥å¿—éå¸¸å¸¸ç”¨ï¼Œä¸»è¦æ˜¯ç»™å¼€å‘è€…è°ƒä¼˜ç”¨çš„ã€‚</p><p>ã€€ã€€å‰©ä¸‹çš„ç¬¬ä¸‰ç§å°±æ˜¯ Binlog äº†ï¼ŒåŒ…å«äº†ä¸€äº›äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶æè¿°äº†æ•°æ®åº“çš„æ”¹åŠ¨ï¼Œå¦‚å»ºè¡¨ã€æ•°æ®æ”¹åŠ¨ç­‰ï¼Œä¹ŸåŒ…æ‹¬ä¸€äº›æ½œåœ¨æ”¹åŠ¨ï¼Œæ¯”å¦‚ <code>DELETE FROM ran WHERE bing = luan</code>ï¼Œç„¶è€Œä¸€æ¡æ•°æ®éƒ½æ²¡è¢«åˆ æ‰çš„è¿™ç§æƒ…å†µã€‚é™¤éä½¿ç”¨ Row-based loggingï¼Œå¦åˆ™ä¼šåŒ…å«æ‰€æœ‰æ”¹åŠ¨æ•°æ®çš„ SQL Statementã€‚</p><p>ã€€ã€€é‚£ä¹ˆ Binlog å°±æœ‰äº†ä¸¤ä¸ªé‡è¦çš„ç”¨é€”â€”â€”å¤åˆ¶å’Œæ¢å¤ã€‚æ¯”å¦‚ä¸»ä»è¡¨çš„å¤åˆ¶ï¼Œå’Œå¤‡ä»½æ¢å¤ä»€ä¹ˆçš„ã€‚</p><h3 id="å¯ç”¨-Binlog"><a href="#å¯ç”¨-Binlog" class="headerlink" title="å¯ç”¨ Binlog"></a>å¯ç”¨ Binlog</h3><p>ã€€ã€€é€šå¸¸æƒ…å†µ MySQL æ˜¯é»˜è®¤å…³é—­ Binlog çš„ï¼Œæ‰€ä»¥ä½ å¾—é…ç½®ä¸€ä¸‹ä»¥å¯ç”¨å®ƒã€‚</p><p>ã€€ã€€å¯ç”¨çš„è¿‡ç¨‹å°±æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>my.cnf</code> äº†ã€‚</p><p>ã€€ã€€è‡³äº <code>my.cnf</code> ä½ç½®è¯·è‡ªè¡Œå¯»æ‰¾ã€‚ä¾‹å¦‚é€šè¿‡ OSX çš„ <code>brew</code> å®‰è£…çš„ <code>mysql</code> é»˜è®¤é…ç½®ç›®å½•é€šå¸¸åœ¨</p><blockquote><p>/usr/local/Cellar/mysql/$VERSION/support-files/my-default.cnf</p></blockquote><p>ã€€ã€€è¿™ä¸ªæ—¶å€™éœ€è¦å°†å®ƒæ‹·è´åˆ° <code>/etc/my.cnf</code> ä¸‹é¢ã€‚</p><blockquote><p>è¯¦è§ &lt;<a href="http://stackoverflow.com/questions/10757169/mysql-my-cnf-location" target="_blank" rel="external">StackOverflow - MySQL â€˜my.cnfâ€™ location?</a>&gt;ã€‚</p></blockquote><p>ã€€ã€€ç´§æ¥ç€é…ç½® <code>log-bin</code> å’Œ <code>log-bin-index</code> çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è‡ªè¡ŒåŠ ä¸Šå»ã€‚</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">log-bin</span>=master-bin</span><br><span class="line"><span class="attr">log-bin-index</span>=master-bin.index</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™é‡Œçš„ <code>log-bin</code> æ˜¯æŒ‡ä»¥åç”Ÿæˆå„ Binlog æ–‡ä»¶çš„å‰ç¼€ï¼Œæ¯”å¦‚ä¸Šè¿°ä½¿ç”¨ <code>master-bin</code>ï¼Œé‚£ä¹ˆæ–‡ä»¶å°±å°†ä¼šæ˜¯ <code>master-bin.000001</code>ã€<code>master-bin.000002</code> ç­‰ã€‚è€Œè¿™é‡Œçš„ <code>log-bin-index</code> åˆ™æŒ‡ binlog index æ–‡ä»¶çš„åç§°ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸º <code>master-bin.index</code>ã€‚</p><p>ã€€ã€€å¦‚æœä¸Šè¿°å·¥ä½œåšå®Œä¹‹åé‡å¯ MySQL æœåŠ¡ï¼Œä½ å¯ä»¥è¿›å…¥ä½ çš„ MySQL CLI éªŒè¯ä¸€ä¸‹æ˜¯å¦çœŸçš„å¯ç”¨äº†ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ mysql -u <span class="variable">$USERNAME</span> ...</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶ååœ¨ç»ˆç«¯é‡Œé¢è¾“å…¥ä¸‹é¢ä¸€å¥ SQL è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%log_bin%'</span>;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœç»“æœé‡Œé¢å‡ºæ¥è¿™æ ·ç±»ä¼¼çš„è¯å°±è¡¨ç¤ºæˆåŠŸäº†ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">+---------------------------------+---------------------------------------+</span><br><span class="line">| Variable_name                   | Value                                 |</span><br><span class="line">+---------------------------------+---------------------------------------+</span><br><span class="line">| log_bin                         | ON                                    |</span><br><span class="line">| log_bin_basename                | /usr/<span class="built_in">local</span>/var/mysql/master-bin       |</span><br><span class="line">| log_bin_index                   | /usr/<span class="built_in">local</span>/var/mysql/master-bin.index |</span><br><span class="line">| log_bin_trust_function_creators | OFF                                   |</span><br><span class="line">| log_bin_use_v1_row_events       | OFF                                   |</span><br><span class="line">| sql_log_bin                     | ON                                    |</span><br><span class="line">+---------------------------------+---------------------------------------+</span><br><span class="line">6 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ›´å¤šçš„ä¸€äº›ç›¸å…³é…ç½®å¯ä»¥å‚è€ƒè¿™ç¯‡ã€Š<a href="http://blog.csdn.net/jolly10/article/details/13998761" target="_blank" rel="external">MySQL çš„ binary log åˆæ¢</a>ã€‹ã€‚</p><h3 id="éšä¾¿ç©ç©"><a href="#éšä¾¿ç©ç©" class="headerlink" title="éšä¾¿ç©ç©"></a>éšä¾¿ç©ç©</h3><p>ã€€ã€€ç„¶åä½ å°±å¯ä»¥éšä¾¿å»æ‰§è¡Œä¸€äº›æ•°æ®å˜åŠ¨çš„ SQL è¯­å¥äº†ã€‚å½“ä½ æ‰§è¡Œäº†ä¸€å †è¯­å¥ä¹‹åå°±å¯ä»¥çœ‹åˆ°ä½ çš„ Binlog é‡Œé¢æœ‰å†…å®¹äº†ã€‚</p><p>ã€€ã€€å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œ<code>log_bin_basename</code> çš„å€¼æ˜¯ <code>/usr/local/var/mysql/master-bin</code> å°±æ˜¯ Binlog çš„åŸºç¡€æ–‡ä»¶åäº†ã€‚</p><p>ã€€ã€€é‚£æˆ‘ä»¬è¿›å»çœ‹ï¼Œæ¯”å¦‚æˆ‘çš„è¿™è¾¹å°±æœ‰è¿™ä¹ˆå‡ ä¸ªæ–‡ä»¶ï¼š</p><p><img src="binlog-files.jpg" alt="Binlog æ–‡ä»¶"></p><p>ã€€ã€€å¾ˆå®¹æ˜“å‘ç°ï¼Œé‡Œé¢æœ‰ <code>master-bin.index</code> å’Œ <code>master-bin.000001</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åœ¨ä¸Šæ–‡ä¸­æœ‰æåˆ°è¿‡äº†ã€‚</p><p>ã€€ã€€æˆ‘ä»¬æ‰“å¼€é‚£ä¸ª <code>master-bin.index</code> æ–‡ä»¶ï¼Œä¼šå‘ç°è¿™ä¸ªç´¢å¼•æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–‡æœ¬æ–‡ä»¶ï¼Œç„¶ååˆ—ä¸¾äº†å„ binlog çš„æ–‡ä»¶åã€‚è€Œ <code>master-bin.000001</code> æ–‡ä»¶å°±æ˜¯ä¸€å †ä¹±ç äº†â€”â€”æ¯•ç«Ÿäººå®¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><h2 id="ç»“æ„è§£æ"><a href="#ç»“æ„è§£æ" class="headerlink" title="ç»“æ„è§£æ"></a>ç»“æ„è§£æ</h2><h3 id="ç´¢å¼•æ–‡ä»¶"><a href="#ç´¢å¼•æ–‡ä»¶" class="headerlink" title="ç´¢å¼•æ–‡ä»¶"></a>ç´¢å¼•æ–‡ä»¶</h3><p>ã€€ã€€ç´¢å¼•æ–‡ä»¶å°±æ˜¯ä¸Šæ–‡ä¸­çš„ <code>master-bin.index</code> æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªæ™®é€šçš„æ–‡æœ¬æ–‡ä»¶ï¼Œä»¥æ¢è¡Œä¸ºé—´éš”ï¼Œä¸€è¡Œä¸€ä¸ªæ–‡ä»¶åã€‚æ¯”å¦‚å®ƒå¯èƒ½æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">master-bin.000001</span><br><span class="line">master-bin.000002</span><br><span class="line">master-bin.000003</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åå¯¹åº”çš„æ¯è¡Œæ–‡ä»¶å°±æ˜¯ä¸€ä¸ª Binlog å®ä½“æ–‡ä»¶äº†ã€‚</p><h3 id="Binlog-æ–‡ä»¶"><a href="#Binlog-æ–‡ä»¶" class="headerlink" title="Binlog æ–‡ä»¶"></a>Binlog æ–‡ä»¶</h3><p>ã€€ã€€Binlog çš„æ–‡ä»¶ç»“æ„å¤§è‡´ç”±å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ç»„æˆã€‚</p><h4 id="æ–‡ä»¶å¤´"><a href="#æ–‡ä»¶å¤´" class="headerlink" title="æ–‡ä»¶å¤´"></a>æ–‡ä»¶å¤´</h4><p>ã€€ã€€æ–‡ä»¶å¤´ç”±ä¸€ä¸ªå››å­—èŠ‚ Magic Numberï¼Œå…¶å€¼ä¸º <code>1852400382</code>ï¼Œåœ¨å†…å­˜ä¸­å°±æ˜¯ <code>&quot;\xfe\x62\x69\x6e&quot;</code>ï¼Œå‚è€ƒ MySQL æºç çš„ <a href="://github.com/mysql/mysql-server/blob/a2757a60a7527407d08115e44e889a25f22c96c6/sql/log_event.h#L187">log_event.h</a>ï¼Œä¹Ÿå°±æ˜¯ <code>&#39;\0xfe&#39; &#39;b&#39; &#39;i&#39; &#39;n&#39;</code>ã€‚</p><p>ã€€ã€€ä¸å¹³å¸¸äºŒè¿›åˆ¶ä¸€æ ·ï¼Œé€šå¸¸éƒ½æœ‰ä¸€ä¸ª Magic Number è¿›è¡Œæ–‡ä»¶è¯†åˆ«ï¼Œå¦‚æœ Magic Number ä¸å»åˆä¸Šè¿°çš„å€¼é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±ä¸æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ Binlogã€‚</p><h4 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h4><p>ã€€ã€€åœ¨æ–‡ä»¶å¤´ä¹‹åï¼Œè·Ÿéšçš„æ˜¯ä¸€ä¸ªä¸€ä¸ªäº‹ä»¶ä¾æ¬¡æ’åˆ—ã€‚æ¯ä¸ªäº‹ä»¶éƒ½ç”±ä¸€ä¸ªäº‹ä»¶å¤´å’Œäº‹ä»¶ä½“ç»„æˆã€‚</p><p>ã€€ã€€äº‹ä»¶å¤´é‡Œé¢çš„å†…å®¹åŒ…å«äº†è¿™ä¸ªäº‹ä»¶çš„ç±»å‹ï¼ˆå¦‚æ–°å¢ã€åˆ é™¤ç­‰ï¼‰ã€äº‹ä»¶æ‰§è¡Œæ—¶é—´ä»¥åŠæ˜¯å“ªä¸ªæœåŠ¡å™¨æ‰§è¡Œçš„äº‹ä»¶ç­‰ä¿¡æ¯ã€‚</p><p>ã€€ã€€ç¬¬ä¸€ä¸ªäº‹ä»¶æ˜¯ä¸€ä¸ªäº‹ä»¶æè¿°ç¬¦ï¼Œæè¿°äº†è¿™ä¸ª Binlog æ–‡ä»¶æ ¼å¼çš„ç‰ˆæœ¬ã€‚æ¥ä¸‹å»çš„ä¸€å †äº‹ä»¶å°†ä¼šæŒ‰ç…§ç¬¬ä¸€ä¸ªäº‹ä»¶æè¿°ç¬¦æ‰€æè¿°çš„ç»“æ„ç‰ˆæœ¬è¿›è¡Œè§£è¯»ã€‚æœ€åä¸€ä¸ªäº‹ä»¶æ˜¯ä¸€ä¸ªè¡”æ¥äº‹ä»¶ï¼ŒæŒ‡å®šäº†ä¸‹ä¸€ä¸ª Binlog æ–‡ä»¶åâ€”â€”æœ‰ç‚¹ç±»ä¼¼äºé“¾è¡¨é‡Œé¢çš„ <code>next</code> æŒ‡é’ˆã€‚</p><p>ã€€ã€€æ ¹æ®ã€Š<a href="High-Level Binary Log Structure and Contents">High-Level Binary Log Structure and Contents</a>ã€‹æ‰€è¿°ï¼Œä¸åŒç‰ˆæœ¬çš„ Binlog æ ¼å¼ä¸ä¸€å®šä¸€æ ·ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰ä¸€ä¸ªå®šæ€§ã€‚åœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œç›®å‰æœ‰ä¸‰ç§ç‰ˆæœ¬çš„æ ¼å¼ã€‚</p><ul><li>v1ï¼Œç”¨äº MySQL 3.2.3</li><li>v3ï¼Œç”¨äº MySQL 4.0.2 ä»¥åŠ 4.1.0</li><li>v4ï¼Œç”¨äº MySQL 5.0 ä»¥åŠæ›´é«˜ç‰ˆæœ¬</li></ul><p>ã€€ã€€å®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ª v2 ç‰ˆæœ¬ï¼Œä¸è¿‡åªåœ¨æ—©æœŸ 4.0.x çš„ MySQL ç‰ˆæœ¬ä¸­ä½¿ç”¨è¿‡ï¼Œä½†æ˜¯ v2 å·²ç»è¿‡äºé™ˆæ—§å¹¶ä¸”ä¸å†è¢« MySQL å®˜æ–¹æ”¯æŒäº†ã€‚</p><blockquote><p><strong>é€šå¸¸æˆ‘ä»¬ç°åœ¨ç”¨çš„ MySQL éƒ½æ˜¯åœ¨ 5.0 ä»¥ä¸Šçš„äº†ï¼Œæ‰€ä»¥å°±ç•¥è¿‡ v1 ~ v3 ç‰ˆæœ¬çš„ Binlogï¼Œå¦‚æœéœ€è¦äº†è§£ v1 ~ v3 ç‰ˆæœ¬çš„ Binlog å¯ä»¥è‡ªè¡Œå‰å¾€ä¸Šè¿°çš„ã€ŠHigh-levelâ€¦ã€‹æ–‡ç« æŸ¥çœ‹ã€‚</strong></p></blockquote><h5 id="äº‹ä»¶å¤´"><a href="#äº‹ä»¶å¤´" class="headerlink" title="äº‹ä»¶å¤´"></a>äº‹ä»¶å¤´</h5><p>ã€€ã€€ä¸€ä¸ªäº‹ä»¶å¤´æœ‰ 19 å­—èŠ‚ï¼Œä¾æ¬¡æ’åˆ—ä¸ºå››å­—èŠ‚çš„æ—¶é—´æˆ³ã€ä¸€å­—èŠ‚çš„å½“å‰äº‹ä»¶ç±»å‹ã€å››å­—èŠ‚çš„æœåŠ¡ç«¯ IDã€å››å­—èŠ‚çš„å½“å‰äº‹ä»¶é•¿åº¦æè¿°ã€å››å­—èŠ‚çš„ä¸‹ä¸ªäº‹ä»¶ä½ç½®ï¼ˆæ–¹ä¾¿è·³è½¬ï¼‰ä»¥åŠä¸¤å­—èŠ‚çš„æ ‡è¯†ã€‚</p><p>ã€€ã€€ç”¨ ASCII Diagram è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+---------+---------+---------+------------+-------------+-------+</span><br><span class="line">|timestamp|type code|server_id|event_length|next_position|flags  |</span><br><span class="line">|4 bytes  |1 byte   |4 bytes  |4 bytes     |4 bytes      |2 bytes|</span><br><span class="line">+---------+---------+---------+------------+-------------+-------+</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¹Ÿå¯ä»¥å­—èŠ‚ç¼–é€ ä¸€ä¸ªç»“æ„ä½“æ¥è§£è¯»è¿™ä¸ªå¤´ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BinlogEventHeader</span></span><br><span class="line">&#123;</span></span><br><span class="line">    <span class="keyword">int</span>   timestamp;</span><br><span class="line">    <span class="keyword">char</span>  type_code;</span><br><span class="line">    <span class="keyword">int</span>   server_id;</span><br><span class="line">    <span class="keyword">int</span>   event_length;</span><br><span class="line">    <span class="keyword">int</span>   next_position;</span><br><span class="line">    <span class="keyword">char</span>  flags[<span class="number">2</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½ è¦ç›´æ¥ç”¨è¿™ä¸ªç»“æ„ä½“æ¥è¯»å–æ•°æ®çš„è¯ï¼Œéœ€è¦åŠ ç‚¹æ‰‹è„šã€‚</p><p>å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ GCC æˆ–è€… G++ ç¼–è¯‘å™¨ä¼šå¯¹ç»“æ„ä½“è¿›è¡Œå­—èŠ‚å¯¹é½ï¼Œè¿™æ ·è¯»è¿›æ¥çš„æ•°æ®å°±ä¸å¯¹äº†ï¼Œå› ä¸º Binlog å¹¶ä¸æ˜¯å¯¹é½çš„ã€‚ä¸ºäº†ç»Ÿä¸€æˆ‘ä»¬éœ€è¦å–æ¶ˆè¿™ä¸ªç»“æ„ä½“çš„å­—èŠ‚å¯¹é½ï¼Œä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨ <code>#pragma pack(n)</code>ï¼Œä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨ <code>__attribute__((__packed__))</code>ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯åœ¨ç¼–è¯‘å™¨ç¼–è¯‘çš„æ—¶å€™å¼ºåˆ¶æŠŠæ‰€æœ‰çš„ç»“æ„ä½“å¯¹å…¶å–æ¶ˆï¼Œå³åœ¨ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨ <code>fpack-struct</code> å‚æ•°ï¼Œå¦‚ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ g++ temp.cpp -o a -fpack-struct=1</span><br></pre></td></tr></table></figure></blockquote><p>ã€€ã€€æ ¹æ®ä¸Šè¿°çš„ç»“æ„æˆ‘ä»¬å¯ä»¥æ˜ç¡®å¾—åˆ°å„å˜é‡åœ¨ç»“æ„ä½“é‡Œé¢çš„åç§»é‡ï¼Œæ‰€ä»¥åœ¨ MySQL æºç é‡Œé¢ï¼ˆ<a href="https://github.com/mysql/mysql-server/blob/5.7/libbinlogevents/include/binlog_event.h#L353" target="_blank" rel="external">libbinlogevents/include/binlog_event.h</a>ï¼‰æœ‰ä¸‹é¢å‡ ä¸ªå¸¸é‡ä»¥å¿«é€Ÿæ ‡è®°åç§»ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EVENT_TYPE_OFFSET    4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SERVER_ID_OFFSET     5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EVENT_LEN_OFFSET     9</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG_POS_OFFSET       13</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FLAGS_OFFSET         17</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€è€Œå…·ä½“æœ‰å“ªäº›äº‹ä»¶åˆ™åœ¨ <a href="https://github.com/mysql/mysql-server/blob/5.7/libbinlogevents/include/binlog_event.h#L245" target="_blank" rel="external">libbinlogevents/include/binlog_event.h#L245</a> é‡Œé¢è¢«å®šä¹‰ã€‚å¦‚æœ‰ä¸ª <code>FORMAT_DESCRIPTION_EVENT</code> äº‹ä»¶çš„ <code>type_code</code> æ˜¯ 15ã€<code>UPDATE_ROWS_EVENT</code> çš„ <code>type_code</code> æ˜¯ 31ã€‚</p><p>ã€€ã€€è¿˜æœ‰é‚£ä¸ª <code>next_position</code>ï¼Œåœ¨ v4 ç‰ˆæœ¬ä¸­ä»£è¡¨ä» Binlog ä¸€å¼€å§‹åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¼€å§‹çš„åç§»é‡ï¼Œæ¯”å¦‚åˆ°ç¬¬ä¸€ä¸ªäº‹ä»¶çš„ <code>next_position</code> å°±æ˜¯ 4ï¼Œå› ä¸ºæ–‡ä»¶å¤´æœ‰ä¸€ä¸ªå­—èŠ‚çš„é•¿åº¦ã€‚ç„¶åæ¥ä¸‹å»å¯¹äºäº‹ä»¶ n å’Œäº‹ä»¶ n + 1 æ¥è¯´ï¼Œä»–ä»¬æœ‰è¿™æ ·çš„å…³ç³»ï¼š</p><blockquote><p>next_position(n + 1) = next_position(n) + event_length(n)</p></blockquote><p>ã€€ã€€å…³äº flags æš‚æ—¶ä¸éœ€è¦äº†è§£å¤ªå¤šï¼Œå¦‚æœçœŸçš„æƒ³äº†è§£çš„è¯å¯ä»¥çœ‹çœ‹ MySQL çš„<a href="http://dev.mysql.com/doc/internals/en/event-flags.html" target="_blank" rel="external">ç›¸å…³å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h5 id="äº‹ä»¶ä½“"><a href="#äº‹ä»¶ä½“" class="headerlink" title="äº‹ä»¶ä½“"></a>äº‹ä»¶ä½“</h5><p>ã€€ã€€äº‹å®ä¸Šåœ¨ Binlog äº‹ä»¶ä¸­åº”è¯¥æ˜¯æœ‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œ<code>header</code>ã€<code>post-header</code> å’Œ <code>payload</code>ï¼Œä¸è¿‡é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬æŠŠ <code>post-header</code> å’Œ <code>payload</code> éƒ½å½’ç»“ä¸ºäº‹ä»¶ä½“ï¼Œå®é™…ä¸Šè¿™ä¸ª <code>post-header</code> é‡Œé¢æ”¾çš„æ˜¯ä¸€äº›å®šé•¿çš„æ•°æ®ï¼Œåªä¸è¿‡æœ‰æ—¶å€™æˆ‘ä»¬ä¸éœ€è¦ç‰¹åˆ«åœ°å…³å¿ƒã€‚æƒ³è¦æ·±å…¥äº†è§£å¯ä»¥å»æŸ¥çœ‹ MySQL çš„å®˜æ–¹æ–‡æ¡£ã€‚</p><p>ã€€ã€€æ‰€ä»¥å®é™…ä¸Šä¸€ä¸ªçœŸæ­£çš„äº‹ä»¶ä½“ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç”¨ ASCII Diagram è¡¨ç¤ºå°±åƒè¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+=====================================+</span><br><span class="line">| event  | fixed part (post-header)   |</span><br><span class="line">| data   +----------------------------+</span><br><span class="line">|        | variable part (payload)    |</span><br><span class="line">+=====================================+</span><br></pre></td></tr></table></figure><p>ã€€ã€€è€Œè¿™ä¸ª <code>post-header</code> å¯¹äºä¸åŒç±»å‹çš„äº‹ä»¶æ¥è¯´é•¿åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼ŒåŒç§ç±»å‹æ¥è¯´æ˜¯ä¸€æ ·çš„ï¼Œè€Œè¿™ä¸ªé•¿åº¦çš„é¢„å…ˆè§„å®šå°†ä¼šåœ¨ä¸€ä¸ªâ€œæ ¼å¼æè¿°äº‹ä»¶â€ä¸­å®šå¥½ã€‚</p><h5 id="æ ¼å¼æè¿°äº‹ä»¶"><a href="#æ ¼å¼æè¿°äº‹ä»¶" class="headerlink" title="æ ¼å¼æè¿°äº‹ä»¶"></a>æ ¼å¼æè¿°äº‹ä»¶</h5><p>ã€€ã€€åœ¨ä¸Šæ–‡æˆ‘ä»¬æœ‰æåˆ°è¿‡ï¼Œåœ¨ Magic Number ä¹‹åè·Ÿç€çš„æ˜¯ä¸€ä¸ªæ ¼å¼æè¿°äº‹ä»¶ï¼ˆFormat Description Eventï¼‰ï¼Œå…¶å®è¿™åªæ˜¯åœ¨ v4 ç‰ˆæœ¬ä¸­çš„ç§°å‘¼ï¼Œåœ¨ä»¥å‰çš„ç‰ˆæœ¬é‡Œé¢å«èµ·å§‹äº‹ä»¶ï¼ˆStart Eventï¼‰ã€‚</p><p>ã€€ã€€åœ¨ v4 ç‰ˆæœ¬ä¸­è¿™ä¸ªäº‹ä»¶çš„ç»“æ„å¦‚ä¸‹é¢çš„ ASCII Diagram æ‰€ç¤ºã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+=====================================+</span><br><span class="line">| event  | timestamp         0 : 4    |</span><br><span class="line">| header +----------------------------+</span><br><span class="line">|        | type_code         4 : 1    | = FORMAT_DESCRIPTION_EVENT = 15</span><br><span class="line">|        +----------------------------+</span><br><span class="line">|        | server_id         5 : 4    |</span><br><span class="line">|        +----------------------------+</span><br><span class="line">|        | event_length      9 : 4    | &gt;= 91</span><br><span class="line">|        +----------------------------+</span><br><span class="line">|        | next_position    13 : 4    |</span><br><span class="line">|        +----------------------------+</span><br><span class="line">|        | flags            17 : 2    |</span><br><span class="line">+=====================================+</span><br><span class="line">| event  | binlog_version   19 : 2    | = 4</span><br><span class="line">| data   +----------------------------+</span><br><span class="line">|        | server_version   21 : 50   |</span><br><span class="line">|        +----------------------------+</span><br><span class="line">|        | create_timestamp 71 : 4    |</span><br><span class="line">|        +----------------------------+</span><br><span class="line">|        | header_length    75 : 1    |</span><br><span class="line">|        +----------------------------+</span><br><span class="line">|        | post-header      76 : n    | = array of n bytes, one byte per event</span><br><span class="line">|        | lengths for all            |   type that the server knows about</span><br><span class="line">|        | event types                |</span><br><span class="line">+=====================================+</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸ªäº‹ä»¶çš„ <code>type_code</code> æ˜¯ 15ï¼Œç„¶å <code>event_length</code> æ˜¯å¤§äºç­‰äº 91 çš„å€¼çš„ï¼Œè¿™ä¸ªä¸»è¦å–å†³äºæ‰€æœ‰äº‹ä»¶ç±»å‹æ•°ã€‚</p><p>ã€€ã€€å› ä¸ºä»ç¬¬ 76 å­—èŠ‚å¼€å§‹åé¢çš„äºŒè¿›åˆ¶å°±ä»£è¡¨ä¸€ä¸ªå­—èŠ‚ç±»å‹çš„æ•°ç»„äº†ï¼Œä¸€ä¸ªå­—èŠ‚ä»£è¡¨ä¸€ä¸ªäº‹ä»¶ç±»å‹çš„ <code>post-header</code> é•¿åº¦ï¼Œå³æ¯ä¸ªäº‹ä»¶ç±»å‹å›ºå®šæ•°æ®çš„é•¿åº¦ã€‚</p><p>ã€€ã€€é‚£ä¹ˆæŒ‰ç…§ä¸Šè¿°çš„ä¸€äº›çº¿ç´¢æ¥çœ‹ï¼Œæˆ‘ä»¬èƒ½éå¸¸å¿«åœ°å†™å‡ºä¸€ä¸ªç®€å•çš„è§£è¯» Binlog æ ¼å¼æè¿°äº‹ä»¶çš„ä»£ç ã€‚</p><blockquote><p>å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œå¦‚æœéœ€è¦æ­£å¸¸è§£è¯» Binlog æ–‡ä»¶çš„è¯ï¼Œä¸‹é¢çš„ä»£ç ç¼–è¯‘æ—¶å€™éœ€è¦åŠ ä¸Š <code>-fpack-struct=1</code> è¿™ä¸ªå‚æ•°ã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BinlogEventHeader</span></span><br><span class="line">&#123;</span></span><br><span class="line">    <span class="keyword">int</span>  timestamp;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> type_code;</span><br><span class="line">    <span class="keyword">int</span>  server_id;</span><br><span class="line">    <span class="keyword">int</span>  event_length;</span><br><span class="line">    <span class="keyword">int</span>  next_position;</span><br><span class="line">    <span class="keyword">short</span> flags;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    FILE* fp = fopen(<span class="string">"/usr/local/var/mysql/master-bin.000001"</span>, <span class="string">"rb"</span>);</span><br><span class="line">    <span class="keyword">int</span> magic_number;</span><br><span class="line">    fread(&amp;magic_number, <span class="number">4</span>, <span class="number">1</span>, fp);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d - %s\n"</span>, magic_number, (<span class="keyword">char</span>*)(&amp;magic_number));</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BinlogEventHeader</span> <span class="title">format_description_event_header</span>;</span></span><br><span class="line">    fread(&amp;format_description_event_header, <span class="number">19</span>, <span class="number">1</span>, fp);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"BinlogEventHeader\n&#123;\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    timestamp: %d\n"</span>, format_description_event_header.timestamp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    type_code: %d\n"</span>, format_description_event_header.type_code);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    server_id: %d\n"</span>, format_description_event_header.server_id);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    event_length: %d\n"</span>, format_description_event_header.event_length);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    next_position: %d\n"</span>, format_description_event_header.next_position);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"    flags[]: %d\n&#125;\n"</span>, format_description_event_header.flags);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">short</span> binlog_version;</span><br><span class="line">    fread(&amp;binlog_version, <span class="number">2</span>, <span class="number">1</span>, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"binlog_version: %d\n"</span>, binlog_version);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> server_version[<span class="number">51</span>];</span><br><span class="line">    fread(server_version, <span class="number">50</span>, <span class="number">1</span>, fp);</span><br><span class="line">    server_version[<span class="number">50</span>] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"server_version: %s\n"</span>, server_version);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> create_timestamp;</span><br><span class="line">    fread(&amp;create_timestamp, <span class="number">4</span>, <span class="number">1</span>, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"create_timestamp: %d\n"</span>, create_timestamp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> header_length;</span><br><span class="line">    fread(&amp;header_length, <span class="number">1</span>, <span class="number">1</span>, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"header_length: %d\n"</span>, header_length);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> type_count = format_description_event_header.event_length - <span class="number">76</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> post_header_length[type_count];</span><br><span class="line">    fread(post_header_length, <span class="number">1</span>, type_count, fp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; type_count; i++) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"  - type %d: %d\n"</span>, i + <span class="number">1</span>, post_header_length[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸ªæ—¶å€™ä½ å¾—åˆ°çš„ç»“æœæœ‰å¯èƒ½å°±æ˜¯è¿™æ ·çš„äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1852400382 - ï¿½binpzï¿½</span><br><span class="line">BinlogEventHeader</span><br><span class="line">&#123;</span><br><span class="line">    timestamp: 1439186734</span><br><span class="line">    type_code: 15</span><br><span class="line">    server_id: 1</span><br><span class="line">    event_length: 116</span><br><span class="line">    next_position: 120</span><br><span class="line">    flags[]: 1</span><br><span class="line">&#125;</span><br><span class="line">binlog_version: 4</span><br><span class="line">server_version: 5.6.24-log</span><br><span class="line">create_timestamp: 1439186734</span><br><span class="line">header_length: 19</span><br><span class="line">  - type 1: 56</span><br><span class="line">  - type 2: 13</span><br><span class="line">  - type 3: 0</span><br><span class="line">  - type 4: 8</span><br><span class="line">  - type 5: 0</span><br><span class="line">  - type 6: 18</span><br><span class="line">  - ...</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸€å…±ä¼šè¾“å‡º 40 ç§ç±»å‹ï¼ˆä» 1 åˆ° 40ï¼‰ï¼Œå¦‚å®˜æ–¹æ–‡æ¡£æ‰€è¯´ï¼Œè¿™ä¸ªæ•°ç»„ä» <code>START_EVENT_V3</code> äº‹ä»¶å¼€å§‹ï¼ˆ<code>type_code</code> æ˜¯ 1ï¼‰ã€‚</p><h5 id="è·³è½¬äº‹ä»¶"><a href="#è·³è½¬äº‹ä»¶" class="headerlink" title="è·³è½¬äº‹ä»¶"></a>è·³è½¬äº‹ä»¶</h5><p>ã€€ã€€è·³è½¬äº‹ä»¶å³ <code>ROTATE_EVENT</code>ï¼Œå…¶ <code>type_code</code> æ˜¯ 4ï¼Œå…¶ <code>post-header</code> é•¿åº¦ä¸º 8ã€‚</p><p>ã€€ã€€å½“ä¸€ä¸ª Binlog æ–‡ä»¶å¤§å°å·²ç»å·®ä¸å¤šè¦åˆ†å‰²äº†ï¼Œå®ƒå°±ä¼šåœ¨æœ«å°¾è¢«å†™å…¥ä¸€ä¸ª <code>ROTATE_EVENT</code>â€”â€”ç”¨äºæŒ‡å‡ºè¿™ä¸ª Binlog çš„ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>ã€€ã€€å®ƒçš„ <code>post-header</code> æ˜¯ 8 å­—èŠ‚çš„ä¸€ä¸ªä¸œè¥¿ï¼Œå†…å®¹é€šå¸¸å°±æ˜¯ä¸€ä¸ªæ•´æ•° <code>4</code>ï¼Œç”¨äºè¡¨ç¤ºä¸‹ä¸€ä¸ª Binlog æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªäº‹ä»¶èµ·å§‹åç§»é‡ã€‚æˆ‘ä»¬ä»ä¸Šæ–‡å°±èƒ½å¾—å‡ºåœ¨ä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªæ•°å­—åªå¯èƒ½æ˜¯å››ï¼Œå°±åç§»äº†ä¸€ä¸ªé­”æ³•æ•°å­—ã€‚å½“ç„¶æˆ‘ä»¬è®²çš„æ˜¯åœ¨ v4 è¿™ä¸ª Binlog ç‰ˆæœ¬ä¸‹çš„æƒ…å†µã€‚</p><p>ã€€ã€€ç„¶ååœ¨ <code>payload</code> ä½ç½®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå³ä¸‹ä¸€ä¸ª Binlog æ–‡ä»¶çš„æ–‡ä»¶åã€‚</p><h5 id="å„ç§ä¸åŒçš„äº‹ä»¶ä½“"><a href="#å„ç§ä¸åŒçš„äº‹ä»¶ä½“" class="headerlink" title="å„ç§ä¸åŒçš„äº‹ä»¶ä½“"></a>å„ç§ä¸åŒçš„äº‹ä»¶ä½“</h5><p>ã€€ã€€ç”±äºç¯‡å¹…åŸå› è¿™é‡Œå°±ä¸è¯¦ç»†ä¸¾ä¾‹å…¶å®ƒæ™®é€šçš„ä¸åŒäº‹ä»¶ä½“äº†ï¼Œå…·ä½“çš„è¯¦è§£åœ¨ <a href="http://dev.mysql.com/doc/internals/en/event-data-for-specific-event-types.html" target="_blank" rel="external">MySQL æ–‡æ¡£</a>ä¸­ä¸€æ ·æœ‰ä»‹ç»ï¼Œç”¨åˆ°ä»€ä¹ˆç±»å‹çš„äº‹ä»¶ä½“å°±å¯ä»¥è‡ªå·±å»æŸ¥è¯¢ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ã€€ã€€æœ¬æ–‡å¤§æ¦‚ä»‹ç»äº† Binlog çš„ä¸€äº›æƒ…å†µï¼Œä»¥åŠ Binlog çš„å†…éƒ¨äºŒè¿›åˆ¶è§£æç»“æ„ã€‚æ–¹ä¾¿å¤§å®¶é€ è½®å­ç”¨â€”â€”ä¸ç„¶è€ç”¨åˆ«äººçš„è½®å­ï¼ŒåªçŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶å¤šæ²¡åŠ²ã€‚</p><p>ã€€ã€€å¥½äº†è¦ä¸‹ç­äº†ï¼Œå°±å†™åˆ°è¿™é‡Œè¿‡å§ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="http://my.oschina.net/leejun2005/blog/75273" target="_blank" rel="external">MySQLâ€™s binary log ç»“æ„ç®€ä»‹</a>ï¼Œç›®æµ‹åŸæ–‡åœ¨ <a href="http://www.taobaodba.com/html/474_mysqls-binary-log_details.html" target="_blank" rel="external">TaobaoDBA</a>ï¼ˆå·²æ— æ³•è®¿é—®ï¼‰</li><li><a href="http://www.linuxidc.com/Linux/2014-09/107095.htm" target="_blank" rel="external">MySQL Binlog çš„ä»‹ç»</a></li><li><a href="http://blog.csdn.net/jolly10/article/details/13998761" target="_blank" rel="external">MySQL çš„ binary log åˆæ¢</a></li><li><a href="http://dev.mysql.com/doc/internals/en/binary-log-structure-and-contents.html" target="_blank" rel="external">High-Level Binary Log Structure and Contents</a> and related official documents</li><li><a href="http://stackoverflow.com/questions/21912098/pragma-pack-vs-fpack-struct-for-intel-c" target="_blank" rel="external">#pragma pack vs -fpack-struct for Intel C</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€èŠ±ç“£ç½‘çš„æœç´¢æ¶æ„éœ€è¦é‡æ„ï¼Œå°¤å…¶æ˜¯åœ¨ç´¢å¼•å»ºç«‹æˆ–è€…æ›´æ–°å±‚é¢ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ç›®å‰çš„ä¸€ä¸ªæ¶æ„å¯¼è‡´çš„ç»“æœå°±æ˜¯æ—¶é—´è¶Šä¹…ï¼Œæ•°æ®æœ¬ä½“ä¸æœç´¢å¼•æ“ç´¢å¼•ä¸­çš„æ•°æ®è¶Šä¸åŒæ­¥ï¼Œç›¸å·®ç”šå¤§ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€æ–°çš„ä¸€ä¸ªæ¶æ„æ‰“ç®—ä» MySQL çš„ Binlog ä¸­è¯»å–æ•°æ®æ›´æ–°ã€åˆ é™¤ã€æ–°å¢ç­‰å†å²è®°å½•
      
    
    </summary>
    
    
      <category term="MySQL" scheme="https://xcoder.in/tags/MySQL/"/>
    
      <category term="Binary Log" scheme="https://xcoder.in/tags/Binary-Log/"/>
    
      <category term="Binlog" scheme="https://xcoder.in/tags/Binlog/"/>
    
  </entry>
  
  <entry>
    <title>Node.js ä¸­ä½¿ç”¨ Redis æ¥å®ç°å®šæ—¶ä»»åŠ¡</title>
    <link href="https://xcoder.in/2015/06/05/scheduled-task-using-redis/"/>
    <id>https://xcoder.in/2015/06/05/scheduled-task-using-redis/</id>
    <published>2015-06-05T07:23:51.000Z</published>
    <updated>2017-12-11T07:59:20.542Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€å¥½ä¹…æ²¡å†™åšæ–‡äº†ï¼Œæœ€è¿‘åœ¨è·Ÿéšç€å…¬å¸å¤§ç‰›ä»¬çš„è„šæ­¥ç§˜å¯†ç ”å‘æ–°äº§å“ä¸­ã€‚</p><p>ã€€ã€€ä¸è¿‡å‰å‡ å¤©æœ‰ä¸€ä¸ªå°éœ€æ±‚çš„ä¸œè¥¿å¯ä»¥æå‡ºæ¥å†™ä¸€ç‚¹ç‚¹å°å¹²è´§å„¿è·Ÿå¤§å®¶åˆ†äº«åˆ†äº«ã€‚ç±³å¨œæ¡‘ä¼šçš„å°±å¯ä»¥å¿½ç•¥äº†ï¼Œåæ­£æˆ‘ä¹Ÿæ˜¯éšä¾¿å†™çš„ï¼›å¦‚æœè§‰å¾—æœ¬æ–‡å¯¹ä½ æœ‰ç”¨çš„è¯è¿˜è¯·å¤šå¤šæ”¯æŒå–µã€‚(â—Â´Ï‰ï½€â—)ã‚</p><h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><p>ã€€ã€€æœ¬æ–‡æ‰€è¯´çš„å®šæ—¶ä»»åŠ¡æˆ–è€…è¯´è®¡åˆ’ä»»åŠ¡å¹¶ä¸æ˜¯å¾ˆå¤šäººæƒ³è±¡ä¸­çš„é‚£æ ·ï¼Œæ¯”å¦‚è¯´æ¯å¤©å‡Œæ™¨ä¸‰ç‚¹è‡ªåŠ¨è¿è¡Œèµ·æ¥è·‘ä¸€ä¸ªè„šæœ¬ã€‚è¿™ç§éƒ½å·²ç»çƒ‚å¤§è¡—äº†ï¼Œéšä¾¿ä¸€ä¸ª <strong><a href="https://wiki.archlinux.org/index.php/Cron" target="_blank" rel="external">Crontab</a></strong> å°±èƒ½æå®šäº†ã€‚</p><p>ã€€ã€€è¿™é‡Œæ‰€è¯´çš„å®šæ—¶ä»»åŠ¡å¯ä»¥è¯´æ˜¯è®¡æ—¶å™¨ä»»åŠ¡ï¼Œæ¯”å¦‚è¯´ç”¨æˆ·è§¦å‘äº†æŸä¸ªåŠ¨ä½œï¼Œé‚£ä¹ˆä»è¿™ä¸ªç‚¹å¼€å§‹è¿‡äºŒåå››å°æ—¶æˆ‘ä»¬è¦å¯¹è¿™ä¸ªåŠ¨ä½œåšç‚¹ä»€ä¹ˆã€‚é‚£ä¹ˆå¦‚æœæœ‰ 1000 ä¸ªç”¨æˆ·è§¦å‘äº†è¿™ä¸ªåŠ¨ä½œï¼Œå°±ä¼šæœ‰ 1000 ä¸ªå®šæ—¶ä»»åŠ¡ã€‚äºæ˜¯è¿™å°±ä¸æ˜¯ <strong>Cron</strong> èŒƒç•´é‡Œé¢çš„å†…å®¹äº†ã€‚</p><p>ã€€ã€€ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªç”¨æˆ·æ¨èäº†å¦ä¸€ä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬å®šä¸€ä¸ªäºŒåå››å°æ—¶ä¹‹åçš„ä»»åŠ¡ï¼Œçœ‹çœ‹è¢«æ¨èçš„ç”¨æˆ·æœ‰æ²¡æœ‰æ¥æ³¨å†Œï¼Œå¦‚æœæ²¡æ³¨å†Œå°±ç»™ä»–æä¸€æ¡çŸ­ä¿¡è¿‡å»ã€‚Î£&gt;â€•(ã€ƒÂ°Ï‰Â°ã€ƒ)â™¡â†’</p><h2 id="æœ€åˆçš„è®¾æƒ³"><a href="#æœ€åˆçš„è®¾æƒ³" class="headerlink" title="æœ€åˆçš„è®¾æƒ³"></a>æœ€åˆçš„è®¾æƒ³</h2><p>ã€€ã€€ä¸€å¼€å§‹æˆ‘æ˜¯æƒ³æŠŠè¿™ä¸ªè®¡æ—¶å™¨åšåœ¨å†…å­˜é‡Œé¢ç›´æ¥è°ƒç”¨çš„ã€‚</p><p>ã€€ã€€è€ƒè™‘åˆ° Node.js çš„å®šæ—¶å¹¶ä¸æ˜¯é‚£ä¹ˆå‡†ç¡®ï¼ˆæ— è®ºæ˜¯ <code>setTimeout</code> è¿˜æ˜¯ <code>setInterval</code>ï¼‰ï¼Œæ‰€ä»¥æœ¬æ¥æ‰“ç®—è‡ªå·±ç»´æŠ¤è¿™ä¸ªå®šæ—¶å™¨é˜Ÿåˆ—ã€‚</p><p>ã€€ã€€åˆè€ƒè™‘åˆ° Node.js åŸç”Ÿå¯¹è±¡æ¯”è¾ƒè€—å†…å­˜ã€‚ä¹‹å‰æˆ‘ç”¨ <code>JSON</code> å¯¹è±¡å­˜äº†ä¸€æœ¬å­—å…¸ï¼Œçº¦åäºŒä¸‡å¤šçš„è¯æ¡ï¼ŒåŸæ–‡ä»¶å¤§æ¦‚ä¹Ÿå°±äº”å…­å…†ï¼Œç”¨ Node.js çš„åŸç”Ÿå¯¹è±¡ä¸€å­˜å±…ç„¶æœ‰äº”å…­ç™¾å…†çš„å†…å­˜å ç”¨â€”â€”æ‰€ä»¥æ‰“ç®—è¿™ä¸ªå®šæ—¶å™¨é˜Ÿåˆ—ç”¨ C++ æ¥å†™ addonã€‚</p><p>ã€€ã€€è€ƒè™‘åˆ°ä»»ä½•æ—¶å€™æ’å…¥çš„ä»»åŠ¡éƒ½æœ‰å¯èƒ½åœ¨å·²æœ‰çš„ä»»åŠ¡ä¹‹å‰æˆ–è€…ä¹‹åï¼Œæ‰€ä»¥æœ¬æ¥æƒ³ç”¨ C++ æ¥å†™ä¸€ä¸ª<a href="http://zh.wikipedia.org/wiki/%E6%9C%80%E5%A4%A7%E2%80%94%E6%9C%80%E5%B0%8F%E5%A0%86" target="_blank" rel="external">å°æ ¹å †</a>ã€‚æ¯æ¬¡ç”¨æˆ·æ¥ä¸€ä¸ªä»»åŠ¡çš„æ—¶å€™å°±å°†è¿™ä¸ªä»»åŠ¡æ’å…¥åˆ°å †ä¸­ã€‚</p><p>ã€€ã€€å¦‚æœæŒ‰ç…§ä¸Šè¿°æ–¹æ³•çš„è¯ï¼Œå†åŠ ä¸Šå¯¹æ—¶é—´è¦æ±‚æå¾—ä¹Ÿä¸æ˜¯é‚£ä¹ˆç´§ï¼Œäºæ˜¯å°±æ˜¯ä¸€ä¸ªä¸æ–­çš„ <code>process.nextTick()</code> çš„è¿‡ç¨‹ã€‚</p><p>ã€€ã€€åœ¨ <code>process.nextTick()</code> å½“ä¸­æ‰§è¡Œè¿™ä¹ˆä¸€ä¸ªå‡½æ•°ï¼š</p><ol><li>ä»å°æ ¹å †ä¸­ä¸æ–­è·å–å †é¡¶çš„ä»»åŠ¡å¹¶å¤„ç†ï¼Œä¸€ç›´å¤„ç†åˆ°å †é¡¶ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å¤§äºå½“å‰æ—¶é—´ä¸ºæ­¢ã€‚</li><li>ç»§ç»­ <code>process.nextTick()</code> æ¥è®©ä¸‹ä¸€ä¸ª tick æ‰§è¡Œæ­¥éª¤ 1 ä¸­çš„æµç¨‹ã€‚</li></ol><p>ã€€ã€€æ‰€ä»¥æœ€åå°±æ˜¯ä¸€è¾¹å¾€å°æ ¹å †æ’å…¥ä»»åŠ¡ï¼Œå¦ä¸€è¾¹é€šè¿‡ä¸æ–­ <code>process.nextTick()</code> æ¶ˆè´¹ä»»åŠ¡çš„è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹ã€‚</p><p>ã€€ã€€æœ€åï¼Œä¸ºäº†è€ƒè™‘åˆ°ç¨‹åºé‡å¯çš„æ—¶å€™å†…å­˜æ•°æ®ä¼šä¸¢å¤±ï¼Œè¿˜åº”è¯¥åšä¸€ä¸ªæŒä¹…åŒ–çš„äº‹æƒ…â€”â€”åœ¨æ¯æ¬¡æ’å…¥ä»»åŠ¡çš„æ—¶å€™é¡ºä¾¿å¾€æŒä¹…åŒ–ä¸­é—´ä»¶ä¸­æ’ä¸€æ¡å‰¯æœ¬ï¼Œæ¯”å¦‚ MySQLã€MongoDBã€Redisã€Riak ç­‰ç­‰ä»»ä½•ä¸‰æ–¹ä¾èµ–ã€‚æ¶ˆè´¹ä»»åŠ¡çš„æ—¶å€™é¡ºä¾¿æŠŠä¸­é—´ä»¶ä¸­çš„è¿™æ¡ä»»åŠ¡æ•°æ®ç»™åˆ é™¤ã€‚</p><p>ã€€ã€€ä¹Ÿå°±æ˜¯è¯´ä¸­é—´ä»¶ä¸­æ°¸è¿œå­˜çš„å°±æ˜¯å½“å‰å°šæœªå®Œæˆçš„ä»»åŠ¡ã€‚æ¯å½“ç¨‹åºé‡å¯çš„æ—¶å€™éƒ½å…ˆä»ä¸­é—´ä»¶ä¸­æŠŠæ‰€æœ‰ä»»åŠ¡è¯»å–è¿›æ¥é‡å»ºä¸€ä¸‹å †ï¼Œç„¶åå°±èƒ½ç»§ç»­å·¥ä½œäº†ã€‚</p><blockquote><p>å¦‚æœå½“æ—¶æˆ‘æ²¡æœ‰å‘ç° Redis çš„è¿™ä¸ªå¦™ç”¨çš„è¯ï¼Œä¸Šè¿°çš„æµç¨‹å°†ä¼šæ˜¯æˆ‘å®ç°æˆ‘ä»¬å®šæ—¶ä»»åŠ¡çš„æµç¨‹äº†ã€‚</p></blockquote><h2 id="Redis-å¦™ç”¨"><a href="#Redis-å¦™ç”¨" class="headerlink" title="Redis å¦™ç”¨"></a>Redis å¦™ç”¨</h2><p>ã€€ã€€åœ¨ Redis çš„ 2.8.0 ç‰ˆæœ¬ä¹‹åï¼Œå…¶æ¨å‡ºäº†ä¸€ä¸ªæ–°çš„ç‰¹æ€§â€”â€”é”®ç©ºé—´æ¶ˆæ¯ï¼ˆ<a href="http://redis.io/topics/notifications" target="_blank" rel="external">Redis Keyspace Notifications</a>ï¼‰ï¼Œå®ƒé…åˆ 2.0.0 ç‰ˆæœ¬ä¹‹åçš„ <code>SUBSCRIBE</code> å°±èƒ½å®Œæˆè¿™ä¸ªå®šæ—¶ä»»åŠ¡çš„æ“ä½œäº†ï¼Œ<strong>ä¸è¿‡å®šæ—¶çš„å•ä½æ˜¯ç§’</strong>ã€‚</p><h3 id="Publish-Subscribe"><a href="#Publish-Subscribe" class="headerlink" title="Publish / Subscribe"></a>Publish / Subscribe</h3><p>ã€€ã€€Redis åœ¨ 2.0.0 ä¹‹åæ¨å‡ºäº† <a href="http://redis.io/topics/pubsub" target="_blank" rel="external">Pub / Sub</a> çš„æŒ‡ä»¤ï¼Œå¤§è‡´å°±æ˜¯è¯´ä¸€è¾¹ç»™ Redis çš„ç‰¹å®šé¢‘é“å‘é€æ¶ˆæ¯ï¼Œå¦ä¸€è¾¹ä» Redis çš„ç‰¹å®šé¢‘é“å–å€¼â€”â€”å½¢æˆäº†ä¸€ä¸ªç®€æ˜“çš„æ¶ˆæ¯é˜Ÿåˆ—</p><p>ã€€ã€€æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å¾€ <code>foo</code> é¢‘é“æ¨ä¸€ä¸ªæ¶ˆæ¯ <code>bar</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PUBLISH foo bar</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¦ä¸€è¾¹æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯è®¢é˜… <code>foo</code> é¢‘é“å°±èƒ½æ¥å—åˆ°è¿™ä¸ªæ¶ˆæ¯äº†ã€‚</p><p>ã€€ã€€ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœåœ¨ Node.js é‡Œé¢ä½¿ç”¨ <a href="https://github.com/luin/ioredis" target="_blank" rel="external">ioredis</a> è¿™ä¸ªåŒ…é‚£ä¹ˆçœ‹èµ·æ¥å°±ä¼šåƒè¿™æ ·ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Redis = <span class="built_in">require</span>(<span class="string">"ioredis"</span>);</span><br><span class="line"><span class="keyword">var</span> sub = <span class="keyword">new</span> Redis(<span class="comment">/** è¿æ¥ä¿¡æ¯ */</span>);</span><br><span class="line">sub.once(<span class="string">"connect"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å‡è®¾æˆ‘ä»¬éœ€è¦é€‰æ‹© redis çš„ dbï¼Œå› ä¸ºå®é™…ä¸Šæˆ‘ä»¬ä¸ä¼šå»æ±¡æŸ“é»˜è®¤çš„ db 0</span></span><br><span class="line">    sub.select(DB_NUMBER, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) process.exit(<span class="number">4</span>);</span><br><span class="line">        sub.subscribe(<span class="string">"foo"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//... è®¢é˜…é¢‘é“æˆåŠŸ</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ä» `foo` æ¥çš„æ¶ˆæ¯</span></span><br><span class="line">sub.on(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">channel, msg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(channel, msg);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Redis-Keyspace-Notifications"><a href="#Redis-Keyspace-Notifications" class="headerlink" title="Redis Keyspace Notifications"></a>Redis Keyspace Notifications</h3><p>ã€€ã€€åœ¨ Redis é‡Œé¢æœ‰ä¸€äº›äº‹ä»¶ï¼Œæ¯”å¦‚é”®åˆ°æœŸã€é”®è¢«åˆ é™¤ç­‰ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®ä¸€äº›ä¸œè¥¿æ¥è®© Redis ä¸€æ—¦è§¦å‘è¿™äº›äº‹ä»¶çš„æ—¶å€™å°±å¾€ç‰¹å®šçš„ Channel æ¨ä¸€æ¡æ¶ˆæ¯ã€‚</p><p>ã€€ã€€æœ¬æ–‡æ‰€æ¶‰åŠåˆ°çš„éœ€æ±‚çš„è¯æˆ‘ä»¬æ‰€éœ€è¦å…³å¿ƒçš„äº‹ä»¶æ˜¯ <code>EXPIRE</code> å³è¿‡æœŸäº‹ä»¶ã€‚</p><p>ã€€ã€€å¤§è‡´çš„æµç¨‹å°±æ˜¯æˆ‘ä»¬ç»™ Redis çš„æŸä¸€ä¸ª db è®¾ç½®è¿‡æœŸäº‹ä»¶ï¼Œä½¿å…¶é”®ä¸€æ—¦è¿‡æœŸå°±ä¼šå¾€ç‰¹å®šé¢‘é“æ¨æ¶ˆæ¯ï¼Œæˆ‘åœ¨è‡ªå·±çš„å®¢æˆ·ç«¯è¿™è¾¹å°±ä¸€ç›´æ¶ˆè´¹è¿™ä¸ªé¢‘é“å°±å¥½äº†ã€‚</p><p>ã€€ã€€ä»¥åä¸€æ¥ä¸€æ¡å®šæ—¶ä»»åŠ¡ï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªä»»åŠ¡çŠ¶æ€å‹ç¼©æˆä¸€ä¸ªé”®ï¼Œå¹¶ä¸”è¿‡æœŸæ—¶é—´ä¸ºè·è¿™ä¸ªä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´å·®ã€‚é‚£ä¹ˆå½“é”®ä¸€æ—¦åˆ°æœŸï¼Œå°±åˆ°äº†ä»»åŠ¡è¯¥æ‰§è¡Œçš„æ—¶é—´ï¼ŒRedis è‡ªç„¶ä¼šæŠŠè¿‡æœŸæ¶ˆæ¯æ¨å»ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯å°±èƒ½æ¥æ”¶åˆ°äº†ã€‚è¿™æ ·ä¸€æ¥å°±èµ·åˆ°äº†å®šæ—¶ä»»åŠ¡çš„ä½œç”¨ã€‚</p><h4 id="æ¶ˆæ¯ç±»å‹"><a href="#æ¶ˆæ¯ç±»å‹" class="headerlink" title="æ¶ˆæ¯ç±»å‹"></a>æ¶ˆæ¯ç±»å‹</h4><p>ã€€ã€€å½“è¾¾åˆ°ä¸€å®šæ¡ä»¶åï¼Œæœ‰ä¸¤ç§ç±»å‹çš„è¿™ç§æ¶ˆæ¯ä¼šè¢«è§¦å‘ï¼Œç”¨å“ªä¸ªéœ€è¦è‡ªå·±é€‰äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åˆ é™¤äº†åœ¨ db 0 ä¸­ä¸€ä¸ªå« <code>foo</code> çš„é”®ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šå¾€ä¸¤ä¸ªé¢‘é“æ¨æ¶ˆæ¯ï¼Œä¸€ä¸ªæ˜¯ <code>del</code> äº‹ä»¶é¢‘é“æ¨ <code>foo</code> æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªæ˜¯ <code>foo</code> é¢‘é“æ¨ <code>del</code> æ¶ˆæ¯ï¼Œå®ƒä»¬å°ä¿©å£è¢«ç³»ç»Ÿæ¨é€çš„æŒ‡ä»¤åˆ†åˆ«ç­‰ä»·äºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PUBLISH __keyspace@0__:foo del</span><br><span class="line">PUBLISH __keyevent@0__:del foo</span><br></pre></td></tr></table></figure><p>ã€€ã€€å…¶ä¸­å¾€ <code>foo</code> æ¨é€ <code>del</code> çš„é¢‘é“åä¸º <code>__keyspace@0__:foo</code>ï¼Œå³æ˜¯ <code>&quot;__keyspace@&quot; + DB_NUMBER + &quot;__:&quot; + KEY_NAME</code>ï¼›è€Œ <code>del</code> çš„é¢‘é“åä¸º <code>&quot;__keyevent@&quot; + DB_NUMBER + &quot;__:&quot; + EVENT_NAME</code>ã€‚</p><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ã€€ã€€å³ä½¿ä½ çš„ Redis ç‰ˆæœ¬è¾¾æ ‡äº†ï¼Œä½†æ˜¯ Redis é»˜è®¤æ˜¯å…³é—­è¿™ä¸ªåŠŸèƒ½çš„ï¼Œä½ éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æ‰“å¼€å®ƒï¼Œæˆ–è€…ç›´æ¥åœ¨ CLI é‡Œé¢é€šè¿‡æŒ‡ä»¤ä¿®æ”¹ã€‚è¿™é‡Œå°±è¯´è¯´é…ç½®æ–‡ä»¶çš„ä¿®æ”¹å§ã€‚</p><p>ã€€ã€€å¦‚æœä¸æƒ³çœ‹æˆ‘åœ¨è¿™é‡Œç½—é‡Œå§å—¦çš„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å»çœ‹ Redis çš„<a href="http://redis.io/topics/notifications#configuration" target="_blank" rel="external">ç›¸å…³æ–‡æ¡£</a>ã€‚</p><p>ã€€ã€€é¦–å…ˆæ‰“å¼€ Redis çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸åŒçš„ç³»ç»Ÿå’Œå®‰è£…æ–¹å¼ä¸‹æ–‡ä»¶ä½ç½®å¯èƒ½ä¸åŒï¼Œæ¯”å¦‚é€šè¿‡ <code>brew</code> å®‰è£…çš„ MacOS ä¸‹å¯èƒ½æ˜¯åœ¨ <code>/usr/local/etc/redis.conf</code> ä¸‹é¢ï¼Œé€šè¿‡ <code>apt-get</code> å®‰è£…çš„ Ubuntu ä¸‹å¯èƒ½æ˜¯åœ¨ <code>/etc/redis/redis.conf</code> ä¸‹ï¼Œæ€»ä¹‹æ‰¾åˆ°é…ç½®æ–‡ä»¶ã€‚<strong>æˆ–è€…è‡ªå·±å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨çš„æ—¶å€™æŒ‡å®šé…ç½®æ–‡ä»¶åœ°å€å°±å¥½ã€‚</strong></p><p>ã€€ã€€ç„¶åæ‰¾åˆ°ä¸€é¡¹å« <code>notify-keyspace-events</code> çš„åœ°æ–¹ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™è‡ªè¡Œæ·»åŠ ï¼Œå…¶å€¼å¯ä»¥æ˜¯ <code>Ex</code>ã€<code>Klg</code> ç­‰ç­‰ã€‚è¿™äº›å­—æ¯çš„å…·ä½“å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><strong>K</strong>ï¼Œè¡¨ç¤º <code>keyspace</code> äº‹ä»¶ï¼Œæœ‰è¿™ä¸ªå­—æ¯è¡¨ç¤ºä¼šå¾€ <code>__keyspace@&lt;db&gt;__</code> é¢‘é“æ¨æ¶ˆæ¯ã€‚</li><li><strong>E</strong>ï¼Œè¡¨ç¤º <code>keyevent</code> äº‹ä»¶ï¼Œæœ‰è¿™ä¸ªå­—æ¯è¡¨ç¤ºä¼šå¾€ <code>__keyevent@&lt;db&gt;__</code> é¢‘é“æ¨æ¶ˆæ¯ã€‚</li><li><strong>g</strong>ï¼Œè¡¨ç¤ºä¸€äº›é€šç”¨æŒ‡ä»¤äº‹ä»¶æ”¯æŒï¼Œå¦‚ <code>DEL</code>ã€<code>EXPIRE</code>ã€<code>RENAME</code> ç­‰ç­‰ã€‚</li><li><strong>$</strong>ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ï¼ˆStringï¼‰ç›¸å…³æŒ‡ä»¤çš„äº‹ä»¶æ”¯æŒã€‚</li><li><strong>l</strong>ï¼Œè¡¨ç¤ºåˆ—è¡¨ï¼ˆListï¼‰ç›¸å…³æŒ‡ä»¤äº‹ä»¶æ”¯æŒã€‚</li><li><strong>s</strong>ï¼Œè¡¨ç¤ºé›†åˆï¼ˆSetï¼‰ç›¸å…³æŒ‡ä»¤äº‹ä»¶æ”¯æŒã€‚</li><li><strong>h</strong>ï¼Œå“ˆå¸Œï¼ˆHashï¼‰ç›¸å…³æŒ‡ä»¤äº‹ä»¶æ”¯æŒã€‚</li><li><strong>z</strong>ï¼Œæœ‰åºé›†ï¼ˆSorted Setï¼‰ç›¸å…³æŒ‡ä»¤äº‹ä»¶æ”¯æŒã€‚</li><li><strong>x</strong>ï¼Œè¿‡æœŸäº‹ä»¶ï¼Œä¸ <strong>g</strong> ä¸­çš„ <code>EXPIRE</code> ä¸åŒçš„æ˜¯ï¼Œ<strong>g</strong> çš„ <code>EXPIRE</code> æ˜¯æŒ‡æ‰§è¡Œ <code>EXPIRE key ttl</code> è¿™æ¡æŒ‡ä»¤çš„æ—¶å€™é¡ºä¾¿è§¦å‘çš„äº‹ä»¶ï¼Œè€Œè¿™é‡Œæ˜¯æŒ‡é‚£ä¸ª <code>key</code> åˆšå¥½è¿‡æœŸçš„è¿™ä¸ªæ—¶é—´ç‚¹è§¦å‘çš„äº‹ä»¶ã€‚</li><li><strong>e</strong>ï¼Œé©±é€äº‹ä»¶ï¼Œä¸€ä¸ª <code>key</code> ç”±äºå†…å­˜ä¸Šé™è€Œè¢«é©±é€çš„æ—¶å€™ä¼šè§¦å‘çš„äº‹ä»¶ã€‚</li><li><strong>A</strong>ï¼Œ<code>g$lshzxe</code> çš„åˆ«åã€‚ä¹Ÿå°±æ˜¯è¯´ <code>AKE</code> çš„æ„æ€å°±ä»£è¡¨äº†æ‰€æœ‰çš„äº‹ä»¶ã€‚</li></ul><p>ã€€ã€€ç»“åˆä¸Šè¿°åˆ—è¡¨æˆ‘ä»¬å°±èƒ½æ‹¼å‡‘å‡ºè‡ªå·±æ‰€éœ€è¦çš„äº‹ä»¶æ”¯æŒå­—ç¬¦ä¸²äº†ï¼Œåœ¨æˆ‘çš„éœ€æ±‚ä¸­æˆ‘åªéœ€è¦ <code>Ex</code> å°±å¯ä»¥æ»¡è¶³äº†ï¼Œæ‰€ä»¥é…ç½®é¡¹å°±æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">notify-keyspace-events Ex</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åä¿å­˜é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨ Redis å°±å¯ç”¨äº†è¿‡æœŸäº‹ä»¶çš„æ”¯æŒäº†ã€‚</p><h4 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h4><p>ã€€ã€€æˆ‘ä»¬å…ˆè¯´ä»»åŠ¡çš„åˆ›é€ è€…å§ã€‚ç”±äºè¿™é‡Œ <strong>Redis</strong> çš„äº‹ä»¶åªä¼šä¼ é”®åï¼Œå¹¶ä¸ä¼šä¼ é”®å€¼ï¼Œè€Œè¿‡æœŸäº‹ä»¶è§¦å‘çš„æ—¶å€™é‚£ä¸ªé”®å·²ç»æ²¡äº†ï¼Œä½ ä¹Ÿæ— æ³•è·å–é”®å€¼ï¼ŒåŠ ä¸Šæˆ‘çš„ä¸»ç³»ç»Ÿå’Œä»»åŠ¡ç³»ç»Ÿæ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰€ä»¥å°±æŠŠæ‰€æœ‰éœ€è¦çš„ä¿¡æ¯å¾€é”®åå¡ã€‚</p><p>ã€€ã€€ä¸€ä¸ªæœ€ç®€å•çš„é”®åè®¾è®¡å°±æ˜¯ <code>ä»»åŠ¡ç±»å‹ + &quot;:&quot; + JSON.stringify åŒ–åçš„å‚æ•°æ•°ç»„</code>ï¼›æ›´æœ‰ç”šè€…å¯ä»¥ç›´æ¥æŠŠä»»åŠ¡ç±»å‹æ›¿æ¢æˆæ‰€éœ€çš„å‡½æ•°è·¯å¾„ï¼Œæ¯”å¦‚éœ€è¦æ‰§è¡Œè¿™ä¸ªä»»åŠ¡çš„å‡½æ•°åœ¨ <code>task/foo/bar</code> æ–‡ä»¶ä¸‹é¢çš„ <code>baz</code> å‡½æ•°ï¼Œå‚æ•° <code>arguments</code> æ•°ç»„ä¸º <code>[ 1, 2 ]</code>ï¼Œé‚£ä¹ˆé”®åçš„è®¾è®¡å¯ä»¥æ˜¯ <code>task/foo/bar.baz:[1,2]</code>ï¼Œåæ­£æˆ‘ä»¬åªéœ€è¦è§¦å‘è¿™ä¸ªé”®ï¼Œç”¨ä¸ç€å»æŸ¥è¯¢è¿™ä¸ªé”®ã€‚ç­‰åˆ°çœŸæ­£è¿‡æœŸäº†ä»»åŠ¡ç³»ç»Ÿæ¥æ”¶åˆ°è¿™ä¸ªé”®åçš„æ—¶å€™å†ä¸€ä¸€è§£æï¼Œå¾—åˆ°éœ€è¦æ‰§è¡Œ <code>task/foo/bar.baz</code> è¿™ä¸ªæ¶ˆæ¯ï¼Œå¹¶ä¸”ç½‘å‡½æ•°é‡Œé¢ä¼ å…¥ <code>[1,2]</code> è¿™ä¸ª <code>arguments</code>ã€‚</p><p>ã€€ã€€æ‰€ä»¥å½“æ¥æ”¶åˆ°ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾—åˆ°æ¶ˆæ¯ã€å‡½æ•°åã€è¿‡æœŸæ—¶é—´å‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥å¦‚ä¸‹è®¾è®¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** æˆ‘ä»¬å‡è®¾ redis æ˜¯ä¸€ä¸ª ioredis çš„å¯¹è±¡ */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sampleTaskMaker = <span class="function"><span class="keyword">function</span>(<span class="params">message, func, timeout</span>) </span>&#123;</span><br><span class="line">    message = <span class="built_in">JSON</span>.stringify(message);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Received a new task:"</span>, func, message, <span class="string">"after "</span> + timeout + <span class="string">"."</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ uuid æ˜¯ npm ä¸€ä¸ªåŒ…</span></span><br><span class="line">    <span class="comment">// ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ uuid çš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ä¸¤ä¸ªä»»åŠ¡ç”¨äº†ç›¸åŒçš„å‡½æ•°å’Œå‚æ•°ï¼Œé‚£ä¹ˆ</span></span><br><span class="line">    <span class="comment">// é”®åå¯èƒ½ä¼šé‡å¤å¹¶è¦†ç›–çš„æƒ…å†µ</span></span><br><span class="line">    <span class="comment">// uuid çš„æ–‡æ¡£ä¸º https://www.npmjs.com/package/node-uuid</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ â¤ï¸ æ˜¯ä¸€ä¸ªåˆ†éš”ç¬¦ï¼Œå†’å·æ˜¯åˆ†å‰² uuid å’Œåé¢å†…å®¹çš„ï¼Œè€Œ â¤ï¸ æ˜¯åˆ†å‰²å‡½æ•°å</span></span><br><span class="line">    <span class="comment">// å’Œæ¶ˆæ¯çš„</span></span><br><span class="line">    <span class="keyword">var</span> key = uuid.v1().replace(<span class="regexp">/-/g</span>, <span class="string">""</span>) +</span><br><span class="line">        <span class="string">":â¤ï¸"</span> + func + <span class="string">"â¤ï¸"</span> + message;</span><br><span class="line">    <span class="keyword">var</span> content = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    redis.multi()</span><br><span class="line">        .set(key, content)</span><br><span class="line">        .expire(key, timeout)</span><br><span class="line">        .exec(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">"Failed to publish EXPIRE EVENT for "</span> + content);</span><br><span class="line">                <span class="built_in">console</span>.error(err);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>Ioredis çš„ç¨³å®šå¯ä»¥<a href="https://github.com/luin/ioredis" target="_blank" rel="external">ç‚¹æ­¤</a>æŸ¥çœ‹ã€‚</p></blockquote><p>ã€€ã€€ç„¶ååœ¨ä»»åŠ¡ç³»ç»Ÿé‡Œé¢çš„ä¸€å¼€å§‹ç›‘å¬è¿™ä¸ªè¿‡æœŸé¢‘é“ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// assign æ˜¯ sugarjs é‡Œé¢çš„å‡½æ•°</span></span><br><span class="line"><span class="comment">// æŠŠ db å¡åˆ°å­—ç¬¦ä¸²é‡Œé¢çš„ &#123;db&#125; é‡Œå»</span></span><br><span class="line"><span class="keyword">var</span> subscribeKey = <span class="string">"__keyevent@&#123;db&#125;__:expired"</span>.assign(&#123; <span class="attr">db</span>: <span class="number">1</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡è®¾ sub æ˜¯ ioredis çš„å¯¹è±¡</span></span><br><span class="line">sub.once(<span class="string">"connect"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å‡è®¾æˆ‘ä»¬éœ€è¦é€‰æ‹© redis çš„ dbï¼Œå› ä¸ºå®é™…ä¸Šæˆ‘ä»¬ä¸ä¼šå»æ±¡æŸ“é»˜è®¤çš„ db 0</span></span><br><span class="line">    sub.select(<span class="number">1</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) process.exit(<span class="number">4</span>);</span><br><span class="line">        sub.subscribe(<span class="string">"foo"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//... è®¢é˜…é¢‘é“æˆåŠŸ</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ä» `foo` æ¥çš„æ¶ˆæ¯</span></span><br><span class="line">sub.on(<span class="string">"message"</span>, sampleOnExpired);</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„ï¼š</strong> æˆ‘ä»¬è¿™é‡Œé€‰æ‹© db 1 æ˜¯å› ä¸ºä¸€æ—¦å¼€å¯è¿‡æœŸäº‹ä»¶ç›‘å¬ï¼Œé‚£ä¹ˆè¿™ä¸ª db çš„æ‰€æœ‰è¿‡æœŸäº‹ä»¶éƒ½ä¼šè¢«å‘é€ã€‚ä¸ºäº†ä¸è·Ÿæ­£å¸¸ä½¿ç”¨çš„ redis è¿‡æœŸé”®æ··æ·†ï¼Œæˆ‘ä»¬ä¸ºè¿™ä¸ªäº‹æƒ…ä¸“é—¨ç”¨ä¸€ä¸ªæ–°çš„ dbã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨è‡ªå·±æ­£å¸¸ä½¿ç”¨çš„ db 0 é‡Œé¢ç›‘å¬äº†ï¼Œé‚£ä¹ˆä¸æ˜¯æˆ‘ä»¬ä»»åŠ¡è§¦å‘çš„è¿‡æœŸäº‹ä»¶ä¹Ÿä¼šä¼ è¿‡æ¥ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è§£æçš„é”®åå°±ä¸å¯¹äº†ã€‚</p></blockquote><p>ã€€ã€€æœ€åå°±æ˜¯æˆ‘ä»¬çš„ <code>sampleOnExpired</code> å‡½æ•°äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> sampleOnExpired = <span class="function"><span class="keyword">function</span>(<span class="params">channel, key</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// UUID:â¤ï¸funcâ¤ï¸params</span></span><br><span class="line">    <span class="keyword">var</span> body = key.split(<span class="string">"â¤ï¸"</span>);</span><br><span class="line">    <span class="keyword">if</span>(body.length &lt; <span class="number">3</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–å‡º body ç¬¬ä¸€ä½ä¸º func</span></span><br><span class="line">    <span class="keyword">var</span> func = body[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨å‡ºå‰ä¸¤ä½ï¼Œåé¢å‰©ä¸‹çš„æœ‰å¯èƒ½æ˜¯å‚æ•°é‡Œé¢è‡ªå¸¦ â¤ï¸ è€Œè¢«åˆ†å‰²ï¼Œæ‰€ä»¥è¦æ‹¼å›å»</span></span><br><span class="line">    body.shift(); body.shift();</span><br><span class="line">    <span class="keyword">var</span> params = body.join(<span class="string">"â¤ï¸"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç„¶åæŠŠ params ä¼ å…¥ func å»æ‰§è¡Œ</span></span><br><span class="line">    <span class="comment">// func:</span></span><br><span class="line">    <span class="comment">//   path1/path2.func</span></span><br><span class="line">    func = func.split(<span class="string">"."</span>);</span><br><span class="line">    <span class="keyword">if</span>(func.length !== <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"Bad params for task:"</span>, func.join(<span class="string">"."</span>), <span class="string">"-"</span>, params);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> path = func[<span class="number">0</span>];</span><br><span class="line">    func = func[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mod;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        mod = <span class="built_in">require</span>(<span class="string">"./tasks/"</span> + path);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"Failed to load module"</span>, path);</span><br><span class="line">        <span class="built_in">console</span>.error(e.stack);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mod[func].apply(<span class="literal">null</span>, <span class="built_in">JSON</span>.parse(params));</span><br><span class="line">        &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"Failed to call function"</span>, path, <span class="string">"-"</span>, func, <span class="string">"-"</span>, params);</span><br><span class="line">            <span class="built_in">console</span>.error(e.stack);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸ªç®€æ˜“çš„æ¶å­æ­å¥½åï¼Œä½ åªéœ€è¦å»å†™ä¸€å †ä»»åŠ¡æ‰§è¡Œå‡½æ•°ï¼Œç„¶ååœ¨ç”Ÿæˆä»»åŠ¡çš„æ—¶å€™æŠŠç›¸åº”å‚æ•°ä¼ ç»™ <code>sampleTaskMaker</code> å°±å¥½äº†ã€‚Redis ä¼šè‡ªåŠ¨è¿‡æœŸå¹¶ä¸”è§¦å‘äº‹ä»¶ç»™ä½ çš„ <code>sampleOnExpired</code> å‡½æ•°ï¼Œç„¶åå°±ä¼šå»æ‰§è¡Œç›¸åº”çš„ä»»åŠ¡å¤„ç†å‡½æ•°äº†ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ã€€ã€€å…¶å®è¿™ä¸ªéœ€æ±‚åœ¨æˆ‘ä»¬é¡¹ç›®ç›®å‰å°±æ˜¯ç»™ç”¨æˆ·å®šæ—¶å‘æé†’çŸ­ä¿¡ç”¨çš„ã€‚å¦‚æœæ²¡æœ‰å‘ç° Redis çš„è¿™ä¸ªå¦™ç”¨ï¼Œæˆ‘è¿˜æ˜¯ä¼šå»ç”¨<a href="#æœ€åˆçš„è®¾æƒ³">ç¬¬äºŒèŠ‚</a>é‡Œé¢çš„æ–¹æ³•æ¥å†™çš„ã€‚å…¶å®è¿™æœŸé—´ä¹Ÿæœ‰è€ƒè™‘è¿‡ç”¨ RabbitMQï¼Œä¸è¿‡è²Œä¼¼å®ƒçš„å®šæ—¶æ¶ˆæ¯éœ€è¦åšä¸€äº› Hackï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæœ€åå°±æ”¾å¼ƒäº†ã€‚</p><p>ã€€ã€€Redis çš„è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯æˆ‘åœ¨è°·æ­Œæœå‡ºæ¥çš„ï¼Œåˆ«äººåœ¨ StackOverflow å›ç­”çš„ç­”æ¡ˆã€‚æˆ‘å‚è€ƒäº†ä¹‹åç”¨æˆ‘è‡ªå·±çš„æ–¹æ³•å®ç°äº†å‡ºæ¥ï¼Œå¹¶ä¸”æŠŠä»£ç çš„å…³é”®éƒ¨åˆ†æå–å‡ºæ¥æ•´ç†æˆè¿™ç¯‡å°æ–‡ï¼Œè¿˜å¸Œæœ›èƒ½ç»™å„ä½çœ‹å®˜ä¸€äº›ç”¨å§ï¼Œæœ›æ‰“èµã€‚</p><p>ã€€ã€€å¦‚æœæ²¡æœ‰ä»€ä¹ˆç”¨ä¹Ÿæ†‹å–·æˆ‘ï¼Œæ¯•ç«Ÿæˆ‘æ˜¯ä¸ªè’Ÿè’»ã€‚æœ‰æ›´å¥½çš„æ–¹æ³•å¸Œæœ›ç•™ä¸ªè¨€ï¼Œæœ›å‘ŠçŸ¥ã€‚è°¢è°¢ã€‚(Â´,,â€¢Ï‰â€¢,,)â™¡</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€å¥½ä¹…æ²¡å†™åšæ–‡äº†ï¼Œæœ€è¿‘åœ¨è·Ÿéšç€å…¬å¸å¤§ç‰›ä»¬çš„è„šæ­¥ç§˜å¯†ç ”å‘æ–°äº§å“ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¸è¿‡å‰å‡ å¤©æœ‰ä¸€ä¸ªå°éœ€æ±‚çš„ä¸œè¥¿å¯ä»¥æå‡ºæ¥å†™ä¸€ç‚¹ç‚¹å°å¹²è´§å„¿è·Ÿå¤§å®¶åˆ†äº«åˆ†äº«ã€‚ç±³å¨œæ¡‘ä¼šçš„å°±å¯ä»¥å¿½ç•¥äº†ï¼Œåæ­£æˆ‘ä¹Ÿæ˜¯éšä¾¿å†™çš„ï¼›å¦‚æœè§‰å¾—æœ¬æ–‡å¯¹ä½ æœ‰ç”¨çš„è¯è¿˜è¯·å¤šå¤šæ”¯æŒå–µã€‚(â—Â´Ï‰ï½€â—)ã‚&lt;/p&gt;
&lt;h2 
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="Redis" scheme="https://xcoder.in/tags/Redis/"/>
    
      <category term="å®šæ—¶ä»»åŠ¡" scheme="https://xcoder.in/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Remilia ç»“æ„å›¾</title>
    <link href="https://xcoder.in/2015/01/08/remilia-structure/"/>
    <id>https://xcoder.in/2015/01/08/remilia-structure/</id>
    <published>2015-01-08T08:47:17.000Z</published>
    <updated>2017-12-11T07:59:20.528Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è•¾ç±³è‰äºšï¼Ÿ"><a href="#è•¾ç±³è‰äºšï¼Ÿ" class="headerlink" title="è•¾ç±³è‰äºšï¼Ÿ"></a>è•¾ç±³è‰äºšï¼Ÿ</h2><p>å…¶å®è¿™æ˜¯èŠ±ç“£çš„ä¸€ä¸ªå…¥åº“ç³»ç»Ÿç»“æ„å›¾ï¼Œè•¾ç±³è‰äºšæ˜¯è¿™ä¸ªé¡¹ç›®çš„åå­—ã€‚</p><h2 id="ç»“æ„å›¾"><a href="#ç»“æ„å›¾" class="headerlink" title="ç»“æ„å›¾"></a>ç»“æ„å›¾</h2><p><img src="pic.jpg" alt="Remilia"></p><p>è®¾è®¡å¾—ä¸å¥½ï¼Œçº¯å±åšå½’æ¡£ã€‚</p><p>å…¶ä¸­ SanaeHDCS æ˜¯å¦ä¸€å¥—ç³»ç»Ÿï¼Œç»™ RemiliaHDPS æä¾›æ•°æ®çš„ã€‚</p><h3 id="Data-Layer"><a href="#Data-Layer" class="headerlink" title="Data Layer"></a>Data Layer</h3><p>ä¸»è¦åˆ†ä¸º Bathtubï¼ŒDryerï¼ŒVampire ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p><h4 id="Bathtub-æµ´ç¼¸"><a href="#Bathtub-æµ´ç¼¸" class="headerlink" title="Bathtub æµ´ç¼¸"></a>Bathtub æµ´ç¼¸</h4><p>ç”± SanaeHDCS æä¾›çš„æ•°æ®ï¼Œå­˜å‚¨åœ¨ MongoDB å½“ä¸­ã€‚</p><h4 id="Dryer-å¹è½°é¸¡"><a href="#Dryer-å¹è½°é¸¡" class="headerlink" title="Dryer å¹è½°é¸¡"></a>Dryer å¹è½°é¸¡</h4><p>å°† Bathtub å‡ºæ¥çš„æ¹¿æ•°æ®å˜æˆå¹²è´§çš„è§£æå™¨ï¼Œæ ¹æ®ä¸åŒçš„æ•°æ®ç”¨ä¸åŒçš„è§„åˆ™è¿›è¡Œè§£æã€‚</p><h4 id="Vampire-è¡€æ—"><a href="#Vampire-è¡€æ—" class="headerlink" title="Vampire è¡€æ—"></a>Vampire è¡€æ—</h4><p>å…¨åå…¶å®æ˜¯ Vampire Coffinï¼Œåªä¸è¿‡æŠŠè¿™ä¸ªå†™åˆ°é¡¹ç›®é‡Œé¢çœ‹ç€è²Œä¼¼ä¸æ˜¯å¾ˆå‰åˆ©ï¼Œäºæ˜¯å–äº†å‰åŠéƒ¨åˆ†ã€‚å¹è½°æœºå¤„ç†å¥½çš„å¹²æ´»ä¼šå­˜å‚¨åœ¨è¿™è¾¹ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯<br>MongoDB é‡Œé¢ã€‚ç„¶å Vampire æä¾›ç»™å¤–éƒ¨æ¥å£ï¼Œè®©å…¶èƒ½å¤Ÿç”¨æ­£ç¡®çš„å§¿åŠ¿è·å–æ­£ç¡®çš„å¹²è´§æ•°æ®ã€‚</p><h3 id="Fake-Internet"><a href="#Fake-Internet" class="headerlink" title="Fake Internet"></a>Fake Internet</h3><p>ä¸€ä¸ªè§†çª—ã€‚</p><h3 id="Fake-Koumakan"><a href="#Fake-Koumakan" class="headerlink" title="Fake Koumakan"></a>Fake Koumakan</h3><p>å‡çš„çº¢é­”é¦†ï¼Œé‡Œé¢ä¸€å † Puppetã€‚</p><blockquote><p>æ¯ä¸ª Puppet éƒ½æœ‰è‡ªå·±çš„å±æ€§ã€äººæ ¼ã€ä½œæ¯æ—¶é—´å’Œç”Ÿæ´»ã€‚</p></blockquote><h2 id="01-12-2015"><a href="#01-12-2015" class="headerlink" title="01 / 12 / 2015"></a>01 / 12 / 2015</h2><p>é‡æ–°è®¾è®¡äº† Remilia ç»“æ„å›¾ã€‚</p><p><img src="new.jpg" alt="Remilia"></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å¥½å§è¿˜æ˜¯æˆ‘çš„è„‘æ´å¤ªå¤§äº†ã€‚æˆ‘çŸ¥é“ä½ ä»¬çœ‹ç€è¿™è´§ä¸çŸ¥æ‰€äº‘ã€‚</p><p>å¥½å§å¿˜äº†è¿™ä¸ªä¸œè¥¿å§ï¼Œæˆ‘åªæ˜¯æ— èŠå‘ä¸€ç¯‡è€Œå·²ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;è•¾ç±³è‰äºšï¼Ÿ&quot;&gt;&lt;a href=&quot;#è•¾ç±³è‰äºšï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;è•¾ç±³è‰äºšï¼Ÿ&quot;&gt;&lt;/a&gt;è•¾ç±³è‰äºšï¼Ÿ&lt;/h2&gt;&lt;p&gt;å…¶å®è¿™æ˜¯èŠ±ç“£çš„ä¸€ä¸ªå…¥åº“ç³»ç»Ÿç»“æ„å›¾ï¼Œè•¾ç±³è‰äºšæ˜¯è¿™ä¸ªé¡¹ç›®çš„åå­—ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç»“æ„å›¾&quot;&gt;&lt;a href=&quot;#
      
    
    </summary>
    
    
      <category term="Remilia" scheme="https://xcoder.in/tags/Remilia/"/>
    
      <category term="è•¾ç±³è‰äºš" scheme="https://xcoder.in/tags/%E8%95%BE%E7%B1%B3%E8%8E%89%E4%BA%9A/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ C++ ä¸­é“¾æ¥ C çš„ æ–‡ä»¶</title>
    <link href="https://xcoder.in/2014/12/10/link-c-on-gpp/"/>
    <id>https://xcoder.in/2014/12/10/link-c-on-gpp/</id>
    <published>2014-12-10T07:30:32.000Z</published>
    <updated>2017-12-11T07:59:20.520Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>ç”±äºæŸäº›åŸå› ï¼Œæˆ‘å†™äº†ä¸ªå¾ˆæ“çš„<a href="https://github.com/XadillaX/xmempool" target="_blank" rel="external">å†…å­˜æ± </a>ï¼ˆC ç‰ˆæœ¬çš„ï¼‰ã€‚</p><p>ç„¶åæˆ‘æƒ³åˆ°äº†æŠŠä¹‹å‰å†™çš„ä¸€ä¸ª Node.js åŒ… <a href="https://github.com/XadillaX/thmclrx" target="_blank" rel="external">thmclrx</a> çš„æ›´æŒ«çš„â€œä¼ªÂ·å†…å­˜æ± â€ç”¨æ–°å†™çš„å†…å­˜æ± å»æ›¿æ¢æ‰ã€‚(â›â—¡â›âœ¿)</p><p>ç„¶åé—®é¢˜å°±æ¥äº†ï¼Œæˆ‘è²Œä¼¼ä¸èƒ½æ§åˆ¶ node-gyp å»ç”¨ G++ ç¼–è¯‘ <code>*.c</code> æ–‡ä»¶ï¼Œè¿™æ ·çš„è¯æ‰€æœ‰æ–‡ä»¶ç¼–è¯‘å¥½ä¹‹åé“¾æ¥ <code>*.o</code> æ–‡ä»¶ä¼šå‡ºé—®é¢˜ã€‚è™½ç„¶é“¾æ¥çš„æ—¶å€™æ²¡æŠ¥é”™ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™å°±ä¼šæŠ¥è¿™ä¹ˆä¸ªé”™ (;Â´à¼àº¶Ğ”à¼àº¶`)ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">âœ thmclrx git:(master) âœ— node <span class="built_in">test</span>/test.js</span><br><span class="line">dyld: lazy symbol binding failed: Symbol not found: __Z16xmem_create_poolj</span><br><span class="line">  Referenced from: /Users/.../code/huaban/thmclrx/build/Release/thmclrx.node</span><br><span class="line">  Expected <span class="keyword">in</span>: dynamic lookup</span><br><span class="line"></span><br><span class="line">dyld: Symbol not found: __Z16xmem_create_poolj</span><br><span class="line">  Referenced from: /Users/.../code/huaban/thmclrx/build/Release/thmclrx.node</span><br><span class="line">  Expected <span class="keyword">in</span>: dynamic lookup</span><br><span class="line"></span><br><span class="line">[1]    52501 trace <span class="built_in">trap</span>  node <span class="built_in">test</span>/test.js</span><br></pre></td></tr></table></figure><p>å¤§è‡´æ„æ€å°±æ˜¯è¯´åœ¨æˆ‘ç¼–è¯‘å¥½é“¾æ¥å¥½çš„ <code>thmclrx.node</code> ä¸­æ‰¾ä¸åˆ° <code>__Z16xmem_create_poolj</code> è¿™ä¸ªç¬¦å·ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>xmempool.o</code> è¿™ä¸ªç”¨ C ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶å¹¶æ²¡æœ‰æ­£ç¡®è¢«é“¾æ¥ã€‚</p><h2 id="å‡æƒ³æ–¹æ¡ˆ"><a href="#å‡æƒ³æ–¹æ¡ˆ" class="headerlink" title="å‡æƒ³æ–¹æ¡ˆ"></a>å‡æƒ³æ–¹æ¡ˆ</h2><h3 id="å‡æƒ³ä¸€"><a href="#å‡æƒ³ä¸€" class="headerlink" title="å‡æƒ³ä¸€"></a>å‡æƒ³ä¸€</h3><p>ä¸€å¼€å§‹æˆ‘æƒ³æ‰¾çš„æ˜¯â€œå¦‚ä½•åœ¨ node-gyp ä¸­æ‰‹åŠ¨é€‰æ‹©ç¼–è¯‘å™¨â€ï¼Œå³ä¸è®©æœºå™¨è‡ªåŠ¨é€‰æ‹© GCC å»ç¼–è¯‘ <code>*.c</code> æ–‡ä»¶ã€‚åæ¥æ— æœã€‚ãƒ«||â˜›_â˜š|ãƒª</p><h3 id="å‡æƒ³äºŒ"><a href="#å‡æƒ³äºŒ" class="headerlink" title="å‡æƒ³äºŒ"></a>å‡æƒ³äºŒ</h3><p>å†åæ¥æˆ‘æƒ³å¼€äº†ï¼Œäºæ˜¯å†³å®šè®©ç¼–è¯‘çš„æ—¶å€™å»è¯†åˆ«æˆ‘åœ¨è·Ÿ C è¯´è¯è¿˜æ˜¯è·Ÿ C++ è¯´è¯ã€‚(ï¾‰â—•ãƒ®â—•)ï¾‰*:ï½¥ï¾Ÿâœ§</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>äºæ˜¯æˆ‘æ‰¾åˆ°äº†è¿™ä¹ˆä¸ªå¸–å­ï¼š<a href="http://grokbase.com/t/gg/nodejs/14amregx72/linking-c-sources-files-in-cc-files" target="_blank" rel="external">http://grokbase.com/t/gg/nodejs/14amregx72/linking-c-sources-files-in-cc-files</a></p><p>ä»–è²Œä¼¼ä¹Ÿé‡åˆ°äº†è·Ÿæˆ‘ç›¸ä¼¼çš„é—®é¢˜ã€‚ä¸‹é¢è¿™ä¸ªæé—®è€…è‡ªå·±æå‡ºäº†è¿™æ ·çš„å›ç­”ï¼š</p><blockquote><p>Nevermind, found my own answer after finally hitting the right google search terms.</p><p>Added</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//... source code here...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>So that the CPP compiler would know I was talking C and not CPP :)</p></blockquote><p>ç­”æ¡ˆçš„å¤§æ„å°±æ˜¯åœ¨ä½ çš„ C å¤´æ–‡ä»¶ä¸­æ·»åŠ ä¸Šé¢ blahblah ä¸€å¤§æ®µå®ï¼Œå¥½è®© C++ çš„ç¼–è¯‘å™¨çŸ¥é“å®ƒæ˜¯åœ¨è·Ÿ C çš„ä¸­é—´æ–‡ä»¶äº¤æµè€Œä¸æ˜¯ C++ï¼Œè¿™æ ·çš„è¯é“¾æ¥çš„æ—¶å€™å°±èƒ½æ­£å¸¸æ¥è½¨äº†ã€‚äºæ˜¯æˆ‘åœ¨æˆ‘çš„æ–°ç‰ˆ <a href="https://github.com/XadillaX/xmempool/commit/b06351836c9b51952a3d98c438df6626dda8738c" target="_blank" rel="external">xmempool</a> çš„å¤´æ–‡ä»¶é‡Œé¢å°±å·²ç»æ·»åŠ ä¸Šäº†è¿™ä¸¤æ®µè¯äº†ã€‚</p><h2 id="äº‹åçƒŸ"><a href="#äº‹åçƒŸ" class="headerlink" title="äº‹åçƒŸ"></a>äº‹åçƒŸ</h2><p>å…¶å®ä»¥å‰æˆ‘ä¹Ÿè€åœ¨åˆ«çš„é¡¹ç›®é‡Œé¢çœ‹åˆ°è¿™ä¸ª <code>#ifdef __cplusplus</code> çš„å®å®šä¹‰ï¼Œåªä¸è¿‡ä»¥å‰ä¸çŸ¥é“ä»€ä¹ˆæ„æ€ã€‚</p><p>ä»Šå¤©é€šè¿‡è¿™ä¹ˆä¸€ä»¶äº‹æƒ…ç»ˆäºçŸ¥é“äº†å®ƒçš„ç”¨é€”äº†ï¼Œæ–°æŠ€èƒ½ get âˆšã€‚</p><p>Îµ(*Â´ï½¥âˆ€ï½¥ï½€)Ğ·ï¾</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åŸå› &quot;&gt;&lt;a href=&quot;#åŸå› &quot; class=&quot;headerlink&quot; title=&quot;åŸå› &quot;&gt;&lt;/a&gt;åŸå› &lt;/h2&gt;&lt;p&gt;ç”±äºæŸäº›åŸå› ï¼Œæˆ‘å†™äº†ä¸ªå¾ˆæ“çš„&lt;a href=&quot;https://github.com/XadillaX/xmempool&quot; target=&quot;_
      
    
    </summary>
    
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ç”Ÿæˆä¸€ä¸ªè¦†ç›–å¹¿çš„è‰²æ¿</title>
    <link href="https://xcoder.in/2014/10/16/generate-color-space/"/>
    <id>https://xcoder.in/2014/10/16/generate-color-space/</id>
    <published>2014-10-16T03:00:54.000Z</published>
    <updated>2017-12-11T07:59:20.467Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h2><p>ã€€ã€€åœ¨ä¸»é¢˜è‰²æå–çš„è¿‡ç¨‹ä¸­ï¼Œè¦æŠŠé¢œè‰²åŠ å…¥æœç´¢å¼•æ“ã€‚ä½†æ˜¯å¦‚æœæ˜¯çœŸå½©è‰²ä»»æ„å€¼åŠ è¿›å»çš„è¯ï¼Œå¯¹äºæœç´¢çš„æ—¶å€™æ¥è¯´æ— ç–‘æ˜¯ä¸€ä¸ªå¤æ‚çš„æ“ä½œã€‚æœç´¢æ¡ä»¶è¦å„ç§è®¡ç®—è·ç¦»ä»€ä¹ˆçš„ã€‚</p><p>ã€€ã€€äºæ˜¯ä¸€ä¸ªå¦¥åçš„åšæ³•å°±æ˜¯æä¾›ä¸€å¥—è°ƒè‰²æ¿ï¼Œä¿è¯æ‰€æœ‰é¢œè‰²éƒ½è¢«å¸çº³åˆ°è°ƒè‰²æ¿ä¸­çš„æŸä¸€è‰²å€¼å½“ä¸­ã€‚</p><p>ã€€ã€€é‚£ä¹ˆè¿™ä¸ªæ—¶å€™è°ƒè‰²æ¿çš„è¦†ç›–ç‡ä»¥åŠè·ç¦»ä»€ä¹ˆçš„å°±æ¯”è¾ƒé‡è¦äº†ã€‚æœ¬æ–‡å°±è®²å¦‚ä½•ç”Ÿæˆä¸€å¥—çœ‹èµ·æ¥è¿˜ä¸é”™çš„è‡ªç”¨â€œæ ‡å‡†è‰²æ¿â€ã€‚</p><h2 id="Windows-è‰²æ¿"><a href="#Windows-è‰²æ¿" class="headerlink" title="Windows è‰²æ¿"></a>Windows è‰²æ¿</h2><p>ã€€ã€€ä¸€å¼€å§‹æˆ‘ç”¨äº†ä¸€å¥— 256 è‰²çš„è‰²æ¿ï¼Œä¸çŸ¥é“å“ªé‡Œææ¥çš„ Windows è‰²æ¿ã€‚</p><p>ã€€ã€€ç”±äºé¢œè‰²å¤ªå¤šï¼Œä¸å¥½è´´ä»£ç ï¼Œæˆ‘å°±ç›´æ¥æŠŠé“¾æ¥è´´è¿‡æ¥äº†ï¼š</p><blockquote><p><a href="https://github.com/XadillaX/thmclrx/blob/4a5bff429f25294af7111de800063ffd90cce1d8/src/common.cpp#L29" target="_blank" rel="external">ç‚¹æˆ‘èŒèŒå“’ à¸…(à¹‘<em>Ğ´</em>à¹‘)à¸…!!</a></p></blockquote><p>ã€€ã€€è¿™ä¸€å¥—è‰²æ¿å¤§è‡´çš„æ•ˆæœå¦‚ä¸‹ï¼š</p><style>#standard-256 {    line-height: 10px;    padding: 0;    margin: 0;}#standard-256 span {    width: 40px;    height: 20px;    display: inline-block;}</style><div class="well"><div id="standard-256"></div></div><script src="http://blog.xcoder.in/theme-color-slide/palette.js"></script><script>$(function(){    for (var i = 0; i < palette.length; i++)    {        var block = "<span style=\"background: rgba(" +            palette[i][0] + ", " + palette[i][1] + ", " +            palette[i][2] + ", 1);\"></span>";        $("#standard-256").append(block);    }});</script><h2 id="ç”Ÿæˆæ›´å¥½çš„è‰²æ¿"><a href="#ç”Ÿæˆæ›´å¥½çš„è‰²æ¿" class="headerlink" title="ç”Ÿæˆæ›´å¥½çš„è‰²æ¿"></a>ç”Ÿæˆæ›´å¥½çš„è‰²æ¿</h2><p>ã€€ã€€æˆ‘æŒ‡çš„æ›´å¥½å¹¶ä¸ä¸€å®šçœŸçš„æ¯”ä¹‹å‰æ‰¾åˆ°çš„ 256 è‰²è¦å¥½ï¼Œæ¯•ç«Ÿä¸Šé¢é‚£ä¸ªæ˜¯äººå®¶æ™ºæ…§å’ŒåŠ³åŠ¨çš„ç»“æ™¶ã€‚æˆ‘æŒ‡çš„æ›´å¥½æ˜¯é¢œè‰²æ›´å¤šï¼Œä½†æ˜¯åå·®åˆä¸ä¼šå¤ªå¤§ã€‚</p><p>ã€€ã€€ç†è®ºä¸Šæˆ‘ä»¬èƒ½æŒ‰ç…§é‚£ç§è§„åˆ™ç”Ÿæˆæ¯”çœŸå½©è‰²å°‘çš„ä»»æ„ç§æ•°çš„è‰²æ¿ã€‚</p><h3 id="ç›¸å…³çš„è‰²å½©æ¨¡å¼"><a href="#ç›¸å…³çš„è‰²å½©æ¨¡å¼" class="headerlink" title="ç›¸å…³çš„è‰²å½©æ¨¡å¼"></a>ç›¸å…³çš„è‰²å½©æ¨¡å¼</h3><p>ã€€ã€€è¿™é‡Œæœ‰å¿…è¦é‡æ–°æ™®åŠä¸‹ N å¤šç§è‰²å½©æ¨¡å¼ä¸­çš„å…¶ä¸­ä¸¤ç§ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»Šå¤©ç”Ÿæˆä¸€ä¸ªè‰²æ¿æ‰€ç”¨åˆ°çš„ä¸¤ç§æ¨¡å¼ã€‚</p><h4 id="RGB-è‰²å½©æ¨¡å¼"><a href="#RGB-è‰²å½©æ¨¡å¼" class="headerlink" title="RGB è‰²å½©æ¨¡å¼"></a>RGB è‰²å½©æ¨¡å¼</h4><p>ã€€ã€€è¿™ä¸ªå¤§å®¶éƒ½å·²ç»è€³ç†Ÿèƒ½è¯¦äº†ï¼Œæ— éæ˜¯ RGB é€šé“ä¸­çš„åˆ†é‡ç»“åˆèµ·æ¥ç”Ÿæˆçš„ä¸€ç§é¢œè‰²ã€‚</p><blockquote><p>RGB è‰²å½©æ¨¡å¼æ˜¯å·¥ä¸šç•Œçš„ä¸€ç§é¢œè‰²æ ‡å‡†ï¼Œæ˜¯é€šè¿‡å¯¹çº¢ (R)ã€ç»¿ (G)ã€è“ (B)ä¸‰ä¸ªé¢œè‰²é€šé“çš„å˜åŒ–ä»¥åŠå®ƒä»¬ç›¸äº’ä¹‹é—´çš„å åŠ æ¥å¾—åˆ°å„å¼å„æ ·çš„é¢œè‰²çš„ï¼ŒRGB å³æ˜¯ä»£è¡¨çº¢ã€ç»¿ã€è“ä¸‰ä¸ªé€šé“çš„é¢œè‰²ï¼Œè¿™ä¸ªæ ‡å‡†å‡ ä¹åŒ…æ‹¬äº†äººç±»è§†åŠ›æ‰€èƒ½æ„ŸçŸ¥çš„æ‰€æœ‰é¢œè‰²ï¼Œæ˜¯ç›®å‰è¿ç”¨æœ€å¹¿çš„é¢œè‰²ç³»ç»Ÿä¹‹ä¸€ã€‚</p><p>ä½¿ç”¨ RGB æ¨¡å‹ä¸ºå›¾åƒä¸­æ¯ä¸€ä¸ªåƒç´ çš„ RGB åˆ†é‡åˆ†é…ä¸€ä¸ª 0 ~ 255 èŒƒå›´å†…çš„å¼ºåº¦å€¼ã€‚RGB å›¾åƒåªä½¿ç”¨ä¸‰ç§é¢œè‰²ï¼Œå°±å¯ä»¥ä½¿å®ƒä»¬æŒ‰ç…§ä¸åŒçš„æ¯”ä¾‹æ··åˆï¼Œåœ¨å±å¹•ä¸Šå‘ˆç° 16777216 (<code>256 * 256 * 256</code>) ç§é¢œè‰²ã€‚</p></blockquote><h4 id="HSL-è‰²å½©æ¨¡å¼"><a href="#HSL-è‰²å½©æ¨¡å¼" class="headerlink" title="HSL è‰²å½©æ¨¡å¼"></a>HSL è‰²å½©æ¨¡å¼</h4><blockquote><p>HSL è‰²å½©æ¨¡å¼æ˜¯å·¥ä¸šç•Œçš„ä¸€ç§é¢œè‰²æ ‡å‡†ï¼Œæ˜¯é€šè¿‡å¯¹è‰²ç›¸ (H)ã€é¥±å’Œåº¦ (S)ã€æ˜åº¦ (L) ä¸‰ä¸ªé¢œè‰²é€šé“çš„å˜åŒ–ä»¥åŠå®ƒä»¬ç›¸äº’ä¹‹é—´çš„å åŠ æ¥å¾—åˆ°å„å¼å„æ ·çš„é¢œè‰²çš„ï¼ŒHSL å³æ˜¯ä»£è¡¨è‰²ç›¸ï¼Œé¥±å’Œåº¦ï¼Œæ˜åº¦ä¸‰ä¸ªé€šé“çš„é¢œè‰²ï¼Œè¿™ä¸ªæ ‡å‡†å‡ ä¹åŒ…æ‹¬äº†äººç±»è§†åŠ›æ‰€èƒ½æ„ŸçŸ¥çš„æ‰€æœ‰é¢œè‰²ï¼Œæ˜¯ç›®å‰è¿ç”¨æœ€å¹¿çš„é¢œè‰²ç³»ç»Ÿä¹‹ä¸€ã€‚</p></blockquote><p>ã€€ã€€HSL è‰²å½©æ¨¡å¼å°±æ˜¯ä»Šå¤©çš„ä¸»è§’äº†ã€‚æˆ‘ä»¬å°†ä¼šç”¨ HSL ç”Ÿæˆä¸€å¼ ç±»ä¼¼ä¸‹å›¾çš„è‰²æ¿ï¼Œè€Œè‰²æ¿çš„ç²’åº¦å°†ä¼šä¸ä½ å†³å®šè‰²æ¿çš„é¢œè‰²æ•°é‡ç›¸å…³ï¼š</p><p><img src="SqfinPalette-RealColorWheel-RGB-14inwide72dpi-1024x437.png" alt="HSL Color Space"></p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>ã€€ã€€ä¸ºäº†ç®€åŒ–ä»£ç ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸è€ƒè™‘é¥±å’Œåº¦ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰é¢œè‰²è®©å®ƒé¥±å’Œåº¦éƒ½ä¸º <strong>100%</strong>ã€‚</p><p>ã€€ã€€è€Œä¸”å®é™…ä¸Šè‰²ç›¸æ˜¯åœ¨ä¸€ä¸ªåœ†é‡Œé¢çš„ 0Â° ~ 360Â°ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦åšä¸¤æ­¥å°±æ˜¯äº†ï¼š</p><ol><li>è‰²ç›¸ 0Â° ~ 360Â° å¾ªç¯ï¼›</li><li>ä»¥åŠæ˜åº¦ 0% ~ 100% å¾ªç¯ã€‚</li></ol><p>ã€€ã€€åœ¨è¿™é‡Œæˆ‘å®šäº†ä¸€ä¸ªæ­¥é•¿ï¼šè‰²ç›¸ä»¥ 10Â° ä¸ºä¸€ä¸ªæ­¥é•¿ï¼Œæ˜åº¦ä»¥ 5% ä¸ºä¸€ä¸ªæ­¥é•¿ã€‚å¹¶ä¸”å‰”é™¤ RGB ç›¸ç­‰çš„é»‘ç™½ç°è‰²ã€‚</p><blockquote><p>å½“ç„¶è¿™é‡Œæ­¥é•¿å®Œå…¨å¯ä»¥æŒ‰ç…§è‡ªå·±çš„å–œå¥½æ¥ã€‚</p></blockquote><p>ã€€ã€€æˆ‘ä»¬ä»¥å‰ç«¯çš„ Javascript ä¸ºä¾‹ï¼Œèƒ½æƒ³åˆ°ä¸‹é¢çš„ä¸€æ®µä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">19</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">36</span>; j++) &#123;</span><br><span class="line">            $(<span class="string">"#palette"</span>).append(<span class="string">"&lt;div class='color'&gt;&lt;/div&gt;"</span>);</span><br><span class="line">            $(<span class="string">".color"</span>).eq(count++).css(<span class="string">"background-color"</span>, <span class="string">"hsl("</span> + (j * <span class="number">10</span>) + <span class="string">", "</span> + <span class="string">"100%, "</span> + <span class="built_in">parseInt</span>(((i + <span class="number">1</span>) / <span class="number">21</span>) * <span class="number">100</span>) + <span class="string">"%)"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $(<span class="string">"#palette"</span>).append(<span class="string">"&lt;div style='clear: both;'&gt;&lt;/div&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®é™…ä¸Šæˆ‘æ˜åº¦çš„æ­¥é•¿æ˜¯ <code>(100 / 22)</code>ã€‚ç„¶å <code>0</code> å’Œ <code>100</code> è¿™ä¸¤ä¸ªæ˜åº¦æˆ‘ä»¬å¦å¤–æ‹å‡ºæ¥ï¼Œæ‰€ä»¥åªå–äº† 1 ~ 21 çš„æ˜åº¦ã€‚</p><p>ã€€ã€€å‰©ä¸‹çš„å°±æ˜¯è·Ÿåˆšæ‰è¯´çš„ä¸€æ ·ï¼Œå„è‰²ç›¸çš„å„æ˜åº¦ç”Ÿæˆä¸€ä¸ª HSL é¢œè‰²èµ‹å€¼ç»™ <code>background-color</code>ã€‚</p><p>ã€€ã€€æ¥ä¸‹å»æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªç°è‰²æ¡çš„è‰²æ¿ï¼Œä¸“æ²»ç°é»‘ç™½ã€‚è¿™ä¸ªæ—¶å€™å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ RGB æå®šï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"#palette"</span>).append(<span class="string">"&lt;br /&gt;"</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">36</span>; i++) &#123;</span><br><span class="line">    $(<span class="string">"#palette"</span>).append(<span class="string">"&lt;div class='color'&gt;&lt;/div&gt;"</span>);</span><br><span class="line">    <span class="keyword">var</span> val = <span class="built_in">parseInt</span>(((<span class="number">19</span> - i) / <span class="number">19</span>) * <span class="number">255</span>);</span><br><span class="line">    $(<span class="string">".color"</span>).eq(count++).css(<span class="string">"background-color"</span>, <span class="string">"rgb("</span> + val + <span class="string">", "</span> + val + <span class="string">", "</span> + val + <span class="string">")"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æœ€åæŠŠé¢œè‰²è¾“å‡ºåˆ°ä¸€ä¸ªæ•°ç»„å°±å¥½äº†ã€‚</p><blockquote><p>è¿™é‡Œæœ‰ä¸€ç‚¹ happy çš„æ˜¯ï¼Œå°±ç®—ä½ æ˜¯ç”¨ HSL æ¥æçš„èƒŒæ™¯è‰²ï¼Œç”¨ <strong><em>jQuery</em></strong> çš„ <code>$(foo).css(&quot;background-color&quot;)</code> è·å–åˆ°çš„ä»ç„¶æ˜¯ RGB å€¼ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> colors = [];</span><br><span class="line">$(<span class="string">".color"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="regexp">/rgb\((\d+), (\d+), (\d+)\)/</span>.exec($(<span class="keyword">this</span>).css(<span class="string">"background-color"</span>));</span><br><span class="line">    colors.push(&#123; <span class="attr">r</span>: <span class="built_in">parseInt</span>(result[<span class="number">1</span>]), <span class="attr">g</span>: <span class="built_in">parseInt</span>(result[<span class="number">2</span>]), <span class="attr">b</span>: <span class="built_in">parseInt</span>(result[<span class="number">3</span>]) &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">"textarea"</span>).val(<span class="built_in">JSON</span>.stringify(colors));</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ‰€ä»¥æœ€åæˆ‘ä»¬è¿˜éœ€è¦åˆå§‹çš„ HTML äº†ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"palette"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"clear: both;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€æ•ˆæœçš„è¯è¿™é‡Œèƒ½çœ‹åˆ°ï¼š</p><ul><li><a href="http://blog.xcoder.in/hsl-color-space/" target="_blank" rel="external">http://blog.xcoder.in/hsl-color-space/</a></li><li><a href="http://runjs.cn/code/spahru8w" target="_blank" rel="external">http://runjs.cn/code/spahru8w</a></li></ul><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ã€€ã€€ç”¨ HSL ç”Ÿæˆçš„è‰²å½©ç©ºé—´ï¼ˆè‰²æ¿ï¼‰ä¸€ä¸ªæ˜¯è¡¨ç°åŠ›å¥½ï¼Œç›¸å¯¹äº RGB æ¥è¯´ï¼Œå¥½åƒæ›´å¥½çŸ¥é“å¦‚ä½•å»ç”Ÿæˆåˆ†éƒ¨æ¯”è¾ƒ OK çš„ä¸€ä¸ªè‰²å½©ç©ºé—´ã€‚</p><p>ã€€ã€€ä½†æ˜¯ä¹Ÿæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå½“æˆ‘ä»¬ä¸å»ç®¡é¥±å’Œåº¦çš„æ—¶å€™ï¼Œå®é™…ä¸Šæˆ‘ä»¬è¿˜æ˜¯ä¸¢å¤±äº†ä¸€éƒ¨åˆ†çš„é¢œè‰²ã€‚å¥½åœ¨æœ¬èº«æˆ‘ä»¬ç”Ÿæˆè‰²æ¿ä¹Ÿåªæ˜¯ä¸ºäº†åˆå¹¶é¢œè‰²ï¼Œå¯ä»¥é€šè¿‡ k-D æ ‘æ¥å¿«é€Ÿå¯»æ‰¾æŸä¸ªé¢œè‰²åœ¨è‰²æ¿ä¸­æ˜¯å±äºå“ªç§è‰²å—çš„ã€‚å½“ç„¶ï¼Œç›®å‰æˆ‘ä»¬å°±æ˜¯è¿™ä¹ˆåšçš„ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="http://websafecolorcodes.com/colors-palette/color-wheel-palette/" target="_blank" rel="external">Color Wheel Palette</a></li><li><a href="http://www.waldronconstructionllc.com/wp-content/uploads/2012/03/SqfinPalette-RealColorWheel-RGB-14inwide72dpi-1024x437.png" target="_blank" rel="external">Refer Image</a></li><li><a href="http://codeforartists.com/samples/cfa-color-palette-hsl.php" target="_blank" rel="external">Algorithm</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç”¨é€”&quot;&gt;&lt;a href=&quot;#ç”¨é€”&quot; class=&quot;headerlink&quot; title=&quot;ç”¨é€”&quot;&gt;&lt;/a&gt;ç”¨é€”&lt;/h2&gt;&lt;p&gt;ã€€ã€€åœ¨ä¸»é¢˜è‰²æå–çš„è¿‡ç¨‹ä¸­ï¼Œè¦æŠŠé¢œè‰²åŠ å…¥æœç´¢å¼•æ“ã€‚ä½†æ˜¯å¦‚æœæ˜¯çœŸå½©è‰²ä»»æ„å€¼åŠ è¿›å»çš„è¯ï¼Œå¯¹äºæœç´¢çš„æ—¶å€™æ¥è¯´æ— ç–‘æ˜¯ä¸€ä¸ªå¤æ‚çš„æ“ä½œã€‚æœç´¢æ¡ä»¶è¦å„ç§è®¡ç®—
      
    
    </summary>
    
      <category term="Programming" scheme="https://xcoder.in/categories/Programming/"/>
    
    
      <category term="HSL" scheme="https://xcoder.in/tags/HSL/"/>
    
      <category term="RGB" scheme="https://xcoder.in/tags/RGB/"/>
    
      <category term="è‰²æ¿" scheme="https://xcoder.in/tags/%E8%89%B2%E6%9D%BF/"/>
    
      <category term="Palette" scheme="https://xcoder.in/tags/Palette/"/>
    
      <category term="Color Space" scheme="https://xcoder.in/tags/Color-Space/"/>
    
      <category term="è‰²å½©ç©ºé—´" scheme="https://xcoder.in/tags/%E8%89%B2%E5%BD%A9%E7%A9%BA%E9%97%B4/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨ Javascript å®ç°ä¸€ä¸ªç®€æ˜“ BrainF**k è§£é‡Šå™¨</title>
    <link href="https://xcoder.in/2014/10/08/brainf**k/"/>
    <id>https://xcoder.in/2014/10/08/brainf**k/</id>
    <published>2014-10-08T03:42:32.000Z</published>
    <updated>2017-12-11T07:59:20.462Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€é¦–å…ˆç¥è´ºè‡ªå·±åœ¨ <a href="http://www.codewars.com/users/XadillaX" target="_blank" rel="external">CodeWars</a> å‡çº§åˆ° 3 Kyuï¼Œä»¥åŠæ„Ÿè°¢ @<a href="http://www.html-js.com/card/473" target="_blank" rel="external">Bolt_ç™½è¡£è‹ç‹—</a> ç«¥é‹è®©æˆ‘çŸ¥é“æœ‰ CodeWars è¿™ä¹ˆä¸ªå¥½ç©çš„ä¸œè¥¿ã€‚</p><p>ã€€ã€€è™½ç„¶é‡Œé¢æ°´é¢˜å±…å¤šï¼Œä¸è¿‡åœ¨ä¸Šç­æ¯”è¾ƒç©ºé—²çš„æ¡£å£ #<strong>å¸¦è–ªåˆ·é¢˜</strong># çš„æ„Ÿè§‰è¿˜æ˜¯è›®ä¸é”™çš„ã€‚</p><h2 id="è¯å” ä¸€ä¸‹"><a href="#è¯å” ä¸€ä¸‹" class="headerlink" title="è¯å” ä¸€ä¸‹"></a>è¯å” ä¸€ä¸‹</h2><p>ã€€ã€€é«˜ä¸­çš„æ—¶å€™å°±è·Ÿ @<a href="http://www.lvchaoshuai.com/" target="_blank" rel="external">MatRush</a> å‘ç°äº†ä¸€ä¸ªåå­—è¶…çº§å¥½ç©çš„ç¼–ç¨‹è¯­è¨€å« <a href="http://en.wikipedia.org/wiki/Brainfuck" target="_blank" rel="external">BrainF**k</a>ï¼Œå®ƒæ¯”è¾ƒæè„‘ç­‹ï¼Œå› ä¸ºæ‰€æœ‰çš„ç¼–ç¨‹æ“ä½œéƒ½æ˜¯é›†åˆåœ¨æ“ä½œç¬¦é‡Œé¢ï¼Œç„¶åæ§åˆ¶æŒ‡é’ˆåç§»å’Œå†…å­˜å€¼çš„ä¿®æ”¹æ¥è¿›è¡Œä¸€ç³»åˆ—æ“ä½œã€‚</p><p>ã€€ã€€è¿™ä¸åé¢å‘ç°çš„ <a href="http://www.hacker.org/hvm/" target="_blank" rel="external">HVM</a>ï¼ˆHack Virtual Machineï¼‰æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚å…¶å®ä¹‹å‰ä¹Ÿå‡ºè¿‡ä¸€ä¸ªâ€œ<a href="http://acm.nbut.edu.cn/Problem/view.xhtml?id=1062" target="_blank" rel="external">å®ç°ä¸€ä¸ªç®€æ˜“ HVM è§£é‡Šå™¨</a>â€çš„é¢˜ç›®ï¼Œæ‰€ä»¥åœ¨ CodeWars çœ‹åˆ°è¿™ä¸ªé¢˜ç›®çš„æ—¶å€™è¿˜æ„Ÿè§‰è›®äº²åˆ‡çš„ã€‚</p><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>ã€€ã€€é—®é¢˜å¾ˆç®€å•ï¼Œå°±æ˜¯è®©ä½ å®ç°ä¸€ä¸ªå‡½æ•°æ¥è§£é‡Šä¸€å¥ BrainF**k çš„è¯­å¥ï¼Œå¹¶ä¸”æ ¹æ®è¾“å…¥æ•°æ®æ¥è¾“å‡ºç›¸åº”çš„å†…å®¹ã€‚</p><p>ã€€ã€€è‡³äºè¿™é¢˜æ‰€éœ€çš„ BrainF**k çš„è¯­æ³•ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li><code>&gt;</code>: æŒ‡é’ˆå³ç§»ä¸€ä½ã€‚</li><li><code>&lt;</code>: æŒ‡é’ˆå·¦ç§»ä¸€ä½ã€‚</li><li><code>+</code>: å½“å‰æŒ‡é’ˆæ‰€æŒ‡çš„å†…å­˜å€¼åŠ ä¸€ï¼Œä»¥ 255 ä¸ºç•Œï¼Œæº¢å‡ºä¸º 0ï¼Œå³ <code>255 + 1 = 0</code>ã€‚</li><li><code>-</code>: å½“å‰æŒ‡é’ˆæ‰€æŒ‡çš„å†…å­˜å€¼å‡ä¸€ï¼Œä»¥ 0 ä¸ºç•Œï¼Œæº¢å‡ºä¸º 255ï¼Œå³ <code>0 - 1 = 255</code>ã€‚</li><li><code>.</code>: è¾“å‡ºå½“å‰æŒ‡é’ˆæ‰€æŒ‡çš„å€¼ï¼Œå³è¾“å‡ºè¯¥å€¼ ASCII ç æ‰€å¯¹åº”çš„å­—ç¬¦ã€‚</li><li><code>,</code>: ä»è¾“å…¥å–ä¸€ä¸ªå­—ç¬¦è½¬ä¸º ASCII ç å­˜å…¥å½“å‰æŒ‡é’ˆæ‰€æŒ‡çš„å†…å­˜ã€‚</li><li><code>[</code>: è‹¥å½“å‰æŒ‡é’ˆæ‰€æŒ‡çš„å€¼ä¸º 0ï¼Œåˆ™å‘½ä»¤è·³åˆ°è¯¥ <code>[</code> åŒ¹é…çš„ç»“æŸ <code>]</code> ç¬¦å·ä½ç½®çš„ä¸‹ä¸€ä½ç½®çš„æŒ‡ä»¤ã€‚</li><li><code>]</code>: è‹¥å½“å‰æŒ‡é’ˆæ‰€æŒ‡çš„å€¼ä¸ä¸º 0ï¼Œåˆ™æŒ‡ä»¤å‘å‰è·³åˆ°è¯¥ <code>]</code> åŒ¹é…åˆ°çš„ <code>[</code> ç¬¦å·ä½ç½®çš„ä¸‹ä¸€ä½ç½®çš„æŒ‡ä»¤ã€‚</li></ul><p>ã€€ã€€ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="string">,</span><span class="literal">+</span><span class="title">[</span><span class="literal">-</span><span class="string">.</span><span class="string">,</span><span class="literal">+</span><span class="title">]</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸Šé¢çš„å¥å­å¤§è‡´å°±æ˜¯è¯´ï¼š</p><ol><li>è·å–è¾“å…¥åˆ°å½“å‰æŒ‡é’ˆã€‚</li><li>å½“å‰æŒ‡é’ˆå€¼åŠ ä¸€ã€‚</li><li>å¦‚æœå½“å‰æŒ‡é’ˆçš„å€¼ä¸º 0ï¼Œé‚£ä¹ˆè·³åˆ°ç»“æŸä½ç½®ï¼›å¦åˆ™ä¸‹ä¸€æ­¥ã€‚</li><li>å½“å‰æŒ‡é’ˆå€¼å‡ä¸€ã€‚</li><li>è¾“å‡ºå½“å‰æŒ‡é’ˆçš„å€¼ï¼ˆç»¼ä¸Šæ‰€è¿°ï¼Œå°±æ˜¯è¾“å‡ºè¾“å…¥çš„å€¼ï¼‰ã€‚</li><li>è·å–è¾“å…¥åˆ°å½“å‰æŒ‡é’ˆã€‚</li><li>å½“å‰æŒ‡é’ˆå€¼åŠ ä¸€ã€‚</li><li>è‹¥å½“å‰æŒ‡é’ˆå€¼ä¸ä¸º 0ï¼Œé‚£ä¹ˆè·³åˆ° <code>[</code> åé¢çš„ä½ç½®â€”â€”å³ç¬¬å››æ­¥ã€‚</li></ol><p>ã€€ã€€è¯´ç™½äº†ï¼Œå°±æ˜¯ä¸æ–­è·å–è¾“å…¥çš„å€¼ï¼Œå¦‚æœè¾“å…¥çš„å€¼æ˜¯ 255ï¼Œé‚£ä¹ˆå°±è·³å‡ºå¾ªç¯ï¼Œå¦åˆ™åŸæ ·è¾“å‡ºã€‚</p><h2 id="å¼€å§‹å®ç°"><a href="#å¼€å§‹å®ç°" class="headerlink" title="å¼€å§‹å®ç°"></a>å¼€å§‹å®ç°</h2><p>ã€€ã€€æ˜ç™½äº†ä¸Šé¢çš„é¢˜æ„ä¹‹åå°±å¯ä»¥å¼€å§‹å®ç°äº†ï¼Œæ­¥éª¤å¤§è‡´ä¸Šå°±æ˜¯é€ä½éå†æŒ‡ä»¤ï¼Œç„¶åä¸€ä¸ª <code>switch</code> æ¥å¤„ç†å„ç§æŒ‡ä»¤å³å¯ã€‚</p><p>ã€€ã€€<strong>CodeWars</strong> ç»™äº†ä½ ä¸€ä¸ªå‡½æ•°åŸå‹ï¼Œä½ åœ¨é‡Œé¢å®ç°ä»£ç å°±å¥½äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">brainLuck</span>(<span class="params">code, input</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‰è¶‹å·¥ä½œ"><a href="#å‰è¶‹å·¥ä½œ" class="headerlink" title="å‰è¶‹å·¥ä½œ"></a>å‰è¶‹å·¥ä½œ</h3><p>ã€€ã€€åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬åšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚ç”³æ˜å‡ ä¸ªå˜é‡ä»€ä¹ˆçš„ï¼š</p><ul><li>è¾“å…¥æ•°æ®å½“å‰çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´è¯»å–å‡ ä¸ªä¹‹åï¼Œè¿™ä¸ªä½ç½®è¦åç§»å‡ ä½ã€‚</li><li>å½“å‰æŒ‡ä»¤çš„ä½ç½®ã€‚</li><li>å½“å‰æŒ‡é’ˆçš„ä½ç½®ã€‚</li><li>â€œä¼ªå†…å­˜å—â€çš„å€¼ï¼Œç”¨ä¸€ä¸ªæ•°ç»„è¡¨ç¤ºï¼Œé»˜è®¤ä¸€ä¸ª <code>[ 0 ]</code>ã€‚</li><li>éœ€è¦ <code>return</code> çš„å­—ç¬¦ä¸²ï¼Œå³è¾“å‡ºçš„å€¼ã€‚</li><li>æŸä¸ªæ‹¬å·åŒ¹é…çš„æ‹¬å·çš„æŒ‡ä»¤ä¸‹æ ‡çš„è¿™ä¹ˆä¸€ä¸ªæ˜ å°„æ•°ç»„ã€‚</li></ul><p>ã€€ã€€æ‰€ä»¥æ¥ä¸‹å»æˆ‘ä»¬è¦æŠŠæ¶å­å¡«æˆè¿™æ ·ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">brainLuck</span>(<span class="params">code, input</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> commandPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> pointerPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> bytes = [ <span class="number">0</span> ];</span><br><span class="line">    <span class="keyword">var</span> output = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">var</span> matching = getMatchingBra(code);    <span class="comment">///&lt; äººå®¶æ‰ä¸æ˜¯ç½©ç½©å‘¢ï¼Œæˆ‘æ˜¯ Brackets çš„ç¼©å†™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‹¬å·åŒ¹é…å‡½æ•°"><a href="#æ‹¬å·åŒ¹é…å‡½æ•°" class="headerlink" title="æ‹¬å·åŒ¹é…å‡½æ•°"></a>æ‹¬å·åŒ¹é…å‡½æ•°</h4><p>ã€€ã€€ä¸Šé¢çš„ <code>getMatchingBra</code> å°±æ˜¯æˆ‘ä»¬è¦å®ç°çš„ä¸€ä¸ªæ‹¬å·åŒ¹é…å‡½æ•°äº†ï¼Œæ€æƒ³å°±æ˜¯ç”¨æ ˆã€‚</p><p>ã€€ã€€ç¢°åˆ°å‰æ‹¬å·å°±æŠŠè¿™ä¸ªå‰æ‹¬å·çš„ä¸‹æ ‡å…¥æ ˆï¼›ç¢°åˆ°åæ‹¬å·ï¼Œå°±æŠŠæ ˆé¡¶å…ƒç´ å³å‰æ‹¬å·çš„ä¸‹æ ‡æ¨å‡ºï¼Œè¿™ä¸ªæ—¶å€™æ‹¬å·åŒ¹é…æ•°ç»„çš„è¿™ä¸ªå‰æ‹¬å·ä¸‹æ ‡çš„å€¼å°±æ˜¯å½“å‰åæ‹¬å·çš„ä¸‹æ ‡ï¼Œè€Œåæ‹¬å·ä¸‹æ ‡çš„å€¼å°±æ˜¯å‰æ‹¬å·çš„ä¸‹æ ‡äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * ä½ æ‰æ˜¯ Bra ï¼/( â—•â€¿â€¿â—• )ï¼¼</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMatchingBra</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> stack = [];</span><br><span class="line">    <span class="keyword">var</span> bra = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; code.length; i++) bra.push(<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; code.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(code[i] === <span class="string">'['</span>) &#123;</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(code[i] === <span class="string">']'</span>) &#123;</span><br><span class="line">            bra[i] = stack.pop();</span><br><span class="line">            bra[bra[i]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bra;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æœ‰äº†è¿™ä¸ªæ•°ç»„å°±å¯ä»¥éšä¾¿è·³äº†ï¼Œå¦‚æœæŒ‡ä»¤ç¬¬ <code>i</code> ä½æ˜¯ä¸€ä¸ªæ‹¬å·ï¼ˆä¸ç®¡å‰æ‹¬å·è¿˜æ˜¯åæ‹¬å·ï¼‰ï¼Œé‚£ä¹ˆå®ƒçš„åŒ¹é…æ‹¬å·ä¸‹æ ‡å°±æ˜¯ <code>matching[i]</code> äº†ã€‚</p><h3 id="å„ç§æŒ‡ä»¤çš„å¤„ç†"><a href="#å„ç§æŒ‡ä»¤çš„å¤„ç†" class="headerlink" title="å„ç§æŒ‡ä»¤çš„å¤„ç†"></a>å„ç§æŒ‡ä»¤çš„å¤„ç†</h3><p>ã€€ã€€è¦å¤„ç†æŒ‡ä»¤çš„è¯å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª <code>while</code> è¯­å¥ä¸æ–­å¾ªç¯æŒ‡ä»¤ï¼Œç„¶ååˆ¤æ–­å½“å‰æŒ‡ä»¤æ˜¯ä»€ä¹ˆç„¶ååšç›¸åº”çš„äº‹ï¼Œæœ€åæŒ‡ä»¤ä½ç½®åŠ ä¸€å°±å¥½äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(commandPos &lt; code.length) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(code[commandPos]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'&gt;'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'&lt;'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'+'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'-'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'.'</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">','</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'['</span>: &#123;&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">']'</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    commandPos++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="gt"><a href="#gt" class="headerlink" title="&gt;"></a>&gt;</h4><p>ã€€ã€€æŒ‡é’ˆå³ç§»çš„è¯å°±æŠŠæŒ‡é’ˆä½ç½®åŠ ä¸€ï¼Œå¦‚æœå†…å­˜æ•°ç»„è¿˜æ²¡å½“å‰æŒ‡é’ˆä½ç½®çš„å€¼çš„è¯ <code>push</code> ä¸€ä¸ª <code>0</code> å°±å¥½äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'&gt;'</span>: &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">undefined</span> === bytes[++pointerPos]) bytes.push(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="lt"><a href="#lt" class="headerlink" title="&lt;"></a>&lt;</h4><p>ã€€ã€€å·¦ç§»å°±æ˜¯å‡ä¸€ï¼Œå¦‚æœä½ç½®å°äº 0ï¼Œé‚£ä¹ˆå†…å­˜æ•°ç»„ä»å‰æ¨å…¥ä¸€ä¸ªå€¼ï¼Œå¹¶è®©æŒ‡é’ˆç­‰äº 0ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'&lt;'</span>: &#123;</span><br><span class="line">    <span class="keyword">if</span>(--pointerPos &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        bytes.unshift(<span class="number">0</span>);</span><br><span class="line">        pointerPos = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title="+"></a>+</h4><p>ã€€ã€€æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå†…å­˜åŠ ä¸€å°±å¥½äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'+'</span>: &#123;</span><br><span class="line">    bytes[pointerPos] = (bytes[pointerPos] + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="-1"><a href="#-1" class="headerlink" title="-"></a>-</h4><p>ã€€ã€€å‡ä¸€ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'-'</span>: &#123;</span><br><span class="line">    bytes[pointerPos]--;</span><br><span class="line">    <span class="keyword">if</span>(bytes[pointerPos] &lt; <span class="number">0</span>) bytes[pointerPos] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="-2"><a href="#-2" class="headerlink" title="."></a>.</h4><p>ã€€ã€€è¾“å‡ºçš„è¯ç›´æ¥å¾€ <code>output</code> å­—ç¬¦ä¸²é‡Œé¢åŠ ä¸Šå½“å‰æŒ‡é’ˆçš„å€¼å°±å¥½äº†ï¼Œæ³¨æ„è¦ ASCII è½¬å˜ä¹‹åçš„å­—ç¬¦ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'.'</span>: &#123;</span><br><span class="line">    output += <span class="built_in">String</span>.fromCharCode(bytes[pointerPos]);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="-3"><a href="#-3" class="headerlink" title=","></a>,</h4><p>ã€€ã€€è¾“å…¥çš„è¯å°±è®© <code>input</code> å½“å‰ä½ç½®çš„å€¼å˜æˆ ASCII å­˜è¿›å½“å‰æŒ‡é’ˆï¼Œç„¶åè¾“å…¥ä½ç½®åŠ ä¸€å°±å¥½äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">','</span>: &#123;</span><br><span class="line">    bytes[pointerPos] = input.charCodeAt(inputPos++);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="-4"><a href="#-4" class="headerlink" title="["></a>[</h4><p>ã€€ã€€ç”±äºä¹‹å‰å·²ç»åšå¥½äº†åŒ¹é…æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­å½“å‰æŒ‡é’ˆæ˜¯ä¸æ˜¯ 0ï¼Œç„¶åå¦‚æœæ˜¯å°±è·³åˆ°åŒ¹é…æ‹¬å·å¤„ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'['</span>: &#123;</span><br><span class="line">    commandPos = !bytes[pointerPos] ? matching[commandPos] : commandPos;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="-5"><a href="#-5" class="headerlink" title="]"></a>]</h4><p>ã€€ã€€åŒä¸Šï¼Œåªä¸è¿‡æ¡ä»¶æ”¹ä¸€ä¸‹è€Œå·²ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">']'</span>: &#123;</span><br><span class="line">    commandPos = bytes[pointerPos] ? matching[commandPos] : commandPos;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å–„åå·¥ä½œ"><a href="#å–„åå·¥ä½œ" class="headerlink" title="å–„åå·¥ä½œ"></a>å–„åå·¥ä½œ</h3><p>ã€€ã€€ä¸Šé¢çš„å‡½æ•°ä½“å®Œæˆä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æœ€åæŠŠ <code>output</code> ç»™è¿”å›å°±å¥½äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> output;</span><br></pre></td></tr></table></figure><h2 id="è‚¢ä½“ç»„è£…"><a href="#è‚¢ä½“ç»„è£…" class="headerlink" title="è‚¢ä½“ç»„è£…"></a>è‚¢ä½“ç»„è£…</h2><p>ã€€ã€€å®Œæˆäº†ä¸Šé¢ä¸ƒé›¶å…«è½çš„è‚¢ä½“ä¹‹åï¼Œæˆ‘ä»¬è¦æŠŠäº”é©¬åˆ†å°¸çš„ä»£ç ç»™å‡‘å›å»ï¼Œæ‰€ä»¥æœ€åå°±é•¿è¿™ä¸ªæ ·å­äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMatchingBra</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> stack = [];</span><br><span class="line">    <span class="keyword">var</span> bra = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; code.length; i++) bra.push(<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; code.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(code[i] === <span class="string">'['</span>) &#123;</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(code[i] === <span class="string">']'</span>) &#123;</span><br><span class="line">            bra[i] = stack.pop();</span><br><span class="line">            bra[bra[i]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bra;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">brainLuck</span>(<span class="params">code, input</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> commandPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> pointerPos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> bytes = [ <span class="number">0</span> ];</span><br><span class="line">    <span class="keyword">var</span> output = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">var</span> matching = getMatchingBra(code);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(commandPos &lt; code.length) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(code[commandPos]) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'&gt;'</span>: &#123;</span><br><span class="line">                pointerPos++;</span><br><span class="line">                <span class="keyword">if</span>(<span class="literal">undefined</span> === bytes[pointerPos]) &#123;</span><br><span class="line">                    bytes.push(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'&lt;'</span>: &#123;</span><br><span class="line">                pointerPos--;</span><br><span class="line">                <span class="keyword">if</span>(<span class="number">0</span> &gt; pointerPos) &#123;</span><br><span class="line">                    bytes.unshift(<span class="number">0</span>);</span><br><span class="line">                    pointerPos = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'+'</span>: &#123;</span><br><span class="line">                bytes[pointerPos] = (bytes[pointerPos] + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'-'</span>: &#123;</span><br><span class="line">                bytes[pointerPos]--;</span><br><span class="line">                <span class="keyword">if</span>(bytes[pointerPos] &lt; <span class="number">0</span>) bytes[pointerPos] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'.'</span>: &#123;</span><br><span class="line">                output += <span class="built_in">String</span>.fromCharCode(bytes[pointerPos]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">','</span>: &#123;</span><br><span class="line">                <span class="keyword">var</span> temp = input.charCodeAt(inputPos++);</span><br><span class="line">                bytes[pointerPos] = temp;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'['</span>: &#123;</span><br><span class="line">                <span class="keyword">if</span>(!bytes[pointerPos]) &#123;</span><br><span class="line">                    commandPos = matching[commandPos];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">']'</span>: &#123;</span><br><span class="line">                <span class="keyword">if</span>(bytes[pointerPos]) &#123;</span><br><span class="line">                    commandPos = matching[commandPos];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        commandPos++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢˜åè¯­"><a href="#é¢˜åè¯­" class="headerlink" title="é¢˜åè¯­"></a>é¢˜åè¯­</h2><p>ã€€ã€€è‰¾ç›ï¼Œå¿˜äº†æ”¾é¢˜ç›®é“¾æ¥äº†ï¼š<a href="http://www.codewars.com/kata/526156943dfe7ce06200063e" target="_blank" rel="external">http://www.codewars.com/kata/526156943dfe7ce06200063e</a>ã€‚ä»¥åŠå¤§å®¶å¦‚æœæœ‰å…´è¶£çš„è¯ä¹Ÿå¯ä»¥å»è¯•è¯•çœ‹å†™ä¸ª <a href="http://acm.nbut.edu.cn/Problem/view.xhtml?id=1062" target="_blank" rel="external">HVM</a> çœ‹çœ‹ã€‚</p><p>ã€€ã€€å®é™…ä¸Šæœ¬æ–‡å®ç°çš„ä¸œè¥¿å®ç”¨æ€§å‡ ä¹æ²¡æœ‰ï¼Œåªä¸è¿‡æ˜¯æŠ›ç –å¼•ç‰ï¼Œè®©å¤§å®¶åœ¨åšä¸€äº›æ¨¡æ‹Ÿé¢˜é€»è¾‘ï¼ˆæˆ–è€…è¯´æ˜¯ç®€å•æ¨¡æ‹Ÿé€»è¾‘ï¼‰çš„æ—¶å€™ç†æ¸…æ€è·¯ã€æŒ‰éƒ¨å°±ç­ï¼Œåˆ‡å¿Œè‡ªå·±ä¹±äº†æ€è·¯å’Œé€»è¾‘ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€é¦–å…ˆç¥è´ºè‡ªå·±åœ¨ &lt;a href=&quot;http://www.codewars.com/users/XadillaX&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CodeWars&lt;/a&gt; å‡çº§åˆ° 3 Kyuï¼Œä»¥åŠæ„Ÿè°¢ @&lt;a href=&quot;http://ww
      
    
    </summary>
    
      <category term="Programming" scheme="https://xcoder.in/categories/Programming/"/>
    
    
      <category term="Javascript" scheme="https://xcoder.in/tags/Javascript/"/>
    
      <category term="è§£é‡Šå™¨" scheme="https://xcoder.in/tags/%E8%A7%A3%E9%87%8A%E5%99%A8/"/>
    
      <category term="BrainFuck" scheme="https://xcoder.in/tags/BrainFuck/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨ Node.js å®ç°ä¸€ä¸ª Singleton</title>
    <link href="https://xcoder.in/2014/09/30/javascript-singleton/"/>
    <id>https://xcoder.in/2014/09/30/javascript-singleton/</id>
    <published>2014-09-30T07:21:13.000Z</published>
    <updated>2017-12-11T07:59:20.501Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€ä»Šå¤©éšä¾¿ç©äº†ä¸€é“ <a href="http://www.codewars.com/kata/singleton-pattern/javascript" target="_blank" rel="external">CodeWar çš„é¢˜</a>ã€‚</p><p>ã€€ã€€é¢˜æ„å¤§è‡´å°±æ˜¯ä½ éœ€è¦å®ç°ä¸€ä¸ª <code>Singleton</code> ä¹Ÿå°±æ˜¯å•ä»¶æ¨¡å¼çš„ç±»ï¼Œè®©å…¶ä¸‹é¢ä»£ç æ‰§è¡ŒæˆåŠŸï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = <span class="keyword">new</span> Singleton();</span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="keyword">new</span> Singleton();</span><br><span class="line">obj1 === obj2; <span class="comment">// =&gt; true</span></span><br><span class="line">obj1.test = <span class="number">1</span>;</span><br><span class="line">obj2.test; <span class="comment">// =&gt; 1</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€å¹¶ä¸”è¿˜æœ‰å¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯ <code>Singleton</code> çš„å¯¹è±¡çš„ <code>instanceof</code> ä¹Ÿå¾—çš„ç¡®æ˜¯ <code>Singleton</code> æ‰è¡Œã€‚</p><h2 id="å¼€å§‹è¯•éªŒ"><a href="#å¼€å§‹è¯•éªŒ" class="headerlink" title="å¼€å§‹è¯•éªŒ"></a>å¼€å§‹è¯•éªŒ</h2><p>ã€€ã€€æˆ‘ä»¬çŒœæƒ³ <code>new Singleton()</code> çš„ç»“æœï¼Œå¦‚æœ <code>Singleton</code> å‡½æ•°ä¹Ÿå°±æ˜¯è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°æ²¡è¿”å›å€¼çš„è¯ï¼Œç›´æ¥ä¼šè¿”å› <code>this</code>ï¼Œæœ‰è¿”å›å€¼çš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯ç­‰äºå…¶è¿”å›å€¼äº†ã€‚</p><p>ã€€ã€€æˆ‘ä»¬ç ä¸‹é¢çš„ä»£ç çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">foo</span>: <span class="string">"bar"</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Singleton());</span><br></pre></td></tr></table></figure><p>ã€€ã€€è·‘ä¸€éä¹‹åæˆ‘ä»¬çš„ç¡®å‘ç°äº†è¾“å‡ºçš„å€¼å°±æ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">foo</span>: <span class="string">"bar"</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="å°ä½œå¼Šå¤±è´¥"><a href="#å°ä½œå¼Šå¤±è´¥" class="headerlink" title="å°ä½œå¼Šå¤±è´¥"></a>å°ä½œå¼Šå¤±è´¥</h2><p>ã€€ã€€äºæ˜¯æˆ‘è¿™ä¹ˆåšï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> foo;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç»“æœä¸Šé¢çš„å‡ ä¸ªæ¡ä»¶éƒ½ç¬¦åˆäº†ï¼Œä¸ä¿¡å¤§å®¶å¯ä»¥è‡ªå·±è¾“å‡ºä¸€éçœ‹çœ‹ã€‚</p><p>ã€€ã€€ä½†æ˜¯â€”â€”</p><p>ã€€ã€€è¿™ä¸œè¥¿ä¸æ˜¯ä¸€ä¸ª <code>Singleton</code> çš„å®ä¾‹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„ <code>JSON</code> å¯¹è±¡ï¼Œæ‰€ä»¥è¿˜æ˜¯æ— æ³•é€šè¿‡ã€‚</p><h2 id="æ­»æœˆã®æ­£è§£"><a href="#æ­»æœˆã®æ­£è§£" class="headerlink" title="æ­»æœˆã®æ­£è§£"></a>æ­»æœˆã®æ­£è§£</h2><p>ã€€ã€€ç­”æ¡ˆæœ‰å¾ˆå¤šï¼ŒCodeWar ä¸Šé¢æ¯ä¸ªäººçš„è§£æ³•éƒ½ä¸ä¸€æ ·ï¼Œä½†æ˜¯å½’æ ¹ç»“åº•æœ¬è´¨è¿˜æ˜¯å¤§åŒå°å¼‚çš„ã€‚</p><p>ã€€ã€€å°±æ˜¯ç¬¬ä¸€æ¬¡çš„æ—¶å€™å…ˆç›´æ¥è¿”å› <code>this</code>ï¼Œå¹¶ä¸”æŠŠ <code>this</code> æ”¾åœ¨æŸä¸ªåœ°æ–¹ã€‚ä»¥åæ¯æ¬¡æ¥è¿™é‡Œåˆ›å»ºçš„æ—¶å€™è¿”å›ä¹‹å‰å­˜å¥½çš„ <code>this</code> å³å¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Singleton.prototype.instance) <span class="keyword">return</span> Singleton.prototype.instance = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do some initialize things</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    Singleton.prototype.instance = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="åˆ«çš„å†™æ³•"><a href="#åˆ«çš„å†™æ³•" class="headerlink" title="åˆ«çš„å†™æ³•"></a>åˆ«çš„å†™æ³•</h2><p>ã€€ã€€å†™æ³•å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œéšæ„æŒ‘å‡ ä¸ªåˆ«äººçš„ç­”æ¡ˆå§ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * By tjwudi</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Singleton.ins = Singleton.ins ? Singleton.ins : <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * By nonowarn</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">var</span> Singleton = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> instance = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance || (instance = <span class="keyword">this</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€ä»Šå¤©éšä¾¿ç©äº†ä¸€é“ &lt;a href=&quot;http://www.codewars.com/kata/singleton-pattern/javascript&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CodeWar çš„é¢˜&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€é¢˜æ„
      
    
    </summary>
    
      <category term="Node.js" scheme="https://xcoder.in/categories/Node-js/"/>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://xcoder.in/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>è®©æˆ‘ä»¬ç”¨ Node.js å†™è‡ªå·±çš„ DDNS åŠ¨æ€åŸŸåç¨‹åº</title>
    <link href="https://xcoder.in/2014/09/20/lets-build-ourselves-ddns/"/>
    <id>https://xcoder.in/2014/09/20/lets-build-ourselves-ddns/</id>
    <published>2014-09-20T07:51:40.000Z</published>
    <updated>2017-12-11T07:59:20.517Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>ã€€ã€€ä¸€å¼€å§‹æˆ‘åœ¨ç§»åŠ¨çš„å®½å¸¦ä¸­ã€‚é‚£ä¸ªæ—¶å€™è™½ç„¶è¿˜ä¸æ˜¯å®Œå…¨çš„å±€åŸŸç½‘ï¼Œä½†æ˜¯ç”µä¿¡ç½‘ç»œè®¿é—®ä¸äº†æˆ‘çš„å¤–ç½‘ IPã€‚åˆå› ä¸ºæˆ‘éœ€è¦ä¸€ä¸ª DDNS æœåŠ¡æ¥ç»´æŒæˆ‘çš„ <a href="http://kacaka.ca/" target="_blank" rel="external">kacaka.ca</a>ï¼ˆç›®å‰æš‚å¤±æ•ˆï¼‰ã€‚</p><p>ã€€ã€€ä¸ºäº†è§£å†³è®©ç”µä¿¡ç½‘ç»œä¹Ÿèƒ½è®¿é—®æˆ‘çš„ Webï¼Œäºæ˜¯æˆ‘æƒ³åˆ°äº†å…è´¹ CDN å½“ä¸­æ¯”è¾ƒæœ‰åçš„ <a href="http://cloudflare.com/" target="_blank" rel="external">CloudFlare</a>ã€‚è€Œä¸”å®ƒä¹Ÿæœ‰æä¾› API è®©å¼€å‘è€…è‡ªå·±å¼€å‘é€šè¿‡ä»–çš„æœåŠ¡è§£æåŸŸåçš„æœåŠ¡ã€‚</p><p>ã€€ã€€å†ç„¶åï¼Œå»å¹´çš„ä¹æœˆä»½ï¼Œæˆ‘çš„æ—©æœŸ Node.js ä½œå“ <strong><a href="https://github.com/XadillaX/dloucflare/tree/0.0.2" target="_blank" rel="external">dloucflare</a></strong> å‘å¸ƒäº†ã€‚æ‰€ä»¥å°±æœ‰äº†<a href="http://cnodejs.org/topic/522b64c3101e574521332451" target="_blank" rel="external">è¿™ä¸ªå¸–å­</a>ã€‚</p><p>ã€€ã€€ç°åœ¨ï¼Œæˆ‘å·²ç»æ¬åˆ°ç”µä¿¡äº†ï¼Œç„¶åæ—§ç‰ˆçš„è²Œä¼¼ä¸èƒ½ç”¨äº†ï¼Œå› ä¸º <strong>CloudFlare</strong> è²Œä¼¼ API éƒ½è¿ç§»åˆ°äº† <code>https</code> ä¸Šé¢ã€‚ç„¶åæˆ‘ä¸ºäº†æˆ‘çš„å°ä¼™ä¼´ä»¬èƒ½è®¿é—®æˆ‘å‡ºç§Ÿå±‹é‡Œçš„æ—§ç”µè„‘ï¼Œåˆé‡æ„äº†ä¸€é<a href="https://github.com/XadillaX/dloucflare" target="_blank" rel="external">è¿™ä¸ªé¡¹ç›®</a>ã€‚</p><h2 id="ä½¿ç”¨-dlouc-flare-æ„å»º"><a href="#ä½¿ç”¨-dlouc-flare-æ„å»º" class="headerlink" title="ä½¿ç”¨ dlouc-flare æ„å»º"></a>ä½¿ç”¨ dlouc-flare æ„å»º</h2><p>ã€€ã€€é¦–å…ˆå®‰è£…æœ€æ–°çš„ <code>dlouc-flare</code> åŒ…ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm install dlouc-flare</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åå»åˆ›å»ºä¸€ä¸ª <strong>DF</strong> å¯¹è±¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> DloucFlare = <span class="built_in">require</span>(<span class="string">"dlouc-flare"</span>);</span><br><span class="line"><span class="keyword">var</span> df = DloucFlare.create(<span class="string">"ä½ çš„é‚®ç®±"</span>, <span class="string">"API KEY"</span>, <span class="string">"åŸŸåï¼ˆä¸éœ€è¦ wwwï¼‰"</span>);</span><br></pre></td></tr></table></figure><p>ã€€ã€€<strong>CloudFlare</strong> å¦‚ä½•ä½¿ç”¨çš„è¯è¿™é‡Œå°±ä¸å¤šåšè§£é‡Šäº†ï¼Œè‡³äº <strong>API KEY</strong> çš„è¯ï¼Œå¯ä»¥åœ¨<a href="https://www.cloudflare.com/my-account" target="_blank" rel="external">è¿™é‡Œ</a>è·å–åˆ°ã€‚</p><p>ã€€ã€€ç„¶åè°ƒç”¨ <code>df.dynamicDomains</code> å‡½æ•°å»æŠŠä½ è¿™ä¸ªåŸŸåä¸‹é¢çš„ä¸€äº›å­åŸŸååŠ å…¥ä½ è¿™ä¸ªè„šæœ¬çš„åŠ¨æ€åŸŸåèŒƒç•´å½“ä¸­ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">df.dynamicDomains([ <span class="string">"@"</span>, <span class="string">"www"</span>, <span class="string">"å­åŸŸå3"</span>, <span class="string">"å­åŸŸå4"</span>, ... ], æ£€æµ‹æ—¶é—´é—´éš”);</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­ <code>&quot;@&quot;</code> ä»£è¡¨çš„æ˜¯åŸŸåæ²¡æœ‰ <code>www</code> å‰ç¼€çš„æœ¬èº«ã€‚æ£€æµ‹æ—¶é—´é—´éš”ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</p></blockquote><p>ã€€ã€€äº‹å®ä¸Šï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ£€æµ‹ä½ å½“å‰ä¸»æœºçš„ IP åœ°å€çš„å‡½æ•°ï¼ˆå¦‚æœä½ ä¸å–œæ¬¢ç”¨åŒ…å†…çš„é»˜è®¤æ£€æµ‹ IP å‡½æ•°ï¼‰ã€‚</p><p>ã€€ã€€åªè¦ä½ å†™ä¸€ä¸ªå‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkIp</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// blahblah...</span></span><br><span class="line">    callback(<span class="literal">undefined</span>, IPåœ°å€);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åè¦†ç›–æ‰é»˜è®¤çš„ IP æ£€æµ‹å‡½æ•°å³å¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">df.getIpFunction = checkIp;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æœ€åä¿å­˜é€€å‡ºå¹¶ç”¨ <code>node</code> æ‰§è¡Œä½ çš„ç¨‹åºå°±å¥½äº†ï¼Œç¨‹åºå°±ä¼šå¼€å§‹æ¬¢å¿«åœ°è·‘äº†ã€‚</p><p><img src="preview.png" alt="Preview"></p><h2 id="å¦‚ä½•è‡ªå·±å†™ï¼Ÿ"><a href="#å¦‚ä½•è‡ªå·±å†™ï¼Ÿ" class="headerlink" title="å¦‚ä½•è‡ªå·±å†™ï¼Ÿ"></a>å¦‚ä½•è‡ªå·±å†™ï¼Ÿ</h2><p>ã€€ã€€å…¶å®è¦å®Œå…¨è‡ªå·±å†™ä¹Ÿæ˜¯å¾ˆç®€å•çš„â€”â€”æ— éå°±æ˜¯è°ƒç”¨ä¸€ä¸‹ <strong>CloudFlare</strong> çš„ API è€Œå·²ã€‚</p><p>ã€€ã€€æˆ‘ä»¬å®šä½æ˜ç¡®å°±æ˜¯è¦åš DDNSï¼Œæ‰€ä»¥æ²¡å¿…è¦å…³ç³»å…¶å®ƒå¾ˆå¤šä¸ç›¸å…³çš„ APIï¼Œåªéœ€è¦æœ€åŸºç¡€çš„å‡ ä¸ªå°±å¤Ÿäº†ã€‚</p><h3 id="API-è§£æ"><a href="#API-è§£æ" class="headerlink" title="API è§£æ"></a>API è§£æ</h3><p>ã€€ã€€æ‰€æœ‰ API çš„åŸºç¡€ URI éƒ½ä¸ºï¼š<a href="https://www.cloudflare.com/api_json.html" target="_blank" rel="external">https://www.cloudflare.com/api_json.html</a>ã€‚</p><h4 id="éªŒè¯ä¿¡æ¯"><a href="#éªŒè¯ä¿¡æ¯" class="headerlink" title="éªŒè¯ä¿¡æ¯"></a>éªŒè¯ä¿¡æ¯</h4><p>ã€€ã€€æ ¹æ® <strong>CloudFlare</strong> æ–‡æ¡£æ‰€è¯´ï¼Œæ‰€æœ‰çš„æäº¤éƒ½è¦é»ä¸Š<a href="https://www.cloudflare.com/docs/client-api.html#s2.1" target="_blank" rel="external">éªŒè¯ä¿¡æ¯</a>ç»™ POST è¿‡å»ã€‚è€ŒéªŒè¯çš„å­—æ®µå¦‚ä¸‹ï¼š</p><ul><li><strong>tkn:</strong> ä»ä½ çš„ä¸ªäººé¡µé¢å½“ä¸­å¤åˆ¶å‡ºæ¥çš„ API KEYã€‚</li><li><strong>email:</strong> ä½ çš„ç™»å½•é‚®ç®±ã€‚</li><li><strong>a:</strong> æ“ä½œåï¼Œæ¯ç§æ“ä½œéƒ½æœ‰å…¶ç‰¹æœ‰çš„æ“ä½œåã€‚</li></ul><h4 id="è·å–åŸŸåä¸‹çš„å­åŸŸåè®°å½•"><a href="#è·å–åŸŸåä¸‹çš„å­åŸŸåè®°å½•" class="headerlink" title="è·å–åŸŸåä¸‹çš„å­åŸŸåè®°å½•"></a>è·å–åŸŸåä¸‹çš„å­åŸŸåè®°å½•</h4><p>ã€€ã€€å…¶æ“ä½œåä¸º <code>rec_load_all</code>ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå…¶å®ƒä¸é‡è¦çš„å‚æ•°ï¼Œåªéœ€è¦å†ä¼ ä¸€ä¸ª <code>z</code> å­—æ®µä»£è¡¨å…¶åŸŸåå°±å¥½äº†ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"><span class="keyword">var</span> param = &#123;</span><br><span class="line">    <span class="attr">a</span>       : <span class="string">"rec_load_all"</span>,</span><br><span class="line">    <span class="attr">tkn</span>     : <span class="keyword">this</span>.apiKey,</span><br><span class="line">    <span class="attr">email</span>   : <span class="keyword">this</span>.email,</span><br><span class="line">    <span class="attr">z</span>       : <span class="keyword">this</span>.domain</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">"https://www.cloudflare.com/api_json.html"</span>;</span><br><span class="line">spidex.post(url, <span class="function"><span class="keyword">function</span>(<span class="params">html, status</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Error status while fetching DNS records."</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> json;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        json = <span class="built_in">JSON</span>.parse(html);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Error while parsing DNS records: "</span> + e.message));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(json.result === <span class="string">"error"</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> msg = json.msg;</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">undefined</span> === msg) msg = <span class="string">"Unknown error."</span>;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(msg));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(json.result === <span class="string">"success"</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> count = json.response.recs.count;</span><br><span class="line">        <span class="keyword">var</span> objects = json.response.recs.objs;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            self.records.push(<span class="keyword">new</span> DNSRecordObject(self, objects[i]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        callback(<span class="literal">undefined</span>, self.records);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Unknown error."</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, param, <span class="string">"utf8"</span>).on(<span class="string">"error"</span>, callback);</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸Šè¿°ä»£ç å°±æ˜¯æŠŠ <code>param</code> æ•°æ®ç»™ POST åˆ° API çš„ RESTful é‡Œé¢å»ã€‚ç„¶åæ ¹æ®è¿”å›å€¼è¿›è¡Œè§£æã€‚</p><blockquote><p>å…³äº <code>DNSRecordObject</code> çš„ä»£ç å¯ä»¥è‡ªè¡Œç¿»é˜…<a href="https://github.com/XadillaX/dloucflare/blob/master/lib/dnsrecordobject.js" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p><p>ä»¥åŠ <strong>spidex</strong> çš„æ–‡æ¡£åœ¨<a href="https://www.npmjs.org/package/spidex#readme" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p></blockquote><h4 id="ä¿®æ”¹æŸè®°å½•"><a href="#ä¿®æ”¹æŸè®°å½•" class="headerlink" title="ä¿®æ”¹æŸè®°å½•"></a>ä¿®æ”¹æŸè®°å½•</h4><p>ã€€ã€€å…¶æ“ä½œåä¸º <code>rec_edit</code>ï¼Œå¦‚<a href="https://www.cloudflare.com/docs/client-api.html#s5.2" target="_blank" rel="external">æ–‡æ¡£</a>æ‰€è¯´ï¼Œé™¤äº†å›ºæœ‰çš„å‡ ä¸ªå‚æ•°ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰å¦‚ä¸‹å‚æ•°ï¼š</p><ul><li><code>z:</code> åŸŸåã€‚</li><li><code>id:</code> åŸŸåè®°å½•ç¼–å·ï¼Œä» <code>rec_load_all</code> ä¸­è·å–ã€‚</li><li><code>type:</code> è®°å½•ç±»å‹ã€‚å¦‚ <code>A</code> / <code>CNAME</code> ç­‰ç­‰ã€‚</li><li><code>name:</code> å­åŸŸååï¼Œå¦‚æœæ— å‰ç¼€å­åŸŸååˆ™ä¸åŸŸåç›¸åŒã€‚</li><li><code>content:</code> å€¼ã€‚å¦‚æœæˆ‘ä»¬åªæ˜¯åšåŠ¨æ€åŸŸåçš„è¯ï¼Œè¿™é‡Œçš„å€¼å°±æ˜¯ IPã€‚</li><li><code>service_mode:</code> æœåŠ¡ç±»å‹ï¼Œå¡«åŸå€¼å³å¯ã€‚</li><li><code>ttl</code>: TTLï¼Œå¡«åŸå€¼å³å¯ã€‚</li></ul><blockquote><p>ä¸Šé¢å‚æ•°çš„è§£è¯´åªæ˜¯å¯¹äºæˆ‘ä»¬è¦åš DDNS è„šæœ¬è€Œè¨€çš„è§£é‡Šã€‚</p></blockquote><p>ã€€ã€€æ‰€ä»¥è¯´åœ¨ <strong><a href="https://github.com/XadillaX/dloucflare/blob/master/lib/dnsrecordobject.js" target="_blank" rel="external">dnsrecordobject.js</a></strong> ä¸­æˆ‘æ˜¯è¿™ä¹ˆåšçš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> param = &#123;</span><br><span class="line">    <span class="attr">a</span>       : <span class="string">"rec_edit"</span>,</span><br><span class="line">    <span class="attr">tkn</span>     : <span class="keyword">this</span>.dloucflare.apiKey,</span><br><span class="line">    <span class="attr">email</span>   : <span class="keyword">this</span>.dloucflare.email,</span><br><span class="line">    <span class="attr">id</span>      : <span class="keyword">this</span>.recordId(),</span><br><span class="line"></span><br><span class="line">    <span class="attr">z</span>       : <span class="keyword">this</span>.domain,</span><br><span class="line">    <span class="attr">type</span>    : <span class="keyword">this</span>.recordType(),</span><br><span class="line">    <span class="attr">name</span>    : <span class="keyword">this</span>.name,</span><br><span class="line">    <span class="attr">content</span> : ip,</span><br><span class="line"></span><br><span class="line">    <span class="attr">service_mode</span>    : <span class="keyword">this</span>.object.service_mode,</span><br><span class="line">    <span class="attr">ttl</span>     : <span class="keyword">this</span>.object.ttl</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">spidex.post(config.baseUrl, <span class="function"><span class="keyword">function</span>(<span class="params">html, status, respHeader</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Error status while editing "</span> + self.name + <span class="string">"."</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> json;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        json = <span class="built_in">JSON</span>.parse(html);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Error while parsing editing result: "</span> + e.message));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(json.result === <span class="string">"success"</span>) &#123;</span><br><span class="line">        self.object.content = ip;</span><br><span class="line">        <span class="keyword">return</span> callback();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> msg = json.msg || <span class="string">"Unknown error."</span>;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(msg));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, param, <span class="string">"utf8"</span>).on(<span class="string">"error"</span>, callback);</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„ä»£ç å°±èƒ½å°†ä½ æŸä¸ªåŸŸåï¼ˆ<code>this.domain</code>ï¼‰ä¸‹çš„å­åŸŸå <code>this.name</code> çš„ IP ç»™ä¿®æ”¹æˆ <code>ip</code> äº†ã€‚</p></blockquote><h4 id="æ¢æµ‹-IP"><a href="#æ¢æµ‹-IP" class="headerlink" title="æ¢æµ‹ IP"></a>æ¢æµ‹ IP</h4><p>ã€€ã€€è¿™ç§ API ç½‘ä¸Šå°±å¤šäº†å»äº†ã€‚</p><p>ã€€ã€€ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘çš„ <code>dlouc-flare</code> çš„è·å– IP çš„ API å°±æ˜¯ä»</p><blockquote><p><a href="http://www.telize.com/ip" target="_blank" rel="external">http://www.telize.com/ip</a></p></blockquote><p>ã€€ã€€æ¥çš„ã€‚</p><p>ã€€ã€€è¯·æ±‚ä¸Šé¢çš„åœ°å€ä¹‹åï¼Œè¾“å‡ºçš„å†…å®¹ï¼ˆæ³¨æ„æœ‰æ¢è¡Œç¬¦ï¼‰å°±æ˜¯ä½ å½“å‰æœºå­æ‰€åœ¨çš„ç½‘ç»œçš„å…¬ç½‘ IP äº†ã€‚</p><p>ã€€ã€€ç±»ä¼¼çš„ API è¿˜æœ‰å¾ˆå¤šï¼š</p><ul><li><strong><a href="http://ip-api.com/json" target="_blank" rel="external">http://ip-api.com/json</a></strong>: è¿™ä¸ª API å°±ä¼šè¾“å‡ºä¸€å †çš„ JSONï¼Œéœ€è¦è‡ªè¡Œè§£æã€‚</li><li><strong><a href="http://ip.taobao.com/service/getIpInfo2.php?ip=myip" target="_blank" rel="external">http://ip.taobao.com/service/getIpInfo2.php?ip=myip</a></strong>: è¿™ä¸ªæ˜¯æ·˜å®æä¾›çš„ RESTful è·å– IP çš„ APIã€‚</li><li>â€¦ï¼ˆå…¶å®ƒçš„å¯ä»¥è‡ªå·±å»å‘ç°ï¼‰</li></ul><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p>ã€€ã€€æœ‰äº†ä¸Šé¢çš„ä»¨ APIï¼Œä¸€åˆ‡éƒ½å¥½è¯´äº†ï¼Œæµç¨‹å¾ˆç®€å•ï¼š</p><ul><li>è·å–è‡ªå·±æŸä¸ªä½¿ç”¨ <code>CloudFlare</code> è§£æçš„åŸŸåä¸‹çš„<a href="#è·å–åŸŸåä¸‹çš„å­åŸŸåè®°å½•">å­åŸŸå</a>ã€‚</li><li>è‡ªå·±è®¾ç½®å‡ ä¸ªå­åŸŸååæ‹¿æ¥åš DDNSã€‚</li><li>è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯æ¬¡å®šæ—¶å™¨åˆ°æ—¶çš„æ—¶å€™éƒ½è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š<ol><li>é€šè¿‡ <a href="#æ¢æµ‹_IP">IP çš„ API</a> è·å–å½“å‰ IPã€‚</li><li>å¾ªç¯éå†æ¯ä¸ªè‡ªå·±è®¾ç½®çš„å­åŸŸååã€‚</li><li>å¯¹äºæ¯ä¸ªå­åŸŸåï¼Œéƒ½åˆ¤æ–­å…¶å½“å‰è®°å½• IP æ˜¯å¦ç­‰äºå½“å‰åˆšæ¢æµ‹çš„ IPã€‚<ul><li><strong>æ˜¯</strong>ï¼š<a href="#ä¿®æ”¹æŸè®°å½•">ä¿®æ”¹è¯¥å­åŸŸåçš„è®°å½•å€¼</a>ä¸ºåˆšæ¢æµ‹çš„ IPã€‚</li><li><strong>å¦</strong>ï¼šä¸ä½œä»»ä½•æ“ä½œã€‚</li></ul></li></ol></li></ul><p>ã€€ã€€æœ‰äº†ä¸Šé¢çš„å‡ ä¸ªæ­¥éª¤ï¼ŒåŠ ä¸Šä¹‹å‰æˆ‘ä»¬è®²çš„å‡ ä¸ª APIï¼Œå¤§å®¶å°±èƒ½è½»æ¾åŠ æ„‰å¿«åœ°å®Œæˆè‡ªå·±çš„ DDNS è„šæœ¬äº†ã€‚</p><p>ã€€ã€€å½“ç„¶ï¼Œå¦‚æœè‡ªå·±æ‡’çš„è¯ä¹Ÿå¯ä»¥ç”¨æœ¬æ–‡ä¸€å¼€å§‹çš„æ–¹æ³•ï¼Œä½¿ç”¨ <code>dlouc-flare</code> è¿™ä¸ªåŒ…ï¼Œé€šè¿‡ç®€å•çš„ç¼–ç å°±èƒ½å®ç°è‡ªå·±çš„ DDNS åŠ¨æ€åŸŸåè„šæœ¬äº†ã€‚</p><blockquote><p>è¿™é‡Œçš„å®šæ—¶å™¨æ—¶é—´è‡ªå·±æŒ‰éœ€è€Œå®šï¼Œå°±æˆ‘è‡ªå·±è€Œè¨€ï¼Œæˆ‘æ˜¯ç»™è®¾ç½®äº† <code>1000 * 60</code> æ¯«ç§’çš„é—´éš”ã€‚</p></blockquote><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ã€€ã€€æœ€æ—©ä¸åŠ¨æ€åŸŸåç»“ç¼˜çš„æ—¶å€™æ˜¯åˆä¸­çš„æ—¶å€™ï¼Œå¤§æ¦‚ä¸ƒå…«å¹´å‰äº†å§ï¼Œé‚£ä¸ªæ—¶å€™èŠ±ç”Ÿå£³ä»€ä¹ˆçš„ï¼Œä½†æ˜¯æœ€ç»ˆç”¨çš„æ˜¯ <code>3322.org</code>ã€‚</p><p>ã€€ã€€å…¶å®åŸºæœ¬çš„åŠ¨æ€åŸŸåçš„åŸç†å¾ˆç®€å•ï¼Œæ— éå°±æ˜¯æœ¬åœ°å¼€ä¸€ä¸ªè„šæœ¬ï¼Œä¸åœå»æ¢æµ‹æœ¬æœº IPï¼Œä¸€æ—¦æœ‰å˜åŒ–å°±å»è§£ææœåŠ¡å™¨ä¿®æ”¹ã€‚</p><p>ã€€ã€€æœ¬äººåœ¨è¿™é‡ŒæŠ›ç –å¼•ç‰ã€‚å¦‚æœå“ªé‡Œæœ‰åˆ«çš„è§£æå•†çš„ APIï¼Œå¤§å®¶è‡ªå·±ä¹Ÿå¯ä»¥ä¸¾ä¸€åä¸‰ï¼Œå†™ä»€ä¹ˆ DNSPod çš„åŠ¨æ€åŸŸåï¼Œå†™ä»€ä¹ˆ jiasule çš„åŠ¨æ€åŸŸåç­‰ç­‰ç­‰ç­‰ã€‚</p><p>ã€€ã€€å–µ~<em>à¬˜(à©­</em>ËŠáµ•Ë‹)à©­* à©ˆâœ©â€§â‚ŠËš</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h2&gt;&lt;p&gt;ã€€ã€€ä¸€å¼€å§‹æˆ‘åœ¨ç§»åŠ¨çš„å®½å¸¦ä¸­ã€‚é‚£ä¸ªæ—¶å€™è™½ç„¶è¿˜ä¸æ˜¯å®Œå…¨çš„å±€åŸŸç½‘ï¼Œä½†æ˜¯ç”µä¿¡ç½‘ç»œè®¿é—®ä¸äº†æˆ‘çš„å¤–ç½‘ IPã€‚åˆå› ä¸ºæˆ‘éœ€è¦ä¸€ä¸ª DDNS æœåŠ¡æ¥ç»´æŒæˆ‘çš„ 
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="DDNS" scheme="https://xcoder.in/tags/DDNS/"/>
    
      <category term="åŠ¨æ€åŸŸå" scheme="https://xcoder.in/tags/%E5%8A%A8%E6%80%81%E5%9F%9F%E5%90%8D/"/>
    
  </entry>
  
  <entry>
    <title>å›¾ç‰‡ä¸»é¢˜è‰²æå–ç®—æ³•å°ç»“</title>
    <link href="https://xcoder.in/2014/09/17/theme-color-extract/"/>
    <id>https://xcoder.in/2014/09/17/theme-color-extract/</id>
    <published>2014-09-17T03:34:54.000Z</published>
    <updated>2017-12-11T07:59:20.548Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‰€è°“ä¸»é¢˜è‰²æå–ï¼Œå°±æ˜¯å¯¹äºä¸€å¼ å›¾ç‰‡ï¼Œè¿‘ä¼¼åœ°æå–å‡ºä¸€ä¸ªè°ƒè‰²æ¿ï¼Œä½¿å¾—è°ƒè‰²æ¿é‡Œé¢çš„é¢œè‰²èƒ½ç»„æˆè¿™å¼ å›¾ç‰‡çš„ä¸»è‰²è°ƒã€‚</p></blockquote><p>ã€€ã€€ä»¥ä¸Šå®šä¹‰ä¸ºæˆ‘ä¸ªäººèƒ¡è¯Œçš„ã€‚</p><p>ã€€ã€€å¤§å®¶ä¸è¦å¤ªæŠŠæˆ‘çš„ä¸œè¥¿å½“æˆä¸¥è°¨çš„æ–‡ç« æ¥çœ‹ï¼Œå¾ˆå¤šä¸œè¥¿ä»€ä¹ˆçš„éƒ½æ˜¯æˆ‘ç”¨æˆ‘è‡ªå·±çš„ç†è§£å»åšï¼Œå¹¶æ²¡æœ‰åšå¤šå°‘è€ƒè¯ã€‚</p><p>ã€€ã€€è§£æä¸­éƒ½ä¼šä»¥ Node.js æ¥å†™ä¸€äº›å° Demoã€‚</p><h2 id="å¼•å­"><a href="#å¼•å­" class="headerlink" title="å¼•å­"></a>å¼•å­</h2><p>ã€€ã€€å†™è¯¥æ–‡ç« ä¸»è¦æ˜¯ä¸ºäº†å¯¹æˆ‘è¿™å‡ å¤©å¯¹äºã€ä¸»é¢˜è‰²æå–ã€ç®—æ³•ç ”ç©¶è¿›è¡Œä¸€ä¸ªå°ç»“ã€‚</p><p>ã€€ã€€èŠ±ç“£ç½‘éœ€è¦åšä¸€ä»¶äº‹ï¼Œå°±æ˜¯æŠŠå›¾ç‰‡çš„ä¸»é¢˜è‰²æå–å‡ºæ¥åŠ å…¥åˆ°èŠ±ç“£ç½‘æœç´¢å¼•æ“çš„ç´¢å¼•å½“ä¸­ï¼Œä»¥ä¾›ç”¨æˆ·æœç´¢ã€‚</p><p>ã€€ã€€äºæ˜¯æœ‰äº†ä¸€ä¸ªéœ€æ±‚ï¼šæå–å‡ºå›¾ç‰‡ä¸­åœ¨æŸä¸ªè§„å®šè°ƒè‰²æ¿ä¸­çš„é¢œè‰²ï¼ŒåŠ å…¥åˆ°æœç´¢å¼•æ“ã€‚</p><p>ã€€ã€€æ¥ä¸‹å»å°±å¼€å§‹è§£æä¸¤ç§ä¸åŒçš„ç®—æ³•ä»¥åŠåœ¨è¿™ç§ä¸šåŠ¡åœºæ™¯å½“ä¸­çš„åº”ç”¨ã€‚</p><h2 id="ç®—æ³•è§£æ"><a href="#ç®—æ³•è§£æ" class="headerlink" title="ç®—æ³•è§£æ"></a>ç®—æ³•è§£æ</h2><h3 id="é­”æ³•æ•°å­—æ³•"><a href="#é­”æ³•æ•°å­—æ³•" class="headerlink" title="é­”æ³•æ•°å­—æ³•"></a><del>é­”æ³•æ•°å­—æ³•</del></h3><p>ã€€ã€€è¿™ä¸ªç®—æ³•å¤§å®¶å¯ä»¥å¿½ç•¥ï¼Œå¯èƒ½æ˜¯æˆ‘ä½¿ç”¨çš„å§¿åŠ¿ä¸å¯¹ï¼Œæ€»ä¹‹æå–å‡ºæ¥ï¼ˆä¹Ÿè®¸å®ƒæ ¹æœ¬å°±ä¸æ˜¯è¿™ä¹ˆç”¨çš„ï¼‰çš„ä¸œè¥¿é”™è¯¯å¾ˆå¤§ã€‚</p><p>ã€€ã€€ä¸è¿‡çœ‹ä¸€ä¸‹ä¹Ÿå¥½å¼€é˜”ä¸‹çœ¼ç•Œï¼Œå°¤å…¶æ˜¯æˆ‘è¿™ç§æƒ³åšæ¸¸æˆåˆä¸å°å¿ƒæ‰è¿›äº’è”ç½‘çš„å‘é‡Œçš„è’Ÿè’»æ¥è¯´ã€‚</p><p>ã€€ã€€é¦–å…ˆè¯¥ç®—æ³•æˆ‘æ˜¯ä»<a href="http://dev.gameres.com/Program/Visual/Other/256color.htm" target="_blank" rel="external">è¿™é‡Œ</a>æ‰¾åˆ°çš„ã€‚æƒ³å½“å¹´æˆ‘è¿˜æ˜¯ç»å¸¸é€› <a href="http://www.gameres.com/" target="_blank" rel="external">GameRes</a> çš„ã€‚ãƒ¾(;ï¾Ÿ;Ğ”;ï¾Ÿ;)ï¾‰ï¾</p><p>ã€€ã€€ç„¶åè¾—è½¬åä¾§æœ€ç»ˆå‘ç°è¿™æ®µä»£ç æ˜¯æå–è‡ª <a href="https://github.com/liballeg/allegro5/blob/4.3/src/color.c#L268-L328" target="_blank" rel="external">Allegro</a> æ¸¸æˆå¼•æ“ã€‚</p><p>ã€€ã€€å…·ä½“æˆ‘ä¹Ÿå°±ä¸è®²äº†ï¼Œæ¯•ç«Ÿæ‰¾ä¸åˆ°èµ„æ–™ï¼Œåªæ˜¯ç²—ç²—ç„äº†çœ¼ä»£ç é‡Œé¢æœ‰å‡ ä¸ªé­”æ³•æ•°å­—ï¼ˆåœ¨æ¸¸æˆå’Œç®—æ³•é¢†åŸŸé­”æ³•æ•°å­—å€’æ˜¯éå¸¸å¸¸è§çš„ï¼‰ï¼Œä¹Ÿæ²¡æ—¶é—´æ·±å…¥è§£è¯»è¿™æ®µä»£ç ã€‚</p><p>ã€€ã€€æˆ‘æŠŠå®ƒç¿»è¯‘æˆäº† Node.jsï¼Œç„¶åæ”¾åœ¨äº† <a href="https://github.com/XadillaX/theme-color-test/blob/master/version1/magicnumber.js" target="_blank" rel="external">Demo</a> å½“ä¸­ã€‚å¤§å®¶æœ‰å…´è¶£å¯ä»¥è‡ªå·±å»çœ‹çœ‹ã€‚</p><h3 id="å…«å‰æ ‘æå–æ³•"><a href="#å…«å‰æ ‘æå–æ³•" class="headerlink" title="å…«å‰æ ‘æå–æ³•"></a>å…«å‰æ ‘æå–æ³•</h3><p>ã€€ã€€è¿™ä¸ªç®—æ³•åœ¨é¢œè‰²é‡åŒ–ä¸­æ¯”è¾ƒå¸¸è§çš„ã€‚</p><blockquote><p>è¯¥ç®—æ³•æœ€æ—©è§äº 1988 å¹´ï¼Œ<strong><em>M. Gervautz</em></strong> å’Œ <strong><em>W. Purgathofer</em></strong> å‘è¡¨çš„è®ºæ–‡<strong><em>ã€ŠA Simple Method for Color Quantization: Octree Quantizationã€‹</em></strong>å½“ä¸­ã€‚å…¶æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦éƒ½æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”ä¿çœŸåº¦ä¹Ÿæ˜¯éå¸¸çš„é«˜ã€‚</p></blockquote><p>ã€€ã€€å¤§è‡´çš„æ€è·¯å°±æ˜¯å¯¹äºæŸä¸€ä¸ªåƒç´ ç‚¹çš„é¢œè‰² <strong>R / G / B</strong> åˆ†å¼€æ¥ä¹‹åï¼Œç”¨äºŒè¿›åˆ¶é€è¡Œå†™ä¸‹ã€‚</p><p>ã€€ã€€å¦‚ <code>#FF7800</code>ï¼Œå…¶ä¸­ <strong>R</strong> é€šé“ä¸º <code>0xFF</code>ï¼Œä¹Ÿå°±æ˜¯ <code>255</code>ï¼Œ<strong>G</strong> ä¸º <code>0x78</code> ä¹Ÿå°±æ˜¯ <code>120</code>ï¼Œ<strong>B</strong> ä¸º <code>0x00</code> ä¹Ÿå°±æ˜¯ <code>0</code>ã€‚</p><p>ã€€ã€€æ¥ä¸‹å»æˆ‘ä»¬æŠŠå®ƒä»¬å†™æˆäºŒè¿›åˆ¶é€è¡Œæ”¾ä¸‹ï¼Œé‚£ä¹ˆå°±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">R: 1111 1111</span><br><span class="line">G: 0111 1000</span><br><span class="line">B: 0000 0000</span><br></pre></td></tr></table></figure><p>ã€€ã€€<strong>RGB</strong> é€šé“é€åˆ—é»åˆä¹‹åçš„å€¼å°±æ˜¯å…¶åœ¨æŸä¸€å±‚èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ç¼–å·äº†ã€‚æ¯ä¸€åˆ—ä¸€å…±æ˜¯ä¸‰ä½ï¼Œé‚£ä¹ˆå–å€¼èŒƒå›´å°±æ˜¯ <code>0 ~ 7</code> ä¹Ÿå°±æ˜¯ä¸€å…±æœ‰å…«ç§æƒ…å†µã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ç§ç®—æ³•è¦å¼€å…«å‰æ ‘æ¥è®¡ç®—çš„åŸå› äº†ã€‚</p><p>ã€€ã€€ä¸¾ä¸ªä¾‹å­ï¼Œä¸Šè¿°é¢œè‰²çš„ç¬¬ä¸€ä½é»åˆèµ·æ¥æ˜¯ <code>100(2)</code>ï¼Œè½¬åŒ–ä¸ºåè¿›åˆ¶å°±æ˜¯ 4ï¼Œæ‰€ä»¥è¿™ä¸ªé¢œè‰²åœ¨ç¬¬ä¸€å±‚æ˜¯æ”¾åœ¨æ ¹èŠ‚ç‚¹çš„ç¬¬äº”ä¸ªå­èŠ‚ç‚¹å½“ä¸­ï¼›ç¬¬äºŒä½æ˜¯ <code>110(2)</code> ä¹Ÿå°±æ˜¯ 6ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯æ ¹èŠ‚ç‚¹çš„ç¬¬äº”ä¸ªå„¿å­çš„ç¬¬ä¸ƒä¸ªå„¿å­ã€‚</p><p>ã€€ã€€äºæ˜¯æˆ‘ä»¬æœ‰äº†è¿™æ ·çš„ä¸€ä¸ªèŠ‚ç‚¹ç»“æ„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> OctreeNode = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.isLeaf = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.pixelCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.red = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.green = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.blue = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.children = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.children.length; i++) <span class="keyword">this</span>.children[i] = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„ next ä¸æ˜¯æŒ‡å…„å¼Ÿé“¾ä¸­çš„ next æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// è€Œæ˜¯åœ¨ reducible é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><code>isLeaf</code>: è¡¨æ˜è¯¥èŠ‚ç‚¹æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹ã€‚</li><li><code>pixelCount</code>: åœ¨è¯¥èŠ‚ç‚¹çš„é¢œè‰²ä¸€å…±æ’å…¥äº†å‡ æ¬¡ã€‚</li><li><code>red</code>: è¯¥èŠ‚ç‚¹ <strong>R</strong> é€šé“ç´¯åŠ å€¼ã€‚</li><li><code>green</code>: <strong>G</strong> ç´¯åŠ å€¼ã€‚</li><li><code>blue</code>: <strong>B</strong> ç´¯åŠ å€¼ã€‚</li><li><code>children</code>: å…«ä¸ªå­èŠ‚ç‚¹æŒ‡é’ˆã€‚</li><li><code>next</code>: <strong><em>reducible</em></strong> é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆï¼Œåé¢ä¼šä½œè¯¦ç»†è§£é‡Šï¼Œç›®å‰å¯ä»¥å…ˆå¿½ç•¥ã€‚</li></ul><h4 id="æ’å…¥é¢œè‰²"><a href="#æ’å…¥é¢œè‰²" class="headerlink" title="æ’å…¥é¢œè‰²"></a>æ’å…¥é¢œè‰²</h4><p>ã€€ã€€æ ¹æ®ä¸Šé¢çš„ç†è®ºï¼Œæˆ‘ä»¬å¤§è‡´å°±çŸ¥é“äº†å¾€å…«å‰æ ‘æ’å…¥ä¸€ä¸ªåƒç´ ç‚¹é¢œè‰²çš„æ­¥éª¤äº†ã€‚</p><p>ã€€ã€€å°±æ˜¯æ¯ä¸€ä½ <strong>RGB</strong> é€šé“é»åˆçš„å€¼å°±æ˜¯å®ƒåœ¨æ ‘çš„é‚£ä¸€å±‚çš„å­èŠ‚ç‚¹çš„ç¼–å·ã€‚</p><p>ã€€ã€€å¤§è‡´å¯ä»¥çœ‹ä¸‹å›¾ï¼š</p><p><img src="http://www.microsoft.com/msj/archive/wicked1.gif" alt="å…«å‰æ ‘æ’å…¥"><br><small>å›¾ç‰‡æ¥æºï¼š<a href="http://www.microsoft.com/msj/archive/S3F1.aspx" target="_blank" rel="external">http://www.microsoft.com/msj/archive/S3F1.aspx</a></small></p><p>ã€€ã€€ç”±æ­¤å¯ä»¥æ¨æ–­ï¼Œåœ¨æ²¡æœ‰ä»»ä½•é¢œè‰²åˆå¹¶çš„æƒ…å†µä¸‹ï¼Œæ’å…¥ä¸€ç§é¢œè‰²æœ€åçš„æƒ…å†µä¸‹æ˜¯è¿›è¡Œ 64 æ¬¡æ£€ç´¢ã€‚</p><blockquote><p><strong>æ³¨æ„ï¼š</strong>æˆ‘ä»¬å°†ä¼šæŠŠè¯¥é¢œè‰²çš„ RGB åˆ†é‡åˆ†åˆ«ç´¯åŠ åˆ°è¯¥èŠ‚ç‚¹çš„å„åˆ†é‡å€¼ä¸­ï¼Œä»¥ä¾¿æœ€ç»ˆæ±‚å¹³å‡æ•°ã€‚</p></blockquote><p>ã€€ã€€å¤§è‡´çš„æµç¨‹å°±æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ DFSï¼Œå¦‚æœåˆ°è¾¾çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåˆ†é‡ã€é¢œè‰²æ€»æ•°ç´¯åŠ ï¼›å¦åˆ™å°±æ ¹æ®å±‚æ•°å’Œè¯¥é¢œè‰²çš„ç¬¬å±‚æ•°ä½é¢œè‰²é»åˆå€¼å¾—åˆ°å…¶å­èŠ‚ç‚¹åºå·ã€‚è‹¥è¯¥å­èŠ‚ç‚¹ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ªå­èŠ‚ç‚¹å¹¶ä¸è¯¥çˆ¶èŠ‚ç‚¹å…³è”ï¼Œå¦åˆ™å°±ç›´æ¥æœä¸‹ä¸€å±‚å»ã€‚</p><p>ã€€ã€€åˆ›å»ºçš„æ—¶å€™æ ¹æ®å±‚æ•°æ¥ç¡®å®šå®ƒæ˜¯ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯çš„è¯éœ€è¦æ ‡è®°ä¸€ä¸‹ï¼Œå¹¶ä¸”å…¨å±€çš„å¶å­èŠ‚ç‚¹æ•°è¦åŠ ä¸€ã€‚</p><p>ã€€ã€€è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„å°±æ˜¯å¦‚æœè¿™ä¸ªèŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå°±å°†å…¶ä¸¢åˆ° <strong><em>reducible</em></strong> ç›¸åº”å±‚æ•°çš„é“¾è¡¨å½“ä¸­å»ï¼Œä»¥ä¾›ä¹‹åé¢œè‰²åˆå¹¶çš„æ—¶å€™ç”¨ã€‚å…³äºé¢œè‰²åˆå¹¶çš„å†…å®¹åé¢ä¼šè¿›è¡Œè§£é‡Šã€‚</p><p>ã€€ã€€ä¸‹é¢æ˜¯åˆ›å»ºèŠ‚ç‚¹çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createNode</span>(<span class="params">idx, level</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> node = <span class="keyword">new</span> OctreeNode();</span><br><span class="line">    <span class="keyword">if</span>(level === <span class="number">7</span>) &#123;</span><br><span class="line">        node.isLeaf = <span class="literal">true</span>;</span><br><span class="line">        leafNum++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å°†å…¶ä¸¢åˆ°ç¬¬ level å±‚çš„ reducible é“¾è¡¨ä¸­</span></span><br><span class="line">        node.next = reducible[level];</span><br><span class="line">        reducible[level] = node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä»¥åŠä¸‹é¢æ˜¯æ’å…¥æŸç§é¢œè‰²çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addColor</span>(<span class="params">node, color, level</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node.isLeaf) &#123;</span><br><span class="line">        node.pixelCount++;</span><br><span class="line">        node.red += color.r;</span><br><span class="line">        node.green += color.g;</span><br><span class="line">        node.blue += color.b;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ç”±äº js å†…éƒ¨éƒ½æ˜¯ä»¥æµ®ç‚¹å‹å­˜å‚¨æ•°å€¼ï¼Œæ‰€ä»¥ä½è¿ç®—å¹¶æ²¡æœ‰é‚£ä¹ˆé«˜æ•ˆ</span></span><br><span class="line">        <span class="comment">// åœ¨æ­¤ä½¿ç”¨ç›´æ¥è½¬æ¢å­—ç¬¦ä¸²çš„æ–¹å¼æå–æŸä¸€ä½çš„å€¼</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// å®é™…ä¸Šå¦‚æœç”¨ä½è¿ç®—æ¥åšçš„è¯å°±æ˜¯è¿™æ ·å­çš„ï¼š</span></span><br><span class="line">        <span class="comment">//   https://github.com/XadillaX/thmclrx/blob/7ab4de9fce583e88da6a41b0e256e91c45a10f67/src/octree.cpp#L91-L103</span></span><br><span class="line">        <span class="keyword">var</span> str = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">var</span> r = color.r.toString(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">var</span> g = color.g.toString(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">var</span> b = color.b.toString(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">while</span>(r.length &lt; <span class="number">8</span>) r = <span class="string">'0'</span> + r;</span><br><span class="line">        <span class="keyword">while</span>(g.length &lt; <span class="number">8</span>) g = <span class="string">'0'</span> + g;</span><br><span class="line">        <span class="keyword">while</span>(b.length &lt; <span class="number">8</span>) b = <span class="string">'0'</span> + b;</span><br><span class="line"></span><br><span class="line">        str += r[level];</span><br><span class="line">        str += g[level];</span><br><span class="line">        str += b[level];</span><br><span class="line">        <span class="keyword">var</span> idx = <span class="built_in">parseInt</span>(str, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> === node.children[idx]) &#123;</span><br><span class="line">            node.children[idx] = createNode(node, idx, level + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">undefined</span> === node.children[idx]) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(color.r.toString(<span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        addColor(node.children[idx], color, level + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆå¹¶é¢œè‰²"><a href="#åˆå¹¶é¢œè‰²" class="headerlink" title="åˆå¹¶é¢œè‰²"></a>åˆå¹¶é¢œè‰²</h4><p>ã€€ã€€è¿™ä¸€æ­¥å°±æ˜¯å…«å‰æ ‘çš„ç©ºé—´å¤æ‚åº¦ä½å’Œä¿çœŸåº¦é«˜çš„å¦ä¸€ä¸ªåŸå› äº†ã€‚</p><blockquote><p>å‹¿å¿˜åˆå¿ƒã€‚</p></blockquote><p>ã€€ã€€æˆ‘ä»¬ç”¨è¿™ä¸ªç®—æ³•åšçš„æ˜¯é¢œè‰²é‡åŒ–ï¼Œæˆ–è€…è¯´æˆ‘è¦æ‹¿å®ƒæå–ä¸»é¢˜è‰²ã€è°ƒè‰²æ¿ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯æå–å‡ ä¸ªæœ‰ä»£è¡¨æ€§çš„é¢œè‰²å°±å¤Ÿäº†ï¼Œå¦åˆ™èŒ«èŒ«ä¸–ç•Œä¸­ <strong>RRGGBB</strong> ä¸€å…±æœ‰ 419430400 ç§é¢œè‰²ï¼Œæ€ä¹ˆå½’çº³ï¼Ÿ</p><p>ã€€ã€€æˆ‘ä»¬å¯ä»¥è®©æŒ‡å®šä¸€æ£µå…«å‰æ ‘ä¸è¶…è¿‡å¤šå°‘å¤šå°‘å¶å­èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯æœ€åèƒ½å½’çº³å‡ºæ¥çš„ä¸»é¢˜è‰²æ•°ï¼‰ï¼Œæ¯”å¦‚ 8ï¼Œæ¯”å¦‚ 16ã€64 æˆ–è€… 256 ç­‰ç­‰ã€‚</p><p>ã€€ã€€æ‰€ä»¥å½“å¶å­èŠ‚ç‚¹æ•°è¶…è¿‡æˆ‘ä»¬è§„å®šçš„å¶å­èŠ‚ç‚¹æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦åˆå¹¶å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°†å…¶æ‰€æœ‰å­èŠ‚ç‚¹çš„æ•°æ®éƒ½åˆå¹¶åˆ°å®ƒèº«ä¸Šå»ã€‚</p><p>ã€€ã€€ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªèŠ‚ç‚¹æœ‰å…«ä¸ªå­èŠ‚ç‚¹ï¼Œå¹¶ä¸”éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠå…«ä¸ªå¶å­èŠ‚ç‚¹çš„é€šé“åˆ†é‡å…¨ç´¯åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸­ï¼Œé¢œè‰²æ€»æ•°ä¹Ÿç´¯åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸­ï¼Œç„¶ååˆ é™¤å…«ä¸ªå¶å­èŠ‚ç‚¹å¹¶æŠŠè¯¥èŠ‚ç‚¹è®¾ç½®ä¸ºå¶å­èŠ‚ç‚¹ã€‚é‚£ä¹ˆä¸€ä¸‹å­æˆ‘ä»¬å°±åˆå¹¶äº†å…«ä¸ªèŠ‚ç‚¹æœ‰æœ¨æœ‰ï¼</p><p>ã€€ã€€ä¸ºä»€ä¹ˆè¿™äº›èŠ‚ç‚¹å¯ä»¥è¢«åˆå¹¶å‘¢ï¼Ÿ</p><p>ã€€ã€€æˆ‘ä»¬æ¥çœ‹çœ‹æŸä¸ªèŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹é¢œè‰²éƒ½æœ‰ç¥é©¬ç›¸ä¼¼ç‚¹å§â€”â€”å®ƒä»¬çš„ä¸‰ä¸ªåˆ†é‡å‰ä¸ƒä½ï¼ˆæˆ–è€…è¯´å¦‚æœå·²ç»ä¸æ˜¯æœ€åº•å±‚çš„èŠ‚ç‚¹çš„è¯é‚£å°±æ˜¯å‰å‡ ä½ï¼‰æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆæ¯”å¦‚è¯´åˆšæ‰çš„ <code>FF7800</code>ï¼Œè·Ÿå®ƒåŒçº§å¹¶ä¸”æ‹¥æœ‰ç›¸åŒçˆ¶èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯å®ƒçš„å…„å¼ŸèŠ‚ç‚¹ï¼‰çš„é¢œè‰²éƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">R: 1111 111(0,1)</span><br><span class="line">G: 0111 100(0,1)</span><br><span class="line">B: 0000 000(0,1)</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ•´åˆå‡ºæ¥ä¸€çœ‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FE7800</span><br><span class="line">FE7801</span><br><span class="line">FE7900</span><br><span class="line">FE7901</span><br><span class="line">FF7800</span><br><span class="line">FF7801</span><br><span class="line">FF7900</span><br><span class="line">FF7901</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ€ä¹ˆæ ·ï¼Ÿæ˜¯ä¸æ˜¯ç¡®å®å¾ˆç›¸è¿‘ï¼Ÿè¿™å°±æ˜¯å…«å‰æ ‘çš„ç²¾é«“äº†ï¼Œæ‰€æœ‰çš„å…„å¼ŸèŠ‚ç‚¹è‚¯å®šæ˜¯åœ¨ä¸€ä¸ªç›¸è¿‘çš„é¢œè‰²èŒƒå›´å†…ã€‚</p><p>ã€€ã€€æ‰€ä»¥è¯´æˆ‘ä»¬è¦åˆå¹¶å°±å…ˆå»æœ€åº•å±‚çš„ <strong><em>reducible</em></strong> é“¾è¡¨ä¸­å¯»æ‰¾ä¸€ä¸ªå¯ä»¥åˆå¹¶çš„èŠ‚ç‚¹ï¼ŒæŠŠå®ƒä»é“¾è¡¨ä¸­åˆ é™¤ä¹‹ååˆå¹¶å¶å­èŠ‚ç‚¹å¹¶ä¸”åˆ é™¤å…¶å¶å­èŠ‚ç‚¹å°±å¥½äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reduceTree</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°æœ€æ·±å±‚æ¬¡çš„å¹¶ä¸”æœ‰å¯åˆå¹¶èŠ‚ç‚¹çš„é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">var</span> lv = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">null</span> === reducible[lv]) lv--;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–å‡ºé“¾è¡¨å¤´å¹¶å°†å…¶ä»é“¾è¡¨ä¸­ç§»é™¤</span></span><br><span class="line">    <span class="keyword">var</span> node = reducible[lv];</span><br><span class="line">    reducible[lv] = node.next;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå¹¶å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">var</span> r = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> g = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> === node.children[i]) <span class="keyword">continue</span>;</span><br><span class="line">        r += node.children[i].red;</span><br><span class="line">        g += node.children[i].green;</span><br><span class="line">        b += node.children[i].blue;</span><br><span class="line">        count += node.children[i].pixelCount;</span><br><span class="line">        leafNum--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èµ‹å€¼</span></span><br><span class="line">    node.isLeaf = <span class="literal">true</span>;</span><br><span class="line">    node.red = r;</span><br><span class="line">    node.green = g;</span><br><span class="line">    node.blue = b;</span><br><span class="line">    node.pixelCount = count;</span><br><span class="line">    leafNum++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™æ ·ä¸€æ¥ï¼Œå°±åˆå¹¶äº†ä¸€ä¸ªæœ€æ·±å±‚æ¬¡çš„èŠ‚ç‚¹äº†ï¼Œå¦‚æœæ»¡æ‰“æ»¡ç®—çš„è¯ï¼Œä¸€æ¬¡åˆå¹¶æœ€å¤šä¼šçƒ§æ‰ 7 ä¸ªèŠ‚ç‚¹ï¼ˆæˆ‘å¤§ FFF å›¢å£®å“‰ï¼‰ã€‚</p><h4 id="å»ºæ ‘"><a href="#å»ºæ ‘" class="headerlink" title="å»ºæ ‘"></a>å»ºæ ‘</h4><p>ã€€ã€€ä¸Šé¢çš„å‡½æ•°éƒ½æœ‰äº†ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å»ºæ ‘äº†ã€‚</p><p>ã€€ã€€å®é™…ä¸Šå»ºæ ‘çš„è¿‡ç¨‹å°±æ˜¯éå†ä¸€éä¼ å…¥çš„åƒç´ é¢œè‰²ä¿¡æ¯ï¼Œå¯¹äºæ¯ä¸ªé¢œè‰²éƒ½æ’å…¥åˆ°å…«å‰æ ‘å½“ä¸­ï¼›å¹¶ä¸”æ¯ä¸€æ¬¡æ’å…¥ä¹‹åéƒ½åˆ¤æ–­ä¸‹å¶å­èŠ‚ç‚¹æ•°æœ‰æ²¡æœ‰æº¢å‡ºï¼Œå¦‚æœæ»¡å‡ºæ¥çš„è¯éœ€è¦åŠæ—¶åˆå¹¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildOctree</span>(<span class="params">pixels, maxColors</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pixels.length; i++) &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ é¢œè‰²</span></span><br><span class="line">        addColor(root, pixels[i], <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå¹¶å¶å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">while</span>(leafNum &gt; maxColors) reduceTree();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ•´æ£µæ ‘å»ºå¥½ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å¾—åˆ°äº†æœ€å¤šæœ‰ <code>maxColors</code> ä¸ªå¶å­èŠ‚ç‚¹çš„é«˜ä¿çœŸå…«å‰æ ‘ã€‚å…¶æ ¹èŠ‚ç‚¹ä¸º <code>root</code>ã€‚</p><h4 id="ä¸»é¢˜è‰²æå–"><a href="#ä¸»é¢˜è‰²æå–" class="headerlink" title="ä¸»é¢˜è‰²æå–"></a>ä¸»é¢˜è‰²æå–</h4><p>ã€€ã€€æœ‰äº†è¿™ä¹ˆä¸€æ£µå…«å‰æ ‘ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä»é‡Œé¢æå–æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿äº†ã€‚</p><p>ã€€ã€€ä¸»é¢˜è‰²æå–å®é™…ä¸Šå°±æ˜¯æŠŠå…«å‰æ ‘å½“ä¸­å‰©ä¸‹çš„å¶å­èŠ‚ç‚¹ <strong><em>RGB</em></strong> é€šé“åˆ†é‡æ±‚å¹³å‡ï¼Œæ±‚å‡ºæ¥çš„å°±æ˜¯è¿‘ä¼¼çš„ä¸»é¢˜è‰²äº†ã€‚ï¼ˆä¹Ÿè®¸æœ‰æ›´å¥½çš„ï¼Œä¸æ˜¯æ±‚å¹³å‡çš„æ–¹æ³•èƒ½è·å¾—æ›´å¥½çš„ä¸»é¢˜è‰²ç»“æœï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰æ·±å…¥å»ç ”ç©¶ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·æ¥æŒ‡æ­£ (â€â•¹â—¡â•¹)ï¼‰</p><p>ã€€ã€€äºæ˜¯æˆ‘ä»¬æ·±åº¦éå†è¿™æ£µæ ‘ï¼Œæ¯é‡åˆ°å¶å­èŠ‚ç‚¹ï¼Œå°±æ±‚å‡ºé¢œè‰²åŠ å…¥åˆ°æˆ‘ä»¬æ‰€å­˜ç»“æœçš„æ•°ç»„æˆ–è€…ä»»æ„æ•°æ®ç»“æ„å½“ä¸­äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">colorsStats</span>(<span class="params">node, object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node.isLeaf) &#123;</span><br><span class="line">        <span class="keyword">var</span> r = <span class="built_in">parseInt</span>(node.red / node.pixelCount).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">var</span> g = <span class="built_in">parseInt</span>(node.green / node.pixelCount).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">var</span> b = <span class="built_in">parseInt</span>(node.blue / node.pixelCount).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">if</span>(r.length === <span class="number">1</span>) r = <span class="string">'0'</span> + r;</span><br><span class="line">        <span class="keyword">if</span>(g.length === <span class="number">1</span>) g = <span class="string">'0'</span> + g;</span><br><span class="line">        <span class="keyword">if</span>(b.length === <span class="number">1</span>) b = <span class="string">'0'</span> + b;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> color = r + g + b;</span><br><span class="line">        <span class="keyword">if</span>(object[color]) object[color] += node.pixelCount;</span><br><span class="line">        <span class="keyword">else</span> object[color] = node.pixelCount;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> !== node.children[i]) &#123;</span><br><span class="line">            colorsStats(node.children[i], object);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç®—æ³•å°ç»“"><a href="#ç®—æ³•å°ç»“" class="headerlink" title="ç®—æ³•å°ç»“"></a>ç®—æ³•å°ç»“</h4><p>ã€€ã€€å…«å‰æ ‘ä¸»é¢˜è‰²æå–ç®—æ³•æå–å‡ºæ¥çš„ä¸»é¢˜è‰²æ˜¯ä¸€ä¸ªæ— å›ºå®šè°ƒè‰²æ¿ï¼ˆNon-paletteï¼‰çš„é¢œè‰²ç¾¤ï¼Œå®ƒæœ‰ç€å¯¹åŸå›¾çš„å°½é‡ä¿çœŸæ€§ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰å›ºå®šçš„è°ƒè‰²æ¿ï¼Œæœ‰æ—¶å€™å¯¹äºæœç´¢æˆ–è€…æŸç§éœ€è¦å›ºå®šå€¼æ¥è§£é‡Šçš„åœºæ™¯ä¸­è¿˜æ˜¯æ¬ äº†ç‚¹ç«å€™ã€‚ä½†æ˜¯æ´»çµæ´»ç°éå®ƒè«å±äº†ã€‚æ¯”å¦‚æŸç§å›¾ç‰‡æ ¼å¼é‡Œé¢é¢„å…ˆå­˜è°ƒè‰²æ¿ç„¶åå­˜å„åƒç´ çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å…«å‰æ ‘æå–å‡ºæ¥çš„é¢œè‰²ä½œä¸ºè¯¥å›¾ç‰‡è°ƒè‰²æ¿ï¼Œèƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå¯¹è¿™å¼ å›¾ç‰‡è¿›è¡Œä¿çœŸï¼Œå¹¶ä¸”å›¾ç‰‡é¢œè‰²ä¹Ÿå‡åˆ°ä¸€å®šçš„é‡ã€‚</p><p>ã€€ã€€è¯¥ç®—æ³•çš„å®Œæ•´ Demo å¤§å®¶å¯ä»¥åœ¨æˆ‘çš„ <a href="https://github.com/XadillaX/theme-color-test/blob/master/version3/octree.js" target="_blank" rel="external">Github</a> å½“ä¸­æ‰¾åˆ°ã€‚</p><h3 id="æœ€å°å·®å€¼æ³•"><a href="#æœ€å°å·®å€¼æ³•" class="headerlink" title="æœ€å°å·®å€¼æ³•"></a>æœ€å°å·®å€¼æ³•</h3><p>ã€€ã€€è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•åˆå®ç”¨çš„ç®—æ³•ã€‚</p><p>ã€€ã€€å¤§è‡´çš„æ€æƒ³å°±æ˜¯ç»™å®šä¸€ä¸ªè°ƒè‰²æ¿ï¼Œè¿‡æ¥ä¸€ä¸ªé¢œè‰²å°±è·Ÿè°ƒè‰²æ¿ä¸­çš„é¢œè‰²ä¸€ä¸€å¯¹æ¯”ï¼Œå–æœ€å°å·®å€¼çš„é‚£ä¸ªè°ƒè‰²æ¿é‡Œçš„é¢œè‰²ä½œä¸ºè¿™ä¸ªé¢œè‰²çš„ä»£è¡¨ã€‚</p><p>ã€€ã€€å¯¹æ¯”çš„è¿‡ç¨‹å°±æ˜¯åˆ†åˆ«å°† <strong>R / G / B</strong> é€šé“çš„å€¼ä¸¤ä¸¤ç›¸å‡å–ç»å¯¹å€¼ï¼Œå°†ä¸‰ä¸ªå·®ç›¸åŠ ï¼Œå¾—åˆ°çš„è¿™ä¸ªå€¼å°±æ˜¯é¢œè‰²å·®å€¼äº†ã€‚</p><p>ã€€ã€€åæ­£æœ€åå°±æ˜¯è°ƒè‰²æ¿ä¸­å“ªä¸ªé¢œè‰²è·Ÿå¯¹æ¯”çš„é¢œè‰²å·®å€¼æœ€å°ï¼Œå°±æ‹¿è¿‡æ¥å°±æ˜¯äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> best = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> bestv = pal[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">var</span> bestr = <span class="built_in">Math</span>.abs(r - bestv.r) + <span class="built_in">Math</span>.abs(g - bestv.g) + <span class="built_in">Math</span>.abs(b - bestv.b);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">1</span>; j &lt; pal.length; j++) &#123;</span><br><span class="line">    <span class="keyword">var</span> p = pal[j];</span><br><span class="line">    <span class="keyword">var</span> res = <span class="built_in">Math</span>.abs(r - p.r) + <span class="built_in">Math</span>.abs(g - p.g) + <span class="built_in">Math</span>.abs(b - p.b);</span><br><span class="line">    <span class="keyword">if</span>(res &lt; bestr) &#123;</span><br><span class="line">        best = j;</span><br><span class="line">        bestv = pal[j];</span><br><span class="line">        bestr = res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = pal[best].r.toString(<span class="number">16</span>);</span><br><span class="line">g = pal[best].g.toString(<span class="number">16</span>);</span><br><span class="line">b = pal[best].b.toString(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(r.length === <span class="number">1</span>) r = <span class="string">"0"</span> + r;</span><br><span class="line"><span class="keyword">if</span>(g.length === <span class="number">1</span>) g = <span class="string">"0"</span> + g;</span><br><span class="line"><span class="keyword">if</span>(b.length === <span class="number">1</span>) b = <span class="string">"0"</span> + b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(colors[r + g + b] === <span class="literal">undefined</span>) colors[r + g + b] = <span class="number">-1</span>;</span><br><span class="line">colors[r + g + b]++;</span><br></pre></td></tr></table></figure><h2 id="æˆ‘æ˜¯æ€ä¹ˆåšçš„"><a href="#æˆ‘æ˜¯æ€ä¹ˆåšçš„" class="headerlink" title="æˆ‘æ˜¯æ€ä¹ˆåšçš„"></a>æˆ‘æ˜¯æ€ä¹ˆåšçš„</h2><p>ã€€ã€€å…«å‰æ ‘çš„ç¼ºç‚¹æˆ‘åœ¨ä¹‹å‰çš„å…«å‰æ ‘å°ç»“ä¸­æåˆ°è¿‡äº†ï¼Œå°±æ˜¯é¢œè‰²ä¸å›ºå®šã€‚å¯¹äºéœ€è¦æœ‰ä¸€å®šå›ºå®šå€¼èŒƒå›´çš„ä¸»é¢˜è‰²æå–éœ€æ±‚æ¥è¯´ä¸æ˜¯é‚£ä¹ˆåˆäººæ„ã€‚</p><p>ã€€ã€€è€Œæœ€å°å·®å€¼æ³•çš„è¯åˆå¤ªå¤æ¿äº†ã€‚</p><p>ã€€ã€€äºæ˜¯æˆ‘çš„åšæ³•æ˜¯å°†è¿™ä¸¤ç§ç®—æ³•éƒ½è¿‡ä¸€éã€‚</p><p>ã€€ã€€æ¯”å¦‚æˆ‘è¦å°†ä¸€å¼ å›¾ç‰‡æå–å‡ºå°‘äº 256 ç§é¢œè‰²ï¼Œæˆ‘ä¼šç”¨å…«å‰æ ‘è¿‡æ»¤ä¸€éå¾—å‡ºä¿è¯çš„ä¸¤ç™¾å¤šç§é¢œè‰²ï¼Œç„¶åæ‹¿ç€è¿™æ‰¹é¢œè‰²å’Œå…¶æ•°é‡å†æ‰”åˆ°æœ€å°æ’å€¼æ³•é‡Œé¢å°†é¢œè‰²è§„èŒƒåŒ–ä¸€éï¼Œå¾—å‡ºçš„æœ€ç»ˆç»“æœå¯èƒ½å°±æ˜¯æˆ‘æƒ³è¦çš„ç»“æœäº†ã€‚</p><p>ã€€ã€€è¿™æœŸé—´ç¬¬äºŒæ­¥çš„æ•ˆç‡å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œæ¯•ç«Ÿå¦‚æœæ˜¯ä¸Šé¢çš„éœ€æ±‚çš„è¯ç¬¬ä¸€æ­¥çš„ç»“æœä¹Ÿå°±é‚£ä¹ˆä¸¤ç™¾å¤šç§é¢œè‰²ã€‚</p><p>ã€€ã€€è¿™ä¸ªæ–¹æ³•æˆ‘å·²ç»å®ç°å¹¶ä¸”ç”¨åœ¨æˆ‘è‡ªå·±çš„é¢œè‰²æå–åŒ… <strong><em><a href="https://github.com/XadillaX/thmclrx" target="_blank" rel="external">thmclrx</a></em></strong> é‡Œäº†ã€‚å¤§è‡´çš„ä»£ç å¯ä»¥çœ‹<a href="https://github.com/XadillaX/thmclrx/blob/7ab4de9fce583e88da6a41b0e256e91c45a10f67/lib/x.js#L95-L145" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p><h2 id="ä¸»é¢˜è‰²æå–-Node-js-åŒ…â€”â€”thmclrx"><a href="#ä¸»é¢˜è‰²æå–-Node-js-åŒ…â€”â€”thmclrx" class="headerlink" title="ä¸»é¢˜è‰²æå– Node.js åŒ…â€”â€”thmclrx"></a>ä¸»é¢˜è‰²æå– Node.js åŒ…â€”â€”thmclrx</h2><p>ã€€ã€€åœ¨è¿™å‡ å¤©çš„è¾›å‹¤åŠ³ä½œä¸‹ï¼Œæ€»ç®—å®Œæˆäº†æŸç§æ„ä¹‰ä¸Šæˆ‘çš„ç¬¬ä¸€ä¸ª Node.js C++ Addonã€‚</p><p>ã€€ã€€è·Ÿç®—æ³•ç›¸å…³ï¼ˆå…«å‰æ ‘ã€æœ€å°å·®å€¼ï¼‰çš„è®¡ç®—å…¨æ”¾åœ¨äº† <a href="https://github.com/XadillaX/thmclrx/tree/master/src" target="_blank" rel="external">C++ å±‚</a>è¿›è¡Œè®¡ç®—ã€‚å¤§å®¶æœ‰å…´è¶£çš„å¯ä»¥å»è¯»ä¸€ä¸‹å¹¶ä¸”å¸®å¿™æŒ‡å‡ºå„ç§å„æ ·çš„ç¼ºç‚¹ï¼Œç®—æ˜¯æŠ›ç –å¼•ç‰äº†ã€‚</p><p>ã€€ã€€è¿™ä¸ªåŒ…çš„ Repo åœ¨ Github ä¸Šé¢ï¼š</p><blockquote><p><a href="https://github.com/XadillaX/thmclrx" target="_blank" rel="external">https://github.com/XadillaX/thmclrx</a></p></blockquote><p>ã€€ã€€æ–‡æ¡£è‡ªè®¤ä¸ºè¿˜ç®—å®Œæ•´å§ã€‚å¹¶ä¸”ä¹Ÿå¯ä»¥é€šè¿‡</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm install thmclrx</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿›è¡Œå®‰è£…ã€‚</p><h2 id="æœ¬æ–‡å°ç»“"><a href="#æœ¬æ–‡å°ç»“" class="headerlink" title="æœ¬æ–‡å°ç»“"></a>æœ¬æ–‡å°ç»“</h2><p>ã€€ã€€è¿›èŠ±ç“£ä¸¤ä¸ªæœˆäº†ï¼Œè¿™ä¸€æ¬¡ç»ˆäºå¦‚æ„¿ä»¥å¿åœ°ç¢°è§¦åˆ°äº†ä¸€ç‚¹ç‚¹çš„ã€ç®—æ³•ç›¸å…³ã€çš„æ´»ã€‚ï¼ˆæˆ‘ä¸ä¼šå‘Šè¯‰ä½ è¿™ä¸æ˜¯æˆ‘çš„ä»»åŠ¡ï¼Œæ˜¯æˆ‘ä»åˆ«äººæ‰‹ä¸­æŠ¢æ¥çš„ 2333333 <em>à¬˜(à©­</em>ËŠáµ•Ë‹)à©­* à©ˆâœ©â€§â‚ŠËš</p><p>ã€€ã€€æ€»ä¹‹å‡ ç§ç®—æ³•å’Œå®ç°åœ¨ä¸Šæ–¹ä»‹ç»äº†ï¼Œå…·ä½“éœ€è¦æ€ä¹ˆç”¨è¿˜æ˜¯è¦çœ‹å¤§å®¶è‡ªå·±äº†ã€‚æˆ‘åæ­£å¤§è‡´æ‰¾åˆ°äº†æˆ‘ä½¿ç”¨çš„é€”å¾„ï¼Œé‚£ä½ ä»¬å‘¢ã€‚( Â´ï½¥ï½¥)ï¾‰(._.`)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æ‰€è°“ä¸»é¢˜è‰²æå–ï¼Œå°±æ˜¯å¯¹äºä¸€å¼ å›¾ç‰‡ï¼Œè¿‘ä¼¼åœ°æå–å‡ºä¸€ä¸ªè°ƒè‰²æ¿ï¼Œä½¿å¾—è°ƒè‰²æ¿é‡Œé¢çš„é¢œè‰²èƒ½ç»„æˆè¿™å¼ å›¾ç‰‡çš„ä¸»è‰²è°ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ã€€ã€€ä»¥ä¸Šå®šä¹‰ä¸ºæˆ‘ä¸ªäººèƒ¡è¯Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¤§å®¶ä¸è¦å¤ªæŠŠæˆ‘çš„ä¸œè¥¿å½“æˆä¸¥è°¨çš„æ–‡ç« æ¥çœ‹ï¼Œå¾ˆå¤šä¸œè¥¿ä»€ä¹ˆçš„
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://xcoder.in/tags/Algorithm/"/>
    
      <category term="Theme Color" scheme="https://xcoder.in/tags/Theme-Color/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘æ˜¯å¦‚ä½•å®ç°ç®€å•çš„éšæœºä¸­æ–‡åç”Ÿæˆå™¨çš„ï¼ˆNode ç‰ˆï¼‰</title>
    <link href="https://xcoder.in/2014/09/01/how-i-made-chinese-random-x/"/>
    <id>https://xcoder.in/2014/09/01/how-i-made-chinese-random-x/</id>
    <published>2014-09-01T12:36:33.000Z</published>
    <updated>2017-12-11T07:59:20.501Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h2><p>æœ€è¿‘é—²ç€è›‹ç–¼å®ç°äº†ä¸¤ä¸ªåº“ã€‚</p><ul><li>éšæœºç”Ÿæˆä¸­æ–‡åå­—</li><li>éšæœºç”Ÿæˆä¸­æ–‡æŠ€èƒ½å</li></ul><p>æˆ‘å½“ç„¶ä¸ä¼šè¯´å»ç”¨å„ç§äººå·¥æ™ºèƒ½å»å®ç°ä¸€ä¸ªå¼ºå¤§çš„çš„è§£æå™¨ç„¶åç”Ÿæˆï¼Œä¹Ÿä¸ä¼šè¯´ç”¨ä¸€ä¸ªéå¸¸åºå¤§å¦‚æœç‹—æ‹¼éŸ³çš„å§“ååº“æ¥éšæœºè·å–â€”â€”æˆ‘åªæ˜¯å¶ç„¶é—´çŸ¥é“è˜‘è‡è¡—å°ä¾ èŠ‚ä¸€ä¸ªæ··æˆ˜ PK çš„ Demo ç¼–å†™æ¯”èµ›ï¼Œé—²æ¥æ— èŠéšä¾¿å†™å†™ï¼Œç„¶è€Œè¿™å…¶ä¸­æˆ‘éœ€è¦éšæœºç»™ Bot èµ·åä»¥åŠæŠ€èƒ½èµ·åè€Œç”¨åˆ°çš„åº“ã€‚</p><p>ä¸éœ€è¦æœ‰å¤šå°‘æ­£ç¡®æ€§â€”â€”è¿™ä¸¤ä¸ªåº“çš„ç»“æœç»å¸¸å‡ºç°éå¸¸å¥‡è‘©çš„åå­—ï¼Œè®©äººå“­ç¬‘ä¸å¾—ï¼Œä½†æ˜¯æˆ‘è¦çš„å°±æ˜¯è¿™ç§æ•ˆæœã€‚</p><h2 id="ç»“æœç¤ºèŒƒ"><a href="#ç»“æœç¤ºèŒƒ" class="headerlink" title="ç»“æœç¤ºèŒƒ"></a>ç»“æœç¤ºèŒƒ</h2><p>å°±ä¸¤ä¸ªåº“ï¼Œæˆ‘å„ç”Ÿæˆä¸€æ‰¹åå­—ä»¥ç¤ºæ•ˆæœã€‚</p><h3 id="Chinese-Random-Name"><a href="#Chinese-Random-Name" class="headerlink" title="Chinese Random Name"></a>Chinese Random Name</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">é˜™é€ </span><br><span class="line">å¹¿é”¡ä¸€</span><br><span class="line">å¸­å¯º</span><br><span class="line">æ‰¶é©¾</span><br><span class="line">éƒ‘è±é»„</span><br><span class="line">æ—æ¨Šç‰µ</span><br><span class="line">å­Ÿç™»å…ƒ</span><br><span class="line">é±¼å½°</span><br><span class="line">çš®å¿§æš‘</span><br><span class="line">å·¦ç¨—</span><br><span class="line">å®¦é†‡</span><br><span class="line">ç³œå¼‹æ‹›</span><br><span class="line">å¸­å‡†</span><br><span class="line">æ–¹æŠ‘</span><br><span class="line">ä¹Œæ³”</span><br><span class="line">è‹—é²</span><br><span class="line">å­Ÿå€™ä¾</span><br><span class="line">é¾™ç é¥¯</span><br><span class="line">æ´ªæ‰“é¹°</span><br><span class="line">ç¼ªè´Ÿé“</span><br></pre></td></tr></table></figure><h3 id="Chinese-Random-SKill"><a href="#Chinese-Random-SKill" class="headerlink" title="Chinese Random SKill"></a>Chinese Random SKill</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ°æ°¸å¿ƒæ³•</span><br><span class="line">ç¼¨æªè¯€</span><br><span class="line">å†‰è…¿</span><br><span class="line">å°¼é€»å¿ƒæ³•</span><br><span class="line">å¥ æ‹³è°±</span><br><span class="line">æ›²æŒæ³•</span><br><span class="line">å§‹åˆº</span><br><span class="line">å¨˜æ¡¶æ’·åˆ€</span><br><span class="line">ç’‹ç‘¾å•å…»åˆ€</span><br><span class="line">éŠåˆ€</span><br><span class="line">åŠ±ä¿­é©¿åª›å¿ƒè¯€</span><br><span class="line">ç»é©°åˆ€è¯€</span><br><span class="line">æ™åéª…è…¿</span><br><span class="line">ç¤ºå«©å¸ç¾½åˆ€è¯€</span><br><span class="line">èµ›å‹˜ç¥ä½“åˆ€è¯€</span><br><span class="line">é“¸çˆ±æŒ‡</span><br><span class="line">æ–½å‡€ç®èæ£</span><br><span class="line">æ³Šä¸´æƒ‡æªè¯€</span><br><span class="line">æˆ‘é“å…­åˆ†æª</span><br><span class="line">æ®‹äº­æ±‚æ‹³è°±</span><br></pre></td></tr></table></figure><h2 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h2><p>å®é™…ä¸Šæ— è®ºæ˜¯èµ·åè¿˜æ˜¯æŠ€èƒ½åï¼Œéƒ½ç”¨äº†ä¸€ä¸ªç›¸åŒçš„èµ·åå­—åº“å’Œä¸€æ®µå·®ä¸å¤šçš„å¤ç”¨ä»£ç ï¼ˆè™½ç„¶æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„å¤ç”¨ï¼Œåªæ˜¯å¤åˆ¶ç²˜è´´è€Œå·²ï¼Œè°è®©ä»–ä»¬æ˜¯ä¸¤ä¸ªåº“å‘¢ï¼Œå·²ç»å¾ˆç®€å•äº†ï¼Œæˆ‘æ€»ä¸èƒ½å†ç»™ä»–ä»¬æä¸€ä¸ªä¾èµ–å‡ºæ¥å§ï¼Ÿï¼‰</p><h3 id="èµ·å§“"><a href="#èµ·å§“" class="headerlink" title="èµ·å§“"></a>èµ·å§“</h3><p>å…³äº <code>chinese-random-name</code> ä¸­çš„å§“æ°ï¼Œæˆ‘æ‰¾äº†ä¸€ä¸ªä¸­å›½ç™¾å®¶å§“ï¼ˆåŒ…æ‹¬å¤å§“ï¼‰æ¯”è¾ƒå…¨çš„è¯åº“ã€‚</p><blockquote><p><a href="https://github.com/XadillaX/chinese-random-name/blob/master/dict/f.dict" target="_blank" rel="external">è¯åº“é“¾æ¥</a></p></blockquote><p>æ¯”è¾ƒå¹¸è¿ï¼Œæˆ‘æ‰¾åˆ°çš„æ—¶å€™å·²ç»æ˜¯è¿™ä¹ˆåˆ†æ®µåˆ†å¥½äº†ã€‚æˆ‘ä¹Ÿæ²¡æœ‰è¯¦ç»†åšç ”ç©¶ï¼Œéšä¾¿ç»™äº†ä¸åŒçš„æ®µä¸åŒçš„æƒå€¼ï¼Œå½“ç„¶è¶Šå‰é¢çš„æ®µæƒå€¼è¶Šé«˜ï¼Œè¢«éšæœºåˆ°çš„å¯èƒ½æ€§è¶Šå¤§ã€‚</p><p>é¦–å…ˆç”¨ <code>split</code> æ¥åˆ†å‰²ä¸åŒæ®µï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">dict = dict.split(<span class="string">"\n\n"</span>);</span><br></pre></td></tr></table></figure><p>å¯¹äºæ¯ä¸€æ®µæ¥è¯´é€šè¿‡ <code>Array.reduce</code> (è¯¦è§ <a href="https://github.com/andrewplummer/Sugar/blob/master/lib/es5.js#L287" target="_blank" rel="external">SugarJs</a>) æ¥åˆ†å‰²æˆè¡Œå†æˆå­—ã€‚</p><p>çœ‹å­—å…¸ä¸€å…±æœ‰ 6 å¤§æ®µï¼Œæ¯æ®µçš„æƒå€¼åˆ†åˆ«ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> weights = [ <span class="number">100</span>, <span class="number">70</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span> ];</span><br></pre></td></tr></table></figure><p>ç„¶åæ¯ä¸ªå­—éƒ½æœ‰ä¸€ä¸ªå…¶æƒå€¼åŒºé—´ï¼Œæ˜¯ç´¯åŠ ä¸Šå»çš„ã€‚</p><p>æœ€åè·å–å§“çš„æ—¶å€™éšæœºç”Ÿæˆä¸€ä¸ªåœ¨æ€»åŒºé—´å†…çš„æ•°å­—ï¼Œç„¶åçœ‹çœ‹æ•°å­—åœ¨å“ªä¸ªå§“çš„åŒºé—´å†…ï¼Œå°±è¿”å›è¿™ä¸ªå§“ã€‚</p><h3 id="æŠ€èƒ½åç¼€"><a href="#æŠ€èƒ½åç¼€" class="headerlink" title="æŠ€èƒ½åç¼€"></a>æŠ€èƒ½åç¼€</h3><p>å…³äº <code>chinese-random-skill</code> ä¸­çš„æŠ€èƒ½åç¼€ï¼Œæˆ‘å·æ‡’äº†ã€‚å› ä¸ºé‚£ä¸ªæ—¶å€™ Demo å°±å¿« Deadline äº†ï¼Œæ‰€ä»¥éšä¾¿ç³Šå¼„äº†ä¸€ä¸‹â€”â€”ç›´æ¥æŠŠå°è±¡é‡Œé¢æ¯”è¾ƒç†Ÿçš„åç¼€å†™ä¸Šå»äº†äº‹ï¼Œä¹Ÿä¸ç»™æƒå€¼äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> suffix = [</span><br><span class="line">    <span class="string">"å‰‘"</span>, <span class="string">"å‰‘æ³•"</span>, <span class="string">"å‰‘è°±"</span>, <span class="string">"å‰‘è¯€"</span>,</span><br><span class="line">    <span class="string">"æª"</span>, <span class="string">"æªæ³•"</span>, <span class="string">"æªè¯€"</span>,</span><br><span class="line">    <span class="string">"æ‹³"</span>, <span class="string">"æ‹³æ³•"</span>, <span class="string">"æ‹³è°±"</span>,</span><br><span class="line">    <span class="string">"åˆ€"</span>, <span class="string">"åˆ€æ³•"</span>, <span class="string">"åˆ€è°±"</span>, <span class="string">"åˆ€è¯€"</span>,</span><br><span class="line">    <span class="string">"æ–©"</span>, <span class="string">"åˆº"</span>, <span class="string">"å¤§æ³•"</span>, <span class="string">"å¿ƒè¯€"</span>, <span class="string">"å¿ƒæ³•"</span>, <span class="string">"è¯€"</span>, <span class="string">"å®å…¸"</span>,</span><br><span class="line">    <span class="string">"æ£"</span>, <span class="string">"æ£æ³•"</span>, <span class="string">"æ£è°±"</span>, <span class="string">"æ£è¯€"</span>,</span><br><span class="line">    <span class="string">"æŒ‡"</span>, <span class="string">"æŒ"</span>, <span class="string">"æŒæ³•"</span>, <span class="string">"è…¿"</span>, <span class="string">"æ”»"</span>, <span class="string">"é’©"</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><h3 id="å…±ç”¨éƒ¨åˆ†"><a href="#å…±ç”¨éƒ¨åˆ†" class="headerlink" title="å…±ç”¨éƒ¨åˆ†"></a>å…±ç”¨éƒ¨åˆ†</h3><p>åå­—ä¸»ä½“ä¸ºä¸¤ä¸ªåŒ…çš„å…±ç”¨éƒ¨åˆ†ã€‚</p><p>å®é™…ä¸Šä»–ä»¬ä¾èµ–äºä¸€ä¸ªç‰¹å®šæ¬¾å¼çš„å­—åº“â€”â€”æˆ‘ä¹Ÿå°±ç½‘ä¸Šéšä¾¿é‚£ä¹ˆä¸€æœã€‚</p><blockquote><p><a href="https://github.com/XadillaX/chinese-random-name/blob/master/dict/n.dict" target="_blank" rel="external">å­—åº“é“¾æ¥</a></p></blockquote><p>å®ƒæ¯ä¸€è¡Œçš„ç»“æ„ä¸€æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Number UniChar UniCharï¼šString</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç¬¬ä¸€ä¸ªæ•°å­—æˆ‘ç›®æµ‹æ˜¯ç¹ä½“çš„ç¬”ç”»æ•°ï¼Œæ¯”å¦‚ 899 è¡Œçš„ <code>ä¹¦</code> ç¹ä½“å°±æ˜¯ <code>ä¹¦</code>ï¼Œæ•°ä¸€ä¸‹çš„ç¡®æ˜¯ 10 åˆ’ã€‚</p><p>ç¬¬äºŒä¸ªå°±æ˜¯å­—æœ¬ä½“ï¼Œç¬¬ä¸‰ä¸ªæ˜¯è¯¥å­—çš„äº”è¡Œå±æ€§ï¼Œæœ€åæ˜¯è¿™ä¸ªå­—åœ¨ä»€ä¹ˆä»€ä¹ˆå‘½æ•°ï¼ˆè¯·ä¸è¦è¿·ä¿¡ï¼‰æè¿°ã€‚</p><p>ä¸ºäº†è®©åå­—çœ‹èµ·æ¥ç¨å¾®æ­£å¸¸ç‚¹ï¼ˆåªæ˜¯ç¨å¾®è€Œå·²ï¼‰ï¼Œæˆ‘å°½å¯èƒ½è®©åŒå±æ€§çš„å­—åœ¨ä¸€å—å„¿ï¼Œäºæ˜¯æœ‰äº†ä»¥ä¸‹ç»„åˆï¼š</p><ul><li>é‡‘é‡‘</li><li>æœ¨æœ¨</li><li>æ°´æ°´</li><li>ç«ç«</li><li>åœŸåœŸ</li></ul><p><a href="https://github.com/XadillaX/chinese-random-name/blob/master/lib/name.js#L41" target="_blank" rel="external">è¿™äº›å­—</a>å‡‘åœ¨ä¸€èµ·çš„æƒå€¼ä¸º 100ã€‚</p><p>ç„¶åéš”ä¸€ä¸ªå±æ€§çš„è¯æ˜¯ç›¸å…‹çš„ï¼Œæˆ‘ä¸æ‡‚ä»€ä¹ˆèµ·åå¤§æ³•ä»€ä¹ˆçš„ï¼Œåªæ˜¯ç”¨è†ç›–æƒ³äº†ä¸‹ç›¸å…‹çš„å±æ€§ä¸å¥½èµ·åå§ï¼ˆçŒœé”™äº†ä¸è¦æ€¨æˆ‘ï¼‰ï¼Œäºæ˜¯ç»™äº† 20 çš„æƒå€¼ã€‚</p><p>è‡³äºéš”å£å±æ€§ï¼Œæ˜¯ç›¸ç”Ÿå§ï¼Ÿäºæ˜¯ç»™äº† 50 æƒå€¼ã€‚</p><p>å¯¹äºä¸‰ä¸ªå­—çš„èµ·åæ¥è¯´ï¼Œä¹Ÿæ˜¯ç”¨äº†ç±»ä¼¼çš„æ–¹æ³•ç»™æƒå€¼ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä»£ç ã€‚</p><p>æ€»ä¹‹å°±æ˜¯æ ¹æ®å…¶ä¸¤ä¸¤ä¹‹é—´çš„äº”è¡Œå…³ç³»æ¥èµ·åçš„ï¼Œå¬èµ·æ¥è¿˜æ˜¯æœ‰é‚£ä¹ˆç‚¹é“ç†çš„ã€‚</p><p>å“ˆå“ˆï¼Œæƒå½“ç©çš„ï¼Œè®¤çœŸä½ å°±è¾“äº†ã€‚</p><h3 id="ç»¼åˆè¯´æ˜"><a href="#ç»¼åˆè¯´æ˜" class="headerlink" title="ç»¼åˆè¯´æ˜"></a>ç»¼åˆè¯´æ˜</h3><p>ä¸Šé¢çš„åˆ†æ­¥åšå®Œäº†ï¼Œç„¶åçœŸÂ·ç”Ÿæˆåå­—çš„æ­¥éª¤æ˜¯ï¼š</p><p>éšæœºç”Ÿæˆä¸€ä¸ªå§“ï¼ˆæˆ–è€…æŠ€èƒ½åç¼€ï¼‰ï¼Œç„¶åæŒ‰ç…§æŸä¸ªæƒå€¼éšæœºç”Ÿæˆä¸€ä¸ªæ•°å­—ä»£è¡¨å‰©ä¸‹çš„åå­—çš„é•¿åº¦ï¼Œç„¶åéšæœºç”Ÿæˆä¸€ä¸²è¯¥é•¿åº¦çš„åå­—å³å¯ã€‚</p><p>æœ€åæ‹¼æ¥ä¸Šå»å°± OK äº†ã€‚</p><h2 id="æ— èŠ‚æ“å°å¹¿å‘Š"><a href="#æ— èŠ‚æ“å°å¹¿å‘Š" class="headerlink" title="æ— èŠ‚æ“å°å¹¿å‘Š"></a>æ— èŠ‚æ“å°å¹¿å‘Š</h2><p>æœ€åè¿˜æ˜¯è´´ä¸€ä¸‹ä¸¤ä¸ªåŒ…çš„ repo åœ°å€å§ï¼š</p><blockquote><ul><li><a href="https://github.com/XadillaX/chinese-random-name" target="_blank" rel="external">Chinese Random Name</a></li><li><a href="https://github.com/XadillaX/chinese-random-skill" target="_blank" rel="external">Chinese Random Skill</a></li></ul></blockquote><p>ä»¥åŠå®‰è£…çš„è¯ç…§ä¸‹å»å¼„å°±å¥½äº†</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm install chinese-random-name</span><br><span class="line">$ npm install chinese-random-skill</span><br></pre></td></tr></table></figure><p><code>README</code> æ–‡ä»¶ä¸¤ä¸ªåŒ…éƒ½æœ‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åº&quot;&gt;&lt;a href=&quot;#åº&quot; class=&quot;headerlink&quot; title=&quot;åº&quot;&gt;&lt;/a&gt;åº&lt;/h2&gt;&lt;p&gt;æœ€è¿‘é—²ç€è›‹ç–¼å®ç°äº†ä¸¤ä¸ªåº“ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éšæœºç”Ÿæˆä¸­æ–‡åå­—&lt;/li&gt;
&lt;li&gt;éšæœºç”Ÿæˆä¸­æ–‡æŠ€èƒ½å&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å½“ç„¶ä¸ä¼š
      
    
    </summary>
    
      <category term="NodeJS" scheme="https://xcoder.in/categories/NodeJS/"/>
    
    
      <category term="NodeJS" scheme="https://xcoder.in/tags/NodeJS/"/>
    
      <category term="ä¸­æ–‡å" scheme="https://xcoder.in/tags/%E4%B8%AD%E6%96%87%E5%90%8D/"/>
    
      <category term="ä¸­æ–‡æŠ€èƒ½" scheme="https://xcoder.in/tags/%E4%B8%AD%E6%96%87%E6%8A%80%E8%83%BD/"/>
    
  </entry>
  
  <entry>
    <title>Storm ä¸­ Clojure çš„ Prepare Bolt å®ç°</title>
    <link href="https://xcoder.in/2014/08/04/storm-clojure-prepare-bolt/"/>
    <id>https://xcoder.in/2014/08/04/storm-clojure-prepare-bolt/</id>
    <published>2014-08-04T03:50:21.000Z</published>
    <updated>2017-12-11T07:59:20.542Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>ã€€ã€€Storm ä¸­çš„ Bolt éƒ½æ˜¯é€šè¿‡ Nimbus è¿™ä¸ªæœåŠ¡å°†åºåˆ—åŒ–å¥½çš„ Bolt æ–­ç« å–ä¹‰åœ°å‘åˆ°å„ä¸ª worker ä¸­ã€‚æ‰€ä»¥ï¼Œä»»ä½•åœ¨ bolt ä¹‹å¤–ä½ è‡ªè®¤ä¸ºåŠ è½½æœŸé—´åˆå§‹åŒ–è®¡ç®—å¥½çš„ä¸Šä¸‹æ–‡ç¯å¢ƒå¹¶ä¸ä¼šè¢«æ‰“åŒ…ä¸Šå»ï¼ŒJava æˆ‘ä¸æ‡‚ä¹Ÿä¸çŸ¥é“ï¼Œä½†æ˜¯è‡³å°‘åœ¨ Clojure è¿™ä¸ªç±»çš„æ¦‚å¿µè¢«æ·¡åŒ–çš„ LIST æ–¹è¨€ä¸­ï¼Œä½ è¦åšçš„å°±æ˜¯æŠŠæ‰€æœ‰è·Ÿ bolt åˆå§‹åŒ–è®¡ç®—ç›¸å…³çš„ä»£ç æ”¾åˆ°å…¶ <code>prepare</code> çš„ä»£ç å½“ä¸­å»ã€‚</p><p>ã€€ã€€ä½ æƒ³ä¸€ä¸‹ï¼Œå½“ä½ åœ¨æ–‡ä»¶åŠ è½½çš„æ—¶å€™åˆå§‹åŒ–äº†ä¸€ä¸ª MongoDB é“¾æ¥ï¼Œè¿™ä¸ªé“¾æ¥æ€»ä¸èƒ½è¢«åºåˆ—åŒ–åˆ°è¿œç¨‹å»å§ï¼Ÿæ‰€ä»¥è¯´åŠæ³•å°±æ˜¯æŠŠ bolt æä¸Šå»ä¹‹åï¼Œbolt è‡ªåŠ¨å»åˆå§‹åŒ–ä¸€ä¸ªé“¾æ¥â€”â€”è¿™å°±æ˜¯ <code>prepare</code> çš„ä½œç”¨äº†ã€‚</p><p>ã€€ã€€è¯´ç™½äº†ï¼Œè¿™ä¸ªè¿˜æ˜¯æˆ‘ä»¬åœ¨ <strong><em>Suwako</em></strong> å½“ä¸­è¸©åˆ°çš„å‘ã€‚</p><h2 id="åšæ³•"><a href="#åšæ³•" class="headerlink" title="åšæ³•"></a>åšæ³•</h2><p>ã€€ã€€å¤§è‡´çš„éª¨æ¶å¦‚ä¸‹ï¼š</p><figure class="highlight clojure"><table><tr><td class="code"><pre><span class="line">(<span class="name">defbolt</span> bolt [...] &#123;<span class="symbol">:prepare</span> <span class="literal">true</span>&#125;</span><br><span class="line"> [...]</span><br><span class="line"> (<span class="name"><span class="builtin-name">let</span></span> [...]</span><br><span class="line">  (<span class="name">bolt</span></span><br><span class="line">   (<span class="name">prepare</span> [...]</span><br><span class="line">    (<span class="name">...</span>))</span><br><span class="line">   (<span class="name">execute</span> [tuple]</span><br><span class="line">    (<span class="name">...</span>))))</span><br></pre></td></tr></table></figure><p>ã€€ã€€é¦–å…ˆå°±æ˜¯ <code>{:prepare true}</code> ä»£è¡¨äº†å®ƒæ˜¯ä¸€ä¸ªéœ€è¦åˆå§‹åŒ–çš„ Boltã€‚</p><p>ã€€ã€€ç„¶ååœ¨ <code>(bolt)</code> çš„ä½œç”¨åŸŸä¹‹å†…æœ‰ä¸¤ä¸ª formâ€”â€”<code>prepare</code> å’Œ <code>execute</code>ã€‚</p><p>ã€€ã€€å…¶ä¸­ <code>prepare</code> å°±æ˜¯ä½ è¦åˆå§‹åŒ–çš„è¯­å¥äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è®©è¿™é‡Œé¢åˆå§‹åŒ–ä¸€ä¸ª <a href="http://clojuremongodb.info/" target="_blank" rel="external">Monger</a>ï¼Œäºæ˜¯æˆ‘ä»¬è¦åœ¨ <code>let</code> é‡Œé¢å®šä¹‰ä¸€ä¸ªç”¨äºé“¾æ¥çš„ <code>atom {}</code>ã€‚</p><figure class="highlight clojure"><table><tr><td class="code"><pre><span class="line">(<span class="name">defbolt</span> bolt [<span class="string">"..."</span>] &#123;<span class="symbol">:prepare</span> <span class="literal">true</span>&#125;</span><br><span class="line"> [conf context collector]</span><br><span class="line"> (<span class="name"><span class="builtin-name">let</span></span> [conn (<span class="name"><span class="builtin-name">atom</span></span> &#123;&#125;)</span><br><span class="line">       db (<span class="name"><span class="builtin-name">atom</span></span> &#123;&#125;)]</span><br><span class="line">   (<span class="name">bolt</span></span><br><span class="line">    (<span class="name">prepare</span> [conf context collector]</span><br><span class="line">     (<span class="name"><span class="builtin-name">reset!</span></span> conn (<span class="name">mg/connect</span> ...))</span><br><span class="line">     (<span class="name"><span class="builtin-name">reset!</span></span> db (<span class="name">mg/get-db</span> @conn ...)))</span><br><span class="line">    (<span class="name">execute</span> [tuple]</span><br><span class="line">     (<span class="name">...</span>)))))</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™æ ·ä¸€æ¥ï¼Œå½“ Bolt è¢« Nimbus æ‰“åŒ…ä¼ åˆ°å„ä¸ª worker ä¹‹åï¼ŒBolt æ‰§è¡Œèµ·æ¥çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œ <code>prepare</code> å½“ä¸­çš„ä»£ç ï¼Œå³åˆå§‹åŒ– MongoDB çš„é“¾æ¥ï¼Œå¹¶ä¸”å°†å…¶èµ‹å€¼ç»™ <code>conn</code> å’Œ <code>db</code> ä¸¤ä¸ª atomã€‚</p><p>ã€€ã€€é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±èƒ½åœ¨æœ¬ä½“ <code>execute</code> å½“ä¸­ä½¿ç”¨ <code>@conn</code> å’Œ <code>@db</code> æ¥ä½¿å”¤ MongoDB äº†ã€‚</p><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>ã€€ã€€å¯èƒ½å¾ˆå¤šäººä¸è§£ï¼Œä¸æ˜¯è¯´å°½é‡ä¿æŒ LISP è¯­ç³»å½“ä¸­å€¼çš„ä¸å˜æ€§çš„ä¹ˆï¼Ÿ</p><p>ã€€ã€€å…¶å®ä¸å˜æ€§åªæ˜¯ä¸ºäº†æé«˜ç¨‹åºåœ¨è¿è¡Œæ—¶çš„æ•ˆç‡â€”â€”è€Œäº‹å®ä¸Šæ˜¯ï¼Œä¸Šé¢é‚£æ®µä»£ç å¹¶æ²¡æœ‰åœ¨è¿è¡Œæ—¶å»åšå˜é‡ã€‚</p><p>ã€€ã€€è™½ç„¶è¯´è¿™ä¹ˆè¯´æœ‰ç‚¹ç‰µå¼ºï¼Œä½†æ˜¯çš„ç¡®å°±æ˜¯è¿™ä¸ªæ„æ€â€”â€”å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨ç¨‹åºæ‰§è¡ŒçœŸæ­£æœ‰ç”¨çš„å¥½é€»è¾‘çš„æ—¶å€™æ²¡æœ‰å»æ”¹å˜ä¸€äº›å€¼ï¼Œç›¸ååªæ˜¯åœ¨ Bolt å¯åŠ¨çš„æ—¶å€™åšä¸€äº›å˜é‡çš„æ“ä½œã€‚</p><p>ã€€ã€€æ¢å¥è¯è¯´ï¼Œè™½ç„¶ä¸¥è°¨çš„è®²é‚£ä¸ªæ—¶å€™æ˜¯ç®—è¿è¡Œæ—¶ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶é‡Œé¢æˆ‘ä»¬å´å¯ä»¥æŠŠå®ƒå½’ç±»ä¸ºé¢„å¤„ç†â€”â€”è¿™ä¸€ç±»ä¸œè¥¿åæ­£ç¨‹åºè¿˜æ²¡çœŸæ­£å¼€å§‹è·‘æœ‰ç”¨çš„ä¸œè¥¿ï¼Œæ•ˆç‡æ…¢ä¸€ç‚¹æ— æ‰€è°“ï¼Œè€Œä¸”å°±åˆå§‹åŒ–è¿™ä¹ˆå±å¤§ç‚¹äº‹å„¿èƒ½æœ‰å¤šå°‘å½±å“ï¼Ÿ</p><p>ã€€ã€€æ•ˆç‡å’Œæ•ˆæœä¹‹é—´æƒè¡¡ä¸Šé¢çš„è¿˜æ˜¯è¦ä»è€…è§ä»æ™ºè€…è§æ™ºäº†ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ã€€ã€€æœ¬ä»¥ä¸º <code>Suwako</code> ç»ˆäºå¯ä»¥æš‚æ—¶å‘Šä¸€æ®µè½äº†ï¼Œç´§è¦å…³å¤´å±…ç„¶è¿˜æ˜¯é˜»å¡äº†ã€‚</p><p>ã€€ã€€è¯´å¤šéƒ½æ˜¯æ³ªï¼Œä¸è¯´äº†ï¼Œæ‰¾ Bug å»äº†ã€‚</p><p><img src="suwako.jpg" alt="æ³„çŸ¢è¯¹è®¿å­"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h2&gt;&lt;p&gt;ã€€ã€€Storm ä¸­çš„ Bolt éƒ½æ˜¯é€šè¿‡ Nimbus è¿™ä¸ªæœåŠ¡å°†åºåˆ—åŒ–å¥½çš„ Bolt æ–­ç« å–ä¹‰åœ°å‘åˆ°å„ä¸ª worker ä¸­ã€‚æ‰€ä»¥ï¼Œä»»ä½•åœ¨ 
      
    
    </summary>
    
      <category term="Programming" scheme="https://xcoder.in/categories/Programming/"/>
    
    
      <category term="Storm" scheme="https://xcoder.in/tags/Storm/"/>
    
      <category term="Clojure" scheme="https://xcoder.in/tags/Clojure/"/>
    
      <category term="Huaban" scheme="https://xcoder.in/tags/Huaban/"/>
    
  </entry>
  
  <entry>
    <title>å¼€å‘æµ‹è¯•æ—¶ç»™ Kafka å‘æ¶ˆæ¯çš„ UI å‘é€å™¨â€”â€”Mikasa</title>
    <link href="https://xcoder.in/2014/07/30/kafka-ui-sender-mikasa/"/>
    <id>https://xcoder.in/2014/07/30/kafka-ui-sender-mikasa/</id>
    <published>2014-07-30T02:14:29.000Z</published>
    <updated>2017-12-11T07:59:20.508Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·-ç¬ÂºÏ‰Âºç¬"><a href="#èµ·-ç¬ÂºÏ‰Âºç¬" class="headerlink" title="èµ· (ç¬ÂºÏ‰Âºç¬)"></a>èµ· (ç¬ÂºÏ‰Âºç¬)</h2><p>ã€€ã€€è¯´æ¥è¯é•¿ï¼Œè‡ªä»å…¥äº†èŠ±ç“£ï¼Œæ•´ä¸ªäººå°±æ‰è¿›è¿ç¯å‘äº†ã€‚</p><p>ã€€ã€€åç«¯å…ƒæ•°æ®é‡‡é›†æ˜¯ç”¨ Storm æ¥èµ°æ‹“æ‰‘æµç¨‹çš„ï¼Œåˆå› ä¸º @<a href="http://weibo.com/zolazhou" target="_blank" rel="external">Zola</a> ä¸æ˜¯å¾ˆå–œæ¬¢ Javaï¼Œæ‰€ä»¥é€€è€Œæ±‚å…¶æ¬¡é€‰æ‹©äº† Clojureï¼Œæ‰€ä»¥æ­£åœ¨è‹¦é€¼åœ°å­¦ä¹  Clojure å’Œ Storm ä¸­ã€‚</p><p>ã€€ã€€ç›®å‰æ¥è¯´å¤–é¢çš„ Storm æ‹“æ‰‘çš„ Spout æ˜¯ä» Kafka ä¸­æµå…¥æ•°æ®çš„ã€‚ä½†æ˜¯æˆ‘ä»¬è¦ç»™ Kafka å‘é€æµ‹è¯•æ•°æ®çš„æ—¶å€™ï¼Œå°±éœ€è¦è·‘åˆ° Kafka çš„æµ‹è¯•æœåŠ¡å™¨æ‰“å¼€å®ƒçš„ä¸€ä¸ªå‘é€è„šæœ¬è¿›å»å‘é€ï¼Œéå¸¸è›‹ç–¼ï¼›è¦ä¹ˆå°±æ˜¯ç›´æ¥é€šè¿‡ç‰¹å®šçš„å‘é€ä¸šåŠ¡é€»è¾‘ä»£ç æµ‹è¯•ï¼Œæ²¡æœ‰ä¸€ä¸ªç¨å¾®æ³›ä¸€ç‚¹çš„æµ‹è¯•ç”¨å‘æ•°æ®å·¥å…·ï¼Œäºæ˜¯ Mikasa è¯ç”Ÿäº†ã€‚</p><h2 id="æ‰¿-ï¾Ÿ3ï¾Ÿ-ï½â™ª"><a href="#æ‰¿-ï¾Ÿ3ï¾Ÿ-ï½â™ª" class="headerlink" title="æ‰¿ (ï¾Ÿ3ï¾Ÿ)ï½â™ª"></a>æ‰¿ (ï¾Ÿ3ï¾Ÿ)ï½â™ª</h2><p>ã€€ã€€è®²åˆ° Mikasa åå­—çš„æ¥æºï¼Œå®é™…ä¸Šçœ‹è¿‡ã€å·¨äººã€éƒ½çŸ¥é“ï¼Œå…«å—è…¹è‚Œçš„ä¸‰çˆ·ã€‚</p><p>ã€€ã€€è¿™é‡Œå°çˆ†æ–™ä¸€ä¸‹ï¼Œåˆæ‹äº‘å’ŒèŠ±ç“£ï¼ˆéƒ½æ˜¯åŒå®—ï¼‰çš„é¡¹ç›®åå¾ˆå¤§éƒ¨åˆ†éƒ½æ˜¯ä»¥æµ·è´¼ç‹çš„è§’è‰²å‘½åçš„â€”â€”å°¤å…¶æ˜¯åˆæ‹äº‘æ›´æ˜¯ä¸§å¿ƒç—…ç‹‚ã€‚ä¸è¿‡è¿™è®©æˆ‘è¿™ä¸ªä¼ªÂ·äºŒæ¬¡å…ƒçš„å°ä¼™ä¼´å¼‚å¸¸æ¬£å–œï¼Œå› ä¸ºæˆ‘ä¹Ÿèƒ½ç”¨å„ç§å•ªå•ªå•ªæ¥å‘½åæˆ‘çš„è§’è‰²äº†ã€‚æ¯”å¦‚æˆ‘çš„ç¬¬ä¸€ä¸ª Storm ç›¸å…³çš„é¡¹ç›®å°±å« Suwakoï¼Œå³è¯¹è®¿å­å¤§äººï¼Œå› ä¸ºè„‘å­éœ€è¦å„ç§è·³ï¼Œäºæ˜¯å°±å¯¹è¯¹è®¿å­å¤§äººè¿™ä½é’è›™ä¹‹ç¥å„ç§è†œæ‹œã€‚</p><p>ã€€ã€€è‡³äºè¿™ä¸ªå‘å°„å™¨ä¸ºä»€ä¹ˆè¦ç”¨ä¸‰çˆ·å‘¢ï¼Ÿå› ä¸ºä¸‰çˆ·ç›¸å½“äºå…ˆé”‹å†›å“‡ï¼</p><p><img src="mikasa.jpeg" alt="Mikasa"></p><p>ã€€ã€€è¿™é‡Œçš„ Kafka ä¾èµ–ç”¨äº†æœç‹å°ä¼™ä¼´ @<a href="http://weibo.com/crzidea" target="_blank" rel="external">Crzidea</a> ä»–ä»¬å›¢é˜Ÿå†™çš„æ¨¡å—ã€‚</p><h2 id="è½¬-ã„ï¿£â–½ï¿£-ã„-ã„Ÿ-ï¿£â–½ï¿£ã„Ÿ"><a href="#è½¬-ã„ï¿£â–½ï¿£-ã„-ã„Ÿ-ï¿£â–½ï¿£ã„Ÿ" class="headerlink" title="è½¬ (ã„ï¿£â–½ï¿£)ã„   ã„Ÿ(ï¿£â–½ï¿£ã„Ÿ)"></a>è½¬ (ã„ï¿£â–½ï¿£)ã„   ã„Ÿ(ï¿£â–½ï¿£ã„Ÿ)</h2><p>ã€€ã€€äºæ˜¯ï¼Œè¯ä¹Ÿä¸å¤šè¯´ï¼Œç›´æ¥ä¸Š repo å§ã€‚åœ¨å…¬å¸å†…ç½‘çš„ gitlab é‡Œé¢æœ‰ä¸€ä»½ï¼Œè¿˜æœ‰ä¸€ä¸ª repo åœ¨ <a href="https://github.com/" target="_blank" rel="external">GitHub</a> ä¸Šã€‚</p><blockquote><p><a href="https://github.com/XadillaX/mikasa" target="_blank" rel="external">ç‚¹æˆ‘</a></p></blockquote><h3 id="Download-Clone"><a href="#Download-Clone" class="headerlink" title="Download || Clone"></a>Download || Clone</h3><p>ã€€ã€€å¦‚æœè¦ç›´æ¥ä¸‹è½½çš„è¯å°±ç”¨è¿™ä¸ªé“¾æ¥ï¼š</p><blockquote><p><a href="https://github.com/XadillaX/mikasa/archive/master.zip" target="_blank" rel="external">https://github.com/XadillaX/mikasa/archive/master.zip</a></p></blockquote><p>ã€€ã€€å¦‚æœè¦å…‹éš†çš„è¯å°±ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/XadillaX/mikasa.git</span></span><br></pre></td></tr></table></figure><h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>ã€€ã€€ç›´æ¥å®‰è£…ä¸€ä¸‹ä¾èµ–ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install</span></span><br></pre></td></tr></table></figure><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>ã€€ã€€æ¥ä¸‹å»å°±æ˜¯ç®€å•çš„é…ç½®ä¸€ä¸‹äº†ï¼Œå…¶å®å°±æ˜¯é…ç½®ä¸‹é…ç½®æ–‡ä»¶ã€‚ç”±äºæ˜¯å¿«é€Ÿå¼€å‘ï¼Œç›´æ¥ç”¨äº†è‡ªå·±ä¹‹å‰çš„ <a href="https://github.com/XadillaX/exframess" target="_blank" rel="external">Exframess</a> æ¡†æ¶ï¼Œæ‰€ä»¥å¾ˆå¤šæ— ç”¨ä»£ç ä¹Ÿæ‡’å¾—åˆ äº†ã€‚</p><h4 id="config-server-js"><a href="#config-server-js" class="headerlink" title="config/server.js"></a>config/server.js</h4><p>ã€€ã€€è¿™é‡Œå…¶å®åˆ«çš„ä¹Ÿä¸ç”¨åŠ¨ï¼Œä¸»è¦æ˜¯ä¿®æ”¹ä¸‹ç«¯å£å³å¯ã€‚</p><h4 id="config-kafka-js"><a href="#config-kafka-js" class="headerlink" title="config/kafka.js"></a>config/kafka.js</h4><p>ã€€ã€€è¿™é‡Œä¿®æ”¹ä¸€ä¸‹ Kafka çš„ <code>Connection String</code> å°±å¥½äº†ã€‚</p><h3 id="Start-up"><a href="#Start-up" class="headerlink" title="Start up"></a>Start up</h3><p>ã€€ã€€æœ€åå¯åŠ¨æœåŠ¡å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node app.js</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pm2 app.js</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or some other<span class="string">'s</span></span></span><br></pre></td></tr></table></figure><h2 id="åˆ-ï¾‰â—•ãƒ®â—•-ï¾‰-ï½¥ï¾Ÿâœ§"><a href="#åˆ-ï¾‰â—•ãƒ®â—•-ï¾‰-ï½¥ï¾Ÿâœ§" class="headerlink" title="åˆ (ï¾‰â—•ãƒ®â—•)ï¾‰*:ï½¥ï¾Ÿâœ§"></a>åˆ (ï¾‰â—•ãƒ®â—•)ï¾‰*:ï½¥ï¾Ÿâœ§</h2><p>ã€€ã€€æœ€åçš„æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="mikasa-preview.png" alt="Preview"></p><p>ã€€ã€€åªè¦åœ¨ Topics æ é‡Œé¢è¾“å…¥ä½ è¦å‘é€çš„ Topicï¼Œç„¶åå†ä¸‹é¢çš„æ¶ˆæ¯æ é‡Œé¢è¾“å…¥ä½ è¦ä¼ çš„æ¶ˆæ¯ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œæœ€åç‚¹å‡» <code>Send</code> å³å¯å°†ä½ çš„æµ‹è¯•æ¶ˆæ¯å‘è¿› Kafka ä¸­å»äº†ã€‚</p><blockquote><p>æ‰˜å¤§å®¶çš„ç¦ï¼Œä»Šå¤©æˆ‘çš„ Suwako æ•´ä¸ªé€»è¾‘ç»ˆäºè·‘é€šäº†ï¼Œæ’’èŠ±ï¼ÎµÙ©(à¹‘&gt; â‚ƒ &lt;)Û¶Ğ·</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èµ·-ç¬ÂºÏ‰Âºç¬&quot;&gt;&lt;a href=&quot;#èµ·-ç¬ÂºÏ‰Âºç¬&quot; class=&quot;headerlink&quot; title=&quot;èµ· (ç¬ÂºÏ‰Âºç¬)&quot;&gt;&lt;/a&gt;èµ· (ç¬ÂºÏ‰Âºç¬)&lt;/h2&gt;&lt;p&gt;ã€€ã€€è¯´æ¥è¯é•¿ï¼Œè‡ªä»å…¥äº†èŠ±ç“£ï¼Œæ•´ä¸ªäººå°±æ‰è¿›è¿ç¯å‘äº†ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€åç«¯å…ƒæ•°æ®é‡‡é›†æ˜¯ç”¨ S
      
    
    </summary>
    
      <category term="Programming" scheme="https://xcoder.in/categories/Programming/"/>
    
    
      <category term="Kafka" scheme="https://xcoder.in/tags/Kafka/"/>
    
      <category term="Mikasa" scheme="https://xcoder.in/tags/Mikasa/"/>
    
      <category term="èŠ±ç“£" scheme="https://xcoder.in/tags/%E8%8A%B1%E7%93%A3/"/>
    
  </entry>
  
  <entry>
    <title>Untrusted - æ¸¸æˆé¢˜è§£</title>
    <link href="https://xcoder.in/2014/06/12/untrusted-solution/"/>
    <id>https://xcoder.in/2014/06/12/untrusted-solution/</id>
    <published>2014-06-12T03:08:34.000Z</published>
    <updated>2017-12-11T07:59:20.548Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€<a href="http://alexnisnevich.github.io/untrusted/" target="_blank" rel="external">Trusted</a> æ˜¯ä¸€ä¸ªä»£ç è§£è°œæ¸¸æˆï¼Œç”¨ Javascript æ¥è¿‡å…³çš„ã€‚</p><p>ã€€ã€€æ˜¨å¤©å‡Œæ™¨èŠ±äº†ä»¨å°æ—¶é€šå…³äº†è¿™ä¸ªæ¸¸æˆï¼Œåœ¨è¿™é‡Œå°±ç²—ç²—åšä¸€ä¸‹é¢˜è§£å§ï¼Œå¥½å‡ é¢˜éƒ½æ˜¯ Hack è¿‡å»çš„ã€‚ï¼ˆä¸è¦è„¸ï¼Œ( ï¾ŸĞ”ï¾Ÿ)Ïƒ</p><h2 id="Ceil-Block-A"><a href="#Ceil-Block-A" class="headerlink" title="Ceil Block A"></a>Ceil Block A</h2><p>ã€€ã€€è¿™æœ‰ç‚¹åƒæ•™å­¦å…³å§ï¼Œæ€»ä¹‹å…ˆæ‹¿åˆ°é‚£å°ç”µè„‘ä½ å°±èƒ½æ“ä½œäº†ã€‚æ‹¿åˆ°ç”µè„‘åä½ å°±èƒ½ä¿®æ”¹åœ°å›¾å†…éƒ¨é»‘è‰²åº•è‰²çš„ä»£ç äº†ã€‚</p><p>ã€€ã€€è¿™ä¸ªæ—¶å€™ä½ åªéœ€è¦æŠŠä¸­é—´è®¾ç½®å¢™çš„ä»£ç å»æ‰å°±å¯ä»¥äº†ï¼Œæˆ–è€…æ³¨é‡Šæ‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//for(y = 3; y &lt;= map.getHeight() - 10; y++) &#123;</span></span><br><span class="line"><span class="comment">//    map.placeObject(5, y, 'block');</span></span><br><span class="line"><span class="comment">//    map.placeObject(map.getWidth() - 5, y, 'block');</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//for(x = 5; x &lt;= map.getWidth() - 5; x++) &#123;</span></span><br><span class="line"><span class="comment">//    map.placeObject(x, 3, 'block');</span></span><br><span class="line"><span class="comment">//    map.placeObject(x, map.getHeight() - 10, 'block');</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶å <code>&lt;ctrl-5&gt;</code> é‡æ–°æ‰§è¡Œâ€”â€”å“’å“’ï½å¢™å°±æ¶ˆå¤±äº†ï¼Œèµ¶ç´§åˆ°è“è‰²çš„å‡ºå£å¤„å§ã€‚</p><h2 id="The-Long-Way-Out"><a href="#The-Long-Way-Out" class="headerlink" title="The Long Way Out"></a>The Long Way Out</h2><p>ã€€ã€€ä»£ç å¤§è‡´æ˜¯ç»™ä½ åˆ›å»ºäº†ä¸€ä¸ªè¿·å®«ï¼Œå¹¶ä¸”å‡ºå£å¤„å››é¢ç”¨å›´å¢™å›´èµ·æ¥ã€‚</p><p>ã€€ã€€æˆ‘ç”¨äº†ä¸€ä¸ªæ¯”è¾ƒ Hack çš„æ–¹æ³•ï¼Œåœ¨ç¬¬ä¸€ä¸ªé»‘è‰²åŒºåŸŸçš„æœ€ä¸Šæ–¹æŠŠ <code>maze.create</code> é‡å®šå‘åˆ°è‡ªå·±çš„ä¸€ä¸ªç©ºå‡½æ•°ï¼Œè¿™æ ·ä¸‹é¢è°ƒç”¨åˆ›å»ºè¿·å®«çš„å‡½æ•°å°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™å†æ‰§è¡Œçš„è¯è¿·å®«å°±ä¸è§äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">maze.create = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿·å®«ä¸è§äº†è¿˜ä¸é è°±ï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ªå‡ºå£å››å‘¨æœ‰å¢™â€”â€”é‚£å°±è‡ªå·±å†å»ºä¸€ä¸ªå‡ºå£å‘—ï¼Œåœ¨ç¬¬äºŒä¸ªé»‘è‰²åŒºåŸŸå†™ä¸Šå»ºç«‹ä¸€ä¸ªæ–°å‡ºå£çš„ä»£ç å³å¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">map.placeObject(<span class="number">0</span>, <span class="number">0</span>, <span class="string">"exit"</span>);</span><br></pre></td></tr></table></figure><blockquote><p>å‹‡æ•¢çš„å°‘å¹´å•Šï¼Œå¿«å»åˆ›é€ å¥‡è¿¹ï¼</p></blockquote><h2 id="Validation-Engaged"><a href="#Validation-Engaged" class="headerlink" title="Validation Engaged"></a>Validation Engaged</h2><p>ã€€ã€€è¿™é¢˜çš„è¦æ±‚æ˜¯åœ¨è¿˜å­˜åœ¨ç€ä¸€å®šé‡ã€å£ã€çš„æƒ…å†µä¸‹ä½ èƒ½åˆ°è¾¾å‡ºå£ï¼Œä¹Ÿå°±æ˜¯è¯´çº¯ç²¹åœ°åˆ é™¤å®ƒåŠ ã€å£ã€çš„ä»£ç æ˜¯ä¸è¡Œçš„ï¼Œé‚£æˆ‘ä»¬åšç‚¹æ”¹åŠ¨å°± OK äº†ã€‚æŠŠã€å£ã€å¾€å¤–ç§»åŠ¨ï¼Œç›´åˆ°æŠŠäººå’Œå‡ºå£éƒ½æ˜¯åœ¨ã€å£ã€å†…ã€‚</p><blockquote><p>é‚£ä¸€å¤©ï¼Œäººç±»ç»ˆäºå›æƒ³èµ·æ›¾ç»ä¸€åº¦è¢«ä»–ä»¬æ‰€æ”¯é…çš„ææ€–ï¼Œè¿˜æœ‰å›šç¦äºé¸Ÿç¬¼ä¸­çš„é‚£ä»½å±ˆè¾±ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(y = <span class="number">0</span>; y &lt;= map.getHeight() - <span class="number">3</span>; y++) &#123;</span><br><span class="line">    map.placeObject(<span class="number">5</span>, y, <span class="string">'block'</span>);</span><br><span class="line">    map.placeObject(map.getWidth() - <span class="number">5</span>, y, <span class="string">'block'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(x = <span class="number">0</span>; x &lt;= map.getWidth() - <span class="number">5</span>; x++) &#123;</span><br><span class="line">    map.placeObject(x, <span class="number">3</span>, <span class="string">'block'</span>);</span><br><span class="line">    map.placeObject(x, map.getHeight() - <span class="number">3</span>, <span class="string">'block'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Multiplicity"><a href="#Multiplicity" class="headerlink" title="Multiplicity"></a>Multiplicity</h2><p>ã€€ã€€å˜›å˜›ï¼Œè¿™æ˜¯ç¬¬äºŒå…³çš„ç®€åŒ–ç‰ˆâ€”â€”ç›´æ¥å†æä¸€ä¸ªå‡ºå£å°± OK äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">map.placeObject(<span class="number">20</span>, <span class="number">10</span>, <span class="string">'exit'</span>);</span><br></pre></td></tr></table></figure><h2 id="Minesweeper"><a href="#Minesweeper" class="headerlink" title="Minesweeper"></a>Minesweeper</h2><p>ã€€ã€€è¿™æ˜¯ä¸€ä¸ªé›·åŒºï¼Œä½ ä¸ç¢°é›·å°±å¥½ã€‚ä»ä»£ç é‡Œé¢çœ‹å‡ºæ¥æœ‰ä¸ª <code>map.setSquareColor</code> å‡½æ•°å¯ä»¥è®¾ç½®æŸä¸ªæ ¼å­çš„é¢œè‰²ã€‚é‚£å¥½åŠï¼Œæˆ‘ä»¬åœ¨è®¾ç½®ä¸€ä¸ªåœ°é›·åæŠŠå®ƒç”¨åˆ«çš„é¢œè‰²æ ‡è®°å‡ºæ¥å°±å¥½äº†ï¼Œç„¶åé‡æ–°æ‰§è¡Œåªè¦ä½ ä¸æ˜¯è‰²ç›²éƒ½èƒ½å®‰å…¨é€šè¿‡ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">map.setSquareColor(x, y, <span class="string">"#ff7800"</span>);</span><br></pre></td></tr></table></figure><h2 id="Drones-101"><a href="#Drones-101" class="headerlink" title="Drones 101"></a>Drones 101</h2><p>ã€€ã€€è¿™é¢˜å¤§æ¦‚å°±æ˜¯è¯´æœ‰ä¸ªç—´æ±‰ä¼šè·Ÿä½ é è¿‘ï¼Œç„¶åæŠŠä½ å…ˆå¥¸åæ€ã€‚</p><p>ã€€ã€€ä½†æ˜¯ç—´æ±‰å¾ˆç¬¨ï¼Œåœ¨ä»–çš„å¿…ç»ä¹‹è·¯ç”¨å¢™å µä½ä»–å°±ä¸ä¼šç»§ç»­åŠ¨äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">map.placeObject(<span class="number">30</span>, <span class="number">12</span>, <span class="string">'block'</span>);</span><br><span class="line">map.placeObject(<span class="number">31</span>, <span class="number">11</span>, <span class="string">'block'</span>);</span><br></pre></td></tr></table></figure><h2 id="Colors"><a href="#Colors" class="headerlink" title="Colors"></a>Colors</h2><p>ã€€ã€€è¿™ä¸ªæ˜¯é‚£ä¸ªå–ç›¸ä¸é”™çš„ç”µè¯æœºçš„æ•™å­¦å…³å¡ã€‚æ‰€ä»¥å¤§è‡´çš„æ„æ€æ˜¯è®¾ç½®äº†æ‰“ç”µè¯çš„å›è°ƒå‡½æ•°å³å¯ã€‚ÎµÙ©(à¹‘&gt; â‚ƒ &lt;)Û¶Ğ·</p><p>ã€€ã€€åˆ†æä»£ç å¯çŸ¥ï¼Œè¦é€šè¿‡é‚£å‡ ä¸ªé•¿å¾—è·ŸèŠèŠ±ä¸€æ ·çš„å¸¦è‰²å„¿çš„å¢™ä½ å°±è¦è·Ÿé‚£ä¸ªèŠèŠ±é¢œè‰²ä¸€æ ·ã€‚æ‰€ä»¥ç”µè¯æœºçš„å›è°ƒå‡½æ•°å¤§è‡´æ˜¯è®©ä½ è‡ªå·±å˜è‰²å°±å¥½äº†ã€‚</p><p>ã€€ã€€æŒ‰ç…§é¡ºåºæ‰€è§ï¼Œå¦‚æœäººæ˜¯ç»¿è‰²çš„é€šè¿‡ä¹‹åè¦å˜æˆçº¢è‰²ï¼Œç„¶åå†å˜æˆé»„è‰²å†ç»¿è‰²ã€‚äºæ˜¯å†™ä»¥ä¸‹çš„å˜è‰²è¿‡ç¨‹å°±å¯ä»¥äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> player = map.getPlayer();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = player.getColor();</span><br><span class="line"><span class="keyword">switch</span>(color) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"#0f0"</span>:</span><br><span class="line">        player.setColor(<span class="string">"#f00"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"#f00"</span>:</span><br><span class="line">        player.setColor(<span class="string">"#ff0"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"#ff0"</span>:</span><br><span class="line">        player.setColor(<span class="string">"#0f0"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€é‡æ–°æ‰§è¡Œæ¡èµ·ç”µè¯æœºï¼Œç„¶åé€šè¿‡ç»¿èŠèŠ±ä¹‹åæŒ‰ <code>Q</code> ä½¿ç”¨ç”µè¯æœºè®©è‡ªå·±å˜è‰²å„¿å°±å¥½äº†ã€‚</p><blockquote><p>â€œå“å‘€ï¼Œå¤©ï¼ä»–æ˜¯æƒ¦è®°å¼Ÿå¼Ÿäº†ã€‚â€¦â€¦å¯æˆ‘è¿˜ä¸çŸ¥é“å‘¢ï¼é‚£ä¹ˆè¿™æ˜¯ä»–è€äººå®¶çš„ç‹—ï¼Ÿå¾ˆé«˜å…´ã€‚â€¦â€¦ä½ æŠŠå®ƒå¸¦å»å§ã€‚â€¦â€¦è¿™æ¡å°ç‹—æ€ªä¸é”™çš„ã€‚â€¦â€¦æŒºä¼¶ä¿ã€‚â€¦â€¦ä¸€å£å°±æŠŠè¿™å®¶ä¼™çš„æ‰‹æŒ‡å’¬ç ´äº†ï¼å“ˆå“ˆå“ˆå“ˆï¼â€¦â€¦å’¦ï¼Œä½ å¹²å—å‘æŠ–ï¼Ÿå‘œå‘œï¼Œâ€¦â€¦å‘œå‘œã€‚â€¦â€¦å®ƒç”Ÿæ°”äº†ï¼Œå°åè›‹ï¼Œâ€¦â€¦å¥½ä¸€æ¡å°ç‹—â€¦â€¦â€</p></blockquote><h2 id="Into-the-Woods"><a href="#Into-the-Woods" class="headerlink" title="Into the Woods"></a>Into the Woods</h2><p>ã€€ã€€æ£®æ—é‡Œé¢æœ‰æ ‘å’Œå¢™ï¼Œæˆ‘ä¹Ÿæ‡’å¾—æƒ³æˆ–è€…å†™ä»£ç äº†ã€‚ï¼ˆæ˜æ˜æ˜¯è‡ªå·±æƒ³ä¸å‡ºæ¥#ï¾ŸÃ…ï¾Ÿï¼‰âŠ‚å½¡â˜†))ï¾ŸĞ”ï¾Ÿ)ï½¥âˆµ</p><p>ã€€ã€€æ€»ä¹‹æˆ‘æ˜¯å°½å¯èƒ½å‘å‡ºå£é è¿‘ï¼Œç„¶ååˆ°æ­»è·¯äº†èµ¶ç´§æ‰“ç”µè¯è®©æ£®æ—é‡æ–°ç”Ÿæˆä¸€éï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ç›´åˆ°å‡ºå£ã€‚</p><h2 id="Fording-the-River"><a href="#Fording-the-River" class="headerlink" title="Fording the River"></a>Fording the River</h2><p>ã€€ã€€23333333333333ï¼åšè¿™é¢˜çš„æ—¶å€™å·®ç‚¹æ²¡æŠŠè‡ªå·±æµè§ˆå™¨å¡æ­»ã€‚</p><p>ã€€ã€€å¤§è‡´çš„æ„æ€æ˜¯æ²³çš„ä¸Šé¢æœ‰ä¸€æ¡èˆ¹ï¼Œä½ ç›´æ¥é‡æ°´ä¼šæ­»ï¼Œè¦ä¸Šèˆ¹ã€‚ä½†æ˜¯èˆ¹è²Œä¼¼ä¸è·Ÿä½ èµ°å•Š QAQã€‚</p><p>ã€€ã€€è€Œä¸”è®¾å®šå†™ç€åªèƒ½æœ‰ä¸€æ¡ <code>raft</code>ã€‚</p><p>ã€€ã€€å’±å°±æ¥ä¸ªå·å¤©æ¢æ—¥ï¼Œè‡ªå·±é€ è¯ºäºšæ–¹èˆŸé“ºæ»¡æ•´æ¡æ²³ï¼ˆå› ä¸ºæ‡’å¾—è®¡ç®—ï¼‰ã€‚</p><p>ã€€ã€€é¦–å…ˆå®šä¹‰è¯ºäºšæ–¹èˆŸçš„ç±»å‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">map.defineObject(<span class="string">"noah"</span>, &#123;</span><br><span class="line">    <span class="string">'type'</span>: <span class="string">'dynamic'</span>,</span><br><span class="line">    <span class="string">'symbol'</span>: <span class="string">'a'</span>,</span><br><span class="line">    <span class="string">'color'</span>: <span class="string">'#420'</span>,</span><br><span class="line">    <span class="string">'transport'</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">'behavior'</span>: <span class="function"><span class="keyword">function</span>(<span class="params">me</span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åå‘¢æŠŠå®ƒé“ºæ»¡æ•´æ¡å¤§æ²³å§ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> x = <span class="number">0</span>; x &lt; map.getWidth(); x++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> y = <span class="number">5</span>; y &lt; <span class="number">15</span>; y++) &#123;</span><br><span class="line">        map.placeObject(x, y, <span class="string">'noah'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€æ¡å¤§æ²³ï¼Œä¸¤å²¸å®½ï¼Œé£å¹ç¨»èŠ±é¦™ä¸¤å²¸ã€‚ï¼ˆå–‚å–‚å–‚ï¼Œå°å¿ƒå¡æ­»<em>(â”ã€ŒÎµ:)</em></p></blockquote><h2 id="Ambush"><a href="#Ambush" class="headerlink" title="Ambush"></a>Ambush</h2><p>ã€€ã€€åæ¥æˆ‘å» <code>Untrusted</code> çš„ repo å»çœ‹é¢˜è§£ï¼Œå‘ç°ä»–ä»¬éƒ½æ˜¯å»é©±ä½¿è¿™ç¾¤ç—´æ±‰å¹²å˜›å¹²å˜›ã€‚æˆ‘æ„Ÿè§‰æˆ‘çš„æœ€ç®€å•æš´åŠ›äº†â€”â€”ç›´æ¥åºŸäº†ä»–ä»¬ã€‚</p><p>ã€€ã€€å…¶å®å‘¢åªè¦æŠŠç¢°æ’å‡½æ•°é‡å†™ä¸€éï¼Œè¿™å †ç—´æ±‰é©¬ä¸Šå°±å˜å¾—äººç•œæ— å®³ï¼Œä½ èµ°è¿‡å»äººå®¶è¿˜è¡Œç¤¼å‘¢233333333333</p><p>ã€€ã€€ä»”ç»†çœ‹ä¸€ä¸‹æˆ‘ä»¬è¦å®Œæˆçš„éƒ¨åˆ†åœ¨ <code>behavior</code> é‡Œé¢ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œé¢ç”¨ <code>this</code> æ˜¯å¦¥å¦¥ç”Ÿæ•ˆçš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.onCollision = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>çœ‹æˆ‘ç¢è›‹å¤§ç²‰æ‹³ï¼ï¼ˆå¿½ç„¶è§‰å¾—ä¸‹èº«ä¸€é˜µç–¼ç—›  |Ğ”`)ãƒâŒ’â—ï½*</p></blockquote><h2 id="Robot"><a href="#Robot" class="headerlink" title="Robot"></a>Robot</h2><p>ã€€ã€€ä½ èµ°ä¸€æ­¥æœºå™¨äººèµ°ä¸€æ­¥ï¼Œä¹Ÿæ˜¯æ•™å­¦å…³å¡ã€‚</p><p>ã€€ã€€æœºå™¨äººèƒ½å¾€ä¸‹èµ°å°±å¾€ä¸‹èµ°ï¼Œèƒ½å¾€å³èµ°å°±å¾€å³èµ°å°±æ‹¿åˆ°é’¥åŒ™äº†ï¼Œæœ€åä½ å†è¿½ä¸Šæœºå™¨äººæŠŠé’¥åŒ™æŠ¢è¿‡æ¥å°±å¥½äº†ã€‚å› ä¸ºæœºå™¨äººæ˜¯å¯ä»¥ç©¿è¿‡ç´«ç¿”è‰²çš„é‚£æ‰‡é—¨çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(me.canMove(<span class="string">"down"</span>)) me.move(<span class="string">"down"</span>);</span><br><span class="line"><span class="keyword">else</span> me.move(<span class="string">"right"</span>);</span><br></pre></td></tr></table></figure><blockquote><p>ç«™ä½ï¼Œä¿æŠ¤è´¹ã€‚ä½ ä¸è£… X æˆ‘ä»¬è¿˜æ˜¯å¥½æœ‹å‹ã€‚</p></blockquote><h2 id="Robot-Nav"><a href="#Robot-Nav" class="headerlink" title="Robot Nav"></a>Robot Nav</h2><p>ã€€ã€€æˆ‘å±…ç„¶æ— èŠåˆ°è‡ªå·±æŠŠè·¯çº¿æ•°å‡ºæ¥äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> road = <span class="string">"ddddrrrrrrrrrrrrrrrrrrrrrrrrrrrrrruurrrrrrrrrrrrrrrrrddddddd"</span>;</span><br><span class="line"><span class="keyword">this</span>.cur = <span class="keyword">this</span>.cur === <span class="literal">undefined</span> ? <span class="number">0</span> : (<span class="keyword">this</span>.cur + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.cur &gt;= road.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(road[<span class="keyword">this</span>.cur] === <span class="string">"d"</span>) me.move(<span class="string">"down"</span>);</span><br><span class="line"><span class="keyword">if</span>(road[<span class="keyword">this</span>.cur] === <span class="string">"r"</span>) me.move(<span class="string">"right"</span>);</span><br><span class="line"><span class="keyword">if</span>(road[<span class="keyword">this</span>.cur] === <span class="string">"u"</span>) me.move(<span class="string">"up"</span>);</span><br></pre></td></tr></table></figure><h2 id="Robot-Maze"><a href="#Robot-Maze" class="headerlink" title="Robot Maze"></a>Robot Maze</h2><p>ã€€ã€€å¥½å§ä½œè€…æ—©å°±æƒ³åˆ°äº†æœ‰äººä¼šæ— èŠåœ°å»æ•°ã€‚</p><p>ã€€ã€€å˜›å˜›ï¼Œå°±å¦‚ä½œè€…æ‰€æ„¿å†™ä¸ªæœ€åŸºç¡€çš„ DFS äº†äº‹å§ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> direct = &#123;</span><br><span class="line">    <span class="string">"d"</span>: <span class="string">"down"</span>,</span><br><span class="line">    <span class="string">"u"</span>: <span class="string">"up"</span>,</span><br><span class="line">    <span class="string">"l"</span>: <span class="string">"left"</span>,</span><br><span class="line">    <span class="string">"r"</span>: <span class="string">"right"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dfs...</span></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">undefined</span> === <span class="keyword">this</span>.dfs) &#123;</span><br><span class="line">    <span class="keyword">this</span>.ans = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">this</span>.step = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> vis = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        vis.push([]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">100</span>; j++) vis[i].push(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dir = [</span><br><span class="line">        [ <span class="number">0</span>, <span class="number">-1</span>, <span class="string">"u"</span>, <span class="string">"#f00"</span> ],</span><br><span class="line">        [ <span class="number">0</span>, <span class="number">1</span>, <span class="string">"d"</span>, <span class="string">"#0f0"</span> ],</span><br><span class="line">        [ <span class="number">-1</span>, <span class="number">0</span>, <span class="string">"l"</span>, <span class="string">"#00f"</span> ],</span><br><span class="line">        [ <span class="number">1</span>, <span class="number">0</span>, <span class="string">"r"</span>, <span class="string">"#fff"</span> ]</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.dfs = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x === map.getWidth() - <span class="number">2</span> &amp;&amp; y === <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        vis[y][x] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> newx = x + dir[i][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> newy = y + dir[i][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(newx &lt; <span class="number">0</span> || newy &lt; <span class="number">0</span> ||</span><br><span class="line">                newx &gt;= map.getWidth() ||</span><br><span class="line">                newy &gt;= map.getHeight() ||</span><br><span class="line">                vis[newy][newx] ||</span><br><span class="line">                map.getObjectTypeAt(newx, newy) === <span class="string">"block"</span></span><br><span class="line">                ) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> oldans = <span class="keyword">this</span>.ans;</span><br><span class="line">            <span class="keyword">this</span>.ans += dir[i][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">this</span>.dfs(newx, newy)) &#123;</span><br><span class="line">                <span class="keyword">this</span>.ans = oldans;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                map.setSquareColor(x, y, dir[i][<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.dfs(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">this</span>.ans += <span class="string">"dd"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.step &gt;= <span class="keyword">this</span>.ans.length) <span class="keyword">return</span>;</span><br><span class="line">me.move(direct[<span class="keyword">this</span>.ans[<span class="keyword">this</span>.step++]]);</span><br></pre></td></tr></table></figure><blockquote><p>çº¢é­”é¦†çš„åœ°ä¸‹å®¤ä¸€æ ·å‘¢ã€‚åæ­£æ˜¯æœºå™¨äººå¤šèµ°å‡ æ­¥è·¯æ²¡äº‹ï¼Œæ²¡å¿…è¦ç”¨ BFS æ±‚æœ€ä¼˜è§£2333333333</p></blockquote><h2 id="Crisps-Contest"><a href="#Crisps-Contest" class="headerlink" title="Crisps Contest"></a>Crisps Contest</h2><p>ã€€ã€€åˆšæ‰é‚£ä»¨ 2B æœºå™¨äººå¼•é¢†ä½ æ‹¿åˆ°äº†ä»¨é¢œè‰²çš„é’¥åŒ™åœ¨è¿™è¾¹æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p>ã€€ã€€é’»çº¢èŠèŠ±ä½ éœ€è¦æœ‰çº¢é’¥åŒ™ï¼Œå¹¶ä¸”ç”¨äº†ä¹‹åä¼šå°‘æ‰ã€‚å…¶å®ƒé¢œè‰²ä¹Ÿä¸€æ ·ã€‚æœ€ç»ˆä½ è¦æ‹¿åˆ° <code>A</code> æ‰€ä»£è¡¨çš„ <code>theAlgorithm</code> èµ°åˆ°å‡ºå£ã€‚</p><blockquote><p>ç­‰ç­‰ï¼å•Šå’§ï¼Ÿç»¿é’¥åŒ™çš„é€šè¿‡åˆ¤å®šæœ‰ä¸ªåœ°æ–¹å¯ä»¥ä¿®æ”¹ï¼Ÿå°±æ˜¯ä½ é€šè¿‡ç»¿èŠèŠ±çš„æ—¶å€™éœ€è¦æœ‰ç»¿é’¥åŒ™å¹¶ä¸”ä½ å¯ä»¥é€‰æ‹©ä½ ä¸¢å¼ƒçš„ä¸œè¥¿ã€‚ä¸¢ä»€ä¹ˆå¥½å‘¢ï¼Ÿç”µè„‘ï¼Ÿä¸è¡Œä¸è¡Œï¼Œè¿‡å…³è¿˜é å®ƒå‘¢ã€‚ç”µè¯æœºï¼Ÿä»¥åè‚¯å®šè¦ç”¨åˆ°ã€‚å…¶å®ƒé¢œè‰²é’¥åŒ™ï¼Ÿé‚£ä½ è‚¯å®šä¼šè¢«é”åœ¨æŸä¸ªåœ°æ–¹å‡ºä¸æ¥ã€‚é‚£å°±åªæœ‰ä¸¢å¼ƒ <code>theAlgorithm</code> äº†â€”â€”åæ­£åªè¦æ‹¿åˆ° <code>theAlgorithm</code> ä¹‹åä¸å†é€šè¿‡ç»¿èŠèŠ±å°±æ²¡äº‹äº†ã€‚</p></blockquote><p>ã€€ã€€äºæ˜¯åªè¦æŠŠç»¿èŠèŠ±çš„é€šè¿‡åˆ¤æ–­å‡½æ•°é‡Œé¢å¯ä¿®æ”¹çš„åŒºåŸŸæ”¹æˆ <code>theAlgorithm</code> å°±å¥½äº†ã€‚</p><p>ã€€ã€€æœ€åèµ°çš„é¡ºåºå¤§æ¦‚æ˜¯ï¼š</p><blockquote><p>è¿›å·¦ä¸Šè§’çš„é—¨æ‹¿åˆ°<span style="color: yellow;">é»„è¯å±</span>å’Œ<span style="color: blue;">è“è¯å±</span>å‡ºæ¥ã€‚ç„¶åå³ä¸Šè§’æŠŠ<span style="color: red;"><strong>çº¢</strong></span>å’Œ<span style="color: blue;"><strong>è“</strong></span>æ‹¿å‡ºæ¥ã€‚ç„¶åå‘ä¸‹ç›´æ£é»„é¾™ï¼Œå·¦é»„èŠèŠ±è¿›æ‹¿åˆ° <code>theAlgorithm</code> è“èŠèŠ±é€šè¿‡æ‹¿åˆ°<span style="color: yellow;">é»„è¯å±</span>ç„¶åå†é»„èŠèŠ±å‡ºã€‚</p><p>å¤§åŠŸå‘Šæˆï¼èµ°å‘èƒœåˆ©çš„å‡ºå£å§ï¼</p><p><strong>è‡ªå¤çº¢è“å‡º CPï¼</strong></p></blockquote><h2 id="Exceptional-Crossing"><a href="#Exceptional-Crossing" class="headerlink" title="Exceptional Crossing"></a>Exceptional Crossing</h2><p>ã€€ã€€åˆæ˜¯è¿‡æ²³å•Šï¼Œè¿™æ¬¡ä½ åªèƒ½æ˜¯æ­»äº†ï¼Œå› ä¸ºä½ çš„ç¼–è¾‘åŒºåŸŸåªæœ‰åœ¨ <code>player.killedBy()</code> é‡Œé¢ã€‚</p><blockquote><p>ã€Šè®¢åˆ¶æ­»ç¥ã€‹ï¼šè¿™ä¸ªæ—¶å€™è®©æ­»ç¥ç¬‘å°±å¯ä»¥äº†ã€‚</p></blockquote><p>ã€€ã€€è®©æˆ‘ä»¬ä¸€èµ·æ¥ç©åå®ƒå§ï¼åœ¨é‡Œé¢å¡«ä¸Š <code>) = (0</code> å°±å¥½äº†ã€‚ä»€ä¹ˆä»€ä¹ˆçœ‹ä¸æ‡‚ï¼Ÿä½ å¡«è¿›å»çœ‹ä¸€ä¸‹æ•´å¥è¯å°±çŸ¥é“äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">player.killedBy() = (<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åæ­»ç¥å°±ä¼šè¢«ä½ ç©åäº†ã€‚ä½ èµ°è¿‡å»çš„æ—¶å€™è¿™å¥è¯æ‰§è¡Œå‡ºé”™äº†2333333</p><h2 id="Lasers"><a href="#Lasers" class="headerlink" title="Lasers"></a>Lasers</h2><p>ã€€ã€€æœ‰å¾ˆå¤šéšè—çº¿ï¼Œä½ äººå¿…é¡»è¦è·Ÿéšè—çº¿çš„é¢œè‰²ä¸€è‡´æ‰èƒ½é€šè¿‡ï¼Œç„¶åç›®å‰æ‰€æœ‰çº¿éƒ½ç”¨ç™½è‰²ç»™ç”»å‡ºæ¥ã€‚</p><p>ã€€ã€€ç›®æµ‹ä½œè€…çš„æ„æ€æ˜¯è®©ä½ æŠŠç¡¬ç¼–ç çš„ç™½è‰²æ”¹æˆéšè—çº¿çš„é¢œè‰²ï¼Œè¿™æ ·å°±èƒ½æŠŠçº¿çš„é¢œè‰²ç»™æ ‡è®°å‡ºæ¥ï¼Œç„¶åå†ç»™ç”µè¯æœºå†™ä¸ªå‡½æ•°å°±æ˜¯è®©ä½ è‡ªå·±çš„äººå˜è‰²ã€‚</p><p>ã€€ã€€ä¸è¿‡æˆ‘è¿˜æ˜¯ç”¨äº†ä¸ª Hack çš„æ–¹æ³•â€”â€”</p><p>ã€€ã€€ç¬¬ä¸€æ¡çº¿ä»–è¦ç”»å°±ç”»ï¼Œå’±ä¸ç¢°å®ƒå°±å¥½äº†ï¼Œåªä¸è¿‡åœ¨ç¬¬ä¸€æ¡çº¿ç”»å®Œçš„åé¢æˆ‘ä»¬æŠŠè¿™ä¸ªç”»çº¿å‡½æ•°ç»™ Hack æ‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// using canvas to draw the line</span></span><br><span class="line"><span class="keyword">var</span> ctx = map.getCanvasContext();</span><br><span class="line">ctx.beginPath();</span><br><span class="line">ctx.strokeStyle = <span class="string">'white'</span>;</span><br><span class="line">ctx.lineWidth = <span class="number">5</span>;</span><br><span class="line">ctx.moveTo(x1, y1);</span><br><span class="line">ctx.lineTo(x2, y2);</span><br><span class="line">ctx.stroke();</span><br><span class="line"></span><br><span class="line">createLaser = abc;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ¥ä¸‹å»æ˜¯åœ¨ç¬¬äºŒç‰‡åŒºåŸŸå†™ä¸‹è‡ªå·±çš„ç”»çº¿å‡½æ•°å§ï¼Œè¿™é¢˜æœ€ä¸‹æ–¹æ£€æµ‹äº†çº¿çš„æ•°é‡ä¸èƒ½å°‘äº 25 æ¡ã€‚ä¹ˆäº‹ï¼Œçˆ·é«˜å…´ç”» 100 æ¡éƒ½ä¹ˆé—®é¢˜ï¼Œå› ä¸ºæˆ‘éƒ½æŠŠå®ƒç¼©åœ¨å·¦ä¸Šè§’äº† 2333333</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">abc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">25</span>; i++) &#123;</span><br><span class="line">        map.createLine([<span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>], <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//... Ahahaha</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> ctx = map.getCanvasContext();</span><br><span class="line">        ctx.beginPath();</span><br><span class="line">        ctx.strokeStyle = <span class="string">'red'</span>;</span><br><span class="line">        ctx.lineWidth = <span class="number">5</span>;</span><br><span class="line">        ctx.moveTo(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        ctx.lineTo(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">        ctx.stroke();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Pointers"><a href="#Pointers" class="headerlink" title="Pointers"></a>Pointers</h2><p>ã€€ã€€æœ‰å¥½å¤šä¼ é€é—¨ï¼Œæ¯æ¬¡æ‰§è¡Œéšæœºç”Ÿæˆä¼ é€ä½ç½®ï¼Œæœ‰äº›ä¼ é€é—¨ä¼šæŠŠä½ ä¼ åˆ°äºŒå°å§çš„åœ°ä¸‹å®¤ç„¶åè¢«åƒæ‰ã€‚</p><p>ã€€ã€€æˆ‘ä¹Ÿæ‡’å¾—å¤šåŠ¨è„‘ç­‹æˆ–è€…ç”»çº¿ä»€ä¹ˆçš„ï¼Œç›´æ¥å¯¹ä¸¤ä¸ªéƒ½æ˜¯ä¼ é€é—¨çš„ CP æ ‡è®°ä¸€æ ·çš„éšæœºé¢œè‰²å°±å¥½äº†ï¼Œæœ€åè·Ÿç€é¢œè‰²èµ°åˆ°å‡ºå£å»ï¼ˆæœ‰ä¸ªå‘å°±æ˜¯æœ‰æ—¶å€™è¿™ä¸ªåœ°å›¾æœ¬èº«å°±æ˜¯æ­»å±€ï¼Œæ‰€ä»¥å¾—å¤šè¯•å‡ æ¬¡é‡æ–°æ‰§è¡Œ à®‡Ğ´à®‡</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> dict = <span class="string">"0123456789ABCDEF"</span>;</span><br><span class="line"><span class="keyword">if</span>(t1.getType() === <span class="string">"teleporter"</span> &amp;&amp; t2.getType() === <span class="string">"teleporter"</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> color = <span class="string">"#"</span> + dict[<span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">15</span>)] +</span><br><span class="line">        dict[<span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">15</span>)] +</span><br><span class="line">        dict[<span class="built_in">Math</span>.ceil(<span class="built_in">Math</span>.random() * <span class="number">15</span>)];</span><br><span class="line"></span><br><span class="line">    map.setSquareColor(t1.getX(), t1.getY(), color);</span><br><span class="line">    map.setSquareColor(t2.getX(), t2.getY(), color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Super-Dr-Eval-Bros"><a href="#Super-Dr-Eval-Bros" class="headerlink" title="Super Dr. Eval Bros"></a>Super Dr. Eval Bros</h2><p>ã€€ã€€å¥½å§æœ¬æ„æ˜¯è®©ä½ è®¾ç½®ä¸€ä¸ª <code>timer</code> ç„¶åä¸€ç›´è·³å•Šè·³çš„ã€‚</p><p>ã€€ã€€ä¸è¿‡å‘¢ï¼Œå®šä¸€ä¸ªæ–°æ–¹å—ç»™è‡ªå·±æ­ä¸€åº§æ¡¥å°±æ˜¯äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">map.defineObject(<span class="string">"â¤"</span>, &#123;</span><br><span class="line">    <span class="attr">impassable</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">symbol</span>: <span class="string">"â¤"</span></span><br><span class="line">&#125;);</span><br><span class="line">map.placeObject(<span class="number">20</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">21</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">22</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">23</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">24</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">25</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">26</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">27</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">28</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br><span class="line">map.placeObject(<span class="number">29</span>, <span class="number">12</span>, <span class="string">"â¤"</span>);</span><br></pre></td></tr></table></figure><blockquote><p>ä½ åªè¦æ‰“ä¸ªç”µè¯æ¡¥å°±ä¼šå‡ºç°çš„ã€‚</p></blockquote><h2 id="Document-Object-Madness"><a href="#Document-Object-Madness" class="headerlink" title="Document Object Madness"></a>Document Object Madness</h2><p>ã€€ã€€å¥½ç¥å¥‡ï¼å¥½å¥‡è‘©ï¼æˆ‘é”®ç›˜ <code>hjkl</code> ä¹±æŒ‰ä¸€é€šå°±è¿‡äº†ã€‚</p><h2 id="Boss-Fight"><a href="#Boss-Fight" class="headerlink" title="Boss Fight"></a>Boss Fight</h2><p>ã€€ã€€æ‰“ Boss äº†ã€‚</p><p>ã€€ã€€å¥½å§æˆ‘æ‰¿è®¤æˆ‘ Cheat äº†â€”â€”åŸè°…æˆ‘ç”¨äº† <code>console.log</code>ã€‚</p><blockquote><p>å› ä¸ºå½“æˆ‘æ‰“å¼€æ§åˆ¶å°çš„æ—¶å€™ä¸‹é¢çš„è¯­å¥å‡ºç°åœ¨æˆ‘çš„çœ¼é‡Œï¼š</p><blockquote><p><strong><em>If you can read this, you are cheating!</em></strong></p><p><strong><em>But really, you donâ€™t need this console to play the game. Walk around using arrow keys (or Vim keys), and pick up the computer (âŒ˜). Then the fun begins!</em></strong></p></blockquote></blockquote><p>ã€€ã€€å˜›å˜›ï¼Œæ— è®ºå¦‚ä½•ï¼Œè¿‡å…³äº†å°±å¥½ã€‚</p><p>ã€€ã€€è¿™é¢˜å‘¢æ˜¯è¦è®©æ‰€æœ‰çš„ <code>boss</code> ç»™æ¯ç­æ‰å³å¯â€”â€” å½“æ‰€æœ‰çš„ <code>boss</code> æ¯ç­ä¹‹åä¼šçˆ†å‡ºä»»åŠ¡é“å…· <code>theAlgorithm</code> ç„¶åå°±èƒ½é€šå…³äº†ã€‚</p><p>ã€€ã€€åæ¥æˆ‘å‘ç°å¯ä»¥è®©å­å¼¹æ¶ˆç­ <code>boss</code>ã€‚ä½†æ˜¯æˆ‘å½“æ—¶æ²¡è¿™ä¹ˆåšã€‚</p><p>ã€€ã€€æˆ‘å…ˆå¼„äº†å µå¢™æŠŠå­å¼¹æŒ¡ä½å…ˆï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">map.defineObject(<span class="string">"ä¿å‘½çš„"</span>, &#123;</span><br><span class="line">    <span class="attr">impassable</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">symbol</span>: <span class="string">"â¤"</span>,</span><br><span class="line">    <span class="attr">onCollision</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; map.getWidth(); i++) &#123;</span><br><span class="line">    map.placeObject(i, <span class="number">9</span>, <span class="string">"ä¿å‘½çš„"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸‹ä½ å°±èƒ½æ¡åˆ°ç”µè¯æœºäº†â€”â€”ç„¶åç»™ç”µè¯æœºå†™å›è°ƒå‡½æ•°ã€‚</p><p>ã€€ã€€æ€ä¹ˆè¯´å‘¢ï¼Œå½“ä½ æ¯ç”¨ä¸€æ¬¡ç”µè¯æœºï¼Œæˆ‘å°±æŠŠå½“å‰å­˜åœ¨äºå±å¹•çš„ <code>boss</code> å’Œ <code>bullet</code> ç»™åˆ†å¼€ç½—åˆ—ï¼Œç„¶åæŠŠ <code>boss</code> çš„ <code>_destroy</code>ï¼ˆè­¦å¯Ÿå”å”ï¼Œå°±æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯æˆ‘ <code>console.log</code> å‡ºæ¥çš„ï¼‰ç»™å«æ¥åˆ° <code>bullet</code> çš„ <code>_destroy</code> å»ã€‚</p><p>ã€€ã€€è¿™æ ·ä¼šå‡ºç°ä»€ä¹ˆæ ·çš„ç»“æœå‘¢ï¼Ÿâ€”â€”å½“å­å¼¹ç¢°åˆ°å¢™çš„æ—¶å€™å°±ä¼šé”€æ¯ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè§¦å‘ <code>_destroy</code> å‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™çš„ <code>_destroy</code> å‡½æ•°å·²ç»ä¼šå˜æˆäº† <code>boss</code> çš„äº†ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ—¶å€™å­å¼¹ä¸ä¼šè¢«é”€æ¯åè€Œæ˜¯æŸä¸€ä¸ª <code>boss</code> çš„ <code>_destroy</code> å‡½æ•°è¢«è°ƒç”¨ç„¶åè¢«é”€æ¯äº†ã€‚</p><p>ã€€ã€€å†æ€ä¹ˆè¯´è¿™éƒ½æ˜¯ Hack çš„åŠæ³•ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè§¦å‘ <code>boss</code> çš„ <code>onDestroy</code> å‡½æ•°ä¹Ÿå°±æ˜¯è¯´å³ä½¿æ‰€æœ‰ <code>boss</code> éƒ½æ²¡äº†ä¹Ÿä¸ä¼šå‡ºç° <code>theAlgorithm</code> è¿™ç©æ„å„¿ã€‚</p><blockquote><p>è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼</p></blockquote><p>ã€€ã€€æ•Œäººä¸ç»™æˆ‘ä»¬æˆ‘ä»¬å°±è‡ªå·±é€ å‘—ï¼åæ­£é€šå…³åˆ¤å®šæ˜¯â€”â€”<code>boss</code> æ•°é‡ä¸º <code>0</code> ä¸”ä½ æœ‰ <code>theAlgorithm</code> è¿™ä¸ªé“å…·ã€‚</p><p>ã€€ã€€æ‰€ä»¥è¯´å½“æ‰€æœ‰ <code>boss</code> éƒ½è¢«é”€æ¯ä¹‹åï¼Œæˆ‘ä»¬è‡ªå·±å» <code>map.replaceObject</code> ä¸€ä¸ª <code>theAlgorithm</code> é“å…·å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">map.getPlayer().setPhoneCallback(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bosses = [];</span><br><span class="line">    <span class="keyword">var</span> bullets = [];</span><br><span class="line">    <span class="keyword">var</span> objects = map.getDynamicObjects();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; objects.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(objects[i].getType() == <span class="string">"boss"</span>) &#123;</span><br><span class="line">            bosses.push(objects[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            bullets.push(objects[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">Math</span>.min(bosses.length, bullets.length); i++) &#123;</span><br><span class="line">        bullets[i]._destroy = bosses[i]._destroy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(bosses.length === <span class="number">0</span>) &#123;</span><br><span class="line">        map.placeObject(map.getPlayer().getX(), map.getPlayer().getY() + <span class="number">1</span>,</span><br><span class="line">            <span class="string">'theAlgorithm'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä»¥ä¸Šä»£ç å†™å®Œåå°±å¼€å§‹æ‰“ <code>boss</code> å§ï¼èµ¶ç´§å»æ‹¿åˆ°ç”µè¯æœºï¼Œç„¶åä½ ä¼šå‘ç°æ‰“ä¸€ä¸ªç”µè¯ <code>boss</code> å°±å°‘ä¸€å †ï¼Œé‚£æ„Ÿè§‰å€çˆ½å„¿ï¼</p><h2 id="End-of-the-Line"><a href="#End-of-the-Line" class="headerlink" title="End of the Line"></a>End of the Line</h2><p>ã€€ã€€é©¬ä¸Šè¦é€šå…³äº†ã€‚è¿™é‡Œæ˜¯ä¸ªå‘ï¼Œå¼€å§‹æˆ‘è¿˜ä»¥ä¸ºè¿™é‡Œå°±æ˜¯çœŸÂ·é€šå…³äº† QAQã€‚</p><p>ã€€ã€€éšåçœ‹çœ‹åé¢è¿˜æ˜¯æœ‰å…³å¡å•Šã€‚ä½†æ˜¯æˆ‘çªç„¶å‘ç° <code>&lt;ctrl+0&gt;</code> è·³å‡ºæ¥çš„ menu å·¦è¾¹å¤šå‡ºäº†æ–‡ä»¶å¤¹ï¼ç„¶åè¿›å»éšæ„ç¿»çœ‹äº†ã€‚</p><p>ã€€ã€€æœ€åå‘ç°åŸæ¥æ˜¯è¦ä¿®æ”¹ <code>scripts/objects.js</code> æ–‡ä»¶â†’ï¼¿â†’ã€‚</p><p>ã€€ã€€å¥½å§ï¼Œåˆ†æé€šå…³éªŒè¯æ¥çœ‹ï¼Œè¿™ä¸€å…³çš„ <code>map.finalLevel</code> ä¸º <code>true</code>ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠ <code>scripts/objects.js</code> æ–‡ä»¶é‡Œé¢çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!game.map.finalLevel) &#123;</span><br><span class="line">    game._moveToNextLevel();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»™æ”¹æˆå¦‚æœæ˜¯ <code>finalLevel</code> å°±è·‘åˆ°ä¸‹ä¸€å…³å»å°±å¯ä»¥äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(game.map.finalLevel) &#123;</span><br><span class="line">    game._moveToNextLevel();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Credits"><a href="#Credits" class="headerlink" title="Credits"></a>Credits</h2><p>ã€€ã€€ç”±äºäº‹å…ˆæ–‡ç« ç»“æ„æ²¡æœ‰å†™å¥½ï¼Œå°±æ¥è¿™å…³çš„å‘ä½æ¥å°ç»“å§ 0. 0ã€‚ï¼ˆåæ­£äººå®¶åªæ˜¯åºå¹•ç« äº†</p><p>ã€€ã€€å¥½çš„ï¼Œå…¶å®ä¹Ÿä»€ä¹ˆæ€»ç»“çš„ï¼Œä½†æ˜¯æ€»è§‰å¾—å¾—æœ‰è¿™ä¹ˆä¸ªå°ç»“æ‰å¯¹ã€‚</p><p>ã€€ã€€æ‰¾å·¥ä½œå•Šæ‰¾å·¥ä½œâ€”â€”æœ‰æƒ³è¦æˆ‘çš„è¯·è”ç³»æˆ‘ 2333333333</p><p>ã€€ã€€è”ç³»èµ„æ–™åœ¨ <a href="http://xcoder.in/curriculumvitae/">CV</a> é‡Œé¢ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€&lt;a href=&quot;http://alexnisnevich.github.io/untrusted/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Trusted&lt;/a&gt; æ˜¯ä¸€ä¸ªä»£ç è§£è°œæ¸¸æˆï¼Œç”¨ Javascript æ¥è¿‡å…³çš„ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€æ˜¨å¤©
      
    
    </summary>
    
    
      <category term="Javascript" scheme="https://xcoder.in/tags/Javascript/"/>
    
      <category term="untrusted" scheme="https://xcoder.in/tags/untrusted/"/>
    
      <category term="æ¸¸æˆ" scheme="https://xcoder.in/tags/%E6%B8%B8%E6%88%8F/"/>
    
  </entry>
  
  <entry>
    <title>Cocos2d-x 3.1.1 å¼€å‘ç¯å¢ƒæ­å»ºï¼ˆWinç¯‡ï¼‰</title>
    <link href="https://xcoder.in/2014/06/07/cocos2d-311-setup/"/>
    <id>https://xcoder.in/2014/06/07/cocos2d-311-setup/</id>
    <published>2014-06-07T11:34:02.000Z</published>
    <updated>2017-12-11T07:59:20.465Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€ç”±äºå·æ‡’ï¼Œæ‰€ä»¥åœ¨æ­¤æ„Ÿè°¢ Etond çš„æŒ‡å¯¼ï¼ˆå–‚å–‚å–‚ï¼Œæ˜æ˜æ˜¯è‡ªå·±æ‡’å¾—çœ‹æ–‡æ¡£ï¼Œæ˜æ˜ <a href="README"><code>READEME.md</code></a> é‡Œé¢å°±æœ‰ï¼(Â´â‰–â—à±ªâ—Ÿâ‰–)</p><p>ã€€ã€€å¦ï¼Œåœ¨æ­å»ºç¯å¢ƒçš„æ—¶å€™ï¼Œæœ€å¥½ä¿è¯ä½ åœ¨<span style="background: #222;">å¢™å¤–</span>ã€‚ä»¥åŠæˆ‘é»˜è®¤è§‰å¾—å¤§å®¶å·²ç»æœ‰äº† <code>Python</code> ç¯å¢ƒå’Œ <code>JDK</code>ã€‚</p><h2 id="å‰é©±å·¥ä½œ"><a href="#å‰é©±å·¥ä½œ" class="headerlink" title="å‰é©±å·¥ä½œ"></a>å‰é©±å·¥ä½œ</h2><p>ã€€ã€€å…ˆå» <a href="http://www.cocos2d-x.org/download" target="_blank" rel="external">cocos2d-x å®˜ç½‘</a>ä¸‹å‹ç¼©åŒ…ï¼Œæ”¾åˆ°ä¸€ä¸ªåªæœ‰ç¥çŸ¥é“çš„ä¸–ç•Œé‡Œé¢ã€‚</p><p>ã€€ã€€æ¥ä¸‹å»éœ€è¦å®‰è£…ä»¨ä¸œè¥¿ï¼š</p><h3 id="Android-SDK"><a href="#Android-SDK" class="headerlink" title="Android SDK"></a>Android SDK</h3><p>ã€€ã€€<a href="http://developer.android.com/sdk/index.html#download" target="_blank" rel="external">è¿™ä¸œè¥¿</a>çœŸå°¼ç›å¤§å•Šï¼æˆ‘å®¶çš„å°æ°´ç®¡çœŸåƒä¸èµ·ã€‚</p><p>ã€€ã€€ç„¶åæŠŠ <strong>adt-bundle-â€¦zip</strong> è¿™ä¸ªåŒ…å‹ç¼©åˆ°ä»»æ„æœ¨æœ‰ä¸­æ–‡å’Œç©ºæ ¼çš„è·¯å¾„ä¸‹é¢ã€‚</p><h3 id="NDK"><a href="#NDK" class="headerlink" title="NDK"></a>NDK</h3><p>ã€€ã€€<a href="http://developer.android.com/tools/sdk/ndk/index.html#download" target="_blank" rel="external">è¿™å°ä¼™ä¼´</a>ä¹Ÿä¸å°å•Šã€‚éƒ½æ˜¯ 500M çš„ä¸»å„¿å•Šï¼ˆÙ©(Åï¹Åã€)Û¶</p><p>ã€€ã€€ä¹Ÿè§£å‹åˆ°ä¸€ä¸ªåœ°æ–¹ä¸ç”¨ç®¡å®ƒã€‚</p><h3 id="Ant"><a href="#Ant" class="headerlink" title="Ant"></a>Ant</h3><p>ã€€ã€€æ®è¯´è¿™è´§æ˜¯é˜¿å¸•å¥‡å‡ºçš„ï¼Ÿæ€»ä¹‹ä¸‹è½½åœ°å€åœ¨<a href="http://ant.apache.org/bindownload.cgi" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ã€€ã€€å“¦å¯¹äº†ä½ è¿˜å¾—æœ‰ä¸ª Python è·¯å¾„ï¼Œè¿™é‡Œå°±ä¸ç´¯è¿°äº†ã€‚æ¥ä¸‹å»åœ¨å‘½ä»¤è¡Œé‡Œé¢æ‰§è¡Œ Cocos2d çš„ <code>setup.py</code> æ–‡ä»¶å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/&gt; py setup.py</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ¥ä¸‹å»ç»ˆç«¯ä¼šåœåœ¨ä¸‹é¢ä¸€è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Please enter the path of NDK_ROOT (or press Enter to skip):</span><br></pre></td></tr></table></figure><p>ã€€ã€€åœ¨åé¢è¾“å…¥ä½ æ”¾å¥½çš„ NDK ç›®å½•å³å¯ã€‚</p><p>ã€€ã€€å¦‚æœä¸‹é¢åˆå‡ºç°äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Please enter the path of ANDROID_SDK_ROOT (or press Enter to skip):</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä½ åªéœ€åœ¨é‡Œé¢è¾“å…¥ä½ åˆšæ”¾å¥½çš„ Android SDK çš„ç›®å½•å³å¯ã€‚ï¼ˆæ³¨æ„æ˜¯è¦åˆšæ‰çš„ SDK å‹ç¼©åŒ…è§£å‹å‡ºæ¥çš„ sdk è·¯å¾„ï¼‰</p><p>ã€€ã€€å†å¦‚æœä¸‹é¢è¿˜å‡ºç°ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Please enter the path of ANT_ROOT (or press Enter to skip):</span><br></pre></td></tr></table></figure><p>ã€€ã€€é‚£ä¹ˆå†æŠŠ Ant çš„è·¯å¾„æä¸Šå»å°±å¥½äº†ã€‚ï¼ˆåˆå¾—æ³¨æ„è¿™é‡Œå¾—æ˜¯ Ant çš„ bin ç›®å½•ï¼‰</p><p>ã€€ã€€æœ€åç¡®ä¿ç»ˆç«¯ï¼ˆæˆ–è€…è¯´å‘½ä»¤è¡Œï¼‰é‡Œé¢å‡ºç°å¦‚ä¸‹å­—æ ·ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Please restart the terminal or restart computer to make added system variables take effect</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åä½ æŠŠç»ˆç«¯å…³äº†å†å¼€ä¸€ä¸ªå°±å¥½äº†ã€‚è‡³æ­¤ï¼Œå¤§è‡´å°±å®‰è£…å®Œæ¯•äº†ã€‚</p><h2 id="æ–°å»ºä¸€ä¸ª-Demo-é¡¹ç›®"><a href="#æ–°å»ºä¸€ä¸ª-Demo-é¡¹ç›®" class="headerlink" title="æ–°å»ºä¸€ä¸ª Demo é¡¹ç›®"></a>æ–°å»ºä¸€ä¸ª Demo é¡¹ç›®</h2><p>ã€€ã€€éšæ„è·‘åˆ°ä¸€ä¸ªç›®å½•ä¸‹é¢æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/&gt; cocos new FirstGame -p in.xcoder.firstgame -l cpp -d FirstGame</span><br></pre></td></tr></table></figure><blockquote><p>å¤§è‡´æ„æ€å°±æ˜¯è¯´åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®è·¯å¾„ï¼Œå« <code>FirstGame</code>ï¼Œå…¶åŒ…åå« <code>in.xcoder.firstgame</code>ï¼Œç„¶åè¯­è¨€æ˜¯ <code>cpp</code>ï¼Œæœ€å <code>-d</code> æ˜¯è·¯å¾„ã€‚</p></blockquote><p>ã€€ã€€å‘½ä»¤è¯¦æƒ…å¸®åŠ©å¯ä»¥çœ‹ <code>cocos --help</code>ã€‚</p><h3 id="ç¼–è¯‘-Demo"><a href="#ç¼–è¯‘-Demo" class="headerlink" title="ç¼–è¯‘ Demo"></a>ç¼–è¯‘ Demo</h3><p>ã€€ã€€è¯»æ ‡é¢˜ï¼Œæ˜¯ Win ç¯‡ã€‚æ‰€ä»¥æˆ‘ä»¬è·‘åˆ°é¡¹ç›®è·¯å¾„ä¸‹é¢çš„ <code>proj.win32</code> ç›®å½•ä¸‹é¢ç”¨ M$ VS æ‰“å¼€ <code>FirstGame.sln</code> å°±å¯ä»¥æ‰“å¼€åˆšåˆ›å»ºçš„æ¨¡æ¿é¡¹ç›®äº†ã€‚</p><p>ã€€ã€€æ— è®ºå¦‚ä½•å…ˆç¼–è¯‘çœ‹çœ‹å§ï¼ï½</p><p>ã€€ã€€å¦‚ä½•ï¼Ÿè·‘èµ·æ¥äº†å§ï¼Ÿ</p><h3 id="æ‰“åŒ…-Demo"><a href="#æ‰“åŒ…-Demo" class="headerlink" title="æ‰“åŒ… Demo"></a>æ‰“åŒ… Demo</h3><p>ã€€ã€€è¿™é‡Œå°±è®²è®²å¦‚ä½•æ‰“åŒ…å®‰å“çš„ç‰ˆæœ¬å§ï¼š</p><h4 id="Debug-ç‰ˆæœ¬"><a href="#Debug-ç‰ˆæœ¬" class="headerlink" title="Debug ç‰ˆæœ¬"></a>Debug ç‰ˆæœ¬</h4><p>ã€€ã€€è·‘åˆ°ä½ çš„é¡¹ç›®ç›®å½•ä¸‹é¢ï¼ˆå³æœ‰ <code>.cocos-project.json</code> æ–‡ä»¶çš„ç›®å½•ï¼‰ï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/&gt; cocos run -p android</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç­‰å·¥å…·ç¼–è¯‘æ‰“åŒ…å®Œæˆå°± OK äº†ã€‚ï¼ˆè®°å¾—è¦æŸ¥å®‰å“æ‰‹æœºå¹¶ä¸”è°ƒè¯•æ¨¡å¼å“¦ï½ï¼‰</p><h4 id="Release-ç‰ˆæœ¬"><a href="#Release-ç‰ˆæœ¬" class="headerlink" title="Release ç‰ˆæœ¬"></a>Release ç‰ˆæœ¬</h4><p>ã€€ã€€å¦‚æœè¦ä¸Šä¼ åˆ° Google Play ä¹‹ç±»çš„åœ°æ–¹ï¼Œéœ€è¦æœ‰ç­¾åã€‚æ‰€ä»¥å‘å¸ƒ Release ç‰ˆæœ¬ä¹‹å‰ï¼Œä½ å…ˆå¾—æå¥½è‡ªå·±çš„ç­¾åã€‚</p><h5 id="Keytool"><a href="#Keytool" class="headerlink" title="Keytool"></a>Keytool</h5><p>ã€€ã€€åœ¨ç»ˆç«¯è·‘åˆ°ä½ çš„é¡¹ç›®è·¯å¾„ä¸‹é¢ï¼Œç„¶åæ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/&gt; keytool -genkey -v -keystore FirstGame.keystore -alias FirstGame -keyalg RSA -keysize 2048 -validaty 10000</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç…§ç€å‘½ä»¤è¡Œç»™çš„æç¤ºå®Œæˆåˆ›å»ºå¯†é’¥å³å¯ã€‚</p><h5 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h5><p>ã€€ã€€ç”Ÿæˆä¹‹åå•Šå°±ç›´æ¥æ‰§è¡Œç¼–è¯‘å‘½ä»¤äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/&gt; cocos run -p android -m release</span><br></pre></td></tr></table></figure><p>ã€€ã€€åœ¨é‡Œé¢å‘¢æœ€åä¼šè®©ä½ è¾“å…¥ <code>.keystore</code> æ–‡ä»¶çš„è·¯å¾„ã€‚</p><p>ã€€ã€€æˆ‘ä»¬è¾“å…¥ç›¸å¯¹è·¯å¾„ï¼Œç”±äºæˆ‘ä»¬åˆšæ‰æŠŠè¿™ä¸ªæ–‡ä»¶æåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¾“å…¥ <code>../FirstGame.keystore</code> å³å¯ã€‚æ¥ä¸‹å»ä»–ä¼šè®©ä½ è¾“å…¥å¯†ç ã€åˆ«åå’Œåˆ«åä¿¡æ¯çš„å¯†ç ã€‚ä½ éƒ½æ­£ç¡®è¾“å…¥ä¸€éä»–å°±ä¼šå®‰å®‰åˆ†åˆ†è·‘åœ¨ä½ çš„æ‰‹æœºé‡Œé¢äº†ã€‚</p><h4 id="ä»¨ç‰ˆæœ¬çš„æ–‡ä»¶è·¯å¾„"><a href="#ä»¨ç‰ˆæœ¬çš„æ–‡ä»¶è·¯å¾„" class="headerlink" title="ä»¨ç‰ˆæœ¬çš„æ–‡ä»¶è·¯å¾„"></a>ä»¨ç‰ˆæœ¬çš„æ–‡ä»¶è·¯å¾„</h4><p>ã€€ã€€ä¸Šé¢éƒ½å¼„å¥½ä¹‹åï¼Œä½ çš„ä»¨ç‰ˆæœ¬ <code>*.apk</code> æ–‡ä»¶ä¹Ÿå°±ç”Ÿæˆäº†ã€‚å¾ˆå¤šäººå¯èƒ½å¾ˆå›°æƒ‘ï¼Œä¸ºä»€ä¹ˆæ˜¯ä»¨ç‰ˆæœ¬ã€‚å› ä¸ºå…¶ä¸­ Release ç‰ˆæœ¬è¿˜åˆ†å¸¦ç­¾åå’Œæ²¡ç­¾åç‰ˆæœ¬ã€‚</p><p>ã€€ã€€æ€»ä¹‹é‚£ä¸ªè·¯å¾„åœ¨ <code>publish/android</code> ä¸‹é¢ï¼Œé‡Œé¢æœ‰ä»¨ <code>*.apk</code> æ–‡ä»¶ï¼Œä½ æ‹¿å‡ºæ¥å‘å¸ƒå°±å¯ä»¥äº†ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ã€€ã€€å…¶å®ä¹Ÿæ²¡ä»€ä¹ˆç»“ä¸ç»“çš„ï¼Œè¿™äº›ä¸œè¥¿ä½ ä»¬è‡ªå·±å»çœ‹çœ‹å®˜æ–¹æ–‡æ¡£å°±å¥½äº†ã€‚æ€»ä¹‹å°±è¿™æ ·äº†å§ï¼Œä»¥ä¸Šã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€ç”±äºå·æ‡’ï¼Œæ‰€ä»¥åœ¨æ­¤æ„Ÿè°¢ Etond çš„æŒ‡å¯¼ï¼ˆå–‚å–‚å–‚ï¼Œæ˜æ˜æ˜¯è‡ªå·±æ‡’å¾—çœ‹æ–‡æ¡£ï¼Œæ˜æ˜ &lt;a href=&quot;README&quot;&gt;&lt;code&gt;READEME.md&lt;/code&gt;&lt;/a&gt; é‡Œé¢å°±æœ‰ï¼(Â´â‰–â—à±ªâ—Ÿâ‰–)&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¦ï¼Œåœ¨æ­å»ºç¯å¢ƒçš„æ—¶å€™ï¼Œæœ€å¥½ä¿è¯ä½ åœ¨&lt;span styl
      
    
    </summary>
    
      <category term="æ¸¸æˆå¼€å‘" scheme="https://xcoder.in/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="cocos2d" scheme="https://xcoder.in/tags/cocos2d/"/>
    
  </entry>
  
  <entry>
    <title>ã€è½¬ã€‘TCP çš„é‚£äº›äº‹å„¿ï¼ˆä¸Šï¼‰</title>
    <link href="https://xcoder.in/2014/06/07/tcp-those-things-1/"/>
    <id>https://xcoder.in/2014/06/07/tcp-those-things-1/</id>
    <published>2014-06-06T17:47:10.000Z</published>
    <updated>2017-12-11T07:59:20.543Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€TCPæ˜¯ä¸€ä¸ªå·¨å¤æ‚çš„åè®®ï¼Œå› ä¸ºä»–è¦è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œè€Œè¿™äº›é—®é¢˜åˆå¸¦å‡ºäº†å¾ˆå¤šå­é—®é¢˜å’Œé˜´æš—é¢ã€‚æ‰€ä»¥å­¦ä¹  TCP æœ¬èº«æ˜¯ä¸ªæ¯”è¾ƒç—›è‹¦çš„è¿‡ç¨‹ï¼Œä½†å¯¹äºå­¦ä¹ çš„è¿‡ç¨‹å´èƒ½è®©äººæœ‰å¾ˆå¤šæ”¶è·ã€‚å…³äº TCP è¿™ä¸ªåè®®çš„ç»†èŠ‚ï¼Œæˆ‘è¿˜æ˜¯æ¨èä½ å»çœ‹ <a href="http://www.kohala.com/start/" target="_blank" rel="external">W.Richard Stevens</a> çš„ã€Š<a href="http://book.douban.com/subject/1088054/" target="_blank" rel="external">TCP/IP è¯¦è§£ å·1ï¼šåè®®</a>ã€‹ï¼ˆå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å»è¯»ä¸€ä¸‹ <a href="http://tools.ietf.org/html/rfc793" target="_blank" rel="external">RFC793</a> ä»¥åŠåé¢ N å¤šçš„ RFCï¼‰ã€‚å¦å¤–ï¼Œæœ¬æ–‡æˆ‘ä¼šä½¿ç”¨è‹±æ–‡æœ¯è¯­ï¼Œè¿™æ ·æ–¹ä¾¿ä½ é€šè¿‡è¿™äº›è‹±æ–‡å…³é”®è¯æ¥æŸ¥æ‰¾ç›¸å…³çš„æŠ€æœ¯æ–‡æ¡£ã€‚</p><p>ã€€ã€€ä¹‹æ‰€ä»¥æƒ³å†™è¿™ç¯‡æ–‡ç« ï¼Œç›®çš„æœ‰ä¸‰ä¸ªï¼Œ</p><ul><li>ä¸€ä¸ªæ˜¯æƒ³é”»ç‚¼ä¸€ä¸‹è‡ªå·±æ˜¯å¦å¯ä»¥ç”¨ç®€å•çš„ç¯‡å¹…æŠŠè¿™ä¹ˆå¤æ‚çš„TCPåè®®ææ¸…æ¥šçš„èƒ½åŠ›ã€‚</li><li>å¦ä¸€ä¸ªæ˜¯è§‰å¾—ç°åœ¨çš„å¥½å¤šç¨‹åºå‘˜åŸºæœ¬ä¸Šä¸ä¼šè®¤è®¤çœŸçœŸåœ°è¯»æœ¬ä¹¦ï¼Œå–œæ¬¢å¿«é¤æ–‡åŒ–ï¼Œæ‰€ä»¥ï¼Œå¸Œæœ›è¿™ç¯‡å¿«é¤æ–‡ç« å¯ä»¥è®©ä½ å¯¹TCPè¿™ä¸ªå¤å…¸æŠ€æœ¯æœ‰æ‰€äº†è§£ï¼Œå¹¶èƒ½ä½“ä¼šåˆ°è½¯ä»¶è®¾è®¡ä¸­çš„ç§ç§éš¾å¤„ã€‚å¹¶ä¸”ä½ å¯ä»¥ä»ä¸­æœ‰ä¸€äº›è½¯ä»¶è®¾è®¡ä¸Šçš„æ”¶è·ã€‚</li><li>æœ€é‡è¦çš„å¸Œæœ›è¿™äº›åŸºç¡€çŸ¥è¯†å¯ä»¥è®©ä½ ææ¸…å¾ˆå¤šä»¥å‰ä¸€äº›ä¼¼æ˜¯è€Œéçš„ä¸œè¥¿ï¼Œå¹¶ä¸”ä½ èƒ½æ„è¯†åˆ°åŸºç¡€çš„é‡è¦ã€‚</li></ul><p>ã€€ã€€æ‰€ä»¥ï¼Œæœ¬æ–‡ä¸ä¼šé¢é¢ä¿±åˆ°ï¼Œåªæ˜¯å¯¹ TCP åè®®ã€ç®—æ³•å’ŒåŸç†çš„ç§‘æ™®ã€‚</p><p>ã€€ã€€æˆ‘æœ¬æ¥åªæƒ³å†™ä¸€ä¸ªç¯‡å¹…çš„æ–‡ç« çš„ï¼Œä½†æ˜¯ TCP çœŸ TMD çš„å¤æ‚ï¼Œæ¯” C++ å¤æ‚å¤šäº†ï¼Œè¿™ 30 å¤šå¹´æ¥ï¼Œå„ç§ä¼˜åŒ–å˜ç§äº‰è®ºå’Œä¿®æ”¹ã€‚æ‰€ä»¥ï¼Œå†™ç€å†™ç€å°±å‘ç°åªæœ‰ç æˆä¸¤ç¯‡ã€‚</p><ul><li>ä¸Šç¯‡ä¸­ï¼Œä¸»è¦å‘ä½ ä»‹ç»TCPåè®®çš„å®šä¹‰å’Œä¸¢åŒ…æ—¶çš„é‡ä¼ æœºåˆ¶ã€‚</li><li>ä¸‹ç¯‡ä¸­ï¼Œé‡ç‚¹ä»‹ç»TCPçš„æµè¿­ã€æ‹¥å¡å¤„ç†ã€‚</li></ul><p>ã€€ã€€åºŸè¯å°‘è¯´ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ TCP åœ¨ç½‘ç»œ OSI çš„ä¸ƒå±‚æ¨¡å‹ä¸­çš„ç¬¬å››å±‚ â€”â€” ä¼ è¾“å±‚(Transport)ï¼ŒIP åœ¨ç¬¬ä¸‰å±‚ â€”â€” ç½‘ç»œå±‚(Network)ï¼ŒARP åœ¨ç¬¬äºŒå±‚ â€”â€” æ•°æ®é“¾è·¯å±‚(Data Link)ï¼Œåœ¨ç¬¬äºŒå±‚ä¸Šçš„æ•°æ®ï¼Œæˆ‘ä»¬å« Frameï¼Œåœ¨ç¬¬ä¸‰å±‚ä¸Šçš„æ•°æ®å« Packetï¼Œç¬¬å››å±‚çš„æ•°æ®å« Segmentã€‚</p><p>ã€€ã€€é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œæˆ‘ä»¬ç¨‹åºçš„æ•°æ®é¦–å…ˆä¼šæ‰“åˆ° TCP çš„ Segment ä¸­ï¼Œç„¶å TCP çš„ Segment ä¼šæ‰“åˆ° IP çš„ Packet ä¸­ï¼Œç„¶åå†æ‰“åˆ°ä»¥å¤ªç½‘ Ethernet çš„ Frame ä¸­ï¼Œä¼ åˆ°å¯¹ç«¯åï¼Œå„ä¸ªå±‚è§£æè‡ªå·±çš„åè®®ï¼Œç„¶åæŠŠæ•°æ®äº¤ç»™æ›´é«˜å±‚çš„åè®®å¤„ç†ã€‚</p><h2 id="TCPå¤´æ ¼å¼"><a href="#TCPå¤´æ ¼å¼" class="headerlink" title="TCPå¤´æ ¼å¼"></a>TCPå¤´æ ¼å¼</h2><p>ã€€ã€€æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ TCP å¤´çš„æ ¼å¼</p><p><img src="TCP-Header-01.jpg" alt="TCP å¤´æ ¼å¼ 1"></p><center>TCP å¤´æ ¼å¼ 1ï¼ˆ<a href="http://nmap.org/book/tcpip-ref.html" target="_blank" rel="external">å›¾ç‰‡æ¥æº</a>ï¼‰</center><p>ã€€ã€€ä½ éœ€è¦æ³¨æ„è¿™ä¹ˆå‡ ç‚¹ï¼š</p><ul><li>TCP çš„åŒ…æ˜¯æ²¡æœ‰ IP åœ°å€çš„ï¼Œé‚£æ˜¯ IP å±‚ä¸Šçš„äº‹ã€‚ä½†æ˜¯æœ‰æºç«¯å£å’Œç›®æ ‡ç«¯å£ã€‚</li><li>ä¸€ä¸ª TCP è¿æ¥éœ€è¦å››ä¸ªå…ƒç»„æ¥è¡¨ç¤ºæ˜¯åŒä¸€ä¸ªè¿æ¥ï¼ˆ<code>src_ip</code>, <code>src_port</code>, <code>dst_ip</code>, <code>dst_port</code>ï¼‰å‡†ç¡®è¯´æ˜¯äº”å…ƒç»„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯åè®®ã€‚ä½†å› ä¸ºè¿™é‡Œåªæ˜¯è¯´TCPåè®®ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘åªè¯´å››å…ƒç»„ã€‚</li><li>æ³¨æ„ä¸Šå›¾ä¸­çš„å››ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿ï¼š<ul><li><strong><em>Sequence Number</em></strong> æ˜¯åŒ…çš„åºå·ï¼Œç”¨æ¥<strong>è§£å†³ç½‘ç»œåŒ…ä¹±åºï¼ˆreorderingï¼‰é—®é¢˜</strong>ã€‚</li><li><strong><em>Acknowledgement Number</em></strong> å°±æ˜¯ ACK â€”â€” ç”¨äºç¡®è®¤æ”¶åˆ°ï¼Œ<strong>ç”¨æ¥è§£å†³ä¸ä¸¢åŒ…çš„é—®é¢˜</strong>ã€‚</li><li><strong><em>Window</em></strong> åˆå« <strong><em>Advertised-Window</em></strong>ï¼Œä¹Ÿå°±æ˜¯è‘—åçš„æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰ï¼Œ<strong>ç”¨äºè§£å†³æµæ§çš„</strong>ã€‚</li><li><strong><em>TCP Flag</em></strong> ï¼Œä¹Ÿå°±æ˜¯åŒ…çš„ç±»å‹ï¼Œä¸»è¦æ˜¯<strong>ç”¨äºæ“æ§ TCP çš„çŠ¶æ€æœºçš„</strong>ã€‚</li></ul></li></ul><p>ã€€ã€€å…³äºå…¶å®ƒçš„ä¸œè¥¿ï¼Œå¯ä»¥å‚çœ‹ä¸‹é¢çš„å›¾ç¤º</p><p><img src="TCP-Header-02.jpg" alt="TCP å¤´æ ¼å¼ 2"></p><center>TCP å¤´æ ¼å¼ 2ï¼ˆ<a href="http://nmap.org/book/tcpip-ref.html" target="_blank" rel="external">å›¾ç‰‡æ¥æº</a>ï¼‰</center><h2 id="TCPçš„çŠ¶æ€æœº"><a href="#TCPçš„çŠ¶æ€æœº" class="headerlink" title="TCPçš„çŠ¶æ€æœº"></a>TCPçš„çŠ¶æ€æœº</h2><p>ã€€ã€€å…¶å®ï¼Œ<strong>ç½‘ç»œä¸Šçš„ä¼ è¾“æ˜¯æ²¡æœ‰è¿æ¥çš„ï¼ŒåŒ…æ‹¬ TCP ä¹Ÿæ˜¯ä¸€æ ·çš„</strong>ã€‚è€Œ TCP æ‰€è°“çš„â€œè¿æ¥â€ï¼Œå…¶å®åªä¸è¿‡æ˜¯åœ¨é€šè®¯çš„åŒæ–¹ç»´æŠ¤ä¸€ä¸ªâ€œè¿æ¥çŠ¶æ€â€ï¼Œè®©å®ƒçœ‹ä¸Šå»å¥½åƒæœ‰è¿æ¥ä¸€æ ·ã€‚æ‰€ä»¥ï¼ŒTCP çš„çŠ¶æ€å˜æ¢æ˜¯éå¸¸é‡è¦çš„ã€‚</p><p>ã€€ã€€ä¸‹é¢æ˜¯ï¼šâ€œ<strong>TCP åè®®çš„çŠ¶æ€æœº</strong>â€ï¼ˆ<a href="http://www.tcpipguide.com/free/t_TCPOperationalOverviewandtheTCPFiniteStateMachineF-2.htm" target="_blank" rel="external">å›¾ç‰‡æ¥æº</a>ï¼‰ å’Œ â€œ<strong>TCP å»ºé“¾æ¥</strong>â€ã€â€œ<strong>TCP æ–­é“¾æ¥</strong>â€ã€â€œ<strong>ä¼ æ•°æ®</strong>â€ çš„å¯¹ç…§å›¾ï¼Œæˆ‘æŠŠä¸¤ä¸ªå›¾å¹¶æ’æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·æ–¹ä¾¿åœ¨ä½ å¯¹ç…§ç€çœ‹ã€‚å¦å¤–ï¼Œä¸‹é¢è¿™ä¸¤ä¸ªå›¾éå¸¸éå¸¸çš„é‡è¦ï¼Œä½ ä¸€å®šè¦è®°ç‰¢ã€‚ï¼ˆåä¸ªæ§½ï¼šçœ‹åˆ°è¿™æ ·å¤æ‚çš„çŠ¶æ€æœºï¼Œå°±çŸ¥é“è¿™ä¸ªåè®®æœ‰å¤šå¤æ‚ï¼Œå¤æ‚çš„ä¸œè¥¿æ€»æ˜¯æœ‰å¾ˆå¤šå‘çˆ¹çš„äº‹æƒ…ï¼Œæ‰€ä»¥ TCP åè®®å…¶å®ä¹ŸæŒºå‘çˆ¹çš„ï¼‰</p><p><img src="tcpfsm.png" alt="TCP åè®®çš„çŠ¶æ€æœº"> <img src="tcp_open_close.jpg" alt="æ¡æ‰‹æ¬¡æ•°"></p><p>ã€€ã€€å¾ˆå¤šäººä¼šé—®ï¼Œä¸ºä»€ä¹ˆå»ºé“¾æ¥è¦ 3 æ¬¡æ¡æ‰‹ï¼Œæ–­é“¾æ¥éœ€è¦ 4 æ¬¡æŒ¥æ‰‹ï¼Ÿ</p><ul><li><strong>å¯¹äºå»ºé“¾æ¥çš„ 3 æ¬¡æ¡æ‰‹</strong>ï¼Œä¸»è¦æ˜¯è¦åˆå§‹åŒ– Sequence Number çš„åˆå§‹å€¼ã€‚é€šä¿¡çš„åŒæ–¹è¦äº’ç›¸é€šçŸ¥å¯¹æ–¹è‡ªå·±çš„åˆå§‹åŒ–çš„ Sequence Numberï¼ˆç¼©å†™ä¸º ISNï¼šInital Sequence Numberï¼‰ â€”â€” æ‰€ä»¥å« SYNï¼Œå…¨ç§° Synchronize Sequence Numbersã€‚ä¹Ÿå°±ä¸Šå›¾ä¸­çš„ x å’Œ yã€‚è¿™ä¸ªå·è¦ä½œä¸ºä»¥åçš„æ•°æ®é€šä¿¡çš„åºå·ï¼Œä»¥ä¿è¯åº”ç”¨å±‚æ¥æ”¶åˆ°çš„æ•°æ®ä¸ä¼šå› ä¸ºç½‘ç»œä¸Šçš„ä¼ è¾“çš„é—®é¢˜è€Œä¹±åºï¼ˆTCP ä¼šç”¨è¿™ä¸ªåºå·æ¥æ‹¼æ¥æ•°æ®ï¼‰ã€‚</li><li><strong>å¯¹äº 4 æ¬¡æŒ¥æ‰‹</strong>ï¼Œå…¶å®ä½ ä»”ç»†çœ‹æ˜¯ 2 æ¬¡ï¼Œå› ä¸º TCP æ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½éœ€è¦ Fin å’Œ Ackã€‚åªä¸è¿‡ï¼Œæœ‰ä¸€æ–¹æ˜¯è¢«åŠ¨çš„ï¼Œæ‰€ä»¥çœ‹ä¸Šå»å°±æˆäº†æ‰€è°“çš„ 4 æ¬¡æŒ¥æ‰‹ã€‚å¦‚æœä¸¤è¾¹åŒæ—¶æ–­è¿æ¥ï¼Œé‚£å°±ä¼šå°±è¿›å…¥åˆ° CLOSING çŠ¶æ€ï¼Œç„¶ååˆ°è¾¾T IME_WAIT çŠ¶æ€ã€‚ä¸‹å›¾æ˜¯åŒæ–¹åŒæ—¶æ–­è¿æ¥çš„ç¤ºæ„å›¾ï¼ˆä½ åŒæ ·å¯ä»¥å¯¹ç…§ç€ TCP çŠ¶æ€æœºçœ‹ï¼‰ï¼š</li></ul><p><img src="tcpclosesimul.png" alt="ä¸¤ç«¯åŒæ—¶æ–­å¼€é“¾æ¥"></p><center>ä¸¤ç«¯åŒæ—¶æ–­å¼€é“¾æ¥ï¼ˆ<a href="http://www.tcpipguide.com/free/t_TCPConnectionTermination-4.htm" target="_blank" rel="external">å›¾ç‰‡æ¥æº</a>ï¼‰</center><p>ã€€ã€€å¦å¤–ï¼Œæœ‰å‡ ä¸ªäº‹æƒ…éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼š</p><ul><li><strong>å…³äºå»ºè¿æ¥æ—¶ SYN è¶…æ—¶</strong>ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœ server ç«¯æ¥åˆ°äº† client å‘çš„ SYN åå›äº† SYN-ACK å client æ‰çº¿äº†ï¼Œserver ç«¯æ²¡æœ‰æ”¶åˆ° client å›æ¥çš„ ACKï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªè¿æ¥å¤„äºä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œå³æ²¡æˆåŠŸï¼Œä¹Ÿæ²¡å¤±è´¥ã€‚äºæ˜¯ï¼Œserver ç«¯å¦‚æœåœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°çš„ TCP ä¼šé‡å‘ SYN-ACKã€‚åœ¨ Linux ä¸‹ï¼Œé»˜è®¤é‡è¯•æ¬¡æ•°ä¸º 5 æ¬¡ï¼Œé‡è¯•çš„é—´éš”æ—¶é—´ä» 1s å¼€å§‹æ¯æ¬¡éƒ½ç¿»å”®ï¼Œ5 æ¬¡çš„é‡è¯•æ—¶é—´é—´éš”ä¸º 1s, 2s, 4s, 8s, 16sï¼Œæ€»å…± 31sï¼Œç¬¬ 5 æ¬¡å‘å‡ºåè¿˜è¦ç­‰ 32s éƒ½çŸ¥é“ç¬¬ 5 æ¬¡ä¹Ÿè¶…æ—¶äº†ï¼Œæ‰€ä»¥ï¼Œæ€»å…±éœ€è¦ 1s + 2s + 4s+ 8s+ 16s + 32s = 2^6 - 1 = 63sï¼ŒTCP æ‰ä¼šæŠŠæ–­å¼€è¿™ä¸ªè¿æ¥ã€‚</li><li><strong>å…³äº SYN Flood æ”»å‡»</strong>ã€‚ä¸€äº›æ¶æ„çš„äººå°±ä¸ºæ­¤åˆ¶é€ äº† SYN Flood æ”»å‡» â€”â€” ç»™æœåŠ¡å™¨å‘äº†ä¸€ä¸ª SYN åï¼Œå°±ä¸‹çº¿äº†ï¼Œäºæ˜¯æœåŠ¡å™¨éœ€è¦é»˜è®¤ç­‰ 63s æ‰ä¼šæ–­å¼€è¿æ¥ï¼Œè¿™æ ·ï¼Œæ”»å‡»è€…å°±å¯ä»¥æŠŠæœåŠ¡å™¨çš„ syn è¿æ¥çš„é˜Ÿåˆ—è€—å°½ï¼Œè®©æ­£å¸¸çš„è¿æ¥è¯·æ±‚ä¸èƒ½å¤„ç†ã€‚äºæ˜¯ï¼ŒLinux ä¸‹ç»™äº†ä¸€ä¸ªå« <code>tcp_syncookies</code> çš„å‚æ•°æ¥åº”å¯¹è¿™ä¸ªäº‹ â€”â€” å½“ SYN é˜Ÿåˆ—æ»¡äº†åï¼ŒTCP ä¼šé€šè¿‡æºåœ°å€ç«¯å£ã€ç›®æ ‡åœ°å€ç«¯å£å’Œæ—¶é—´æˆ³æ‰“é€ å‡ºä¸€ä¸ªç‰¹åˆ«çš„ Sequence Number å‘å›å»ï¼ˆåˆå« cookieï¼‰ï¼Œå¦‚æœæ˜¯æ”»å‡»è€…åˆ™ä¸ä¼šæœ‰å“åº”ï¼Œå¦‚æœæ˜¯æ­£å¸¸è¿æ¥ï¼Œåˆ™ä¼šæŠŠè¿™ä¸ª SYN Cookie å‘å›æ¥ï¼Œç„¶åæœåŠ¡ç«¯å¯ä»¥é€šè¿‡ cookie å»ºè¿æ¥ï¼ˆå³ä½¿ä½ ä¸åœ¨ SYN é˜Ÿåˆ—ä¸­ï¼‰ã€‚è¯·æ³¨æ„ï¼Œè¯·å…ˆåƒä¸‡åˆ«ç”¨ <code>tcp_syncookies</code> æ¥å¤„ç†æ­£å¸¸çš„å¤§è´Ÿè½½çš„è¿æ¥çš„æƒ…å†µã€‚å› ä¸ºï¼Œ<code>synccookies</code> æ˜¯å¦¥åç‰ˆçš„ TCP åè®®ï¼Œå¹¶ä¸ä¸¥è°¨ã€‚å¯¹äºæ­£å¸¸çš„è¯·æ±‚ï¼Œä½ åº”è¯¥è°ƒæ•´ä¸‰ä¸ª TCP å‚æ•°å¯ä¾›ä½ é€‰æ‹©ï¼Œç¬¬ä¸€ä¸ªæ˜¯ï¼š<code>tcp_synack_retries</code> å¯ä»¥ç”¨ä»–æ¥å‡å°‘é‡è¯•æ¬¡æ•°ï¼›ç¬¬äºŒä¸ªæ˜¯ï¼š<code>tcp_max_syn_backlog</code>ï¼Œå¯ä»¥å¢å¤§ SYN è¿æ¥æ•°ï¼›ç¬¬ä¸‰ä¸ªæ˜¯ï¼š<code>tcp_abort_on_overflow</code> å¤„ç†ä¸è¿‡æ¥å¹²è„†å°±ç›´æ¥æ‹’ç»è¿æ¥äº†ã€‚</li><li><strong>å…³äº ISN çš„åˆå§‹åŒ–</strong>ã€‚ISN æ˜¯ä¸èƒ½ hard code çš„ï¼Œä¸ç„¶ä¼šå‡ºé—®é¢˜çš„ â€”â€” æ¯”å¦‚ï¼šå¦‚æœè¿æ¥å»ºå¥½åå§‹ç»ˆç”¨ 1 æ¥åš ISNï¼Œå¦‚æœ client å‘äº† 30 ä¸ª segment è¿‡å»ï¼Œä½†æ˜¯ç½‘ç»œæ–­äº†ï¼Œäºæ˜¯ client é‡è¿ï¼Œåˆç”¨äº† 1 åš ISNï¼Œä½†æ˜¯ä¹‹å‰è¿æ¥çš„é‚£äº›åŒ…åˆ°äº†ï¼Œäºæ˜¯å°±è¢«å½“æˆäº†æ–°è¿æ¥çš„åŒ…ï¼Œæ­¤æ—¶ï¼Œclient çš„ Sequence Number å¯èƒ½æ˜¯ 3ï¼Œè€Œ Server ç«¯è®¤ä¸º client ç«¯çš„è¿™ä¸ªå·æ˜¯ 30 äº†ã€‚å…¨ä¹±äº†ã€‚RFC793 ä¸­è¯´ï¼ŒISN ä¼šå’Œä¸€ä¸ªå‡çš„æ—¶é’Ÿç»‘åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªæ—¶é’Ÿä¼šåœ¨æ¯4å¾®ç§’å¯¹ ISN åšåŠ ä¸€æ“ä½œï¼Œç›´åˆ°è¶…è¿‡ 2^32ï¼Œåˆä» 0 å¼€å§‹ã€‚è¿™æ ·ï¼Œä¸€ä¸ªISNçš„å‘¨æœŸå¤§çº¦æ˜¯ 4.55 ä¸ªå°æ—¶ã€‚å› ä¸ºï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬çš„ TCP Segment åœ¨ç½‘ç»œä¸Šçš„å­˜æ´»æ—¶é—´ä¸ä¼šè¶…è¿‡ Maximum Segment Lifetimeï¼ˆç¼©å†™ä¸º MSL - Wikipedia è¯­æ¡ï¼‰ï¼Œæ‰€ä»¥ï¼Œåªè¦ MSL çš„å€¼å°äº 4.55 å°æ—¶ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ä¸ä¼šé‡ç”¨åˆ° ISNã€‚</li><li><strong>å…³äº MSL å’Œ TIME_WAIT</strong>ã€‚é€šè¿‡ä¸Šé¢çš„ ISN çš„æè¿°ï¼Œç›¸ä¿¡ä½ ä¹ŸçŸ¥é“ MSL æ˜¯æ€ä¹ˆæ¥çš„äº†ã€‚æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œåœ¨ TCP çš„çŠ¶æ€å›¾ä¸­ï¼Œä» TIME_WAIT çŠ¶æ€åˆ° CLOSED çŠ¶æ€ï¼Œæœ‰ä¸€ä¸ªè¶…æ—¶è®¾ç½®ï¼Œè¿™ä¸ªè¶…æ—¶è®¾ç½®æ˜¯ 2 * MSLï¼ˆRFC793 å®šä¹‰äº† MSL ä¸º 2 åˆ†é’Ÿï¼ŒLinux è®¾ç½®æˆäº† 30sï¼‰ä¸ºä»€ä¹ˆè¦è¿™æœ‰ TIME_WAITï¼Ÿä¸ºä»€ä¹ˆä¸ç›´æ¥ç»™è½¬æˆ CLOSED çŠ¶æ€å‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š<ol><li>TIME_WAIT ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ—¶é—´è®©å¯¹ç«¯æ”¶åˆ°äº† ACKï¼Œå¦‚æœè¢«åŠ¨å…³é—­çš„é‚£æ–¹æ²¡æœ‰æ”¶åˆ° Ackï¼Œå°±ä¼šè§¦å‘è¢«åŠ¨ç«¯é‡å‘ Finï¼Œä¸€æ¥ä¸€å»æ­£å¥½ 2 ä¸ªMSLï¼›</li><li>æœ‰è¶³å¤Ÿçš„æ—¶é—´è®©è¿™ä¸ªè¿æ¥ä¸ä¼šè·Ÿåé¢çš„è¿æ¥æ··åœ¨ä¸€èµ·ï¼ˆä½ è¦çŸ¥é“ï¼Œæœ‰äº›è‡ªåšä¸»å¼ çš„è·¯ç”±å™¨ä¼šç¼“å­˜IPæ•°æ®åŒ…ï¼Œå¦‚æœè¿æ¥è¢«é‡ç”¨äº†ï¼Œé‚£ä¹ˆè¿™äº›å»¶è¿Ÿæ”¶åˆ°çš„åŒ…å°±æœ‰å¯èƒ½ä¼šè·Ÿæ–°è¿æ¥æ··åœ¨ä¸€èµ·ï¼‰ã€‚ä½ å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ã€Š<a href="http://www.serverframework.com/asynchronousevents/2011/01/time-wait-and-its-design-implications-for-protocols-and-scalable-servers.html" target="_blank" rel="external">TIME_WAIT and its design implications for protocols and scalable client server systems</a>ã€‹</li></ol></li><li><strong>å…³äº TIME_WAIT æ•°é‡å¤ªå¤š</strong>ã€‚ä»ä¸Šé¢çš„æè¿°æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒTIME_WAIT æ˜¯ä¸ªå¾ˆé‡è¦çš„çŠ¶æ€ï¼Œä½†æ˜¯å¦‚æœåœ¨å¤§å¹¶å‘çš„çŸ­é“¾æ¥ä¸‹ï¼ŒTIME_WAIT å°±ä¼šå¤ªå¤šï¼Œè¿™ä¹Ÿä¼šæ¶ˆè€—å¾ˆå¤šç³»ç»Ÿèµ„æºã€‚åªè¦æœä¸€ä¸‹ï¼Œä½ å°±ä¼šå‘ç°ï¼Œåæœ‰å…«ä¹çš„å¤„ç†æ–¹å¼éƒ½æ˜¯æ•™ä½ è®¾ç½®ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå« <code>tcp_tw_reuse</code>ï¼Œå¦ä¸€ä¸ªå« <code>tcp_tw_recycle</code> çš„å‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°é»˜è®¤å€¼éƒ½æ˜¯è¢«å…³é—­çš„ï¼Œåè€… recyle æ¯”å‰è€… resue æ›´ä¸ºæ¿€è¿›ï¼Œresue è¦æ¸©æŸ”ä¸€äº›ã€‚å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ <code>tcp_tw_reuse</code>ï¼Œå¿…éœ€è®¾ç½® <code>tcp_timestamps = 1</code>ï¼Œå¦åˆ™æ— æ•ˆã€‚è¿™é‡Œï¼Œä½ ä¸€å®šè¦æ³¨æ„ï¼Œ<strong>æ‰“å¼€è¿™ä¸¤ä¸ªå‚æ•°ä¼šæœ‰æ¯”è¾ƒå¤§çš„å‘ â€”â€” å¯èƒ½ä¼šè®© TCP è¿æ¥å‡ºä¸€äº›è¯¡å¼‚çš„é—®é¢˜</strong>ï¼ˆå› ä¸ºå¦‚ä¸Šè¿°ä¸€æ ·ï¼Œå¦‚æœä¸ç­‰å¾…è¶…æ—¶é‡ç”¨è¿æ¥çš„è¯ï¼Œæ–°çš„è¿æ¥å¯èƒ½ä¼šå»ºä¸ä¸Šã€‚æ­£å¦‚<a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ä¸Šè¯´çš„ä¸€æ ·â€œ<strong><em>It should not be changed without advice/request of technical experts</em></strong>â€ï¼‰ã€‚<ol><li><strong>å…³äº <code>tcp_tw_reuse</code></strong>ã€‚å®˜æ–¹æ–‡æ¡£ä¸Šè¯´ <code>tcp_tw_reuse</code> åŠ ä¸Š <code>tcp_timestamps</code>ï¼ˆåˆå« PAWS, for Protection Against Wrapped Sequence Numbersï¼‰å¯ä»¥ä¿è¯åè®®çš„è§’åº¦ä¸Šçš„å®‰å…¨ï¼Œä½†æ˜¯ä½ éœ€è¦ <code>tcp_timestamps</code> åœ¨ä¸¤è¾¹éƒ½è¢«æ‰“å¼€ï¼ˆä½ å¯ä»¥è¯»ä¸€ä¸‹ <code>tcp_twsk_unique</code> çš„æºç  ï¼‰ã€‚æˆ‘ä¸ªäººä¼°è®¡è¿˜æ˜¯æœ‰ä¸€äº›åœºæ™¯ä¼šæœ‰é—®é¢˜ã€‚</li><li><strong>å…³äº <code>tcp_tw_recycle</code></strong>ã€‚å¦‚æœæ˜¯ <code>tcp_tw_recycle</code> è¢«æ‰“å¼€äº†è¯ï¼Œä¼šå‡è®¾å¯¹ç«¯å¼€å¯äº† <code>tcp_timestamps</code>ï¼Œç„¶åä¼šå»æ¯”è¾ƒæ—¶é—´æˆ³ï¼Œå¦‚æœæ—¶é—´æˆ³å˜å¤§äº†ï¼Œå°±å¯ä»¥é‡ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¯¹ç«¯æ˜¯ä¸€ä¸ª NAT ç½‘ç»œçš„è¯ï¼ˆå¦‚ï¼šä¸€ä¸ªå…¬å¸åªç”¨ä¸€ä¸ª IP å‡ºå…¬ç½‘ï¼‰æˆ–æ˜¯å¯¹ç«¯çš„ IP è¢«å¦ä¸€å°é‡ç”¨äº†ï¼Œè¿™ä¸ªäº‹å°±å¤æ‚äº†ã€‚å»ºé“¾æ¥çš„ SYN å¯èƒ½å°±è¢«ç›´æ¥ä¸¢æ‰äº†ï¼ˆä½ å¯èƒ½ä¼šçœ‹åˆ° connection time out çš„é”™è¯¯ï¼‰ï¼ˆå¦‚æœä½ æƒ³è§‚æ‘©ä¸€ä¸‹ Linux çš„å†…æ ¸ä»£ç ï¼Œè¯·å‚çœ‹æºç  <code>tcp_timewait_state_process</code>ï¼‰ã€‚</li><li><strong>å…³äº <code>tcp_max_tw_buckets</code></strong>ã€‚è¿™ä¸ªæ˜¯æ§åˆ¶å¹¶å‘çš„ TIME_WAIT çš„æ•°é‡ï¼Œé»˜è®¤å€¼æ˜¯ 180000ï¼Œå¦‚æœè¶…é™ï¼Œé‚£ä¹ˆï¼Œç³»ç»Ÿä¼šæŠŠå¤šçš„ç»™ destory æ‰ï¼Œç„¶ååœ¨æ—¥å¿—é‡Œæ‰“ä¸€ä¸ªè­¦å‘Šï¼ˆå¦‚ï¼štime wait bucket table overflowï¼‰ï¼Œå®˜ç½‘æ–‡æ¡£è¯´è¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥å¯¹æŠ— DDoS æ”»å‡»çš„ã€‚ä¹Ÿè¯´çš„é»˜è®¤å€¼ 180000 å¹¶ä¸å°ã€‚è¿™ä¸ªè¿˜æ˜¯éœ€è¦æ ¹æ®å®é™…æƒ…å†µè€ƒè™‘ã€‚</li></ol></li></ul><blockquote><p>Againï¼Œä½¿ç”¨ <code>tcp_tw_reuse</code> å’Œ <code>tcp_tw_recycle</code> æ¥è§£å†³ TIME_WAIT çš„é—®é¢˜æ˜¯éå¸¸éå¸¸å±é™©çš„ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå‚æ•°è¿åäº†TCPåè®®ï¼ˆ<a href="http://tools.ietf.org/html/rfc1122" target="_blank" rel="external">RFC 1122</a>ï¼‰ ã€‚</p></blockquote><h2 id="æ•°æ®ä¼ è¾“ä¸­çš„-Sequence-Number"><a href="#æ•°æ®ä¼ è¾“ä¸­çš„-Sequence-Number" class="headerlink" title="æ•°æ®ä¼ è¾“ä¸­çš„ Sequence Number"></a>æ•°æ®ä¼ è¾“ä¸­çš„ Sequence Number</h2><p>ã€€ã€€ä¸‹å›¾æ˜¯æˆ‘ä» Wireshark ä¸­æˆªäº†ä¸ªæˆ‘åœ¨è®¿é—® coolshell.cn æ—¶çš„æœ‰æ•°æ®ä¼ è¾“çš„å›¾ç»™ä½ çœ‹ä¸€ä¸‹ï¼ŒSeqNum æ˜¯æ€ä¹ˆå˜çš„ã€‚ï¼ˆä½¿ç”¨ Wireshark èœå•ä¸­çš„ <code>Statistics -&gt; Flow Graphâ€¦</code>ï¼‰</p><p><img src="tcp_data_seq_num.jpg" alt="æ•°æ®ä¼ è¾“å›¾"></p><p>ã€€ã€€ä½ å¯ä»¥çœ‹åˆ°ï¼ŒSeqNum çš„å¢åŠ æ˜¯å’Œä¼ è¾“çš„å­—èŠ‚æ•°ç›¸å…³çš„ã€‚ä¸Šå›¾ä¸­ï¼Œä¸‰æ¬¡æ¡æ‰‹åï¼Œæ¥äº†ä¸¤ä¸ª Len:1440 çš„åŒ…ï¼Œè€Œç¬¬äºŒä¸ªåŒ…çš„ SeqNum å°±æˆäº† 1441ã€‚ç„¶åç¬¬ä¸€ä¸ª ACK å›çš„æ˜¯ 1441ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ª 1440 æ”¶åˆ°äº†ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½ ç”¨ Wireshark æŠ“åŒ…ç¨‹åºçœ‹ 3 æ¬¡æ¡æ‰‹ï¼Œä½ ä¼šå‘ç° SeqNum æ€»æ˜¯ä¸º0ï¼Œä¸æ˜¯è¿™æ ·çš„ï¼ŒWireshark ä¸ºäº†æ˜¾ç¤ºæ›´å‹å¥½ï¼Œä½¿ç”¨äº† Relative SeqNum â€”â€” ç›¸å¯¹åºå·ï¼Œä½ åªè¦åœ¨å³é”®èœå•ä¸­çš„ protocol preference ä¸­å–æ¶ˆæ‰å°±å¯ä»¥çœ‹åˆ°â€œAbsolute SeqNumâ€äº†ã€‚</p></blockquote><h2 id="TCPé‡ä¼ æœºåˆ¶"><a href="#TCPé‡ä¼ æœºåˆ¶" class="headerlink" title="TCPé‡ä¼ æœºåˆ¶"></a>TCPé‡ä¼ æœºåˆ¶</h2><p>ã€€ã€€TCP è¦ä¿è¯æ‰€æœ‰çš„æ•°æ®åŒ…éƒ½å¯ä»¥åˆ°è¾¾ï¼Œæ‰€ä»¥ï¼Œå¿…éœ€è¦æœ‰é‡ä¼ æœºåˆ¶ã€‚</p><p>ã€€ã€€æ³¨æ„ï¼Œæ¥æ”¶ç«¯ç»™å‘é€ç«¯çš„ Ack ç¡®è®¤åªä¼šç¡®è®¤æœ€åä¸€ä¸ªè¿ç»­çš„åŒ…ï¼Œæ¯”å¦‚ï¼Œå‘é€ç«¯å‘äº† 1,2,3,4,5 ä¸€å…±äº”ä»½æ•°æ®ï¼Œæ¥æ”¶ç«¯æ”¶åˆ°äº† 1ï¼Œ2ï¼Œäºæ˜¯å› ack 3ï¼Œç„¶åæ”¶åˆ°äº† 4ï¼ˆæ³¨æ„æ­¤æ—¶ 3 æ²¡æ”¶åˆ°ï¼‰ï¼Œæ­¤æ—¶çš„ TCP ä¼šæ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬è¦çŸ¥é“ï¼Œå› ä¸ºæ­£å¦‚å‰é¢æ‰€è¯´çš„ï¼ŒSeqNum å’Œ Ack æ˜¯ä»¥å­—èŠ‚æ•°ä¸ºå•ä½ï¼Œæ‰€ä»¥ ack çš„æ—¶å€™ï¼Œä¸èƒ½è·³ç€ç¡®è®¤ï¼Œåªèƒ½ç¡®è®¤æœ€å¤§çš„è¿ç»­æ”¶åˆ°çš„åŒ…ï¼Œä¸ç„¶ï¼Œå‘é€ç«¯å°±ä»¥ä¸ºä¹‹å‰çš„éƒ½æ”¶åˆ°äº†ã€‚</p><h3 id="è¶…æ—¶é‡ä¼ æœºåˆ¶"><a href="#è¶…æ—¶é‡ä¼ æœºåˆ¶" class="headerlink" title="è¶…æ—¶é‡ä¼ æœºåˆ¶"></a>è¶…æ—¶é‡ä¼ æœºåˆ¶</h3><p>ã€€ã€€ä¸€ç§æ˜¯ä¸å› ackï¼Œæ­»ç­‰ 3ï¼Œå½“å‘é€æ–¹å‘ç°æ”¶ä¸åˆ° 3 çš„ ack è¶…æ—¶åï¼Œä¼šé‡ä¼  3ã€‚ä¸€æ—¦æ¥æ”¶æ–¹æ”¶åˆ° 3 åï¼Œä¼š ack å› 4 â€”â€” æ„å‘³ç€ 3 å’Œ 4 éƒ½æ”¶åˆ°äº†ã€‚</p><p>ã€€ã€€ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼ä¼šæœ‰æ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å› ä¸ºè¦æ­»ç­‰ 3ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ 4 å’Œ 5 å³ä¾¿å·²ç»æ”¶åˆ°äº†ï¼Œè€Œå‘é€æ–¹ä¹Ÿå®Œå…¨ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Œå› ä¸ºæ²¡æœ‰æ”¶åˆ° Ackï¼Œæ‰€ä»¥ï¼Œå‘é€æ–¹å¯èƒ½ä¼šæ‚²è§‚åœ°è®¤ä¸ºä¹Ÿä¸¢äº†ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¹Ÿä¼šå¯¼è‡´ 4 å’Œ 5 çš„é‡ä¼ ã€‚</p><p>ã€€ã€€å¯¹æ­¤æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ul><li>ä¸€ç§æ˜¯ä»…é‡ä¼  timeout çš„åŒ…ã€‚ä¹Ÿå°±æ˜¯ç¬¬ 3 ä»½æ•°æ®ã€‚</li><li>å¦ä¸€ç§æ˜¯é‡ä¼  timeout åæ‰€æœ‰çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç¬¬ 3ï¼Œ4ï¼Œ5 è¿™ä¸‰ä»½æ•°æ®ã€‚</li></ul><p>ã€€ã€€è¿™ä¸¤ç§æ–¹å¼æœ‰å¥½ä¹Ÿæœ‰ä¸å¥½ã€‚ç¬¬ä¸€ç§ä¼šèŠ‚çœå¸¦å®½ï¼Œä½†æ˜¯æ…¢ï¼Œç¬¬äºŒç§ä¼šå¿«ä¸€ç‚¹ï¼Œä½†æ˜¯ä¼šæµªè´¹å¸¦å®½ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰æ— ç”¨åŠŸã€‚ä½†æ€»ä½“æ¥è¯´éƒ½ä¸å¥½ã€‚å› ä¸ºéƒ½åœ¨ç­‰ timeoutï¼Œtimeout å¯èƒ½ä¼šå¾ˆé•¿ï¼ˆåœ¨ä¸‹ç¯‡ä¼šè¯´ TCP æ˜¯æ€ä¹ˆåŠ¨æ€åœ°è®¡ç®—å‡º timeout çš„ï¼‰</p><h3 id="å¿«é€Ÿé‡ä¼ æœºåˆ¶"><a href="#å¿«é€Ÿé‡ä¼ æœºåˆ¶" class="headerlink" title="å¿«é€Ÿé‡ä¼ æœºåˆ¶"></a>å¿«é€Ÿé‡ä¼ æœºåˆ¶</h3><p>ã€€ã€€äºæ˜¯ï¼ŒTCP å¼•å…¥äº†ä¸€ç§å« <strong><em>Fast Retransmit</em></strong> çš„ç®—æ³•ï¼Œä¸ä»¥æ—¶é—´é©±åŠ¨ï¼Œè€Œä»¥æ•°æ®é©±åŠ¨é‡ä¼ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœï¼ŒåŒ…æ²¡æœ‰è¿ç»­åˆ°è¾¾ï¼Œå°± ack æœ€åé‚£ä¸ªå¯èƒ½è¢«ä¸¢äº†çš„åŒ…ï¼Œå¦‚æœå‘é€æ–¹è¿ç»­æ”¶åˆ° 3 æ¬¡ç›¸åŒçš„ ackï¼Œå°±é‡ä¼ ã€‚<strong><em>Fast Retransmit</em></strong> çš„å¥½å¤„æ˜¯ä¸ç”¨ç­‰ timeout äº†å†é‡ä¼ ã€‚</p><p>ã€€ã€€æ¯”å¦‚ï¼šå¦‚æœå‘é€æ–¹å‘å‡ºäº† 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5 ä»½æ•°æ®ï¼Œç¬¬ä¸€ä»½å…ˆåˆ°é€äº†ï¼Œäºæ˜¯å°± ack å› 2ï¼Œç»“æœ 2 å› ä¸ºæŸäº›åŸå› æ²¡æ”¶åˆ°ï¼Œ3 åˆ°è¾¾äº†ï¼Œäºæ˜¯è¿˜æ˜¯ ack å› 2ï¼Œåé¢çš„ 4 å’Œ 5 éƒ½åˆ°äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ ack å› 2ï¼Œå› ä¸º 2 è¿˜æ˜¯æ²¡æœ‰æ”¶åˆ°ï¼Œäºæ˜¯å‘é€ç«¯æ”¶åˆ°äº†ä¸‰ä¸ª ack = 2 çš„ç¡®è®¤ï¼ŒçŸ¥é“äº† 2 è¿˜æ²¡æœ‰åˆ°ï¼Œäºæ˜¯å°±é©¬ä¸Šé‡è½¬ 2ã€‚ç„¶åï¼Œæ¥æ”¶ç«¯æ”¶åˆ°äº† 2ï¼Œæ­¤æ—¶å› ä¸º 3ï¼Œ4ï¼Œ5 éƒ½æ”¶åˆ°äº†ï¼Œäºæ˜¯ ack å› 6ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="FASTIncast021.png" alt="å¿«é€Ÿé‡ä¼ "></p><p>ã€€ã€€Fast Retransmit åªè§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ timeout çš„é—®é¢˜ï¼Œå®ƒä¾ç„¶é¢ä¸´ä¸€ä¸ªè‰°éš¾çš„é€‰æ‹©ï¼Œå°±æ˜¯é‡è½¬ä¹‹å‰çš„ä¸€ä¸ªè¿˜æ˜¯é‡è£…æ‰€æœ‰çš„é—®é¢˜ã€‚å¯¹äºä¸Šé¢çš„ç¤ºä¾‹æ¥è¯´ï¼Œæ˜¯é‡ä¼  #2 å‘¢è¿˜æ˜¯é‡ä¼  #2ï¼Œ#3ï¼Œ#4ï¼Œ#5 å‘¢ï¼Ÿå› ä¸ºå‘é€ç«¯å¹¶ä¸æ¸…æ¥šè¿™è¿ç»­çš„ 3 ä¸ª ack(2) æ˜¯è°ä¼ å›æ¥çš„ï¼Ÿä¹Ÿè®¸å‘é€ç«¯å‘äº† 20 ä»½æ•°æ®ï¼Œæ˜¯ #6ï¼Œ#10ï¼Œ#20 ä¼ æ¥çš„å‘¢ã€‚è¿™æ ·ï¼Œå‘é€ç«¯å¾ˆæœ‰å¯èƒ½è¦é‡ä¼ ä» 2 åˆ° 20 çš„è¿™å †æ•°æ®ï¼ˆè¿™å°±æ˜¯æŸäº› TCP çš„å®é™…çš„å®ç°ï¼‰ã€‚å¯è§ï¼Œè¿™æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚</p><h3 id="SACK-æ–¹æ³•"><a href="#SACK-æ–¹æ³•" class="headerlink" title="SACK æ–¹æ³•"></a>SACK æ–¹æ³•</h3><p>ã€€ã€€å¦å¤–ä¸€ç§æ›´å¥½çš„æ–¹å¼å«ï¼š<strong>Selective Acknowledgment (SACK)</strong>ï¼ˆå‚çœ‹ <a href="http://tools.ietf.org/html/rfc2018" target="_blank" rel="external">RFC 2018</a>ï¼‰ï¼Œè¿™ç§æ–¹å¼éœ€è¦åœ¨ TCP å¤´é‡ŒåŠ ä¸€ä¸ª SACK çš„ä¸œè¥¿ï¼ŒACK è¿˜æ˜¯ Fast Retransmit çš„ ACKï¼ŒSACK åˆ™æ˜¯æ±‡æŠ¥æ”¶åˆ°çš„æ•°æ®ç¢ç‰ˆã€‚å‚çœ‹ä¸‹å›¾ï¼š</p><p><img src="tcp_sack_example-1024x577.jpg" alt="SACKæ–¹æ³•"></p><p>ã€€ã€€è¿™æ ·ï¼Œåœ¨å‘é€ç«¯å°±å¯ä»¥æ ¹æ®å›ä¼ çš„ SACK æ¥çŸ¥é“å“ªäº›æ•°æ®åˆ°äº†ï¼Œå“ªäº›æ²¡æœ‰åˆ°ã€‚äºæ˜¯å°±ä¼˜åŒ–äº† Fast Retransmit çš„ç®—æ³•ã€‚å½“ç„¶ï¼Œè¿™ä¸ªåè®®éœ€è¦ä¸¤è¾¹éƒ½æ”¯æŒã€‚åœ¨ Linux ä¸‹ï¼Œå¯ä»¥é€šè¿‡ <code>tcp_sack</code> å‚æ•°æ‰“å¼€è¿™ä¸ªåŠŸèƒ½ï¼ˆLinux 2.4 åé»˜è®¤æ‰“å¼€ï¼‰ã€‚</p><p>ã€€ã€€è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ â€”â€” æ¥æ”¶æ–¹ Renegingï¼Œæ‰€è°“ Reneging çš„æ„æ€å°±æ˜¯æ¥æ”¶æ–¹æœ‰æƒæŠŠå·²ç»æŠ¥ç»™å‘é€ç«¯ SACK é‡Œçš„æ•°æ®ç»™ä¸¢äº†ã€‚è¿™æ ·å¹²æ˜¯ä¸è¢«é¼“åŠ±çš„ï¼Œå› ä¸ºè¿™ä¸ªäº‹ä¼šæŠŠé—®é¢˜å¤æ‚åŒ–äº†ï¼Œä½†æ˜¯ï¼Œæ¥æ”¶æ–¹è¿™ä¹ˆåšå¯èƒ½ä¼šæœ‰äº›æç«¯æƒ…å†µï¼Œæ¯”å¦‚è¦æŠŠå†…å­˜ç»™åˆ«çš„æ›´é‡è¦çš„ä¸œè¥¿ã€‚æ‰€ä»¥ï¼Œå‘é€æ–¹ä¹Ÿä¸èƒ½å®Œå…¨ä¾èµ– SACKï¼Œè¿˜æ˜¯è¦ä¾èµ– ACKï¼Œå¹¶ç»´æŠ¤ Time-Outï¼Œå¦‚æœåç»­çš„ ACK æ²¡æœ‰å¢é•¿ï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦æŠŠ SACK çš„ä¸œè¥¿é‡ä¼ ï¼Œå¦å¤–ï¼Œæ¥æ”¶ç«¯è¿™è¾¹æ°¸è¿œä¸èƒ½æŠŠ SACK çš„åŒ…æ ‡è®°ä¸º Ackã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼šSACK ä¼šæ¶ˆè´¹å‘é€æ–¹çš„èµ„æºï¼Œè¯•æƒ³ï¼Œå¦‚æœä¸€ä¸ªæ”»å‡»è€…ç»™æ•°æ®å‘é€æ–¹å‘ä¸€å † SACK çš„é€‰é¡¹ï¼Œè¿™ä¼šå¯¼è‡´å‘é€æ–¹å¼€å§‹è¦é‡ä¼ ç”šè‡³éå†å·²ç»å‘å‡ºçš„æ•°æ®ï¼Œè¿™ä¼šæ¶ˆè€—å¾ˆå¤šå‘é€ç«¯çš„èµ„æºã€‚è¯¦ç»†çš„ä¸œè¥¿è¯·å‚çœ‹ã€Š<a href="http://www.ibm.com/developerworks/cn/linux/l-tcp-sack/" target="_blank" rel="external">TCP SACKçš„æ€§èƒ½æƒè¡¡</a>ã€‹</p></blockquote><h3 id="Duplicate-SACK-â€“-é‡å¤æ”¶åˆ°æ•°æ®çš„é—®é¢˜"><a href="#Duplicate-SACK-â€“-é‡å¤æ”¶åˆ°æ•°æ®çš„é—®é¢˜" class="headerlink" title="Duplicate SACK â€“ é‡å¤æ”¶åˆ°æ•°æ®çš„é—®é¢˜"></a>Duplicate SACK â€“ é‡å¤æ”¶åˆ°æ•°æ®çš„é—®é¢˜</h3><p>ã€€ã€€Duplicate SACK åˆç§° D-SACKï¼Œå…¶ä¸»è¦ä½¿ç”¨äº† SACK æ¥å‘Šè¯‰å‘é€æ–¹æœ‰å“ªäº›æ•°æ®è¢«é‡å¤æ¥æ”¶äº†ã€‚<a href="http://www.ietf.org/rfc/rfc2883.txt" target="_blank" rel="external">RFC-2833</a> é‡Œæœ‰è¯¦ç»†æè¿°å’Œç¤ºä¾‹ã€‚ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­ï¼ˆæ¥æºäº <a href="http://www.ietf.org/rfc/rfc2883.txt" target="_blank" rel="external">RFC-2833</a>ï¼‰</p><p>ã€€ã€€D-SACKä½¿ç”¨äº†SACKçš„ç¬¬ä¸€ä¸ªæ®µæ¥åšæ ‡å¿—ï¼Œ</p><ul><li>å¦‚æœ SACK çš„ç¬¬ä¸€ä¸ªæ®µçš„èŒƒå›´è¢« ACK æ‰€è¦†ç›–ï¼Œé‚£ä¹ˆå°±æ˜¯ D-SACK</li><li>å¦‚æœ SACK çš„ç¬¬ä¸€ä¸ªæ®µçš„èŒƒå›´è¢« SACK çš„ç¬¬äºŒä¸ªæ®µè¦†ç›–ï¼Œé‚£ä¹ˆå°±æ˜¯ D-SACK</li></ul><h4 id="ç¤ºä¾‹ä¸€ï¼šACK-ä¸¢åŒ…"><a href="#ç¤ºä¾‹ä¸€ï¼šACK-ä¸¢åŒ…" class="headerlink" title="ç¤ºä¾‹ä¸€ï¼šACK ä¸¢åŒ…"></a>ç¤ºä¾‹ä¸€ï¼šACK ä¸¢åŒ…</h4><p>ã€€ã€€ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸¢äº†ä¸¤ä¸ª ACKï¼Œæ‰€ä»¥ï¼Œå‘é€ç«¯é‡ä¼ äº†ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼ˆ3000 - 3499ï¼‰ï¼Œäºæ˜¯æ¥æ”¶ç«¯å‘ç°é‡å¤æ”¶åˆ°ï¼Œäºæ˜¯å›äº†ä¸€ä¸ª SACK = 3000 - 3500ï¼Œå› ä¸º ACK éƒ½åˆ°äº† 4000 æ„å‘³ç€æ”¶åˆ°äº† 4000 ä¹‹å‰çš„æ‰€æœ‰æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ª SACK å°±æ˜¯ D-SACK â€”â€” æ—¨åœ¨å‘Šè¯‰å‘é€ç«¯æˆ‘æ”¶åˆ°äº†é‡å¤çš„æ•°æ®ï¼Œè€Œä¸”æˆ‘ä»¬çš„å‘é€ç«¯è¿˜çŸ¥é“ï¼Œæ•°æ®åŒ…æ²¡æœ‰ä¸¢ï¼Œä¸¢çš„æ˜¯ ACK åŒ…ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Transmitted  Received    ACK Sent</span><br><span class="line">Segment      Segment     (Including SACK Blocks)</span><br><span class="line"></span><br><span class="line">3000-3499    3000-3499   3500 (ACK dropped)</span><br><span class="line">3500-3999    3500-3999   4000 (ACK dropped)</span><br><span class="line">3000-3499    3000-3499   4000, SACK=3000-3500</span><br><span class="line">                                    ---------</span><br></pre></td></tr></table></figure><h4 id="ç¤ºä¾‹äºŒï¼šç½‘ç»œå»¶è¯¯"><a href="#ç¤ºä¾‹äºŒï¼šç½‘ç»œå»¶è¯¯" class="headerlink" title="ç¤ºä¾‹äºŒï¼šç½‘ç»œå»¶è¯¯"></a>ç¤ºä¾‹äºŒï¼šç½‘ç»œå»¶è¯¯</h4><p>ã€€ã€€ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œç½‘ç»œåŒ…ï¼ˆ1000 - 1499ï¼‰è¢«ç½‘ç»œç»™å»¶è¯¯äº†ï¼Œå¯¼è‡´å‘é€æ–¹æ²¡æœ‰æ”¶åˆ° ACKï¼Œè€Œåé¢åˆ°è¾¾çš„ä¸‰ä¸ªåŒ…è§¦å‘äº†â€œFast Retransmit ç®—æ³•â€ï¼Œæ‰€ä»¥é‡ä¼ ï¼Œä½†é‡ä¼ æ—¶ï¼Œè¢«å»¶è¯¯çš„åŒ…åˆåˆ°äº†ï¼Œæ‰€ä»¥ï¼Œå›äº†ä¸€ä¸ª SACK = 1000 - 1500ï¼Œå› ä¸º ACK å·²åˆ°äº† 3000ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ª SACK æ˜¯ D-SACK â€”â€” æ ‡è¯†æ”¶åˆ°äº†é‡å¤çš„åŒ…ã€‚</p><p>ã€€ã€€è¿™ä¸ªæ¡ˆä¾‹ä¸‹ï¼Œå‘é€ç«¯çŸ¥é“ä¹‹å‰å› ä¸ºâ€œFast Retransmit ç®—æ³•â€è§¦å‘çš„é‡ä¼ ä¸æ˜¯å› ä¸ºå‘å‡ºå»çš„åŒ…ä¸¢äº†ï¼Œä¹Ÿä¸æ˜¯å› ä¸ºå›åº”çš„ ACK åŒ…ä¸¢äº†ï¼Œè€Œæ˜¯å› ä¸ºç½‘ç»œå»¶æ—¶äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Transmitted    Received    ACK Sent</span><br><span class="line">Segment        Segment     (Including SACK Blocks)</span><br><span class="line"> </span><br><span class="line">500-999        500-999     1000</span><br><span class="line">1000-1499      (delayed)</span><br><span class="line">1500-1999      1500-1999   1000, SACK=1500-2000</span><br><span class="line">2000-2499      2000-2499   1000, SACK=1500-2500</span><br><span class="line">2500-2999      2500-2999   1000, SACK=1500-3000</span><br><span class="line">1000-1499      1000-1499   3000</span><br><span class="line">               1000-1499   3000, SACK=1000-1500</span><br><span class="line">                                      ---------</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¯è§ï¼Œå¼•å…¥äº† D-SACKï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªå¥½å¤„ï¼š</p><ol><li>å¯ä»¥è®©å‘é€æ–¹çŸ¥é“ï¼Œæ˜¯å‘å‡ºå»çš„åŒ…ä¸¢äº†ï¼Œè¿˜æ˜¯å›æ¥çš„ ACK åŒ…ä¸¢äº†ã€‚</li><li>æ˜¯ä¸æ˜¯è‡ªå·±çš„ timeout å¤ªå°äº†ï¼Œå¯¼è‡´é‡ä¼ ã€‚</li><li>ç½‘ç»œä¸Šå‡ºç°äº†å…ˆå‘çš„åŒ…ååˆ°çš„æƒ…å†µï¼ˆåˆç§° reorderingï¼‰</li><li>ç½‘ç»œä¸Šæ˜¯ä¸æ˜¯æŠŠæˆ‘çš„æ•°æ®åŒ…ç»™å¤åˆ¶äº†ã€‚</li></ol><p>ã€€ã€€<strong>çŸ¥é“è¿™äº›ä¸œè¥¿å¯ä»¥å¾ˆå¥½å¾—å¸®åŠ©TCPäº†è§£ç½‘ç»œæƒ…å†µï¼Œä»è€Œå¯ä»¥æ›´å¥½çš„åšç½‘ç»œä¸Šçš„æµæ§ã€‚</strong></p><p>ã€€ã€€Linux ä¸‹çš„ <code>tcp_dsack</code> å‚æ•°ç”¨äºå¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼ˆLinux 2.4 åé»˜è®¤æ‰“å¼€ï¼‰</p><p>ã€€ã€€å¥½äº†ï¼Œä¸Šç¯‡å°±åˆ°è¿™é‡Œç»“æŸäº†ã€‚å¦‚æœä½ è§‰å¾—æˆ‘å†™å¾—è¿˜æ¯”è¾ƒæµ…æ˜¾æ˜“æ‡‚ï¼Œé‚£ä¹ˆï¼Œæ¬¢è¿ç§»æ­¥çœ‹ä¸‹ç¯‡ã€Š<a href="http://coolshell.cn/articles/11609.html" target="_blank" rel="external">TCPçš„é‚£äº›äº‹ï¼ˆä¸‹ï¼‰</a>ã€‹</p><p>ã€€ã€€[åŸæ–‡é“¾æ¥ï¼š<a href="http://coolshell.cn/articles/11564.html" target="_blank" rel="external">http://coolshell.cn/articles/11564.html</a>]</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€TCPæ˜¯ä¸€ä¸ªå·¨å¤æ‚çš„åè®®ï¼Œå› ä¸ºä»–è¦è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œè€Œè¿™äº›é—®é¢˜åˆå¸¦å‡ºäº†å¾ˆå¤šå­é—®é¢˜å’Œé˜´æš—é¢ã€‚æ‰€ä»¥å­¦ä¹  TCP æœ¬èº«æ˜¯ä¸ªæ¯”è¾ƒç—›è‹¦çš„è¿‡ç¨‹ï¼Œä½†å¯¹äºå­¦ä¹ çš„è¿‡ç¨‹å´èƒ½è®©äººæœ‰å¾ˆå¤šæ”¶è·ã€‚å…³äº TCP è¿™ä¸ªåè®®çš„ç»†èŠ‚ï¼Œæˆ‘è¿˜æ˜¯æ¨èä½ å»çœ‹ &lt;a href=&quot;http://www.kohala.co
      
    
    </summary>
    
    
      <category term="TCP" scheme="https://xcoder.in/tags/TCP/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—çš„ module</title>
    <link href="https://xcoder.in/2014/06/03/scartlet-task/"/>
    <id>https://xcoder.in/2014/06/03/scartlet-task/</id>
    <published>2014-06-02T16:17:38.000Z</published>
    <updated>2017-12-11T07:59:20.541Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€äº‹æƒ…å¾ˆæ›²æŠ˜ï¼Œæˆ‘æŸå¤©åœ¨èŒå¦æ”¶éŸ³æœºé‡Œé¢å¬åˆ°äº†ä¸€é¦–æ­Œï¼Œå¾ˆå¥½å¬ï¼Œå« <code>hypnotized</code>ï¼Œäºæ˜¯çº¢å¿ƒäº†ã€‚</p><p>ã€€ã€€è¿‡äº†å‡ å¤©æˆ‘å†å»å¬â€”â€”å‘ç°è¿™é¦–æ­Œå˜äº†ã€‚</p><p>ã€€ã€€æœ€åç»è¿‡å¤šæ–¹é¢æ±‚è¯ï¼Œæˆ‘å¤§æ¦‚å¾—å‡ºç»“æœå°±æ˜¯åº”è¯¥æœ‰äººä¼ é”™äº†æ­Œï¼Œç„¶ååæ¥æœ‰äººé‡æ–°ä¼ äº†ä¸€éï¼Œå¯¼è‡´æˆ‘å¬çš„ä¸æ˜¯åŸæ¥é‚£é¦–æ­Œäº†ã€‚é‚£æˆ‘é‚£å¤©å¬çš„é‚£é¦–æ­Œåˆ°åº•å«ä»€ä¹ˆåå­—å‘¢ï¼Ÿ</p><p>ã€€ã€€ç„¶åå¤§è‡´çœ‹äº†ä¸€ä¸‹ï¼Œè™½ç„¶æ­Œè¢«é‡æ–°ä¼ äº†ï¼Œä½†æ˜¯<a href="http://moe.fm/music/9600" target="_blank" rel="external">è¿™é‡Œ</a>æ˜¾ç¤ºçš„è¿™é¦–æ­Œçš„æ—¶é—´æ²¡å˜ï¼è¿˜æ˜¯11åˆ†é’Ÿï¼Œç›®æµ‹æ˜¯æ•°æ®åº“æ²¡æ›´æ–°ã€‚</p><p>ã€€ã€€äºæ˜¯æˆ‘å°±æƒ³äº†ä¸ªç¬¨åŠæ³•ï¼Œå»çˆ¬æ”¶éŸ³æœºé‡Œé¢æ‰€æœ‰ tag ä¸º <code>ä¸œæ–¹project</code> çš„ä¸“è¾‘ï¼Œç„¶åè·‘åˆ°ä¸“è¾‘é¡µçœ‹æ­Œæ›²çš„é•¿åº¦ã€‚</p><p>ã€€ã€€é—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘ç›´æ¥çˆ¬ï¼Œç„¶åçˆ¬å®Œ <code>callback</code> ä¹‹ååˆç›´æ¥çˆ¬ï¼Œæ²¡æœ‰ä»»ä½•é—´éš”ï¼Œå°±ç›¸å½“äºæˆ‘åœ¨ <code>DDOS</code> å®ƒçš„ç«™å­ã€‚æˆ–è€…å³ä½¿æ²¡é‚£ä¹ˆä¸¥é‡â€”â€”åæ­£æœ€ååˆ°ä¸€å®šç¨‹åº¦å¹¶å‘å¤ªå¤§æˆ‘å°±è®¿é—®ä¸äº†äº†ã€‚</p><p>ã€€ã€€äºæ˜¯æˆ‘å°±æƒ³åˆ°äº†åšä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—çš„ moduleã€‚è¯¥ module çš„ä½œç”¨å°±æ˜¯æŠŠä¸€å †ä»»åŠ¡æ‰”åˆ°é˜Ÿåˆ—ä¸­ï¼Œå®Œæˆä¸€ä¸ªæ‰å¼€å§‹ä¸‹ä¸€ä¸ªã€‚</p><p>ã€€ã€€ç„¶åå¦‚æœåŒæ—¶æ‰§è¡Œä¸€ä¸ªä¹Ÿå¤ªæ…¢ï¼Œmodule è¿˜å…è®¸ä½ å¼€å¤šå‡ ä¸ªå­é˜Ÿåˆ—åŒæ—¶æ‰§è¡Œã€‚</p><p>ã€€ã€€æ¨¡å—çš„ repo åœ¨ <a href="https://github.com/XadillaX/scarlet-task" target="_blank" rel="external">GitHub</a> ä¸Šé¢ã€‚åå­—å« <code>Scarlet Task</code> çš„åŸå› ä¸€æ˜¯æˆ‘æœ¬èº«å°±å–œæ¬¢äºŒå°å§ï¼ŒäºŒæ˜¯ä¸ºäº†çºªå¿µè¿™æ¬¡äº‹ä»¶æˆ‘æ˜¯ä¸ºäº†æ‰¾æœ‰å…³äºŒå°å§çš„æ­Œã€‚</p><p>ã€€ã€€è¦å®‰è£…ä¹Ÿå¾ˆç®€å•ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$ npm install scarlet-task</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶å repo çš„ <code>README.md</code> é‡Œé¢æœ‰ä½¿ç”¨æ–¹æ³•çš„â€”â€”å¤§è‡´å°±æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åå®šä¹‰å¥½æŸä¸ªä»»åŠ¡çš„ä»»åŠ¡æ ‡è¯†ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ˜¯ json å¯¹è±¡ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„æ•°æ®ï¼‰ï¼Œç„¶åå†å®šä¹‰å¥½å¤„ç†è¿™ä¸ªä»»åŠ¡çš„å‡½æ•°ï¼Œå°†è¿™ä¸ªæ•°æ®æ¨å€’é˜Ÿåˆ—ä¸­å³å¯ã€‚ç„¶ååœ¨å¤„ç†å‡½æ•°ä¸­ä»»åŠ¡å¤„ç†å®Œçš„æ—¶å€™æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡å®Œæˆçš„å‡½æ•°å³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€äº‹æƒ…å¾ˆæ›²æŠ˜ï¼Œæˆ‘æŸå¤©åœ¨èŒå¦æ”¶éŸ³æœºé‡Œé¢å¬åˆ°äº†ä¸€é¦–æ­Œï¼Œå¾ˆå¥½å¬ï¼Œå« &lt;code&gt;hypnotized&lt;/code&gt;ï¼Œäºæ˜¯çº¢å¿ƒäº†ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€è¿‡äº†å‡ å¤©æˆ‘å†å»å¬â€”â€”å‘ç°è¿™é¦–æ­Œå˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€æœ€åç»è¿‡å¤šæ–¹é¢æ±‚è¯ï¼Œæˆ‘å¤§æ¦‚å¾—å‡ºç»“æœå°±æ˜¯åº”è¯¥æœ‰äººä¼ é”™äº†æ­Œï¼Œç„¶ååæ¥æœ‰äººé‡æ–°ä¼ 
      
    
    </summary>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="ä»»åŠ¡é˜Ÿåˆ—" scheme="https://xcoder.in/tags/%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>æ­å»º VIM ä¸‹çš„ Hexo ç¼–è¾‘ç¯å¢ƒ</title>
    <link href="https://xcoder.in/2014/06/02/vim-hexo-environment/"/>
    <id>https://xcoder.in/2014/06/02/vim-hexo-environment/</id>
    <published>2014-06-01T20:52:30.000Z</published>
    <updated>2017-12-11T07:59:20.548Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€æœ¬æ–‡åªè®²ä¸¤ä¸ªå‡½æ•°ï¼Œå¯¹äº <code>markdown</code> å¦‚ä½•é«˜äº®ä¹‹ç±»çš„é—®é¢˜è¿˜è¯·è‡ªè¡Œè°·æ­Œã€‚</p><p>ã€€ã€€ç„¶åè¯·æ‰“å¼€ä½ è‡ªå·±çš„ <code>.vimrc</code> æ–‡ä»¶ã€‚</p><h2 id="é¢„å¤‡å·¥ä½œ"><a href="#é¢„å¤‡å·¥ä½œ" class="headerlink" title="é¢„å¤‡å·¥ä½œ"></a>é¢„å¤‡å·¥ä½œ</h2><p>ã€€ã€€é¦–å…ˆå®šä¹‰ä¸€ä¸ªå˜é‡â€”â€”ä½ è‡ªå·±çš„ <code>hexo</code> ç›®å½•ï¼Œå¦‚æœè¦è·¨å¹³å°å¯ä»¥åšä¸ªåˆ¤æ–­ä¹‹ç±»çš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if has(&quot;win32&quot;)</span><br><span class="line">    let g:hexoProjectPath=&quot;E:\\cygwin\\home\\XadillaX\\hexo&quot;</span><br><span class="line">else</span><br><span class="line">    let g:hexoProjectPath=&quot;~/hexo/&quot;</span><br><span class="line">endif</span><br></pre></td></tr></table></figure><h2 id="å‡ ä¸ªå‡½æ•°"><a href="#å‡ ä¸ªå‡½æ•°" class="headerlink" title="å‡ ä¸ªå‡½æ•°"></a>å‡ ä¸ªå‡½æ•°</h2><h3 id="è¿›å…¥-Hexo-ç›®å½•"><a href="#è¿›å…¥-Hexo-ç›®å½•" class="headerlink" title="è¿›å…¥ Hexo ç›®å½•"></a>è¿›å…¥ Hexo ç›®å½•</h3><p>ã€€ã€€è¿™ä¸ªå‡½æ•°å¤§è‡´å°±æ˜¯è®©ä½ è¿›å…¥ä½ è‡ªå·±çš„ <code>Hexo</code> è·¯å¾„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fun! OpenHexoProjPath()</span><br><span class="line">    execute &quot;cd &quot; . g:hexoProjectPath</span><br><span class="line">endfun</span><br></pre></td></tr></table></figure><h3 id="æ‰“å¼€ä¸€ç¯‡-Post"><a href="#æ‰“å¼€ä¸€ç¯‡-Post" class="headerlink" title="æ‰“å¼€ä¸€ç¯‡ Post"></a>æ‰“å¼€ä¸€ç¯‡ Post</h3><p>ã€€ã€€æ¥ä¸‹å»å°±æ˜¯ä¸€ä¸ªæ‰“å¼€ <code>Post</code> çš„å‡½æ•°äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function! OpenHexoPost(...)</span><br><span class="line">    call OpenHexoProjPath()</span><br><span class="line"></span><br><span class="line">    let filename = &quot;source/_posts/&quot; . a:1 . &quot;.md&quot;</span><br><span class="line">    execute &quot;e &quot; . filename</span><br><span class="line">endfunction</span><br></pre></td></tr></table></figure><blockquote><p>è§£æï¼šä¸Šé¢çš„ä»£ç å¤§æ„å°±æ˜¯è¿›å…¥ Hexo è·¯å¾„ï¼Œç„¶åè®¾å®šå¥½æ–‡ä»¶åï¼Œæœ€åæ‰§è¡Œ <code>:e filename</code> å³å¯æ‰“å¼€æ–‡ä»¶äº†ã€‚</p></blockquote><h3 id="æ–°å»ºä¸€ç¯‡-Post"><a href="#æ–°å»ºä¸€ç¯‡-Post" class="headerlink" title="æ–°å»ºä¸€ç¯‡ Post"></a>æ–°å»ºä¸€ç¯‡ Post</h3><p>ã€€ã€€æ–°å»ºçš„æµç¨‹è·Ÿæ‰“å¼€ç›¸ä¼¼ï¼Œåªä¸è¿‡é¦–å…ˆè¦åœ¨ <code>Hexo</code> ç›®å½•ä¸‹æ‰§è¡Œä¸€é <code>hexo new FOO</code> çš„å‘½ä»¤è€Œå·²ï¼Œå‘½ä»¤æ‰§è¡Œå®Œæ¯•ä¹‹åå†æ‰“å¼€å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function! NewHexoPost(...)</span><br><span class="line">    call OpenHexoProjPath()</span><br><span class="line"></span><br><span class="line">    let filename = a:1</span><br><span class="line">    execute &quot;!hexo new &quot; . filename</span><br><span class="line"></span><br><span class="line">    call OpenHexoPost(a:1)</span><br><span class="line">endfunction</span><br></pre></td></tr></table></figure><h2 id="æŒ‡ä»¤æ˜ å°„"><a href="#æŒ‡ä»¤æ˜ å°„" class="headerlink" title="æŒ‡ä»¤æ˜ å°„"></a>æŒ‡ä»¤æ˜ å°„</h2><p>ã€€ã€€å‡½æ•°å†™å¥½åæˆ‘ä»¬æœ€åæŠŠå‡½æ•°æ˜ å°„æˆç±»ä¼¼äº <code>:e</code>, <code>:w</code> ä¹‹ç±»çš„åé¢èƒ½è·Ÿç€å‚æ•°çš„æŒ‡ä»¤å³å¯ã€‚</p><p>ã€€ã€€ä»¥å‰æœ¨æœ‰æ¥è§¦è¿‡çš„åŒå­¦å¯ä»¥å‚è€ƒä¸€ä¸‹<a href="http://vimdoc.sourceforge.net/htmldoc/usr_40.html#40.2" target="_blank" rel="external">è¿™é‡Œ</a>çš„æ–‡æ¡£ã€‚</p><h3 id="æ‰“å¼€æŒ‡ä»¤"><a href="#æ‰“å¼€æŒ‡ä»¤" class="headerlink" title="æ‰“å¼€æŒ‡ä»¤"></a>æ‰“å¼€æŒ‡ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">command -nargs=+ HexoOpen :call OpenHexoPost(&quot;&lt;args&gt;&quot;)</span><br></pre></td></tr></table></figure><h3 id="æ–°å»ºæŒ‡ä»¤"><a href="#æ–°å»ºæŒ‡ä»¤" class="headerlink" title="æ–°å»ºæŒ‡ä»¤"></a>æ–°å»ºæŒ‡ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">command -nargs=+ HexoNew :call NewHexoPost(&quot;&lt;args&gt;&quot;)</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>ã€€ã€€å½“ä½ åšå®Œä»¥ä¸Šæ­¥éª¤çš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥æ— è®ºåœ¨ä»€ä¹ˆç›®å½•ä¸‹åœ¨ VIM é‡Œé¢é€šè¿‡ä¸‹é¢çš„æŒ‡ä»¤è¿›è¡Œæ–°å»ºä¸€ç¯‡æ—¥å¿—äº†ï¼š</p><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">:HexoNew artical-name</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä»¥åŠä¸‹é¢çš„æŒ‡ä»¤æ¥æ‰“å¼€ä¸€ç¯‡å·²å­˜åœ¨çš„æ—¥å¿—ï¼š</p><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">:HexoOpen artical-name</span><br></pre></td></tr></table></figure><h2 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h2><p>ã€€ã€€ç›¸ä¿¡çœ‹åˆ°è¿™é‡Œä¹‹åï¼Œå¤§å®¶ä¹Ÿèƒ½è‡ªå·±å†™å‡ºä¸€ä¸ªç”Ÿæˆçš„æŒ‡ä»¤äº†ï¼Œè¿™é‡Œå°±ä¸ç´¯è¿°äº†ï¼Œæ— éå°±æ˜¯ï¼š</p><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">:!hexo generate</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€æœ¬æ–‡åªè®²ä¸¤ä¸ªå‡½æ•°ï¼Œå¯¹äº &lt;code&gt;markdown&lt;/code&gt; å¦‚ä½•é«˜äº®ä¹‹ç±»çš„é—®é¢˜è¿˜è¯·è‡ªè¡Œè°·æ­Œã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ç„¶åè¯·æ‰“å¼€ä½ è‡ªå·±çš„ &lt;code&gt;.vimrc&lt;/code&gt; æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é¢„å¤‡å·¥ä½œ&quot;&gt;&lt;a href=&quot;#é¢„å¤‡å·¥ä½œ&quot; class=&quot;
      
    
    </summary>
    
    
      <category term="vim" scheme="https://xcoder.in/tags/vim/"/>
    
      <category term="hexo" scheme="https://xcoder.in/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒNBUT 2014 æ ¡èµ›Â·ç½‘ç»œåŒæ­¥èµ›ã€é¢˜è§£ (æœªå®Œæˆ...)</title>
    <link href="https://xcoder.in/2014/05/05/nbut-2014-acm-contest-solution/"/>
    <id>https://xcoder.in/2014/05/05/nbut-2014-acm-contest-solution/</id>
    <published>2014-05-05T07:08:39.000Z</published>
    <updated>2017-12-11T07:59:20.523Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€è¿™æ¬¡æ¯”èµ›ç”± <a href="http://blog.163.com/surgy_han/" target="_blank" rel="external">Hungar</a>ï¼Œ<a href="http://www.cnblogs.com/Wine93/" target="_blank" rel="external">8Mao</a> ä»¥åŠæˆ‘è´Ÿè´£çš„ã€‚æ˜æ˜éƒ½è¯»ç ”äº†ï¼Œè¿˜è¯ˆå°¸å›æ¥å‡ºé¢˜â€”â€”å½’ç»“èµ·æ¥å¤§æ¦‚æ˜¯å› ä¸ºå„ç§é¢è¯•ä¸é¡ºå§ï¼Œæƒ³æ¥è™è™å­¦å¼Ÿå¦¹ä»¬æ€’åˆ·å­˜åœ¨æ„Ÿã€‚ç»“æœç½‘ç»œèµ›è¿˜æ˜¯è¢«è™å¾—æ­»å»æ´»æ¥ã€‚ï¼ˆæœç„¶æˆ‘æ˜¯è’Ÿè’» (â—“Ğ”â—’)âœ„â•°â‹ƒâ•¯</p><p>ã€€ã€€å¥½äº†åºŸè¯ä¸å¤šè¯´ï¼Œè¿˜æ˜¯ç›´æ¥ä¸Šé¢˜è§£å§ã€‚</p><h2 id="Minecraft-Server-Bug"><a href="#Minecraft-Server-Bug" class="headerlink" title="Minecraft Server Bug"></a>Minecraft Server Bug</h2><p>ã€€ã€€é¢˜æ„å¤§æ¦‚å°±æ˜¯è¯´ä¸€æ’å²©æµ†å’Œæ°´ï¼Œä½ è¦æ‹¿ä¸€æ¡¶æ°´å’Œå²©æµ†ï¼Œå¹¶ä¸”æ°´çš„ä¸‹æ ‡å°äºå²©æµ†ã€‚</p><p>ã€€ã€€ä¸ºäº†æ›´ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬ä»åå¾€å‰åšã€‚é¦–å…ˆå°†åºåˆ—è¯»è¿›æ¥ä¹‹åä»åå¾€å‰éå†â€”â€”è‹¥æ˜¯å²©æµ†ï¼Œé‚£ä¹ˆå²©æµ†æ•°åŠ ä¸€ï¼Œå¦‚æœæ˜¯æ°´ï¼Œé‚£ä¹ˆè¿™æ¡¶æ°´èƒ½é€‰æ‹©åé¢å²©æµ†çš„ä»»æ„ä¸€æ¡¶ï¼Œä¹Ÿå°±æ˜¯è¯´ç­”æ¡ˆåŠ ä¸Šå½“å‰çš„å²©æµ†æ•°å³å¯ã€‚</p><blockquote><p>æ³¨æ„ç”¨ <code>__int64</code>ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">char</span> ch[<span class="number">1000005</span>];</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d\n"</span>, &amp;n))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> tmp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%c%c"</span>, ch + i, &amp;tmp);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        __int64 ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(ch[i] == <span class="string">'L'</span>) cnt++;</span><br><span class="line">            <span class="keyword">else</span> ans += (__int64)cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Beautiful-Walls"><a href="#Beautiful-Walls" class="headerlink" title="Beautiful Walls"></a>Beautiful Walls</h2><p>ã€€ã€€ä¸€å µå¢™ï¼Œæ¯å•ä½é«˜åº¦ä¸å®šã€‚ä½ éœ€è¦é€‰æ‹©å…¶ä¸­ä»»æ„è¿ç»­çš„å¢™ï¼Œä½¿å¾—ä½ é€‰æ‹©çš„å¢™æ¯å•ä½çš„é«˜åº¦éƒ½æ˜¯å”¯ä¸€çš„â€”â€”é—®æœ‰å¤šå°‘ç§é€‰æ³•ã€‚</p><p>ã€€ã€€å…ˆæ±‚å‡ºæ€»çš„ç§æ•°ï¼Œç„¶åæ±‚ä¸æ»¡è¶³çš„æ•°é‡ï¼Œæœ€åç”¨æ€»æ•°å‡å»ä¸æ»¡è¶³æ•°å³ä¸ºç­”æ¡ˆã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lint long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 100005</span></span><br><span class="line"><span class="keyword">int</span> p[N], A[N];</span><br><span class="line"><span class="function">lint <span class="title">solution</span><span class="params">(lint n)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(p, <span class="number">-1</span>, <span class="keyword">sizeof</span>(p));</span><br><span class="line">    lint ans = n * (n + <span class="number">1</span>) / <span class="number">2</span>, Max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(lint i=<span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(~p[A[i]])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Max &lt; p[A[i]]) Max = p[A[i]];</span><br><span class="line">            p[A[i]] = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            p[A[i]] = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ans -= Max;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, x;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, A + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, solution(n));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€è¿™æ¬¡æ¯”èµ›ç”± &lt;a href=&quot;http://blog.163.com/surgy_han/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hungar&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.cnblogs.com/Wine93/&quot; targe
      
    
    </summary>
    
      <category term="ACM" scheme="https://xcoder.in/categories/ACM/"/>
    
    
      <category term="ACM" scheme="https://xcoder.in/tags/ACM/"/>
    
      <category term="ç®—æ³•" scheme="https://xcoder.in/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>æ­»æœˆå‡ºå“ï¼šHero Snake è‹±é›„è›‡</title>
    <link href="https://xcoder.in/2014/04/11/hero-snake/"/>
    <id>https://xcoder.in/2014/04/11/hero-snake/</id>
    <published>2014-04-11T05:53:35.000Z</published>
    <updated>2017-12-11T07:59:20.468Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ³¨ï¼šå¤‡ä»½åˆ°è¿™ç¯‡æ—¥å¿—çš„æ—¶å€™ï¼Œæ„Ÿè§‰çœ¼ç›è¿›äº†ä»€ä¹ˆå¥‡æ€ªçš„ä¸œè¥¿ã€‚ï¼ˆæ‰â€¦â€¦æ‰ä¸æ˜¯çœ¼æ³ªå‘¢ï¼Œé‚£ä¸€å®šæ˜¯æ²™å­ï¼(;Â´à¼àº¶Ğ”à¼àº¶`)</p><p>ä¸»è¦å¼•èµ·æ„Ÿä¼¤çš„è¿˜æ˜¯è¿™é¦–è½©è¾•å‰‘çš„ BGM å§ã€‚å› ä¸º Hero Snake çš„BGMå°±æ˜¯è¿™ä¸ªã€‚</p><p>è¿™ç¯‡æ–‡ç« åŸæ–‡æ˜¯åœ¨ 2011å¹´5æœˆ1æ—¥ å‘çš„ã€‚æ¸¸æˆæ˜¯è·Ÿ <strong>MatRush</strong> åœ¨2011å¹´å¯’å‡ä¸€èµ·å†™çš„ï¼Œè™½ç„¶æ˜¯æˆ‘è¾¹æ•™è¾¹å†™çš„ã€‚å‘µå‘µï¼Œè½¬çœ¼é—´ä¸‰å¹´è¿‡å»äº†ã€‚</p><p>æƒ³å½“å¹´æˆ‘è¿˜æ˜¯é‚£ä¹ˆæ‰§ç€äºæ¸¸æˆè¡Œä¸šï¼Œç°åœ¨çº ç»“äºåˆ°åº•è¦ä»äº‹æ¸¸æˆè¡Œä¸šè¿˜æ˜¯äº’è”ç½‘å‘¢ï¼ŸåŠå¹´çœŸçš„èƒ½æ”¹å˜å¾ˆå¤šï¼Œè¦æ˜¯æˆ‘å½“æ—¶æ²¡æœ‰å»æ±½æ—ç½‘å®ä¹ ï¼Œä¹Ÿè®¸ç°åœ¨å¹¶ä¸ä¼šæœ‰é‚£ä¹ˆå¤§çš„æ”¹å˜å§ã€‚</p><p>è‡ªä»è¢« <a href="http://weibo.com/shyvo" target="_blank" rel="external">@æœ´å¤§</a> åˆ·äº†ä¹‹åï¼Œæˆ‘åˆå¼€å§‹ç€é‡è€ƒè™‘äº†ã€‚æ˜¯ä¸æ˜¯æˆ‘ç©äº’è”ç½‘åªæ˜¯è§‰å¾—æ–°é²œå¥½ç©è€Œå·²å‘¢ï¼Ÿæ¯•ç«Ÿæˆ‘æ˜¯åŠè·¯å‡ºå®¶çš„ï¼Œè™½ç„¶æœ‰ç€åæ¥å¹´çš„ <code>Webç»å†</code>ï¼Œä½†é‚£éƒ½æ˜¯å°æ‰“å°é—¹å“‡ã€‚è¿˜è®°å¾—å°å­¦çš„æ—¶å€™ä¹°çš„ç¬¬ä¸€æœ¬ç”µè„‘ä¹¦â€”â€”<a href="http://www.amazon.cn/%E5%9C%A8%E7%BD%91%E4%B8%8A%E5%AE%89%E4%B8%AA%E5%AE%B6-%E6%9C%B1%E6%83%A0%E5%BC%BA/dp/B0011A9QSA/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1397196202&amp;sr=1-1&amp;keywords=%E5%9C%A8%E7%BD%91%E4%B8%8A%E5%AE%89%E4%B8%AA%E5%AE%B6" target="_blank" rel="external">ã€Šåœ¨ç½‘ä¸Šå®‰ä¸ªå®¶ã€‹</a>ï¼Œåˆ°ç°åœ¨è¿˜è®°å¾—é‚£ä¸ªæ—¶å€™æ§ç€ä¹¦çš„æ¿€åŠ¨å¿ƒæƒ…ã€‚</p><p>æˆ‘æ˜¯ä¸æ˜¯æœ‰ç‚¹åç¦»äº†è‡ªå·±æœ¬èº«çš„è½¨é“å‘¢ï¼Ÿæ€»ä¹‹è¿˜æ˜¯åœ¨è¿™ä¸¤å—é¢†åŸŸçŠ¹è±«ä¸å†³ã€‚</p><p>åºŸè¯æœ‰ç‚¹æ‰¯è¿œäº†ï¼Œè¿˜æ˜¯æŠŠæ–‡ç« ä» Capture å¤‡ä»½å›æ¥å†è¯´å§ã€‚</p></blockquote><p>ã€€ã€€è¿™æ˜¯ä¸€æ¬¾æ­£å®—åŸºäºHGEçš„å°æ¸¸æˆï¼Œç®—æ˜¯æˆ‘åšçš„æ¸¸æˆä¸­è‡ªå·±æ¯”è¾ƒæ»¡æ„çš„å°æ¸¸æˆå§ã€‚</p><p>ã€€ã€€å¹•åæ•…äº‹æ˜¯è¿™æ ·çš„ï¼šMatRushå¯’å‡æ‰¾æˆ‘ä¸€èµ·åšæ¸¸æˆï¼Œå› ä¸ºä»–ä»¬å­¦æ ¡å¼„äº†ä¸€ä¸ªè›‹ç–¼çš„æ¸¸æˆåˆ¶ä½œæ¯”èµ›ã€‚ç„¶åå‘½é¢˜æ˜¯è´ªåƒè›‡ï¼Œäºæ˜¯æˆ‘ä»¬åŠ äº†ä¸€ç‚¹è‡ªå·±çš„å°åˆ›æ„ï¼Œç»™ä»–è®²è§£äº†ä¸€äº›HGEçš„åŸºç¡€ä¹‹åï¼Œå°±å†™äº†è¿™ä¸ªæ¸¸æˆäº†ã€‚ç„¶åå› ä¸ºæˆ‘ä»¬éƒ½æ¯”è¾ƒå–œæ¬¢è½©è¾•å‰‘ï¼Œäºæ˜¯BGMå°±æ˜¯è½©è¾•å‰‘çš„ã€Šæ°¸è¿œçš„ä¸‰ä¸ªäººçš„å¿«ä¹æ—¶å…‰ã€‹ï¼Œç”±äºMatRushæ¯”è¾ƒå–œæ¬¢MapleStoryï¼Œä¾¿æœ‰äº†ç´ ææ˜¯é‚£äº›åƒç´ ç”»é¢ã€‚</p><p>ã€€ã€€é¦–å…ˆè¿™ä¸ªæ¸¸æˆæœ‰ä¸¤ç§æ¨¡å¼ï¼šå•äººæ¨¡å¼å’ŒåŒäººæ¨¡å¼ã€‚</p><p>ã€€ã€€å…³æ–¼å•äººæ¨¡å¼ï¼Œè¿™æ˜¯ä¸€ä¸ªé—¯å…³å‹æ¨¡å¼ï¼Œå¤§å®¶åœ¨æ¯ä¸€å…³å¿…é¡»é€šè¿‡åƒé“å…·è·å¾—ä¸€å®šçš„åˆ†æ•°ä»¥åŠåƒåœˆåœˆè·å¾—ä¸€å®šåœˆåœˆæ•°æ‰èƒ½å¼€å¯é€šå¾€ä¸‹ä¸€å…³çš„é—¨ï¼Œé»˜è®¤ä¸€å…±20å…³ï¼Œå¯ä»¥è‡ªå·±ç¼–è¾‘å…³å¡ï¼Œè¿™æ˜¯åè¯ã€‚ä¸‹é¢æ˜¯å‡ ç§é“å…·çš„è§£è¯´ï¼š</p><blockquote><p><img src="treasure0.png" alt="å¼€å±±æ–§"></p><p>å¼€å±±æ–§ï¼šæ¡åˆ°è¿™è´§éšæœºè·å¾—1~3ä¸ªæ–§å¤´å¹¶ä¸”é™„èµ 100åˆ†æ•°ã€‚æ–§å¤´çš„ä½œç”¨æ˜¯èƒ½ç ´å¼€æœ¨æ¡¶ï¼Œå®‰å…¨é€šè¿‡ï¼Œä¸€ä¸ªæ–§å¤´ç”¨ä¸€æ¬¡ã€‚æ–§å¤´æ•°åœ¨å·¦ä¸‹è§’çš„Axe(s)åé¢ã€‚</p><p><img src="treasure1.png" alt="å‘½è¿ä¹‹å‰ª"></p><p>å‘½è¿ä¹‹å‰ªï¼šæ¡åˆ°è¿™ä¸ªä¹‹åè·å¾—100åˆ†å¹¶ä¸”ç»™ä½ æ–­æ‰ä¸€ä¸ªå°¾å·´ä»¥é™ä½éš¾åº¦ã€‚</p><p><img src="treasure2.png" alt="é™é€Ÿå™¨"></p><p>é™é€Ÿå™¨ï¼šå› ä¸ºä½ æ¯åƒä¸€ä¸ªåœˆåœˆä¼šå¢åŠ ä¸€å®šé€Ÿåº¦ï¼Œè€Œè¿™ä¸ªé™é€Ÿå™¨æ˜¯é™ä½ä½ çš„é€Ÿåº¦è®©ä½ å®¹æ˜“äº›ã€‚å¹¶ä¸”é™„èµ 100åˆ†ã€‚</p><p><img src="treasure8.png" alt="è¯æ°´"></p><p>è¯æ°´ï¼šè¯æ°´æ˜¯è£…é¥°å˜è‰²ç”¨çš„ï¼Œå…¶å®æ˜¯é€åˆ†çš„ã€‚å‰å››ç§è¯æ°´100åˆ†ï¼Œç´«è‰²çš„300åˆ†ã€‚</p><p><img src="treasure3.png" alt="é™é€Ÿå™¨"></p><p>éª·é«…å¤´ï¼šæƒ³æ­»çš„è¯å°±ç¢°ç¢°å®ƒè¯•è¯•ã€‚</p><p><img src="door.png" alt="ä¼ é€é—¨"></p><p>ä¼ é€é—¨ï¼šé‡åˆ°è¿™è´§å°±è¯´æ˜ä½ åŠŸå¾·åœ†æ»¡äº†ã€‚æ­å–œï¼Œå¯ä»¥é€šè¿‡å®ƒå‰å¾€ä¸‹ä¸€å…³ã€‚</p></blockquote><p>ã€€ã€€æ¥ä¸‹å»æ˜¯åŒäººæ¨¡å¼ã€‚åŒäººæ¨¡å¼å› ä¸ºå½“åˆè®¾æƒ³æœ‰äº›é—®é¢˜ï¼Œæ‰€ä»¥å®ç°èµ·æ¥ä»…ä»…æ˜¯ç®€å•çš„åŒäººèµ°å•Šèµ°ï¼Œçœ‹è°ç¢°åˆ°è°è°å°±è¾“ã€‚åœ¨åŒäººæ¨¡å¼ä¸­ï¼Œå…ˆè¦é€‰æ‹©ä¸€å¼ å¯¹æˆ˜åœ°å›¾ï¼Œç„¶åå¼€å§‹åŒäººèµ°å•Šèµ°å•Šèµ°ã€‚</p><p>ã€€ã€€ç„¶åRankæ˜¯æ’è¡Œæ¦œï¼ŒOptionæ˜¯æ¸¸æˆçš„ä¸€äº›é€‰é¡¹ï¼ŒIntroductionæ˜¯æ¸¸æˆä»‹ç»ï¼Œè¿™ä¸ªä»‹ç»æœ‰äº›è›‹ç–¼ï¼Œæœ€åä¸ç”¨è¯´Exitå°±æ˜¯é€€å‡ºäº†ã€‚</p><p>ã€€ã€€ä¸‹é¢æ˜¯å…³äºåœ°å›¾ç¼–è¾‘å™¨çš„è¯´æ˜ï¼š</p><p>ã€€ã€€é¦–å…ˆåœ¨æ¸¸æˆç›®å½•å°æœ‰ä¸€ä¸ªconfig.iniæ–‡ä»¶ï¼Œæ˜¯ä¸€äº›æ¸¸æˆè®¾ç½®ã€‚å…¶ä¸­levelnumæ˜¯æ¸¸æˆå…³å¡æ•°ã€‚æ³¨æ„è¿™ä¸ªæ•°å­—å¿…é¡»è¦è·Ÿåœ°å›¾æ•°é‡ä¸€è‡´æˆ–è€…å°äºå®ƒï¼Œå¦åˆ™ä¼šå› ä¸ºæ‰¾ä¸åˆ°ä¹‹åçš„åœ°å›¾è€Œå‡ºé”™ã€‚åœ°å›¾å°±å­˜åœ¨dataé‡Œï¼Œå‘½åæ–¹å¼æ˜¯mapX.txtï¼Œä»0å¼€å§‹ã€‚åœ°å›¾ç¼–è¾‘å™¨åˆ™åœ¨MapEditoræ–‡ä»¶å¤¹ä¸‹ã€‚æ“ä½œå¾ˆç®€å•ï¼Œè¯´æ˜éƒ½åœ¨ç¼–è¾‘å™¨ä¸‹æ–¹çš„æ–‡å­—ä¸Šï¼Œå°±å‡ ä¸ªå¿«æ·é”®ã€‚å¯ä»¥ç”¨é¼ æ ‡æ“ä½œä¹Ÿå¯ä»¥ç”¨ä¸Šä¸‹å·¦å³æ§åˆ¶æ–¹å‘ã€‚</p><p>ã€€ã€€æœ€åï¼Œé¢„ç¥å¤§å®¶ç©å¾—æ„‰å¿«ã€‚é™„ä¸Šä¸‹è½½åœ°å€å’Œå‡ å¼ é¢„è§ˆå›¾å§ï¼š</p><p>ã€€ã€€<a href="bin.7z">ç‚¹å‡»ä¸‹è½½</a></p><p>ã€€ã€€<a href="https://github.com/XadillaX/hero-snake" target="_blank" rel="external">ä»£ç åœ°å€</a></p><p><img src="1.png" alt="æ ‡é¢˜ç”»é¢"><br><img src="2.png" alt="ç©çš„ç”»é¢"><br><img src="4.png" alt="åŒäººæ¨¡å¼"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šå¤‡ä»½åˆ°è¿™ç¯‡æ—¥å¿—çš„æ—¶å€™ï¼Œæ„Ÿè§‰çœ¼ç›è¿›äº†ä»€ä¹ˆå¥‡æ€ªçš„ä¸œè¥¿ã€‚ï¼ˆæ‰â€¦â€¦æ‰ä¸æ˜¯çœ¼æ³ªå‘¢ï¼Œé‚£ä¸€å®šæ˜¯æ²™å­ï¼(;Â´à¼àº¶Ğ”à¼àº¶`)&lt;/p&gt;
&lt;p&gt;ä¸»è¦å¼•èµ·æ„Ÿä¼¤çš„è¿˜æ˜¯è¿™é¦–è½©è¾•å‰‘çš„ BGM å§ã€‚å› ä¸º Hero Snake çš„BGMå°±æ˜¯è¿™ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« åŸæ–‡æ˜¯åœ¨
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="HGE" scheme="https://xcoder.in/tags/HGE/"/>
    
      <category term="æ¸¸æˆå¼€å‘" scheme="https://xcoder.in/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>è®©Node.jså’ŒC++ä¸€èµ·æåŸº â€”â€” 3 (æœªå®Œæˆ...)</title>
    <link href="https://xcoder.in/2014/04/06/nodejs-cpp-addons-3/"/>
    <id>https://xcoder.in/2014/04/06/nodejs-cpp-addons-3/</id>
    <published>2014-04-06T08:15:39.000Z</published>
    <updated>2017-12-11T07:59:20.527Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€<a href="/2014/04/03/nodejs-cpp-addons-2/">ä¸Šä¸€ç« </a>æˆ‘ä»¬å·å·å­¦ä¹ äº†å¦‚ä½•åœ¨ <code>C++</code> ä¸­å®ç° <code>Node.js</code> è°ƒç”¨æ—¶ä¼ å‚æ•°å’Œè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”æˆ‘è‡ªå·±ä¹Ÿå¿ƒè¡€æ¥æ½®å†™äº†ä¸ª<a href="/2014/04/05/cpp-class-inline-keng/#simpleini">å° Demo</a> ä¾›å¤§å®¶å‚è€ƒã€‚</p><p>ã€€ã€€ä»Šå¤©æˆ‘ä»¬å°±ä¸å¤ä¹ äº†ï¼Œç›´æ£é»„é¾™å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€&lt;a href=&quot;/2014/04/03/nodejs-cpp-addons-2/&quot;&gt;ä¸Šä¸€ç« &lt;/a&gt;æˆ‘ä»¬å·å·å­¦ä¹ äº†å¦‚ä½•åœ¨ &lt;code&gt;C++&lt;/code&gt; ä¸­å®ç° &lt;code&gt;Node.js&lt;/code&gt; è°ƒç”¨æ—¶ä¼ å‚æ•°å’Œè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”æˆ‘è‡ªå·±ä¹Ÿå¿ƒè¡€æ¥æ½®å†™äº†ä¸ª&lt;a hr
      
    
    </summary>
    
      <category term="NodeJS" scheme="https://xcoder.in/categories/NodeJS/"/>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>C++ä¸­ç±»æˆå‘˜å‡½æ•° inline çš„å‘</title>
    <link href="https://xcoder.in/2014/04/05/cpp-class-inline-keng/"/>
    <id>https://xcoder.in/2014/04/05/cpp-class-inline-keng/</id>
    <published>2014-04-05T08:55:57.000Z</published>
    <updated>2017-12-11T07:59:20.466Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€ä»Šå¤©æˆ‘æ¥è®²ä¸€è®² <code>C++</code> ä¸­ç±»æˆå‘˜å‡½æ•° <code>inline</code> ä¿®é¥°ç¬¦çš„ä¸€ä¸ªå‘ã€‚</p><p>ã€€ã€€è¿™ä¸ªå‘æ˜¯æˆ‘åœ¨å°è¯•ç€å†™æˆ‘çš„ç¬¬ä¸€ä¸ª <code>Node.js</code> æ‰©å±• <code>simpleini</code> æ—¶å€™é‡åˆ°çš„ã€‚</p><h2 id="å‘æè¿°"><a href="#å‘æè¿°" class="headerlink" title="å‘æè¿°"></a>å‘æè¿°</h2><p>ã€€ã€€å› ä¸ºåªæ˜¯å°è¯•ç€å†™ï¼Œæ‰€ä»¥æ‡’å¾—è‡ªå·±å®ç°ï¼Œäºæ˜¯ç½‘ä¸Šæ‰¾äº†ä¸ªå¼€æºçš„ <code>C++</code> é˜…è¯» ini æ–‡ä»¶çš„é¡¹ç›®ï¼Œåä¸è§ç»ä¼ ï¼Œå« <a href="http://miniini.tuxfamily.org/" target="_blank" rel="external">miniini</a>ã€‚</p><p>ã€€ã€€å¥½äº†ï¼Œé—®é¢˜æ¥äº†ï¼Œå½“æˆ‘å†™å¥½æˆ‘çš„æºæ–‡ä»¶çš„æ—¶å€™ï¼Œç„¶åå†™å¥½äº†æˆ‘çš„ <code>binding.gyp</code> ï¼Œæ€»ä¹‹ä¸€åˆ‡å¤§åŠŸå‘Šæˆå¼€å§‹ç¼–è¯‘çš„æ—¶å€™â€”â€” <code>Windows</code> ä¸‹æ²¡é—®é¢˜ï¼Œ<code>MacOS</code> ä¸‹ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯åœ¨ <code>Linux</code> ä¸‹å°±å‡ºé—®é¢˜äº†ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">node: symbol lookup err: .../simpleIni.node: undefined symbol: _ZNK10INISection10ReadStringEPKcRS1_</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¤§è‡´çš„æ„æ€å‘¢å°±æ˜¯è¯´æ‰¾ä¸åˆ° <code>INISection</code> çš„ <code>ReadString</code> å‡½æ•°ç¬¦å·ã€‚</p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>ã€€ã€€åˆæ˜¯æ€€ç€å´‡æ•¬çš„å¿ƒæƒ…å» <a href="http://stackoverflow.com/questions/22868307/undefined-symbol-in-node-js-c-addon-under-linux-why" target="_blank" rel="external">SO</a> æ±‚è§£äº†ã€‚</p><p>ã€€ã€€æœ€åçš„è§£ç­”å¤§æ¦‚<a href="http://isocpp.org/wiki/faq/inline-functions#inline-member-fns" target="_blank" rel="external">å¦‚ä¸‹</a>ï¼š</p><blockquote><p>å†…è”æˆå‘˜å‡½æ•°çš„å£°æ˜çœ‹èµ·æ¥åƒä¸€ä¸ªéå†…è”å‡½æ•°çš„å£°æ˜ï¼š<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fred</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">char</span> c)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ä½ çš„å†…æ•›æˆå‘˜å‡½æ•°å®šä¹‰å‰é¢åˆåŠ äº† <code>inline</code> è¿™ä¸ªå…³é”®å­—æ—¶ï¼Œä½ å¿…é¡»æŠŠè¿™ä¸ªå®šä¹‰æ”¾åˆ°å¤´æ–‡ä»¶ä¸­ï¼š<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">inline</span></span><br><span class="line"><span class="keyword">void</span> Fred::f(<span class="keyword">int</span> i, <span class="keyword">char</span> c)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¹ˆåšçš„åŸå› å°±æ˜¯ä¸ºäº†é¿å…é“¾æ¥å™¨ <code>unresolved external</code> çš„å‘ç”Ÿã€‚å¦‚æœä½ ä¸è¿™ä¹ˆåšï¼Œè¿™ä¸ªé”™è¯¯å°±å°†ä¼šåœ¨ä½ ä»å¦å¤–ä¸€ä¸ª <code>.cpp</code> æ–‡ä»¶ä¸­è°ƒç”¨å®ƒæ—¶å‡ºç°ã€‚</p></blockquote><p>ã€€ã€€å¥½å˜›ï¼ŒåŸæ¥æ˜¯åŸä½œè€…è‡ªå·±å†™çš„ä»£ç æœ‰é—®é¢˜å•Šã€‚ä½†æ˜¯ä¸å¾—ä¸è¯´ä¸€ä¸‹åˆæ¶¨å§¿åŠ¿äº†ã€‚C++è¿˜çœŸæ˜¯æœ‰åƒå¥‡ç™¾æ€ªçš„å‘å’Œé”™è¯¯å•Šã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ã€€ã€€æœ€åçš„è§£å†³æ–¹æ¡ˆå¤§è‡´å°±æ˜¯æŠŠå‡½æ•°å®šä¹‰æ”¾åˆ°å¤´æ–‡ä»¶ä¸­å»ï¼Œæˆ–è€…åœ¨å‡½æ•°å£°æ˜å‰é¢ä¹ŸåŠ ä¸Š <code>inline</code> å…³é”®å­—ã€‚</p><h2 id="simpleini"><a href="#simpleini" class="headerlink" title="simpleini"></a>simpleini</h2><p>ã€€ã€€æˆ‘çš„ç¬¬ä¸€ä¸ª <code>C++</code> æ¨¡å—ï¼Œå« <code>simpleini</code> ï¼Œå…¶å®åªæ˜¯æŠ±ç€è¯•è¯•çœ‹ <code>Node.j</code> çš„ <code>C++</code> æ¨¡å—æ˜¯ä¸æ˜¯è¿™ä¹ˆå†™çš„è€Œå·²ï¼Œå¹¶æ²¡æœ‰å¤šå¤§å®é™…ç”¨å¤„ã€‚Repo åœ¨ <a href="https://github.com/XadillaX/node-simple-ini" target="_blank" rel="external">Github</a> ä¸Šã€‚</p><p>ã€€ã€€ç„¶åç”¨æ³•å¾ˆç®€å•ï¼Œå…ˆå®‰è£…ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm install simpleini</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åä¸‹é¢çš„ä»£ç å°±æ˜¯ä¾‹å­äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> simpleIni = <span class="built_in">require</span>(<span class="string">"simpleini"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.open(<span class="string">"./node_modules/simpleini/src/miniini-0.9/test/test.ini"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.read(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.read(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"d"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.read(<span class="string">"SETTINGS"</span>, <span class="string">"sections"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(simpleIni.read(<span class="string">"vals"</span>, <span class="string">"float"</span>));</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¯»å–é…ç½®çš„æ—¶å€™ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>Section</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ <code>Key</code>ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å–ä¸åˆ°è¯¥å€¼æ—¶çš„é»˜è®¤å€¼ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€ä»Šå¤©æˆ‘æ¥è®²ä¸€è®² &lt;code&gt;C++&lt;/code&gt; ä¸­ç±»æˆå‘˜å‡½æ•° &lt;code&gt;inline&lt;/code&gt; ä¿®é¥°ç¬¦çš„ä¸€ä¸ªå‘ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€è¿™ä¸ªå‘æ˜¯æˆ‘åœ¨å°è¯•ç€å†™æˆ‘çš„ç¬¬ä¸€ä¸ª &lt;code&gt;Node.js&lt;/code&gt; æ‰©å±• &lt;code&gt;simpleini&lt;/code&gt; æ—¶å€™
      
    
    </summary>
    
      <category term="Programming" scheme="https://xcoder.in/categories/Programming/"/>
    
    
      <category term="Programming" scheme="https://xcoder.in/tags/Programming/"/>
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>è®©Node.jså’ŒC++ä¸€èµ·æåŸº â€”â€” 2</title>
    <link href="https://xcoder.in/2014/04/03/nodejs-cpp-addons-2/"/>
    <id>https://xcoder.in/2014/04/03/nodejs-cpp-addons-2/</id>
    <published>2014-04-03T14:37:15.000Z</published>
    <updated>2017-12-11T07:59:20.527Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€å¥½ï¼Œä»Šå¤©è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°æåŸºå§ï¼</p><h2 id="æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºæ¹¿çŸ£"><a href="#æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºæ¹¿çŸ£" class="headerlink" title="æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºæ¹¿çŸ£"></a>æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºæ¹¿çŸ£</h2><p>ã€€ã€€é¦–å…ˆè¯·å¤§å®¶è®°ä½è¿™ä¸ª V8 çš„åœ¨çº¿æ‰‹å†Œâ€”â€”<a href="http://izs.me/v8-docs/main.html" target="_blank" rel="external">http://izs.me/v8-docs/main.html</a>ã€‚</p><p>ã€€ã€€è¿˜è®°å¾—ä¸Šæ¬¡çš„ <code>building.gyp</code> æ–‡ä»¶å—ï¼Ÿ</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"targets"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"target_name"</span>: <span class="string">"addon"</span>,</span><br><span class="line">      <span class="attr">"sources"</span>: [ <span class="string">"addon.cc"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å°±åƒè¿™æ ·ï¼Œä¸¾ä¸€åä¸‰ï¼Œå¦‚æœå¤šå‡ ä¸ª <code>*.cc</code> æ–‡ä»¶çš„è¯å°±æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"sources": [ "addon.cc", "myexample.cc" ]</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸Šæ¬¡æˆ‘ä»¬æŠŠä¿©æ­¥éª¤åˆ†å¼€äº†ï¼Œå®é™…ä¸Šé…ç½®å’Œç¼–è¯‘å¯ä»¥æ”¾åœ¨ä¸€èµ·çš„ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ node-gyp configure build</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¤ä¹ å®Œäº†å—ï¼Ÿæ²¡ï¼Ÿï¼</p><p><img src="mama.jpg" alt="å•ª"></p><p>ã€€ã€€å¥½çš„ï¼Œé‚£æˆ‘ä»¬ç»§ç»­å§ã€‚</p><h2 id="è¡¨ç•ª"><a href="#è¡¨ç•ª" class="headerlink" title="è¡¨ç•ª"></a>è¡¨ç•ª</h2><h3 id="å‡½æ•°å‚æ•°"><a href="#å‡½æ•°å‚æ•°" class="headerlink" title="å‡½æ•°å‚æ•°"></a>å‡½æ•°å‚æ•°</h3><p>ã€€ã€€ç°åœ¨æˆ‘ä»¬ç»ˆäºè¦è®²å‚æ•°äº†å‘¢ã€‚</p><p>ã€€ã€€è®©æˆ‘ä»¬è®¾æƒ³æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•° <code>add(a, b)</code> ä»£è¡¨æŠŠ <code>a</code> å’Œ <code>b</code> ç›¸åŠ è¿”å›ç»“æœï¼Œæ‰€ä»¥å…ˆæŠŠå‡½æ•°å¤–æ¡†å†™å¥½ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;node.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> v8;</span><br><span class="line"></span><br><span class="line">Handle&lt;Value&gt; Add(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//... åˆæ¥ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h4><p>ã€€ã€€è¿™ä¸ªå°±æ˜¯å‡½æ•°çš„å‚æ•°äº†ã€‚æˆ‘ä»¬ä¸å¦¨å…ˆçœ‹çœ‹ v8 çš„<a href="http://izs.me/v8-docs/classv8_1_1Arguments.html" target="_blank" rel="external">å®˜æ–¹æ‰‹å†Œå‚è€ƒ</a>ã€‚</p><ul><li><code>int Length() const</code></li><li><code>Local&lt;Value&gt; operator[](int i) const</code></li></ul><p>ã€€ã€€å…¶å®ƒçš„æˆ‘ä»¬å’±ä¸å…³å¿ƒï¼Œè¿™ä¸¤ä¸ªå¯é‡è¦äº†ï¼ä¸€ä¸ªä»£è¡¨ä¼ å…¥å‡½æ•°çš„å‚æ•°ä¸ªæ•°ï¼Œå¦ä¸€ä¸ªä¸­æ‹¬å·å°±æ˜¯é€šè¿‡ä¸‹æ ‡ç´¢å¼•æ¥è®¿é—®ç¬¬ <code>n</code> ä¸ªå‚æ•°çš„ã€‚</p><p>ã€€ã€€æ‰€ä»¥å¦‚ä¸Šçš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¤§è‡´å°±å¯ä»¥ç†è§£ä¸º <code>args.Length()</code> ä¸º <code>2</code>ï¼Œ<code>args[0]</code> ä»£è¡¨ <code>a</code> ä»¥åŠ <code>args[1]</code> ä»£è¡¨ <code>b</code> äº†ã€‚å¹¶ä¸”æˆ‘ä»¬è¦åˆ¤æ–­è¿™ä¸¤ä¸ªæ•°çš„ç±»å‹å¿…é¡»å¾—æ˜¯ <code>Number</code>ã€‚</p><p>ã€€ã€€æ³¨æ„åˆ°æ²¡ï¼Œä¸­æ‹¬å·çš„ç´¢å¼•æ“ä½œç¬¦è¿”å›ç»“æœæ˜¯ä¸€ä¸ª <code>Local&lt;Value&gt;</code> ä¹Ÿå°±æ˜¯ <code>Node.js</code> çš„æ‰€æœ‰ç±»å‹åŸºç±»ã€‚æ‰€ä»¥ä¼ è¿›æ¥çš„å‚æ•°ç±»å‹ä¸å®šçš„ï¼Œæˆ‘ä»¬å¿…é¡»å¾—è‡ªå·±åˆ¤æ–­æ˜¯ä»€ä¹ˆå‚æ•°ã€‚è¿™å°±å…³ç³»åˆ°äº†è¿™ä¸ª <code>Value</code> ç±»å‹çš„ä¸€äº›<a href="http://izs.me/v8-docs/classv8_1_1Value.html" target="_blank" rel="external">å‡½æ•°</a>äº†ã€‚</p><ul><li><code>IsArray()</code></li><li><code>IsBoolean()</code></li><li><code>IsDate()</code></li><li><code>IsFunction()</code></li><li><code>IsInt32()</code></li><li><code>IsNativeError()</code></li><li><code>IsNull()</code></li><li><code>IsNumber()</code></li><li><code>IsRegExp()</code></li><li><code>IsString()</code></li><li>â€¦</li></ul><p>ã€€ã€€æˆ‘å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œå‰©ä¸‹çš„è‡ªå·±çœ‹æ–‡æ¡£ã€‚ï½¡:.ï¾Ÿãƒ½(*Â´âˆ€`)ï¾‰ï¾Ÿ.:ï½¡</p><h4 id="ThrowException"><a href="#ThrowException" class="headerlink" title="ThrowException"></a>ThrowException</h4><p>ã€€ã€€è¿™ä¸ªæ˜¯æˆ‘ä»¬ç­‰ä¸‹è¦ç”¨åˆ°çš„ä¸€ä¸ªå‡½æ•°ã€‚å…·ä½“åœ¨ <a href="http://izs.me/v8-docs/namespacev8.html#a2469af0ac719d39f77f20cf68dd9200e" target="_blank" rel="external">v8 æ–‡æ¡£</a>ä¸­å¯ä»¥æ‰¾åˆ°ã€‚</p><p>ã€€ã€€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŠ›å‡ºé”™è¯¯å•¦ã€‚æ‰§è¡Œè¿™ä¸ªè¯­å¥ä¹‹åï¼Œç›¸å½“äºåœ¨ <code>Node.js</code> æœ¬åœ°æ–‡ä»¶ä¸­æ‰§è¡Œäº†ä¸€æ¡ <code>throw()</code> è¯­å¥ä¸€æ ·ã€‚æ¯”å¦‚è¯´ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ThrowException(Exception::TypeError(String::New(<span class="string">"Wrong number of arguments"</span>)));</span><br></pre></td></tr></table></figure><p>ã€€ã€€å°±ç›¸å½“äºæ‰§è¡Œäº†ä¸€æ¡ <code>Node.js</code> çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Wrong number of arguments"</span>);</span><br></pre></td></tr></table></figure><h4 id="Undefined"><a href="#Undefined" class="headerlink" title="Undefined()"></a>Undefined()</h4><p>ã€€ã€€è¿™ä¸ªå‡½æ•°å‘¢ä¹Ÿåœ¨<a href="http://izs.me/v8-docs/namespacev8.html#ad39cfade81e77137fc11ff3a24284340" target="_blank" rel="external">æ–‡æ¡£</a>é‡Œé¢ã€‚</p><p>ã€€ã€€å…·ä½“å°±æ˜¯ä¸€ä¸ªç©ºå€¼ï¼Œå› ä¸ºæœ‰äº›å‡½æ•°å¹¶ä¸éœ€è¦è¿”å›ä»€ä¹ˆå…·ä½“çš„å€¼ï¼Œæˆ–è€…è¯´æ²¡æœ‰è¿”å›å€¼ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨ <code>Undefined()</code> æ¥ä»£æ›¿äº†ã€‚</p><h4 id="åŠ¨æ‰‹å§éªšå¹´ï¼"><a href="#åŠ¨æ‰‹å§éªšå¹´ï¼" class="headerlink" title="åŠ¨æ‰‹å§éªšå¹´ï¼"></a>åŠ¨æ‰‹å§éªšå¹´ï¼</h4><p>ã€€ã€€åœ¨ç†è§£äº†ä»¥ä¸Šçš„å‡ ä¸ªè¦ç‚¹ä¹‹åï¼Œæˆ‘ç›¸ä¿¡ä½ ä»¬å¾ˆå¿«å°±èƒ½å†™å‡º <code>a + b</code> çš„é€»è¾‘äº†ï¼Œæˆ‘å°±æŠŠ <code>Node.js</code> å®˜æ–¹æ‰‹å†Œçš„ä»£ç æŠ„è¿‡æ¥ç»™ä½ ä»¬è¿‡ä¸€éå°±ç®—å®Œäº‹äº†ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;node.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> v8;</span><br><span class="line"></span><br><span class="line">Handle&lt;Value&gt; Add(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»£è¡¨äº†å¯ä»¥ä¼ å…¥ 2 ä¸ªä»¥ä¸Šçš„å‚æ•°ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬åªç”¨å‰ä¸¤ä¸ª</span></span><br><span class="line">    <span class="keyword">if</span>(args.Length() &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æŠ›å‡ºé”™è¯¯</span></span><br><span class="line">        ThrowException(Exception::TypeError(String::New(<span class="string">"Wrong number of arguments"</span>)));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿”å›ç©ºå€¼</span></span><br><span class="line">        <span class="keyword">return</span> scope.Close(Undefined());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‹¥å‰ä¸¤ä¸ªå‚æ•°å…¶ä¸­ä¸€ä¸ªä¸æ˜¯æ•°å­—çš„è¯</span></span><br><span class="line">    <span class="keyword">if</span>(!args[<span class="number">0</span>]-&gt;IsNumber() || !args[<span class="number">1</span>]-&gt;IsNumber())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æŠ›å‡ºé”™è¯¯å¹¶è¿”å›ç©ºå€¼</span></span><br><span class="line">        ThrowException(Exception::TypeError(String::New(<span class="string">"Wrong arguments"</span>)));</span><br><span class="line">        <span class="keyword">return</span> scope.Close(Undefined());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…·ä½“å‚è€ƒ v8 æ–‡æ¡£</span></span><br><span class="line">    <span class="comment">//     http://izs.me/v8-docs/classv8_1_1Value.html#a6eac2b07dced58f1761bbfd53bf0e366)</span></span><br><span class="line">    <span class="comment">// çš„ `NumberValue` å‡½æ•°</span></span><br><span class="line">    Local&lt;Number&gt; num = Number::New(args[<span class="number">0</span>]-&gt;NumberValue() + args[<span class="number">1</span>]-&gt;NumberValue());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> scope.Close(num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å‡½æ•°å¤§åŠŸå‘Šæˆï¼</p><p>ã€€ã€€æœ€åæŠŠå°¾éƒ¨çš„å¯¼å‡ºå‡½æ•°ç»™å†™å¥½å°± OK äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Handle&lt;Object&gt; exports)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    exports-&gt;Set(String::NewSymbol(<span class="string">"add"</span>),</span><br><span class="line">        FunctionTemplate::New(Add)-&gt;GetFunction());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NODE_MODULE(addon, Init)</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç­‰ä½ ç¼–è¯‘å¥½ä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½è¿™æ ·ç”¨äº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> addon = <span class="built_in">require</span>(<span class="string">'./build/Release/addon'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(addon.add(<span class="number">1</span>, <span class="number">1</span>) + <span class="string">"b"</span>);</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä½ ä¼šçœ‹åˆ°ä¸€ä¸ª <code>2b</code> ï¼âœ§<em>ï½¡Ù©(ËŠá—œË‹</em>)Ùˆâœ§*ï½¡</p><h3 id="å›è°ƒå‡½æ•°"><a href="#å›è°ƒå‡½æ•°" class="headerlink" title="å›è°ƒå‡½æ•°"></a>å›è°ƒå‡½æ•°</h3><p>ã€€ã€€ä¸Šä¸€ç« æˆ‘ä»¬åªè®²äº†ä¸ª <code>Hello world</code>ï¼Œè¿™ä¸€ç« é˜¿å©†ä¸»å°±è‰¯å¿ƒå‘ç°ä¸€ä¸‹ï¼Œå†æ¥ä¸ªå›è°ƒå‡½æ•°çš„å†™æ³•ã€‚</p><p>ã€€ã€€æƒ¯ä¾‹æˆ‘ä»¬å…ˆå†™å¥½æ¡†æ¶ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;node.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> v8;</span><br><span class="line"></span><br><span class="line">Handle&lt;Value&gt; RunCallback(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">  HandleScope scope;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... å™¼é‡Œå•ªå•¦å™¼é‡Œå•ªå•¦</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> scope.Close(Undefined());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åæˆ‘ä»¬å†³å®šå®ƒçš„ç”¨æ³•æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">func(<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€å³å®ƒä¼šç»™å›è°ƒå‡½æ•°ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬è®¾æƒ³å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ <code>console.log()</code> å‡ºæ¥çœ‹ã€‚</p><h4 id="é¦–å…ˆä½ è¦æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç³»åˆ—"><a href="#é¦–å…ˆä½ è¦æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç³»åˆ—" class="headerlink" title="é¦–å…ˆä½ è¦æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç³»åˆ—"></a>é¦–å…ˆä½ è¦æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç³»åˆ—</h4><p>ã€€ã€€åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆç»™å®ƒä¸€ä¸ªå­—ç¬¦ä¸²å–‚é¥±äº†å†è¯´å§ã€‚<em>(âˆš Î¶ Îµ:)</em></p><p>ã€€ã€€ä¸è¿‡æˆ‘ä»¬å¾—è®©è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯é€šç”¨ç±»å‹çš„ï¼Œå› ä¸º <code>Node.js</code> ä»£ç æ˜¯å¼±ç±»å‹çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Local&lt;Value&gt;::New(String::New(<span class="string">"hello world"</span>));</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä»€ä¹ˆï¼Ÿä½ é—®æˆ‘ä»€ä¹ˆæ˜¯ <code>Local&lt;Value&gt;</code>ï¼Ÿ</p><p>ã€€ã€€é‚£æˆ‘ç¨ç¨è®²ä¸€ä¸‹å§ï¼Œå‚è€ƒè‡ª<a href="http://cnodejs.org/topic/4f16442ccae1f4aa270010c5" target="_blank" rel="external">è¿™é‡Œ</a>å’Œ<a href="http://izs.me/v8-docs/classv8_1_1Local.html" target="_blank" rel="external">V8å‚è€ƒæ–‡æ¡£</a>ã€‚</p><p>ã€€ã€€å¦‚æ–‡æ¡£æ‰€ç¤ºï¼Œ<code>Local&lt;T&gt;</code> å®é™…ä¸Šç»§æ‰¿è‡ª <code>Handle&lt;T&gt;</code>ï¼Œæˆ‘è®°å¾—<a href="/2014/04/02/nodejs-cpp-addons-1/#Handle&lt;Value">ä¸Šä¸€ç« </a>å·²ç»è®²è¿‡ <code>Handle&lt;T&gt;</code> è¿™ä¸ªä¸œè¥¿äº†ã€‚</p><p>ã€€ã€€ç„¶åä¸‹é¢å°±æ˜¯è®² Local äº†ã€‚</p><blockquote><p>Handle æœ‰ä¸¤ç§ç±»å‹ï¼Œ Local Handle å’Œ Persistent Handle ï¼Œç±»å‹åˆ†åˆ«æ˜¯ <code>Local&lt;T&gt; : Handle&lt;T&gt;</code> å’Œ <code>Persistent&lt;T&gt; : Handle&lt;T&gt;</code> ï¼Œå‰è€…å’Œ <code>Handle&lt;T&gt;</code> æ²¡æœ‰åŒºåˆ«ç”Ÿå­˜å‘¨æœŸéƒ½åœ¨ scope å†…ã€‚è€Œåè€…çš„ç”Ÿå‘½å‘¨æœŸè„±ç¦» scope ï¼Œä½ éœ€è¦æ‰‹åŠ¨è°ƒç”¨ <code>Persistent::Dispose</code> ç»“æŸå…¶ç”Ÿå‘½å‘¨æœŸã€‚ä¹Ÿå°±æ˜¯è¯´ Local Handle ç›¸å½“äºåœ¨ C++`åœ¨æ ˆä¸Šåˆ†é…å¯¹è±¡è€Œ Persistent Handle ç›¸å½“äº C++ åœ¨å †ä¸Šåˆ†é…å¯¹è±¡ã€‚</p></blockquote><h4 id="ç„¶åä½ è¦æœ‰ä¸ªå‚æ•°è¡¨ç³»åˆ—"><a href="#ç„¶åä½ è¦æœ‰ä¸ªå‚æ•°è¡¨ç³»åˆ—" class="headerlink" title="ç„¶åä½ è¦æœ‰ä¸ªå‚æ•°è¡¨ç³»åˆ—"></a>ç„¶åä½ è¦æœ‰ä¸ªå‚æ•°è¡¨ç³»åˆ—</h4><p>ã€€ã€€ç»ˆç«¯å‘½ä»¤è¡Œè°ƒç”¨ C/C++ ä¹‹åæ€ä¹ˆå–å‘½ä»¤è¡Œå‚æ•°ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¯¹äº†ï¼Œè¿™é‡Œçš„ <code>argc</code> å°±æ˜¯å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°ï¼Œ<code>argv[]</code> å°±æ˜¯å„ä¸ªå‚æ•°äº†ã€‚é‚£ä¹ˆè°ƒç”¨ <code>Node.js</code> çš„å›è°ƒå‡½æ•°ï¼Œ<code>v8</code> ä¹Ÿé‡‡ç”¨äº†ç±»ä¼¼çš„<a href="http://izs.me/v8-docs/classv8_1_1Function.html#ac61877494d2d8bb81fcef96003ec4059" target="_blank" rel="external">æ–¹æ³•</a>ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">V8EXPORT Local&lt;Value&gt; v8::Function::Call(Handle&lt;Object&gt;recv,</span><br><span class="line">    <span class="keyword">int</span> argc,</span><br><span class="line">    Handle&lt;Value&gt; argv[]</span><br><span class="line">);</span><br></pre></td></tr></table></figure><blockquote><p><del>QAQ å¡åœ¨äº† <code>Handle&lt;Object&gt; recv</code> äº†ï¼ï¼ï¼æ˜å¤©ç»§ç»­å†™ã€‚</del></p></blockquote><p>ã€€ã€€å¥½å§ï¼Œæ–°çš„ä¸€å¤©å¼€å§‹äº†æˆ‘æ„Ÿè§‰æˆ‘å……æ»¡äº†åŠ›é‡ã€‚(âˆ©^o^)âŠƒâ”â˜†ï¾Ÿ.*ï½¥ï½¡</p><p>ã€€ã€€ç»è¿‡æˆ‘å¤šæ–¹é¢æ±‚è¯ï¼ˆ<a href="http://segmentfault.com/q/1010000000456217" target="_blank" rel="external">SegmentFault</a>å’Œ<a href="http://stackoverflow.com/questions/22842908/what-does-the-first-argument-of-functioncall-in-v8-engine-mean/22848601?noredirect=1#22848601" target="_blank" rel="external">StackOverflow</a>ä»¥åŠä¸€ä¸ªæ‰£æ‰£ç¾¤ï¼‰ï¼Œç»ˆäºè§£å†³äº†ä¸Šé¢è¿™ä¸ªå‡½æ•°ä»¨å‚æ•°çš„æ„æ€ã€‚</p><p>ã€€ã€€åé¢ä¸¤ä¸ªå‚æ•°å°±ä¸å¤šè¯´äº†ï¼Œä¸€ä¸ªæ˜¯å‚æ•°ä¸ªæ•°ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ä¸€ä¸ªå‚æ•°çš„æ•°ç»„äº†ã€‚è‡³äºç¬¬ä¸€ä¸ªå‚æ•° <code>Handle&lt;Object&gt; recv</code>ï¼ŒStackOverflow ä»å…„çš„è§£é‡Šæ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>It is the same as apply in JS. In JS, you do</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> context = ...;</span><br><span class="line">cb.apply(context, [ ...args...]);</span><br></pre></td></tr></table></figure><p>The object passed as the first argument becomes this within the function scope. More documentation on <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply" target="_blank" rel="external">MDN</a>. If you donâ€™t know JS well, you can read more about JSâ€™s this here: <a href="http://unschooled.org/2012/03/understanding-javascript-this/" target="_blank" rel="external">http://unschooled.org/2012/03/understanding-javascript-this/</a></p><p style="text-align: right;">â€”â€” æ‘˜è‡ª <a href="http://stackoverflow.com/questions/22842908/what-does-the-first-argument-of-functioncall-in-v8-engine-mean/22848601?noredirect=1#22848601" target="_blank" rel="external">StackOverflow</a></p></blockquote><p>ã€€ã€€æ€»ä¹‹å…¶ä½œç”¨å°±æ˜¯æŒ‡å®šäº†è¢«è°ƒç”¨å‡½æ•°çš„ <code>this</code> æŒ‡é’ˆã€‚è¿™ä¸ª <code>Call</code> çš„ç”¨æ³•å°±è·Ÿ JavaScript ä¸­çš„ <code>bind()</code>ã€<code>call()</code>ã€<code>apply()</code> ç±»ä¼¼ã€‚</p><p>ã€€ã€€æ‰€ä»¥æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯å…ˆæŠŠå‚æ•°è¡¨å»ºå¥½ï¼Œç„¶åä¼ å…¥è¿™ä¸ª <code>Call</code> å‡½æ•°ä¾›å…¶æ‰§è¡Œã€‚</p><p>ã€€ã€€ç¬¬ä¸€æ­¥ï¼Œæ˜¾ç¤ºè½¬æ¢å‡½æ•°ï¼Œå› ä¸ºæœ¬æ¥æ˜¯ <code>Object</code> ç±»å‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Local&lt;Function&gt; cb = Local&lt;Function&gt;::Cast(args[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç¬¬äºŒæ­¥ï¼Œå»ºç«‹å‚æ•°è¡¨ï¼ˆæ•°ç»„ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Local&lt;Value&gt; argv[argc] = &#123; Local&lt;Value&gt;::New(String::New(<span class="string">"hello world"</span>)) &#125;;</span><br></pre></td></tr></table></figure><h4 id="æœ€åè°ƒç”¨å‡½æ•°ç³»åˆ—"><a href="#æœ€åè°ƒç”¨å‡½æ•°ç³»åˆ—" class="headerlink" title="æœ€åè°ƒç”¨å‡½æ•°ç³»åˆ—"></a>æœ€åè°ƒç”¨å‡½æ•°ç³»åˆ—</h4><p>ã€€ã€€è°ƒç”¨ <code>cb</code> ï¼ŒæŠŠå‚æ•°ä¼ è¿›å»ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">cb-&gt;Call(Context::GetCurrent()-&gt;Global(), <span class="number">1</span>, argv);</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™é‡Œç¬¬ä¸€ä¸ªå‚æ•° <code>Context::GetCurrent()-&gt;Global()</code> æ‰€ä»£è¡¨çš„æ„æ€å°±æ˜¯è·å–å…¨å±€ä¸Šä¸‹æ–‡ä½œä¸ºå‡½æ•°çš„ <code>this</code>ï¼›ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å‚æ•°è¡¨ä¸­çš„ä¸ªæ•°ï¼ˆæ¯•ç«Ÿè™½ç„¶ <code>Node.js</code> çš„æ•°ç»„æ˜¯æœ‰é•¿åº¦å±æ€§çš„ï¼Œä½†æ˜¯ <code>C++</code> é‡Œé¢æ•°ç»„çš„é•¿åº¦å®é™…ä¸Šç³»ç»Ÿæ˜¯ä¸çŸ¥é“çš„ï¼Œè¿˜å¾—ä½ è‡ªå·±ä¼ è¿›ä¸€ä¸ªæ•°æ¥è¯´æ˜æ•°ç»„é•¿åº¦ï¼‰ï¼›æœ€åä¸€ä¸ªå‚æ•°å°±æ˜¯åˆšæ‰æˆ‘ä»¬å»ºç«‹å¥½çš„å‚æ•°è¡¨äº†ã€‚</p><h4 id="ç»ˆç« ä¹‹ç»“æŸæ–‡ä»¶ç³»åˆ—"><a href="#ç»ˆç« ä¹‹ç»“æŸæ–‡ä»¶ç³»åˆ—" class="headerlink" title="ç»ˆç« ä¹‹ç»“æŸæ–‡ä»¶ç³»åˆ—"></a>ç»ˆç« ä¹‹ç»“æŸæ–‡ä»¶ç³»åˆ—</h4><p>ã€€ã€€ç›¸ä¿¡è¿™ä¸€æ­¥å¤§å®¶å·²ç»è½»è½¦ç†Ÿè·¯äº†å§ï¼Œå°±æ˜¯æŠŠå‡½æ•°å†™å¥½ï¼Œç„¶åæ”¾è¿›å¯¼å‡ºå‡½æ•°é‡Œé¢ï¼Œæœ€åç”³æ˜ä¸€ä¸‹ã€‚</p><p>ã€€ã€€æˆ‘å°±ç›´æ¥æ”¾å‡ºä»£ç å§ï¼Œæˆ–è€…ç›´æ¥è·‘å» <code>Node.js</code> çš„<a href="http://nodejs.org/api/addons.html#addons_callbacks" target="_blank" rel="external">æ–‡æ¡£</a>çœ‹ä¹Ÿè¡Œã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;node.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> v8;</span><br><span class="line"></span><br><span class="line">Handle&lt;Value&gt; RunCallback(<span class="keyword">const</span> Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line">    Local&lt;Function&gt; cb = Local&lt;Function&gt;::Cast(args[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">unsigned</span> argc = <span class="number">1</span>;</span><br><span class="line">    Local&lt;Value&gt; argv[argc] = &#123; Local&lt;Value&gt;::New(String::New(<span class="string">"hello world"</span>)) &#125;;</span><br><span class="line">    cb-&gt;Call(Context::GetCurrent()-&gt;Global(), argc, argv);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> scope.Close(Undefined());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Handle&lt;Object&gt; exports, Handle&lt;Object&gt; <span class="keyword">module</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">module</span>-&gt;Set(String::NewSymbol(<span class="string">"exports"</span>),</span><br><span class="line">        FunctionTemplate::New(RunCallback)-&gt;GetFunction());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NODE_MODULE(addon, Init)</span><br></pre></td></tr></table></figure><p>ã€€ã€€Well done! æœ€åå‰©ä¸‹çš„æ­¥éª¤å°±è‡ªå·±å»å§ã€‚è‡³äº <code>Js</code> é‡Œé¢è¿™ä¹ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘åœ¨<a href="#å›è°ƒå‡½æ•°">ä¹‹å‰</a>å·²ç»æåˆ°è¿‡äº†ã€‚</p><h2 id="ç•ªå¤–"><a href="#ç•ªå¤–" class="headerlink" title="ç•ªå¤–"></a>ç•ªå¤–</h2><p>ã€€ã€€å˜›å˜›ï¼Œæˆ‘æ„Ÿè§‰æˆ‘çš„å­¦ä¹ ç¬”è®°å†™å¾—è¶Šæ¥è¶Šå¥”æ”¾äº†æ±‚ç ´ï½</p><p>ã€€ã€€ä»Šå¤©å°±å…ˆå†™åˆ°è¿™é‡Œå§ï¼Œå†™å­¦ä¹ ç¬”è®°çš„è¿‡ç¨‹ä¸­æˆ‘åˆæ¶¨å§¿åŠ¿äº†ï¼Œæ¯”å¦‚è¯´é‚£ä¸ª <code>Call</code> å‡½æ•°çš„å‚æ•°æ„ä¹‰ã€‚</p><p>ã€€ã€€å¦‚æœä½ ä»¬è§‰å¾—æœ¬ç³»åˆ—å­¦ä¹ ç¬”è®°å¯¹ä½ ä»¬è¿˜æœ‰å¸®åŠ©çš„è¯ï¼Œå°±æ¥å’Œæˆ‘ä¸€èµ·æåŸºå§ä¹ˆä¹ˆå“’ï½Î£&gt;â€•(ã€ƒÂ°Ï‰Â°ã€ƒ)â™¡â†’</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€å¥½ï¼Œä»Šå¤©è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°æåŸºå§ï¼&lt;/p&gt;
&lt;h2 id=&quot;æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºæ¹¿çŸ£&quot;&gt;&lt;a href=&quot;#æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºæ¹¿çŸ£&quot; class=&quot;headerlink&quot; title=&quot;æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºæ¹¿çŸ£&quot;&gt;&lt;/a&gt;æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºæ¹¿çŸ£&lt;/h2&gt;&lt;p&gt;ã€€ã€€é¦–å…ˆè¯·å¤§å®¶è®°ä½
      
    
    </summary>
    
      <category term="NodeJS" scheme="https://xcoder.in/categories/NodeJS/"/>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>è®©Node.jså’ŒC++ä¸€èµ·æåŸº â€”â€” 1</title>
    <link href="https://xcoder.in/2014/04/02/nodejs-cpp-addons-1/"/>
    <id>https://xcoder.in/2014/04/02/nodejs-cpp-addons-1/</id>
    <published>2014-04-01T16:53:22.000Z</published>
    <updated>2017-12-11T07:59:20.527Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€Nä¹…ä¹‹å‰çš„ä¸€ä¸ªå‘â€”â€”ç”¨ <strong>Node.js</strong> æ¥é‡æ„ NBUT çš„ <strong>Online Judge</strong>ï¼ŒåŒ…æ‹¬è¯„æµ‹ç«¯ä¹Ÿå¾—é‡æ„ä¸€éã€‚ï¼ˆè‡³äºä»€ä¹ˆæ—¶å€™å®Œæˆå¤§å®¶å°±ä¸è¦å…³å¿ƒäº†ï¼Œ(ï¼â€µĞ”â€²)ï¼~ â•§â•§</p><p>ã€€ã€€æ€»ä¹‹æˆ‘ä»¬ç°åœ¨è¦åšçš„å…¶å®ç®€è€Œè¨€ä¹‹å°±æ˜¯â€”â€”ç”¨C/C++æ¥å®ç° <strong>Node.js</strong> çš„æ¨¡å—ã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>ã€€ã€€å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆ<del>è€æµæ°“</del>åˆ©å…¶å™¨ã€‚</p><h3 id="node-gyp"><a href="#node-gyp" class="headerlink" title="node-gyp"></a>node-gyp</h3><p>ã€€ã€€é¦–å…ˆä½ éœ€è¦ä¸€ä¸ª <code>node-gyp</code> æ¨¡å—ã€‚</p><p>ã€€ã€€åœ¨ä»»æ„è§’è½ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight plain"><figcaption><span>shell</span></figcaption><table><tr><td class="code"><pre><span class="line">$ npm install node-gyp -g</span><br></pre></td></tr></table></figure><p>ã€€ã€€åœ¨è¿›è¡Œä¸€ç³»åˆ—çš„ <code>blahblah</code> ä¹‹åï¼Œä½ å°±å®‰è£…å¥½äº†ã€‚</p><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>ã€€ã€€ç„¶åä½ éœ€è¦æœ‰ä¸ª <code>python</code> ç¯å¢ƒã€‚</p><p>ã€€ã€€è‡ªå·±å»<a href="http://python.org/" target="_blank" rel="external">å®˜ç½‘</a>æä¸€ä¸ªæ¥ã€‚</p><blockquote><p><strong>æ³¨æ„ï¼š</strong> æ ¹æ® <code>node-gyp</code> çš„<a href="https://github.com/TooTallNate/node-gyp#installation" target="_blank" rel="external">GitHub</a>æ˜¾ç¤ºï¼Œè¯·åŠ¡å¿…ä¿è¯ä½ çš„ <code>python</code> ç‰ˆæœ¬ä»‹äº <code>2.5.0</code> å’Œ <code>3.0.0</code> ä¹‹é—´ã€‚</p></blockquote><h3 id="ç¼–è¯‘ç¯å¢ƒ"><a href="#ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="ç¼–è¯‘ç¯å¢ƒ"></a>ç¼–è¯‘ç¯å¢ƒ</h3><p>ã€€ã€€å˜›å˜›ï¼Œæˆ‘å°±å·æ‡’ç‚¹ä¸ç»†å†™äº†ï¼Œè¿˜è¯·è‡ªå·±ç§»æ­¥åˆ° <a href="https://github.com/TooTallNate/node-gyp#installation" target="_blank" rel="external">node-gyp</a> å»çœ‹ç¼–è¯‘å™¨çš„éœ€æ±‚ã€‚å¹¶ä¸”å€’è…¾å¥½ã€‚</p><h2 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h2><p>ã€€ã€€æˆ‘å°±æ‹¿<a href="http://nodejs.org/api/addons.html#addons_hello_world" target="_blank" rel="external">å®˜ç½‘çš„å…¥é—¨ Hello World</a>è¯´äº‹å„¿äº†ã€‚</p><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><p>ã€€ã€€è¯·å‡†å¤‡ä¸€ä¸ª <code>C++</code> æ–‡ä»¶ï¼Œæ¯”å¦‚å°±å« <del>sb.cc</del> hello.ccã€‚</p><p>ã€€ã€€ç„¶åæˆ‘ä»¬ä¸€æ­¥æ­¥æ¥ï¼Œå…ˆå¾€é‡Œé¢æå‡ºå¤´æ–‡ä»¶å’Œå®šä¹‰å¥½å‘½åç©ºé—´ï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">#include &lt;node.h&gt;</span><br><span class="line">#include &lt;v8.h&gt;</span><br><span class="line">using namespace v8;</span><br></pre></td></tr></table></figure><h4 id="ä¸»è¦å‡½æ•°"><a href="#ä¸»è¦å‡½æ•°" class="headerlink" title="ä¸»è¦å‡½æ•°"></a>ä¸»è¦å‡½æ•°</h4><p>ã€€ã€€æ¥ä¸‹å»æˆ‘ä»¬å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶è¿”å›å€¼æ˜¯ <code>Handle&lt;Value&gt;</code>ã€‚</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">Handle&lt;Value&gt; Hello(const Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    //... å—·å—·å¾…å†™</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åæˆ‘æ¥ç²—ç²—è§£æä¸€ä¸‹è¿™äº›ä¸œè¥¿ï¼š</p><h5 id="Handle-lt-Value-gt"><a href="#Handle-lt-Value-gt" class="headerlink" title="Handle&lt;Value&gt;"></a>Handle&lt;Value&gt;</h5><p>ã€€ã€€åšäººè¦æœ‰èŠ‚æ“ï¼Œæˆ‘äº‹å…ˆç”³æ˜æˆ‘æ˜¯ä»<a href="http://cnodejs.org/topic/4f16442ccae1f4aa270010c5" target="_blank" rel="external">è¿™é‡Œ</a>(<a href="http://cnodejs.org/user/fool" target="_blank" rel="external">@fool</a>)å‚è€ƒçš„ã€‚</p><blockquote><p>V8 é‡Œä½¿ç”¨ Handle ç±»å‹æ¥æ‰˜ç®¡ JavaScript å¯¹è±¡ï¼Œä¸ C++ çš„ std::sharedpointer ç±»ä¼¼ï¼ŒHandle ç±»å‹é—´çš„èµ‹å€¼å‡æ˜¯ç›´æ¥ä¼ é€’å¯¹è±¡å¼•ç”¨ï¼Œä½†ä¸åŒçš„æ˜¯ï¼ŒV8 ä½¿ç”¨è‡ªå·±çš„ GC æ¥ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä¸æ˜¯æ™ºèƒ½æŒ‡é’ˆå¸¸ç”¨çš„å¼•ç”¨è®¡æ•°ã€‚</p><p>JavaScript ç±»å‹åœ¨ C++ ä¸­å‡æœ‰å¯¹åº”çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå¦‚ String ã€ Integer ã€ Object ã€ Date ã€ Array ç­‰ï¼Œä¸¥æ ¼éµå®ˆåœ¨ JavaScript ä¸­çš„ç»§æ‰¿å…³ç³»ã€‚ C++ ä¸­ä½¿ç”¨è¿™äº›ç±»å‹æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ Handle æ‰˜ç®¡ï¼Œä»¥ä½¿ç”¨ GC æ¥ç®¡ç†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä¸ä½¿ç”¨åŸç”Ÿæ ˆå’Œå †ã€‚</p></blockquote><p>ã€€ã€€è€Œè¿™ä¸ªæ‰€è°“çš„ <strong>Value</strong> ï¼Œä» V8 å¼•æ“çš„å¤´æ–‡ä»¶ <a href="http://code.google.com/p/v8/source/browse/trunk/include/v8.h#1417" target="_blank" rel="external">v8.h</a> ä¸­çš„å„ç§ç»§æ‰¿å…³ç³»ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œå…¶å®å°±æ˜¯ JavaScript ä¸­å„ç§å¯¹è±¡çš„åŸºç±»ã€‚</p><p>ã€€ã€€åœ¨äº†è§£äº†è¿™ä»¶äº‹ä¹‹åï¼Œæˆ‘ä»¬å¤§è‡´èƒ½æ˜ç™½ä¸Šé¢é‚£æ®µå‡½æ•°çš„ç”³æ˜çš„æ„æ€å°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ª <code>Hello</code> å‡½æ•°ï¼Œå…¶è¿”å›çš„æ˜¯ä¸€ä¸ªä¸å®šç±»å‹çš„å€¼ã€‚</p><blockquote><p><strong>æ³¨æ„ï¼š</strong> æˆ‘ä»¬åªèƒ½è¿”å›ç‰¹å®šçš„ç±»å‹ï¼Œå³åœ¨ Handle æ‰˜ç®¡ä¸‹çš„ String å•Š Integer å•Šç­‰ç­‰ç­‰ç­‰ã€‚</p></blockquote><h5 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h5><p>ã€€ã€€è¿™ä¸ªå°±æ˜¯ä¼ å…¥è¿™ä¸ªå‡½æ•°çš„å‚æ•°äº†ã€‚æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ <code>Node.js</code> ä¸­ï¼Œå‚æ•°ä¸ªæ•°æ˜¯ä¹±æ¥çš„ã€‚è€Œè¿™äº›å‚æ•°ä¼ è¿›å»åˆ° <code>C++</code> ä¸­çš„æ—¶å€™ï¼Œå°±è½¬å˜æˆäº†è¿™ä¸ª <code>Arguments</code> ç±»å‹çš„å¯¹è±¡äº†ã€‚</p><p>ã€€ã€€å…·ä½“çš„ç”¨æ³•æˆ‘ä»¬åœ¨åé¢å†è¯´ï¼Œåœ¨è¿™é‡Œåªéœ€è¦æ˜ç™½è¿™ä¸ªæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å°±å¥½ã€‚ï¼ˆä¸ºæ¯›è¦å–å…³å­ï¼Ÿå› ä¸º <code>Node.js</code> å®˜æ–¹æ–‡æ¡£ä¸­çš„<a href="https://github.com/rvagg/node-addon-examples" target="_blank" rel="external">ä¾‹å­</a>å°±æ˜¯åˆ†å¼€æ¥è®²çš„ï¼Œæˆ‘ç°åœ¨åªæ˜¯è®²ç¬¬ä¸€ä¸ª <code>Hello World</code> çš„ä¾‹å­è€Œå·²( Â´à°¥à±ªà°¥ï¼‰Ïƒ</p><h4 id="æ·»ç –åŠ ç“¦"><a href="#æ·»ç –åŠ ç“¦" class="headerlink" title="æ·»ç –åŠ ç“¦"></a>æ·»ç –åŠ ç“¦</h4><p>ã€€ã€€æ¥ä¸‹å»æˆ‘ä»¬å°±å¼€å§‹æ·»ç –åŠ ç“¦äº†ã€‚å°±æœ€ç®€å•çš„ä¸¤å¥è¯ï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">Handle&lt;Value&gt; Hello(const Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line">    return scope.Close(String::New(&quot;world&quot;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸¤å¥è¯æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¤§è‡´çš„æ„æ€å°±æ˜¯è¿”å›ä¸€ä¸ª <code>Node.js</code> ä¸­çš„å­—ç¬¦ä¸² <code>&quot;world&quot;</code>ã€‚</p><h5 id="HandleScope"><a href="#HandleScope" class="headerlink" title="HandleScope"></a>HandleScope</h5><p>ã€€ã€€åŒå‚è€ƒè‡ª<a href="http://cnodejs.org/topic/4f16442ccae1f4aa270010c5" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p><blockquote><p>Handle çš„ç”Ÿå‘½å‘¨æœŸå’Œ C++ æ™ºèƒ½æŒ‡é’ˆä¸åŒï¼Œå¹¶ä¸æ˜¯åœ¨ C++ è¯­ä¹‰çš„ scope å†…ç”Ÿå­˜ï¼ˆå³{} åŒ…å›´çš„éƒ¨åˆ†ï¼‰ï¼Œè€Œéœ€è¦é€šè¿‡ HandleScope æ‰‹åŠ¨æŒ‡å®šã€‚HandleScope åªèƒ½åˆ†é…åœ¨æ ˆä¸Šï¼ŒHandleScope å¯¹è±¡å£°æ˜åï¼Œå…¶åå»ºç«‹çš„ Handle éƒ½ç”± HandleScope æ¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼ŒHandleScope å¯¹è±¡ææ„åï¼Œå…¶ç®¡ç†çš„ Handle å°†ç”± GC åˆ¤æ–­æ˜¯å¦å›æ”¶ã€‚</p></blockquote><p>ã€€ã€€æ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬å¾—åœ¨éœ€è¦ç®¡ç†ä»–çš„ç”Ÿå‘½å‘¨æœŸçš„æ—¶å€™ç”³æ˜è¿™ä¸ª <code>Scope</code> ã€‚å¥½çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ä»£ç ä¸è¿™ä¹ˆå†™å‘¢ï¼Ÿ</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">Handle&lt;Value&gt; Hello(const Arguments&amp; args)</span><br><span class="line">&#123;</span><br><span class="line">    HandleScope scope;</span><br><span class="line">    return String::New(&quot;world&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å› ä¸ºå½“å‡½æ•°è¿”å›æ—¶ï¼Œ<code>scope</code> ä¼šè¢«ææ„ï¼Œå…¶ç®¡ç†çš„Handleä¹Ÿéƒ½å°†è¢«å›æ”¶ï¼Œæ‰€ä»¥è¿™ä¸ª <code>String</code> å°±ä¼šå˜å¾—æ²¡æœ‰æ„ä¹‰ã€‚</p><p>ã€€ã€€æ‰€ä»¥å‘¢ V8 å°±æƒ³å‡ºäº†ä¸ªç¥å¥‡çš„ç‚¹å­â€”â€”<code>HandleScope::Close(Handle&lt;T&gt; Value)</code> å‡½æ•°ï¼è¿™ä¸ªå‡½æ•°çš„ç”¨å¤„å°±æ˜¯å…³é—­è¿™ä¸ª Scope å¹¶ä¸”æŠŠé‡Œé¢çš„å‚æ•°è½¬äº¤ç»™ä¸Šä¸€ä¸ª Scope ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯è¿›å…¥è¿™ä¸ªå‡½æ•°å‰çš„ Scopeã€‚</p><p>ã€€ã€€äºæ˜¯å°±æœ‰äº†æˆ‘ä»¬ä¹‹å‰çš„ä»£ç  <code>scope.Close(String::New(&quot;world&quot;));</code>ã€‚</p><h5 id="String-New"><a href="#String-New" class="headerlink" title="String::New"></a>String::New</h5><p>ã€€ã€€è¿™ä¸ª <code>String</code> ç±»æ‰€å¯¹åº”çš„å°±æ˜¯ <code>Node.js</code> ä¸­åŸç”Ÿçš„å­—ç¬¦ä¸²ç±»ã€‚ç»§æ‰¿è‡ª <code>Value</code> ç±»ã€‚ä¸æ­¤ç±»ä¼¼ï¼Œè¿˜æœ‰ï¼š</p><ul><li>Array</li><li>Integer</li><li>Boolean</li><li>Object</li><li>Date</li><li>Number</li><li>Function</li><li>â€¦</li></ul><p>ã€€ã€€è¿™äº›ä¸œè¥¿æœ‰äº›æ˜¯ç»§æ‰¿è‡ª <code>Value</code>ï¼Œæœ‰äº›æ˜¯äºŒæ¬¡ç»§æ‰¿ã€‚æˆ‘ä»¬è¿™é‡Œå°±ä¸å¤šåšç ”ç©¶ï¼Œè‡ªå·±å¯ä»¥çœ‹çœ‹ V8 çš„ä»£ç ï¼ˆè‡³å°‘æ˜¯å¤´æ–‡ä»¶ï¼‰ç ”ç©¶ç ”ç©¶æˆ–è€…çœ‹çœ‹è¿™ä¸ª<a href="http://bespin.cz/~ondras/html/classv8_1_1Value.html#a70d4afaccc7903e6a01f40a46ad04188" target="_blank" rel="external">æ‰‹å†Œ</a>ã€‚</p><p>ã€€ã€€è€Œè¿™ä¸ª <code>New</code> å‘¢ï¼Ÿ<a href="http://bespin.cz/~ondras/html/classv8_1_1String.html" target="_blank" rel="external">è¿™é‡Œ</a>å¯ä»¥çœ‹çš„ã€‚å°±æ˜¯æ–°å»ºä¸€ä¸ª <code>String</code> å¯¹è±¡ã€‚</p><p>ã€€ã€€è‡³æ­¤ï¼Œè¿™ä¸ªä¸»è¦å‡½æ•°æˆ‘ä»¬å°±è§£æå®Œæ¯•äº†ã€‚</p><h4 id="å¯¼å‡ºå¯¹è±¡"><a href="#å¯¼å‡ºå¯¹è±¡" class="headerlink" title="å¯¼å‡ºå¯¹è±¡"></a>å¯¼å‡ºå¯¹è±¡</h4><p>ã€€ã€€æˆ‘ä»¬æ¥æ¸©ä¹ ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯åœ¨ <code>Node.js</code> é‡Œé¢å†™çš„è¯ï¼Œæˆ‘ä»¬æ€ä¹ˆå¯¼å‡ºå‡½æ•°æˆ–è€…å¯¹è±¡ä»€ä¹ˆçš„å‘¢ï¼Ÿ</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">exports.hello = function() &#123;&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€é‚£ä¹ˆï¼Œåœ¨ <code>C++</code> ä¸­æˆ‘ä»¬è¯¥å¦‚ä½•åšåˆ°è¿™ä¸€æ­¥å‘¢ï¼Ÿ</p><h5 id="åˆå§‹åŒ–å‡½æ•°"><a href="#åˆå§‹åŒ–å‡½æ•°" class="headerlink" title="åˆå§‹åŒ–å‡½æ•°"></a>åˆå§‹åŒ–å‡½æ•°</h5><p>ã€€ã€€é¦–å…ˆï¼Œæˆ‘ä»¬å†™ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">void init(Handle&lt;Object&gt; exports)</span><br><span class="line">&#123;</span><br><span class="line">    //... å—·å—·å¾…å†™ä½ å¦¹å•Šï¼#ï¾ŸÃ…ï¾Ÿï¼‰âŠ‚å½¡â˜†))ï¾ŸĞ”ï¾Ÿ)ï½¥âˆµ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™æ˜¯é¾Ÿè…šï¼å‡½æ•°åä»€ä¹ˆçš„æ— æ‰€è°“ï¼Œä½†æ˜¯ä¼ å…¥çš„å‚æ•°ä¸€å®šæ˜¯ä¸€ä¸ª <code>Handle&amp;lt;Object&gt;</code>ï¼Œä»£è¡¨æˆ‘ä»¬ä¸‹é¢å°†è¦åœ¨è¿™è´§ä¸Šå¯¼å‡ºä¸œè¥¿ã€‚</p><p>ã€€ã€€ç„¶åï¼Œæˆ‘ä»¬å°±åœ¨è¿™é‡Œé¢å†™ä¸Šå¯¼å‡ºçš„ä¸œè¥¿äº†ï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">void init(Handle&lt;Object&gt; exports)</span><br><span class="line">&#123;</span><br><span class="line">    exports-&gt;Set(String::NewSymbol(&quot;hello&quot;),</span><br><span class="line">        FunctionTemplate::New(Hello)-&gt;GetFunction());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¤§è‡´çš„æ„æ€å°±æ˜¯è¯´ï¼Œä¸ºè¿™ä¸ª <code>exports</code> å¯¹è±¡æ·»åŠ ä¸€ä¸ªå­—æ®µå« <code>hello</code>ï¼Œæ‰€å¯¹åº”çš„ä¸œè¥¿æ˜¯ä¸€ä¸ª<a href="http://bespin.cz/~ondras/html/classv8_1_1FunctionTemplate.html" target="_blank" rel="external">å‡½æ•°</a>ï¼Œè€Œè¿™ä¸ªå‡½æ•°å°±æ˜¯æˆ‘ä»¬äº²çˆ±çš„ <code>Hello</code> å‡½æ•°äº†ã€‚</p><p>ã€€ã€€ç”¨ä¼ªä»£ç å†™ç›´ç™½ç‚¹å°±æ˜¯ï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">void init(Handle&lt;Object&gt; exports)</span><br><span class="line">&#123;</span><br><span class="line">    exports.Set(&quot;hello&quot;, function hello);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¤§åŠŸå‘Šæˆï¼</p><p>ã€€ã€€ï¼ˆå¤§åŠŸå‘Šæˆä½ å¦¹å•Šï¼é—­å˜´( â€˜Ğ´â€˜âŠ‚å½¡â˜†))Ğ”Â´)</p><h5 id="çœŸÂ·å¯¼å‡º"><a href="#çœŸÂ·å¯¼å‡º" class="headerlink" title="çœŸÂ·å¯¼å‡º"></a>çœŸÂ·å¯¼å‡º</h5><p>ã€€ã€€è¿™æ‰æ˜¯æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬æœ€åè¦ç”³æ˜ï¼Œè¿™ä¸ªå°±æ˜¯å¯¼å‡ºçš„å…¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä»£ç çš„æœ«å°¾åŠ ä¸Šè¿™ä¸€è¡Œï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">NODE_MODULE(hello, init)</span><br></pre></td></tr></table></figure><p>ã€€ã€€çº³äº†ä¸ªå°¼ï¼Ÿï¼è¿™åˆæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</p><p>ã€€ã€€åˆ«ç€æ€¥ï¼Œè¿™ä¸ª <code>NODE_MODULE</code> æ˜¯ä¸€ä¸ªå®ï¼Œå®ƒçš„æ„æ€å‘¢å°±æ˜¯è¯´æˆ‘ä»¬é‡‡ç”¨ <code>init</code> è¿™ä¸ªåˆå§‹åŒ–å‡½æ•°æ¥æŠŠè¦å¯¼å‡ºçš„ä¸œè¥¿å¯¼å‡ºåˆ° <code>hello</code> ä¸­ã€‚é‚£ä¹ˆè¿™ä¸ª <code>hello</code> å“ªæ¥å‘¢ï¼Ÿ</p><p>ã€€ã€€<strong>å®ƒæ¥è‡ªæ–‡ä»¶åï¼</strong>å¯¹ï¼Œæ²¡é”™ï¼Œå®ƒæ¥è‡ªæ–‡ä»¶åã€‚ä½ å¹¶ä¸éœ€è¦äº‹å…ˆç”³æ˜å®ƒï¼Œä½ ä¹Ÿä¸å¿…æ‹…å¿ƒä¸èƒ½ç”¨ï¼Œæ€»ä¹‹ä½ çš„è¿™ä¸ªæœ€ç»ˆç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶åå«ä»€ä¹ˆï¼Œè¿™é‡Œçš„ <code>hello</code> ä½ å°±å¡«ä»€ä¹ˆï¼Œå½“ç„¶è¦é™¤å»åç¼€åäº†ã€‚</p><p>ã€€ã€€è¯¦è§<a href="http://nodejs.org/api/addons.html#addons_hello_world" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><blockquote><p>Note that all Node addons must export an initialization function:</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">void Initialize (Handle&lt;Object&gt; exports);</span><br><span class="line">NODE_MODULE(module_name, Initialize)</span><br></pre></td></tr></table></figure><p>There is no semi-colon after NODE_MODULE as itâ€™s not a function (see node.h).</p><p>The module_name needs to match the filename of the final binary (minus the .node suffix).</p></blockquote><h3 id="ç¼–è¯‘-à¹‘â€¢Ì-â‚ƒ-â€¢Ì€à¹‘"><a href="#ç¼–è¯‘-à¹‘â€¢Ì-â‚ƒ-â€¢Ì€à¹‘" class="headerlink" title="ç¼–è¯‘ (à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘)"></a>ç¼–è¯‘ (à¹‘â€¢Ì â‚ƒ â€¢Ì€à¹‘)</h3><p>ã€€ã€€æ¥å§ï¼Œè®©æˆ‘ä»¬ä¸€èµ·ç¼–è¯‘å§ï¼</p><p>ã€€ã€€æˆ‘ä»¬å†æ–°å»ºä¸€ä¸ªç±»ä¼¼äº <code>Makefile</code> çš„å½’æ¡£æ–‡ä»¶å§â€”â€”<code>binding.gyp</code>ã€‚</p><p>ã€€ã€€å¹¶ä¸”åœ¨é‡Œé¢æ·»åŠ è¿™æ ·çš„<a href="https://github.com/TooTallNate/node-gyp#the-bindinggyp-file" target="_blank" rel="external">ä»£ç </a>ï¼š</p><figure class="highlight plain"><figcaption><span>json</span></figcaption><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;targets&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;target_name&quot;: &quot;hello&quot;,</span><br><span class="line">      &quot;sources&quot;: [ &quot;hello.cc&quot; ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™å‘¢ï¼Ÿå¯ä»¥å‚è€ƒ <code>node-gyp</code> çš„<a href="http://code.google.com/p/gyp/wiki/GypUserDocumentation#Skeleton_of_a_typical_Chromium_.gyp_file" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h4 id="configure"><a href="#configure" class="headerlink" title="configure"></a>configure</h4><p>ã€€ã€€åœ¨æ–‡ä»¶æå¥½ä¹‹åï¼Œæˆ‘ä»¬è¦åœ¨è¿™ä¸ªç›®å½•ä¸‹é¢æ‰§è¡Œè¿™ä¸ªå‘½ä»¤äº†ï¼š</p><figure class="highlight plain"><figcaption><span>shell</span></figcaption><table><tr><td class="code"><pre><span class="line">$ node-gyp configure</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œåº”è¯¥ä¼šç”Ÿæˆä¸€ä¸ª <code>build</code> çš„ç›®å½•ï¼Œç„¶åé‡Œé¢æœ‰ç›¸å…³æ–‡ä»¶ï¼Œä¹Ÿè®¸æ˜¯ <strong>M$ Visual Studio</strong> çš„ <code>vcxproj</code> æ–‡ä»¶ç­‰ï¼Œä¹Ÿè®¸æ˜¯ <code>Makefile</code> ï¼Œè§†å¹³å°è€Œå®šã€‚</p><h4 id="build"><a href="#build" class="headerlink" title="build"></a>build</h4><p>ã€€ã€€<code>Makefile</code> ä¹Ÿç”Ÿæˆå¥½ä¹‹åï¼Œæˆ‘ä»¬å°±å¼€å§‹æ„é€ ç¼–è¯‘äº†ï¼š</p><figure class="highlight plain"><figcaption><span>shell</span></figcaption><table><tr><td class="code"><pre><span class="line">$ node-gyp build</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç­‰åˆ°ä¸€åˆ‡ç¼–è¯‘å®Œæˆï¼Œæ‰ç®—æ˜¯çœŸæ­£çš„å¤§åŠŸå‘Šæˆäº†ï¼ä¸ä¿¡ä½ å»çœ‹çœ‹ <code>build/Release</code> ç›®å½•ï¼Œä¸‹é¢æ˜¯ä¸æ˜¯æœ‰ä¸€ä¸ª <code>hello.node</code> æ–‡ä»¶äº†ï¼Ÿæ²¡é”™ï¼Œè¿™ä¸ªå°±æ˜¯ C++ ç­‰ä¸‹è¦ç»™ Node.js æ¡çš„è‚¥çš‚ï¼</p><h3 id="æåŸºå§ï¼Node-ãƒ½-âœ¿ï¾Ÿâ–½ï¾Ÿ-ãƒ-C"><a href="#æåŸºå§ï¼Node-ãƒ½-âœ¿ï¾Ÿâ–½ï¾Ÿ-ãƒ-C" class="headerlink" title="æåŸºå§ï¼Node ãƒ½(âœ¿ï¾Ÿâ–½ï¾Ÿ)ãƒ C++"></a>æåŸºå§ï¼Node ãƒ½(âœ¿ï¾Ÿâ–½ï¾Ÿ)ãƒ C++</h3><p>ã€€ã€€æˆ‘ä»¬åœ¨åˆšæ‰é‚£ä¸ªç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ <code>jianfeizao.js</code>ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var addon = require(&quot;./build/Release/hello&quot;);</span><br><span class="line">console.log(addon.hello());</span><br></pre></td></tr></table></figure><p>ã€€ã€€çœ‹åˆ°æ²¡ï¼çœ‹åˆ°æ²¡ï¼å‡ºæ¥äº†å‡ºæ¥äº†ï¼Node.js å’Œ C++ æåŸºçš„ç»“æœï¼è¿™ä¸ª <code>addon.hello()</code> å°±æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨ C++ ä»£ç ä¸­å†™çš„ <code>Handle&lt;Value&gt; Hello(const Arguments&amp; args)</code> äº†ï¼Œæˆ‘ä»¬ç°åœ¨å°±å·²ç»æŠŠå®ƒè¿”å›çš„å€¼ç»™è¾“å‡ºäº†ã€‚</p><h2 id="æ´—æ´—ç¡å§ï¼Œä¸‹èŠ‚æ›´æ·±å…¥"><a href="#æ´—æ´—ç¡å§ï¼Œä¸‹èŠ‚æ›´æ·±å…¥" class="headerlink" title="æ´—æ´—ç¡å§ï¼Œä¸‹èŠ‚æ›´æ·±å…¥"></a>æ´—æ´—ç¡å§ï¼Œä¸‹èŠ‚æ›´æ·±å…¥</h2><p>ã€€ã€€æ—¶é—´ä¸æ—©äº†ï¼Œä»Šå¤©å°±å†™åˆ°è¿™é‡Œäº†ï¼Œè‡³æ­¤ä¸ºæ­¢å¤§å®¶éƒ½èƒ½æå‡ºæœ€åŸºç¡€çš„ <strong>Hello world</strong> çš„ C++ æ‰©å±•äº†å§ã€‚ä¸‹ä¸€æ¬¡å†™çš„åº”è¯¥ä¼šæ›´æ·±å…¥ä¸€ç‚¹ï¼Œè‡³äºä¸‹ä¸€æ¬¡æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å•¦å…¶å®ã€‚<br>ã€€ã€€ï¼ˆå–‚å–‚å–‚ï¼Œæ’¸ä¸»æ€ä¹ˆå¯ä»¥è¿™ä¹ˆä¸è´Ÿè´£ï¼(ï½ï¾Ÿï¾›ï¾Ÿ)â”Œâ”›Î£(ï¾‰Â´<em>Ï‰</em>`)ï¾‰</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€Nä¹…ä¹‹å‰çš„ä¸€ä¸ªå‘â€”â€”ç”¨ &lt;strong&gt;Node.js&lt;/strong&gt; æ¥é‡æ„ NBUT çš„ &lt;strong&gt;Online Judge&lt;/strong&gt;ï¼ŒåŒ…æ‹¬è¯„æµ‹ç«¯ä¹Ÿå¾—é‡æ„ä¸€éã€‚ï¼ˆè‡³äºä»€ä¹ˆæ—¶å€™å®Œæˆå¤§å®¶å°±ä¸è¦å…³å¿ƒäº†ï¼Œ(ï¼â€µĞ”â€²)ï¼~ â•§â•§&lt;/p&gt;
&lt;p&gt;ã€€ã€€æ€»ä¹‹æˆ‘ä»¬ç°åœ¨
      
    
    </summary>
    
      <category term="NodeJS" scheme="https://xcoder.in/categories/NodeJS/"/>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>ï½å…¬ä¼—æ¡£æ‰€ï½é¡¹ç›®è§£æ</title>
    <link href="https://xcoder.in/2014/03/27/node-public-file-house/"/>
    <id>https://xcoder.in/2014/03/27/node-public-file-house/</id>
    <published>2014-03-26T17:34:04.000Z</published>
    <updated>2017-12-11T07:59:20.525Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€æ‰€è°“â€œå…¬ä¼—æ¡£æ‰€â€ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå…¬å…±çš„ä¸´æ—¶ç½‘ç›˜äº†ã€‚è¿™ä¸ªä¸œè¥¿æ˜¯ä¸€ä¸ªè€ç‰©äº†ï¼Œåœ¨æˆ‘åˆšæ¥è§¦ <code>Expressjs</code> çš„æ—¶å€™å†™çš„ã€‚å½“æ—¶è¿˜éšä¾¿æäº†ä¸€ä¸‹ <code>backbone.js</code>ï¼Œä½†æ˜¯æ²¡æœ‰æ·±å…¥ï¼Œå‹¿ç¬‘ã€‚å…³äºæ·±å…¥æ„æ¶ <code>Expressjs</code> æ–¹é¢ä¹Ÿæ²¡åšï¼Œåªæ˜¯ç²—ç²—å†™äº†ä¸‹æœ€åŸºç¡€çš„è·¯ç”±ï¼Œæ‰€ä»¥æ•´ä¸ªæ–‡ä»¶ç»“æ„ä¹Ÿä¸æ˜¯å¾ˆè§„èŒƒã€‚ä½†æ˜¯åº”è¯¥èƒ½æ¯”è¾ƒé€‚åˆåˆšå­¦ <code>Node.js</code> ä»¥åŠåˆšæ¥è§¦ <code>Expressjs</code> çš„äººå§ã€‚</p><p>ã€€ã€€Repoåœ°å€åœ¨<a href="https://github.com/XadillaX/public-file-house" target="_blank" rel="external">æˆ‘çš„Github</a>ä¸Šã€‚Demoåœ°å€åœ¨ <a href="http://dang.kacaka.ca/" target="_blank" rel="external">http://dang.kacaka.ca/</a>ï¼Œç”±äºä¸ªäººç”µè„‘çš„ä¸ç¨³å®šæ€§ï¼Œæ‰€ä»¥ä¸ä¿è¯ä½ ä»¬éšæ—¶å¯ä»¥è®¿é—®ï¼Œä¿ä¸å®šå“ªå¤©å°±å¤±æ•ˆäº†ï¼Œæ‰€ä»¥æœ€å¥½çš„åŠæ³•è¿˜æ˜¯è‡ªå·± <code>clone</code> ä¸‹æ¥å•ªå•ªå•ªã€‚</p><p>ã€€ã€€å®ƒæ‰€éœ€è¦çš„ä¸œè¥¿å¤§è‡´å°±æ˜¯ <code>Expressjs</code> + <code>Redis</code> + <code>Backbone</code> äº†ã€‚ä¸è¿‡éƒ½æ˜¯æœ€æœ€åŸºç¡€çš„ä»£ç ã€‚</p><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>ã€€ã€€æŠŠéƒ¨ç½²å†™åœ¨æœ€å‰é¢æ˜¯ä¸ºäº†èƒ½è®©ä½ ä»¬è‡ªå·±ç”µè„‘ä¸Šæœ‰ä¸€ä¸ªèƒ½è·‘çš„ç¯å¢ƒå•¦ã€‚å…¬ä¼—æ¡£æ‰€åœ¨æˆ‘è‡ªå·±è¿™è¾¹çš„ç¯å¢ƒé‡Œé¢æ˜¯ç”±ä¸‰å°ç”µè„‘ç»„æˆçš„ã€‚</p><ul><li>ç½‘å…³â€œæœåŠ¡å™¨â€ã€‚è¿™æ˜¯æˆ‘è¿™è¾¹ç¯å¢ƒä¸€è‡´å¯¹å¤–çš„æœºå™¨ã€‚å®é™…ä¸Šæ˜¯ä¸€ç‰‡æ ‘è“æ´¾ï¼Œè£…äº† <code>nginx</code>ï¼Œç„¶åå¯¹å†…éƒ¨åšåå‘ä»£ç†ã€‚</li><li>æœ¬ä½“â€œæœåŠ¡å™¨â€ã€‚è·‘äº† <strong>å…¬ä¼—æ¡£æ‰€</strong> æœ¬ä½“ã€‚</li><li>æ•°æ®åº“â€œæœåŠ¡å™¨â€ã€‚æˆ‘ä»¬ç”¨çš„æ•°æ®åº“å®é™…ä¸Šä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„æ•°æ®åº“ï¼Œåªæ˜¯ <code>redis</code> ç½¢äº†ï¼Œä¹Ÿæ²¡åšä¸å…¶å®ƒæ•°æ®åº“çš„æŒä¹…åŒ–ï¼Œåªæ˜¯ç”¨äº†ä»–å†…éƒ¨è‡ªå¸¦çš„æŒä¹…åŒ–ã€‚</li></ul><p>ã€€ã€€<strong>å¦‚æœä½ ä»¬è£…ä¸€å°æœºå­ä¸Šï¼Œé‚£ä¹ˆå°±æ˜¯ï¼š</strong></p><p>ã€€ã€€å°† <code>repo</code> ç»™ clone åˆ°è‡ªå·±çš„æœºå­ä¸Šã€‚</p><figure class="highlight plain"><figcaption><span>shell</span></figcaption><table><tr><td class="code"><pre><span class="line">$ git clone https://github.com/XadillaX/public-file-house</span><br></pre></td></tr></table></figure><p>ã€€ã€€è£…å¥½ <strong>redis</strong>ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿®æ”¹ <code>redis.conf</code> æ–‡ä»¶ã€‚</p><p>ã€€ã€€æ‰§è¡Œ <code>redis.sh</code> æ–‡ä»¶å¼€å¯æ•°æ®åº“ã€‚å¦‚æœä½ è‡ªå·±æœ¬èº«å·²ç»å¼€å¯æ•°æ®åº“æˆ–è€…ç”¨å…¶å®ƒæ–¹æ³•å¼€å¯äº†ï¼Œè¯·å¿½ç•¥ä¸Šé¢æ•°æ®åº“ç›¸å…³æ­¥éª¤ã€‚</p><p>ã€€ã€€ç„¶åæ‰“å¼€ <code>commonConst.js</code> æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼ŒæŠŠç›¸å…³çš„ä¸€äº›ä¿¡æ¯æ”¹æˆè‡ªå·±æ‰€éœ€è¦çš„ã€‚</p><p>ã€€ã€€å“¦å¯¹äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªâ€œæ´ç™–ç›¸å…³â€çš„æ­¥éª¤ã€‚æˆ‘ä»¥å‰å¹´è½»ä¸æ‡‚äº‹ï¼ŒæŠŠ <code>node_modules</code> æ–‡ä»¶å¤¹ä¹Ÿç»™åŠ åˆ°ç‰ˆæœ¬åº“ä¸­äº†ï¼Œè€Œä¸”ä¹Ÿåœ¨é‡Œé¢å±…ç„¶è‡ªå·±åŠ äº†ä¸¤ä¸ªæ²¡æœ‰å¼„åˆ° <code>nmp</code> å»çš„æ¨¡å—ï¼ˆ<strong>è€Œä¸”è¿™ä¸¤ä¸ªæ¨¡å—æœ¬æ¥å°±ä¸åº”è¯¥æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œä½†æ˜¯ä¸è¦åœ¨æ„è¿™äº›ç»†èŠ‚ï¼Œåæ­£æˆ‘ç°åœ¨è‚¯å®šä¸ä¼šåšè¿™ä¹ˆå‚»çš„äº‹äº†</strong>ï¼‰ã€‚</p><p>ã€€ã€€è‡³äºä¸ºä»€ä¹ˆä¸è¦è¿™ä¹ˆåšï¼Œå°±è·Ÿ <code>node_modules</code> æ–‡ä»¶å¤¹çš„æ„ä¹‰ç›¸å…³äº†ã€‚è€Œä¸”é‡Œé¢æœ‰å¯èƒ½æœ‰ä¸€äº›åœ¨æˆ‘æœ¬æœºç¼–è¯‘å¥½çš„æ¨¡å—ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯æ¸…ç†ä¸‹è‡ªå·±é‡æ–°è£…ä¸€éä¸ºä½³ã€‚</p><p>ã€€ã€€å…·ä½“å‘¢å¤§è‡´å°±æ˜¯æŠŠ <code>node_modules</code> æ–‡ä»¶å¤¹é‡Œé¢çš„ <code>alphaRandomer.js</code> æ–‡ä»¶å’Œ <code>smpEncoder.js</code> æ–‡ä»¶æ‹·è´å‡ºæ¥å¤‡ä»½åˆ°ä»»æ„æ–‡ä»¶å¤¹ï¼Œç„¶ååˆ é™¤æ•´ä¸ª <code>node_module</code> æ–‡ä»¶å¤¹ã€‚æ¥ä¸‹å»è·‘åˆ°é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š</p><figure class="highlight plain"><figcaption><span>shell</span></figcaption><table><tr><td class="code"><pre><span class="line">$ npm install</span><br></pre></td></tr></table></figure><p>ã€€ã€€æŠŠä¸‰æ–¹æ¨¡å—é‡æ–°è£…å¥½ä¹‹åï¼ŒæŠŠåˆšæ‰æ‹·å‡ºå»çš„ä¿©æ–‡ä»¶æ”¾å›è¿™ä¸ªç›®å½•ä¸‹ã€‚ï¼ˆ<strong>ä½†æ˜¯ä»¥åä½ ä»¬è‡ªå·±å†™åˆ«çš„é¡¹ç›®çš„è¯åƒä¸‡åˆ«å­¦æˆ‘è¿™ä¸ªåæ ·å­å•Šï¼Œä»¥å‰å¹´è½»ä¸æ‡‚äº‹ QAQ</strong>ï¼‰</p><p>ã€€ã€€æœ€åè·‘èµ·æ¥å°±è¡Œå•¦ï¼š</p><figure class="highlight plain"><figcaption><span>shell</span></figcaption><table><tr><td class="code"><pre><span class="line">$ node pfh.js</span><br></pre></td></tr></table></figure><h2 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h2><p>æ¥ä¸‹å»å°±æ˜¯è¦å‰–æè¿™å°ç ´ä¸œè¥¿äº†ã€‚</p><h3 id="åŸºç¡€æ–‡ä»¶"><a href="#åŸºç¡€æ–‡ä»¶" class="headerlink" title="åŸºç¡€æ–‡ä»¶"></a>åŸºç¡€æ–‡ä»¶</h3><h4 id="pfh-js"><a href="#pfh-js" class="headerlink" title="pfh.js"></a>pfh.js</h4><p>ã€€ã€€è¿™ä¸ªæ–‡ä»¶å…¶å®æ˜¯ <code>Expressjs</code> è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä»¥å‰ä¸æ˜¯å¾ˆæ‡‚ä»–ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æ€ä¹ˆåŠ¨ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¿æŒåŸå°ä¸åŠ¨çš„ã€‚</p><h4 id="router-js"><a href="#router-js" class="headerlink" title="router.js"></a>router.js</h4><p>ã€€ã€€è¿™ä¸ªæ˜¯è·¯ç”±å®šä¹‰çš„æ–‡ä»¶ã€‚æ¯”è¾ƒä¸‘é™‹çš„ä¸€ç§æ–¹æ³•ï¼ŒæŠŠéœ€è¦å®šä¹‰çš„æ‰€æœ‰è·¯ç”±éƒ½å†™è¿›ä¸¤ä¸ª <code>json</code> å¯¹è±¡ä¸­ï¼Œä¸€ä¸ª <code>POST</code> å’Œä¸€ä¸ª <code>GET</code>ã€‚</p><p>ã€€ã€€çœ‹è¿‡ <code>Expressjs</code> æ–‡æ¡£çš„äººæˆ–è€…æ•™ç¨‹çš„äººéƒ½çŸ¥é“ï¼Œæœ€åŸºç¡€çš„è·¯ç”±æ³¨å†Œå†™æ³•å…¶å®å°±æ˜¯ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">app.get(KEY, FUNCTION);</span><br></pre></td></tr></table></figure><p>ã€€ã€€æˆ–è€…ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">app.post(KEY, FUNCTION);</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ‰€ä»¥æˆ‘ä¸‹é¢æœ‰ä¸€ä¸ªå‡½æ•°ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">exports.setRouter = function(app) &#123;</span><br><span class="line">    for(var key in this.getRouter) &#123;</span><br><span class="line">        app.get(key, this.getRouter[key]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for(var key in this.postRouter) &#123;</span><br><span class="line">        app.post(key, this.postRouter[key]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å…¶å¤§è‡´æ„æ€å°±æ˜¯æŠŠä¹‹å‰æˆ‘ä»¬å®šä¹‰å¥½çš„ä¸¤ä¸ªè·¯ç”±å¯¹è±¡é‡Œçš„å†…å®¹ä¸€ä¸€ç»™æ³¨å†Œåˆ°ç³»ç»Ÿçš„è·¯ç”±å½“ä¸­å»ã€‚è¿™ä¸ªæ˜¯æˆ‘æœ€åˆæœ€ç®€é™‹çš„æ€æƒ³ï¼Œä¸è¿‡åæ¥æˆ‘æŠŠå®ƒç¨ç¨å®Œå–„äº†ä¸€ä¸‹å†™åˆ°<a href="https://github.com/XadillaX/exframess/blob/master/config/router.js#L17" target="_blank" rel="external">åˆ«çš„åœ°æ–¹</a>å»äº†ã€‚</p><h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><h4 id="model-fileModel-js"><a href="#model-fileModel-js" class="headerlink" title="model/fileModel.js"></a>model/fileModel.js</h4><p>ã€€ã€€è¿™ä¸ªå°±æ˜¯æ¨¡å‹å±‚äº†ï¼Œä¸»è¦å°±æ˜¯ <code>redis</code> çš„ä¸€äº›æ“ä½œäº†ã€‚åœ¨è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ <a href="https://github.com/mranney/node_redis" target="_blank" rel="external"><code>redis</code></a> è¿™ä¸ªæ¨¡å—ï¼Œå…·ä½“çš„ç”¨æ³•å¤§å®¶å¯ä»¥çœ‹å®ƒ <code>repo</code> çš„ <code>README.md</code> æ–‡ä»¶ã€‚</p><p>ã€€ã€€å¤§è‡´å°±ä¸‰ä¸ªå‡½æ•°ï¼š</p><ol><li><code>fileModel.prototype.keyExists</code>: åˆ¤æ–­æŸä¸ªæå–ç å­˜åœ¨ä¸å¦ã€‚</li><li><code>fileModel.prototype.get</code>: è·å–æŸä¸ªéªŒè¯ç çš„æ–‡ä»¶ä¿¡æ¯ã€‚</li><li><code>fileModel.prototype.addFile</code>: æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ä¿¡æ¯ã€‚</li></ol><blockquote><p>ä¸è¿‡æœ‰ä¸ªåæ ·å­å¤§å®¶ä¸è¦å­¦ï¼Œ<code>Node.js</code> å¤§å®¶éƒ½çº¦å®šä¿—æˆçš„å›è°ƒå‡½æ•°å‚æ•°ä¸€èˆ¬éƒ½æ˜¯ <code>callback(err, data, blahblah...)</code> çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯é”™è¯¯ï¼Œå¦‚æœæ²¡é”™è¯¯éƒ½æ˜¯ <code>null</code> æˆ–è€…æ˜¯ <code>undefined</code> çš„ã€‚ä½†æ˜¯ä»¥å‰ä¹Ÿæ²¡è¿™ç§æ„è¯†ï¼Œæ‰€ä»¥å›è°ƒå‡½æ•°çš„å‚æ•°ä¹Ÿéƒ½æ˜¯æ¯”è¾ƒä¹±çš„ã€‚</p></blockquote><h3 id="æ§åˆ¶å™¨"><a href="#æ§åˆ¶å™¨" class="headerlink" title="æ§åˆ¶å™¨"></a>æ§åˆ¶å™¨</h3><h4 id="action-index-js"><a href="#action-index-js" class="headerlink" title="action/index.js"></a>action/index.js</h4><p>ã€€ã€€è¿™æ˜¯ä¸€äº›åŸºç¡€æ§åˆ¶å™¨ã€‚</p><h5 id="exports-index"><a href="#exports-index" class="headerlink" title="exports.index"></a>exports.index</h5><p>ã€€ã€€çº¯ç²¹çš„é¦–é¡µæ˜¾ç¤ºã€‚</p><h5 id="exports-download"><a href="#exports-download" class="headerlink" title="exports.download"></a>exports.download</h5><p>ã€€ã€€æ–‡ä»¶ä¸‹è½½æ§åˆ¶å™¨ã€‚ç”±ä»£ç å¯çŸ¥ï¼Œé¦–å…ˆè·å– <code>token</code> å’Œ <code>code</code>ã€‚ <code>token</code> æ˜¯éªŒè¯ <strong>URL</strong> çš„æœ‰æ•ˆæ€§è€Œ <code>code</code> å³æå–ç äº†ã€‚</p><p>ã€€ã€€æœŸé—´æˆ‘ä»¬éªŒè¯äº†ä¸‹ <code>token</code>ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">if(!functions.verifyBlahblah(token)) &#123;</span><br><span class="line">    resp.redirect(baseConfig.webroot);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è€Œè¿™ä¸ª <code>verifyBlahblah</code> å‡½æ•°å°±åœ¨<a href="https://github.com/XadillaX/public-file-house/blob/master/plugin/functions.js#L21" target="_blank" rel="external">è¿™ä¸ªæ–‡ä»¶</a>é‡Œé¢ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">exports.verifyBlahblah = function(blahblah) &#123;</span><br><span class="line">    var array = blahblah.split(&quot;^&quot;);</span><br><span class="line">    var time = array[array.length - 1];</span><br><span class="line">    array.pop();</span><br><span class="line"></span><br><span class="line">    var encoder = require(&quot;smpEncoder&quot;);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        var text = encoder.norBack(array, time.toString());</span><br><span class="line">        text = encoder.decode(text);</span><br><span class="line">    &#125; catch(e) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var now = text.substr(0, 10);</span><br><span class="line">    var token = text.substr(10);</span><br><span class="line"></span><br><span class="line">    if(parseInt(Date.now() / 1000) - parseInt(now) &gt; 300) return false;</span><br><span class="line">    if(token !== require(&quot;../commonConst&quot;).token) return false;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¤§ä½“æ„æ€å°±æ˜¯æŠŠå…¶æ‰“æ•£åˆ°æ•°ç»„é‡Œé¢ï¼Œå…¶ä¸­æ—¶é—´æˆ³æ˜¯æœ€åä¸€ä½ã€‚ç„¶åè§£å¯†ã€‚æœ€åéªŒè¯è§£å¯†åçš„ <code>token</code> æ˜¯å¦ç­‰äºç³»ç»Ÿçš„ <code>token</code> ä»¥åŠæ—¶é—´æˆ³æœ‰æ²¡æœ‰è¿‡æœŸã€‚</p><p>ã€€ã€€å¤§å®¶é€šè¿‡æˆªå– <code>Chrome</code> æˆ–è€… <code>Firefox</code> çš„è¯·æ±‚ä¿¡æ¯ï¼Œä¸éš¾å‘ç°æœ‰è¿™ä¹ˆä¸ªåœ°å€ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Request URL:http://localhost/download?file=662ZE&amp;token=65^97^74^68^106^125^88^115^65^96^66^105^127^114^87^123^123^114^84^124^114^125^120^121^99^116^100^118^116^98^124^120^109^98^120^100^80^119^120^87^119^105^116^8^1395904110</span><br><span class="line">Request Method:GET</span><br><span class="line">Status Code:200 OK</span><br></pre></td></tr></table></figure><p>ã€€ã€€è€Œè¿™ä¸€å¨ <code>65^97^74^68^106^125^88^115^65^96^66^105^127^114^87^123^123^114^84...^1395904110</code> ä¾¿æ˜¯æ‰€è°“çš„ <code>token</code> äº†ã€‚è€Œä¸”æœ¬æ¥å°±æ˜¯ä¸ªdemoï¼Œè¿™ä¸ª <code>token</code> ä¹Ÿå°±æ˜¯éšä¾¿åšåšæ ·å­ç½¢äº†ã€‚</p><p>ã€€ã€€æ¥ä¸‹å»é€šè¿‡éªŒè¯ä¹‹åï¼Œä¾¿å¯ä»¥ä»æ•°æ®åº“ä¸­è¯»å–æ–‡ä»¶ä¿¡æ¯äº†ã€‚å¦‚æœæœ‰æ–‡ä»¶ï¼Œé‚£ä¹ˆé€šè¿‡ <code>resp.download</code> å‡½æ•°å‘ˆç°ç»™ç”¨æˆ·ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var fileModel = new FileModel();</span><br><span class="line">fileModel.get(code, function(status, error, obj) &#123;</span><br><span class="line">    if(error) resp.redirect(baseConfig.webroot);</span><br><span class="line">    else &#123;</span><br><span class="line">        if(obj === null) &#123;</span><br><span class="line">            resp.redirect(baseConfig.webroot + &quot;/get/&quot; + code + &quot;/not-exist&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            resp.download(baseConfig.uploadDir + code, require(&quot;urlencode&quot;)(obj.filename));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="exports-getToken"><a href="#exports-getToken" class="headerlink" title="exports.getToken"></a>exports.getToken</h5><p>ã€€ã€€è¿™ä¸ªå‡½æ•°å°±æ˜¯ç”Ÿäº§ä¸€ä¸ªæœ‰æ•ˆçš„ <code>token</code> ç”¨çš„ã€‚åœ¨å‰ç«¯æ˜¯é€šè¿‡ <strong>ajax</strong> æ¥è·å–çš„ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var encoder = require(&quot;smpEncoder&quot;);</span><br><span class="line">var token = baseConfig.token;</span><br><span class="line">var now = parseInt(Date.now() / 1000);</span><br><span class="line">var result = encoder.encode(now + token);</span><br><span class="line">result = encoder.norGo(result, now.toString());</span><br><span class="line">var resultString = &quot;&quot;;</span><br><span class="line">for(var i = 0; i &lt; result.length; i++) resultString += (result[i] + &quot;^&quot;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¤§ä½“å‘¢å°±æ˜¯æ ¹æ®ç›®å‰çš„æ—¶é—´æˆ³å’Œç³»ç»Ÿ <code>token</code> ä¸€èµ·åŠ å¯†ç”Ÿäº§ä¸€ä¸ªæœ‰æ•ˆçš„ <code>token</code>ã€‚</p><h5 id="exports-send2fetion"><a href="#exports-send2fetion" class="headerlink" title="exports.send2fetion"></a>exports.send2fetion</h5><p>ã€€ã€€é€šè¿‡è‡ªå·±çš„é£ä¿¡ç»™è‡ªå·±å‘é€æå–ç ä»¥å¤‡å¿˜ã€‚</p><p>ã€€ã€€è¿™é‡Œçš„è¯ç”¨äº†ä¸€ä¸ª <code>fetion-sender</code> çš„æ¨¡å—ã€‚<code>Repo</code> åœ¨<a href="https://github.com/XadillaX/fetion-sender" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p><h4 id="action-upload-js"><a href="#action-upload-js" class="headerlink" title="action/upload.js"></a>action/upload.js</h4><p>ã€€ã€€è¿™ä¸ªæ–‡ä»¶é‡Œé¢å…¶å®å°±ä¸€ä¸ª <code>exports.upload</code> å‡½æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯ç”Ÿæˆæå–ç ç”¨çš„ã€‚</p><h5 id="function-genAlphaKey-time-callback"><a href="#function-genAlphaKey-time-callback" class="headerlink" title="function genAlphaKey(time, callback)"></a>function genAlphaKey(time, callback)</h5><p>ã€€ã€€ç”Ÿæˆæå–ç ã€‚æˆ‘ä»¬å‡è®¾æœ€å¤šå°è¯•10æ¬¡ï¼Œè‹¥å°è¯•10æ¬¡è¿˜æ²¡æœ‰ç”Ÿæˆå”¯ä¸€çš„éªŒè¯ç å°±è¾“å‡ºé”™è¯¯è®©ç”¨æˆ·é‡è¯•ã€‚æ‰€ä»¥å°±æœ‰äº†ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function genAlphaKey(time, callback) &#123;</span><br><span class="line">    var keyLength = config.uploadLen;</span><br><span class="line">    var filename = alphaRandomer.rand(keyLength);</span><br><span class="line">    var fileModel = new FileModel();</span><br><span class="line"></span><br><span class="line">    fileModel.keyExists(filename, function(status, result) &#123;</span><br><span class="line">        if(!status) &#123;</span><br><span class="line">            if(time &lt; maxTryTime) &#123;</span><br><span class="line">                genAlphaKey(time + 1, callback);</span><br><span class="line">            &#125;</span><br><span class="line">            else &#123;</span><br><span class="line">                callback(false, result, &quot;&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if(result) genAlphaKey(time, callback);</span><br><span class="line">            else &#123;</span><br><span class="line">                callback(true, &quot;&quot;, filename);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸æ–­åœ°ç”Ÿæˆå®šé•¿çš„æå–ç ï¼Œç„¶åé€šè¿‡æ¨¡å‹çš„ <code>keyExists</code> å‡½æ•°æ¥ç¡®å®šè¿™ä¸ªæå–ç æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨äº†å°±é€’å½’è°ƒç”¨é‡æ–°ç”Ÿæˆï¼Œå¦åˆ™å°±ç›´æ¥å›è°ƒã€‚</p><h5 id="exports-upload"><a href="#exports-upload" class="headerlink" title="exports.upload"></a>exports.upload</h5><p>ã€€ã€€ä¸Šä¼ æ–‡ä»¶çš„é¡µé¢äº†ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">if(req.files.files.length !== 1) &#123;</span><br><span class="line">    result.status = false;</span><br><span class="line">    result.msg = &quot;è¯·ç”¨æ­£ç¡®çš„å§¿åŠ¿å–‚æˆ‘æ–‡ä»¶ã€‚&quot;;</span><br><span class="line">    resp.send(200, result);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var fileInfo = req.files.files[0];</span><br><span class="line">if(fileInfo.size &gt; config.maxUploadSize) &#123;</span><br><span class="line">    result.status = false;</span><br><span class="line">    result.msg = &quot;æ–‡ä»¶å¤ªå¤§å•¦ï¼Œå…¬ä¼—æ¡£æ‰€ä¸€æ¬¡åªèƒ½åƒ10Mçš„æ–‡ä»¶å“¦ã€‚&quot;;</span><br><span class="line">    resp.send(200, result);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å‰é¢ä¸€å †è¯å¤§è‡´å°±æ˜¯åšä¸‹æœ‰æ•ˆæ€§åˆ¤æ–­è€Œå·²ã€‚ç„¶åè°ƒç”¨å‡½æ•°æ¥ç”Ÿæˆæœ‰æ•ˆçš„æå–ç ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">genAlphaKey(1, function(status, msg, filename) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœç”ŸæˆæˆåŠŸçš„è¯å°±å¾€æ•°æ®åº“ä¸­æ·»åŠ æ–‡ä»¶ä¿¡æ¯ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var fileModel = new FileModel();</span><br><span class="line">fileModel.addFile(filename,</span><br><span class="line">    fileInfo.name,</span><br><span class="line">    fileInfo.headers[&quot;content-type&quot;],</span><br><span class="line">    function(status, msg) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœæ·»åŠ ä¹ŸæˆåŠŸäº†çš„è¯ï¼Œé‚£ä¹ˆæŠŠåˆšä¸Šä¼ åˆ°ä¸´æ—¶æ–‡ä»¶å¤¹çš„æ–‡ä»¶ç»™ç§»åŠ¨åˆ°ä¸Šä¼ æ–‡ä»¶å‚¨å­˜ç›®å½•ä¸­ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥è¢«ä¸‹è½½ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">fs.rename(fileInfo.path, uploadDir + filename, function(err) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœç§»åŠ¨ä¹ŸæˆåŠŸäº†çš„è¯ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªæˆåŠŸçš„jsonä¿¡æ¯ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">result.status = true;</span><br><span class="line">result.code = filename;</span><br><span class="line">resp.send(200, result);</span><br></pre></td></tr></table></figure><h3 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h3><p>ã€€ã€€è¿™é‡Œè§†å›¾å°±ä¸€ä¸ª <code>index.ejs</code> ã€‚ç„¶åé€šè¿‡ <code>backbone.js</code> æ¥è°ƒç”¨ä¸åŒçš„é¡µå†…æ¨¡æ¿å’Œé€»è¾‘æ¥å®ç°çš„ç±»ä¼¼äº <strong>SPA <del>(Solus Par Agula)</del> (Single Page Application)</strong> çš„æ•ˆæœã€‚</p><h4 id="views-index-index-ejs"><a href="#views-index-index-ejs" class="headerlink" title="views/index/index.ejs"></a>views/index/index.ejs</h4><p>ã€€ã€€åƒç±»ä¼¼äºä¸‹é¢çš„è¿™ç§å°±æ˜¯ <code>backbone.js</code> çš„æ¨¡æ¿æ¦‚å¿µäº†ï¼š</p><figure class="highlight plain"><figcaption><span>html</span></figcaption><table><tr><td class="code"><pre><span class="line">&lt;script type=&quot;text/template&quot; id=&quot;faq-template&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ã€€ã€€åˆ°æ—¶å€™å°±å¯ä»¥é€šè¿‡ <code>backbone.js</code> ä¸­çš„å‡½æ•°æ¥å¡«å……åˆ°é¡µé¢å®ä½“å½“ä¸­å»ã€‚</p><h4 id="public-js-index-js"><a href="#public-js-index-js" class="headerlink" title="public/js/index.js"></a>public/js/index.js</h4><p>ã€€ã€€åœ¨æ‹¥æœ‰äº†æ‰€æœ‰çš„å‰ç«¯jsä¾èµ–ä¹‹åï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯è¿™ä¸ª <code>SPA</code> çš„å…¥å£äº†ã€‚</p><p>ã€€ã€€é€»è¾‘å¾ˆç®€å•ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var workspace = null;</span><br><span class="line">$(function() &#123;</span><br><span class="line">    workspace = new Workspace();</span><br><span class="line">    Backbone.history.start(&#123; pushState: true, hashChange: false &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ–°å»ºä¸€ä¸ª <code>Workscpace</code>ï¼Œç„¶åå¯¹ <code>backbone</code> è¿›è¡Œä¸€ç‚¹é…ç½®ã€‚</p><blockquote><p>To indicate that youâ€™d like to use HTML5 pushState support in your application, use Backbone.history.start({pushState: true}). If youâ€™d like to use pushState, but have browsers that donâ€™t support it natively use full page refreshes instead, you can add {hashChange: false} to the options.</p><p style="text-align: right">â€”â€”æ‘˜è‡ª <a href="http://backbonejs.org/#History-start" target="_blank" rel="external">backbonejs.org</a></p></blockquote><p>ã€€ã€€ç„¶åè¿™ä¸ª <code>Workspace</code> å³è¿™ä¸ª <code>SPA</code> çš„æœ¬ä½“äº†ã€‚</p><h4 id="public-backbone-router-workspace-js"><a href="#public-backbone-router-workspace-js" class="headerlink" title="public/backbone/router/workspace.js"></a>public/backbone/router/workspace.js</h4><p>ã€€ã€€è¿™é‡Œå®šä¹‰äº†å‡ ä¸ªè·¯ç”±ï¼Œå³ä»€ä¹ˆè·¯ç”±è¦ç”¨å“ªä¸ªç±»å»å¤„ç†ã€‚è¿™æ ·æ‰èƒ½åœ¨ <code>URL</code> å½“ä¸­å„ç§è·³è½¬ã€‚å…¶å®æ— éå°±æ˜¯æŠŠå¾…æ¸²æŸ“å…ƒç´ æ¸²æŸ“æˆé¡µå†…æ¨¡æ¿ï¼Œç„¶åæŠŠé¡µé¢çš„å„ç§äº‹ä»¶å“åº”é€»è¾‘æ”¹æ‰å³å¯ã€‚å¯¹äº <code>Backbone</code> æˆ‘å…¶å®åªç”¨è¿‡ä¸¤æ¬¡ï¼Œç°åœ¨ä¹Ÿå¿˜ä¸å¤§å¤šäº†ï¼Œæ€•è¯¯äººå­å¼Ÿï¼Œæ‰€ä»¥ä¸€äº›å…·ä½“çš„å‡½æ•°å•Šç”¨æ³•å•Šè¿˜æ˜¯å»å‚è€ƒä¸‹å®˜ç½‘æ¯”è¾ƒå¥½æ¥ç€ã€‚</p><h4 id="public-backbone-view-js"><a href="#public-backbone-view-js" class="headerlink" title="public/backbone/view/*.js"></a>public/backbone/view/*.js</h4><p>ã€€ã€€å°±æ˜¯å„è·¯ç”±æ‰€å¯¹åº”çš„è§†å›¾äº†ã€‚</p><h5 id="uploadView-js"><a href="#uploadView-js" class="headerlink" title="uploadView.js"></a>uploadView.js</h5><p>ã€€ã€€æ¯”å¦‚è¯´ <code>uploadView.js</code> æ–‡ä»¶å½“ä¸­ï¼Œæ‰§è¡Œæ¸²æŸ“å‡½æ•°ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">render      : function() &#123;</span><br><span class="line">    $(this.el).html(Mustache.to_html(</span><br><span class="line">        this.template</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    $(&quot;#uploadfile&quot;).fileupload(&#123;</span><br><span class="line">        url         : &quot;../../upload.pfh&quot;,</span><br><span class="line">        dataType    : &quot;json&quot;,</span><br><span class="line">        done        : this.uploaded,</span><br><span class="line">        progressall : this.processUpload,</span><br><span class="line">        start       : this.startUpload</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(&quot;.template&quot;).show(&quot;normal&quot;);</span><br><span class="line"></span><br><span class="line">    return this;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€å°±æ˜¯ç”¨é¡µå†…æ¨¡æ¿æ¥æ¸²æŸ“ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">$(this.el).html(Mustache.to_html(</span><br><span class="line">    this.template</span><br><span class="line">));</span><br></pre></td></tr></table></figure><p>ã€€ã€€è€Œè¿™ä¸ª <code>this.el</code> æ˜¯åœ¨ <code>Workspace</code> ä¸­å®šä¹‰çš„ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">upload      : function() &#123;</span><br><span class="line">    var uploadView = new UploadView(&#123; el: &quot;#main-template-container&quot; &#125;);</span><br><span class="line">    uploadView.render();</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¦‚ä½ æ‰€è§ï¼Œå°±æ˜¯è¿™ä¸ª <code>#main-template-container</code> äº†ã€‚</p><p>ã€€ã€€è¿™ä¸ªæ¸²æŸ“å®Œæ¯•ä¹‹åï¼Œç„¶åæŠŠ <code>#uploadfile</code> ç»™å˜æˆä¸Šä¼ æŒ‰é’®ï¼ˆç”¨äº† <strong>jquery.fileupload.js</strong>ï¼‰ã€‚å†ç„¶åæŠŠæ¸²æŸ“å¥½çš„é¡µé¢ç»™ <code>show</code> å‡ºæ¥ã€‚</p><p>ã€€ã€€ç„¶åè¿™ä¸ªã€€<code>uploadView.js</code> ä¸­è¿˜å®šä¹‰äº†ä¸¤ä¸ª<a href="http://backbonejs.org/#View-delegateEvents" target="_blank" rel="external">å“åº”äº‹ä»¶</a>ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">events      : &#123;</span><br><span class="line">    &quot;click .upbutton&quot;   : &quot;upload&quot;,</span><br><span class="line">    &quot;click #uploadpage-to-download&quot; : &quot;goDownload&quot;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€å³åœ¨æŒ‰ä¸‹ <code>.upbutton</code> çš„æ—¶å€™ä¼šæ‰§è¡Œ <code>upload</code> å‡½æ•°ï¼Œåœ¨æŒ‰ä¸‹â€œå»ä¸‹è½½â€çš„æŒ‰é’®æ—¶ä¼šæ‰§è¡Œ <code>goDownload</code> å‡½æ•°ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">upload      : function() &#123;</span><br><span class="line">    $(&quot;#uploadfile&quot;).click();</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ‰§è¡Œä¸Šä¼ å‡½æ•°çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯è‡ªåŠ¨è§¦åŠ¨äº† <code>#uploadfile</code> æŒ‰é’®çš„ <code>click</code> äº‹ä»¶ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šæŒ‰ç…§ä¹‹å‰å®šä¹‰å¥½çš„ <code>$(&quot;#uploadfile&quot;).fileupload(...)</code> å»å¤„ç†äº†ã€‚</p><h5 id="getView-js"><a href="#getView-js" class="headerlink" title="getView.js"></a>getView.js</h5><p>ã€€ã€€è¿™ä¸ªæ˜¯è·å–æ–‡ä»¶çš„è§†å›¾ã€‚</p><p>ã€€ã€€æ¸²æŸ“æ—¶ä¼šè·å– <code>code</code> ã€‚è¿™ä¸ª <code>code</code> åŒæ ·æ˜¯ <code>Workspace</code> ä¼ å…¥çš„ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">get         : function(code, err) &#123;</span><br><span class="line">    var getView = new GetView(&#123; el: &quot;#main-template-container&quot; &#125;);</span><br><span class="line">    getView.setCode(code);</span><br><span class="line">    if(err !== undefined) getView.setError(err);</span><br><span class="line">    getView.render();</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸Šé¢å…³äº <code>get</code> çš„è·¯ç”±æ˜¯ <code>get/:code</code> ä¹‹ç±»çš„ï¼Œæ‰€ä»¥è¿™ä¸ª <code>code</code> ä¼šä½œä¸ºä¸€ä¸ªè·¯ç”±å‚æ•°ä¼ ç»™ <code>get</code> å‡½æ•°ã€‚</p><p>ã€€ã€€æœ‰äº†è¿™ä¸ª <code>code</code> ä¹‹åå°±å¯ä»¥æŠŠé¡µé¢æ¸²æŸ“å‡ºæ¥äº†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ°å€è¾“å…¥ <code>http://localhost/get/XXXXX</code> çš„æ—¶å€™è¾“å…¥æ¡†é‡Œé¢å°±æœ‰æå–ç äº†ã€‚æŠŠè¿™ä¸ªæ¸²æŸ“å‡ºæ¥ä¹‹åï¼Œæˆ‘ä»¬å¯¹â€œäºŒç»´ç â€çš„ä¸¤å¼ å›¾ç‰‡åšä¸‹å“åº”ï¼šé¼ æ ‡ç§»åŠ¨ä¸Šå»ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚å†ç„¶åæˆ‘ä»¬è¦è·å–äºŒç»´ç äº†ï¼ˆ<code>this.genQRCode()</code>ï¼‰ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">genQRCode   : function() &#123;</span><br><span class="line">    var code = this.code;</span><br><span class="line"></span><br><span class="line">    var dpage = &quot;http://dang.kacaka.ca/get/&quot; + code;</span><br><span class="line">    dpage = UrlEncode(dpage);</span><br><span class="line">    var img = &apos;&lt;img style=&quot;width: 150; height: 150;&quot; src=&quot;https://chart.googleapis.com/chart?cht=qr&amp;chs=150x150&amp;choe=UTF-8&amp;chld=L|4&amp;chl=&apos; + dpage + &apos;&quot; /&gt;&apos;;</span><br><span class="line"></span><br><span class="line">    $(&quot;#download-page-qr&quot;).attr(&quot;data-content&quot;, img);</span><br><span class="line"></span><br><span class="line">    var opage = &quot;http://dang.kacaka.ca/download?&quot;;</span><br><span class="line">    this.getToken(function(token) &#123;</span><br><span class="line">        if(undefined === token) &#123;</span><br><span class="line">            $(&quot;#download-origin-qr&quot;).attr(&quot;data-content&quot;, &apos;&lt;div style=&quot;text-align: center;&quot;&gt;äºŒç»´ç ç”Ÿæˆå¤±è´¥ã€‚&lt;/div&gt;&apos;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        opage += &quot;token=&quot; + token;</span><br><span class="line">        opage += &quot;&amp;file=&quot; + code;</span><br><span class="line">        opage = UrlEncode(opage);</span><br><span class="line">        var img = &apos;&lt;div style=&quot;text-align: center;&quot;&gt;&lt;img style=&quot;width: 150; height: 150;&quot; src=&quot;https://chart.googleapis.com/chart?cht=qr&amp;chs=150x150&amp;choe=UTF-8&amp;chld=L|4&amp;chl=&apos; + opage + &apos;&quot; /&gt;&lt;br /&gt;&lt;small&gt;è¯¥äºŒç»´ç æœ‰æ•ˆæœŸäº”åˆ†é’Ÿã€‚&lt;/small&gt;&lt;/div&gt;&apos;;</span><br><span class="line">        $(&quot;#download-origin-qr&quot;).attr(&quot;data-content&quot;, img);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    if(&quot;&quot; === this.code) &#123;</span><br><span class="line">        $(&quot;h2 small&quot;).css(&quot;display&quot;, &quot;none&quot;);</span><br><span class="line">    &#125; else $(&quot;h2 small&quot;).css(&quot;display&quot;, &quot;inline-block&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ— éå°±æ˜¯è°ƒç”¨è°·æ­Œçš„ API ç„¶åç”Ÿæˆå›¾ç‰‡åœ°å€æ”¾ä¸Šå»ç½¢äº†ã€‚ä¸€ä¸ªåœ°å€å°±æ˜¯å½“å‰é¡µé¢åœ°å€ï¼Œå¦ä¸€ä¸ªå°±æ˜¯åŠ ä¸Š <code>token</code> ä¹‹åçš„ç›´æ¥ä¸‹è½½åœ°å€ã€‚</p><p>ã€€ã€€å¦‚ä½ æ‰€è§ï¼Œè·å–tokenæ˜¯é€šè¿‡ajaxå¾€æœåŠ¡å™¨è¯·æ±‚çš„ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">getToken    : function(callback) &#123;</span><br><span class="line">    $.get(&quot;../../blahblah&quot;, &#123;&#125;, function(e) &#123;</span><br><span class="line">        callback(e.token);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åäº‹ä»¶çš„è¯ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">events      : &#123;</span><br><span class="line">    &quot;click #downloadpage-to-upload&quot; : &quot;toUpload&quot;,</span><br><span class="line">    &quot;click #download-btn&quot;   : &quot;toDownload&quot;,</span><br><span class="line">    &quot;keydown #download-code&quot;: &quot;toDownloadKeydown&quot;,</span><br><span class="line"></span><br><span class="line">    &quot;keyup #download-code&quot;  : &quot;navCode&quot;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€æŒ‰äº†â€œå»ä¸Šä¼ â€æŒ‰é’®ä¼šè·‘å»ä¸Šä¼ ã€‚å¦‚æœæŒ‰ä¸‹â€œä¸‹è½½â€æŒ‰é’®å°±ä¸‹è½½æ–‡ä»¶äº†ã€‚ç„¶åè¾“å…¥æ¡†é‡Œé¢å¼¹èµ·é”®ç›˜çš„è¯ï¼Œä¼šå¯¼è‡´è¾“å…¥æ¡†æ–‡å­—å˜åŒ–ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦æ›´æ–°äºŒç»´ç ä»¥åŠURLäº†ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">navCode     : function() &#123;</span><br><span class="line">    var code = $(&quot;#download-code&quot;).val();</span><br><span class="line">    workspace.navigate(&quot;get/&quot; + code);</span><br><span class="line">    this.code = code;</span><br><span class="line"></span><br><span class="line">    if(code === &quot;&quot;) &#123;</span><br><span class="line">        $(&quot;h2 small&quot;).css(&quot;display&quot;, &quot;none&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        this.genQRCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ¯å½“è¾“å…¥æ¡†å˜åŒ–ä¹‹åï¼Œåœ°å€æ å°±è¦å˜æˆæ–°çš„ <code>get/:code</code> (<code>workspace.navigate(&quot;get/&quot; + code)</code>) äº†ï¼Œç„¶åé‡æ–°è·å–ä¸€éäºŒç»´ç ã€‚</p><p>ã€€ã€€ä¸‹è½½æŒ‰é’®çš„é€»è¾‘ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">toDownload  : function() &#123;</span><br><span class="line">    var code = $(&quot;#download-code&quot;).val();</span><br><span class="line">    workspace.navigate(&quot;get/&quot; + code);</span><br><span class="line">    this.getToken(function(token) &#123;</span><br><span class="line">        if(token === undefined) &#123;</span><br><span class="line">            alert(&quot;è·å–éªŒè¯ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            var url = &quot;../../download?file=&quot; + code + &quot;&amp;token=&quot; + token;</span><br><span class="line">            window.location.href = url;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€åæ­£å°±æ˜¯æ ¹æ® <code>code</code> æ¥ç”Ÿæˆåœ°å€ï¼Œç„¶åä»è·å–tokençš„åœ°å€ä¸­æŠŠtokenæ‹¿å‡ºæ¥æ‹¼æ¥æˆä¸‹è½½åœ°å€ä¹‹åå†è®¿é—®ï¼ˆ<code>window.location.href = url</code>ï¼‰å°±å¥½äº†ã€‚</p><h5 id="uploadedView-js"><a href="#uploadedView-js" class="headerlink" title="uploadedView.js"></a>uploadedView.js</h5><p>ã€€ã€€è¿™ä¸ªè§†å›¾æ˜¯ä¸Šä¼ æˆåŠŸè§†å›¾ã€‚åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯ç°å®ä¸‹æå–ç ï¼Œç„¶åé£ä¿¡èƒ½å‘é€ä¸€ä¸‹ï¼Œä»¥åŠèƒ½å¤åˆ¶éªŒè¯ç ç½¢äº†ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">render      : function() &#123;</span><br><span class="line">    if(undefined === this.code) &#123;</span><br><span class="line">        workspace.navigate(&quot;upload&quot;, &#123; trigger: true, replace: true &#125;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(this.el).html(Mustache.to_html(</span><br><span class="line">        this.template,</span><br><span class="line">        &#123; code: this.code &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    var phoneinfo = store.get(&quot;fetion-info&quot;);</span><br><span class="line">    if(undefined !== phoneinfo) &#123;</span><br><span class="line">        $(&quot;#phonenumber&quot;).val(phoneinfo.phonenumber);</span><br><span class="line">        $(&quot;#password&quot;).val(phoneinfo.password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(&quot;.template&quot;).show(&quot;normal&quot;, function() &#123;</span><br><span class="line">        $(&apos;#copy-code-btn-parent&apos;).zclip(&#123;</span><br><span class="line">            path:&apos;../../ZeroClipboard.swf&apos;,</span><br><span class="line">            copy:function() &#123;</span><br><span class="line">                return $(&quot;#code-input&quot;).val();</span><br><span class="line">            &#125;,</span><br><span class="line">            afterCopy: function() &#123;</span><br><span class="line">                alert(&quot;æå–ç å·²ç»æˆåŠŸå¤åˆ¶åˆ°å‰ªåˆ‡æ¿äº†ã€‚&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return this;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€é€šè¿‡åˆ¤æ–­æœ‰æ²¡æœ‰ <code>code</code> æ¥åˆ¤æ–­æ˜¯å¦ä¸Šä¼ æˆåŠŸã€‚è¿™ä¸ª <code>code</code> çš„æ¥æºæ˜¯ <code>uploadView.js</code> ä¸­çš„ <code>uploaded (done: this.uploaded)</code> å‡½æ•°ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">uploaded    : function(e, data) &#123;</span><br><span class="line">    var result = data.result;</span><br><span class="line">    if(!result.status) &#123;</span><br><span class="line">        $(&quot;#progress&quot;).css(&quot;display&quot;, &quot;none&quot;);</span><br><span class="line">        $(&quot;#progress .progress-bar&quot;).html(&quot;å·²ä¸Šä¼  0%&quot;);</span><br><span class="line">        $(&quot;#progress .progress-bar&quot;).attr(&quot;aria-valuenow&quot;, &quot;0&quot;);</span><br><span class="line">        $(&quot;#progress .progress-bar&quot;).css(&quot;width&quot;, &quot;0%&quot;);</span><br><span class="line"></span><br><span class="line">        $(&quot;#upload-div #feed-doc&quot;).removeClass(&quot;alert-info&quot;);</span><br><span class="line">        $(&quot;#upload-div #feed-doc&quot;).addClass(&quot;alert-danger&quot;);</span><br><span class="line">        $(&quot;#upload-div #feed-doc&quot;).html(result.msg);</span><br><span class="line">        $(&quot;#upload-div #feed-doc&quot;).css(&quot;display&quot;, &quot;block&quot;);</span><br><span class="line">        return;</span><br><span class="line">        return;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        store.set(&quot;code&quot;, result.code);</span><br><span class="line">        workspace.navigate(&quot;uploaded&quot;, &#123; trigger: true, replace: true &#125;);</span><br><span class="line"></span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€<code>e</code> å’Œ <code>data</code> è¿™ä¸¤ä¸ªå‚æ•°å“ªæ¥ï¼Ÿé¦–å…ˆè¿™ä¸ª <code>uploaded</code> å‡½æ•°æ˜¯åœ¨ä¹‹å‰æ¸²æŸ“çš„æ—¶å€™å®šä¹‰æˆ <code>jquery.fileupload</code> çš„ä¸Šä¼ ç»“æŸå›è°ƒå‡½æ•°çš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå‚æ•°è‡ªç„¶æ˜¯ <code>jquery.fileupload</code> ä¼ è¿‡æ¥çš„ã€‚è¯¦è§<a href="https://github.com/blueimp/jQuery-File-Upload/wiki/Options#done" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p><p>ã€€ã€€æ€»ä¹‹å°±æ˜¯ä¸Šæ¬¡æˆåŠŸä¹‹åï¼Œè¿™ä¸ªuploadå‡½æ•°ä¼šè·å–ä¸€ä¸ª <code>code</code>ï¼Œç„¶åå®ƒå°±ä¼šæ‹¿è¿™ä¸ª <code>code</code> å­˜åˆ° <code>store</code> ä¸­ã€‚è¿™ä¸ª <code>store.js</code> æ˜¯ä¸€ä¸ª <code>localStorage</code> çš„å°è£…ã€‚å®ƒçš„ä»£ç å’Œæ–‡æ¡£åœ¨<a href="https://github.com/cloudhead/store.js" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p><p>ã€€ã€€å­˜å¥½ä¹‹åè®© <code>Workspace</code> ç»™å¯¼èˆªåˆ° <code>uploaded</code> è§†å›¾ä¸­ã€‚</p><p>ã€€ã€€è€Œè¿™ä¸ª <code>uploaded</code> è§†å›¾çš„åˆå§‹åŒ–å‡½æ•°é‡Œé¢æœ‰è¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">...,</span><br><span class="line"></span><br><span class="line">initialize  : function() &#123;</span><br><span class="line">    this.code = store.get(&quot;code&quot;);</span><br><span class="line">    var self = this;</span><br><span class="line"></span><br><span class="line">    $(&quot;#sending&quot;).click(self.sending);</span><br><span class="line">    $(&quot;#cancel-sending&quot;).click(self.cancelSending);</span><br><span class="line">    $(&quot;#phonenumber, #password&quot;).keydown(function(e) &#123; if(e.keyCode === 13) self.sending(); &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ã€€ã€€å°±æ˜¯åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä» <code>localStorage</code> ä¸­æŠŠ <code>code</code> ç»™å–å‡ºæ¥ã€‚</p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2><p>ã€€ã€€ä»£ç é‡å°‘ï¼Œç”¨åˆ°çš„ä¸œè¥¿ä¹Ÿæ˜¯åŸºç¡€ï¼›ä¸è¿‡ä»¥å‰çš„ä»£ç ç”±äºä¸äº†è§£ <code>Node.js</code> å•Š <code>Expressjs</code> å•Šç­‰ç­‰çš„ï¼Œæ‰€ä»¥å¯¼è‡´ä»£ç æ‚ä¹±æ— ç« ã€è„ä¹±æ— æ¯”ï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šé˜»ç¢äº†å¯è¯»æ€§çš„å­˜åœ¨ã€‚</p><p>ã€€ã€€å¸Œæœ›æœ¬æ–‡èƒ½ç»™å„ä½çœ‹å®˜ç¨ç¨ç†æ¸…æ€è·¯ã€‚æˆ‘ä¹Ÿä¸å¿…å†™å¾—é¢é¢ä¿±åˆ°ï¼Œåªæ˜¯åœ¨æŸä¸ªç¨‹åº¦ä¸Šç‚¹é¢˜ä¸€ä¸‹è€Œå·²ã€‚æ›´å¤šçš„å¤§å®¶è‡ªå·±çœ‹ä»£ç å³å¯äº†ã€‚ä¸è¿‡å¸Œæœ›è¿˜ä¸è¦æŠŠå¤§å®¶ç»™è¯¯å¯¼äº†å°±å¥½ï¼Œæ¯•ç«Ÿè¿™ä»£ç æˆ‘è‡ªå·±ç°åœ¨çœ‹è§‰å¾—å¥½ä¸¢è„¸å•Š QAQã€‚å¤§å®¶å°±å»å…¶ç³Ÿç²•å–å…¶ç²¾åå§ã€‚ï¼ˆå–‚å–‚å–‚ï¼Œæˆ‘å»å¹´ä¹°äº†ä¸ªè¡¨ï¼Œå“ªæœ‰ä»€ä¹ˆç²¾åå•Šï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€æ‰€è°“â€œå…¬ä¼—æ¡£æ‰€â€ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå…¬å…±çš„ä¸´æ—¶ç½‘ç›˜äº†ã€‚è¿™ä¸ªä¸œè¥¿æ˜¯ä¸€ä¸ªè€ç‰©äº†ï¼Œåœ¨æˆ‘åˆšæ¥è§¦ &lt;code&gt;Expressjs&lt;/code&gt; çš„æ—¶å€™å†™çš„ã€‚å½“æ—¶è¿˜éšä¾¿æäº†ä¸€ä¸‹ &lt;code&gt;backbone.js&lt;/code&gt;ï¼Œä½†æ˜¯æ²¡æœ‰æ·±å…¥ï¼Œå‹¿ç¬‘ã€‚å…³äºæ·±å…¥æ„æ¶ &lt;code&gt;Express
      
    
    </summary>
    
      <category term="Document" scheme="https://xcoder.in/categories/Document/"/>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="Project Parse" scheme="https://xcoder.in/tags/Project-Parse/"/>
    
  </entry>
  
  <entry>
    <title>æµ™æ±Ÿå¤§å­¦XPlané¡¹ç›®æ–°é—»çˆ¬è™«æ‰‹æœºå±å¹•é€‚é…æ–‡æ¡£</title>
    <link href="https://xcoder.in/2013/12/28/xplan-spider-doc/"/>
    <id>https://xcoder.in/2013/12/28/xplan-spider-doc/</id>
    <published>2013-12-27T16:00:00.000Z</published>
    <updated>2017-12-11T07:59:20.549Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>XPlan</strong> æ˜¯ä¸€ä¸ªâ€œåŸºäºæ ¡å›­å¼ºå…³ç³»çš„ç¤¾äº¤åº”ç”¨â€çš„å¼€å‘ä»£å·ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªåŠŸèƒ½æ˜¯ä»å­¦æ ¡ç½‘ç«™ä¸Šé€šè¿‡ç½‘ç»œçˆ¬è™«ï¼ˆWeb Crawlerï¼‰å½¢å¼å°†å­¦æ ¡æ–°é—»æŠ“å–åˆ°XPlanè‡ªèº«çš„æ•°æ®åº“å½“ä¸­ã€‚</p><p>è€Œè¿™é‡Œå‡ºç°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å­¦æ ¡ç½‘ç«™ä¸Šé¢çš„æ–‡ç« æ˜¯é€šè¿‡ç±»ä¼¼äº <a href="http://kindeditor.net/" target="_blank" rel="external"><code>KindEditor</code></a>ã€<a href="http://ueditor.baidu.com/website/" target="_blank" rel="external"><code>UEditor</code></a>è¿™ç±»<strong>åœ¨çº¿å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</strong>ç”Ÿæˆçš„ä»£ç ã€‚</p><p>è¿™ç±»ä»£ç æœ‰å‡ ä¸ªå…±æ€§ï¼š</p><ol><li>ä»£ç æœ‰å¤§é‡å†—ä½™ã€å¤šé‡æ— ç”¨åµŒå¥—ã€‚</li><li>éå¸¸ä½çš„ä»£ç å¯è¯»æ€§ã€‚</li><li>åœ¨PCæµè§ˆå™¨ä¸­è¡¨ç°åŠ›ä¸é”™ï¼Œå¾€å¾€èƒ½ä»¥ä½æ•ˆçš„ä»£ç å®ç°é¢„æœŸæ’ç‰ˆã€‚</li></ol><p>æ‰€ä»¥è¿™äº›å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å¯ä»¥åœ¨PCå„å¤§å†…æ ¸æµè§ˆå™¨ä¸­è¡¨ç°è‰¯å¥½ï¼Œä½†æ˜¯ä¸ä¾¿äººå·¥ä¿®æ”¹ä»£ç ã€‚</p><p>è€Œ <strong>XPlan</strong> ç¡®æ˜¯ä¸€ä¸ªç”±æ™ºèƒ½æ‰‹æœºä¸»å¯¼çš„åº”ç”¨ï¼Œæ–°é—»å°†ä¼šé€šè¿‡ä¸€ä¸ª <strong>WebView</strong> ä½“ç°å‡ºæ¥ã€‚æ‰€ä»¥å°±éœ€è¦ä¸€å®šçš„æ–¹æ³•å°†è¿™äº›è„ä¹±çš„ä»£ç é€‚é…æˆæ‰‹æœºå±å¹•ä¸‹è¡¨ç°åŠ›è‰¯å¥½çš„ä»£ç ã€‚</p><h2 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h2><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ–°é—»çš„ä»£ç é”å®šåœ¨æ–°é—»å†…å®¹æ’ç‰ˆï¼Œè€Œæ’é™¤äº†å…¶å®ƒç±»ä¼¼äºæ–°é—»æ ‡é¢˜ã€æ–°é—»ä½œè€…ç­‰å…¶å®ƒä¿¡æ¯ã€‚</p><p>ä»¥æˆ‘ä»¬æµ™æ±Ÿå¤§å­¦è½¯ä»¶å­¦é™¢ä¸ºä¾‹ï¼Œæˆ‘ä»¬çˆ¬å–çš„æ–°é—»å†…å®¹ä»£ç å°†å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><figcaption><span>html</span></figcaption><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;vid_wz&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å†…å®¹å°†è¢«åŒ…æ‹¬åœ¨è¿™ä¸ªç±»å‹ä¸º <code>vid_wz</code> çš„ <code>div</code> å½“ä¸­ã€‚</p><p>è¿™æ—¶ï¼Œæˆ‘ä»¬å°†å…¶åŒ…æ‹¬åœ¨ä¸€ä¸ªè‡ªå·±å®ç°å®šä¹‰å¥½çš„æ¨¡æ¿å½“ä¸­ã€‚è¯¥æ¨¡æ¿ä¸æ–°é—»å†…å®¹å°†ä¼šå½¢æˆä¸€ä¸ªå®Œæ•´çš„ç½‘é¡µï¼ŒåŒ…æ‹¬å®Œæ•´çš„ <code>html</code>ã€<code>head</code>ã€<code>body</code> ç­‰æ ‡ç­¾ã€‚</p><figure class="highlight plain"><figcaption><span>html</span></figcaption><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;æ–°é—»å†…é¡µ&lt;/title&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;/&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">    </span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;article id=&quot;_xplan-wrapper&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;vid_wz&quot;&gt;</span><br><span class="line">            ...</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/article&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹çš„å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ª <code>meta</code> æ ‡ç­¾ï¼š</p><figure class="highlight plain"><figcaption><span>html</span></figcaption><table><tr><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;</span><br></pre></td></tr></table></figure><p>å®ƒçš„æ„æ€æ˜¯å®šä¹‰ <code>viewport</code> çš„ä¸€äº›å±æ€§ï¼Œå®ç°äº†åˆæ­¥çš„æ‰‹æœºç½‘é¡µé€‚é…ã€‚</p><h3 id="Viewport"><a href="#Viewport" class="headerlink" title="Viewport"></a>Viewport</h3><p>æ‰‹æœºæµè§ˆå™¨æ˜¯æŠŠé¡µé¢æ”¾åœ¨ä¸€ä¸ªè™šæ‹Ÿçª—å£ï¼ˆå³ <code>viewport</code>ï¼‰ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¹³ç§»å’Œç¼©æ”¾æ¥çœ‹ç½‘é¡µçš„ä¸åŒéƒ¨åˆ†ã€‚</p><p>é€šè¿‡ <code>viewport</code> æˆ‘ä»¬èƒ½å¯¹é¡µé¢çš„ä¸€äº›ç¼©æ”¾è¿›è¡Œæ‰‹æœºé€‚é…ã€‚</p><p>æˆ‘ä»¬æ‰€éœ€è¦åšçš„ä»…æ˜¯åœ¨ <code>head</code> ä¸­æ’å…¥ä¸€ä¸ª <code>meta</code> æ ‡ç­¾ï¼Œå‘½åä¸º <code>viewport</code>ï¼Œç„¶åå®šä¹‰å¥½å…¶ <code>content</code>ã€‚</p><p><code>content</code> çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><h4 id="width"><a href="#width" class="headerlink" title="width"></a>width</h4><p>æ§åˆ¶ <code>viewport</code> çš„å®½åº¦ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªå€¼æˆ–è€…ç‰¹æ®Šçš„å€¼ï¼Œå¦‚ <code>device-width</code> ä¸ºè®¾å¤‡å®½åº¦ã€‚</p><h4 id="height"><a href="#height" class="headerlink" title="height"></a>height</h4><p>ä¸ <code>width</code> ç›¸å¯¹åº”ï¼ŒæŒ‡å®šé«˜åº¦</p><h4 id="initial-scale"><a href="#initial-scale" class="headerlink" title="initial-scale"></a>initial-scale</h4><p>åˆå§‹ç¼©æ”¾ï¼Œå³é¡µé¢åˆå§‹ç¼©æ”¾ç¨‹åº¦ã€‚è¿™æ˜¯ä¸€ä¸ªæµ®ç‚¹å€¼ï¼Œæ˜¯é¡µé¢å¤§å°çš„ä¸€ä¸ªä¹˜æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½®åˆå§‹ç¼©æ”¾ä¸º <code>1.0</code>ï¼Œé‚£ä¹ˆé¡µé¢åœ¨å±•ç°çš„æ—¶å€™å°±ä¼šä»¥åˆ†è¾¨ç‡çš„1:1æ¥å±•ç°ã€‚å¦‚æœä½ è®¾ç½®ä¸º<code>2.0</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡µé¢å°±ä¼šæ”¾å¤§ä¸º2å€ã€‚</p><h4 id="maximum-scale"><a href="#maximum-scale" class="headerlink" title="maximum-scale"></a>maximum-scale</h4><p>æœ€å¤§æ”¾å¤§å€æ•°ã€‚</p><h4 id="user-scaleble"><a href="#user-scaleble" class="headerlink" title="user-scaleble"></a>user-scaleble</h4><p>ç”¨æˆ·è°ƒæ•´ç¼©æ”¾ï¼Œå³ç”¨æˆ·æ˜¯å¦èƒ½æ”¹å˜é¡µé¢ç¼©æ”¾ç¨‹åº¦ã€‚å¦‚æœä¸º <code>yes</code> å³ä¸ºå¯ä»¥ï¼Œ <code>no</code> ä¸ºä¸å¯ä»¥ã€‚</p><h2 id="Cheerioæ¨¡å—"><a href="#Cheerioæ¨¡å—" class="headerlink" title="Cheerioæ¨¡å—*"></a>Cheerioæ¨¡å—*</h2><p>ç”±äº <strong>XPlan</strong> çš„åç«¯æ˜¯åŸºäº <code>node.js</code> æ„æ¶çš„ï¼Œæ‰€ä»¥ <strong>cheerio</strong> æ¨¡å—æ˜¯ä¸€ä¸ª <code>node.js</code> ä¸“æœ‰çš„æ¨¡å—ã€‚</p><p>å®ƒçš„ä½œç”¨æ˜¯å°†ä¸€æ®µHTMLä»£ç è½¬æ¢ä¸ºä¸€æ£µDOMå…ƒç´ æ ‘ã€‚</p><p>åœ¨å…¶å®˜ç½‘ä¸Šæ˜¯è¿™ä¹ˆè¯ é‡Šçš„ï¼šä¸ºæœåŠ¡ç«¯å®šåˆ¶çš„å¿«é€Ÿã€çµæ´»ã€è½»é‡çº§å®ç°çš„ jQuery å†…æ ¸ã€‚é€šå¸¸ç†Ÿæ‚‰ jQuery ä½¿ç”¨çš„å¼€å‘è€…åº”è¯¥ä¼šå¯¹å…¶ä½¿ç”¨æ–¹æ³•æ¯”è¾ƒç†Ÿæ‚‰ã€‚</p><p>æ‰€ä»¥åœ¨æˆ‘ä»¬åšæ¥ä¸‹å»é€‚é…ä¿®æ”¹çš„ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬åˆšæ‰ç”Ÿæˆçš„å®Œæ•´HTMLä»£ç  è½¬æ¢ä¸ºä¸€æ£µæˆ‘ä»¬å¯ä»¥æ“ä½œçš„DOMå…ƒç´ æ ‘ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var cheerio = require(&quot;cheerio&quot;);</span><br><span class="line">$ = cheerio.load(...);</span><br></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬ä¾¿èƒ½ä»¥ç†Ÿæ‚‰çš„jQueryæ¨¡å¼å¯¹å…¶è¿›è¡Œæ“ä½œäº†ï¼Œå¦‚ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">$(&quot;p&quot;).html(&quot;hello foo!&quot;);</span><br></pre></td></tr></table></figure><h2 id="Bootstrap"><a href="#Bootstrap" class="headerlink" title="Bootstrap"></a>Bootstrap</h2><p>Bootstrapæ˜¯Twitteræ¨å‡ºçš„ä¸€ä¸ªå¼€æºçš„ç”¨äºå‰ç«¯å¼€å‘çš„å·¥å…·åŒ…ã€‚å®ƒæœ‰ä¸€ä¸ªéå¸¸å¥½çš„å“åº”å¼çš„é¡µé¢é£æ ¼ï¼Œä½¿å…¶åœ¨ä¸ªå°ºå¯¸å±å¹•ä¸Šè¡¨ç°è‰¯å¥½ã€‚</p><p>ä¸ºäº†èƒ½æ›´å¥½é€‚åº”å±å¹•ï¼Œæˆ‘ä»¬å†³å®šé‡‡ç”¨å…¶è‡ªå¸¦çš„æ …æ ¼ç³»ç»Ÿï¼Œäºæ˜¯åˆšæ‰çš„é¡µé¢æ¨¡æ¿å°±æœ‰äº†æ–°çš„å˜åŒ–ï¼š</p><figure class="highlight plain"><figcaption><span>html</span></figcaption><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;æ–°é—»å†…é¡µ&lt;/title&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;/&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">    </span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;article class=&quot;container&quot; id=&quot;_xplan-wrapper&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;col-md-12&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;vid_wz&quot;&gt;...&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/article&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæœ€å¤–æ¡†çš„ <code>container</code>ï¼Œç”¨å…¶åŒ…è£¹çš„å…ƒç´ å°†å®ç°å±…ä¸­å¯¹é½ã€‚åœ¨ä¸åŒçš„åª’ä½“æŸ¥è¯¢é˜ˆå€¼èŒƒå›´å†…éƒ½ä¸º <code>container</code> è®¾ç½®äº† <code>width</code>ï¼Œç”¨ä»¥åŒ¹é…æ …æ ¼ç³»ç»Ÿã€‚</p><p><code>row</code> æ˜¯ä¸€è¡Œæ …æ ¼ç³»ç»Ÿçš„å¤–åŒ…å…ƒç´ ã€‚ä¸€è¡Œå¯ä»¥æœ‰12ä¸ªæ …æ ¼ã€‚</p><p>ä»¥ <code>.col-md-</code> å¼€å¤´çš„æ …æ ¼çš„æœ€å¤§ <code>container</code> å®½åº¦ä¸º970ï¼Œæœ€å¤§åˆ—å®½ä¸º78ï¼Œå¹¶èƒ½è‡ªé€‚åº”å±å¹•ã€‚</p><h2 id="ç»†èŠ‚å¤„ç†"><a href="#ç»†èŠ‚å¤„ç†" class="headerlink" title="ç»†èŠ‚å¤„ç†"></a>ç»†èŠ‚å¤„ç†</h2><p>åœ¨å®Œæˆäº†ä»¥ä¸Šæ“ä½œä»¥åï¼Œæˆ‘ä»¬å°†å¯¹å„å…ƒç´ è¿›è¡Œå¾®è°ƒå¤„ç†ã€‚</p><p>å¥½åœ¨åœ¨æ‰‹æœºæµè§ˆå™¨æˆ–è€… <code>WebView</code> ä¸­ï¼Œå¯¹å„ç§å­—ä½“çš„è®¾ç½®ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ç„¶å¯ä»¥ä¸å¤„ç†ä¸€äº›å…³äºå­—ä½“å˜æ›´çš„è®¾ç½®ï¼Œä»¥å‡è½»å¼€å‘é‡ã€‚</p><p>è¿™é‡Œè·å‡ ä¸ªå¾®è°ƒçš„ä¾‹å­ã€‚</p><h3 id="lt-img-gt"><a href="#lt-img-gt" class="headerlink" title="&lt;img /&gt;"></a>&lt;img /&gt;</h3><p>åœ¨æ–°é—»å½“ä¸­ï¼Œå›¾ç‰‡å……å½“çš„åŸºæœ¬ä¸Šæ˜¯æ–°é—»ç…§ç‰‡çš„è§’è‰²ï¼Œåœ¨æ‰‹æœºå½“ä¸­ä»¥å•è¡Œå‡ºç°ä¸ºä½³ã€‚</p><p>è€Œ Bootstrap å½“ä¸­æœ¬èº«å°±æœ‰å…ƒç´ ç±»å‹æ¥è®©å›¾ç‰‡å…ƒç´ å“åº”å±å¹•å®½åº¦ï¼Œå¹¶å¯ä»¥åŠ ä¸Šåœ†è§’è¾¹æ¡†ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ä¸ºæ‰€æœ‰å›¾ç‰‡åŠ ä¸Šå“åº”çš„ç±»å‹ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">$(&quot;img&quot;).addClass(&quot;img-thumbnail&quot;);</span><br><span class="line">$(&quot;img&quot;).addClass(&quot;img-responsive&quot;);</span><br><span class="line">$(&quot;img&quot;).removeAttr(&quot;style&quot;);</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„ï¼š</strong> æœ€åçš„ä¸€ä¸ªç§»é™¤ <code>img</code> å…ƒç´ è‡ªå¸¦çš„ <code>style</code> å±æ€§æ˜¯å› ä¸ºåœ¨æ–‡ç« å‘å¸ƒçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šè¢«å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è‡ªåŠ¨åŠ ä¸Šä¸€äº›å®½é«˜ã€è¾¹æ¡†ç­‰ä¿¡æ¯ã€‚ä¸ºäº†ç»Ÿä¸€æ‰€æœ‰å›¾ç‰‡é£æ ¼ä»¥åŠè®©å“åº”å¼ç”Ÿæ•ˆï¼Œéœ€è¦å°†å…¶ <code>style</code> å±æ€§å…¨éƒ¨ç§»é™¤ã€‚</p></blockquote><p>ä¸‹é¢æ˜¯æ˜¯é€‚é…å‰ä¸é€‚é…åçš„å¯¹æ¯”ï¼š</p><p><img src="./xplan-news-2.jpg" alt="é€‚é…å‰"><br><img src="./xplan-news-1.jpg" alt="é€‚é…å"></p><h3 id="lt-table-gt-lt-table-gt"><a href="#lt-table-gt-lt-table-gt" class="headerlink" title="&lt;table&gt;&lt;/table&gt;"></a>&lt;table&gt;&lt;/table&gt;</h3><p>å¯¹äº <code>table</code> å…ƒç´ ä¹Ÿéœ€è¦å¯¹å®ƒè¿›è¡Œè‡ªé€‚é…ï¼Œä¸ç„¶å¾ˆæœ‰å¯èƒ½ä¼šæº¢å‡ºå±å¹•ï¼Œä½¿å…¶å¤šå‡ºäº†ä¸€ä¸ªæ¨ªå‘çš„æ»šåŠ¨æ¡ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">$(&quot;table&quot;).removeAttr(&quot;style&quot;);</span><br><span class="line">$(&quot;table&quot;).removeAttr(&quot;border&quot;);</span><br><span class="line"></span><br><span class="line">$(&quot;table&quot;).addClass(&quot;table&quot;);</span><br><span class="line">$(&quot;table&quot;).addClass(&quot;table-bordered&quot;);</span><br><span class="line">$(&quot;table&quot;).addClass(&quot;table-striped&quot;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤å¥æ˜¯ç§»é™¤ <code>table</code> çš„åŸæœ‰çš„ä¸€äº›é£æ ¼ä¿¡æ¯ä»¥åŠå±æ€§ã€‚åé¢æ˜¯ä¸ºå…¶åŠ ä¸Š Bootstrap ç‰¹æœ‰çš„ <code>table</code> ç±»å‹ã€‚</p><p>å½“ç„¶ï¼Œæ›´å¤šçš„ <code>table</code> å…ƒç´ è¿˜éœ€è¦å…¶å®ƒæ›´å¤šæ“ä½œã€‚ä¸è¿‡å°±ç›®å‰ä¸ºæ­¢ï¼Œ<strong>XPlan</strong> è¿˜æ²¡æœ‰ç€æ‰‹å…³äº <code>table</code> çš„æ›´æ·±ä¸€å±‚å®¹é”™å¤„ç†ã€‚ä¸è¿‡è¿™é‡Œå¯ä»¥æä¾›ä¸€ä¸ªæ€è·¯ã€‚</p><p>æ¯”å¦‚è¯´ <a href="http://www.cst.zju.edu.cn/index.php?c=Index&amp;a=detail&amp;catid=72&amp;id=1885" target="_blank" rel="external">è¿™ç¯‡æ–‡ç« ä¸­</a>ï¼Œä¸çŸ¥é“æ˜¯è°ç»™çš„åœ¨çº¿å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å‹‡æ°”ï¼Œä½¿å…¶ä¸‹é¢å‡ å¼ å›¾ç‰‡éƒ½å„è‡ªè¢«ä¸€ä¸ª <code>table</code> åŠå…¶å­å…ƒç´ æ‰€åŒ…å«ã€‚æ›´æœ‰ç”šè€…ï¼Œæœ‰ä¸€ç¯‡æ–‡ç« çš„ä¸€ä¸ªæ®µè½è¢«ä¸€ä¸ª <code>table</code> æ‰€åŒ…å®¹ï¼Œå¹¶ä¸”åœ¨å…¶å·¦ä¾§è¿˜æœ‰ä¸€ä¸ªçœ‹ä¸è§çš„ <code>td</code> å…ƒç´ ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æä¾›çš„æ€è·¯å°±æ˜¯å¦‚æœä¸€ä¸ª <code>table</code> åªæœ‰ä¸€è¡Œä¸€åˆ—å°±ç›´æ¥å°†å…¶å†…å®¹å–å‡ºå¹¶åˆ é™¤è¯¥ <code>table</code> ã€‚</p><h3 id="lt-a-gt"><a href="#lt-a-gt" class="headerlink" title="&lt;a /&gt;"></a>&lt;a /&gt;</h3><p>è¶…é“¾æ¥å…ƒç´ æ˜¯ä¸€ä¸ªæ–°é—»ä¸ç”¨æˆ·äº’åŠ¨çš„æ¯”è¾ƒé‡è¦çš„å…ƒç´ ä¹‹ä¸€ã€‚æˆ‘ä»¬éœ€è¦ä¿æŒå…¶ç¾è§‚æ€§ã€‚</p><p>ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¶…é“¾æ¥ä»¥ä¸€ä¸ªç±»æŒ‰é’®çš„å½¢å¼å‡ºç°ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">$(&quot;a&quot;).removeAttr(&quot;style&quot;);</span><br><span class="line">$(&quot;a&quot;).addClass(&quot;btn btn-default btn-xs btn-info&quot;);</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬ç”šè‡³å¯ä»¥å¯¹å…¶åšä¸€äº›ç»†å¾®çš„è¯æ±‡ä¿®æ”¹ã€‚</p><p>æ¯”å¦‚å½“æ–°é—»å‘å¸ƒè€…ä¸Šä¼ äº†ä¸€ä¸ªé™„ä»¶ç„¶åä¸è´Ÿè´£ä»»åœ°ç›´æ¥å°†æ–‡ä»¶åè´´ä¸Šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è´´å¿ƒåœ°å°†å…¶æ˜¾ç¤ºæ–‡å­—æ”¹ä¸ºâ€œä¸‹è½½é™„ä»¶â€ã€‚</p><p>å†æ¯”å¦‚å‘å¸ƒè€…ç›´æ¥ä»¥URLå½¢å¼æ˜¾ç¤ºä¸€ä¸ªè¶…é“¾æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è´´å¿ƒåœ°å°†å…¶æ”¹å˜ä¸ºâ€œæ‰“å¼€é“¾æ¥â€ç­‰ç­‰ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">$(&quot;a&quot;).each(function(idx, elem) &#123;</span><br><span class="line">    if($(this).html().match(/.*\.(doc|xls|ppt|docx|xlsx|pptx)/)) &#123;</span><br><span class="line">        $(this).html(&quot;&lt;i class=&apos;glyphicon glyphicon-paperclip&apos;&gt;&lt;/i&gt; ä¸‹è½½é™„ä»¶&quot;);</span><br><span class="line">        $(this).removeClass(&quot;btn-info&quot;);</span><br><span class="line">        $(this).addClass(&quot;btn-warning&quot;);</span><br><span class="line">    &#125; else if($(this).html().match(/http.*\/\/.*/)) &#123;</span><br><span class="line">        $(this).html(&quot;&lt;i class=&apos;glyphicon glyphicon-flag&apos;&gt;&lt;/i&gt; æ‰“å¼€é“¾æ¥&quot;);</span><br><span class="line">        $(this).removeClass(&quot;btn-info&quot;);</span><br><span class="line">        $(this).addClass(&quot;btn-warning&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å†å¤„ç†å‡ ä¸ªç”±äºè¯¯æ“ä½œè€Œå¢åŠ çš„é”™è¯¯é“¾æ¥ï¼Œå¦‚åœ¨ç»ä¸Šé¢æ“ä½œåï¼Œè¿˜å­˜åœ¨ç€urlä¸æ˜¾ç¤ºå†…å®¹ç›¸å…³çš„è¶…é“¾æ¥å¯ä»¥ç›´æ¥å–æ¶ˆï¼Œå¦‚è¿™ç±»ï¼š</p><figure class="highlight plain"><figcaption><span>html</span></figcaption><table><tr><td class="code"><pre><span class="line">è®©æˆ‘ä»¬è¡&lt;a href=&quot;èµ·åŒæ¡¨&quot;&gt;èµ·åŒæ¡¨&lt;/a&gt;</span><br></pre></td></tr></table></figure><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>è‡³æ­¤ï¼Œå½“ä¸‹ç‰ˆæœ¬çš„ <strong>XPlan</strong> çš„æ–°é—»çˆ¬è™«æ‰‹æœºå±å¹•é€‚é…åŸºæœ¬å®Œæˆã€‚å…¶ä¸­å½“ç„¶è¿˜å­˜åœ¨ç€ä¸€äº›ç»†èŠ‚å¤„ç†å’Œæ˜¾ç¤ºé”™è¯¯å¤„ç†çš„ä¸è¶³ï¼Œä½†æ˜¯å·²ç»å®šä¸‹äº†åŸºæœ¬çš„é€‚é…æ€è·¯ã€‚</p><p>æˆ‘ä»¬è¿˜åœ¨æ¢ç´¢æ›´å¥½çš„é€‚é…æ–¹æ³•ï¼Œè€Œå½“ä¸‹çš„é€‚é…å½¢å¼æš‚æ—¶å·²ç»å¯ä»¥æ»¡è¶³äº†æˆ‘ä»¬é¡¹ç›®çš„éœ€æ±‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;XPlan&lt;/strong&gt; æ˜¯ä¸€ä¸ªâ€œåŸºäºæ ¡å›­å¼ºå…³ç³»çš„ç¤¾äº¤åº”ç”¨â€çš„å¼€å‘ä»£å·ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªåŠŸèƒ½æ˜¯ä»å­¦æ ¡ç½‘ç«™ä¸Šé€šè¿‡ç½‘ç»œçˆ¬è™«ï¼ˆWeb
      
    
    </summary>
    
      <category term="Programming" scheme="https://xcoder.in/categories/Programming/"/>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="XPlan" scheme="https://xcoder.in/tags/XPlan/"/>
    
  </entry>
  
  <entry>
    <title>TopCoder SRM 589 DIV 2</title>
    <link href="https://xcoder.in/2013/08/31/srm-589-div2/"/>
    <id>https://xcoder.in/2013/08/31/srm-589-div2/</id>
    <published>2013-08-30T16:00:00.000Z</published>
    <updated>2017-12-11T07:59:20.542Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€å¥½ä¹…æ²¡æ’¸ <strong>TC</strong> äº†ï¼Œæ‰‹éƒ½ç”Ÿäº†ã€‚å‰ä¸¤å¤©åˆšæŠ˜è…¾å¥½ <strong>LinuxMint</strong> + <strong>Cinnamon</strong>ï¼Œé¡ºä¾¿æ‰‹è´±æŠŠ <strong>TC</strong> ç¯å¢ƒé…å¥½äº†ã€‚</p><p>ã€€ã€€éšä¾¿è¿›å»æ‰¯äº†ä¸€å¥—æœ€æ–°çš„ <strong>SRM</strong> æ¥æï¼Œå…¨è·‘å®Œä¹‹åæ‰å‘ç°åŸæ¥è¿™åœºæ¯”èµ›è¿˜å¤„äº <strong>System Running</strong> é˜¶æ®µã€‚äºæ˜¯çŸ¥é“äº†æ¯”èµ›ä¸€ç»“æŸè¿˜åœ¨ <strong>Running</strong> çš„æ—¶å€™ä½ å°±å·²ç»å¯ä»¥è‡ªå·±æ‹‰å‡ºæ¥åšäº†ã€‚å°ç»¿åå¤§å®¶ä¸è¦ç¬‘ã€‚</p><!-- æˆ‘æ˜¯å°å°åˆ†å‰²ç¬¦ --><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>ã€€ã€€è¿™æ¬¡ <strong>DIV 2</strong> çš„éš¾åº¦ä¸€èˆ¬ï¼Œä¸€é“ç­¾åˆ°é¢˜åŠ ä¸¤é“æ™®é€šçš„ <strong>DP</strong>ã€‚</p><p>ã€€ã€€<a href="https://github.com/XadillaX/xadillax-topcoder/tree/master/code/SRM589-DIV2" target="_blank" rel="external">Code on GitHub</a>.</p><h2 id="250pt-Goose-Tattarrattat"><a href="#250pt-Goose-Tattarrattat" class="headerlink" title="250pt - Goose Tattarrattat"></a>250pt - Goose Tattarrattat</h2><p>é¢˜æ„å¾ˆç®€å•ï¼Œå°±æ˜¯ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé—®ä½ æœ€å°‘æ”¹å˜å¤šå°‘å­—ç¬¦è®©å­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦éƒ½ä¸€æ ·ã€‚</p><p>ç­¾åˆ°é¢˜ï¼Œæ‰¾æœ€å¤šçš„å­—ç¬¦è·Ÿæ€»é•¿åº¦ä¸€å‡å°±OKäº†ã€‚</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">#define SIZE(x) ((int)(x.size()))</span><br><span class="line">#define LENGTH(x) ((int)(x.length()))</span><br><span class="line">class GooseTattarrattatDiv2 </span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    int getmin(string S);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int GooseTattarrattatDiv2::getmin(string S)</span><br><span class="line">&#123;</span><br><span class="line">    int maxsame = 0;</span><br><span class="line">    map&lt;char, int&gt; mp;</span><br><span class="line">    for(int i = 0; i &lt; LENGTH(S); i++)</span><br><span class="line">    &#123;</span><br><span class="line">    mp[S[i]]++;</span><br><span class="line">    maxsame = max(maxsame, mp[S[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return LENGTH(S) - maxsame;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="500pt-Gears"><a href="#500pt-Gears" class="headerlink" title="500pt - Gears"></a>500pt - Gears</h2><p>æœ‰ <strong><em>N</em></strong> ä¸ªé½¿è½®å›´æˆä¸€åœˆï¼Œç›¸é‚»ä¸¤ä¸ªé½¿è½®è¦åæ–¹å‘è½¬æ‰èƒ½æ­£å¸¸è¿è½¬ä¸å¡åˆ°å…¶å®ƒè½®å­ã€‚ä½ è¦ä»ä¸­é—´æ‹¿æ‰å‡ ä¸ªé½¿è½®ï¼ˆç•™ç©ºäº†å°±ä¸å½±å“å…¶å·¦è¾¹çš„å·¦è¾¹çš„é½¿è½®ï¼‰ï¼Œé—®æœ€å°‘æ‹¿æ‰å‡ ä¸ªä½¿å¾—æ‰€æœ‰é½¿è½®èƒ½æ­£å¸¸è½¬ã€‚</p><p>æˆ‘ä»¬å»ºä¸¤ä¸ªäºŒç»´ <strong><em>dp</em></strong> æ•°ç»„ï¼Œæˆ–è€…ä¸€ä¸ªä¸‰ç»´ <strong><em>dp</em></strong> æ•°ç»„ï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">dp[i][0|1][0|1]</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç»´ <code>i</code> ä»£è¡¨å½“å‰æ˜¯ç¬¬ <code>i</code> ä¸ªé½¿è½®ã€‚ç¬¬äºŒç»´è‹¥æ˜¯ <code>0</code> åˆ™è¡¨ç¤ºè¿™ä¸ªé½¿è½®æ‹¿èµ°ï¼Œè‹¥æ˜¯ <code>1</code> ä»£è¡¨ç•™ä¸‹ã€‚ç¬¬ä¸‰ç»´è‹¥æ˜¯ <code>0</code> åˆ™ä»£è¡¨ç¬¬ä¸€ä¸ªé½¿è½®æ‹¿èµ°ï¼Œ<code>1</code> ä»£è¡¨ç¬¬ä¸€ä¸ªé½¿è½®ç•™ä¸‹ã€‚æ•´ä¸ªæ•°ç»„çš„æ¯ä¸ªå…ƒç´ å°±ä»£è¡¨è¯¥é½¿è½®ç•™ä¸‹æˆ–è€…æ‹¿èµ°ä¸”ç¬¬ä¸€ä¸ªé½¿è½®æ˜¯ç•™ä¸‹æˆ–è€…æ‹¿èµ°çš„æƒ…å†µä¸‹çš„æœ€å°‘æ‹¿èµ°é½¿è½®æ•°ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬èƒ½å¾—åˆ°å‡ ä¸ªçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><blockquote><h3 id="ç¬¬ä¸€ä¸ªé½¿è½®"><a href="#ç¬¬ä¸€ä¸ªé½¿è½®" class="headerlink" title="ç¬¬ä¸€ä¸ªé½¿è½®"></a>ç¬¬ä¸€ä¸ªé½¿è½®</h3></blockquote><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">dp[i][0][0] = 1;</span><br><span class="line">dp[i][0][1] = INF;</span><br><span class="line">dp[i][1][1] = 0;</span><br><span class="line">dp[i][1][0] = INF;</span><br></pre></td></tr></table></figure><blockquote><h3 id="ç¬¬äºŒä¸ªé½¿è½®"><a href="#ç¬¬äºŒä¸ªé½¿è½®" class="headerlink" title="ç¬¬äºŒä¸ªé½¿è½®"></a>ç¬¬äºŒä¸ªé½¿è½®</h3><p>å¦‚æœä¸ç¬¬ä¸€ä¸ªåŒå‘é‚£ä¹ˆå°±æœ‰äº†ä¸€ç•™ä¸€èµ°æˆ–è€…ä¸¤ä¸ªéƒ½èµ°çš„æƒ…å†µã€‚å¦åˆ™å°±æ˜¯å››ç§æƒ…å†µéƒ½å¯ä»¥ã€‚</p></blockquote><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">if(ä¸ç¬¬ä¸€ä¸ªé½¿è½®åŒå‘)</span><br><span class="line">&#123;</span><br><span class="line">    dp[1][0][1] = 1;</span><br><span class="line">    dp[1][1][0] = 1;</span><br><span class="line">    dp[1][0][0] = 2;</span><br><span class="line">    dp[1][1][1] = INF;</span><br><span class="line">&#125;</span><br><span class="line">else </span><br><span class="line">&#123;</span><br><span class="line">    dp[i][0][0] = 2;</span><br><span class="line">    dp[i][0][1] = 1;</span><br><span class="line">    dp[i][1][0] = 1;</span><br><span class="line">    dp[i][1][1] = 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><h3 id="ä¹‹åçš„æ‰€æœ‰é½¿è½®"><a href="#ä¹‹åçš„æ‰€æœ‰é½¿è½®" class="headerlink" title="ä¹‹åçš„æ‰€æœ‰é½¿è½®"></a>ä¹‹åçš„æ‰€æœ‰é½¿è½®</h3><p>è‹¥è¯¥é½¿è½®ä¸å‰ä¸€ä¸ªé½¿è½®æ–¹å‘ç›¸åŒ ï¼Œé‚£ä¹ˆè¯¥é½¿è½®ç•™ä¸‹çš„æ—¶å€™ï¼Œå‰ä¸€ä¸ªé½¿è½®å¿…é¡»å¾—èµ°ï¼Œé‚£ä¹ˆå°±æ˜¯ <code>dp[i - 1][0][?]</code>;è¯¥é½¿è½®èµ°çš„æ—¶å€™ï¼Œå‰ä¸€ä¸ªé½¿è½®å¯èµ°å¯ç•™ï¼Œå°±æ˜¯ <code>dp[i - 1][0|1][?] + 1</code> çš„ç¨å¾®å°ä¸€ç‚¹é‚£ä¸ªã€‚</p><p>è‹¥æ–¹å‘ä¸ç›¸åŒ ï¼Œé‚£ä¹ˆå°±æ˜¯è¯¥é½¿è½®ç•™ä¸‹çš„æ—¶å€™ï¼Œå‰ä¸€ä¸ªé½¿è½®ä¹Ÿå¯ä»¥ç•™ä¸‹ã€‚</p></blockquote><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">if(ä¸å‰ä¸€ä¸ªé½¿è½®åŒå‘)</span><br><span class="line">&#123;</span><br><span class="line">    dp[i][1][0] = dp[i - 1][0][0];</span><br><span class="line">    dp[i][1][1] = dp[i - 1][0][1];</span><br><span class="line"></span><br><span class="line">    dp[i][0][0] = min(dp[i - 1][1][0], dp[i - 1][0][0]) + 1;</span><br><span class="line">    dp[i][0][1] = min(dp[i - 1][1][1], dp[i - 1][1][0]) + 1;</span><br><span class="line">&#125;</span><br><span class="line">else </span><br><span class="line">&#123;</span><br><span class="line">    dp [i][1][0] = min(dp[i - 1][0][0], dp[i - 1][1][0]);</span><br><span class="line">    dp [i][1][1] = min(dp[i - 1][0][1], dp[i - 1][1][1]);</span><br><span class="line"></span><br><span class="line">    dp [i][0][0] = min(dp[i - 1][1][0], dp[i - 1][0][0]) + 1;</span><br><span class="line">    dp [i][0][1] = min(dp[i - 1][1][1], dp[i - 1][1][1]) + 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åè‹¥æœ€åä¸€ä¸ªé½¿è½®ä¸ç¬¬ä¸€ä¸ªé½¿è½®åŒå‘ï¼Œé‚£ä¹ˆåœ¨ <code>dp[i - 1][0][0]</code>ã€<code>dp[i - 1][0][1]</code>ã€<code>dp[i - 1][1][0]</code> ä¸­æŒ‘ä¸€ä¸ªã€‚è‹¥ä¸åŒå‘ï¼Œé‚£ä¹ˆå¤šäº†ä¸ª <code>dp[i - 1][1][1]</code> è¿™ä¸ªé€‰æ‹©ã€‚</p><p>ä¸‹é¢å°±æ˜¯ä»£ç äº†ï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">class GearsDiv2 </span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    int getmin(string Directions);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int GearsDiv2::getmin(string Directions)</span><br><span class="line">&#123;</span><br><span class="line">    int dp[100][2][2];</span><br><span class="line">    for(int i = 0; i &lt; LENGTH(Directions); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        if(i == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            dp[i][0][0] = 1;</span><br><span class="line">            dp[i][0][1] = 10000000;</span><br><span class="line">            dp[i][1][1] = 0;</span><br><span class="line">            dp[i][1][0] = 10000000;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        if(i == 1)</span><br><span class="line">        &#123;</span><br><span class="line">            if(Directions[i] == Directions[i - 1])</span><br><span class="line">            &#123;</span><br><span class="line">                dp[i][0][1] = 1;</span><br><span class="line">                dp[i][1][0] = 1;</span><br><span class="line">                </span><br><span class="line">                dp[i][0][0] = 2;</span><br><span class="line">                dp[i][1][1] = 10000000;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                dp[i][0][0] = 2;</span><br><span class="line">                dp[i][0][1] = 1;</span><br><span class="line">                dp[i][1][0] = 1;</span><br><span class="line">                dp[i][1][1] = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        if(Directions[i] == Directions[i - 1])</span><br><span class="line">        &#123;</span><br><span class="line">            dp[i][1][0] = dp[i - 1][0][0];</span><br><span class="line">            dp[i][1][1] = dp[i - 1][0][1];</span><br><span class="line">            </span><br><span class="line">            dp[i][0][0] = min(dp[i - 1][1][0], dp[i - 1][0][0]) + 1;</span><br><span class="line">            dp[i][0][1] = min(dp[i - 1][1][1], dp[i - 1][0][1]) + 1;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            dp[i][1][0] = min(dp[i - 1][0][0], dp[i - 1][1][0]);</span><br><span class="line">            dp[i][1][1] = min(dp[i - 1][0][1], dp[i - 1][1][1]);</span><br><span class="line">            </span><br><span class="line">            dp[i][0][0] = min(dp[i - 1][1][0], dp[i - 1][0][0]) + 1;</span><br><span class="line">            dp[i][0][1] = min(dp[i - 1][1][1], dp[i - 1][1][1]) + 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    int ans;</span><br><span class="line">    int mi = LENGTH(Directions) - 1;</span><br><span class="line">    if(Directions[mi] == Directions[0])</span><br><span class="line">    &#123;</span><br><span class="line">        ans = min(dp[mi][0][0], min(dp[mi][1][0], dp[mi][0][1]));</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        ans = min(min(dp[mi][0][0], dp[mi][1][1]), min(dp[mi][0][1], dp[mi][1][0]));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1000pt-Flipping-Bits"><a href="#1000pt-Flipping-Bits" class="headerlink" title="1000pt - Flipping Bits"></a>1000pt - Flipping Bits</h2><p>ç»™ä½ ä¸€ä¸ª <strong>01ä¸²</strong> ä¸ä¸€ä¸ªæ­£æ•´æ•° <strong><em>M</em></strong>ã€‚<strong>01ä¸²</strong> æœ‰å¦‚ä¸‹ä¸‰ç§æ“ä½œ:</p><ul><li>éšä¾¿åè½¬ä¸€ä½ï¼ˆ0 -&gt; 1, 1 -&gt; 0ï¼‰ã€‚</li><li>å°†å¼€å¤´ <code>k * M</code> ä½åè½¬ã€‚k å¯ä»¥æ˜¯ä»»ä½•æ­£æ•´æ•°ã€‚</li><li>å°†æœ«å°¾ <code>k * M</code> ä½åè½¬ã€‚k å¯ä»¥æ˜¯ä»»ä½•æ­£æ•´æ•°ã€‚</li></ul><p>é—®æœ€å°‘éœ€è¦å‡ æ­¥å°†æ•´ä¸ªå­—ç¬¦ä¸²å˜æˆéƒ½æ˜¯ <code>1</code>ã€‚</p><p>è¿™åˆæ˜¯ä¸€ä¸ª <strong>DP</strong> çš„é¢˜ç›®ã€‚</p><p>æˆ‘ä»¬å…ˆè®¾æœ‰ <strong><em>G</em></strong> ç»„ï¼Œä¸€ç»„ <strong><em>M</em></strong> ä¸ª <code>01å­—ç¬¦</code>ã€‚é‚£ä¹ˆå°±èƒ½æœ‰</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">dp1[i][0|1]</span><br><span class="line">dp2[i][0|1]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>i</code> ä»£è¡¨ç¬¬ <code>i</code> ç»„ï¼Œç¬¬äºŒç»´å¦‚æœæ˜¯ <code>0</code> å°±ä»£è¡¨è¿™ä¸€ç»„é‡‡ç”¨ä¸€ä½ä½åè½¬çš„æ“ä½œå°†è¿™ç»„å…¨å˜æˆ <code>1</code>ï¼Œå¦‚æœæ˜¯ <code>1</code> åˆ™å°†æ•´ç»„å…¨éƒ¨åè½¬å†é‡‡ç”¨ä¸€ä½ä½åè½¬çš„æ“ä½œå°†è¿™ç»„å…¨å˜æˆ <code>1</code> ã€‚è‡³äº <code>dp1</code> å’Œ <code>dp2</code> åˆ™ä»£è¡¨ä»å¤´åˆ°å°¾å’Œä»å°¾åˆ°å¤´ã€‚</p><p>ç”±äºåªæœ‰ <code>0</code> å’Œ <code>1</code> åè½¬ï¼Œé‚£ä¹ˆä¸€ç»„åè½¬ä¸¤æ¬¡å°±èƒ½è¿˜åŸåŸçŠ¶â€”â€”è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ€§è´¨ã€‚</p><p>å¦‚æœæŸä¸€ç»„é‡‡ç”¨<strong>æ•´ç»„åè½¬</strong>çš„æ“ä½œï¼Œè‹¥å‰ä¸€ç»„ä¹Ÿæ˜¯<strong>æ•´ç»„åè½¬</strong>ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºæ“ä½œæ¬¡æ•°ä¸å˜ï¼Œåªæ˜¯å°†å‰ä¸€ç»„çš„åè½¬èŒƒå›´å»¶ç»­åˆ°è¿™ä¸€ç»„ï¼›è‹¥å‰ä¸€ç»„æ˜¯<strong>éæ•´ç»„åè½¬</strong>ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºä»å¤´åˆ°è¿™ä¸€ç»„åè½¬ä¹‹åï¼Œå‰é¢çš„æ‰€æœ‰ç»„å†åè½¬å›å»â€”â€”ç›¸å½“äºæ˜¯å¤šäº†ä¸¤æ¬¡æ“ä½œã€‚äºæ˜¯å°±æœ‰äº†ï¼ˆå…ˆåªæ‹¿ <code>dp1</code> ä½œä¸ºä¾‹å­ï¼‰ï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">dp1[i][1] = min(</span><br><span class="line">    dp[i - 1][0] + è¿™ä¸€ç»„1çš„æ•°é‡ + 2,</span><br><span class="line">    dp[i - 1][1] + è¿™ä¸€ç»„1çš„æ•°é‡ </span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å¦‚æœæŸä¸€ç»„é‡‡ç”¨<strong>éæ•´ç»„åè½¬</strong>ï¼Œé‚£ä¹ˆæ“ä½œæ¬¡æ•°å°±æ˜¯å‰ä¸€ç»„çš„<strong>æ•´ç»„åè½¬</strong>æˆ–è€…<strong>éæ•´ç»„åè½¬</strong>çš„æ“ä½œæ¬¡æ•°åŠ ä¸Šè¿™ä¸€ç»„ <code>0</code> çš„æ•°é‡ï¼š</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">dp1[i][0] = min(</span><br><span class="line">    dp[i - 1][0] + è¿™ä¸€ç»„0çš„æ•°é‡,</span><br><span class="line">    dp[i - 1][0] + è¿™ä¸€ç»„0çš„æ•°é‡</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç”¨ä¸Šé¢çš„è½¬ç§»æ–¹ç¨‹æŠŠæ­£åå‘éƒ½æ±‚äº†ä¸€éä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ±‚æ€»ç­”æ¡ˆäº†ï¼Œæ€»ç­”æ¡ˆå°±æ˜¯æˆ‘ä»¬æšä¸¾ä¸­é—´åªæœ‰<strong>æ“ä½œ1</strong>çš„æ®µçš„é¦–å°¾ï¼ŒåŠ ä¸Šè¯¥ä¸­é—´æ®µå‰éƒ¨åˆ†çš„ <strong><em>dp</em></strong> ç­”æ¡ˆå’Œå…¶åéƒ¨åˆ†çš„ <strong><em>dp</em></strong> ç­”æ¡ˆï¼Œå–å‡ºæœ€å°å€¼å°±æ˜¯äº†ã€‚</p><figure class="highlight plain"><figcaption><span>cpp</span></figcaption><table><tr><td class="code"><pre><span class="line">class FlippingBitsDiv2 </span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    int getmin(vector &lt;string&gt; S, int M);</span><br><span class="line">    </span><br><span class="line">    string str;</span><br><span class="line">    int group;</span><br><span class="line">    int tn1[2600], tnsum1[2600];</span><br><span class="line">    int tn2[2600], tnsum2[2600];</span><br><span class="line">    </span><br><span class="line">    int dp1[2600][2];</span><br><span class="line">    int dp2[2600][2];</span><br><span class="line">    </span><br><span class="line">    int calcsum(int l, int r)</span><br><span class="line">    &#123;</span><br><span class="line">        if(l &gt; r) return 0;</span><br><span class="line">        int tot = tnsum1[r] - tnsum1[l - 1];</span><br><span class="line">        return tot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int FlippingBitsDiv2::getmin(vector &lt;string&gt; S, int M)</span><br><span class="line">&#123;</span><br><span class="line">    str = &quot;&quot;;</span><br><span class="line">    for(int i = 0; i &lt; SIZE(S); i++) str += S[i];</span><br><span class="line">    group = LENGTH(str) / M;</span><br><span class="line">    ZERO(tn1);</span><br><span class="line">    ZERO(tn2);</span><br><span class="line">    </span><br><span class="line">    // init.</span><br><span class="line">    for(int i = 0; i &lt; group; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        int op = i * M;</span><br><span class="line">        int ed = op + M;</span><br><span class="line">        for(int j = op; j &lt; ed; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            if(str[j] == &apos;0&apos;) tn1[i]++, tn2[group - i - 1]++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        dp1[i][0] = 100000;</span><br><span class="line">        dp1[i][1] = 100000;</span><br><span class="line">        dp2[i][0] = 100000;</span><br><span class="line">        dp2[i][1] = 100000;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // tnsum</span><br><span class="line">    for(int i = 0; i &lt; group; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        if(i == 0) tnsum1[0] = tn1[0], tnsum2[0] = tn2[0];</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            tnsum1[i] = tnsum1[i - 1] + tn1[i];</span><br><span class="line">            tnsum2[i] = tnsum2[i - 1] + tn2[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // dp.</span><br><span class="line">    for(int i = 0; i &lt;= group; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        if(i == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            dp1[i][0] = dp1[i][1] = dp2[i][0] = dp2[i][1] = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        if(i == 1)</span><br><span class="line">        &#123;</span><br><span class="line">            // head -&gt; tail</span><br><span class="line">            dp1[i][0] = tn1[i - 1];</span><br><span class="line">            dp1[i][1] = 1 + (M - tn1[i - 1]);</span><br><span class="line">            </span><br><span class="line">            // tail -&gt; head</span><br><span class="line">            dp2[i][0] = tn2[i - 1];</span><br><span class="line">            dp2[i][1] = 1 + (M - tn2[i - 1]);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            // head -&gt; tail</span><br><span class="line">            dp1[i][0] = min(</span><br><span class="line">                dp1[i - 1][0] + tn1[i - 1],</span><br><span class="line">                dp1[i - 1][1] + tn1[i - 1]</span><br><span class="line">            );</span><br><span class="line">            dp1[i][1] = min(</span><br><span class="line">                dp1[i - 1][0] + 2 + (M - tn1[i - 1]),</span><br><span class="line">                dp1[i - 1][1] + (M - tn1[i - 1])</span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">            // tail -&gt; head</span><br><span class="line">            dp2[i][0] = min(</span><br><span class="line">                dp2[i - 1][0] + tn2[i - 1],</span><br><span class="line">                dp2[i - 1][1] + tn2[i - 1]</span><br><span class="line">            );</span><br><span class="line">            dp2[i][1] = min(</span><br><span class="line">                dp2[i - 1][0] + 2 + (M - tn2[i - 1]),</span><br><span class="line">                dp2[i - 1][1] + (M - tn2[i - 1])</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    int minans = 100000000;</span><br><span class="line">    for(int i = 0; i &lt;= group; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        for(int j = 0; j &lt;= group - i; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            int zzl = i;</span><br><span class="line">            int zzr = group - j - 1;</span><br><span class="line">            </span><br><span class="line">            minans = min(minans,</span><br><span class="line">                min(dp1[i][0], dp1[i][1]) +</span><br><span class="line">                min(dp2[j][0], dp2[j][1]) +</span><br><span class="line">                calcsum(zzl, zzr)</span><br><span class="line">                );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return minans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€å¥½ä¹…æ²¡æ’¸ &lt;strong&gt;TC&lt;/strong&gt; äº†ï¼Œæ‰‹éƒ½ç”Ÿäº†ã€‚å‰ä¸¤å¤©åˆšæŠ˜è…¾å¥½ &lt;strong&gt;LinuxMint&lt;/strong&gt; + &lt;strong&gt;Cinnamon&lt;/strong&gt;ï¼Œé¡ºä¾¿æ‰‹è´±æŠŠ &lt;strong&gt;TC&lt;/strong&gt; ç¯å¢ƒé…å¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;
      
    
    </summary>
    
      <category term="Programming" scheme="https://xcoder.in/categories/Programming/"/>
    
    
      <category term="TopCoder" scheme="https://xcoder.in/tags/TopCoder/"/>
    
      <category term="SRM" scheme="https://xcoder.in/tags/SRM/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€èµ·æ’¸Node.JSï¼ˆå£¹ï¼‰â€”â€”åŸºæœ¬è¯­æ³•å’Œç±»å‹</title>
    <link href="https://xcoder.in/2013/08/16/node-4-base/"/>
    <id>https://xcoder.in/2013/08/16/node-4-base/</id>
    <published>2013-08-15T16:00:00.000Z</published>
    <updated>2017-12-11T07:59:20.523Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Node.js</strong> çš„åŸºç¡€æ˜¯ <strong>JavaScript</strong> è¿™é—¨ <strong><em>è„šæœ¬è¯­è¨€</em></strong>ã€‚è€Œå¤§å¤šæ•°çš„è„šæœ¬è¯­è¨€ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹å°±æ˜¯â€œ<a href="http://zh.wikipedia.org/wiki/%E9%A1%9E%E5%9E%8B%E7%B3%BB%E7%B5%B1#.E5.BC.B7.E5.9E.8B.E5.88.A5.E5.92.8C.E5.BC.B1.E5.9E.8B.E5.88.A5" target="_blank" rel="external">å¼±ç±»å‹</a>â€ã€‚</p><p>ã€€ã€€ä¸åŒäº <strong>PHP</strong> çš„æ˜¯ï¼Œ<strong>PHP</strong> å°±æ˜¯æ˜¯æœ‰äº†æ–°å˜é‡ä¹Ÿæ— éœ€ç”³æ˜ï¼Œè€Œ <strong>JavaScript</strong> åˆ™è¿˜æ˜¯éœ€è¦ <code>var</code> æ¥ç”³æ˜ä¸€ä¸‹çš„ã€‚è€Œè¿™ä¸ª <code>var</code> æ¶µç›–äº† <strong>C++</strong> ä¸­çš„<code>int</code>ã€<code>string</code>ã€<code>char</code>ç­‰ä¸€åˆ‡ç±»å‹çš„å«ä¹‰ï¼Œç”šè‡³æ˜¯ <code>function</code>ã€‚</p><p>ã€€ã€€æœ¬ç¯‡ä»¥åŠåç¯‡çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯åœ¨ <strong>Linux</strong> æˆ–è€… <strong>Cygwin</strong> ä¸‹ç”¨ <strong>vim</strong> è¿›è¡Œç¼–è¾‘ï¼ˆè‹¥ä¸æ˜¯åˆ™è¯·è‡ªè¡Œè½¬å˜æˆä½ è‡ªå·±çš„æ–¹æ³•ï¼‰ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸‹è¿›è¡ŒæŸ¥çœ‹ç»“æœçš„ã€‚</p><!-- æˆ‘æ˜¯å°å°åˆ†å‰²ç¬¦ --><h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><h3 id="å˜é‡å£°æ˜"><a href="#å˜é‡å£°æ˜" class="headerlink" title="å˜é‡å£°æ˜"></a>å˜é‡å£°æ˜</h3><p>åœ¨ <strong>C/C++</strong> ä¸­ï¼Œæˆ‘ä»¬è¿™ä¹ˆå£°æ˜å˜é‡çš„ï¼š</p><figure class="highlight plain"><figcaption><span>c++</span></figcaption><table><tr><td class="code"><pre><span class="line">void foo() &#123;&#125;</span><br><span class="line"></span><br><span class="line">int a = 0;</span><br><span class="line">char b = &apos;a&apos;;</span><br><span class="line">float c = 1.0f;</span><br><span class="line">void (*d)() = foo;  ///&lt; å¿˜äº†æ˜¯ä¸æ˜¯è¿™ä¹ˆå†™çš„äº†ï¼Œæ€»ä¹‹æ˜¯å‡½æ•°æŒ‡é’ˆ</span><br></pre></td></tr></table></figure><p>è€Œåœ¨ <strong>Node.js</strong> ä¸­åˆ™æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function foo() &#123;&#125;</span><br><span class="line"></span><br><span class="line">var a = 0;</span><br><span class="line">var b = &apos;a&apos;;</span><br><span class="line">var c = 1.0;</span><br><span class="line">var d = foo;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆç±»å‹çš„å˜é‡ï¼Œåœ¨ <strong>Node.js</strong> ä¸­éƒ½æ˜¯ä»¥ä¸€ä¸ª <code>var</code> æ¥è§£å†³çš„ã€‚</p><h3 id="å¾ªç¯è¯­å¥"><a href="#å¾ªç¯è¯­å¥" class="headerlink" title="å¾ªç¯è¯­å¥"></a>å¾ªç¯è¯­å¥</h3><h4 id="forâ€¦i"><a href="#forâ€¦i" class="headerlink" title="forâ€¦i"></a>forâ€¦i</h4><p>è¿™ä¸ªå¾ªç¯è¯­å¥åŸºæœ¬ä¸Šè·Ÿ <strong>C/C++</strong> ä¸€æ ·ï¼Œéƒ½æ˜¯</p><figure class="highlight plain"><figcaption><span>c++</span></figcaption><table><tr><td class="code"><pre><span class="line">for(int i = 0; i &lt; foo; i++)</span><br><span class="line">&#123;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œé‰´äº <strong>Node.js</strong> æ˜¯å¼±ç±»å‹ï¼Œæ‰€ä»¥åªéœ€è¦ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">for(var i = 0; i &lt; foo; i++) &#123;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="forâ€¦in"><a href="#forâ€¦in" class="headerlink" title="forâ€¦in"></a>forâ€¦in</h4><p>è¿™æ˜¯ä¸€ç§åæœ‰å‹çš„å¾ªç¯è¯­å¥ï¼Œç±»ä¼¼äº <strong>PHP</strong> çš„ <code>foreach</code>ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ª <strong>JSONå¯¹è±¡</strong> å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var foo = &#123;</span><br><span class="line">    &quot;hello&quot;     : &quot;world&quot;,</span><br><span class="line">    &quot;node&quot;      : &quot;js&quot;,</span><br><span class="line">    &quot;blahblah&quot;  : &quot;bar&quot;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨ <code>for...in</code> æ¥å¾ªç¯éå†äº†ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">for(var key in foo) &#123;</span><br><span class="line">    console.log(key + &quot;: &quot; + foo[key]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æ‰“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">$ node foo.js</span><br></pre></td></tr></table></figure><p>å±å¹•ä¸Šå°±ä¼šæ˜¾ç¤ºä¸‹é¢çš„å†…å®¹äº†ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">hello: world</span><br><span class="line">node: js</span><br><span class="line">blahblah: bar</span><br></pre></td></tr></table></figure><blockquote><p><strong>æç¤º</strong>ï¼šç”±ä¸Šå¯çŸ¥ï¼Œ<code>for...in</code> è¯­å¥æ˜¯ç”¨æ¥éå† <strong>JSONå¯¹è±¡</strong>ã€<strong>æ•°ç»„</strong>ã€<strong>å¯¹è±¡</strong>çš„é”®åçš„ï¼Œè€Œä¸æä¾›é”®å€¼çš„éå†ã€‚å¦‚æœè¦è·å–é”®å€¼ï¼Œåªèƒ½é€šè¿‡</p></blockquote><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">foo[&lt;å½“å‰é”®å&gt;]</span><br></pre></td></tr></table></figure><p>çš„å½¢å¼æ¥è·å–ã€‚è¿™ä¸ªè·Ÿ <strong>PHP</strong> çš„ <code>foreach</code> è¿˜æ˜¯æœ‰ä¸€å®šåŒºåˆ«çš„ã€‚</p><h4 id="whileâ€¦do-doâ€¦while"><a href="#whileâ€¦do-doâ€¦while" class="headerlink" title="whileâ€¦do, doâ€¦while"></a>whileâ€¦do, doâ€¦while</h4><p>è¿™ä¸ªå°±ä¸å¤šåšè§£é‡Šäº†ï¼Œè·Ÿå…¶å®ƒè¯­è¨€æ²¡ä»€ä¹ˆå¤§çš„åŒºåˆ«ï¼Œæ— éå°±æ˜¯å¦‚æœæœ‰å˜é‡å£°æ˜çš„è¯ï¼Œéœ€è¦ç”¨ <code>var</code> å°±å¤Ÿäº†ã€‚</p><h3 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h3><h4 id=""><a href="#" class="headerlink" title="+, -, *, /"></a>+, -, *, /</h4><p>è¿™å‡ ä¸ªè¿ç®—ç¬¦ä¹Ÿå°±è¿™æ ·ï¼Œè¦æ³¨æ„çš„æ˜¯ <code>+</code>ã€‚å®ƒæ—¢å¯ä»¥ä½œç”¨äºå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä½œç”¨äºæ•°å€¼è¿ç®—ã€‚å¼±ç±»å‹è¯­è¨€è™½ç„¶è¯´ç±»å‹æ˜¯å¼±çš„ï¼Œæ•°å­—æœ‰æ—¶å€™å¯ä»¥ä»¥å­—ç¬¦ä¸²çš„å½¢æ€å‡ºç°ï¼Œå­—ç¬¦ä¸²æœ‰æ—¶å€™å¯ä»¥ç”¨æ•°å€¼çš„å½¢æ€å‡ºç°ï¼Œä½†æ˜¯åœ¨å¿…è¦çš„æ—¶å€™ä¹Ÿè¿˜æ˜¯è¦è¯´ä¸€ä¸‹å®ƒæ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç å»çœ‹çœ‹ç»“æœï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var a = &quot;1&quot;;</span><br><span class="line">var b = 2;</span><br><span class="line">console.log(a + b);</span><br><span class="line">console.log(parseInt(a) + b);</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„ <code>parseInt</code> æ˜¯ <strong>Node.js</strong> çš„ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œä½œç”¨æ˜¯å°†ä¸€ä¸ªå­—ç¬¦ä¸²è§£ææˆ <code>int</code> ç±»å‹çš„å˜é‡ã€‚</p></blockquote><p>ä¸Šé¢çš„ä»£ç æ‰§è¡Œç»“æœæ˜¯</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">12</span><br><span class="line">3</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ª <code>console.log</code> ç»“æœæ˜¯ <code>12</code>ï¼Œç”±äº <code>a</code> æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ <code>b</code> ä¹Ÿè¢«ç³»ç»Ÿä»¥å­—ç¬¦ä¸²çš„å§¿æ€è¿›è¡ŒåŠ æ“ä½œï¼Œç»“æœå°±æ˜¯å°†ä¸¤ä¸ªå­—ç¬¦ä¸²é»è¿åœ¨ä¸€èµ·å°±å˜æˆäº† <code>12</code>ã€‚è€Œç¬¬äºŒä¸ª <code>console.log</code> ç»“æœæ˜¯ <code>3</code>ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å°†ç¬¬ä¸€ä¸ª <code>a</code> è½¬å˜ä¸ºäº† <code>int</code> ç±»å‹ï¼Œä¸¤ä¸ª <code>int</code> å‹çš„å˜é‡ç›¸åŠ å³æ•°å€¼ç›¸åŠ ï¼Œç»“æœå½“ç„¶å°±æ˜¯ <code>3</code> äº†ã€‚</p><h4 id="-1"><a href="#-1" class="headerlink" title="==, ===, !=, !=="></a>==, ===, !=, !==</h4><p>è¿™é‡Œæœ‰ä¸€ç‚¹è¦è§£é‡Šï¼Œå½“è¿™ä¸ªé€»è¾‘è¿ç®—ç¬¦é•¿åº¦ä¸º <code>2</code> çš„æ—¶å€™ï¼ˆ<code>==</code>, <code>!=</code>ï¼‰ï¼Œåªæ˜¯åˆ¤æ–­å¤–åœ¨çš„å€¼æ˜¯ä¸æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸ä¼šåˆ¤æ–­ç±»å‹ã€‚å¦‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var a = 1, b = &quot;1&quot;;</span><br><span class="line">console.log(a == b);</span><br></pre></td></tr></table></figure><p>å®ƒè¾“å‡ºçš„ç»“æœå°±æ˜¯ <code>true</code>ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨ä¸­é—´åˆ¤æ–­çš„æ—¶å€™å†åŠ ä¸Šä¸€ä¸ªç­‰å·ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸¥æ ¼åˆ¤æ–­äº†ï¼Œéœ€è¦ç±»å‹å’Œå€¼éƒ½ä¸€æ ·çš„æ—¶å€™æ‰ä¼šæ˜¯ <code>true</code>ï¼Œå¦åˆ™å°±æ˜¯ <code>false</code>ã€‚ä¹Ÿå°±æ˜¯è¯´</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var a = 1, b = &quot;1&quot;;</span><br><span class="line">console.log(a === b);</span><br></pre></td></tr></table></figure><p>çš„æ—¶å€™ï¼Œè¿”å›çš„ç»“æœå°±æ˜¯ <code>false</code> äº†ï¼Œå› ä¸º <code>a</code> æ˜¯ <code>int</code> å‹çš„ï¼Œè€Œ <code>b</code> åˆ™æ˜¯å­—ç¬¦ä¸²ã€‚</p><blockquote><p>é¡ºå¸¦ç€å°±æŠŠæ¡ä»¶è¯­å¥è®²äº†å§ï¼Œå…¶å®è¿™é‡Œçš„ <code>if</code> è·Ÿåˆ«çš„è¯­è¨€æ²¡ä»€ä¹ˆä¸¤æ ·ï¼Œå°±æ˜¯å‡ ä¸ªé€»è¾‘è¿ç®—ç¬¦ä¸¤ä¸ªç­‰å·ä¸‰ä¸ªç­‰å·çš„é—®é¢˜ã€‚æ‰€ä»¥å°±ä¸å¤šåšç´¯è¿°äº†ã€‚</p></blockquote><h4 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h4><p>è¿™é‡Œæˆ‘å§‘ä¸”æŠŠå®ƒå½“æˆæ˜¯ä¸€ä¸ªè¿ç®—ç¬¦è€Œä¸æ˜¯å‡½æ•°äº†ã€‚</p><p>è¿™ä¸ªè¿ç®—ç¬¦çš„ä½œç”¨æ˜¯åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„ç±»å‹ï¼Œä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå³ç±»å‹åï¼Œå…·ä½“çš„æ‰§è¡Œä¸‹é¢çš„ä»£ç å°±çŸ¥é“äº†ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function foo() &#123;&#125;</span><br><span class="line"></span><br><span class="line">var a = 0;</span><br><span class="line">var b = &apos;å˜˜~è›‹èŠ±æ±¤åœ¨ç¡è§‰ã€‚&apos;;</span><br><span class="line">var c = 1.0;</span><br><span class="line">var d = foo;</span><br><span class="line">var e = &#123; &quot;a&quot; : a &#125;;</span><br><span class="line">var f = [ 1, 2, 3 ];</span><br><span class="line">var g = null;</span><br><span class="line">var h = undefined;</span><br><span class="line"></span><br><span class="line">console.log(typeof a);</span><br><span class="line">console.log(typeof b);</span><br><span class="line">console.log(typeof c);</span><br><span class="line">console.log(typeof d);</span><br><span class="line">console.log(typeof e);</span><br><span class="line">console.log(typeof f);</span><br><span class="line">console.log(typeof g);</span><br><span class="line">console.log(typeof h);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ‰§è¡Œç»“æœå°±å°†ä¼šæ˜¯ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">number</span><br><span class="line">string</span><br><span class="line">number</span><br><span class="line">function</span><br><span class="line">object</span><br><span class="line">object</span><br><span class="line">object</span><br><span class="line">undefined</span><br></pre></td></tr></table></figure><h3 id="null-undefined-NaN"><a href="#null-undefined-NaN" class="headerlink" title="null, undefined, NaN"></a>null, undefined, NaN</h3><p>åœ¨ <strong>JavaScript</strong> ä¸­ï¼Œæœ‰ä¸‰ä¸ªç‰¹æ®Šçš„å€¼ï¼Œå¦‚æ ‡é¢˜æ‰€ç¤ºã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå¤§å®¶å¯èƒ½éƒ½æ¯”è¾ƒç†Ÿæ‚‰å§ï¼Œ<strong>C/C++</strong> é‡Œé¢ä¹Ÿæœ‰ï¼Œä¸è¿‡æ˜¯å¤§å†™çš„ï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ª</p><figure class="highlight plain"><figcaption><span>c++</span></figcaption><table><tr><td class="code"><pre><span class="line">#define NULL 0</span><br></pre></td></tr></table></figure><p>è€Œåœ¨ <strong>JavaScript</strong> ä¸­ï¼Œè¿™ä¸‰ä¸ªå€¼æ‰€ä»£è¡¨çš„æ„ä¹‰éƒ½ä¸åŒã€‚</p><h4 id="null"><a href="#null" class="headerlink" title="null"></a>null</h4><p><code>null</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„ <strong>object</strong>ï¼Œå¤§è‡´çš„æ„æ€å°±æ˜¯ç©ºã€‚æ¯”å¦‚è¯´ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var a = null;</span><br></pre></td></tr></table></figure><p>å¤§å®¶éƒ½èƒ½çœ‹æ‡‚ï¼Œå°±ä¸å¤šåšè§£é‡Šäº†ã€‚ä½†æ˜¯è·Ÿ <strong>C/C++</strong> ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ª <code>null</code> è·Ÿ <code>0</code> ä¸ç›¸ç­‰ã€‚</p><h4 id="undefined"><a href="#undefined" class="headerlink" title="undefined"></a>undefined</h4><p>è¿™ä¸ªä¸œè¥¿çš„æ„æ€å°±æ˜¯è¯´è¿™ä¸ªå˜é‡æœªå£°æ˜ã€‚ä¸ºäº†èƒ½å¤Ÿæ›´å¥½åœ°åŒºåˆ† <code>null</code>ï¼Œæˆ‘ä»¬çš„æ ·ä¾‹ä»£ç å¦‚ä¸‹å†™ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var a = &#123;</span><br><span class="line">    &quot;foo&quot;       : null</span><br><span class="line">&#125;;</span><br><span class="line">console.log(a[&quot;foo&quot;]);</span><br><span class="line">console.log(a[&quot;bar&quot;]);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è®© <code>a[&quot;foo&quot;]</code> çš„å€¼ä¸ºç©ºï¼Œå³ <code>null</code>ã€‚è€Œå‹æ ¹æ²¡æœ‰å£°æ˜ <code>a[&quot;bar&quot;]</code> è¿™ä¸ªä¸œè¥¿ï¼Œå®ƒè¿ç©ºéƒ½ä¸æ˜¯ã€‚è¾“å‡ºçš„ç»“æœå¤§å®¶éƒ½å·®ä¸å¤šåº”è¯¥çŒœåˆ°äº†ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">null</span><br><span class="line">undefined</span><br></pre></td></tr></table></figure><h4 id="NaN"><a href="#NaN" class="headerlink" title="NaN"></a>NaN</h4><p>è¿™æ˜¯ä¸€ä¸ªç©ºçš„æ•°å€¼ï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ <code>number</code>ã€‚å®ƒçš„å…¨ç§°æ˜¯ <code>Not a Number</code>ã€‚æœ‰ç‚¹å¥‡æ€ªï¼Œå¤§å®¶å¯ä»¥ç†è§£ä¸º <strong>ä¸æ˜¯æ•°å­—å½¢æ€ï¼Œæˆ–è€…æ•°å€¼å‡ºé”™çš„ <code>number</code> ç±»å‹å˜é‡</strong>ã€‚</p><p>å¤šåœ¨æµ®ç‚¹å‹æ•°å€¼è¿ç®—é”™è¯¯ï¼ˆå¦‚è¢«0é™¤ï¼‰çš„æƒ…å†µä¸‹å‡ºç°ï¼Œç”šè‡³å¯ä»¥æ˜¯ç”¨æˆ·è‡ªå·±è®©ä¸€ä¸ªå˜é‡ç­‰äº <code>NaN</code> ä»¥ä¾¿è¿”å›ä¸€ä¸ªé”™è¯¯å€¼è®©å¤§å®¶çŸ¥é“è¿™ä¸ªå‡½æ•°è¿ç®—å‡ºé”™äº†äº‘äº‘ã€‚</p><h3 id="å°æ‚ç¢"><a href="#å°æ‚ç¢" class="headerlink" title="å°æ‚ç¢"></a>å°æ‚ç¢</h3><p>å…¶å®ƒå‰©ä½™çš„è¯­å¥ä¹Ÿè·Ÿå·²å­˜åœ¨çš„å…¶å®ƒè¯­è¨€å·®ä¸å¤šï¼Œæ¯”å¦‚è¯´ <code>break</code> å•Šã€<code>switch</code> å•Šã€<code>continue</code> å•Šç­‰ç­‰ç­‰ç­‰ã€‚</p><h2 id="å˜é‡ç±»å‹"><a href="#å˜é‡ç±»å‹" class="headerlink" title="å˜é‡ç±»å‹"></a>å˜é‡ç±»å‹</h2><p>è¿™ä¸€èŠ‚ä¸»è¦è®²çš„æ˜¯ <strong>JavaScript</strong> å¯¹è±¡ï¼Œå…¶å®ƒç±»å‹å·®ä¸å¤šä¸€å¸¦è€Œè¿‡å§ã€‚</p><h3 id="åŸºç¡€ç±»å‹"><a href="#åŸºç¡€ç±»å‹" class="headerlink" title="åŸºç¡€ç±»å‹"></a>åŸºç¡€ç±»å‹</h3><p><strong>Node.js</strong> åŒ…å«çš„åŸºç¡€ç±»å‹å·®ä¸å¤šæœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><ul><li>number</li><li>string</li><li>boolean</li><li>array</li></ul><p>å…¶ä¸­å‰ä¸‰ç§ç±»å‹å¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œè€Œ <code>array</code> çš„èµ‹å€¼åªæ˜¯ä¸€ä¸ªå¼•ç”¨èµ‹å€¼è€Œå·²ï¼Œåœ¨æ–°å˜é‡ä¸­æ”¹å˜æŸä¸ªå€¼çš„è¯æ—§å˜é‡çš„å€¼ä¹Ÿä¼šæ”¹å˜ï¼Œç›´æ¥å¯ä»¥è¯•è¯•ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var foo = [ 1, 2, 3 ];</span><br><span class="line">var bar = foo;</span><br><span class="line">bar[0] = 3;</span><br><span class="line">console.log(foo);</span><br></pre></td></tr></table></figure><p>å®ƒå¾—å‡ºçš„ç»“æœæ˜¯ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">[ 3, 2, 3 ]</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ <code>array</code> è¦æ˜¯å¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„æ•°ç»„çš„è¯ï¼Œä¸èƒ½ç”¨ç›´æ¥èµ‹å€¼çš„æ–¹æ³•ï¼Œè€Œå¿…é¡»â€œ<strong><a href="#æ·±æ‹·è´">æ·±æ‹·è´</a></strong>â€ã€‚</p><p>è¿™é‡Œæœ‰å¿…è¦è®²ä¸€ä¸‹ <code>array</code> çš„ä¸‰ç§åˆ›å»ºæ–¹æ³•ã€‚</p><p>ç¬¬ä¸€ç§ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var dog = new Array();</span><br><span class="line">dog[0] = &quot;å˜˜~&quot;;</span><br><span class="line">dog[1] = &quot;è›‹èŠ±æ±¤&quot;;</span><br><span class="line">dog[2] = &quot;åœ¨ç¡è§‰&quot;;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var dog = new Array( &quot;å˜˜~&quot;, &quot;è›‹èŠ±æ±¤&quot;, &quot;åœ¨ç¡è§‰&quot; );</span><br></pre></td></tr></table></figure><p>ç¬¬å››ç§ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var dog = [</span><br><span class="line">    &quot;å˜˜~&quot;,</span><br><span class="line">    &quot;è›‹èŠ±æ±¤&quot;,</span><br><span class="line">    &quot;åœ¨ç¡è§‰&quot;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢ç¬¬ä¸‰ç§å†™æ³•ï¼Œæ¯”è¾ƒç®€æ´ã€‚</p><h3 id="JSONå¯¹è±¡"><a href="#JSONå¯¹è±¡" class="headerlink" title="JSONå¯¹è±¡"></a>JSONå¯¹è±¡</h3><p>è¿™é‡Œæˆ‘æŠŠ <strong>JSONå¯¹è±¡</strong> å•ç‹¬æ‹å‡ºæ¥è€Œä¸æ˜¯æŠŠå®ƒå½’ç±»ä¸º <strong>JavaScriptå¯¹è±¡</strong>ï¼Œå¦‚æœè§‰å¾—æˆ‘æœ‰ç‚¹è¯¯äººå­å¼Ÿå°±å¯ä»¥ç›´æ¥è·³è¿‡è¿™ä¸€èŠ‚äº†ã€‚</p><p>æœ¬äººå¯¹äº <strong>JSONå¯¹è±¡</strong> å’Œ <strong>JavaScript</strong> å¯¹è±¡çš„åŒºåˆ†æ”¾åœ¨ <strong>æ˜¯å¦åªç”¨æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œå¹¶éæ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–</strong>ã€‚å…¶å® <strong>JSON</strong> çš„æœ¬è´¨ä¾¿æ˜¯ <strong>JavaScript Object Notation</strong>ã€‚</p><blockquote><p>æ›´å¤šæœ‰å…³ <strong><a href="http://zh.wikipedia.org/wiki/JSON" target="_blank" rel="external">JSON</a></strong> çš„ä¿¡æ¯è¯·è‡ªè¡Œç™¾ç§‘ã€‚</p></blockquote><p>åœ¨ <strong>Node.js</strong> ä¸­å£°æ˜ä¸€ä¸ª <strong>JSONå¯¹è±¡</strong> éå¸¸ç®€å•ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var dog = &#123;</span><br><span class="line">    &quot;pre&quot;       : &quot;å˜˜~&quot;,</span><br><span class="line">    &quot;sub&quot;       : &#123;</span><br><span class="line">        &quot;name&quot;  : &quot;è›‹èŠ±æ±¤&quot;,</span><br><span class="line">        &quot;act&quot;   : &quot;åœ¨ç¡è§‰&quot;,</span><br><span class="line">        &quot;time&quot;  : 12</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &quot;suf&quot;       : [ &quot;æˆ‘è¯´äº†&quot;, &quot;å®ƒåœ¨ç¡è§‰&quot;, &quot;å°±æ˜¯åœ¨ç¡è§‰&quot; ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ç§æ–¹å¼èƒ½å¾—åˆ° <strong>JSONå¯¹è±¡</strong> ä¸­çš„æŸä¸ªé”®åçš„é”®å€¼ï¼Œç¬¬ä¸€ç§æ˜¯ç”¨ç‚¹è¿æ¥ï¼Œç¬¬äºŒç§æ˜¯ç”¨ä¸­æ‹¬å·ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">dog.pre;</span><br><span class="line">dog[&quot;pre&quot;];</span><br></pre></td></tr></table></figure><blockquote><p><strong>è¯•è¯•çœ‹</strong>ï¼šç°åœ¨ä½ è‡ªå·±åŠ¨æ‰‹è¯•è¯•çœ‹ï¼Œç”¨ <code>for...in</code> çš„å½¢å¼éå†ä¸€éä¸Šé¢çš„ <code>JSONå¯¹è±¡</code>ã€‚åˆ«å¿˜äº†ç”¨ä¸Š <code>typeof</code> å–µ~</p></blockquote><h3 id="ç±»ï¼ˆå¯¹è±¡ï¼‰çš„åŸºç¡€"><a href="#ç±»ï¼ˆå¯¹è±¡ï¼‰çš„åŸºç¡€" class="headerlink" title="ç±»ï¼ˆå¯¹è±¡ï¼‰çš„åŸºç¡€"></a>ç±»ï¼ˆå¯¹è±¡ï¼‰çš„åŸºç¡€</h3><p>ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è®²ï¼Œ<strong>Node.js</strong> çš„ç±»ä¸èƒ½ç®—æ˜¯ç±»ï¼Œå…¶å®å®ƒåªæ˜¯ä¸€ä¸ªå‡½æ•°çš„é›†åˆä½“ï¼ŒåŠ ä¸€äº›æˆå‘˜å˜é‡ã€‚å®ƒçš„æœ¬è´¨å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</p><p>ä¸è¿‡ä¸ºäº†é€šä¿—åœ°è®²ï¼Œæˆ‘ä»¬æ¥ä¸‹å»ä»¥åŠä»¥åéƒ½å°†å…¶ç§°ä¸ºâ€œç±»â€ï¼Œå®ä¾‹åŒ–çš„å«â€œå¯¹è±¡â€ã€‚</p><p>å› ä¸ºç±»æœ‰ç€å¾ˆå¤š <strong>å‡½æ•°</strong> çš„ç‰¹æ€§ï¼Œæˆ–è€…è¯´å®ƒçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª <strong>å‡½æ•°</strong>ï¼Œæ‰€ä»¥è¿™é‡Œé¢æˆ‘ä»¬å¯èƒ½ä¸€ä¸ç•™ç¥å°±é¡ºå¸¦ç€æŠŠå‡½æ•°åŸºç¡€ç»™è®²äº†ã€‚</p><h4 id="ç±»çš„å£°æ˜å’Œå®ä¾‹åŒ–"><a href="#ç±»çš„å£°æ˜å’Œå®ä¾‹åŒ–" class="headerlink" title="ç±»çš„å£°æ˜å’Œå®ä¾‹åŒ–"></a>ç±»çš„å£°æ˜å’Œå®ä¾‹åŒ–</h4><p>å£°æ˜ä¸€ä¸ªç±»éå¸¸ç®€å•ï¼Œå¤§å®¶ä¸è¦ç¬‘ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»å†™å¥½äº†ä¸€ä¸ª <code>foo</code> ç±»äº†ã€‚</p><blockquote><p>çœŸçš„å‡çš„ï¼Ÿï¼çœŸçš„ã€‚</p></blockquote><p>ä¸ä¿¡ï¼Ÿä¸ä¿¡ä½ å¯ä»¥æ¥ä¸‹å»æ‰“ä¸€æ®µä»£ç çœ‹çœ‹ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var bar = new foo();</span><br></pre></td></tr></table></figure><p>åˆ«çœ‹å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœä»¥è¿™æ ·çš„å½¢å¼ï¼ˆ<code>new</code>ï¼‰å†™å‡ºæ¥ï¼Œå®ƒå°±æ˜¯è¿™ä¸ªç±»çš„å®ä¾‹åŒ–ã€‚</p><p>è€Œè¿™ä¸ªæ‰€è°“çš„ <code>foo()</code> å…¶å®å°±æ˜¯è¿™ä¸ª <code>foo()</code> ç±»çš„æ„é€ å‡½æ•°ã€‚</p><h4 id="æˆå‘˜å˜é‡"><a href="#æˆå‘˜å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡"></a>æˆå‘˜å˜é‡</h4><p>æˆå‘˜å˜é‡æœ‰å¥½ä¸¤ç§æ–¹æ³•ã€‚</p><p>ç¬¬ä¸€ç§å°±æ˜¯åœ¨ç±»çš„æ„é€ å‡½æ•°æˆ–è€…ä»»ä½•æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ <code>this.&lt;å˜é‡å&gt;</code> ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å£°æ˜ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œåœ¨å¤–éƒ¨ä¸å½±å“ä½¿ç”¨ï¼Œåæ­£å°±ç®—åœ¨è¿˜æœªå£°æ˜çš„æ—¶å€™ä½¿ç”¨å®ƒï¼Œä¹Ÿä¼šæœ‰ä¸€ä¸ª <code>undefined</code> æ¥æ’‘ç€ã€‚æ‰€ä»¥è¯´è¿™å°±æ˜¯ç¬¬ä¸€ç§æ–¹æ³•ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    this.hello = &quot;world&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ï¼šåªæœ‰åœ¨åŠ äº† <code>this</code> çš„æ—¶å€™æ‰æ˜¯è°ƒç”¨ç±»çš„<strong>æˆå‘˜å˜é‡</strong>ï¼Œå¦åˆ™åªæ˜¯å‡½æ•°å†…çš„ä¸€ä¸ªå±€éƒ¨å˜é‡è€Œå·²ã€‚è¦åˆ†æ¸…æ¥šæœ‰æ²¡æœ‰ <code>this</code> çš„æ—¶å€™å˜é‡çš„ä½œç”¨èŒƒå›´ã€‚</p></blockquote><p>ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯åœ¨æ„é€ å‡½æ•°æˆ–è€…ä»»ä½•æˆå‘˜å‡½æ•°å¤–éƒ¨å£°æ˜ï¼Œå…¶æ ¼å¼æ˜¯ <code>&lt;ç±»å&gt;.prototype.&lt;å˜é‡å&gt;</code>ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo.prototype.hello = &quot;world&quot;;</span><br></pre></td></tr></table></figure><p>æ— èŠä¸Šé¢å“ªç§æ–¹æ³•éƒ½æ˜¯å¯¹æˆå‘˜å˜é‡çš„å£°æ˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹æ•ˆæœï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var bar = new foo();</span><br><span class="line">console.log(bar.hello);</span><br></pre></td></tr></table></figure><p>ç”šè‡³ä½ å¯ä»¥è¿™ä¹ˆä¿®æ”¹è¿™ä¸ªç±»ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    this.hello = &quot;world&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo.prototype.hello = &quot;è›‹èŠ±æ±¤&quot;;</span><br></pre></td></tr></table></figure><p>ç„¶åå†ç”¨ä¸Šé¢çš„ä»£ç è¾“å‡ºã€‚</p><blockquote><p>æƒ³æƒ³çœ‹ä¸ºä»€ä¹ˆè¾“å‡ºçš„è¿˜æ˜¯ <code>world</code> è€Œä¸æ˜¯ <code>è›‹èŠ±æ±¤</code>ã€‚</p></blockquote><h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><p>æˆ‘ä»¬ä¹‹å‰è¯´è¿‡äº†è¿™ä¸ª <code>foo()</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ª <strong>æ„é€ å‡½æ•°</strong>ã€‚é‚£ä¹ˆæ˜¾ç„¶æˆ‘ä»¬å¯ä»¥ç»™æ„é€ å‡½æ•°ä¼ å‚æ•°ï¼Œæ‰€ä»¥å°±æœ‰äº†ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">// ä»£ç 2.1</span><br><span class="line">function foo(hello) &#123;</span><br><span class="line">    if(hello === undefined) &#123;</span><br><span class="line">        this.hello = &quot;world&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        this.hello = hello;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢æœ‰ä¸€ä¸ªå¥‡è‘©çš„åˆ¤æ–­ <code>if(hello === undefined)</code>ï¼Œè¿™ä¸ªåˆ¤æ–­æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç¬¬ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯å¼€å‘è€…å¾ˆè›‹ç–¼åœ°ç‰¹æ„ä¼ è¿›å»ä¸€ä¸ª <code>undefined</code> è¿›å»ï¼Œè¿™ä¸ªæ—¶å€™å®ƒæ˜¯ <code>undefined</code> æ— å¯åšéã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µã€‚æˆ‘ä»¬ä¸€å¼€å§‹å°±è¯´äº† <strong>JavaScript</strong> æ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ï¼Œå…¶å®ä¸ä»…ä»…æ˜¯å¼±ç±»å‹ï¼Œå®ƒçš„ä¼ å‚æ•°ä¹Ÿéå¸¸ä¸ä¸¥è°¨ã€‚ä½ å¯ä»¥å¤šä¼ æˆ–è€…å°‘ä¼ ï¼ˆåªè¦ä¿è¯ä½ å¤šä¼ æˆ–è€…å°‘ä¼ çš„æ—¶å€™å¯ä»¥ä¿è¯ç¨‹åºä¸å‡ºé”™ï¼Œæˆ–è€…é€»è¾‘ä¸å‡ºé”™ï¼‰ï¼ŒåŸåˆ™ä¸Šéƒ½æ˜¯å¯ä»¥çš„ã€‚å¤šä¼ çš„å‚æ•°ä¼šè¢«è‡ªåŠ¨å¿½ç•¥ï¼Œè€Œå°‘ä¼ çš„å‚æ•°ä¼šä»¥ <code>undefined</code> è¡¥è¶³ã€‚</p><p>çœ‹çœ‹ä¸‹é¢çš„ä»£ç å°±æ˜ç™½äº†ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">// ä¸Šæ¥ä»£ç 2.1</span><br><span class="line">var bar1 = new foo();</span><br><span class="line">var bar2 = new foo(&quot;è›‹èŠ±æ±¤&quot;);</span><br></pre></td></tr></table></figure><p>è¯·è‡ªè¡Œè¾“å‡ºä¸€ä¸‹ä¸¤ä¸ª <code>bar</code> çš„ <code>hello</code> å˜é‡ï¼Œä¼šå‘ç°ä¸€ä¸ªæ˜¯ <strong>world</strong> ä¸€ä¸ªæ˜¯ <strong>è›‹èŠ±æ±¤</strong>ã€‚æ˜¾è€Œæ˜“è§ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª <code>bar1</code> åœ¨å£°æ˜çš„æ—¶å€™ï¼Œè¢« <strong>Node.js</strong> è‡ªåŠ¨çœ‹æˆäº†ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var bar1 = new foo(undefined);</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å°±æœ‰äº†å®ƒæ˜¯ <strong>world</strong> ä¸€è¯´ã€‚</p><p>è¿˜æœ‰å°±æ˜¯åœ¨è¿™ä¸ªæ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¼ è¿›å»çš„å‚æ•°æ˜¯ <code>hello</code> è€Œè¿™ä¸ªç±»ä¸­æœ¬æ¥å°±æœ‰ä¸ªæˆå‘˜å˜é‡å°±æ˜¯ <code>this.hello</code>ã€‚ä¸è¿‡æˆ‘ä»¬ä¹‹å‰è¯´è¿‡äº†æœ‰ <code>this</code> å’Œæ²¡ <code>this</code> çš„æ—¶å€™ä½œç”¨åŸŸä¸åŒï¼Œé‚£ä¸ªå‚æ•°åªæ˜¯ä½œç”¨äºæ„é€ å‡½æ•°ä¸­ï¼Œè€ŒåŠ äº† <code>this</code> çš„é‚£ä¸ªåˆ™æ˜¯æˆå‘˜å˜é‡ã€‚ç”¨ä¸€ä¸ª <code>this</code> å°±é©¬ä¸ŠåŒºåˆ†å¼€æ¥ä»–ä»¬äº†ï¼Œæ‰€ä»¥å³ä½¿åŒåä¹Ÿæ²¡å…³ç³»ã€‚</p><h4 id="æˆå‘˜å‡½æ•°"><a href="#æˆå‘˜å‡½æ•°" class="headerlink" title="æˆå‘˜å‡½æ•°"></a>æˆå‘˜å‡½æ•°</h4><h5 id="æˆå‘˜å‡½æ•°å£°æ˜"><a href="#æˆå‘˜å‡½æ•°å£°æ˜" class="headerlink" title="æˆå‘˜å‡½æ•°å£°æ˜"></a>æˆå‘˜å‡½æ•°å£°æ˜</h5><p>æˆå‘˜å‡½æ•°çš„å£°æ˜è·Ÿæˆå‘˜å˜é‡çš„ç¬¬äºŒç§å£°æ˜æ–¹æ³•å·®ä¸å¤šï¼Œå³ <code>&lt;ç±»å&gt;.prototype.&lt;å‡½æ•°å&gt; = &lt;å‡½æ•°&gt;;</code></p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">// ä¸Šæ¥ä»£ç 2.1</span><br><span class="line">function setHello(hello) &#123;</span><br><span class="line">    this.hello = hello;</span><br><span class="line">&#125;</span><br><span class="line">foo.prototype.setHello = setHello;</span><br><span class="line"></span><br><span class="line">bar1.setHello(&quot;é¸¡è›‹é¥¼&quot;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç æ˜¾è€Œæ˜“è§ï¼Œæˆ‘ä»¬å®ç°äº† <code>foo</code> ç±»çš„ <code>setHello</code> å‡½æ•°ï¼Œèƒ½é€šè¿‡å®ƒä¿®æ”¹ <code>foo.hello</code> çš„å€¼ã€‚</p><p>ä½†æ˜¯è¿™ä¹ˆå†™æ˜¯ä¸æ˜¯æœ‰ç‚¹éº»çƒ¦ï¼Ÿæ¥ä¸‹å»æˆ‘è¦è®²ä¸€ä¸ª <strong>JavaScript</strong> å‡½æ•°é‡è¦çš„ç‰¹æ€§äº†ã€‚</p><h4 id="â˜…-åŒ¿åå‡½æ•°"><a href="#â˜…-åŒ¿åå‡½æ•°" class="headerlink" title="â˜… åŒ¿åå‡½æ•°"></a>â˜… åŒ¿åå‡½æ•°</h4><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬çš„æŸäº›å‡½æ•°åªåœ¨ä¸€ä¸ªåœ°æ–¹è¢«å¼•ç”¨æˆ–è€…è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºè¿™ä¸ªå‡½æ•°èµ·ä¸€ä¸ªåå­—å°±å¤ªä¸å€¼äº†ï¼Œæ²¡å¿…è¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸´æ—¶å†™å¥½è¿™ä¸ªå‡½æ•°ï¼Œç›´æ¥è®©å¼•ç”¨å®ƒçš„äººå¼•ç”¨å®ƒï¼Œè°ƒç”¨å®ƒçš„äººè°ƒç”¨å®ƒã€‚æ‰€ä»¥å‡½æ•°å¯ä»¥çœç•¥å‡½æ•°åï¼Œå¦‚ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function(hello) &#123;</span><br><span class="line">    this.hello = hello;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³äºæ€ä¹ˆå¼•ç”¨æˆ–è€…è°ƒç”¨å‘¢ï¼Ÿå¦‚æœæ˜¯ä¸Šé¢çš„é‚£ä¸ªç±»éœ€è¦å¼•ç”¨çš„è¯ï¼Œå°±æ˜¯å†™æˆè¿™æ ·çš„ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">foo.prototype.setHello = function(hello) &#123;</span><br><span class="line">    this.hello = hello;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„å†™æ³•è·Ÿ <strong><a href="#æˆå‘˜å‡½æ•°å£°æ˜">2.3.3.1. æˆå‘˜å‡½æ•°å£°æ˜</a></strong> æ˜¯ä¸€ä¸ªæ•ˆæœçš„ï¼Œè€Œä¸”çœäº†å¾ˆå¤šçš„ä»£ç é‡ã€‚è€Œä¸”å®é™…ä¸Šï¼ŒåŸºæœ¬ä¸Šçš„ç±»æˆå‘˜å‡½æ•°çš„å£°æ˜éƒ½æ˜¯é‡‡ç”¨è¿™ç§åŒ¿åå‡½æ•°çš„æ–¹å¼æ¥å£°æ˜çš„ã€‚</p><p>è‡³äºè¯´æ€ä¹ˆæ ·è®©åŒ¿åå‡½æ•°è¢«è°ƒç”¨å‘¢ï¼Ÿè¿™é€šå¸¸ç”¨äºä¼ å…¥ä¸€ä¸ªåªè¢«æŸä¸ªå‡½æ•°è°ƒç”¨çš„å‡½æ•°æ—¶è¿™æ ·å†™ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°çš„åŸå‹æ˜¯ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æˆ‘ä»¬å°†ä¼ å…¥aï¼Œbä¸¤ä¸ªå˜é‡ï¼Œ</span><br><span class="line"> * åœ¨ç®—å‡ºa+bçš„å€¼åï¼Œäº¤ç”±func(num)</span><br><span class="line"> * å»è¿›è¡Œè¾“å‡º</span><br><span class="line"> */</span><br><span class="line">function sumab(a, b, func) &#123;</span><br><span class="line">    var c = a + b;</span><br><span class="line">    func(a, b, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„è¾“å‡ºå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ä¸­æ–‡è¾“å‡ºï¼Œä¸€ä¸ªæ˜¯è‹±æ–‡è¾“å‡ºï¼Œé‚£ä¹ˆå¦‚æœä¸ç”¨åŒ¿åå‡½æ•°æ—¶å€™æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function zh(a, b, sum) &#123;</span><br><span class="line">    console.log(a + &quot; + &quot; + b + &quot; çš„å€¼æ˜¯ï¼š&quot; + sum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function en(a, b, sum) &#123;</span><br><span class="line">    console.log(a + &quot; plus &quot; + b + &quot; is &quot; + sum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sumab(1, 2, zh);</span><br><span class="line">sumab(3, 4, en);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸€éè¿™æ®µä»£ç ï¼Œè¾“å‡ºçš„ç»“æœå°†ä¼šæ˜¯ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">1 + 2 çš„å€¼æ˜¯ï¼š3</span><br><span class="line">3 plus 4 is 7</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ä»£ç å¦‚æœé‡‡ç”¨åŒ¿åå‡½æ•°çš„å½¢å¼åˆ™å°†ä¼šæ˜¯ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">sumab(1, 2, function(a, b, sum) &#123;</span><br><span class="line">    console.log(a + &quot; + &quot; + b + &quot; çš„å€¼æ˜¯ï¼š&quot; + sum);</span><br><span class="line">&#125;);</span><br><span class="line">sumab(3, 4, function(a, b, sum) &#123;</span><br><span class="line">    console.log(a + &quot; plus &quot; + b + &quot; is &quot; + sum);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™ç§å½¢å¼é€šå¸¸ä½¿ç”¨äºå›è°ƒå‡½æ•°ã€‚å›è°ƒæœºåˆ¶ç®—æ˜¯ <strong>Node.js</strong> æˆ–è€…è¯´ <strong>JavaScript</strong> çš„ç²¾é«“ã€‚åœ¨ä»¥åçš„ç¯‡ç« ä¼šåšä»‹ç»ã€‚</p><h4 id="æˆå‘˜å‡½æ•°å£°æ˜çš„åŒ¿åå‡½æ•°å£°æ˜æ–¹å¼"><a href="#æˆå‘˜å‡½æ•°å£°æ˜çš„åŒ¿åå‡½æ•°å£°æ˜æ–¹å¼" class="headerlink" title="æˆå‘˜å‡½æ•°å£°æ˜çš„åŒ¿åå‡½æ•°å£°æ˜æ–¹å¼"></a>æˆå‘˜å‡½æ•°å£°æ˜çš„åŒ¿åå‡½æ•°å£°æ˜æ–¹å¼</h4><p>è™½ç„¶ä¸Šä¸€èŠ‚è®²è¿‡äº†ï¼Œä¸è¿‡è¿˜æ˜¯å†è®²ä¸€éå§ã€‚</p><p>é€šå¸¸æˆ‘ä»¬å£°æ˜ç±»çš„æˆå‘˜å‡½æ•°æ—¶å€™éƒ½æ˜¯ç”¨åŒ¿åå‡½æ•°æ¥å£°æ˜çš„ï¼Œå› ä¸ºåæ­£é‚£ä¸ªå‡½æ•°ä¹Ÿå°±æ˜¯è¿™ä¸ªç±»çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°è€Œå·²ï¼Œä¸ä¼šåœ¨å…¶å®ƒåœ°æ–¹è¢«å•ç‹¬å¼•ç”¨æˆ–è€…è°ƒç”¨ï¼Œæ‰€ä»¥å°±æœ‰äº†ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">// ä¸Šæ¥ä»£ç 2.1</span><br><span class="line">foo.prototype.setHello = function(hello) &#123;</span><br><span class="line">    this.hello = hello;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±ä½¿å¾— <code>foo</code> ç±»æœ‰äº† <code>setHello</code> è¿™ä¸ªå‡½æ•°äº†ã€‚</p><h4 id="ç±»çš„éšæ„æ€§"><a href="#ç±»çš„éšæ„æ€§" class="headerlink" title="ç±»çš„éšæ„æ€§"></a>ç±»çš„éšæ„æ€§</h4><p>è¿™ä¸ªåˆæ˜¯æˆ‘èƒ¡æ‰¯çš„ã€‚æ‰€è°“ç±»çš„éšæ„æ€§å³ <strong>JavaScript</strong> ä¸­ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä¿®æ”¹ä½ çš„ç±»ï¼Œè¿™è·Ÿ <strong>Ruby</strong> æœ‰ç€ä¸€å®šçš„ç›¸ä¼¼ä¹‹å¤„ã€‚</p><p>æ¯”å¦‚è¯´ <code>string</code> ï¼Œå®ƒå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œæœ‰ç€è¯¸å¦‚ <code>length</code> è¿™æ ·çš„æˆå‘˜å˜é‡ï¼Œä¹Ÿæœ‰ <code>indexOf</code>ã€<code>substr</code> ç­‰æˆå‘˜å‡½æ•°ã€‚ä½†æ˜¯ä¸‡ä¸€æˆ‘ä»¬è§‰å¾—è¿™ä¸ª <code>string</code> æœ‰äº›åœ°æ–¹ä¸å®Œå–„ï¼Œæƒ³åŠ è‡ªå·±çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ä½ æƒ³è¦çš„åœ°æ–¹ç»™å®ƒå¢åŠ ä¸€ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">String.prototype.sb = function() &#123;</span><br><span class="line">    var newstr = &quot;&quot;;</span><br><span class="line">    for(var i = 0; i &lt; this.length; i++) &#123;</span><br><span class="line">        if(i % 2 === 0) newstr += &quot;s&quot;;</span><br><span class="line">        else newstr += &quot;b&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return newstr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„æ„æ€å°±æ˜¯å¡«å……ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½¿å…¶å˜æˆ <code>sb</code> çš„åŒ–èº«ã€‚</p><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">var str = &quot;å˜˜~è›‹èŠ±æ±¤åœ¨ç¡è§‰ã€‚&quot;;</span><br><span class="line">console.log(str.sb());</span><br></pre></td></tr></table></figure><p>ä½ å°†ä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">sbsbsbsbs</span><br></pre></td></tr></table></figure><blockquote><p>ä½ è·Ÿä½ çš„ç”µè„‘è¯´â€œå˜˜~è›‹èŠ±æ±¤åœ¨ç¡è§‰ã€‚â€ï¼Œä½ çš„ç”µè„‘ä¼šéª‚ä½ å››æ¬¡åŠå‚»é€¼ã€‚ï¼ˆèµ¶å¿«ç ¸äº†å®ƒï¼‰</p></blockquote><h2 id="é™„"><a href="#é™„" class="headerlink" title="é™„"></a>é™„</h2><h3 id="æ·±æ‹·è´"><a href="#æ·±æ‹·è´" class="headerlink" title="æ·±æ‹·è´"></a>æ·±æ‹·è´</h3><p>æ‰€è°“æ·±æ‹·è´å°±æ˜¯è‡ªå·±æ–°å»ºä¸€ä¸ªæ•°ç»„æˆ–è€…å¯¹è±¡ï¼ŒæŠŠæºæ•°ç»„æˆ–è€…å¯¹è±¡ä¸­çš„åŸºç¡€ç±»å‹å˜é‡å€¼ä¸€ä¸ªä¸ªæ‰‹åŠ¨æ‹·è¿‡å»ï¼Œè€Œä¸æ˜¯åªæŠŠæºæ•°ç»„æˆ–è€…å¯¹è±¡çš„å¼•ç”¨æ‹¿è¿‡æ¥ã€‚æ‰€ä»¥è¿™å°±æ¶‰åŠåˆ°äº†ä¸€ä¸ªé€’å½’çš„è°ƒç”¨ä»€ä¹ˆçš„ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘å®ç°çš„ä¸€ä¸ªæ·±æ‹·è´å‡½æ•°ï¼Œå¤§å®¶å¯ä»¥å†™ä¸€ä¸ªè‡ªå·±çš„ç„¶ååŠ å…¥åˆ°è‡ªå·±çš„ <strong>Node.js</strong> çŸ¥è¯†åº“ä¸­ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">function cloneObject(src) &#123;</span><br><span class="line">    var dest = &#123;&#125;;</span><br><span class="line">    for(var key in src) &#123;</span><br><span class="line">        if(typeof src === &quot;object&quot;) dest[key] = cloneObject(src[key]);</span><br><span class="line">        else dest[key] = src[key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return dest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç³»ç»Ÿé»˜è®¤å¯¹è±¡å‚è€ƒæ‰‹å†Œ"><a href="#ç³»ç»Ÿé»˜è®¤å¯¹è±¡å‚è€ƒæ‰‹å†Œ" class="headerlink" title="ç³»ç»Ÿé»˜è®¤å¯¹è±¡å‚è€ƒæ‰‹å†Œ"></a>ç³»ç»Ÿé»˜è®¤å¯¹è±¡å‚è€ƒæ‰‹å†Œ</h3><ul><li><strong>å­—ç¬¦ä¸²</strong>ï¼š<a href="http://www.w3school.com.cn/js/jsref_obj_string.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_string.asp</a></li><li><strong>æ•°å­—</strong>: <a href="http://www.w3school.com.cn/js/jsref_obj_number.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_number.asp</a></li><li><strong>æ•°ç»„</strong>: <a href="http://www.w3school.com.cn/js/jsref_obj_array.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_array.asp</a></li><li><strong>å¸ƒå°”</strong>: <a href="http://www.w3school.com.cn/js/jsref_obj_boolean.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_boolean.asp</a></li><li><strong>æ—¥æœŸ</strong>: <a href="http://www.w3school.com.cn/js/jsref_obj_date.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_date.asp</a></li><li><strong>æ•°å­¦åº“</strong>ï¼š<a href="http://www.w3school.com.cn/js/jsref_obj_math.asp" target="_blank" rel="external">http://www.w3school.com.cn/js/jsref_obj_math.asp</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;Node.js&lt;/strong&gt; çš„åŸºç¡€æ˜¯ &lt;strong&gt;JavaScript&lt;/strong&gt; è¿™é—¨ &lt;strong&gt;&lt;em&gt;è„šæœ¬è¯­è¨€&lt;/em&gt;&lt;/strong&gt;ã€‚è€Œå¤§å¤šæ•°çš„è„šæœ¬è¯­è¨€ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹å°±æ˜¯â€œ&lt;a href=&quot;http://zh.wikiped
      
    
    </summary>
    
      <category term="NodeJS" scheme="https://xcoder.in/categories/NodeJS/"/>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="JavaScript" scheme="https://xcoder.in/tags/JavaScript/"/>
    
      <category term="ä¸€èµ·æ’¸Node.JS" scheme="https://xcoder.in/tags/%E4%B8%80%E8%B5%B7%E6%92%B8Node-JS/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€èµ·æ’¸Node.JSï¼ˆè´Ÿè´°ï¼‰â€”â€”ç¯å¢ƒ</title>
    <link href="https://xcoder.in/2013/08/15/node-2-environment-in-windows/"/>
    <id>https://xcoder.in/2013/08/15/node-2-environment-in-windows/</id>
    <published>2013-08-14T16:00:00.000Z</published>
    <updated>2017-12-11T07:59:20.523Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€ç”±äº<a href="!--ï¿¼11--&gt;#linux-ç¯å¢ƒ">Linux</a>ä¸­çš„ç¯å¢ƒæ­å»ºæ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥è‰è‰ç•¥è¿‡ã€‚</p><p>ã€€ã€€å…¶å®<a href="!--ï¿¼12--&gt;#windows-ç¯å¢ƒ">Windows</a>ä¸‹ä¹Ÿä¸ç®—éº»çƒ¦ï¼Œä½†æ˜¯è¿™é‡Œä¼šè®²ä¸€å®šé‡çš„åˆ«çš„ç¯å¢ƒçš„æ­å»ºã€‚</p><!-- æˆ‘æ˜¯å°å°åˆ†å‰²ç¬¦ --><h2 id="Linux-ç¯å¢ƒ"><a href="#Linux-ç¯å¢ƒ" class="headerlink" title="Linux ç¯å¢ƒ"></a>Linux ç¯å¢ƒ</h2><p>è®²åˆ°è¿™ä¸ªå°±å¾ˆç®€å•äº†ï¼Œè·Ÿç€ä¸‹é¢çš„ <strong>bash</strong> æ“ä½œå³å¯ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">$ cd /usr/local/bin</span><br><span class="line">$ wget http://nodejs.org/dist/v0.00.00/node-v0.00.00-linux-x00.tar.gz</span><br><span class="line">$ tar zxf node-v0.00.00-linux-x00.tar.gz</span><br><span class="line">$ cd node-v0.00.00-linux-x00</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­å°†ä¸Šæ–¹çš„ <strong>v0.00.00</strong> æ›¿æ¢æˆ <strong>Node.js</strong> æœ€æ–°çš„ç‰ˆæœ¬å·ï¼ŒæŠŠ <strong>x00</strong> æ›¿æ¢æˆä½ è‡ªå·±ç”µè„‘çš„ä½æ•°ã€‚</p><p>ä¹Ÿå¯ä»¥ç›´æ¥å»å®˜ç½‘ <a href="http://nodejs.org/download/" target="_blank" rel="external">http://nodejs.org/download/</a> æ‰¾åˆ°ç›¸åº”çš„åœ°å€ã€‚</p></blockquote><p>æœ€åå°†å…¶çš„è¿æ¥åŠ å…¥åˆ° <code>/usr/bin</code> ä¸‹å³å¯ã€‚</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">$ cd bin</span><br><span class="line">$ ln node /usr/bin</span><br><span class="line">$ ln npm /usr/bin</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ï¼š è¯¥ç”¨ <code>sudo</code> çš„åœ°æ–¹å°±ç”¨ <code>sudo</code> æˆ–è€… <code>su</code> ã€‚</p></blockquote><p>è‡³æ­¤ï¼Œ<strong>Linux</strong> ä¸‹çš„ <strong>Node.js</strong> ç¯å¢ƒåŸºæœ¬æ­å»ºå®Œæ¯•ã€‚</p><h2 id="Windows-ç¯å¢ƒ"><a href="#Windows-ç¯å¢ƒ" class="headerlink" title="Windows ç¯å¢ƒ"></a>Windows ç¯å¢ƒ</h2><h3 id="Cygwin-å®‰è£…å’Œé…ç½®"><a href="#Cygwin-å®‰è£…å’Œé…ç½®" class="headerlink" title="Cygwin å®‰è£…å’Œé…ç½®"></a>Cygwin å®‰è£…å’Œé…ç½®</h3><p><strong><em>Cygwin</em></strong> æ˜¯ä¸€ä¸ªåœ¨ <strong><em>Windows</em></strong> å¹³å°ä¸Šè¿è¡Œçš„ <strong><em>Unix</em></strong> æ¨¡æ‹Ÿç¯å¢ƒã€‚å¯¹äºå­¦ä¹  <strong><em>Unix/Linux</em></strong> æ“ä½œç¯å¢ƒï¼Œæˆ–è€…ä» <strong><em>Unix</em></strong> åˆ° <strong><em>Windows</em></strong> çš„åº”ç”¨ç¨‹åºç§»æ¤ï¼Œæˆ–è€…è¿›è¡ŒæŸäº›ç‰¹æ®Šçš„å¼€å‘å·¥ä½œï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ <strong><em>GNUå·¥å…·é›†</em></strong> åœ¨ <strong><em>Windows</em></strong> ä¸Šè¿›è¡ŒåµŒå…¥å¼ç³»ç»Ÿå¼€å‘ï¼Œéå¸¸æœ‰ç”¨ã€‚</p><h4 id="Cygwin-å®‰è£…"><a href="#Cygwin-å®‰è£…" class="headerlink" title="Cygwin å®‰è£…"></a>Cygwin å®‰è£…</h4><p>æˆ‘ä»¬å…ˆè·‘åˆ° <strong>Cygwin</strong> çš„å®˜ç½‘ä¸Šå»æŠŠä¸œè¥¿ä¸‹æ¥ï¼š</p><blockquote><p><a href="http://cygwin.com/install.html" target="_blank" rel="external">http://cygwin.com/install.html</a></p><blockquote><p>æ³¨æ„ï¼Œæœ€å¥½ä¸‹ <strong>x86</strong> çš„åŒ…ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹åè¦è®²ä¸€ä¸ª <code>cyg-apt</code> çš„è„šæœ¬æ’ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªèƒ½è®© <strong>Cygwin</strong> èƒ½è·Ÿ <strong>Linux</strong> ä¸€æ ·é€šè¿‡è„šæœ¬ä»æºå®‰è£…è½¯ä»¶åŒ…çš„è„šæœ¬ã€‚ä¸ºäº†æ–¹ä¾¿ä¿®æ”¹ï¼Œæˆ‘ä»¬å°†å…¶ä¸‹æˆ <strong>x86</strong> çš„ç‰ˆæœ¬ã€‚</p></blockquote></blockquote><p>ç„¶åå°±æ˜¯å®‰è£…æ­¥éª¤äº†ã€‚</p><center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-1.png" alt="ä»ç½‘ç»œå®‰è£…"></center><br><center><small>[å›¾2.1]</small></center><p>åˆ° <strong>[å›¾2.1]</strong> è¿™ä¸ªæ­¥éª¤çš„æ—¶å€™ï¼Œé€‰æ‹©é»˜è®¤çš„ <code>Install from Internet</code> å³å¯ã€‚</p><center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-2.png" alt="é€‰æ‹©å®‰è£…è·¯å¾„"></center><br><center><small>[å›¾2.2]</small></center><p>åœ¨ <strong>[å›¾2.2]</strong> çš„æ—¶å€™é€‰ä¸€ä¸ªå®‰è£…è·¯å¾„ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼šå°½å¯èƒ½è®©è¿™ä¸ªå®‰è£…è·¯å¾„ç®€å•ï¼Œè€Œä¸è¦æ˜¯ç±»ä¼¼äº</p><p><code>c:\Program Files\blahblah</code></p><p>è¿™æ ·çš„æ–‡ä»¶è·¯å¾„ã€‚</p></blockquote><center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-3.png" alt="æœ¬åœ°åŒ…è·¯å¾„"></center><br><center><small>[å›¾2.3]</small></center><p><strong>[å›¾2.3]</strong> çš„æ—¶å€™é€‰ä¸€ä¸ªæœ¬åœ°åŒ…çš„è·¯å¾„ï¼Œæˆ‘è¿™é‡Œé€‰çš„æ˜¯ <code>e:\cygwin\tmp</code>ã€‚</p><center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-4.png" alt="ç›´è¿"></center><br><center><small>[å›¾2.4]</small></center><p><strong>[å›¾2.4]</strong> é€‰æ‹©ç›´æ¥è¿æ¥ã€‚</p><center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-5.png" alt="163"></center><br><center><small>[å›¾2.5]</small></center><p>æˆ‘ä»¬å›½å†…çš„ç”¨æˆ·æºè¿˜æ˜¯é€‰æ‹© <code>163</code> çš„é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚æ‰€ä»¥åœ¨ <strong>[å›¾2.5]</strong> è¿™ä¸€æ­¥çš„æ—¶å€™å°±ç›´æ¥é€‰ç”¨é»˜è®¤çš„ <code>163</code> çš„æºäº†ã€‚å¦‚æœä¸æ˜¯é»˜è®¤çš„è¯ï¼Œè¯·é€‰ä¸­å®ƒã€‚</p><p>åœ¨ <strong>Select Package</strong> ä¹Ÿå°±æ˜¯é€‰æ‹©é¢„å®‰è£…çš„è½¯ä»¶çš„æ—¶å€™ï¼ŒæŠŠä¸‹åˆ—è¡¨ä¸­çš„è½¯ä»¶åŒ…å‹¾é€‰èµ·æ¥ï¼š</p><blockquote><ul><li><strong>wget</strong>: åœ¨ <strong>Utils</strong> ä¸­</li><li><strong>vim</strong>: åœ¨ <strong>Editors</strong> ä¸­</li><li><strong>gcc</strong>: åœ¨ <strong>Devel</strong> ä¸­</li><li><strong>gcc-g++</strong>: åœ¨ <strong>Devel</strong> ä¸­</li><li><strong>make</strong>: åœ¨ <strong>Devel</strong> ä¸­</li><li><strong>cmake</strong>: åœ¨ <strong>Devel</strong> ä¸­</li></ul></blockquote><p>è‹¥æ˜¯è¿™äº›é€‰é¡¹å·²ç»è¢«é€‰èµ·æ¥äº†å°±ä¸ç”¨å†é€‰äº†ï¼Œå¦‚æœæ²¡æœ‰é€‰èµ·æ¥åˆ™æŠŠå®ƒé€‰ä¸­ã€‚</p><p>å‹¾é€‰å¥½äº†ä¹‹åå°±å¯ä»¥ä¸‹ä¸€æ­¥å®‰è£…äº†ï¼Œç›´è‡³å®‰è£…å®Œæ¯•ï¼Œä½ å°±å¯ä»¥æ‰“å¼€ä½ çš„ <strong>Cygwin</strong> äº†ã€‚</p><center><img src="http://blog-xcoder-in.qiniudn.com/cygwin-install-6.png" alt="Cygwin"></center><br><center><small>[å›¾2.6]</small></center><blockquote><p><strong>æç¤º</strong>ï¼šä½ å¯ä»¥ç‚¹å‡»çª—å£å·¦ä¸Šè§’çš„å°å›¾ç‰‡ï¼Œç„¶åé‡Œé¢çš„ <strong>Options</strong> ä¸­ï¼Œä½ å¯ä»¥è°ƒæ•´ä½ è‡ªå·±çš„ <strong>Cygwin</strong> å¤–è§‚ã€‚</p></blockquote><h3 id="vim-é…ç½®"><a href="#vim-é…ç½®" class="headerlink" title="vim é…ç½®"></a>vim é…ç½®</h3><p>ä¸Šä¸€æ­¥æˆ‘ä»¬å·²ç»é€‰ä¸­äº† <strong>vim</strong> ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å·²ç»åœ¨ <strong>Cygwin</strong> ä¸­è£…ä¸Šäº† <strong>vim</strong>ã€‚ä½†æ˜¯ç”±äºè¿™é‡Œçš„ <strong>vim</strong> é»˜è®¤é…ç½®éå¸¸è›‹ç–¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æ”¹ä¸€ä¸‹ã€‚</p><p>åœ¨ä½ çš„ <strong>Cygwin</strong> ä¸­ä¸€å¥å¥è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">$ cd /home/&lt;ä½ è‡ªå·±çš„ç”¨æˆ·å&gt;</span><br><span class="line">$ wget http://blog-xcoder-in.qiniudn.com/.vimrc</span><br><span class="line">$ mkdir .vim</span><br><span class="line">$ cd .vim</span><br><span class="line">$ mkdir colors</span><br><span class="line">$ cd colors</span><br><span class="line">$ wget http://blog-xcoder-in.qiniudn.com/molokai.vim</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä½ çš„ <strong>vim</strong> å°±ç”¨ä¸Šäº†ä¸Šé¢çš„é‚£ä¸ªåœ°å€çš„é…ç½®æ–‡ä»¶ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç¼–è¾‘ä½ è‡ªå·±çš„é…ç½®æ–‡ä»¶æˆ–è€…è¯´ä»ç½‘ä¸Šä¸‹åˆ«çš„é…ç½®æ–‡ä»¶ä»¥æ»¡è¶³ä½ çš„ä¸ªæ€§åŒ–éœ€æ±‚ã€‚</p><p><strong>vim</strong> é…ç½®ä»¥åŠä½¿ç”¨è¯·å‚ç…§ï¼š<a href="https://wiki.archlinux.org/index.php/Vim" target="_blank" rel="external">https://wiki.archlinux.org/index.php/Vim</a></p><blockquote><p>äº‹æ— å·¨ç»†é—® <strong>ArchWiki</strong>ã€‚</p><div style="text-align: right;"><em>â€“ <a href="https://github.com/kalxd" target="_blank" rel="external">kalxd</a></em></div></blockquote><h3 id="apt-cyg"><a href="#apt-cyg" class="headerlink" title="apt-cyg"></a>apt-cyg</h3><blockquote><p>apt-cyg is a command-line installer for Cygwin which cooperates with Cygwin Setup and uses the same repository. The syntax is similar to apt-get.</p><div style="text-align: right;"><em>â€“ From apt-cyg googlecode page</em></div></blockquote><p>æ€»ä¹‹æ„æ€å°±æ˜¯è¯´ <code>apt-cyg</code> æ˜¯ç±»ä¼¼äº <strong>Linux</strong> ä¸­çš„ <code>apt-get</code>ï¼Œ <code>yum</code>, <code>zypper</code> ç­‰å‘½ä»¤è¡Œè½¯ä»¶åŒ…å®‰è£…å™¨ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡</p><ul><li><code>apt-cyg install &lt;package names&gt;</code> æ¥å®‰è£…è½¯ä»¶åŒ…</li><li><code>apt-cyg remove &lt;package names&gt;</code> æ¥ç§»é™¤è½¯ä»¶åŒ…</li><li><code>apt-cyg update</code> æ¥æ›´æ–° setup.ini</li><li><code>apt-cyg show</code> æ¥åˆ—å‡ºå·²å®‰è£…çš„è½¯ä»¶åŒ…</li><li><code>apt-cyg find &lt;pattern(s)&gt;</code> æ¥æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„è½¯ä»¶åŒ…</li><li><code>apt-cyg describe &lt;pattern(s)&gt;</code> æ¥æè¿°ç¬¦åˆæ¡ä»¶çš„è½¯ä»¶åŒ…</li><li><code>apt-cyg packageof &lt;commands or files&gt;</code> æ¥å®šä½å…¶çˆ¶è½¯ä»¶åŒ…</li></ul><h4 id="apt-cyg-å®‰è£…"><a href="#apt-cyg-å®‰è£…" class="headerlink" title="apt-cyg å®‰è£…"></a>apt-cyg å®‰è£…</h4><p>å…¶å®ä¹Ÿä¸èƒ½è¯´æ˜¯å®‰è£…ï¼Œçº¯ç²¹æ˜¯æŠŠè„šæœ¬ä»ç½‘ç»œä¸Šæ‹·åˆ°è‡ªå·±çš„ <strong>Cygwin</strong> çš„ç¯å¢ƒç›®å½•ä¸­ã€‚</p><p>åœ¨ä½ çš„ <strong>Cygwin</strong> ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">$ cd /usr/local/bin</span><br><span class="line">$ wget http://apt-cyg.googlecode.com/svn/trunk/apt-cyg</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä½ å°±â€œå®‰è£…â€å¥½äº† <strong>apt-cyg</strong> äº†ã€‚ä¸è¿‡è¿™é‡Œç”¨çš„æ˜¯é»˜è®¤çš„æºï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯é»˜è®¤çš„ã€‚</p><p>å¦‚æœä½ ç°åœ¨å·²ç»å¿ƒå®‰ç†å¾—æˆ–è€…ä¸æƒ³æŠ˜è…¾äº†å¯ä»¥è·³è¿‡ <strong><a href="#apt-cyg-ä¿®æ”¹">2.1.3.2. apt-cyg ä¿®æ”¹</a></strong>ï¼Œå¦‚æœä½ æƒ³æŠŠæºæ¢æˆ <code>163</code> çš„è¯é‚£ä¹ˆç¨å¾®çœ‹ä¸€ä¸‹å§ã€‚</p><h4 id="apt-cyg-ä¿®æ”¹"><a href="#apt-cyg-ä¿®æ”¹" class="headerlink" title="apt-cyg ä¿®æ”¹"></a>apt-cyg ä¿®æ”¹</h4><p>æ¥ä¸‹å»æˆ‘ä»¬è¦å¯¹ <strong>apt-cyg</strong> åšä¸€äº›ç¼–è¾‘ã€‚</p><p>ä½ æœ‰ä¸‹é¢ä¸¤ä¸ªé€‰æ‹©ï¼š</p><ol><li>å¦‚æœä½ æƒ³å­¦ä¹  <strong>vim</strong> æ“ä½œæˆ–è€…ä½ å·²ç»ç†Ÿæ‚‰äº†ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨ <code>vim apt-cyg</code> æ¥è¿›è¡Œç¼–è¾‘ã€‚</li><li>å¦‚æœä½ æ˜¯æ‡’äººè¿˜æ˜¯æƒ³è¦ç›´æ¥ç¼–è¾‘çš„è¯ï¼Œè¯·è·‘åˆ°ä½ çš„ <strong>Cygwin</strong> çš„å®‰è£…ç›®å½•ï¼Œæ‰¾åˆ° <strong>usr</strong> æ–‡ä»¶å¤¹ï¼Œé£è¿› <strong>local/bin</strong> ç›®å½•ä¸­å»ï¼Œç”¨ä½ è‡ªå·±å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€å¹¶ç¼–è¾‘ã€‚</li></ol><p>å¤§çº¦æ˜¯ <code>68</code> è¡Œä¸Šä¸‹å§ï¼Œæœ‰ä¸€å¥æ˜¯ï¼š</p><figure class="highlight plain"><figcaption><span>bash</span></figcaption><table><tr><td class="code"><pre><span class="line">mirror=ftp://mirror.mcs.anl.gov/pub/cygwin</span><br></pre></td></tr></table></figure><p>å°†å…¶æ”¹æˆï¼š</p><figure class="highlight plain"><figcaption><span>bash</span></figcaption><table><tr><td class="code"><pre><span class="line">mirror=http://mirrors.163.com/cygwin</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å°±æ˜¯å¤§æ¦‚åœ¨ <code>98</code> è¡Œå’Œ <code>105</code> è¡Œå·¦å³ï¼š</p><figure class="highlight plain"><figcaption><span>bash</span></figcaption><table><tr><td class="code"><pre><span class="line">wget -N $mirror/setup.bz2</span><br><span class="line">...</span><br><span class="line">wget -N $mirror/setup.ini</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æˆï¼š</p><figure class="highlight plain"><figcaption><span>bash</span></figcaption><table><tr><td class="code"><pre><span class="line">wget -N $mirror/x86/setup.bz2</span><br><span class="line">...</span><br><span class="line">wget -N $mirror/x86/setup.ini</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œä½ çš„ <strong>Cygwin</strong> ç¯å¢ƒåŸºæœ¬å®Œæˆï¼Œä»¥åå¯ä»¥å†æ…¢æ…¢å®Œå–„ã€‚</p><h3 id="Node-js-å®‰è£…"><a href="#Node-js-å®‰è£…" class="headerlink" title="Node.js å®‰è£…"></a>Node.js å®‰è£…</h3><p>è¿™ä¸ªå°±å¾ˆç®€å•äº†ï¼Œæ‰“å¼€ <strong><a href="http://nodejs.org/download/" target="_blank" rel="external">Node.js</a></strong> å®˜ç½‘ä¸‹è½½å®‰è£…å³å¯ã€‚</p><blockquote><p>é€‰æ‹© <strong>Windows Installer (.msi)</strong> æˆ–è€… <strong>Windows Binary (.exe)</strong>ã€‚</p></blockquote><p>å®‰è£…å¥½åå°±èƒ½ç›´æ¥åœ¨ <strong>Cygwin</strong> é‡Œé¢ä½¿ç”¨äº†ã€‚</p><h2 id="çœŸÂ·Hello-World"><a href="#çœŸÂ·Hello-World" class="headerlink" title="çœŸÂ·Hello World"></a>çœŸÂ·Hello World</h2><p>ç°åœ¨ï¼Œæ— è®ºä½ æ˜¯ <strong>Linux</strong> ç”¨æˆ·è¿˜æ˜¯ <strong>Windows</strong> ç”¨æˆ·ï¼Œéƒ½å¯ä»¥ç”¨ä¸€æ ·çš„æ­¥éª¤æ¥å®Œæˆä¸‹é¢çš„ <code>Hello World</code> äº†ã€‚</p><p>éšä¾¿è·‘ä¸€ä¸ªç›®å½•é‡Œé¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”ç”¨ <strong>vim</strong> ç¼–è¾‘ï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">$ vim hello.js</span><br></pre></td></tr></table></figure><p>åœ¨é‡Œé¢è¾“å…¥ä¸‹é¢çš„ä¸œè¥¿ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">console.log(&quot;Hello world!&quot;);</span><br></pre></td></tr></table></figure><p>ç„¶åé€€å‡º <strong>vim</strong> æ‰§è¡Œï¼š</p><figure class="highlight plain"><figcaption><span>sh</span></figcaption><table><tr><td class="code"><pre><span class="line">$ node hello.js</span><br></pre></td></tr></table></figure><p>ç»ˆäºï¼Œ<strong>çœŸÂ·Hello world</strong> å‡ºç°åœ¨äº†ä½ çš„çœ¼å‰ï¼Œè€Œä¸éœ€è¦å€ŸåŠ© <strong><a href="http://ideone.com/" target="_blank" rel="external">IDEOne</a></strong> äº†ã€‚</p><p><strong><em>To be continuedâ€¦</em></strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€ç”±äº&lt;a href=&quot;!--ï¿¼11--&amp;gt;#linux-ç¯å¢ƒ&quot;&gt;Linux&lt;/a&gt;ä¸­çš„ç¯å¢ƒæ­å»ºæ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥è‰è‰ç•¥è¿‡ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å…¶å®&lt;a href=&quot;!--ï¿¼12--&amp;gt;#windows-ç¯å¢ƒ&quot;&gt;Windows&lt;/a&gt;ä¸‹ä¹Ÿä¸ç®—éº»çƒ¦ï¼Œä½†æ˜¯è¿™é‡Œä¼šè®²ä¸€å®šé‡çš„
      
    
    </summary>
    
      <category term="NodeJS" scheme="https://xcoder.in/categories/NodeJS/"/>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="JavaScript" scheme="https://xcoder.in/tags/JavaScript/"/>
    
      <category term="ä¸€èµ·æ’¸Node.JS" scheme="https://xcoder.in/tags/%E4%B8%80%E8%B5%B7%E6%92%B8Node-JS/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€èµ·æ’¸Node.JSï¼ˆè´Ÿåï¼‰â€”â€”æ¦‚è¿°</title>
    <link href="https://xcoder.in/2013/08/13/node-1-summary/"/>
    <id>https://xcoder.in/2013/08/13/node-1-summary/</id>
    <published>2013-08-12T16:00:00.000Z</published>
    <updated>2017-12-11T07:59:20.523Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€æœ¬ç³»åˆ—æ•™ç¨‹ä¸»è¦æ˜¯å†™ç»™æˆ‘å¸¦çš„é‚£å¸®ç†Šå­©å­ä»¬çœ‹çš„ã€‚æˆ‘è‡ªå·±çš„ <strong>Node.js</strong> æ°´å¹³åŠæ–¤å…«ä¸¤ï¼Œæªè¾ä¹‹ä¸­ä¹Ÿå…ä¸äº†æœ‰è‡ªå·±é”™è¯¯çš„ç†è§£ï¼Œä¼šè¯¯äººå­å¼Ÿã€‚ä½†æ˜¯å¯¹äºåˆå­¦è€…æ¥è¯´ï¼ŒæŸäº›è‡ªå·±åŠ©è®°çš„ç†è§£è¿˜æ˜¯å¯å–çš„ã€‚æœ‰äº›æ¦‚å¿µæ€§çš„é”™è¯¯å¯ä»¥ç­‰ä»–ä»¬è¿›ä¸€æ­¥æ·±å…¥ç ”ç©¶ä¹‹åå†è‡ªè¡Œæ›´æ­£ã€‚</p><p>ã€€ã€€ç”±äºé‚£å¸®äººå¤§å¤šè¿˜å¤„äºä½¿ç”¨ <strong>M$ Windows</strong> çš„ä»¤äººä¸æ„‰å¿«çš„é˜¶æ®µï¼Œæ‰€ä»¥æœ¬æ•™ç¨‹å°†ä¼šé€€è€Œæ±‚å…¶æ¬¡ï¼Œä½¿å…¶åœ¨ <strong>Cygwin</strong> ä¸­æ¨¡æ‹Ÿ <strong>linux</strong> çš„å‘½ä»¤ï¼ˆWindowsçš„batè„šæœ¬å®åœ¨æ˜¯è®©äººä¸æ•¢æ­ç»´ï¼‰ã€‚ä»¥åŠåœ¨è¿™é‡Œä¼šè®²è¿°ä¸€äº› <strong>Git</strong> æ“ä½œçš„åˆæ­¥ã€‚å½“ç„¶ï¼Œå¦‚æœä½ å·²ç»åœ¨ä½¿ç”¨ <strong>linux</strong> è¿›è¡Œå¼€å‘çš„è¯ï¼Œå¯ä»¥è·³è¿‡å‰é¢ä¸€å †ä»¤äººæ„Ÿåˆ°åŒçƒ¦çš„ç¯å¢ƒé…ç½®ç« èŠ‚ã€‚æˆ–è€…ä½ åœ¨ä½¿ç”¨ <strong>M$ Windows</strong> ä½†å´ä¸æƒ³æ”¹å˜è‡ªå·±çš„è„šæœ¬ä¹ æƒ¯çš„è¯ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ€§åœ°è·³è¿‡ä¸€äº›ç« èŠ‚å’Œæ­¥éª¤ã€‚</p><!-- æˆ‘æ˜¯å°å°åˆ†å‰²ç¬¦ --><h2 id="Node-JSæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Node-JSæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Node.JSæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Node.JSæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å¾ˆå¤šäººéƒ½çŸ¥é“JSæ˜¯ä¸€é—¨è¯­è¨€ï¼Œè€Œä¸”æ˜¯ä¸€é—¨è„šæœ¬è¯­è¨€ï¼Œå…¶å…¨ç§°å°±æ˜¯ <strong>JavaScript</strong>ï¼Œè€Œä¸”ä¸æ‰€è°“çš„ <strong>Java</strong> æ²¡æœ‰ä¸€ä¸ªå±çš„å…³ç³»ã€‚</p><h3 id="å‰ç«¯-JavaScript"><a href="#å‰ç«¯-JavaScript" class="headerlink" title="å‰ç«¯ JavaScript"></a>å‰ç«¯ JavaScript</h3><p>åœ¨å¥½å¤šå¹´å‰ï¼Œ<strong>JavaScript</strong> æ˜¯ç½‘é¡µçš„ä¸€ä¸ªå¯„ç”Ÿè™«ï¼Œå®ƒå¿…é¡»ä¾èµ–äºç½‘é¡µçš„æµè§ˆå™¨ä¸­æ‰èƒ½æ‰§è¡Œï¼Œå¹¶ä¸”ä½œä¸ºç½‘é¡µçš„ä¸€éƒ¨åˆ†ï¼Œä»¥</p><figure class="highlight plain"><figcaption><span>html</span></figcaption><table><tr><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">//blahblah...</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æ ‡ç­¾è¿›è¡ŒåŒ…å«ï¼Œè¿™æ ·æ‰èƒ½æä¾›å…¶ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚æˆ–è€…è¯´å°†å…¶å•ç‹¬å†™å…¥ä¸€ä¸ª <code>*.js</code> æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åœ¨ç½‘é¡µé‡Œä»¥</p><figure class="highlight plain"><figcaption><span>html</span></figcaption><table><tr><td class="code"><pre><span class="line">&lt;script src=&quot;foo/bar.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>çš„å½¢å¼å°†å…¶åŒ…å«è¿›æ¥ã€‚</p><p>ä½†æ€»è€Œè¨€ä¹‹ï¼Œ<strong>JavaScript</strong> åªæ˜¯å¯„ç”Ÿåœ¨ç½‘é¡µé‡Œé¢çš„ä¸€åªå°å°å¯æ€œè™«ç½¢äº†ã€‚å®ƒçš„ä½œç”¨æ— éå°±æ˜¯ä½¿ç½‘é¡µçš„äº¤äº’æ€§æ›´å¼ºï¼Œé¡µé¢æ•ˆæœæ›´å¤šè€Œå·²ã€‚</p><p>åæ¥ï¼Œè¿™å¸®ä¸ç”˜å¯‚å¯çš„äººç±»å°† <strong>JavaScript</strong> ä»ç½‘é¡µï¼ˆæˆ–è€…è¯´å‰ç«¯ï¼‰çš„å¸å›½ä¸­ç‹¬ç«‹äº†å‡ºæ¥ï¼ˆå°å¿ƒå¿«é€’ï¼‰ï¼Œäºæ˜¯å°±å‡ºç°äº† <strong>CommonJS</strong>ã€‚</p><h3 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h3><p><strong>CommonJS</strong> å…¶å®ä¸æ˜¯ä¸€é—¨æ–°çš„è¯­è¨€ï¼Œç”šè‡³éƒ½ä¸èƒ½è¯´å®ƒæ˜¯ä¸€ä¸ªæ–°çš„è§£é‡Šå™¨â€”â€”å®é™…ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªæ¦‚å¿µæˆ–è€…æ˜¯ä¸€ä¸ªè§„èŒƒã€‚</p><p>åœ¨è¿™ä¸ªè§„èŒƒä¸­ï¼Œå®ƒå®šä¹‰äº†å¾ˆå¤š <strong>API</strong> ï¼Œè®²é€šä¿—ç‚¹æˆ–è€…ç›´æˆªäº†å½“ç‚¹å°±æ˜¯å‡½æ•°å•Šç±»å•Šä»€ä¹ˆçš„ï¼Œè€Œè¿™äº› <strong>API</strong> æ˜¯ä¸ºé‚£äº›æ™®é€šåº”ç”¨ç¨‹åºï¼ˆNative Appï¼‰è€Œéæµè§ˆå™¨åº”ç”¨ä½¿ç”¨ã€‚å®ƒçš„ç»ˆæç›®æ ‡å°±æ˜¯æä¾›ä¸€ä¸ªç±»ä¼¼äº <strong>Python</strong>ã€<strong>Ruby</strong> ä¹‹ç±»çš„è„šæœ¬ä¸€æ ·çš„æ ‡å‡†åº“ï¼Œå¼€å‘è€…å¯ä»¥ç”¨è¿™æ ·çš„ä¸œè¥¿ä¸€æ ·æ¥åšåˆ° <strong>Python</strong>ã€<strong>Ruby</strong> èƒ½åšåˆ°çš„äº‹ï¼Œè€Œéä»…ä»…å±€é™äºç½‘é¡µä¸­çš„æ•ˆæœæˆ–è€…åŠŸèƒ½å®ç°ï¼Œå®ƒä¹Ÿå¯ä»¥è·‘åœ¨æœ¬åœ°ã€‚</p><p>æ‰€ä»¥è¯´ä¸‹é¢çš„äº‹æƒ…å¯¹äº <strong>JavaScript</strong> æ¥è¯´ä¸å†æ˜¯æ¢¦ï¼š</p><ul><li>æœåŠ¡ç«¯JavaScriptåº”ç”¨</li><li>å‘½ä»¤è¡Œå·¥å…·</li><li>å›¾å½¢ç•Œé¢åº”ç”¨</li><li>æ··åˆåº”ç”¨ï¼ˆTitaniumã€Adobe AIRç­‰ï¼‰</li></ul><p>é‚£ä¹ˆï¼Œå®ƒå…·ä½“å¼¥è¡¥äº† <strong>å‰ç«¯JavaScript</strong> çš„å“ªäº›ç©ºç™½å‘¢ï¼Ÿå…¶å®è¿™ä¹Ÿæ¶‰åŠäº†å¾ˆå¤š <strong>å‰ç«¯JavaScript</strong> æ‰€æ²¡æœ‰æ¶‰åŠçš„ä¸œè¥¿ï¼Œå¦‚äºŒè¿›åˆ¶ã€ç¼–ç ã€IOã€æ–‡ä»¶ã€ç³»ç»Ÿã€æ–­è¨€æµ‹è¯•ã€å¥—æ¥å­—ã€äº‹ä»¶é˜Ÿåˆ—ã€Workerã€æ§åˆ¶å°ç­‰ç­‰ã€‚</p><p>å…³äº <strong>CommonJS</strong> çš„æ›´è¿›ä¸€æ­¥äº†è§£å¯ä»¥ç¿»é˜…ä¸€ä¸‹å…¶ <strong><a href="http://wiki.commonjs.org/wiki/CommonJS" target="_blank" rel="external">Wiki</a></strong>ã€‚</p><h3 id="Node-JS"><a href="#Node-JS" class="headerlink" title="Node.JS"></a>Node.JS</h3><p>ä¸Šé¢è®²äº†é‚£ä¹ˆå¤šï¼Œå´å§‹ç»ˆåœç•™åœ¨â€œè§„èŒƒâ€è¿™ä¸ªå±‚é¢ä¸Šã€‚è€Œ <strong>Node.JS</strong> çš„å‡ºç°ä¾¿æ˜¯è®© <strong>CommonJS</strong> æˆä¸ºäº†ç°å®ã€‚</p><p>è¿™é‡Œè¦å¤§å®¶æ˜ç¡®çš„ä¸€ç‚¹çš„å°±æ˜¯ <strong>Node.JS</strong> å¹¶ä¸æ˜¯ä¸€é—¨æ–°çš„è¯­è¨€ï¼Œå®ƒçš„è¯­è¨€è¿˜æ˜¯ <strong>JavaScript</strong> ï¼Œç¡¬è¦è¯´æ˜¯ä¸€é—¨æ–°çš„è¯­è¨€é‚£ä¹Ÿåº”è¯¥æ˜¯ <strong>Common JavaScript</strong>ã€‚<strong>Node.JS</strong> åªæ˜¯ <strong>CommonJS</strong> çš„ä¸€ä¸ª<a href="http://zh.wikipedia.org/wiki/%E8%A7%A3%E9%87%8A%E5%99%A8" target="_blank" rel="external">è§£é‡Šå™¨</a>ç½¢äº†ã€‚</p><p>å®ƒæ˜¯åŸºäº <strong>Google</strong> çš„ <strong>V8è™šæ‹Ÿæœº</strong>(Chromeæµè§ˆå™¨æ‰€ä½¿ç”¨çš„JavaScriptæ‰§è¡Œç¯å¢ƒ) çš„ä¸€ä¸ªè§£é‡Šå™¨ã€‚</p><p>å¾ˆå¤šäººå°è±¡ä¸­çš„æ¦‚å¿µè¿˜æ˜¯æ²¡èƒ½æ‘†è„± <strong>å‰ç«¯JavaScript</strong> çš„é˜´éœ¾ï¼Œè®¤ä¸º <strong>JavaScript</strong> å°±æ˜¯åšç½‘ç«™çš„ï¼Œ <strong>Node.JS</strong> ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>åŒ…æ‹¬æœ¬äººåœ¨ <strong><a href="http://cnodejs.org/" target="_blank" rel="external">cnodejs.org</a></strong> ä¸­çœ‹åˆ°çš„å¸–å­å¤§å¤šä¹Ÿéƒ½æ˜¯è®² <strong>Node.JS</strong> å¦‚ä½•å¦‚ä½•åšç½‘ç«™ï¼ˆæœåŠ¡ç«¯ï¼‰äº‘äº‘ï¼Œå¦‚ä½•å¦‚ä½•ä½¿ç”¨ <strong>Express</strong> æ¨¡å—æ¥æ­å»ºä¸€ä¸ªç½‘ç«™äº‘äº‘ã€‚</p><blockquote><p>è¿™æ˜¯ä¸€ä¸ªè¯¯åŒºã€‚</p></blockquote><p><strong>PHP</strong> è¿˜èƒ½ç”¨ <strong><a href="http://www.php-cli.com/" target="_blank" rel="external">PHP-CLI</a></strong> æ¥å†™ä¸ªè„šæœ¬æ”¾æœ¬åœ°è·‘å‘¢ï¼Œ<strong>Node.JS</strong> æ›´æ˜¯å¯ä»¥å†™ä»»ä½•ç¨‹åºã€‚è™½ç„¶è¿™ä¹ˆè®²æœ‰äº›å¤¸å¤§äº†ï¼Œä½†æ˜¯æˆ‘è¿™ä¹ˆè¯´çš„ç†ç”±æ˜¯å¸Œæœ›å¤§å®¶èƒ½æ‘†è„±è¿™ä¹ˆä¸€ä¸ªè¯¯åŒºã€‚</p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­å§ï¼Œå¤§å®¶éƒ½æ˜¯æè¿‡ <strong>ACM</strong> çš„å­©å­äº†ï¼Œæ€»å¯¹ç»ˆç«¯çª—å£çš„è¾“å…¥è¾“å‡ºæœ‰ä¸€å®šæ„Ÿè§‰äº†å§ã€‚ç°åœ¨ç»™æˆ‘ä»¥æœ€å¿«é€Ÿåº¦ç ä¸€ä¸ª <strong><em><a href="http://acm.nbut.edu.cn/problem/view.xhtml?id=1000" target="_blank" rel="external">A + B Problem</a></em></strong> ç»™æˆ‘çœ‹çœ‹ã€‚</p><p>è½»è½¦ç†Ÿè·¯ï¼Œæˆ‘çŸ¥é“ã€‚ä½†æ˜¯ä½ ä»¬ç°åœ¨åšçš„äº‹ç”¨ <strong>Node.JS</strong> åŒæ ·èƒ½åšåˆ°ã€‚</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">process.stdin.resume();</span><br><span class="line">process.stdin.setEncoding(&quot;utf8&quot;);</span><br><span class="line">process.stdin.on(&quot;data&quot;, function(chunk) &#123;</span><br><span class="line">    var datas = chunk.trim().split(&quot;\n&quot;);</span><br><span class="line">    for(var i = 0; i &lt; datas.length; i++) &#123;</span><br><span class="line">        var ab = datas[i].trim().split(&quot; &quot;);</span><br><span class="line">        var a = parseInt(ab[0]);</span><br><span class="line">        var b = parseInt(ab[1]);</span><br><span class="line">        console.log(a + b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç”±äº<del>æˆ‘ä»¬å­¦æ ¡</del>æˆ‘çš„å‰ä»»å­¦æ ¡OJä¸æ”¯æŒ <strong>Node.JS</strong>ï¼Œæ‰€ä»¥è¯·ä½ ä»¬ç§»æ­¥åˆ° <strong><a href="http://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=1000" target="_blank" rel="external">AIZU OJ</a></strong> å»æŠŠä¸Šé¢çš„ä»£ç äº¤è¿‡å»çœ‹çœ‹ç»“æœçœ‹ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼šè¯­è¨€è¦é€‰æ‹© <strong>JavaScript</strong>ã€‚</p></blockquote><p>æ€ä¹ˆæ ·ï¼ŒåŒæ ·èƒ½è¿‡é¢˜çš„å¯¹å§ï¼Ÿ</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ä¸Šé¢å¯¹è¿™äº›ä¸œè¥¿åšäº†ä¸ªç®€å•çš„ä»‹ç»ï¼Œæˆ‘éœ€è¦ä½ ä»¬çŸ¥é“çš„ä¸œè¥¿å¾ˆç®€å•ï¼š</p><ol><li><strong>Node.JS</strong> æ˜¯ä¸€ä¸ªè„šæœ¬è§£é‡Šå™¨ï¼Œç”¨çš„è¯­è¨€æ˜¯ <strong>JavaScript</strong>ã€‚</li><li><strong>Node.JS</strong> åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œä¸æ˜¯åªèƒ½æ‹¿æ¥åšç½‘ç«™çš„ï¼Œçœ¼å…‰æ”¾å¼€é˜”äº›ã€‚</li><li>ç»™æˆ‘å¥½å¥½å­¦ã€‚</li></ol><h2 id="ç•ªå¤–"><a href="#ç•ªå¤–" class="headerlink" title="ç•ªå¤–"></a>ç•ªå¤–</h2><blockquote><p>æœ‰ä¸ªç ç•œè€äº†ï¼Œæƒ³å­¦å­¦ä¹¦æ³•æ¥ä¿®èº«å…»æ€§ã€‚å½“ä»–å±•å¼€å®£çº¸ï¼ŒçŠ¹è±«äº†åŠå¤©ä¹‹åï¼Œç»ˆäºæŒ¥æ¯«æ³¼å¢¨ï¼Œåœ¨çº¸ä¸Šé¾™é£å‡¤èˆå†™ä¸‹å‡ ä¸ªå¤§å­—ï¼š</p><blockquote><p><strong><em>Hello World</em></strong></p></blockquote></blockquote><p>è™½ç„¶è¿™ä¸€ç¯‡æ–‡ç« æ²¡æœ‰è®²åˆ°ä»»ä½• <strong>Node.JS</strong> çš„è¯­æ³•ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥è®©ä½ ä»¬ç»ƒç»ƒä¹¦æ³•çš„ã€‚</p><p><strong>Cè¯­è¨€</strong> çš„æ ‡å‡†è¾“å‡ºå‡½æ•°æ˜¯ <code>printf</code>ï¼Œè€Œ <strong>Node.JS</strong> çš„æ ‡å‡†è¾“å‡ºåˆ™æ˜¯ï¼š</p><figure class="highlight plain"><figcaption><span>javascript</span></figcaption><table><tr><td class="code"><pre><span class="line">console.log(&quot;blahblah...&quot;);</span><br></pre></td></tr></table></figure><p>å¥½çš„ï¼Œå³ä½¿æ²¡æœ‰è£…ä¸Š <strong>Node.JS</strong> ç¯å¢ƒä¹Ÿé˜»æ­¢ä¸äº†æˆ‘ä»¬å‘ä¸–ç•Œé—®å¥½ã€‚</p><p>æ‰“å¼€ <strong><a href="http://ideone.com/" target="_blank" rel="external">IDEOne</a></strong>ï¼Œå°†ä½ çš„ <code>Hello World</code> è´´åˆ°ç¼–è¾‘æ¡†ä¸­ï¼Œç„¶ååœ¨å·¦ä¾§çš„è¯­è¨€æ é‡Œé¢é€‰ä¸­ <strong>Node.JS</strong> ï¼Œç‚¹å‡»é€å‡ºï¼Œä½ å°±èƒ½çœ‹åˆ°ä½ çš„ç¬¬ä¸€ä¸ª <strong>Node.JS</strong> ç¨‹åºçš„è¿è¡Œç»“æœäº†ã€‚</p><p><strong><em>To be continuedâ€¦</em></strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€æœ¬ç³»åˆ—æ•™ç¨‹ä¸»è¦æ˜¯å†™ç»™æˆ‘å¸¦çš„é‚£å¸®ç†Šå­©å­ä»¬çœ‹çš„ã€‚æˆ‘è‡ªå·±çš„ &lt;strong&gt;Node.js&lt;/strong&gt; æ°´å¹³åŠæ–¤å…«ä¸¤ï¼Œæªè¾ä¹‹ä¸­ä¹Ÿå…ä¸äº†æœ‰è‡ªå·±é”™è¯¯çš„ç†è§£ï¼Œä¼šè¯¯äººå­å¼Ÿã€‚ä½†æ˜¯å¯¹äºåˆå­¦è€…æ¥è¯´ï¼ŒæŸäº›è‡ªå·±åŠ©è®°çš„ç†è§£è¿˜æ˜¯å¯å–çš„ã€‚æœ‰äº›æ¦‚å¿µæ€§çš„é”™è¯¯å¯ä»¥ç­‰ä»–ä»¬è¿›ä¸€æ­¥æ·±å…¥ç ”ç©¶ä¹‹åå†è‡ªè¡Œæ›´æ­£ã€‚
      
    
    </summary>
    
      <category term="NodeJS" scheme="https://xcoder.in/categories/NodeJS/"/>
    
    
      <category term="Node.js" scheme="https://xcoder.in/tags/Node-js/"/>
    
      <category term="JavaScript" scheme="https://xcoder.in/tags/JavaScript/"/>
    
      <category term="ä¸€èµ·æ’¸Node.JS" scheme="https://xcoder.in/tags/%E4%B8%80%E8%B5%B7%E6%92%B8Node-JS/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºJavaScriptä¸­callbackå‡½æ•°çš„thisæŒ‡é’ˆé‡å®šä¹‰</title>
    <link href="https://xcoder.in/2013/07/15/javascript-callback-this-bind/"/>
    <id>https://xcoder.in/2013/07/15/javascript-callback-this-bind/</id>
    <published>2013-07-15T06:20:29.000Z</published>
    <updated>2017-12-11T07:59:20.501Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€æœ€è¿‘åœ¨å†™ <strong>NBUT Virtual Judge</strong> çš„å†…æ ¸æ¡†æ¶ï¼Œç”¨çš„åˆæ˜¯ <strong>Node.JS</strong> äº†ï¼ŒæŠŠå®ƒå½“ä½œä¸€ä¸ªæœ¬åœ°è¿è¡Œçš„è„šæœ¬ä¸æ–­è¿›è¡Œè½®è¯¢ã€‚</p><p>ã€€ã€€ä¼—æ‰€å‘¨çŸ¥JSä¸­çš„ä¸€ä¸ªç²¾é«“å°±æ˜¯å¼‚æ­¥å›è°ƒã€‚</p><p>ã€€ã€€æ‰€ä»¥åœ¨æˆ‘è‡ªå·±å†™çš„æ¡†æ¶ä¸­ä¹Ÿç»å¸¸ä¼šå‡ºç°ç±»ä¼¼äºä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">foo.bar(a, b, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ€»è€Œè¨€ä¹‹å°±æ˜¯å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†ä¼šè°ƒç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚</p><p>ã€€ã€€ä½†æ˜¯é—®é¢˜å‡ºç°äº†ï¼šåœ¨é‚£ä¸ªå›è°ƒå‡½æ•° <code>function</code> ä¸­ï¼Œä½ å¦‚æœä½¿ç”¨äº†ä¸€ä¸ª <code>this</code> æŒ‡é’ˆçš„è¯ï¼Œå®ƒå°†ä¼šæŒ‡å‘æ ¹ï¼Œè€Œä¸æ˜¯ <code>foo</code> çš„æœ¬ä½“ã€‚</p><p>ã€€ã€€é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³åœ¨ <code>function</code> ä¸­ä¹Ÿç”¨ <code>this</code> æ¥æŒ‡ä»£è¿™ä¸ª <code>foo</code> å¯¹è±¡è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ã€€ã€€ç»“æœè¿˜æ˜¯IRCæœ‰ç”¨ã€‚æœ¬äººè·‘ <strong>Node.JS</strong> çš„ <strong>IRC</strong> ä¸Šé—®äº†è¿™ä¸ªé—®é¢˜ï¼Œç»“æœæœ‰äººå°±è¿™æ ·å›å¤æˆ‘äº†ï¼š</p><blockquote><p>13:07 &lt;shama&gt; xadillax: foo(a, b callback.bind(foo))</p><p>13:10 &lt;olalonde&gt; foo (a, b fn) { fn = fn.bind(this); â€¦. }</p></blockquote><p>ã€€ã€€ç„¶åè¿˜å¾ˆçƒ­å¿ƒåœ°ç»™äº†æˆ‘ä¸ªç½‘å€ï¼š<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind</a></p><p>ã€€ã€€æ€»ä¹‹æœ€åå¾—å‡ºçš„ç»“è®ºå°±æ˜¯è¯´ï¼š</p><p>ã€€ã€€ä½ åªè¦ç»™ä½ çš„ <code>callback</code> å‡½æ•°æŒ‡å®šä¸€ä¸ª <code>this</code> æŒ‡é’ˆå³å¯ã€‚</p><p>ã€€ã€€å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> cb = callback.bind(foo);</span><br><span class="line">foo.bar(a, b, cb);</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™æ ·å°±èƒ½åœ¨å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨fooæ¥ä½œä¸ºå…¶thisæŒ‡é’ˆäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€æœ€è¿‘åœ¨å†™ &lt;strong&gt;NBUT Virtual Judge&lt;/strong&gt; çš„å†…æ ¸æ¡†æ¶ï¼Œç”¨çš„åˆæ˜¯ &lt;strong&gt;Node.JS&lt;/strong&gt; äº†ï¼ŒæŠŠå®ƒå½“ä½œä¸€ä¸ªæœ¬åœ°è¿è¡Œçš„è„šæœ¬ä¸æ–­è¿›è¡Œè½®è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¼—æ‰€å‘¨çŸ¥JSä¸­çš„ä¸€ä¸ªç²¾é«“å°±æ˜¯å¼‚æ­¥å›è°ƒã€‚&lt;/p&gt;
&lt;p
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="Javascript" scheme="https://xcoder.in/tags/Javascript/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºNode.jsä¸‹çš„MongoDBé˜»å¡æ¨¡å¼å®ç°</title>
    <link href="https://xcoder.in/2013/03/29/nodejs-mongodb-sync/"/>
    <id>https://xcoder.in/2013/03/29/nodejs-mongodb-sync/</id>
    <published>2013-03-29T01:31:38.000Z</published>
    <updated>2017-12-11T07:59:20.528Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€<strong><em>æ³¨ï¼šæœ¬æ–‡ä»…ä¸ºæˆ‘åˆå­¦ Node.JS çš„æ—¶å€™çš„ç¨šå«©ç¬”è®°ã€‚æ˜¯ä» <a href="http://web.archive.org/" target="_blank" rel="external">http://web.archive.org/</a> æ‰’å›æ¥çš„ã€‚ç°åœ¨çœ‹æ¥å·²æ— å¤šå¤§å‚è€ƒä»·å€¼ï¼Œå„ä½å¯ä»¥ç•¥è¿‡ã€‚æˆ‘åªæ˜¯æŠŠå®ƒæ‰’å›æ¥çºªå¿µä¸€ä¸‹è€Œå·²ï¼Œä»¥è®°å½•æˆ‘çš„å†ç¨‹ã€‚è€Œé‚£ä¸ªç›¸å¯¹åº”çš„ <code>SevenzJS</code> ä¹Ÿå·²ç»è¢«é—å¼ƒ</em></strong></p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ã€€ã€€æœ€è¿‘åœ¨åšå…¬å¸é¡¹ç›®çš„ä¸€ä¸ªæ¨¡å—ï¼Œä¸»è¦ç”¨äº <strong>JSON Api</strong> çš„ä¼ è¾“ï¼Œæ‰€ä»¥å¼€å‘ç¯å¢ƒçš„ç›®æ ‡å°±é”å®šåœ¨äº† <strong>Node.js</strong>ã€‚è€Œè¿™ä¸€å—çš„ç™»é™†ç”¨æˆ·åˆæ˜¯å­˜åœ¨ <strong>MongoDB</strong> é‡Œé¢çš„ï¼Œæ‰€ä»¥å°±æœ‰äº†å¦‚ä¸‹çš„é—®é¢˜ã€‚</p><ul><li>ç½‘ä¸Šçš„ Node.JS æ¡†æ¶éƒ½æ¯”è¾ƒé‡å‹æˆ–è€…è‡ƒè‚¿çš„ï¼Œå­¦äº† Node ä¹‹åè¿˜éœ€è¦å­¦é¢å¤–çš„ä¸œè¥¿ã€‚</li><li>æ‰€ä»¥æˆ‘å°±æ‰“ç®—è‡ªå·±å†™ä¸€ä¸ªä¸“æ³¨äº JSON Api çš„å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œäºæ˜¯æœ‰äº† SevenJSã€‚</li><li>é—®é¢˜å‡ºç°äº†ï¼Œè™½ç„¶ Node.JS æåº¦æ¨å´‡å¼‚æ­¥éé˜»å¡æ¨¡å¼ï¼Œä½†æ˜¯é˜»å¡æ¨¡å¼åœ¨å¹³å¸¸å¼€å‘ä¸­è¿˜æ˜¯å¤ªå¸¸ç”¨äº†ã€‚</li></ul><p>ã€€ã€€æˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å‡ å¥MongoDBçš„æŸ¥è¯¢ä¹‹ç±»çš„ï¼Œç”¨node-mongodb-nativeæ¥å†™çš„è¯æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Db(<span class="string">'test'</span>, <span class="keyword">new</span> Server(<span class="string">"127.0.0.1"</span>, <span class="number">27017</span>, &#123;&#125;));</span><br><span class="line"><span class="keyword">var</span> test = <span class="function"><span class="keyword">function</span> (<span class="params">err, collection</span>) </span>&#123;</span><br><span class="line">    collection.insert(&#123;<span class="attr">a</span>:<span class="number">2</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) </span>&#123;</span><br><span class="line">        collection.count(<span class="function"><span class="keyword">function</span>(<span class="params">err, count</span>) </span>&#123;</span><br><span class="line">            test.assertEquals(<span class="number">1</span>, count); &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Locate all the entries using find</span></span><br><span class="line">            collection.find().toArray(<span class="function"><span class="keyword">function</span>(<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">            test.assertEquals(<span class="number">1</span>, results.length);</span><br><span class="line">            test.assertTrue(results[<span class="number">0</span>].a === <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Let's close the db</span></span><br><span class="line">            client.close();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">client.open(<span class="function"><span class="keyword">function</span>(<span class="params">err, client</span>) </span>&#123;</span><br><span class="line">    client.collection(<span class="string">'test_insert'</span>, test);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€å„ç§åµŒå¥—å›è°ƒæœ‰æœ¨æœ‰ï¼è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå°¤å…¶æ˜¯æˆ‘çš„é‚£ä¸ªæ¡†æ¶ï¼Œå› ä¸ºæˆ‘çš„æ¡†æ¶æ˜¯æµå¼çš„ã€‚</p><p>ã€€ã€€æ‰€ä»¥æˆ‘å°±æƒ³æœ‰è¿™æ ·çš„ä¸€ç§æ–¹æ¡ˆï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> client = mongodb.connect();</span><br><span class="line"><span class="keyword">var</span> collection = mongodb.getCollection(client, <span class="string">"dbname"</span>);</span><br><span class="line"><span class="keyword">var</span> result = mongodb.find(&#123; <span class="string">"foo"</span> : <span class="string">"bar"</span> &#125;);</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä½¿å¾—è¿™æ ·å°±èƒ½æ‰¾å‡ºdbnameè¡¨ä¸‹çš„fooä¸ºbarå€¼çš„è®°å½•äº†ã€‚</p><h2 id="æ­£é¢˜"><a href="#æ­£é¢˜" class="headerlink" title="æ­£é¢˜"></a>æ­£é¢˜</h2><p>ã€€ã€€å‡ºäºè¿™æ ·çš„æƒ³æ³•ï¼Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾éäº†å¤§æ±Ÿå—åŒ—ï¼Œé™¤äº† CNode ç¤¾åŒºæœ‰äººé—®åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ä»¥å¤–ï¼Œå†ä¹Ÿæ‰¾ä¸åˆ°éŸ³ä¿¡äº†ï¼Œè€Œä¸”é‚£é‡Œä¹Ÿæ²¡æœ‰ä¸€ä¸ªå¥½çš„å›ç­”ã€‚</p><p>ã€€ã€€ä¸è¿‡è¿™ä¹Ÿæ­£å¸¸ï¼Œå› ä¸º Node.js å®˜æ–¹æœ¬èº«å°±ä¸æ¨èè¿™ä¹ˆåšâ€”â€”ä»–ä»¬è®¤ä¸ºå¼‚æ­¥éé˜»å¡æ˜¯éå¸¸ä¼˜é›…çš„ä¸€ä»¶äº‹æƒ…ã€‚</p><p>ã€€ã€€åŒ…æ‹¬æˆ‘åœ¨ Node.js çš„ IRC èŠå¤©å®¤é‡Œé¢é—®äº†è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿæœ‰äººæ˜¯è¿™ä¹ˆå›ç­”æˆ‘çš„ï¼š</p><blockquote><p>You canâ€™t use a car as a boat. If you want a boat, use a boat.</p></blockquote><p>ã€€ã€€è¨€ç®€æ„èµ…ï¼Œç›´æˆªäº†å½“åœ°è¯´æ˜ Node.js æ˜¯ä¸æ”¯æŒè¿™æ ·çš„ï¼Œå¦‚æœä½ æƒ³è¿™æ ·åšï¼Œå°±ç”¨ python æˆ–è€… ruby å»å§ã€‚</p><p>ã€€ã€€ä¸è¿‡å¥½åœ¨åæ¥ IRC é‡Œé¢æœ‰äººæ¨èäº†æˆ‘ä¸€ä¸ªæ¨¡å—ï¼š<a href="https://github.com/laverdet/node-fibers" target="_blank" rel="external">fibers</a>ã€‚</p><p>ã€€ã€€æœ‰äº†è¿™ä¸ªæ¨¡å—å¥½å•Šï¼Œç›´æ¥èƒ½ç”¨äº†æœ‰æœ¨æœ‰ï¼</p><p>ã€€ã€€æ¥ä¸‹æ¥å°±æ¥è®²ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨å§ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params">collection, selector, callback</span>) </span>&#123;</span><br><span class="line">    collection.find(selector).toArray(callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Fiber = <span class="built_in">require</span>(<span class="string">'fibers'</span>);</span><br><span class="line"><span class="keyword">var</span> Future = <span class="built_in">require</span>(<span class="string">'fibers/future'</span>);</span><br><span class="line"><span class="keyword">var</span> wait = Future.wait;</span><br><span class="line"></span><br><span class="line">Fiber(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> wrapper = Future.wrap(fund);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** è¿™é‡Œå°±æ˜¯æ­£é¢˜äº†ï¼Œæˆ‘ä»¬å‡è®¾å·²ç»è·å–ä¸€ä¸ªcollectionäº† */</span></span><br><span class="line">    <span class="keyword">var</span> result = wrapper(collection, &#123; <span class="string">"foo"</span> : <span class="string">"bar"</span> &#125;).wait();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">&#125;).run();</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™å°±æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„åŒæ­¥æŸ¥è¯¢ MongoDB çš„ä¾‹å­äº†ï¼Œå®é™…ä¸Šæœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªå¼‚æ­¥ï¼Œæ³¨æ„åˆ°æ²¡æœ‰ï¼Œå…¶å® <code>Fiber()</code> å†…éƒ¨çš„é‚£ä¸ª <code>function</code> æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåªä¸è¿‡åœ¨è¿™ä¸ªå›è°ƒå‡½æ•°é‡Œé¢ï¼Œé‡Œé¢çš„æ‰€æœ‰ <code>callback</code> éƒ½å¯ä»¥è¢«åŒæ­¥äº†ã€‚ä¸è¿‡æˆ‘ä»¬åªéœ€è¦å°åŠ¨ä¸€äº›æ‰‹è„šå°±èƒ½åŠ ä¸Šè¿™ä¸ªå¤–å£³äº†ã€‚å…·ä½“è¯·å‚è§ <a href="https://github.com/XadillaX/SevenzJS/blob/a0a0476000c492dd8e70c062cfa432f559edbd16/sevenz/sRouter.js" target="_blank" rel="external">sRouter.js</a> çº¦ 121 è¡Œçš„å¤–å£³ä»¥åŠ <a href="https://github.com/XadillaX/SevenzJS/blob/a0a0476000c492dd8e70c062cfa432f559edbd16/sevenz/sMongoSync.js" target="_blank" rel="external">sMongoSync.js</a> çš„å®ç°ï¼ŒåŠ ä¸Š <a href="http://web.archive.org/web/20130726042859/https://github.com/XadillaX/SevenzJS/blob/a0a0476000c492dd8e70c062cfa432f559edbd16/actions/index.js" target="_blank" rel="external">index.js</a> ä¸­çš„æŸ¥è¯¢ demoã€‚</p><h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>ã€€ã€€æ‰€ä»¥è¯´å½“æˆ‘ä»¬åšä¸åˆ°æŸä»¶äº‹çš„æ—¶å€™ï¼Œå¤šå»IRCçœ‹çœ‹ï¼Œå¤šå»ç¤¾åŒºæ··æ··ï¼Œä¹Ÿå¤šå»æ‰¾æ‰¾æ¨¡å—ï¼Œè¦çœŸæ²¡æœ‰çš„è¯å°±åªèƒ½è‡ªå·±ä¸°è¡£è¶³é£Ÿäº†ï¼ˆæˆ‘è¿˜æ²¡åˆ°é‚£æ°´å¹³ï¼Œç¬‘ï¼‰ã€‚æ€»ä¹‹è¿™æ¬¡Fiberså¸®äº†æˆ‘ä¸€ä¸ªå¤§å¿™ã€‚</p><p>ã€€ã€€æœ€åï¼ŒSevenzJS æ¬¢è¿ <a href="https://github.com/XadillaX/SevenzJS" target="_blank" rel="external">Fork</a>ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€&lt;strong&gt;&lt;em&gt;æ³¨ï¼šæœ¬æ–‡ä»…ä¸ºæˆ‘åˆå­¦ Node.JS çš„æ—¶å€™çš„ç¨šå«©ç¬”è®°ã€‚æ˜¯ä» &lt;a href=&quot;http://web.archive.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://web.archive.org/&lt;/a&gt; 
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="Node.JS" scheme="https://xcoder.in/tags/Node-JS/"/>
    
      <category term="MongoDB" scheme="https://xcoder.in/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºjQueryä¸­â€œanimate()â€å‡½æ•°å¯¹é¢œè‰²å˜åŒ–çš„æ”¯æŒ</title>
    <link href="https://xcoder.in/2012/12/24/jquery-animate-color-support/"/>
    <id>https://xcoder.in/2012/12/24/jquery-animate-color-support/</id>
    <published>2012-12-24T01:20:16.000Z</published>
    <updated>2017-12-11T07:59:20.508Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€æœ€è¿‘åœ¨åšä¸€ä¸ªæ±½è½¦å›¢è´­ç½‘çš„é¡¹ç›®ï¼Œç”±äºè€å¤§åŠ›æ±‚ç®€æ´ï¼Œæ‰€ä»¥ç•Œé¢åšå¾—æœ‰äº›å°æ¸…æ–°ã€‚ä¸è¿‡å¾—è¯´ä¸€ä¸‹é¡µé¢ä¸æ˜¯æˆ‘è®¾è®¡çš„ï¼Œæ˜¯ä¸€ä½ç¾å·¥åŒå¿—ã€‚</p><p>ã€€ã€€åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥åˆ‡å…¥æ­£é¢˜å§â€”â€”</p><p>ã€€ã€€æˆ‘è¦åšå¾—å°±æ˜¯è®©ä¸‹é¢ä¸€æ®µä»£ç ç”Ÿæ•ˆï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"#yourid"</span>).stop().animate(&#123; <span class="string">"backgroundColor"</span> : <span class="string">"#rrggbb"</span>, <span class="string">"color"</span> : <span class="string">"#rrggbb"</span> &#125;, <span class="string">"fast"</span>);</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä½†æ˜¯ï¼Œå¾ˆé—æ†¾ï¼Œä¸€ç‚¹ä¹Ÿæ²¡æœ‰åŠ¨ã€‚æœ¬æ¥æ•ˆæœåº”è¯¥è·Ÿè¿™ä¸ªç‰ˆæœ¬çš„xcoderåšå®¢çš„å¤©å¤´å¯¼èˆªæ¡ä¸€æ ·æœ‰ä¸ªåŠ¨æ€æ•ˆæœï¼ˆåªä¸è¿‡xcoderçš„å¯¼èˆªæ¡æ˜¯é€æ˜åº¦å˜åŒ–ï¼Œè€Œé¡¹ç›®ä¸­æˆ‘æƒ³è®©å®ƒèƒŒæ™¯è‰²å˜åŒ–ï¼‰ã€‚</p><p>ã€€ã€€åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ­»æœˆä¸Šç½‘æŸ¥äº†å¾ˆä¹…ï¼Œæ‰¾åˆ°çš„ä¸œè¥¿éƒ½å¾ˆç®€å•åœ°è¯´æ˜äº†ä¸€ä¸‹ï¼Œè²Œä¼¼éƒ½å¯ä»¥ã€‚å˜›ï¼Œä¹Ÿè®¸æ˜¯jQueryæ–°ç‰ˆæœ¬ä¸æ”¯æŒè¿™ä¸ªç‰¹æ€§äº†å§ã€‚</p><p>ã€€ã€€æœ€åï¼Œæ­»æœˆåœ¨jQueryçš„å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°äº†ä¸‹é¢è¿™æ®µè¯â€”â€”</p><blockquote><p>All animated properties should be animated to <strong><em>a single numeric value</em></strong>, except as noted below; most properties that are non-numeric cannot be animated using basic jQuery functionality (For example, width, height, or left can be animated but background-color cannot be, unless the <a href="https://github.com/jquery/jquery-color" target="_blank" rel="external">jQuery.Color()</a> plugin is used). Property values are treated as a number of pixels unless otherwise specified. The units em and % can be specified where applicable.</p><p style="text-align: right">â€”â€” <a href="http://api.jquery.com/animate/" target="_blank" rel="external">jQueryå®˜æ–¹æ–‡æ¡£ .animate()</a></p></blockquote><p>ã€€ã€€å¤§è‡´çš„æ„æ€å°±æ˜¯è¯´æ‰€æœ‰åŠ¨ç”»å±æ€§éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå•æ•°å­—å€¼ï¼Œæ‰€ä»¥è¯´å¤§å¤šæ•°éæ•°å­—çš„å±æ€§æ˜¯ä¸èƒ½è¢«åŠ¨ç”»åŒ–çš„ã€‚ä¾‹å¦‚é«˜åº¦ã€å®½åº¦ç­‰å¯ä»¥è¢«åŠ¨ç”»åŒ–ï¼Œä½†æ˜¯èƒŒæ™¯è‰²å°±ä¸ä¿¡äº†ã€‚<span style="color: red;"><strong><em>é™¤éä½ ç”¨äº†jQuery.Color()æ’ä»¶</em></strong></span>ã€‚</p><p>ã€€ã€€æ‰€ä»¥è¯´é—®é¢˜æ‰¾åˆ°äº†ï¼Œæˆ‘ä»¬å¿…é¡»å¾—ç”¨ä¸€ä¸ªjQuery.Color()æ’ä»¶æ¥å¯¹ä¸€äº›é¢œè‰²è¿›è¡ŒåŠ¨ç”»æ“ä½œã€‚</p><p>ã€€ã€€è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å»ä¸‹ä¸€ä¸ªjQuery.Color()æ’ä»¶ã€‚æŠŠå®ƒåŠ åœ¨æˆ‘ä»¬çš„é¡µé¢ä¸­ï¼Œç„¶åå°±å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼æ¥è¿›è¡ŒåŠ¨ç”»æ“ä½œäº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="keyword">this</span>).stop().animate(&#123;</span><br><span class="line">    <span class="string">"backgroundColor"</span> : jQuery.Color(<span class="string">"rrggbb"</span>),</span><br><span class="line">    <span class="string">"color"</span> : jQuery.Color(<span class="string">"rrggbb"</span>)</span><br><span class="line">&#125;, <span class="string">"fast"</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€æœ€è¿‘åœ¨åšä¸€ä¸ªæ±½è½¦å›¢è´­ç½‘çš„é¡¹ç›®ï¼Œç”±äºè€å¤§åŠ›æ±‚ç®€æ´ï¼Œæ‰€ä»¥ç•Œé¢åšå¾—æœ‰äº›å°æ¸…æ–°ã€‚ä¸è¿‡å¾—è¯´ä¸€ä¸‹é¡µé¢ä¸æ˜¯æˆ‘è®¾è®¡çš„ï¼Œæ˜¯ä¸€ä½ç¾å·¥åŒå¿—ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥åˆ‡å…¥æ­£é¢˜å§â€”â€”&lt;/p&gt;
&lt;p&gt;ã€€ã€€æˆ‘è¦åšå¾—å°±æ˜¯è®©ä¸‹é¢ä¸€æ®µä»£ç ç”Ÿæ•ˆï¼š&lt;/p&gt;
&lt;figure class=&quot;highl
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="Javascript" scheme="https://xcoder.in/tags/Javascript/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="jQuery" scheme="https://xcoder.in/tags/jQuery/"/>
    
  </entry>
  
  <entry>
    <title>çº¿ç¨‹å®‰å…¨â€”â€”Scope Lockæ¨¡å¼</title>
    <link href="https://xcoder.in/2012/09/08/scope-lock/"/>
    <id>https://xcoder.in/2012/09/08/scope-lock/</id>
    <published>2012-09-07T17:31:59.000Z</published>
    <updated>2017-12-11T07:59:20.542Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€<strong><em>å˜›ï¼Œæœ¬æ–‡æ˜¯å»ºç«‹åœ¨M$çš„Visual StudioåŸºç¡€ä¸Šçš„ï¼Œlinuxâ˜­å‹¿å–·ã€‚</em></strong></p><p>ã€€ã€€æˆ‘æœ€å…ˆç”¨åˆ° ScopeLock æ¨¡å¼æ˜¯åœ¨è‡ªå·±å¼€å‘ <strong>XAEå¼•æ“</strong> çš„æ—¶å€™ã€‚åœ¨é‡Œé¢ç”¨åˆ°æŒºå¤šçš„çº¿ç¨‹å‡½æ•°ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³ä¸´ç•ŒåŒºå°±æˆäº†ä¸€ä¸ªé‡è¦çš„è¯¾é¢˜ã€‚å¯èƒ½å¤§å®¶æƒ³ï¼Œä¸å°±ä¸€ä¸ªçº¿ç¨‹é”ä¸´ç•ŒåŒºä»€ä¹ˆçš„ä¹ˆï¼Œä¸€ä¸ª <code>EnterCriticalSection</code> å’Œä¸€ä¸ª <code>LeaveCriticalSection</code> ä¸å°±è§£å†³äº†ä¹ˆï¼Ÿ</p><p>ã€€ã€€å…¶å®ä¸ç„¶ã€‚åœ¨ <strong>M$</strong> ä¸­ï¼Œæœ€å¸¸ç”¨çš„å½“ç„¶å°±æ˜¯ <code>CRITICAL_SECTION</code> äº†ï¼Œä½†æ˜¯å¦‚æœä¸´ç•ŒåŒºä¸Šé”å´æœ¨æœ‰è§£é”å‘¢ï¼Ÿè¿™å°±ä¼šå‘ç”Ÿæ­»é”ç°è±¡ã€‚å¯¹äºä¸€ä¸ªç²—å¿ƒçš„ç¨‹åºçŒ¿æ¥è¯´è¿™æ ·çš„é”™è¯¯è¿˜æ˜¯æœ‰æœºç‡å‘ç”Ÿçš„ã€‚å°±ç®—ä½ è¶³å¤Ÿç»†å¿ƒï¼Œè¿˜æ˜¯æœ‰æ—¶å€™ä¼šä¸€å¤±è¶³æˆåƒå¤æ¨ã€‚</p><p>ã€€ã€€æ‰€ä»¥å°±æœ‰äº†è¿™ä¹ˆä¸€ç§æ–¹æ³•æ¥æœç»è¿™ç§æ­»é”çš„äº§ç”Ÿâ€”â€” <code>ScopeLock</code>ã€‚</p><p>ã€€ã€€é‚£ä¹ˆä»€ä¹ˆå« <code>ScopeLock</code>ï¼Ÿ</p><p>ã€€ã€€æˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹å¦‚æœæœ‰è¿™ä¹ˆä¸€ä¸ªç±»â€”â€”åœ¨æ„é€ çš„æ—¶å€™ï¼Œä½ ä¼ è¿›å»ä¸€ä¸ª <code>CRITICAL_SECTION</code> çš„å¼•ç”¨å¹¶ä¸”å°†å…¶ <code>EnterCriticalSection</code> è¿›å…¥åˆ°ä¸´ç•ŒåŒºã€‚å½“å®ƒææ„çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥ <code>LeaveCriticalSection</code> å°±å¥½äº†ã€‚</p><p>ã€€ã€€ä¹Ÿè®¸ä½ ä¼šé—®ï¼Œè¿™æ ·çš„ä¸€ä¸ªç±»ä¼šæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>ã€€ã€€é‚£ä¹ˆæˆ‘ä¸‹é¢æ¼”ç¤ºä¸€æ®µç®€å•çš„ ScopeLock ä»£ç å…ˆå§ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ScopeLock</span></span><br><span class="line">&#123;</span></span><br><span class="line">    CRITICAL_SECTION&amp; m_cs;</span><br><span class="line"></span><br><span class="line">    ScopeLock(CRITICAL_SECTION cs) : m_cs(cs)</span><br><span class="line">    &#123;</span><br><span class="line">        EnterCriticalSection(&amp;m_cs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~ScopeLock()</span><br><span class="line">    &#123;</span><br><span class="line">        LeaveCriticalSection(&amp;m_cs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line">CRITICAL_SECTION cs;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...å‡è®¾æˆ‘ä»¬å·²ç»åˆå§‹åŒ–å¥½äº†è¿™ä¸ªä¸´ç•ŒåŒº</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ScopeLockTest</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="function">ScopeLock <span class="title">oLock</span><span class="params">(cs)</span></span>;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬åˆšè¿›å…¥ <code>ScopeLockTest</code> å‡½æ•°çš„æ—¶å€™ï¼Œå£°æ˜äº†ä¸€ä¸ª <code>oLock</code> å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™è¿è¡Œ <code>oLock</code> çš„æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¿›å…¥äº† <code>cs</code> è¿™ä¸ªä¸´ç•ŒåŒºã€‚è€Œå½“ <code>ScopeLockTest</code> å‡½æ•°è¿è¡Œå®Œæ¯•è¦é€€å‡ºè¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œ<code>oLock</code> å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå°±èµ°åˆ°äº†å°½å¤´ï¼Œå¯¹åº”çš„ï¼Œå®ƒå°†ä¼šæ‰§è¡Œææ„å‡½æ•°ï¼Œé‚£ä¹ˆå°±è‡ªç„¶è€Œç„¶åœ°é€€å‡ºäº† <code>cs</code> ä¸´ç•ŒåŒºã€‚</p><p>ã€€ã€€å…¶å®æ— è®º <code>ScopeLockTest</code> è¿™ä¸ªå‡½æ•°æ€ä¹ˆå†™ï¼Œå“ªæ€•æ˜¯ä¸­é—´æœ‰ä¸€äº› <code>if</code> åˆ¤æ–­ç›´æ¥ <code>return</code> æ‰ï¼Œåªè¦æ˜¯ <code>ScopeLockTest</code> è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œ<code>oLock</code> å°±ä¼šè‡ªåŠ¨ææ„ï¼Œä»è€Œè¾¾åˆ°äº†è§£é”è¿‡ç¨‹ã€‚é‚£ä¹ˆä¸ç®¡ç²—å¿ƒè¿˜æ˜¯ç»†å¿ƒçš„ç«¥é‹ä»¬éƒ½ä¸ç”¨ä¸ºå¿˜è®°é€€å‡ºä¸´ç•ŒåŒºè€Œçƒ¦æ¼äº†ã€‚</p><p>ã€€ã€€è€Œä¸” <code>ScopeLock</code> æ¨¡å¼åªæ˜¯ä¸€ç§æ€æƒ³ï¼Œå¹¶ä¸æ˜¯å¯¹äº <strong>M$</strong> çš„ä¸´ç•ŒåŒºçš„ä¸€ç§ä¸“ç”¨æ€§ç‰©å“ã€‚ä¾‹å¦‚åœ¨QTé‡Œï¼Œæˆ‘ä»¬ä¸€æ ·å¯ä»¥ç”¨ <code>ScopeLock</code> æ¥å¯¹çº¿ç¨‹çš„ä¸€äº› <code>MutexLock</code> ä¹‹ç±»çš„ä¸œè¥¿è¿›è¡Œæ“ä½œã€‚</p><p>ã€€ã€€ä¸Šé¢æ‰€å†™çš„ä¾‹å­åªæ˜¯æ€è·¯çš„ä¸€ç§å½¢æˆï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ScopeLockç±»ï¼ˆç»“æ„ä½“ï¼‰ï¼Œè™½ç„¶è¯´å®ƒç°åœ¨å·²ç»å¯ä»¥ç”¨äº†ã€‚ä½ å¯ä»¥åœ¨ä¸Šé¢å®Œå–„ï¼ŒåŠ ä¸Šè‡ªå·±çš„ä¸œè¥¿ï¼Œä½¿å…¶èƒ½ç¡®ç¡®å®å®åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚ç”±äºä»£ç çš„å…³è”æ€§ï¼Œæˆ‘å•å•å‘å‡ºæˆ‘çš„ <code>ScopeLock</code> çš„è¯ä¼šç¼ºå°‘å¾ˆå¤šå…³è”çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å’±å°±ä¸å‘äº†ï¼Œæ€è·¯åœ¨è¿™é‡Œï¼Œç›¸ä¿¡è°éƒ½èƒ½å†™å‡ºè‡ªå·±çš„ä¸€ä¸ª <code>ScopeLock</code> å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€&lt;strong&gt;&lt;em&gt;å˜›ï¼Œæœ¬æ–‡æ˜¯å»ºç«‹åœ¨M$çš„Visual StudioåŸºç¡€ä¸Šçš„ï¼Œlinuxâ˜­å‹¿å–·ã€‚&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€æˆ‘æœ€å…ˆç”¨åˆ° ScopeLock æ¨¡å¼æ˜¯åœ¨è‡ªå·±å¼€å‘ &lt;strong&gt;XAEå¼•æ“&lt;/strong&gt; çš„æ—¶å€™ã€‚åœ¨é‡Œé¢ç”¨åˆ°æŒºå¤šçš„çº¿
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="ScopeLock" scheme="https://xcoder.in/tags/ScopeLock/"/>
    
      <category term="çº¿ç¨‹å®‰å…¨" scheme="https://xcoder.in/tags/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/"/>
    
      <category term="çº¿ç¨‹æ­»é”" scheme="https://xcoder.in/tags/%E7%BA%BF%E7%A8%8B%E6%AD%BB%E9%94%81/"/>
    
  </entry>
  
  <entry>
    <title>CodeForces Round 128 DIV2</title>
    <link href="https://xcoder.in/2012/07/04/codeforces-128-div2/"/>
    <id>https://xcoder.in/2012/07/04/codeforces-128-div2/</id>
    <published>2012-07-04T03:38:59.000Z</published>
    <updated>2017-12-11T07:59:20.466Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€è¿™æ¬¡ç©è„±äº†ã€‚å¥½ä¸å®¹æ˜“å››é¢˜éƒ½åšå‡ºæ¥ï¼Œå´å› ä¸ºå°ç»†èŠ‚æŒ‚äº†ä¸¤é¢˜ã€‚</p><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><h3 id="Two-Problems"><a href="#Two-Problems" class="headerlink" title="Two Problems"></a>Two Problems</h3><p>ã€€ã€€é¢˜æ„å°±æ˜¯è¯´ï¼ŒCFæœ‰ä¸¤é¢˜ï¼Œæ¯é¢˜åˆå§‹åˆ†Aå’ŒBï¼Œç„¶åæ¯é¢˜åœ¨æ¯åˆ†é’Ÿä¼šæ‰£DAå’ŒDBåˆ†ã€‚ç»™ä½ æ¯”èµ›æ€»æ—¶é—´Tï¼Œé—®ä½ æŸä¸ªäººå¯ä¸å¯èƒ½æ‹¿åˆ°Xåˆ†ã€‚ï¼ˆæ³¨æ„å¯èƒ½åšå‡ºä¸€é¢˜ã€ä¸¤é¢˜æˆ–è€…ä¸€é¢˜ä¹Ÿæ²¡åšå‡ºï¼‰</p><p>ã€€ã€€(0â€‰â‰¤â€‰xâ€‰â‰¤â€‰600; 1â€‰â‰¤â€‰t,â€‰a,â€‰b,â€‰da,â€‰dbâ€‰â‰¤â€‰300ä¸”ä¿è¯åŠæ—¶æ¯”èµ›æ—¶é—´åˆ°äº†å„é¢˜çš„åˆ†æ•°ä¹Ÿä¸ä¼šå°äº0)</p><h3 id="Game-on-Paper"><a href="#Game-on-Paper" class="headerlink" title="Game on Paper"></a>Game on Paper</h3><p>ã€€ã€€æœ‰ä¸€ä¸ª N<em>N æ–¹æ ¼çº¸ã€‚åœ¨ä¸Šé¢çš„æ–¹æ ¼é‡Œä¸€æ ¼æ ¼æ¶‚é»‘ã€‚æ¯ä¸€æ­¥æ¶‚ä¸€æ ¼ä¸€å…±æ¶‚ m æ¬¡ï¼Œç»™å®š xi å’Œ yiã€‚é—®æœ€å°‘æ¶‚å‡ æ­¥æ–¹æ ¼çº¸é‡Œä¼šå‡ºç°ä¸€ä¸ª 3</em>3 çš„æ­£æ–¹å½¢ã€‚</p><p>ã€€ã€€(1â€‰â‰¤â€‰nâ€‰â‰¤â€‰1000, 1â€‰â‰¤â€‰mâ€‰â‰¤â€‰min(nÂ· n,â€‰105))</p><h3 id="Photographer"><a href="#Photographer" class="headerlink" title="Photographer"></a>Photographer</h3><p>ã€€ã€€ç…§ç›¸å†…å­˜å¡é‡Œæœ‰då®¹é‡ã€‚å…¶ä¸­é«˜è´¨é‡ç…§ç‰‡å aå®¹é‡ã€ä½è´¨é‡å bå®¹é‡ã€‚ç„¶åæœ‰nä¸ªé¡¾å®¢ï¼Œæ¯ä¸ªé¡¾å®¢éœ€è¦xiå¼ é«˜è´¨é‡ç…§ç‰‡å’Œyiå¼ ä½è´¨é‡ç…§ç‰‡ã€‚æ‘„å½±å¸ˆå¦‚æœç»™ä¸€ä¸ªäººæ‹ç…§äº†ï¼Œå°±åº”è¯¥æ»¡è¶³ä»–æ‰€æœ‰è¦æ±‚ï¼ˆå³ç»™xiå¼ é«˜è´¨é‡ç…§ç‰‡å’Œyiå¼ ä½è´¨é‡ç…§ç‰‡ï¼‰ã€‚é—®æ‘„å½±å¸ˆæœ€å¤šèƒ½ç»™å‡ ä¸ªäººæ‹ç…§ã€‚</p><p>ã€€ã€€(1â€‰â‰¤â€‰nâ€‰â‰¤â€‰105,â€‰1â€‰â‰¤â€‰dâ€‰â‰¤â€‰109, 1â€‰â‰¤â€‰aâ€‰â‰¤â€‰bâ€‰â‰¤â€‰104, 0â€‰â‰¤â€‰xi,â€‰yiâ€‰â‰¤â€‰105)</p><h3 id="Hit-Ball"><a href="#Hit-Ball" class="headerlink" title="Hit Ball"></a>Hit Ball</h3><p>ã€€ã€€å°é—­æˆ¿é—´é‡Œï¼Œä»æˆ¿é—´çš„ä¸€å¤´æœ€åº•ä¸‹çš„ä¸­é—´ä»¥æŸä¸ªæ–¹å‘è¸¢çƒï¼ˆä¸€å®šæ˜¯ç½‘å¯¹é¢è¸¢ï¼‰ï¼Œé—®è¸¢åˆ°å¦ä¸€å¤´çš„å¢™ä¸Šçš„æ—¶å€™ï¼Œxã€zå„æ˜¯å¤šå°‘ã€‚</p><p>ã€€ã€€(å„åº§æ ‡ä»¥åŠå‘é‡éƒ½æ˜¯å°äºç­‰äº100çš„æ­£æ•´æ•°)</p><p><img src="hit-ball.png" alt="Hit Ball"></p><h3 id="Transportation"><a href="#Transportation" class="headerlink" title="Transportation"></a>Transportation</h3><p>ã€€ã€€è¿˜æ²¡çœ‹ã€‚</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Two-Problems-1"><a href="#Two-Problems-1" class="headerlink" title="Two Problems"></a>Two Problems</h3><p>ã€€ã€€è¿™é¢˜åªè¦æ³¨æ„å‡ ä¸ªtrickå°±è¡Œäº†ï¼šå¯ä»¥åšå‡º0é¢˜ã€1é¢˜æˆ–è€…2é¢˜ã€‚ç›´æ¥ä¸¤ä¸ªforæšä¸¾å„é¢˜åœ¨å‡ åˆ†é’Ÿå†…åšå‡ºæ¥ï¼Œç„¶ååšä¸€ä¸‹0é¢˜ã€1é¢˜çš„ç‰¹æ®Šåˆ¤æ–­å°±å¥½äº†ã€‚</p><h3 id="Game-on-Paper-1"><a href="#Game-on-Paper-1" class="headerlink" title="Game on Paper"></a>Game on Paper</h3><p>ã€€ã€€åœ¨æ¯æ¬¡æ¶‚çš„æ—¶å€™ï¼Œä»¥å½“å‰æ¶‚çš„ç‚¹ä½ä¸­å¿ƒï¼Œè®¾å®ƒä¸ºä¹å®«æ ¼çš„å…¶ä¸­ä¸€ä¸ªä½ç½®ï¼ˆä¸€å…±ä¹ç§ä½ç½®ï¼‰ï¼Œå¯¹äºæ¯ç§ä½ç½®ï¼Œéƒ½åˆ¤æ–­å…¶å¯¹åº”çš„ä¹å®«æ ¼æ˜¯ä¸æ˜¯ 3*3 çš„é»‘è‰²å°±å¥½äº†ã€‚(æˆ‘åšçš„æ—¶å€™åœ¨è®¾ä½ç½®çš„æ—¶å€™ x - 1, y - 1 æ‰‹è´±æ•²æˆäº† x - 1, y - 2ï¼Œlock ä¹‹åæ‰å‘ç°ã€‚æ‚²å‰§)</p><h3 id="Photographer-1"><a href="#Photographer-1" class="headerlink" title="Photographer"></a>Photographer</h3><p>ã€€ã€€è´ªå¿ƒã€‚å¯¹äºæ¯ä¸ªäººå°†å…¶æ‰€éœ€çš„æ€»å®¹é‡ç®—å‡ºæ¥å†è¿›è¡Œé€’å¢æ’åºã€‚æœ€åæ±‚çš„æ—¶å€™æ¨èç´¯å‡çš„æ–¹å¼åˆ¤æ–­ï¼Œå› ä¸ºæˆ‘ç´¯åŠ ç„¶åç”¨ int æœ€åçˆ†èŒƒå›´äº†ã€‚</p><h3 id="Hit-Ball-1"><a href="#Hit-Ball-1" class="headerlink" title="Hit Ball"></a>Hit Ball</h3><p>ã€€ã€€é¦–å…ˆæ‹¿å‡ºç©ºé—´å‡ ä½•çš„çº¿é¢ç›¸äº¤æ¨¡æ¿ã€‚ç„¶åæ¥ä¸€ä¸ª <code>while</code>ï¼Œæ¯æ¬¡å¾ªç¯çš„æ—¶å€™åˆ¤æ–­å½“å‰æ‰€åœ¨çš„ç‚¹ä¸æ–¹å‘é€‚é‡å½¢æˆçš„ç›´çº¿ä¸ (X, 0, Z) é¢çš„äº¤ç‚¹åœ¨ä¸åœ¨ç»ˆç‚¹å¢™å£å¤§å°çš„èŒƒå›´å†…ã€‚è‹¥ä¸æ˜¯åˆ™è¯´æ˜ä¸­é€”æ’å¢™äº†åˆ¤æ–­æ–¹å‘å‘é‡ï¼šx &lt; 0åˆ™çº¿é¢ç›¸äº¤åˆ¤æ–­æ˜¯ä¸æ˜¯æ’å·¦å¢™ï¼Œè‹¥æ˜¯åˆ™ x æ­£è´Ÿå€¼å˜ä¸€ä¸‹ï¼›x &gt; 0 åˆ™çº¿é¢ç›¸äº¤åˆ¤æ–­æ˜¯ä¸æ˜¯æ’å³å¢™ï¼Œè‹¥æ˜¯åˆ™ x æ­£è´Ÿå€¼å˜ä¸€ä¸‹ã€‚z &lt; 0åˆ™åˆ¤æ–­æ˜¯ä¸æ˜¯ä»¥æ±‚æŠ¢åœ°ï¼Œè‹¥æ˜¯åˆ™ z æ­£è´Ÿå˜ä¸€ä¸‹ã€‚æœ€å z &gt; 0 åˆ™åˆ¤æ–­æ˜¯ä¸æ˜¯æ’å¤©èŠ±æ¿ï¼Œè‹¥æ˜¯åˆ™zæ­£è´Ÿå€¼å˜ä¸€ä¸‹ã€‚ç„¶åä»¥çƒæ’å‡»çš„ç‚¹ä¸ºæ–°çš„èµ·ç‚¹ï¼Œä¸æ–°çš„æ–¹å‘å‘é‡å½¢æˆæ–°çš„ç›´çº¿ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚å› ä¸ºæˆ¿é—´å¤§å°æœ€å¤§æ˜¯ 100 <em> 100 </em> 100ï¼Œè€Œæ–¹å‘å‘é‡å„æ–¹å‘æ˜¯ 1 åˆ° 100 çš„æ•´æ•°ï¼Œä¸æ˜¯å°æ•°ï¼Œåˆ™æ’å‡»æ¬¡æ•°ä¸ä¼šå¾ˆå¤šï¼Œç›´æ¥ <code>while</code> æ’å‡»ä¹Ÿä¸ä¼šè¶…ã€‚</p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><h3 id="Two-Problems-2"><a href="#Two-Problems-2" class="headerlink" title="Two Problems"></a>Two Problems</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, t, a, b, da, db;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d%d%d"</span>, &amp;x, &amp;t, &amp;a, &amp;b, &amp;da, &amp;db))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; t; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(x == a - i * da)</span><br><span class="line">            &#123;</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; t; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(x == b - j * db)</span><br><span class="line">                &#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(x == a - i * da + b - j * db)</span><br><span class="line">                &#123;</span><br><span class="line">                    flag = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(flag) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0</span> == x) flag = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, flag ? <span class="string">"YES"</span> : <span class="string">"NO"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Game-on-Paper-2"><a href="#Game-on-Paper-2" class="headerlink" title="Game on Paper"></a>Game on Paper</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> mat[<span class="number">1015</span>][<span class="number">1015</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check2</span><span class="params">(<span class="keyword">int</span> sx, <span class="keyword">int</span> sy)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//if(i == 1 &amp;&amp; j == 1) continue;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!mat[sx + i][sy + j]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(check2(x, y)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x, y - <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x, y - <span class="number">2</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">1</span>, y)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">1</span>, y - <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">1</span>, y - <span class="number">2</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">2</span>, y)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">2</span>, y - <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(check2(x - <span class="number">2</span>, y - <span class="number">2</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="keyword">int</span> x, y;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(mat, <span class="number">0</span>, <span class="keyword">sizeof</span>(mat));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">            mat[x + <span class="number">1</span>][y + <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(ans == <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(check(x + <span class="number">1</span>, y + <span class="number">1</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    ans = i + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Photographer-2"><a href="#Photographer-2" class="headerlink" title="Photographer"></a>Photographer</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">client</span></span><br><span class="line">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">int</span> memo;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(client a, client b)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.memo &lt; b.memo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">client c[<span class="number">100005</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    __int64 d;</span><br><span class="line">    <span class="keyword">int</span> a, b;</span><br><span class="line">    <span class="keyword">int</span> x, y;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d%I64d"</span>, &amp;n, &amp;d))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;a, &amp;b);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">            c[i].id = i + <span class="number">1</span>;</span><br><span class="line">            c[i].memo = a * x + b * y;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sort(c, c + n, cmp);</span><br><span class="line">        __int64 sum = <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">int</span> maxi = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(sum + c[i].memo &lt;= d) sum += c[i].memo, maxi = i;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, maxi + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= maxi; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, c[i].id, i == maxi ? <span class="string">'\n'</span> : <span class="string">' '</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Hit-Ball-2"><a href="#Hit-Ball-2" class="headerlink" title="Hit Ball"></a>Hit Ball</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> eps 1e-8</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> zero(x) (((x)&gt;0?(x):-(x))&lt;eps)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point3</span>&#123;</span><span class="keyword">double</span> x,y,z;&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">line3</span>&#123;</span>point3 a,b;&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">plane3</span>&#123;</span>point3 a,b,c;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">point3 <span class="title">xmult</span><span class="params">(point3 u,point3 v)</span></span>&#123;</span><br><span class="line">    point3 ret;</span><br><span class="line">    ret.x=u.y*v.z-v.y*u.z;</span><br><span class="line">    ret.y=u.z*v.x-u.x*v.z;</span><br><span class="line">    ret.z=u.x*v.y-u.y*v.x;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">point3 <span class="title">subt</span><span class="params">(point3 u,point3 v)</span></span>&#123;</span><br><span class="line">    point3 ret;</span><br><span class="line">    ret.x=u.x-v.x;</span><br><span class="line">    ret.y=u.y-v.y;</span><br><span class="line">    ret.z=u.z-v.z;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">point3 <span class="title">pvec</span><span class="params">(plane3 s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> xmult(subt(s.a,s.b),subt(s.b,s.c));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">point3 <span class="title">intersection</span><span class="params">(line3 l,plane3 s)</span></span>&#123;</span><br><span class="line">    point3 ret=pvec(s);</span><br><span class="line">    <span class="keyword">double</span> t=(ret.x*(s.a.x-l.a.x)+ret.y*(s.a.y-l.a.y)+ret.z*(s.a.z-l.a.z))/</span><br><span class="line">        (ret.x*(l.b.x-l.a.x)+ret.y*(l.b.y-l.a.y)+ret.z*(l.b.z-l.a.z));</span><br><span class="line">    ret.x=l.a.x+(l.b.x-l.a.x)*t;</span><br><span class="line">    ret.y=l.a.y+(l.b.y-l.a.y)*t;</span><br><span class="line">    ret.z=l.a.z+(l.b.z-l.a.z)*t;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a, b, m;</span><br><span class="line">    <span class="keyword">double</span> vx, vy, vz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%lf%lf%lf%lf%lf%lf"</span>, &amp;a, &amp;b, &amp;m, &amp;vx, &amp;vy, &amp;vz))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/** 5 walls */</span></span><br><span class="line">        plane3 door, lw, rw, top, ground;</span><br><span class="line">        door.a.x = <span class="number">0</span>, door.a.y = <span class="number">0</span>, door.a.z = <span class="number">0</span>;</span><br><span class="line">        door.b.x = <span class="number">1</span>, door.b.y = <span class="number">0</span>, door.b.z = <span class="number">0</span>;</span><br><span class="line">        door.c.x = <span class="number">0</span>, door.c.y = <span class="number">0</span>, door.c.z = <span class="number">1</span>;</span><br><span class="line">        lw.a.x = <span class="number">0</span>, lw.a.y = <span class="number">0</span>, lw.a.z = <span class="number">0</span>;</span><br><span class="line">        lw.b.x = <span class="number">0</span>, lw.b.y = <span class="number">1</span>, lw.b.z = <span class="number">0</span>;</span><br><span class="line">        lw.c.x = <span class="number">0</span>, lw.c.y = <span class="number">0</span>, lw.c.z = <span class="number">1</span>;</span><br><span class="line">        rw.a.x = a, rw.a.y = <span class="number">0</span>, rw.a.z = <span class="number">0</span>;</span><br><span class="line">        rw.b.x = a, rw.b.y = <span class="number">1</span>, rw.b.z = <span class="number">0</span>;</span><br><span class="line">        rw.c.x = a, rw.c.y = <span class="number">0</span>, rw.c.z = <span class="number">1</span>;</span><br><span class="line">        ground.a.x = <span class="number">0</span>, ground.a.y = <span class="number">0</span>, ground.a.z = <span class="number">0</span>;</span><br><span class="line">        ground.b.x = a, ground.b.y = <span class="number">0</span>, ground.b.z = <span class="number">0</span>;</span><br><span class="line">        ground.c.x = a / <span class="number">2</span>, ground.c.y = m, ground.c.z = <span class="number">0</span>;</span><br><span class="line">        top.a.x = <span class="number">0</span>, top.a.y = <span class="number">0</span>, top.a.z = b;</span><br><span class="line">        top.b.x = a, top.b.y = <span class="number">0</span>, top.b.z = b;</span><br><span class="line">        top.c.x = a / <span class="number">2</span>, top.c.y = m, top.c.z = b;</span><br><span class="line"></span><br><span class="line">        line3 l;</span><br><span class="line"></span><br><span class="line">        l.a.x = a / <span class="number">2</span>;</span><br><span class="line">        l.a.y = m;</span><br><span class="line">        l.a.z = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        l.b.x = (a / <span class="number">2</span>) + vx;</span><br><span class="line">        l.b.y = m + vy;</span><br><span class="line">        l.b.z = vz;</span><br><span class="line"></span><br><span class="line">        point3 v;</span><br><span class="line">        v.x = vx, v.y = vy, v.z = vz;</span><br><span class="line"></span><br><span class="line">        point3 myans;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            point3 ans, ans1, ans2, ans3, ans4;</span><br><span class="line">            <span class="built_in">memset</span>(&amp;ans1, <span class="number">0</span>, <span class="keyword">sizeof</span>(point3));</span><br><span class="line">            <span class="built_in">memset</span>(&amp;ans2, <span class="number">0</span>, <span class="keyword">sizeof</span>(point3));</span><br><span class="line">            <span class="built_in">memset</span>(&amp;ans3, <span class="number">0</span>, <span class="keyword">sizeof</span>(point3));</span><br><span class="line">            <span class="built_in">memset</span>(&amp;ans4, <span class="number">0</span>, <span class="keyword">sizeof</span>(point3));</span><br><span class="line"></span><br><span class="line">            ans = intersection(l, door);</span><br><span class="line">            <span class="keyword">if</span>(ans.x &gt;= <span class="number">0</span> &amp;&amp; ans.z &gt;= <span class="number">0</span> &amp;&amp; ans.x &lt;= a &amp;&amp; ans.z &lt;= b)</span><br><span class="line">            &#123;</span><br><span class="line">                myans = ans;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            point3 totans;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(v.x &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ans1 = intersection(l, lw);</span><br><span class="line">                <span class="keyword">if</span>(ans1.z &gt;= <span class="number">0</span> &amp;&amp; ans1.z &lt;= b)</span><br><span class="line">                &#123;</span><br><span class="line">                    v.x = -v.x;</span><br><span class="line">                    totans = ans1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span>(v.x &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ans2 = intersection(l, rw);</span><br><span class="line">                <span class="keyword">if</span>(ans2.z &gt;= <span class="number">0</span> &amp;&amp; ans2.z &lt;= b)</span><br><span class="line">                &#123;</span><br><span class="line">                    v.x = -v.x;</span><br><span class="line">                    totans = ans2;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(v.z &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ans3 = intersection(l, top);</span><br><span class="line">                <span class="keyword">if</span>(ans3.x &gt;= <span class="number">0</span> &amp;&amp; ans3.x &lt;= a)</span><br><span class="line">                &#123;</span><br><span class="line">                    v.z = -v.z;</span><br><span class="line">                    totans = ans3;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span>(v.z &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ans4 = intersection(l, ground);</span><br><span class="line">                <span class="keyword">if</span>(ans4.x &gt;= <span class="number">0</span> &amp;&amp; ans4.x &lt;= a)</span><br><span class="line">                &#123;</span><br><span class="line">                    v.z = -v.z;</span><br><span class="line">                    totans = ans4;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            l.a = totans;</span><br><span class="line">            l.b = totans;</span><br><span class="line">            l.b.x += v.x;</span><br><span class="line">            l.b.y += v.y;</span><br><span class="line">            l.b.z += v.z;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%.10lf %.10lf\n"</span>, myans.x, myans.z);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€è¿™æ¬¡ç©è„±äº†ã€‚å¥½ä¸å®¹æ˜“å››é¢˜éƒ½åšå‡ºæ¥ï¼Œå´å› ä¸ºå°ç»†èŠ‚æŒ‚äº†ä¸¤é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Description&quot;&gt;&lt;a href=&quot;#Description&quot; class=&quot;headerlink&quot; title=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h2
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="CodeForces" scheme="https://xcoder.in/tags/CodeForces/"/>
    
  </entry>
  
  <entry>
    <title>HGEåšæ ¼æ–—æ¸¸æˆçš„çƒ­ç‚¹å›¾ç‰‡ç¢°æ’æ£€æµ‹æ³•</title>
    <link href="https://xcoder.in/2011/10/18/hge-hotspot-collision/"/>
    <id>https://xcoder.in/2011/10/18/hge-hotspot-collision/</id>
    <published>2011-10-18T07:22:21.000Z</published>
    <updated>2017-12-11T07:59:20.500Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€ç¢°æ’æ£€æµ‹å§‹ç»ˆæ˜¯åš2Dæ¸¸æˆä¸­çš„ä¸€ä¸ªçƒ­ç‚¹è¯é¢˜ï¼Œæˆ‘æœ¬äººå¹¶æ²¡æœ‰åšè¿‡è¿™ç±»æ¸¸æˆï¼Œæ‰€ä»¥ä¸€åˆ‡åªæ˜¯ç†è®ºè€Œå·²ï¼Œä¸è¿‡æ­£æ‰“ç®—åšè¿™ä¹ˆä¸ªå°æ¸¸æˆç»ƒç»ƒæ‰‹ã€‚</p><p>ã€€ã€€å‰å‡ å¤©åœ¨HGEçš„ç¾¤é‡Œçœ‹åˆ°æœ‰äººçªç„¶é—®åˆ°å¦‚ä½•åˆ¤æ–­é¼ æ ‡æœ‰æ²¡æœ‰ç‚¹åˆ°äººï¼ˆç‚¹åˆ°çº¹ç†çš„é€æ˜åŒºåŸŸä¸ç®—ï¼‰ï¼Œä»è€Œå¼•ç”³å‡ºäº†ç¢°æ’æ£€æµ‹é—®é¢˜ã€‚</p><p>ã€€ã€€ä»–çš„é—®é¢˜ç›¸å¯¹å¥½å®ç°ï¼Œåªè¦ç®—å‡ºçº¹ç†æ‰€æŒ‰çš„ç‚¹æ˜¯ä¸æ˜¯é€æ˜å³å¯ã€‚</p><p>ã€€ã€€æ¥ä¸‹æ¥æˆ‘å¾—åšä¸‹ç¢°æ’æ£€æµ‹çš„ç¬”è®°ï¼š</p><p>ã€€ã€€ç¢°æ’æ£€æµ‹æœ€å¸¸ç”¨ä¸€ä¸ªæ–¹æ³•å°±æ˜¯å…³èŠ‚è®¾ç½®ï¼ˆå½“ç„¶æˆ‘å¹¶æ²¡æœ‰åšè¿‡ï¼‰ï¼Œå…³èŠ‚è®¾ç½®çš„è¯å› ä¸ºåªæ˜¯åˆ¤æ–­å¤šè¾¹å½¢çš„é‡å çŠ¶å†µï¼Œç®—æ³•çš„å¤æ‚åº¦ä½ã€æ•ˆç‡é«˜ï¼Œè™½ç„¶åšå·¥æœ‰ç‚¹ç²—ï¼Œä½†æ€»ä½“æ•ˆæœè¿˜æ˜¯æ€§ä»·æ¯”æ¯”è¾ƒé«˜çš„ä¸€ç§æ–¹æ³•ã€‚å½“ç„¶ï¼Œè¿™æ ·çš„æ–¹æ³•éœ€è¦å¯¹æ¯ä¸€å¸§çš„çº¹ç†éƒ½è®¾ç½®ä¸€ä¸ªå…³èŠ‚ï¼Œå¯¹äºäººå·¥çš„ä»£ä»·å°±ç¨å¾®å¤§äº†ä¸€äº›äº†ï¼Œå¹¶ä¸”è¿˜è¦å†™ä¸ªå…³èŠ‚ç¼–è¾‘å™¨å•Šç¥é©¬çš„ï¼Œäºæ˜¯ä¹ä»£ç é‡åˆå¢åŠ äº†ã€‚æˆ‘è¿™æ¬¡æ˜¯å’ŒåŒå¯å®¤æœ¨æœ‰ä¸€ç‚¹åŸºç¡€çš„ç«¥é‹ä¸€èµ·ç»ƒæ‰‹çš„ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰æ‰“ç®—å¼•è¿›è¿™ä¸ªæ–¹æ³•ã€‚</p><p>ã€€ã€€äºæ˜¯æˆ‘å°±ç”¨äº†å¦ä¸€ç§ç¨å¾®â€œéä¸»æµâ€ä¸€äº›çš„æ–¹æ³•äº†â€”â€”é€åƒç´ åˆ¤æ–­ã€‚</p><p>ã€€ã€€ä½†æ˜¯é€åƒç´ åˆ¤æ–­è¿˜æ˜¯æœ‰é—®é¢˜çš„â€”â€”å¦‚æœä½ çš„ä¸€ä¸ªâ€œæ•ˆæœâ€å› ä¸ºâ€œæ¸©åº¦è¿‡é«˜â€è€Œä¸éœ€è¦æ˜¾ç¤ºï¼Œç›´æ¥éšè—ï¼Œä½†åˆç®—ä¼¤å®³ï¼Œè¿™æ—¶çº¹ç†çš„é€åƒç´ å°±å¤±å»äº†æ„ä¹‰ã€‚äºæ˜¯åˆæœ‰äº†ä¸ªâ€œè‡ƒè‚¿â€çš„åŠæ³•ï¼Œä¸ºéœ€è¦â€œé¢å¤–é™„åŠ åƒç´ â€çš„çº¹ç†å¦åšä¸€å¼ å›¾ç‰‡ï¼Œè¿™å¼ å›¾ç‰‡ä¸Šæœ‰ä¸¤ç§åŒºåŸŸâ€”â€”çƒ­ç‚¹åŒºå’Œéçƒ­ç‚¹åŒºã€‚æˆ‘ä»¬æŠŠéœ€è¦â€œå½“åšç©ºæ°”â€çš„é‚£äº›åŒºåŸŸä¸€å¾‹ç”¨æŸä¸€ç§æå…¶ä¸å¸¸ç”¨çš„é¢œè‰²è¦†ç›–ï¼Œå¦‚ <code>ff00ff</code> è¿™ç§å˜æ€çš„ç²‰è‰²ï¼Œç„¶åå…¶å®ƒåŒºåŸŸçš„é¢œè‰²å°±éšä½ æ€ä¹ˆæäº†ã€‚æˆ‘ä»¬è½½å…¥çš„æ—¶å€™ä¸¤å¼ çº¹ç†ä¸€èµ·è½½å…¥ï¼Œæ˜¾ç¤ºçš„æ—¶å€™æ˜¾ç¤ºæ­£å¸¸çš„çº¹ç†ï¼Œè€Œåœ¨ç¢°æ’æ£€æµ‹çš„æ—¶å€™ç”¨â€œçƒ­ç‚¹å›¾ç‰‡â€æ¥è¿›è¡Œé€åƒç´ æ£€æµ‹ã€‚</p><p>ã€€ã€€ä¸ä¸Šé¢çš„å…³èŠ‚è®¾ç½®æ³•æ¯”è¾ƒçš„è¯ï¼Œäººå·¥çš„å·¥ä½œé‡æˆ‘ä¸ªäººè®¤ä¸ºæ˜¯å¤§å¤§åœ°å‡å°‘äº†ï¼Œè‡³äºå¯¹äºæœºå™¨çš„æ‰§è¡Œèƒ½åŠ›æ¥è¯´ï¼ŒæŠŠæ—¶é—´å¤æ‚åº¦æåˆ°äº† <code>O(mn)</code> ï¼Œå¹³æ–¹çº§çš„å¤æ‚åº¦äº†ï¼Œå³çº¹ç†ç›¸äº¤åŒºåŸŸçš„å®½å’Œé«˜ã€‚</p><p>ã€€ã€€æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ç§ç¢°æ’æ£€æµ‹çš„å¤§ä½“æµç¨‹å§ï¼š</p><ol><li>è·å¾—ä¸¤ä¸ªç²¾çµçš„çŸ©å½¢ï¼Œå¹¶å¾—åˆ°ç›¸äº¤çŸ©å½¢ã€‚è‹¥æ— ç›¸äº¤åˆ™ç›´æ¥è¿”å› <code>false</code>ã€‚</li><li>æ ¹æ®ç›¸äº¤çŸ©å½¢ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç²¾çµ1ã€2çš„çº¹ç†ä¸­éœ€è¦æ£€æµ‹çš„åˆå§‹åº§æ ‡ã€‚</li><li>å°†ç²¾çµ1ã€ç²¾çµ2çš„çƒ­ç‚¹å›¾ç‰‡çš„ç›¸äº¤åŒºåŸŸçš„é‚£ä¸€éƒ¨åˆ†åƒç´ æ‹·è´å‡ºæ¥å¤‡ç”¨ã€‚ï¼ˆå› ä¸ºæœ‰å¯èƒ½ä¸¤ä¸ªçº¹ç†å¥æŸ„æ˜¯ä¸€æ ·çš„ï¼Œä¸å¥½åŒæ—¶ <code>lock</code>ï¼‰</li><li>å¼€å§‹å¯¹äºæ‹·è´å‡ºæ¥çš„åƒç´ ä¿¡æ¯é€ä¸€åˆ¤æ–­å¯¹åº”åƒç´ ç‚¹æ˜¯å¦éƒ½â€œä¸æ˜¯ç©ºæ°”â€ï¼Œè‹¥éƒ½â€œä¸æ˜¯ç©ºæ°”â€åˆ™å¯ä»¥åˆ¤æ–­ä¸ºç¢°æ’ã€‚</li></ol><p>ã€€ã€€å½“ç„¶ä»¥ä¸Šçš„æµç¨‹æˆ‘ä»¬è¿˜å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹ï¼Œçœå»æ‹·è´çš„é‚£ä¸€æ®µæ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ <code>hge-&gt;Texture_Lock()</code> æ¥è¿›è¡Œå¾—åˆ°ä¸¤ä¸ªçº¹ç†çš„åƒç´ ä¿¡æ¯çš„é¦–æŒ‡é’ˆï¼Œå¦‚æœä¸¤ä¸ªçº¹ç†å…¶å®åªæ˜¯ä¸€ä¸ªçº¹ç†çš„è¯ï¼Œåˆ™åªéœ€ <code>hge-&gt;Texture_Lock()</code> ä¸€æ¬¡ï¼Œè€Œå¦ä¸€ä¸ªæŒ‡é’ˆä¹Ÿåªæƒ³ <code>hge-&gt;Texture_Lock</code> å³å¯ï¼Œç„¶åç›´æ¥å¼€å§‹åˆ¤æ–­ã€‚</p><p>ã€€ã€€ä¸‹é¢çŒ®ä¸Šæˆ‘è¿™ä¸ªå‡½æ•°çš„å®ç°ä»¥åŠæµ‹è¯•ä»£ç å’Œç´ æï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief   Test the collision by the "hot" texture</span><br><span class="line"> * @author  XadillaX</span><br><span class="line"> * @email   admin@xcoder.in</span><br><span class="line"> * @date    2011/10/18</span><br><span class="line"> * @http://xcoder.in</span><br><span class="line"> *</span><br><span class="line"> * @param spr1 The first sprite to test the collision</span><br><span class="line"> * @param x1 "x" of top-left corner of sprite 1</span><br><span class="line"> * @param y1 "y" of top-left corner of sprite 1</span><br><span class="line"> * @param spr2 The second sprite to test the collision</span><br><span class="line"> * @param x2 "x" of top-left corner of sprite 2</span><br><span class="line"> * @param y2 "y" of top-left corner of sprite 2</span><br><span class="line"> * @param hot1 The "hot" texture for sprite 1. It will be the default texture of spr1 if it equal to 0</span><br><span class="line"> * @param hot2 The "hot" texture for sprite 2. It will be the default texture of spr2 if it equal to 0</span><br><span class="line"> * @param airColor The color which considered of "air"</span><br><span class="line"> *</span><br><span class="line"> * @return if they are collided, return true</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsCollision</span><span class="params">(hgeSprite* spr1, <span class="keyword">float</span> x1, <span class="keyword">float</span> y1, hgeSprite* spr2, <span class="keyword">float</span> x2, <span class="keyword">float</span> y2, HTEXTURE hot1 = <span class="number">0</span>, HTEXTURE hot2 = <span class="number">0</span>, DWORD airColor = <span class="number">0xffff00ff</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** Set the rect */</span></span><br><span class="line">    hgeRect r1, r2;</span><br><span class="line">    r1.Set(x1, y1, x1 + spr1-&gt;GetWidth(), y1 + spr1-&gt;GetHeight());</span><br><span class="line">    r2.Set(x2, y2, x2 + spr2-&gt;GetWidth(), y2 + spr2-&gt;GetHeight());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Test for the intersect of rectangles */</span></span><br><span class="line">    <span class="keyword">if</span>(r1.Intersect(&amp;r2))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> x[] = &#123; x1, x2, x1 + spr1-&gt;GetWidth(), x2 + spr2-&gt;GetWidth() &#125;;</span><br><span class="line">        <span class="keyword">int</span> y[] = &#123; y1, y2, y1 + spr1-&gt;GetHeight(), y2 + spr2-&gt;GetHeight() &#125;;</span><br><span class="line">        <span class="built_in">std</span>::sort(x, x + <span class="number">4</span>);</span><br><span class="line">        <span class="built_in">std</span>::sort(y, y + <span class="number">4</span>);</span><br><span class="line">        hgeRect r;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Set the rectangle area where the two rectangles intersected. */</span></span><br><span class="line">        r.Set(x[<span class="number">1</span>], y[<span class="number">1</span>], x[<span class="number">2</span>], y[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** The start point of sprite1 and sprite2. (From the intersected area) */</span></span><br><span class="line">        <span class="keyword">int</span> sx1, sy1, sx2, sy2;</span><br><span class="line">        sx1 = x[<span class="number">1</span>] - x1;</span><br><span class="line">        sy1 = y[<span class="number">1</span>] - y1;</span><br><span class="line">        sx2 = x[<span class="number">1</span>] - x2;</span><br><span class="line">        sy2 = y[<span class="number">1</span>] - y2;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Get the "hotspot" of texture */</span></span><br><span class="line">        HTEXTURE hTex1 = hot1;</span><br><span class="line">        HTEXTURE hTex2 = hot2;</span><br><span class="line">        <span class="keyword">if</span>(hTex1 == <span class="number">0</span>) hTex1 = spr1-&gt;GetTexture();</span><br><span class="line">        <span class="keyword">if</span>(hTex2 == <span class="number">0</span>) hTex2 = spr2-&gt;GetTexture();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> tx1, ty1, tw1, th1, tx2, ty2, tw2, th2;</span><br><span class="line">        <span class="keyword">int</span> w1 = hge-&gt;Texture_GetWidth(hTex1), w2 = hge-&gt;Texture_GetWidth(hTex2);</span><br><span class="line">        spr1-&gt;GetTextureRect(&amp;tx1, &amp;ty1, &amp;tw1, &amp;th1);</span><br><span class="line">        spr2-&gt;GetTextureRect(&amp;tx2, &amp;ty2, &amp;tw2, &amp;th2);</span><br><span class="line"></span><br><span class="line">        DWORD* color1 = <span class="keyword">new</span> DWORD[(x[<span class="number">2</span>] - x[<span class="number">1</span>]) * (y[<span class="number">2</span>] - y[<span class="number">1</span>])];</span><br><span class="line">        DWORD* color2 = <span class="keyword">new</span> DWORD[(x[<span class="number">2</span>] - x[<span class="number">1</span>]) * (y[<span class="number">2</span>] - y[<span class="number">1</span>])];</span><br><span class="line">        DWORD* color;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Copy the effectivearea of texture 1 */</span></span><br><span class="line">        color = hge-&gt;Texture_Lock(hTex1, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; y[<span class="number">2</span>] - y[<span class="number">1</span>]; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x[<span class="number">2</span>] - x[<span class="number">1</span>]; j++)</span><br><span class="line">            &#123; </span><br><span class="line">                color1[i * (x[<span class="number">2</span>] - x[<span class="number">1</span>]) + j] = color[((<span class="keyword">int</span>)ty1 + sy1) * w1 + (<span class="keyword">int</span>)tx1 + sx1 + i * w1 + j];</span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        hge-&gt;Texture_Unlock(hTex1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Copy the effectivearea of texture 2 */</span></span><br><span class="line">        color = hge-&gt;Texture_Lock(hTex2, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; y[<span class="number">2</span>] - y[<span class="number">1</span>]; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x[<span class="number">2</span>] - x[<span class="number">1</span>]; j++) </span><br><span class="line">            &#123; </span><br><span class="line">                color2[i * (x[<span class="number">2</span>] - x[<span class="number">1</span>]) + j] = color[((<span class="keyword">int</span>)ty2 + sy2) * w2 + (<span class="keyword">int</span>)tx2 + sx2 + i * w1 + j]; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        hge-&gt;Texture_Unlock(hTex2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Test for the collision */</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; y[<span class="number">2</span>] - y[<span class="number">1</span>]; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; x[<span class="number">2</span>] - x[<span class="number">1</span>]; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(color1[i * (x[<span class="number">2</span>] - x[<span class="number">1</span>]) + j] != airColor &amp;&amp; color2[i * (x[<span class="number">2</span>] - x[<span class="number">1</span>]) + j] != airColor)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">delete</span> []color1;</span><br><span class="line">                    <span class="keyword">delete</span> []color2;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span> []color1;</span><br><span class="line">        <span class="keyword">delete</span> []color2;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="src.rar">ç‚¹å‡»ä¸‹è½½</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€ç¢°æ’æ£€æµ‹å§‹ç»ˆæ˜¯åš2Dæ¸¸æˆä¸­çš„ä¸€ä¸ªçƒ­ç‚¹è¯é¢˜ï¼Œæˆ‘æœ¬äººå¹¶æ²¡æœ‰åšè¿‡è¿™ç±»æ¸¸æˆï¼Œæ‰€ä»¥ä¸€åˆ‡åªæ˜¯ç†è®ºè€Œå·²ï¼Œä¸è¿‡æ­£æ‰“ç®—åšè¿™ä¹ˆä¸ªå°æ¸¸æˆç»ƒç»ƒæ‰‹ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å‰å‡ å¤©åœ¨HGEçš„ç¾¤é‡Œçœ‹åˆ°æœ‰äººçªç„¶é—®åˆ°å¦‚ä½•åˆ¤æ–­é¼ æ ‡æœ‰æ²¡æœ‰ç‚¹åˆ°äººï¼ˆç‚¹åˆ°çº¹ç†çš„é€æ˜åŒºåŸŸä¸ç®—ï¼‰ï¼Œä»è€Œå¼•ç”³å‡ºäº†ç¢°æ’æ£€æµ‹é—®é¢˜ã€‚&lt;/p&gt;
&lt;p
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="HGE" scheme="https://xcoder.in/tags/HGE/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºHGEçš„é€æ˜èƒŒæ™¯å¤„ç†</title>
    <link href="https://xcoder.in/2011/09/13/hge-transparent-color/"/>
    <id>https://xcoder.in/2011/09/13/hge-transparent-color/</id>
    <published>2011-09-13T04:12:32.000Z</published>
    <updated>2017-12-11T07:59:20.500Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€å˜› = = åœ¨åšé‚£ä¸ªé¡¹ç›®çš„åŠ¨ç”»é¢„è§ˆå™¨çš„æ—¶å€™ï¼Œå› ä¸ºé‚£å¼•æ“å°è£…å¾—å¤ªéº»çƒ¦äº†ï¼Œäºæ˜¯è‡ªå·±åŸºäºHGEå†ç§»æ¤ä¸€éï¼Œå‘ç°å…¶ä¸­æœ‰ä¸€ä¸ªSetTransparentColorå‡½æ•°ï¼Œå³è®¾ç½®é€æ˜è‰²ã€‚</p><p>ã€€ã€€æ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹å§ã€‚</p><p>ã€€ã€€å…¶å®æ–¹æ³•å¾ˆç®€å•ï¼Œ<code>HTEXTURE</code> æ˜¯çº¹ç†å¥æŸ„ï¼Œå½“ä½ ç”¨ <code>Texture_Lock</code> è¿™ä¸ªå‡½æ•°é”å®šè¿™ä¸ªçº¹ç†çš„æ—¶å€™ï¼Œå®ƒçš„è¿”å›å€¼å°±æ˜¯è¿™ä¸ªçº¹ç†åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´æ¥ä¸‹æ¥çš„ width * height ä¸ªåœ°å€ä¸­å°±æ˜¯è¿™ä¸ªçº¹ç†çš„æ¯ä¸€ä¸ªåƒç´ äº†ã€‚æ—¢ç„¶è¦è®¾ç½®é€æ˜è‰²ï¼Œåªè¦å¯¹äºæ¯ä¸ªåƒç´ åˆ¤æ–­ä¸€ä¸‹ä¸è¿ç®—ä¸€ä¸‹å°±å¥½äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">HTEXTURE <span class="title">SetTransColor</span><span class="params">(HTEXTURE hTex, DWORD dwColor)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** æ³¨ï¼šä¸Šé¢çš„dwColorä»£è¡¨çš„æ˜¯RGBï¼Œä¸æ˜¯ARGB */</span></span><br><span class="line">    <span class="keyword">static</span> HGE* hge = hgeCreate(HGE_VERSION);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size = hge-&gt;Texture_GetWidth(hTex) * hge-&gt;Texture_GetHeight(hTex);</span><br><span class="line">    DWORD* dwTex = hge-&gt;Texture_Lock(hTex);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((dwTex[i] &amp; <span class="number">0x00FFFFFF</span>) == dwColor)</span><br><span class="line">        &#123;</span><br><span class="line">            dwTex[i] &amp;= <span class="number">0x00FFFFFF</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    hge-&gt;Texture_Unlock(hTex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hTex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å˜›ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±é€æ˜äº†~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€å˜› = = åœ¨åšé‚£ä¸ªé¡¹ç›®çš„åŠ¨ç”»é¢„è§ˆå™¨çš„æ—¶å€™ï¼Œå› ä¸ºé‚£å¼•æ“å°è£…å¾—å¤ªéº»çƒ¦äº†ï¼Œäºæ˜¯è‡ªå·±åŸºäºHGEå†ç§»æ¤ä¸€éï¼Œå‘ç°å…¶ä¸­æœ‰ä¸€ä¸ªSetTransparentColorå‡½æ•°ï¼Œå³è®¾ç½®é€æ˜è‰²ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€æ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹å§ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å…¶å®æ–¹æ³•å¾ˆç®€å•ï¼Œ&lt;code&gt;HTEXTU
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="HGE" scheme="https://xcoder.in/tags/HGE/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºæ¸¸æˆèµ„æºåŒ…çš„æ›´æ–°ã€åˆ é™¤</title>
    <link href="https://xcoder.in/2011/06/16/resource-pack/"/>
    <id>https://xcoder.in/2011/06/16/resource-pack/</id>
    <published>2011-06-15T17:20:31.000Z</published>
    <updated>2017-12-11T07:59:20.541Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€æœ€è¿‘é™¤äº†å¿™å„ç§å„æ ·çš„æœŸæœ«è€ƒè¯•ã€å»è¥¿ç­ç‰™çš„ç­¾è¯ï¼Œå°±æ˜¯å…¬å¸çš„é‚£ä¸ªéŸ©å›½é¡¹ç›®äº†ã€‚</p><p>ã€€ã€€æˆ‘çš„ä»»åŠ¡åŸºæœ¬å®Œæˆâ€”â€”å°†åŸæœ¬å•å±çš„æ¸¸æˆæ”¹æˆä¸‰å±ï¼Œå®Œå–„æ•´ä¸ª GUIç³»ç»Ÿ ä»¥åŠâ€œåŠ«æŒâ€äº†åŸæ¸¸æˆä¸­çš„ä¸€äº›é€»è¾‘ï¼Œæ¯”å¦‚æ»šè½´çš„æ’åˆ—å¯ä»¥ä»»æ„æ§åˆ¶ç­‰ã€‚ç”±äºåŸä»£ç ä¸­çš„GUIç³»ç»Ÿæ²¡æœ‰æ–‡æœ¬ç¼–è¾‘æ¡†ï¼Œæˆ‘è¿˜å¾—è‡ªå·±å†™ä¸€ä¸ªã€‚ç„¶è€Œæˆ‘å¯¹äºIMEçš„æ“ä½œã€GDIå’ŒDXçš„ç»“åˆä¸æ˜¯éå¸¸ç†Ÿæ‚‰ï¼Œæ‰€ä»¥è¿˜æ˜¯å‚ç…§äº†ä¸€ä¸‹ <strong>ShowLong</strong> æ‰€ä¿®æ”¹çš„å¾®å¦™çš„å¹³è¡¡ç»™HGEå†™çš„ä¸­æ–‡è§£å†³æ–¹æ¡ˆã€‚</p><p>ã€€ã€€å®Œæˆäº†ä»¥ä¸Šçš„ä»»åŠ¡ä¹‹åï¼Œç”±äºæˆ‘çš„è€ƒè¯•ä»¥åŠç­¾è¯é—®é¢˜ä»¥åŠæˆ‘æœ¬èº«çš„ä»»åŠ¡å·®ä¸å¤šäº†ï¼Œå°±æŠŠè¿™ä¸ªæ‘Šå­å°±æ‰”å›å…¬å¸å»äº†ã€‚åœ¨äº¤æ¥çš„æ—¶å€™ï¼Œè€å¤§ç»™æˆ‘æ´¾äº†ä¸€ä¸ªä»»åŠ¡ï¼Œè®©æˆ‘æ¥å†™è¿™ä¸ªæ¸¸æˆèµ„æºåŒ…çš„ä»£ç ã€‚</p><p>ã€€ã€€åŸç‰ˆæ¸¸æˆä»£ç ä¸­æœ‰èµ„æºåŒ…ä»£ç ï¼Œä½†æ˜¯å†™å¾—éå¸¸ä¹±ï¼Œäºæ˜¯éœ€è¦æˆ‘æ¥å†™ä¸€ä¸ªæ–°çš„æ–‡ä»¶ç»“æ„ã€æ–°çš„åŠ å¯†ç®—æ³•ï¼Œç„¶åä»ç„¶æ˜¯â€œåŠ«æŒâ€æ‰åŸä»£ç ä¸­çš„èµ„æºåŒ…åŠ è½½å‡½æ•°ã€‚</p><p>ã€€ã€€åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘æ‹œè¯»äº†äº‘é£çš„ã€Š<a href="http://blog.codingnow.com/2010/08/resource_pack.html" target="_blank" rel="external">æ¸¸æˆèµ„æºçš„å‹ç¼©ã€æ‰“åŒ…ä¸è¡¥ä¸æ›´æ–°</a>ã€‹ï¼Œæœ‰äº†ç‚¹çµæ„Ÿã€‚</p><p>ã€€ã€€<strong>æœ€ä¸»è¦çš„å°±æ˜¯å…¶åˆ é™¤è¿™ä¸€å—ã€‚ä¸ºäº†è®©ç”¨æˆ·åœ¨æ›´æ–°çš„æ—¶å€™å‡å°‘å¤§é‡çš„æ–‡ä»¶IOæ“ä½œï¼Œåšæ³•å°±æ˜¯å‡å°‘æ–‡ä»¶å†…å®¹çš„å¤§å¹…åº¦ç§»åŠ¨ã€‚</strong></p><p>ã€€ã€€è€Œæˆ‘ä¾¿æ˜¯å‚è€ƒäº†äº‘é£å¤§å¤§çš„è¿™ä¸ªæ€æƒ³æ¥å†™æˆ‘çš„æ–‡ä»¶åŒ…ã€‚é¦–å…ˆå› ä¸ºåœ¨æ¸¸æˆä¸­éœ€è¦å®æ—¶è¯»å–ï¼Œæ‰€ä»¥æ–‡ä»¶æ²¡æœ‰å‹ç¼©ï¼Œåªæ˜¯åšäº†ä¸¤å±‚åŠ å¯†å¤„ç†ï¼Œå¯†é’¥ä¹Ÿæ˜¯é€šè¿‡å“ˆå¸Œå¾—åˆ°çš„ï¼Œæ‰€ä»¥æ¯ä¸ªæ–‡ä»¶çš„å¯†é’¥æ˜¯ä¸åŒçš„ã€‚</p><p>ã€€ã€€ç„¶ååœ¨æ–‡ä»¶ç´¢å¼•çš„æ—¶å€™ï¼Œæˆ‘è¿™é‡Œæ˜¯åˆ†äº†ä¸¤ç§ç´¢å¼•ï¼š<strong>æ–‡ä»¶ç´¢å¼•</strong>ä»¥åŠ<strong>ç©ºå—ç´¢å¼•</strong>ã€‚</p><p>ã€€ã€€æ‰€è°“ç©ºå—ç´¢å¼•å°±æ˜¯ï¼šåœ¨æ–‡ä»¶åŒ…ä¸­åˆ é™¤æŸä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œä¸æŠŠåé¢çš„æ–‡ä»¶å†…å®¹å…¨éƒ¨å¾€å‰æŒªä»¥è¦†ç›–è¿™ä¸€å—çš„å†…å®¹ã€å¯¼è‡´æ•´ä¸ªæ–‡ä»¶åŒ…åœ¨åˆ é™¤æ–‡ä»¶ä¹‹åçš„ä¿¡æ¯å…¨éƒ¨å¾€å‰æŒªè€Œäº§ç”Ÿçš„å¤§é‡IOæ“ä½œï¼Œè€Œæ˜¯å¯¹è¿™ä¸€å—å†…å®¹ä¸ä½œä»»ä½•å¤„ç†ã€æŠŠè¿™ä¸€å—å†…å®¹çš„ç´¢å¼•ä»æ–‡ä»¶ç´¢å¼•ä¸­ç§»é™¤å¹¶é™„åŠ åˆ°ç©ºå—ç´¢å¼•ä¸­ä»¥ä¾›ä»¥åæ–°æ–‡ä»¶åŠ å…¥æ—¶æ‰€ç”¨ï¼Œ<strong>è¿™æ ·å°±åªäº§ç”Ÿäº†ä¸€ç‚¹å¯¹äºç´¢å¼•çš„æ–‡ä»¶IOæ›´æ–°</strong>ï¼Œä¸è¿‡ç´¢å¼•çš„æ›´æ–°å……å…¶é‡ä¹Ÿå°±é‚£ä¹ˆç‚¹ï¼Œç›¸å¯¹äºæ–‡ä»¶çš„æ“ä½œæ¥è¯´åªæ˜¯ä¹ç‰›ä¸€æ¯›ï¼Œå½“ç„¶å‰ææ˜¯è¿™ä¸ªç´¢å¼•æ˜¯åœ¨æ•´ä¸ªæ–‡ä»¶åŒ…çš„æœ€åã€‚è€Œåœ¨æœ‰æ–°æ–‡ä»¶æ’å…¥çš„æ—¶å€™ï¼Œå…ˆåœ¨ç©ºå—ç´¢å¼•ä¸­æ‰¾æœ‰æ¯”æ–°æ–‡ä»¶å¤§çš„ç©ºå—ï¼Œå¦‚æœæœ‰çš„è¯å°±ç›´æ¥æŠŠè¿™ä¸ªæ–‡ä»¶æ’å…¥åˆ°é‚£ä¸ªç©ºå—ä¸­ï¼Œç„¶åæ›´æ–°ä¸€ä¸‹æ–‡ä»¶ç´¢å¼•ä»¥åŠç©ºå—ç´¢å¼•å³å¯ï¼Œè¿™é‡Œåˆå°‘æ‰äº†ä¸€äº›IOæ“ä½œã€‚</p><p>ã€€ã€€æ­£å¦‚äº‘é£æ‰€è¯´ï¼š</p><blockquote><p>å¦‚æœæ–°å¢åŠ çš„æ–‡ä»¶è¾ƒä¹‹å°ï¼Œå°±é‡å¤åˆ©ç”¨è¿™ä¸ªç©ºé—´ã€‚å¦‚æœåˆ©ç”¨ä¸ä¸Šï¼Œå°±æµªè´¹åœ¨é‚£é‡Œã€‚è¿™æœ‰ç‚¹åƒå†…å­˜ç®¡ç†ç®—æ³•ï¼Œ<strong>æ—¶é—´ä¹…äº†ï¼Œèµ„æºåŒ…å†…ä¼šæœ‰ä¸€äº›ç©ºæ´ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚</strong></p></blockquote><p>ã€€ã€€æ¥ç€å°±æ˜¯èµ„æºåŒ…åœ¨æ¸¸æˆä¸­çš„ä½¿ç”¨äº†ã€‚åœ¨åŸå…ˆçš„æ¸¸æˆä»£ç ä¸­æ˜¯æœ‰åˆ¤æ–­é‡å¤åŠ è½½çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´æŠŠå·²åŠ è½½çš„èµ„æºå­˜åˆ°nodeé‡Œï¼Œåœ¨ä¹‹åå†æ¬¡éœ€è¦åŠ è½½è¿™ä¸ªèµ„æºï¼ˆé€šè¿‡æ–‡ä»¶ååˆ¤æ–­ï¼‰å°±ç›´æ¥ä»nodeä¸­å»ï¼Œè¿™æ ·å°±å°‘äº†å¾ˆå¤šå†…å­˜å¼€é”€ï¼Œå°¤å…¶æ˜¯å½“æˆ‘æŠŠå•å±æ”¹ä¸ºä¸‰å±ä¹‹åï¼Œè¿™æ ·çš„ä¼˜åŒ–æ•ˆæœæ›´ä¸ºæ˜æ˜¾ï¼ˆå¦åˆ™ç›¸åŒçš„èµ„æºè¦åŠ è½½ä¸‰æ¬¡ï¼Œç­‰äºæ¶ˆè€—äº†ä¸‰å€çš„å†…å­˜ï¼‰ã€‚ä¸å¾—èµä¸€ä¸‹è¿™05å¹´å¼€å‘çš„ä»£ç ï¼Œè™½ç„¶æ˜¯æ£’å­ã€‚ä¸è¿‡åŸæ¸¸æˆä»£ç ä¸­çš„é«˜è€¦åˆåº¦è®©æˆ‘è›‹ç–¼ã€‚</p><p>ã€€ã€€æƒ³åˆ°ä»¥åè¿™ä¸ªèµ„æºåŒ…ç±»è¦ç”¨åˆ°ä»¥åçš„ä¸€äº›é¡¹ç›®ï¼Œäºæ˜¯æˆ‘è‡ªå·±ä¹Ÿå†™äº†ä¸€ä¸ªCacheæœºåˆ¶ã€‚å°±æ˜¯åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œå½“åŠ è½½æŸä¸ªèµ„æºçš„æ—¶å€™ï¼Œé¡ºä¾¿æŠŠè¿™ä¸ªèµ„æºçš„BufferåŠ åˆ°ä¸€ä¸ªCacheä¸­ï¼Œå½“ä¸‹æ¬¡å†éœ€è¦ç”¨åˆ°è¿™ä¸ªèµ„æºçš„æ—¶å€™å°±ç›´æ¥ä»Cacheä¸­å–å°±å¥½äº†ï¼Œå®é™…ä¸Šè¿™å°±è¿˜æ˜¯ä¹‹å‰çš„ä»£ç å®ç°çš„åŠŸèƒ½ï¼Œåªä¸è¿‡æˆ‘è‡ªå·±åœ¨è¿™åŸºç¡€ä¸Šç²¾ç®€äº†ä¸€ä¸‹ã€‚æœ€åå†™ä¸€ä¸ªClearCacheçš„å‡½æ•°èƒ½æ¸…é™¤Cacheï¼Œæˆ‘è¿™ä¸ªèµ„æºåŒ…ç±»å°±ç®—å®Œæˆäº†ã€‚</p><p>ã€€ã€€è¿˜æœ‰åœ¨è·å–èµ„æºçš„æ—¶å€™ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜çªå¢ï¼Œæˆ‘çš„Bufferæ˜¯ä¸€æ®µä¸€æ®µè·å–çš„ï¼Œç±»ä¼¼äºSocketä¸­çš„è·å–æ¶ˆæ¯ä¸€ç›´åˆ°æ¶ˆæ¯ç»“æŸä¸ºæ­¢ã€‚å½“ç„¶ï¼Œæ¯ä¸€æ®µBufferçš„å¤§å°æ˜¯å¯ä»¥è‡ªå·±ä¼ è¿›å»çš„ã€‚æˆ‘è¿™ç§ä»¥æ—¶é—´æ¢ç©ºé—´çš„åšæ³•è¿˜æ²¡è‡ªå·±å®é™…æµ‹è¯•è¿‡æ•ˆæœå¦‚ä½•ï¼Œåªä¸è¿‡æ˜¯è‡ªå·±æƒ³æƒ³å¯èƒ½ä¼šæ¯”è¾ƒä¼˜ç½¢äº†ï¼Œå› ä¸ºæœ€è¿‘å®åœ¨æ˜¯å¤ªæ…¢ï¼Œè¿™ç¯‡æ—¥å¿—è¿˜æ˜¯è€ƒå®Œäº†æ¦‚ç‡ç„¶åæ‘¸ç€é»‘åœ°å†™çš„ã€‚</p><p>ã€€ã€€æˆ‘å¯¹æ–‡ä»¶ç³»ç»Ÿæœ¬èº«ä¸æ˜¯éå¸¸äº†è§£ï¼Œæ“ä½œç³»ç»Ÿè¿˜æ²¡è€ƒå‘¢ã€‚æ‰€ä»¥æˆ‘ç°åœ¨ä»…ä»…åšåˆ°çš„æ˜¯äº‘é£ä¹å¹´å‰çš„ä¸€ç§è®¾è®¡ï¼Œç„¶ååŠ ä¸Šäº†åŸå…ˆä»£ç æœ‰çš„Cacheæœºåˆ¶è€Œå·²ã€‚ä¸è¿‡å†™ä¸‹è¿™ç¯‡æ—¥å¿—æ¥è®°å½•æˆ‘è‡ªå·±æˆé•¿çš„è¶³è¿¹ç½¢äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€æœ€è¿‘é™¤äº†å¿™å„ç§å„æ ·çš„æœŸæœ«è€ƒè¯•ã€å»è¥¿ç­ç‰™çš„ç­¾è¯ï¼Œå°±æ˜¯å…¬å¸çš„é‚£ä¸ªéŸ©å›½é¡¹ç›®äº†ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€æˆ‘çš„ä»»åŠ¡åŸºæœ¬å®Œæˆâ€”â€”å°†åŸæœ¬å•å±çš„æ¸¸æˆæ”¹æˆä¸‰å±ï¼Œå®Œå–„æ•´ä¸ª GUIç³»ç»Ÿ ä»¥åŠâ€œåŠ«æŒâ€äº†åŸæ¸¸æˆä¸­çš„ä¸€äº›é€»è¾‘ï¼Œæ¯”å¦‚æ»šè½´çš„æ’åˆ—å¯ä»¥ä»»æ„æ§åˆ¶ç­‰ã€‚ç”±äºåŸä»£ç ä¸­çš„GUIç³»ç»Ÿæ²¡æœ‰æ–‡æœ¬ç¼–è¾‘æ¡†ï¼Œæˆ‘è¿˜å¾—
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="äºŒè¿›åˆ¶æ–‡ä»¶" scheme="https://xcoder.in/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6/"/>
    
      <category term="æ¸¸æˆåˆ¶ä½œ" scheme="https://xcoder.in/tags/%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C/"/>
    
      <category term="èµ„æºåŒ…" scheme="https://xcoder.in/tags/%E8%B5%84%E6%BA%90%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>è¿è¿çœ‹æ ¸å¿ƒç®—æ³•å°åˆ†äº«â€”â€”1</title>
    <link href="https://xcoder.in/2011/05/16/lianlinakan-algorighm-i/"/>
    <id>https://xcoder.in/2011/05/16/lianlinakan-algorighm-i/</id>
    <published>2011-05-16T04:30:12.000Z</published>
    <updated>2017-12-11T07:59:20.519Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€<strong>æ³¨ï¼šè¿™ç¯‡æ–‡ç« æˆ‘åˆ°ç°åœ¨ä¹Ÿæ²¡æœ‰å¡«ç¬¬äºŒç¯‡çš„å‘ã€‚æ•°æ®æ²¡äº†é‡æ–°ä» Capture é‡Œé¢å–å‡ºæ¥ï¼Œçœ‹çœ‹èˆä¸å¾—ï¼Œäºæ˜¯æŠŠè¿™ç¯‡æ–‡ç« ä¹Ÿæ‹¿å›æ¥äº†ã€‚æƒå½“çºªå¿µå§ï¼Œä»¥åŠå½“æ—¶å’Œ <code>Kalxd</code> çš„å¯¹è¯ã€‚</strong></p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>ã€€ã€€åˆšå¿™å®Œé‚€è¯·èµ›ï¼Œè¹­äº†å—é“œã€‚åˆšæ‰åœ¨é€›åˆ«äººåšå®¢çš„æ—¶å€™çœ‹åˆ«äººçš„æ–‡ç« ï¼Œçªç„¶å¿ƒè¡€æ¥æ½®æƒ³è®°ä¸€äº›ä¸œè¥¿ã€‚</p><p>ã€€ã€€è¿è¿çœ‹æ˜¯æˆ‘å­¦HGEåšçš„ç¬¬ä¸€ä¸ªå°æ¸¸æˆï¼Œç´ æç”¨çš„æ˜¯QQçš„ã€‚æ—¶é—´å¤§æ¦‚æ˜¯å»å¹´å›½åº†å§ã€‚å¥½å§ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œå°±è®²è®²è¿è¿çœ‹æ€ä¹ˆæ‰¾åˆ°èƒ½æ¶ˆçš„ä¸¤å—å§ã€‚</p><p>ã€€ã€€é¦–å…ˆæ¥å›é¡¾ä¸€ä¸‹æ¶ˆæ–¹å—çš„è§„åˆ™ï¼Œä¸€å…±æœ‰ä¸‰ç§å¯èƒ½æ€§ï¼š</p><ol><li>ç›´çº¿æ¶ˆé™¤ï¼ˆåŒ…æ‹¬æ°´å¹³æˆ–è€…å‚ç›´ï¼‰</li><li>ä¸€ä¸ªæ‹è§’æ¶ˆé™¤</li><li>ä¸¤ä¸ªæ‹è§’æ¶ˆé™¤</li></ol><p>ã€€ã€€å—¯ï¼Œæ¥ä¸‹å»æˆ‘ä»¬å°±é’ˆå¯¹æ¯ç§å¯èƒ½æ€§å¼€å§‹å†™ä»£ç ã€‚</p><p>ã€€ã€€é¦–å…ˆè®²è®²ä¸€äº›å®šä¹‰ï¼š</p><p>ã€€ã€€åº§æ ‡ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“åŒ…å«äº†xã€yçš„å€¼ä»¥åŠä¸€äº›åº§æ ‡ä¸­å¸¸ç”¨çš„å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief åœ°å›¾åº§æ ‡ç»“æ„ä½“</span><br><span class="line"> *</span><br><span class="line"> * åœ°å›¾åº§æ ‡ç»“æ„ä½“ï¼ŒåŒ…å«xè½´å€¼ã€yè½´å€¼</span><br><span class="line"> * ä»¥åŠä¸€äº›æ“ä½œå‡½æ•°ã€‚</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CoorType</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x;                                          <span class="comment">///&lt; xè½´</span></span><br><span class="line">    <span class="keyword">int</span> y;                                          <span class="comment">///&lt; yè½´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * é‡è½½æ„é€ å‡½æ•°</span><br><span class="line">     * å°†xã€yå€¼å„åˆå§‹åŒ–ä¸º-1</span><br><span class="line">     */</span></span><br><span class="line">    CoorType()</span><br><span class="line">    &#123;</span><br><span class="line">        x = <span class="number">-1</span>, y = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * æ„é€ å‡½æ•°é‡è½½</span><br><span class="line">     * å°†xã€yå„èµ‹å€¼ä¸ºbã€a</span><br><span class="line">     * @param a å°†è¦èµ‹å€¼çš„yè½´æ•°å€¼</span><br><span class="line">     * @param b å°†è¦èµ‹å€¼çš„xè½´æ•°å€¼</span><br><span class="line">     */</span></span><br><span class="line">    CoorType(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span><br><span class="line">    &#123;</span><br><span class="line">        y = a, x = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * è®¾ç½®åº§æ ‡</span><br><span class="line">     * å°†xã€yå„èµ‹å€¼ä¸ºbã€a</span><br><span class="line">     * @param a å°†è¦èµ‹å€¼çš„yè½´æ•°å€¼</span><br><span class="line">     * @param b å°†è¦èµ‹å€¼çš„xè½´æ•°å€¼</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        y = a, x = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * è¿ç®—ç¬¦"+="é‡è½½</span><br><span class="line">     * å°†æ­¤åº§æ ‡ä¸å¦ä¸€åº§æ ‡ç›¸åŠ </span><br><span class="line">     * @param &amp;a å¦ä¸€åº§æ ‡</span><br><span class="line">     * @return è¿”å›ç»“æœåº§æ ‡å€¼</span><br><span class="line">     */</span></span><br><span class="line">    CoorType &amp; <span class="keyword">operator</span> += (<span class="keyword">const</span> CoorType &amp;a)</span><br><span class="line">    &#123;</span><br><span class="line">        y += a.y, x += a.x;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * é‡è½½è¿ç®—ç¬¦"!="</span><br><span class="line">     * åˆ¤æ–­ä¸å¦ä¸€åº§æ ‡æ˜¯å¦è¡¨ç¤ºåŒä¸€ä¸ªå€¼</span><br><span class="line">     * @param &amp;a å¦ä¸€åº§æ ‡</span><br><span class="line">     * @return è¿”å›å¸ƒå°”ç±»å‹è¡¨ç¤ºæ˜¯å¦ç›¸ç­‰</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> != (<span class="keyword">const</span> CoorType &amp;a)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(y != a.y || x != a.x) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * åˆ¤æ–­æ­¤åº§æ ‡æ˜¯å¦åˆæ³•</span><br><span class="line">     * è‹¥å‡ºç•Œåˆ™ä¸åˆæ³•</span><br><span class="line">     * @return è¿”å›å¸ƒå°”ç±»å‹è¡¨ç¤ºæ˜¯å¦åˆæ³•</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isIll</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(y &gt;= <span class="number">0</span> &amp;&amp; x &gt;= <span class="number">0</span> &amp;&amp; y &lt; MAP_HEIGHT &amp;&amp; x &lt; MAP_WIDTH) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åæ˜¯å…³äºåœ°å›¾æ•°ç»„çš„å®šä¹‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> Map[MAP_HEIGHT][MAP_WIDTH];</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ¥ç€æ˜¯è·¯å¾„ç»“æ„ä½“ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief è·¯çº¿ç»“æ„ä½“</span><br><span class="line"> *</span><br><span class="line"> * åˆæ³•è·¯çº¿ç»“æ„ä½“</span><br><span class="line"> * å‚¨å­˜æœ€å¤šå››ä¸ªç‚¹ï¼ˆèµ·ç‚¹ç»ˆç‚¹å’Œä¸¤ä¸ªè½¬æŠ˜ç‚¹ï¼‰</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PointPath</span> &#123;</span></span><br><span class="line">    <span class="keyword">bool</span> bExist;                                    <span class="comment">///&lt; æ˜¯å¦æœ‰è·¯å¾„</span></span><br><span class="line">    <span class="keyword">int</span> Num;                                        <span class="comment">///&lt; é©»ç‚¹ä¸ªæ•°</span></span><br><span class="line">    CoorType Points[<span class="number">4</span>];                             <span class="comment">///&lt; å„é©»ç‚¹</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æ¥ç€å¯ä»¥æ­£å¼å¼€å§‹äº†ã€‚é¦–å…ˆæˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹ï¼Œå“ªäº›æ¡ä»¶å„ç¬¦åˆä¸Šé¢ä¸‰ç§æƒ…å†µçš„å“ªä¸€ç§ã€‚å¯¹äºä¸€æ¡ç›´çº¿çš„ï¼Œæ˜¾ç„¶æ˜¯xç›¸ç­‰æˆ–è€…yç›¸ç­‰ï¼›å¯¹äºæœ‰ä¸€ä¸ªè½¬æŠ˜ç‚¹çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­èµ·ç‚¹æ¨ªå‘ç”»çº¿ï¼ˆæˆ–è€…çºµå‘ï¼‰ï¼Œç„¶åç»ˆç‚¹çºµå‘ç”»çº¿ï¼ˆæˆ–è€…æ¨ªå‘ï¼‰ï¼Œç„¶åä»èµ·ç‚¹åˆ°äº¤ç‚¹ä»¥åŠä»äº¤ç‚¹åˆ°ç»ˆç‚¹å„å¯è¡Œä¸ï¼›å¯¹äºä¸¤ä¸ªè½¬æŠ˜ç‚¹ï¼Œå…¶ä¸­ä¸€ä¸ªè½¬æŠ˜ç‚¹çš„xæˆ–è€…yè·Ÿèµ·ç‚¹çš„xæˆ–è€…yç›¸ç­‰ï¼Œå¦ä¸€ä¸ªè½¬æŠ˜ç‚¹è·Ÿç»ˆç‚¹çš„xæˆ–è€…yç›¸ç­‰ã€‚äºæ˜¯è¿™ä¸¤ä¸ªè½¬æŠ˜ç‚¹å°±æ ¹æ®è¿™æ ·çš„æ€§è´¨è¿›è¡Œæšä¸¾ã€‚å› ä¸ºè¿è¿çœ‹çš„åœ°å›¾æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™ç§O(n^2)çš„æ—¶é—´å¤æ‚åº¦ä¸ç¢äº‹ã€‚</p><p>ã€€ã€€ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ª <code>Abled(CoorType, CoorType, bool, bool);</code> å‡½æ•°æ¥è¿›è¡Œåˆ¤æ–­ä¸¤ä¸ªç‚¹ï¼ˆå½“ç„¶ä¸¤ç‚¹æ˜¯åœ¨åŒä¸€ç›´çº¿ä¸Šçš„ï¼‰æ˜¯å¦æœ‰åŒè·¯ï¼ˆå³ä¸­é—´æ²¡æœ‰ä¸œè¥¿æŒ¡ç€ï¼‰ã€‚æˆ‘ä»¬å…ˆæ”¾ç€è¿™ä¸ªAbledä¸ç®¡ï¼Œå…ˆå®ç°å¯»è·¯è¿‡ç¨‹å§ã€‚</p><p>ã€€ã€€æˆ‘æ˜¯ç”¨ä¸€ä¸ªCMapSearchç±»æ¥å®ç°çš„ï¼Œå£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief åœ°å›¾æœç´¢ç±»</span><br><span class="line"> *</span><br><span class="line"> * æ ¹æ®æŒ‡å®šåœ°å›¾æœç´¢å‡ºå„åˆæ³•è·¯å¾„ã€‚</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CMapSearch</span></span><br><span class="line">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> Map[MAP_HEIGHT][MAP_WIDTH];                                             <span class="comment">///&lt; åœ°å›¾æ•°æ®çŸ©é˜µ</span></span><br><span class="line">    PointPath dis[MAP_HEIGHT][MAP_WIDTH][MAP_HEIGHT][MAP_WIDTH];                <span class="comment">///&lt; è·¯å¾„æ•°ç»„</span></span><br><span class="line">    STLMap grap;                                                                <span class="comment">///&lt; STLæ˜ å°„</span></span><br><span class="line">    CoorType dir[<span class="number">4</span>];                                                            <span class="comment">///&lt; å¸¸é‡åº§æ ‡å¢é‡</span></span><br><span class="line">    PointPath Hint;                                                             <span class="comment">///&lt; æç¤ºæ—¶ç”¨çš„åˆæ³•è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief ä¸¤ç‚¹å¯»å¾„</span><br><span class="line">     *</span><br><span class="line">     * å¯¹(x1, y1)å’Œ(x2, y2)è¿›è¡Œå¯»å¾„</span><br><span class="line">     * @param x1 ç¬¬ä¸€ä¸ªåº§æ ‡çš„xè½´</span><br><span class="line">     * @param y1 ç¬¬ä¸€ä¸ªåº§æ ‡çš„yè½´</span><br><span class="line">     * @param x2 ç¬¬äºŒä¸ªåº§æ ‡çš„xè½´</span><br><span class="line">     * @param y2 ç¬¬äºŒä¸ªåº§æ ‡çš„yè½´</span><br><span class="line">     * @return è¿”å›ä¸€ä¸ªè·¯çº¿ç»“æ„ä½“çš„å€¼ï¼Œè‹¥ä¸å­˜åœ¨è·¯å¾„ï¼Œåˆ™ç»“æ„ä½“çš„bExistä¸ºå‡</span><br><span class="line">     * @see Abled</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">PointPath <span class="title">DoSearch</span><span class="params">(<span class="keyword">int</span> y1, <span class="keyword">int</span> x1, <span class="keyword">int</span> y2, <span class="keyword">int</span> x2)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief æ„é€ å‡½æ•°</span><br><span class="line">     *</span><br><span class="line">     * @param _Map[][Map_Width] åœ°å›¾çŸ©é˜µ</span><br><span class="line">     */</span></span><br><span class="line">    CMapSearch(<span class="keyword">int</span> _Map[][MAP_WIDTH]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief ææ„å‡½æ•°</span><br><span class="line">     */</span></span><br><span class="line">    ~CMapSearch(<span class="keyword">void</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief è½½å…¥åœ°å›¾</span><br><span class="line">     * ä»çŸ©é˜µä¸­è½½å…¥åœ°å›¾åˆ°å¯¹è±¡</span><br><span class="line">     *</span><br><span class="line">     * @param _Map[][Map_Width] åœ°å›¾çŸ©é˜µ</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">LoadMap</span><span class="params">(<span class="keyword">int</span> _Map[][MAP_WIDTH])</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief æœç´¢åœ°å›¾</span><br><span class="line">     * å¯¹æ•´ä¸ªåœ°å›¾è¿›è¡Œæœç´¢æ¯ä¸¤ä¸ªç›¸åŒæ–¹å—ä¹‹é—´çš„è·¯å¾„</span><br><span class="line">     *</span><br><span class="line">     * @return å¦‚æœå­˜åœ¨è‡³å°‘ä¸€æ¡è·¯å¾„åˆ™è¿”å›çœŸï¼Œå¦åˆ™ä¸ºå‡ï¼Œç”¨äºæ˜¯å¦é‡åˆ—</span><br><span class="line">     * @see CreateSTLMap</span><br><span class="line">     * @see DoSearch</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Search</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief åˆ›å»ºmapæ˜ å°„</span><br><span class="line">     * åˆ›å»ºä¸€ä¸ªæ–¹å—IDçš„æ˜ å°„ï¼Œå¯¹æ¯ä¸ªIDåˆ›å»ºä¸€æ¡çš„è¯¥IDçš„æ–¹å—åœ¨åœ°å›¾ä¸­çš„å„åº§æ ‡çš„é“¾è¡¨</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CreateSTLMap</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief åˆ¤æ–­æ˜¯å¦æœ‰éšœç¢</span><br><span class="line">     * å¯¹äºaã€bä¸¤åº§æ ‡ï¼ˆåœ¨åŒä¸€ç›´çº¿ï¼‰è¿›è¡Œåˆ¤æ–­æœŸé—´æ˜¯å¦æœ‰æ–¹å—éšœç¢è€Œå¯¼è‡´ä¸èƒ½è¿çº¿</span><br><span class="line">     *</span><br><span class="line">     * @param a åº§æ ‡aï¼ˆå¤´åº§æ ‡ï¼‰</span><br><span class="line">     * @param b åº§æ ‡bï¼ˆå°¾åº§æ ‡ï¼‰</span><br><span class="line">     * @param head è‹¥åŒ…æ‹¬å¤´åº§æ ‡åˆ™ä¸ºtrueï¼Œå¦åˆ™ä¸ºfalse</span><br><span class="line">     * @param tail è‹¥åŒ…æ‹¬å°¾åº§æ ‡åˆ™ä¸ºtrueï¼Œå¦åˆ™ä¸ºfalse</span><br><span class="line">     * @return è‹¥æœ‰éšœç¢åˆ™è¿”å›falseï¼Œå¦åˆ™ä¸ºtrue</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Abled</span><span class="params">(CoorType a, CoorType b, <span class="keyword">bool</span> head = <span class="literal">false</span>, <span class="keyword">bool</span> tail = <span class="literal">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief å¾—åˆ°è·¯å¾„</span><br><span class="line">     * å¾—åˆ°ä¸¤ä¸ªåº§æ ‡çš„è¿çº¿å…·ä½“è·¯å¾„</span><br><span class="line">     *</span><br><span class="line">     * @param y1 ç¬¬ä¸€ä¸ªåº§æ ‡çš„yè½´</span><br><span class="line">     * @param x1 ç¬¬ä¸€ä¸ªåº§æ ‡çš„xè½´</span><br><span class="line">     * @param y2 ç¬¬äºŒä¸ªåº§æ ‡çš„yè½´</span><br><span class="line">     * @param x2 ç¬¬äºŒä¸ªåº§æ ‡çš„xè½´</span><br><span class="line">     * @return è¿”å›ä¸€ä¸ªè·¯çº¿ç»“æ„ä½“ï¼Œè¡¨ç¤ºè¯¥ä¸¤ä¸ªåº§æ ‡ç›´æ¥çš„è·¯çº¿</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">PointPath <span class="title">GetPath</span><span class="params">(<span class="keyword">int</span> y1, <span class="keyword">int</span> x1, <span class="keyword">int</span> y2, <span class="keyword">int</span> x2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief å¾—åˆ°æç¤ºè·¯å¾„</span><br><span class="line">     * å¾—åˆ°ä¸€æ¡æç¤ºçš„è·¯å¾„çš„ç›¸åº”ä¸¤ä¸ªæ–¹å—</span><br><span class="line">     *</span><br><span class="line">     * @param &amp;a æ¥å—ç¬¬ä¸€ä¸ªæ–¹å—IDçš„å˜é‡</span><br><span class="line">     * @param &amp;b æ¥å—ç¬¬äºŒä¸ªæ–¹å—IDçš„å˜é‡</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetRandomHint</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç„¶åæˆ‘è¿™ä¸ªåˆ†äº«é‡Œæ‰€è®²çš„ç®—æ³•å°±æ˜¯DoSearchå’ŒAbledå‡½æ•°äº†ï¼Œå› ä¸ºå…¶å®ƒå‡½æ•°å°±æ˜¯ç”¨äºâ€œæç¤ºâ€é“å…·çš„ã€‚åœ¨DoSearchä¸­æˆ‘ä»¬å…ˆå®šä¹‰ä¸¤ä¸ªä¸´æ—¶å˜é‡ï¼Œä¸€ä¸ªæ˜¯è¿”å›å€¼ï¼ˆä¸€ä¸ªPointPathï¼‰ï¼Œå››ä¸ªåº§æ ‡å˜é‡ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">PointPath ans;</span><br><span class="line">CoorType a(y1, x1), b(y2, x2), c, d;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å…¶ä¸­aã€bè¡¨ç¤ºèµ·ç‚¹å’Œç»ˆç‚¹ï¼Œcã€dè¡¨ç¤ºå¯èƒ½ç”¨åˆ°çš„ä¸¤ä¸ªè½¬æŠ˜ç‚¹ã€‚</p><p>ã€€ã€€é¦–å…ˆæˆ‘ä»¬å…ˆæ¥åˆ¤æ–­ç›´çº¿æƒ…å†µå§ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒç®€å•ï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœæ˜¯ç›´çº¿</span></span><br><span class="line"><span class="keyword">if</span>(a.x == b.x || a.y == b.y)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(Abled(a, b, <span class="literal">true</span>, <span class="literal">true</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        ans.bExist = <span class="literal">true</span>;</span><br><span class="line">        ans.Num = <span class="number">2</span>;</span><br><span class="line">        ans.Points[<span class="number">0</span>] = a, ans.Points[<span class="number">1</span>] = b;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€ç›´æ¥åˆ¤æ–­aã€bç›´æ¥æœ‰æ²¡æœ‰é€šè·¯å°±å¥½ï¼Œå¦‚æœæœ‰é€šè·¯æˆ‘ä»¬å°±å°†ç»“æœè®°å½•åˆ°ansä¸­å¹¶è¿”å›å³å¯ã€‚</p><p>ã€€ã€€è€Œæœ‰ä¸€ä¸ªè½¬æŠ˜ç‚¹ã€ä¸¤ä¸ªè½¬æŠ˜ç‚¹çš„æƒ…å†µä»¥åŠAbledå‡½æ•°å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å°åˆ†äº«ä¸€ä¸‹ã€‚</p><h2 id="å›å¿†æ—¶é—´"><a href="#å›å¿†æ—¶é—´" class="headerlink" title="å›å¿†æ—¶é—´"></a>å›å¿†æ—¶é—´</h2><p>ã€€ã€€ç„¶åä¸‹é¢å°±æ˜¯åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢æˆ‘è·Ÿ <code>Kalxd</code> çš„å¯¹è¯äº†ï¼Œæƒ³æƒ³ç°åœ¨çœŸæ˜¯æ²§æµ·æ¡‘ç”°å•Šã€‚</p><p>ã€€ã€€CSS æ ·å¼æ—©å·²ç»ä¸åœ¨äº†ï¼Œæˆªå›¾é‡Œé¢æ˜¯ä¸€ç¯‡ç™½æ¿</p><p><img src="comment.png" alt="è¯„è®ºå›å¿†"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€&lt;strong&gt;æ³¨ï¼šè¿™ç¯‡æ–‡ç« æˆ‘åˆ°ç°åœ¨ä¹Ÿæ²¡æœ‰å¡«ç¬¬äºŒç¯‡çš„å‘ã€‚æ•°æ®æ²¡äº†é‡æ–°ä» Capture é‡Œé¢å–å‡ºæ¥ï¼Œçœ‹çœ‹èˆä¸å¾—ï¼Œäºæ˜¯æŠŠè¿™ç¯‡æ–‡ç« ä¹Ÿæ‹¿å›æ¥äº†ã€‚æƒå½“çºªå¿µå§ï¼Œä»¥åŠå½“æ—¶å’Œ &lt;code&gt;Kalxd&lt;/code&gt; çš„å¯¹è¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ­£æ–‡&quot;&gt;&lt;a hr
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="HGE" scheme="https://xcoder.in/tags/HGE/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çš„ç¼–ç¨‹ç”Ÿæ¶¯ä¸­ç¬¬ä¸€ä¸ªå•†ä¸šæ¸¸æˆ</title>
    <link href="https://xcoder.in/2011/04/25/my-first-game/"/>
    <id>https://xcoder.in/2011/04/25/my-first-game/</id>
    <published>2011-04-25T04:30:53.000Z</published>
    <updated>2017-12-11T07:59:20.522Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€æœ€è¿‘ç½‘ä¹‹æ¸¸åœ¨å’Œæ£’å­ä¸€èµ·å¼€å‘ä¸€ä¸ªç±»ä¼¼èµŒåšçš„ç½‘æ¸¸ï¼ˆåˆ«å¢™æˆ‘ï¼Œåšå¥½æ˜¯ç»™æ£’å­è‡ªå·±ç©çš„ï¼‰ï¼Œç„¶åæœºç¼˜å·§åˆï¼Œä»–ä»¬çš„å¼•æ“æ˜¯ç»“åˆäº†MFCä»¥åŠä»æˆ‘ç”¨è¿‡çš„å‡ ä¸ªå¼•æ“ä¹‹ä¸€ç§»æ¤è¿‡æ¥çš„ã€‚å°±å¼•æ“æœ¬èº«è€Œè¨€å¾ˆå¼ºå¤§ï¼Œç„¶åæˆ‘åˆæœ‰ä¸€ç‚¹å°ç»éªŒï¼Œæ‰€ä»¥ç½‘ä¹‹æ¸¸çš„æŸ¯æ€»ä¾¿ä¹Ÿè®©æˆ‘åŠ å…¥äº†å¼€å‘è¡Œåˆ—ã€‚ä¹‹å‰ä¹Ÿæ˜¯æ‰˜ç½‘ä¹‹æ¸¸çš„ç¦è®©æˆ‘ç ”ç©¶äº†ä¸€ç•ªç½‘ç‹çš„å¹³å°ã€‚</p><p>ã€€ã€€å¼€å‘è¿‡ç¨‹ä¸­å­¦åˆ°äº†ä¸å°‘åº•å±‚çš„ä¸œè¥¿ã€‚æˆ‘çš„ä»»åŠ¡æ˜¯å…ˆå°†æ¸¸æˆçš„å•å±ç»™å¼„æˆä¸‰ä»½ï¼Œä»¥ä¸‰ä¸ªé€»è¾‘æ¥å®ç°ã€‚ç”±äºå·¥ç¨‹è€¦åˆæ€§å¤ªé«˜ï¼ŒåŸç¨‹åºå‘˜æ˜¯Cè¯­è¨€å‡ºç”Ÿçš„ï¼Œé€ æˆäº†æˆ‘ä¿®æ”¹å·¥ç¨‹ä¸€å®šç¨‹åº¦ä¸Šçš„éº»çƒ¦ã€‚å…ˆè‡ªå·±å†™äº†ä¸ªWrapperç±»æ¥åŒ…å«ä¸‰ä¸ªSceneGAMEï¼Œç„¶åä¸€æ¬¡æ€§å°†ä¸‰ä¸ªSceneGAMEæ¸²æŸ“åˆ°ç›®æ ‡ä¸Šã€‚è¿™æ ·æ”¹äº†ä¸€ä¸‹ä¹‹åï¼Œæœ‰ä¸¤ç™¾å¤šä¸ªé”™è¯¯ã€‚ä¸çŸ¥é“å…¶å®ƒæ¸¸æˆæ˜¯ä¸æ˜¯ä¹Ÿæœ‰è¿™æ ·çš„ç‰¹ç‚¹ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘å¼€å‘çš„ç¬¬ä¸€æ¬¾æ¸¸æˆï¼Œæ‰€ä»¥ä¹Ÿæ²¡ç»éªŒã€‚</p><p>ã€€ã€€ä¸è¿‡å¹¸å¥½æœ€åè¿˜æ˜¯è®©æˆ‘ç»™å®Œæˆäº†è¿™ç¬¬ä¸€ä¸ªquestã€‚æ¥ç€æ˜¯æ·»åŠ GUIï¼Œå°±æ˜¯ç°åœ¨æ­£åœ¨åšçš„ã€‚è¿˜æœ‰å°±æ˜¯å®Œå…¨åˆ†ç¦»ä¸‰å—åˆ†å±çš„é€»è¾‘ä»£ç ã€‚è®©æˆ‘è¿™ä¸ªå¤§äºŒå­¦ç”Ÿå…´å¥‹çš„æ˜¯ï¼Œè¿™ä¸ªæ¸¸æˆå®Œæˆä¹‹åï¼Œæ˜¯ä¼šæœ‰å¥–é‡‘çš„ã€‚è¿™ä¸ªå¯æ˜¯è®©æˆ‘è¿™ä¸ªç©·å­©å­ä¸¤çœ¼æ”¾å…‰è«ã€‚YYä¸€ä¸‹åˆ°åº•ä¼šæœ‰å¤šå°‘å‘¢ï¼Œæˆ‘æœ¬èº«ä¹Ÿåªæ˜¯è¿‡å»è§è¯†ä¸€ä¸‹çœŸæ­£çš„å·¥ç¨‹è€Œå·²ï¼Œå‹æ ¹æ²¡æƒ³è¿‡moneyè¿™äº‹ã€‚</p><p>ã€€ã€€ä»Šå¤©ï¼Œé¢å¥½å§ï¼Œä»¥ç°åœ¨çš„æ—¶é—´æ¥è¯´åº”è¯¥æ˜¯æ˜¨å¤©äº†ï¼Œä¸€ä¸ªéŸ©å›½äººä»¥åŠå¦ä¸€ä¸ªä¸­å›½å…¬å¸çš„äººè¿‡æ¥éªŒæ”¶æˆ‘ä»¬ç°åœ¨çš„è¿›åº¦ã€‚æˆ‘æ‰“å¼€è‡ªå·±ç”µè„‘é‡Œç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¿ƒä¸­é‚£ç§è‡ªè±ªæ„Ÿæ²¹ç„¶è€Œç”Ÿå•Šï¼Œæ¯•ç«Ÿæˆ‘è¿˜æ˜¯newbieï¼Œå½“ç„¶æ˜¯æœ‰äº›å°å…´å¥‹å•Šã€‚æœŸé—´é‚£ä¸ªä¸­å›½å…¬å¸çš„äººè¯´è¦èµ¶åœ¨éŸ©å›½äººé‚£è¾¹ä»»åŠ¡å®Œæˆä¹‹å‰å®Œæˆï¼Œè¿™æ ·å¥½ä½“ç°æˆ‘ä»¬è‡ªå·±ç¨‹åºå‘˜ä¸æ¯”ä»–ä»¬å·®ã€‚æ— å½¢ä¹‹é—´çš„è¾ƒé‡å•Šï¼Œè¡¨ç¤ºé¸­æ¢¨å¾ˆå¤§ã€‚æ®è¯´ä»–ä»¬é‚£è¾¹ç°åœ¨é‡åˆ°å°é—®é¢˜äº†ï¼Œæˆ‘ä»¬è¶…å‰çš„å¯èƒ½æ€§è¿˜æ˜¯è›®å¤§çš„ï¼Œæ¥ä¸‹å»æˆ‘å°±æ˜¯è¦å¯è¶³åŠ²æ¥åˆ†ç¦»é€»è¾‘ä»¥åŠè®¾ç½®GUIäº†ã€‚æŸ¯æ€»é‚£è¾¹å·²ç»æŠŠç½‘ç»œé€šè®¯æ–¹é¢å·®ä¸å¤šå®Œæˆäº†ï¼Œæˆ‘è¿™ä¸€å—åšå¥½ï¼Œä¸€å¯¹æ¥ï¼Œå·®ä¸å¤šèƒ½åœ¨äº”æœˆåˆäº¤å·¥äº†ã€‚</p><p>ã€€ã€€æœ€è¿‘è¿˜æ˜¯æ¯”è¾ƒå¿™å•Šï¼Œè¦å­¦è½¦ï¼Œæœ‰ä¸ªå®å·¥åŸºé‡‘ä¼šç½‘ç«™ã€æ¸¯åŸå…³ç³»ç ”ç©¶æ‰€ç½‘ç«™ä»¥åŠå›½é™…æ¸¯å£ä¸ç‰©æµä¸­å¿ƒç½‘ç«™ï¼Œç„¶åå›¢åŒºå§”é‚£è¾¹çš„å¿—æ„¿è€…ç½‘ç«™è¿˜æœ‰ç‚¹å°å°¾å·´ï¼Œæµ™æ±Ÿèƒ½æºé›†å›¢é‚£ä¸ªç”¨C#å†™çš„å‘˜å·¥å¢™å®Œå·¥äº†è¿˜ä¸çŸ¥é“é‚£è¾¹æ€ä¹ˆè¯´ï¼Œæ¥ç€åº”è¯¥è¿˜æœ‰ä¸€ä¸ªå§œè€å¸ˆé‚£è¾¹çš„ç«™å­ã€‚éƒ½å †åœ¨ä¸€å¨äº†ã€‚ä¸è¿‡æœ€è¿‘æœ€è¦ç´§çš„è¿˜æ˜¯è¿™ä¸ªæ¸¸æˆä»¥åŠåŸºé‡‘ä¼šç½‘ç«™ä»¥åŠå»è¥¿ç­ç‰™å®ä¹ çš„ä¸€äº›ç›¸å…³äº‹å®œäº†ã€‚ä¸ç®¡äº†ï¼Œå…ˆç¡è§‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€æœ€è¿‘ç½‘ä¹‹æ¸¸åœ¨å’Œæ£’å­ä¸€èµ·å¼€å‘ä¸€ä¸ªç±»ä¼¼èµŒåšçš„ç½‘æ¸¸ï¼ˆåˆ«å¢™æˆ‘ï¼Œåšå¥½æ˜¯ç»™æ£’å­è‡ªå·±ç©çš„ï¼‰ï¼Œç„¶åæœºç¼˜å·§åˆï¼Œä»–ä»¬çš„å¼•æ“æ˜¯ç»“åˆäº†MFCä»¥åŠä»æˆ‘ç”¨è¿‡çš„å‡ ä¸ªå¼•æ“ä¹‹ä¸€ç§»æ¤è¿‡æ¥çš„ã€‚å°±å¼•æ“æœ¬èº«è€Œè¨€å¾ˆå¼ºå¤§ï¼Œç„¶åæˆ‘åˆæœ‰ä¸€ç‚¹å°ç»éªŒï¼Œæ‰€ä»¥ç½‘ä¹‹æ¸¸çš„æŸ¯æ€»ä¾¿ä¹Ÿè®©æˆ‘åŠ å…¥äº†å¼€å‘è¡Œåˆ—ã€‚ä¹‹å‰ä¹Ÿæ˜¯æ‰˜ç½‘ä¹‹æ¸¸çš„ç¦è®©æˆ‘ç ”ç©¶äº†ä¸€
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="æ¸¸æˆå¼€å‘" scheme="https://xcoder.in/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"/>
    
      <category term="ç‰¢éªš" scheme="https://xcoder.in/tags/%E7%89%A2%E9%AA%9A/"/>
    
      <category term="ç½‘ä¹‹æ¸¸" scheme="https://xcoder.in/tags/%E7%BD%91%E4%B9%8B%E6%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>C++å¯¹è±¡å·¥å‚æ¨¡å¼ï¼šObjectFactoryå­¦ä¹ ç¬”è®°</title>
    <link href="https://xcoder.in/2010/11/17/objectfactory-learning/"/>
    <id>https://xcoder.in/2010/11/17/objectfactory-learning/</id>
    <published>2010-11-17T07:49:45.000Z</published>
    <updated>2017-12-11T07:59:20.528Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€å¯¹è±¡å·¥å‚ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯äº§ç”Ÿå¯¹è±¡çš„ä¸€ä¸ªâ€œå·¥å‚â€ã€‚æ ¹æ®ä¼ å…¥çš„ä¸€ä¸ªå‚æ•°è€Œäº§ç”Ÿç›¸åº”çš„ä¸åŒç§ç±»çš„å¯¹è±¡ã€‚</p><p>ã€€ã€€ç”¨äºæ‰¹é‡ç”ŸæˆåŒä¸€ä¸ªçˆ¶ç±»çš„ä¸åŒå­ç±»çš„å¯¹è±¡æ—¶ç”¨åˆ°ã€‚</p><p>ã€€ã€€æœ¬å­¦ä¹ ç¬”è®°åŸºäºSingletonï¼ˆå•ä»¶æ¨¡å¼ï¼‰åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ã€‚</p><p>ã€€ã€€çœ‹ã€ŠC++å•ä»¶æ¨¡å¼ï¼šSingletonå­¦ä¹ ç¬”è®°ã€‹è¯·ç‚¹å‡»<a href="/2010/11/13/singleton-learning/">é“¾æ¥</a>ã€‚</p><p>ã€€ã€€å¯¹äºå·¥å‚æ¨¡å¼ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šä¸åŒçš„å®ç°æ–¹æ³•ã€‚æˆ‘è¿™é‡Œæ˜¯ä¸€ä¸ªHGEçš„RPG Demoä¸­æ‰€ç”¨çš„ï¼Œè¿™æ®µä»£ç æœ¬èº«å†™çš„éå¸¸çš„å¥½ï¼Œå¼€å§‹å¥½äº›è¯­å¥æ²¡çœ‹æ‡‚ï¼Œè™½ç„¶å°±è¿™ä¹ˆå‡ å¥è¯ã€‚èŠ±äº†ä¸€ç‚¹æ—¶é—´å»ç ”ç©¶äº†å…¶ä»£ç ï¼Œå¹¶è‡ªå·±é‡æ–°å®ç°äº†ä¸€éï¼ŒåŠ ä¸Šäº†é€šä¿—æ˜“æ‡‚çš„æ³¨é‡Šã€‚</p><p>ã€€ã€€å·¥å‚ç±»ä»¥æ¨¡æ¿å½¢å¼å®ç°ï¼ŒåŸºäºSingletonï¼š</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**--------------------------------</span><br><span class="line"> * å¯¹è±¡å·¥å‚æ¨¡å¼(Object Factory)</span><br><span class="line"> *</span><br><span class="line"> * Code by XadillaX</span><br><span class="line"> * http://www.xcoder.in</span><br><span class="line"> * Created at 2010-11-17 1:33</span><br><span class="line"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> OBJECTFACTORY_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OBJECTFACTORY_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"../å•ä»¶æ¨¡å¼/Singleton.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span><br><span class="line"><span class="title">class</span> <span class="title">ObjectFactory</span> :</span> <span class="keyword">public</span> Singleton&lt;ObjectFactory&lt;T&gt;&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> T* (*tCreator)();                               <span class="comment">///&lt; é‡å®šä¹‰å¯¹è±¡ç”Ÿæˆå‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>, tCreator&gt; tCreatorMap;    <span class="comment">///&lt; å¯¹è±¡ç”Ÿæˆå‡½æ•°æŒ‡é’ˆmap</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief æ³¨å†Œæ–°â€œç”Ÿäº§è½¦é—´â€</span><br><span class="line">     * å°†ç”Ÿæˆå¯¹è±¡çš„å‡½æ•°åŠ å…¥å¯¹è±¡å·¥å‚</span><br><span class="line">     *</span><br><span class="line">     * @param *name ç±»åç§°</span><br><span class="line">     * @param procedure â€œç”Ÿäº§â€å¯¹è±¡çš„å‡½æ•°</span><br><span class="line">     * @return æ˜¯å¦æˆåŠŸæ³¨å†Œ</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Register</span><span class="params">(<span class="keyword">char</span> *type, tCreator procedure)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @brief æ‰¾åˆ°â€œç”Ÿäº§è½¦é—´â€</span><br><span class="line">     * æ ¹æ®ä¼ å…¥çš„ç±»åè¿”å›ç›¸åº”çš„æ–°å¯¹è±¡çš„ç”Ÿæˆå‡½æ•°</span><br><span class="line">     *</span><br><span class="line">     * @param &amp;type ç±»å</span><br><span class="line">     * @return ç›¸åº”çš„æ–°å¯¹è±¡çš„ç”Ÿæˆå‡½æ•°</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">T* <span class="title">Create</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;type)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">/** â€œç”Ÿäº§è½¦é—´â€æ˜ å°„ */</span></span><br><span class="line">    tCreatorMap _map;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span><br><span class="line"><span class="title">bool</span> <span class="title">ObjectFactory</span>&lt;T&gt;:</span>:Register(<span class="keyword">char</span> *type, tCreator procedure)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">tmp</span><span class="params">(type)</span></span>;</span><br><span class="line">    <span class="comment">/** å°†æ–°å‡½æ•°åŠ å…¥mapä¸­ */</span></span><br><span class="line">    _map[tmp] = procedure;</span><br><span class="line">    <span class="keyword">return</span> _map[tmp];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span><br><span class="line"><span class="title">T</span>* <span class="title">ObjectFactory</span>&lt;T&gt;:</span>:Create(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;type)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/** åœ¨æ˜ å°„ä¸­æ‰¾åˆ°ç›¸åº”â€œç”Ÿäº§è½¦é—´â€ */</span></span><br><span class="line">    tCreatorMap::iterator iter = _map.find(type);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** æ£€æµ‹â€œè½¦é—´â€æ˜¯å¦å­˜åœ¨ */</span></span><br><span class="line">    <span class="keyword">if</span>(iter != _map.end())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/** è®©è¿”å›å€¼ä¸ºç›¸åº”çš„â€œç”Ÿäº§è½¦é—´â€ */</span></span><br><span class="line">        tCreator r = iter-&gt;second;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** è¿”å›â€œç”Ÿäº§è½¦é—´â€ */</span></span><br><span class="line">        <span class="keyword">return</span> r();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>ã€€ã€€ä»¥ä¸Šå°±æ˜¯åŸºæ–¼å•ä»¶æ¨¡å¼è€Œå®ç°çš„å·¥å‚æ¨¡å¼äº†ã€‚</p><p>ã€€ã€€åœ¨æ ·ä¾‹ä¸­ï¼Œæˆ‘å»ºç«‹äº†ä¸€ä¸ªåŸºç±»Baseï¼Œç„¶åç”¨Aå’ŒBæ¥ç»§æ‰¿å®ƒã€‚</p><p>ã€€ã€€åœ¨ä¸€ä¸ªforå¾ªç¯ä¸­ï¼Œäº¤æ›¿å»ºç«‹äº†Aå¯¹è±¡å’ŒBå¯¹è±¡ã€‚è¿™åªæ˜¯ä¸€ä¸ªDemoï¼Œçœ‹ä¸å‡ºæœ‰ä»€ä¹ˆæ–¹ä¾¿çš„ï¼Œæ„Ÿè§‰ç”¨ä¸€ä¸ªifæ¥å„è‡ªç”Ÿæˆå°±å¥½äº†ï¼Œå°±åƒ</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(type == <span class="string">"A"</span>) p = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">else</span> p = <span class="keyword">new</span> B();</span><br></pre></td></tr></table></figure><p>ã€€ã€€<strong>å½“ç„¶ï¼Œä¸Šé¢ä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬å°†è¦åˆ›å»ºçš„Aã€Bã€Cã€Dã€Eã€Fã€Gç±»æ”¾åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åæˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–è¿™äº›æ•°æ®å¹¶åˆ›å»ºç›¸åº”çš„å¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡çš„é¡ºåºæ˜¯æ‰“ä¹±çš„ï¼Œä½ å°±è¦æœ‰nä¸ªifæ¥åˆ¤æ–­äº†ï¼Œè€Œä¸”æ‰©å±•æ€§ä¸é«˜ã€‚ç”¨ä¸€ä¸ªå¯¹è±¡å·¥å‚è¿›è¡Œå°è£…çš„è¯ï¼Œä¿¨ç„¶å½¢æˆäº†ä¸€ä¸ªé™è€Œæœ‰åºçš„ç”Ÿäº§å·¥å‚ï¼Œæœ‰ç§©åºåœ°ç®¡ç†ç€ä¸åŒçš„å¯¹è±¡è½¦é—´ï¼Œä¸è§‰å¾—è¿™æ˜¯ä¸€ä»¶éå¸¸ç¾å¦™çš„äº‹æƒ…ä¹ˆï¼Ÿ</strong></p><p>ã€€ã€€å¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸ŠDemoã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ObjectFactory.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">/** åŸºç±» */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Baseç±»åŠå…¶å­ç±»çš„å¯¹è±¡å·¥å‚ */</span></span><br><span class="line"><span class="keyword">typedef</span> ObjectFactory&lt;Base&gt; BaseFactory;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span></span><br><span class="line">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Base()&#123;&#125;;</span><br><span class="line">    ~Base()&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> :</span> <span class="keyword">public</span> Base</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A()&#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"An A object created."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;;</span><br><span class="line">    ~A()&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> <span class="keyword">public</span> Base</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B()&#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"A B object Created."</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">    ~B();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å¯¹è±¡Açš„â€œç”Ÿäº§è½¦é—´â€ */</span></span><br><span class="line"><span class="function">Base* <span class="title">ACreator</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> A();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å¯¹è±¡Bçš„â€œç”Ÿäº§è½¦é—´â€ */</span></span><br><span class="line"><span class="function">Base* <span class="title">BCreator</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> B();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * @brief ä¸»å‡½æ•°</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** å°†Aã€Bçš„â€œç”Ÿäº§è½¦é—´â€æ³¨å†Œåˆ°å¯¹è±¡å·¥å‚ä¸­ */</span></span><br><span class="line">    <span class="keyword">bool</span> AFlag = BaseFactory::Instance().Register(<span class="string">"A"</span>, ACreator);</span><br><span class="line">    <span class="keyword">bool</span> BFlag = BaseFactory::Instance().Register(<span class="string">"B"</span>, BCreator);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** è‹¥æ³¨å†Œå¤±è´¥åˆ™é€€å‡º */</span></span><br><span class="line">    <span class="keyword">if</span>(!AFlag || !BFlag) <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    Base *p;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> type = (i % <span class="number">2</span>) ? <span class="built_in">string</span>(<span class="string">"A"</span>) : <span class="built_in">string</span>(<span class="string">"B"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** pç”¨ç›¸åº”â€œç”Ÿäº§è½¦é—´â€è¿›è¡Œç”Ÿäº§ */</span></span><br><span class="line">        p = BaseFactory::Instance().Create(type);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€å¯¹è±¡å·¥å‚ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯äº§ç”Ÿå¯¹è±¡çš„ä¸€ä¸ªâ€œå·¥å‚â€ã€‚æ ¹æ®ä¼ å…¥çš„ä¸€ä¸ªå‚æ•°è€Œäº§ç”Ÿç›¸åº”çš„ä¸åŒç§ç±»çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ç”¨äºæ‰¹é‡ç”ŸæˆåŒä¸€ä¸ªçˆ¶ç±»çš„ä¸åŒå­ç±»çš„å¯¹è±¡æ—¶ç”¨åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€æœ¬å­¦ä¹ ç¬”è®°åŸºäºSingletonï¼ˆå•ä»¶æ¨¡å¼ï¼‰åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€çœ‹ã€ŠC++
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://xcoder.in/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>C++å•ä»¶æ¨¡å¼ï¼šSingletonå­¦ä¹ ç¬”è®°</title>
    <link href="https://xcoder.in/2010/11/13/singleton-learning/"/>
    <id>https://xcoder.in/2010/11/13/singleton-learning/</id>
    <published>2010-11-13T07:44:15.000Z</published>
    <updated>2017-12-11T07:59:20.542Z</updated>
    
    <content type="html"><![CDATA[<p>ã€€ã€€å•ä»¶æ¨¡å¼ï¼ˆSingletonï¼‰æ˜¯ä¸€ç§ç”¨äºç¡®ä¿æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªç±»å®ä¾‹ä¸”è¿™ä¸ªå®ä¾‹æ‰€å èµ„æºåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­æ˜¯å…±äº«æ—¶çš„ç¨‹åºè®¾è®¡æ–¹æ³•ï¼ˆæ ¹æ®å®é™…æƒ…å†µï¼Œå¯èƒ½éœ€è¦å‡ ä¸ªç±»å®ä¾‹ï¼‰ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§ç¨‹åºè®¾è®¡æ–¹æ³•æ˜¯å¾ˆæœ‰ç”¨å¤„çš„ã€‚</p><p>ã€€ã€€åœ¨å°å°åœ°å­¦ä¹ äº†ä¸€ä¸‹C++çš„å•ä»¶æ¨¡å¼ä¹‹åï¼Œçªç„¶è”æƒ³åˆ°PHPçš„ThinkPHPçš„MVCæ¡†æ¶ï¼Œè§‰å¾—è¿™å°±æ˜¯ä¸€ä¸ªå•ä»¶æ¨¡å¼çš„å¾ˆå¥½å®ä¾‹å§ï¼Ÿ</p><p>ã€€ã€€æˆ‘ä¸Šæ¬¡åœ¨PUDNä¸Šè½½äº†ä¸€ä¸ªHGEçš„RPG Demoï¼Œé‡Œé¢å°±ç”¨äº†Singletonæ¨¡å¼è¿˜æœ‰ObjectFactoryæ¨¡å¼å†™çš„ã€‚æ²¡çœ‹æ‡‚ï¼Œäºæ˜¯é—®äº†è°·æ­Œã€‚</p><blockquote><p>Singletonå¯ä»¥è¯´æ˜¯ã€ŠDesign Patternã€‹ä¸­æœ€ç®€å•ä¹Ÿæœ€å®ç”¨çš„ä¸€ä¸ªè®¾è®¡æ¨¡å¼ã€‚é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯Singletonï¼Ÿ<br>é¡¾åæ€ä¹‰ï¼ŒSingletonå°±æ˜¯ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰å”¯ä¸€çš„ä¸€ä¸ªå®ä¾‹ã€‚Singletonä¸»è¦ç”¨äºå¯¹è±¡çš„åˆ›å»ºï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœæŸä¸ªç±»é‡‡ç”¨äº†Singletonæ¨¡å¼ï¼Œåˆ™åœ¨è¿™ä¸ªç±»è¢«åˆ›å»ºåï¼Œå®ƒå°†æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ä¾‹å¯ä¾›è®¿é—®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½ä¼šéœ€è¦Singletonæ¨¡å¼ï¼Œæœ€å¸¸è§çš„æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªè¿æ¥æ•°æ®åº“çš„Connectionå®ä¾‹ï¼›åˆæ¯”å¦‚è¦æ±‚ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­åªå­˜åœ¨æŸä¸ªç”¨æˆ·æ•°æ®ç»“æ„çš„å”¯ä¸€å®ä¾‹ã€‚æˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡åº”ç”¨Singletonæ¨¡å¼è¾¾åˆ°ç›®çš„ã€‚</p><p>ä¸€çœ¼çœ‹å»ï¼ŒSingletonä¼¼ä¹æœ‰äº›åƒå…¨å±€å¯¹è±¡ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œå¹¶ä¸èƒ½ç”¨å…¨å±€å¯¹è±¡ä»£æ›¿Singletonæ¨¡å¼ï¼Œè¿™æ˜¯å› ä¸ºï¼šå…¶ä¸€ï¼Œå¤§é‡ä½¿ç”¨å…¨å±€å¯¹è±¡ä¼šä½¿å¾—ç¨‹åºè´¨é‡é™ä½ï¼Œè€Œä¸”æœ‰äº›ç¼–ç¨‹è¯­è¨€ä¾‹å¦‚C#ï¼Œæ ¹æœ¬å°±ä¸æ”¯æŒå…¨å±€å˜é‡ã€‚å…¶äºŒï¼Œå…¨å±€å¯¹è±¡çš„æ–¹æ³•å¹¶ä¸èƒ½é˜»æ­¢äººä»¬å°†ä¸€ä¸ªç±»å®ä¾‹åŒ–å¤šæ¬¡ï¼šé™¤äº†ç±»çš„å…¨å±€å®ä¾‹å¤–ï¼Œå¼€å‘äººå‘˜ä»ç„¶å¯ä»¥é€šè¿‡ç±»çš„æ„é€ å‡½æ•°åˆ›å»ºç±»çš„å¤šä¸ªå±€éƒ¨å®ä¾‹ã€‚è€ŒSingletonæ¨¡å¼åˆ™é€šè¿‡ä»æ ¹æœ¬ä¸Šæ§åˆ¶ç±»çš„åˆ›å»ºï¼Œå°†â€ä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹â€è¿™ä¸ªä»»åŠ¡äº¤ç»™äº†ç±»æœ¬èº«ï¼Œå¼€å‘äººå‘˜ä¸å¯èƒ½å†æœ‰å…¶å®ƒé€”å¾„å¾—åˆ°ç±»çš„å¤šä¸ªå®ä¾‹ã€‚è¿™ä¸€ç‚¹æ˜¯å…¨å±€å¯¹è±¡æ–¹æ³•ä¸Singletonæ¨¡å¼çš„æ ¹æœ¬åŒºåˆ«ã€‚</p><p style="text-align: right;">â€”â€”æ‘˜è‡ªç™¾åº¦ç™¾ç§‘ï¼ˆæˆ‘ä¸æ˜¯æœ‰æ„åœ¨è°·æ­Œæ‰¾ç™¾åº¦çš„ï¼‰</p></blockquote><p>ã€€ã€€æˆ‘åœ¨çœ‹äº†è¿™ä¸ªRPG Demoçš„Patterné‡Œçš„Singletonä¹‹åï¼Œä»¿ç…§ç€è‡ªå·±å†™äº†ä¸€ä¸ªæœ€ç®€å•çš„Singletonæ¨¡æ¿å®ä¾‹ã€‚</p><p>ã€€ã€€<strong><em>æ€æƒ³å°±æ˜¯ï¼Œåœ¨Singletonä¸­å»ºç«‹ä¸€ä¸ªé™æ€å¯¹è±¡ï¼Œç„¶åä»¥åå°±ç”¨ <code>Singleton::Instance()</code> æ¥è°ƒç”¨è¿™ä¸ªé™æ€å¯¹è±¡ã€‚</em></strong></p><p>ã€€ã€€<strong><em>è€Œä½œä¸ºæ¨¡æ¿å°±æ˜¯å¯ä»¥ <code>class A : public Singleton</code> æ¥è®©Aç»§æ‰¿Singletonçš„å±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ç”¨<br><code>A::Instance()</code> æ¥è®¿é—®Aè¿™ä¸ªé™æ€å¯¹è±¡äº†ã€‚è¿™ä¸ªå°±æ˜¯è¿™æ®µSingletonä»£ç çš„ä¸»è¦æ€æƒ³äº†ã€‚</em></strong></p><p>ã€€ã€€å…ˆæ˜¯å»ºç«‹äº†ä¸€ä¸ªç©ºå·¥ç¨‹ï¼Œå¾€é‡Œé¢æ”¾äº†ï¼š</p><p>ã€€ã€€Singleton.h</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SINGLETON_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SINGLETON_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span><br><span class="line"><span class="title">class</span> <span class="title">Singleton</span></span><br><span class="line">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> T&amp; <span class="title">Instance</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Singleton()&#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~Singleton()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * é˜²æ­¢æ‹·è´å¤åˆ¶</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Singleton(<span class="keyword">const</span> Singleton &amp;);</span><br><span class="line">    Singleton &amp; <span class="keyword">operator</span> = (<span class="keyword">const</span> Singleton &amp;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span><br><span class="line"><span class="title">T</span>&amp; <span class="title">Singleton</span>:</span>:Instance()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/** å»ºç«‹ä¸€ä¸ªé™æ€å¯¹è±¡ */</span></span><br><span class="line">    <span class="keyword">static</span> T instance;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>ã€€ã€€TestSingleton.h</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> TESTSINGLETON_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TESTSINGLETON_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Singleton.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSingleton</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** ä»Singletonç»§æ‰¿æœ¬ç±» */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSingleton</span> :</span> <span class="keyword">public</span> Singleton</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    TestSingleton(<span class="keyword">void</span>);</span><br><span class="line">    <span class="keyword">virtual</span> ~TestSingleton(<span class="keyword">void</span>);</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AddCount</span><span class="params">()</span></span>&#123; count++; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CoutCount</span><span class="params">()</span></span>&#123; <span class="built_in">cout</span> &lt;&lt; count &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>ã€€ã€€TestSingleton.cpp</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"TestSingleton.h"</span></span></span><br><span class="line"></span><br><span class="line">TestSingleton::TestSingleton(<span class="keyword">void</span>)</span><br><span class="line">: count(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TestSingleton::~TestSingleton(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€main.cpp</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"TestSingleton.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/** å•ä»¶å¯¹è±¡countå€¼åŠ 1 */</span></span><br><span class="line">        TestSingleton::Instance().AddCount();</span><br><span class="line">        <span class="comment">/** è¾“å‡ºæ­¤å•ä»¶å¯¹è±¡çš„countå€¼ */</span></span><br><span class="line">        TestSingleton::Instance().CoutCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ã€€ã€€å•ä»¶æ¨¡å¼ï¼ˆSingletonï¼‰æ˜¯ä¸€ç§ç”¨äºç¡®ä¿æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªç±»å®ä¾‹ä¸”è¿™ä¸ªå®ä¾‹æ‰€å èµ„æºåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­æ˜¯å…±äº«æ—¶çš„ç¨‹åºè®¾è®¡æ–¹æ³•ï¼ˆæ ¹æ®å®é™…æƒ…å†µï¼Œå¯èƒ½éœ€è¦å‡ ä¸ªç±»å®ä¾‹ï¼‰ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§ç¨‹åºè®¾è®¡æ–¹æ³•æ˜¯å¾ˆæœ‰ç”¨å¤„çš„ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€åœ¨å°å°åœ°å­¦ä¹ äº†ä¸€ä¸‹C++çš„å•ä»¶æ¨¡å¼ä¹‹åï¼Œ
      
    
    </summary>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/categories/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
    
      <category term="C++" scheme="https://xcoder.in/tags/C/"/>
    
      <category term="è€åšå®¢å¤‡ä»½å½’æ¡£" scheme="https://xcoder.in/tags/%E8%80%81%E5%8D%9A%E5%AE%A2%E5%A4%87%E4%BB%BD%E5%BD%92%E6%A1%A3/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://xcoder.in/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
</feed>
